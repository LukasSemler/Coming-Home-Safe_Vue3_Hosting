var zw=Object.defineProperty,kw=Object.defineProperties;var Pw=Object.getOwnPropertyDescriptors;var ip=Object.getOwnPropertySymbols;var kx=Object.prototype.hasOwnProperty,Px=Object.prototype.propertyIsEnumerable;var zx=(a,d,g)=>d in a?zw(a,d,{enumerable:!0,configurable:!0,writable:!0,value:g}):a[d]=g,ui=(a,d)=>{for(var g in d||(d={}))kx.call(d,g)&&zx(a,g,d[g]);if(ip)for(var g of ip(d))Px.call(d,g)&&zx(a,g,d[g]);return a},xn=(a,d)=>kw(a,Pw(d));var Do=(a,d)=>{var g={};for(var A in a)kx.call(a,A)&&d.indexOf(A)<0&&(g[A]=a[A]);if(a!=null&&ip)for(var A of ip(a))d.indexOf(A)<0&&Px.call(a,A)&&(g[A]=a[A]);return g};function g_(a,d){const g=Object.create(null),A=a.split(",");for(let w=0;w<A.length;w++)g[A[w]]=!0;return d?w=>!!g[w.toLowerCase()]:w=>!!g[w]}const Dw="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Bw=g_(Dw);function Jv(a){return!!a||a===""}function y_(a){if(Yt(a)){const d={};for(let g=0;g<a.length;g++){const A=a[g],w=br(A)?Ow(A):y_(A);if(w)for(const I in w)d[I]=w[I]}return d}else{if(br(a))return a;if(wr(a))return a}}const Lw=/;(?![^(]*\))/g,Rw=/:(.+)/;function Ow(a){const d={};return a.split(Lw).forEach(g=>{if(g){const A=g.split(Rw);A.length>1&&(d[A[0].trim()]=A[1].trim())}}),d}function x_(a){let d="";if(br(a))d=a;else if(Yt(a))for(let g=0;g<a.length;g++){const A=x_(a[g]);A&&(d+=A+" ")}else if(wr(a))for(const g in a)a[g]&&(d+=g+" ");return d.trim()}const XC=a=>br(a)?a:a==null?"":Yt(a)||wr(a)&&(a.toString===t0||!ai(a.toString))?JSON.stringify(a,Kv,2):String(a),Kv=(a,d)=>d&&d.__v_isRef?Kv(a,d.value):fc(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((g,[A,w])=>(g[`${A} =>`]=w,g),{})}:e0(d)?{[`Set(${d.size})`]:[...d.values()]}:wr(d)&&!Yt(d)&&!i0(d)?String(d):d,tr={},pc=[],co=()=>{},Fw=()=>!1,Uw=/^on[^a-z]/,zp=a=>Uw.test(a),v_=a=>a.startsWith("onUpdate:"),Zr=Object.assign,A_=(a,d)=>{const g=a.indexOf(d);g>-1&&a.splice(g,1)},Vw=Object.prototype.hasOwnProperty,Li=(a,d)=>Vw.call(a,d),Yt=Array.isArray,fc=a=>kp(a)==="[object Map]",e0=a=>kp(a)==="[object Set]",ai=a=>typeof a=="function",br=a=>typeof a=="string",b_=a=>typeof a=="symbol",wr=a=>a!==null&&typeof a=="object",w_=a=>wr(a)&&ai(a.then)&&ai(a.catch),t0=Object.prototype.toString,kp=a=>t0.call(a),jw=a=>kp(a).slice(8,-1),i0=a=>kp(a)==="[object Object]",E_=a=>br(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,fp=g_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Pp=a=>{const d=Object.create(null);return g=>d[g]||(d[g]=a(g))},Nw=/-(\w)/g,Oo=Pp(a=>a.replace(Nw,(d,g)=>g?g.toUpperCase():"")),$w=/\B([A-Z])/g,Ac=Pp(a=>a.replace($w,"-$1").toLowerCase()),Dp=Pp(a=>a.charAt(0).toUpperCase()+a.slice(1)),vm=Pp(a=>a?`on${Dp(a)}`:""),mh=(a,d)=>!Object.is(a,d),mp=(a,d)=>{for(let g=0;g<a.length;g++)a[g](d)},Ap=(a,d,g)=>{Object.defineProperty(a,d,{configurable:!0,enumerable:!1,value:g})},_h=a=>{const d=parseFloat(a);return isNaN(d)?a:d};let Dx;const Gw=()=>Dx||(Dx=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let ns;class r0{constructor(d=!1){this.active=!0,this.effects=[],this.cleanups=[],!d&&ns&&(this.parent=ns,this.index=(ns.scopes||(ns.scopes=[])).push(this)-1)}run(d){if(this.active)try{return ns=this,d()}finally{ns=this.parent}}on(){ns=this}off(){ns=this.parent}stop(d){if(this.active){let g,A;for(g=0,A=this.effects.length;g<A;g++)this.effects[g].stop();for(g=0,A=this.cleanups.length;g<A;g++)this.cleanups[g]();if(this.scopes)for(g=0,A=this.scopes.length;g<A;g++)this.scopes[g].stop(!0);if(this.parent&&!d){const w=this.parent.scopes.pop();w&&w!==this&&(this.parent.scopes[this.index]=w,w.index=this.index)}this.active=!1}}}function n0(a){return new r0(a)}function Zw(a,d=ns){d&&d.active&&d.effects.push(a)}const T_=a=>{const d=new Set(a);return d.w=0,d.n=0,d},o0=a=>(a.w&Ks)>0,s0=a=>(a.n&Ks)>0,qw=({deps:a})=>{if(a.length)for(let d=0;d<a.length;d++)a[d].w|=Ks},Ww=a=>{const{deps:d}=a;if(d.length){let g=0;for(let A=0;A<d.length;A++){const w=d[A];o0(w)&&!s0(w)?w.delete(a):d[g++]=w,w.w&=~Ks,w.n&=~Ks}d.length=g}},Fm=new WeakMap;let nh=0,Ks=1;const Um=30;let Ro;const Ja=Symbol(""),Vm=Symbol("");class S_{constructor(d,g=null,A){this.fn=d,this.scheduler=g,this.active=!0,this.deps=[],this.parent=void 0,Zw(this,A)}run(){if(!this.active)return this.fn();let d=Ro,g=Hs;for(;d;){if(d===this)return;d=d.parent}try{return this.parent=Ro,Ro=this,Hs=!0,Ks=1<<++nh,nh<=Um?qw(this):Bx(this),this.fn()}finally{nh<=Um&&Ww(this),Ks=1<<--nh,Ro=this.parent,Hs=g,this.parent=void 0}}stop(){this.active&&(Bx(this),this.onStop&&this.onStop(),this.active=!1)}}function Bx(a){const{deps:d}=a;if(d.length){for(let g=0;g<d.length;g++)d[g].delete(a);d.length=0}}let Hs=!0;const a0=[];function bc(){a0.push(Hs),Hs=!1}function wc(){const a=a0.pop();Hs=a===void 0?!0:a}function On(a,d,g){if(Hs&&Ro){let A=Fm.get(a);A||Fm.set(a,A=new Map);let w=A.get(g);w||A.set(g,w=T_()),l0(w)}}function l0(a,d){let g=!1;nh<=Um?s0(a)||(a.n|=Ks,g=!o0(a)):g=!a.has(Ro),g&&(a.add(Ro),Ro.deps.push(a))}function ls(a,d,g,A,w,I){const z=Fm.get(a);if(!z)return;let o=[];if(d==="clear")o=[...z.values()];else if(g==="length"&&Yt(a))z.forEach((P,V)=>{(V==="length"||V>=A)&&o.push(P)});else switch(g!==void 0&&o.push(z.get(g)),d){case"add":Yt(a)?E_(g)&&o.push(z.get("length")):(o.push(z.get(Ja)),fc(a)&&o.push(z.get(Vm)));break;case"delete":Yt(a)||(o.push(z.get(Ja)),fc(a)&&o.push(z.get(Vm)));break;case"set":fc(a)&&o.push(z.get(Ja));break}if(o.length===1)o[0]&&jm(o[0]);else{const P=[];for(const V of o)V&&P.push(...V);jm(T_(P))}}function jm(a,d){for(const g of Yt(a)?a:[...a])(g!==Ro||g.allowRecurse)&&(g.scheduler?g.scheduler():g.run())}const Xw=g_("__proto__,__v_isRef,__isVue"),c0=new Set(Object.getOwnPropertyNames(Symbol).map(a=>Symbol[a]).filter(b_)),Hw=I_(),Qw=I_(!1,!0),Yw=I_(!0),Lx=Jw();function Jw(){const a={};return["includes","indexOf","lastIndexOf"].forEach(d=>{a[d]=function(...g){const A=Ri(this);for(let I=0,z=this.length;I<z;I++)On(A,"get",I+"");const w=A[d](...g);return w===-1||w===!1?A[d](...g.map(Ri)):w}}),["push","pop","shift","unshift","splice"].forEach(d=>{a[d]=function(...g){bc();const A=Ri(this)[d].apply(this,g);return wc(),A}}),a}function I_(a=!1,d=!1){return function(A,w,I){if(w==="__v_isReactive")return!a;if(w==="__v_isReadonly")return a;if(w==="__v_isShallow")return d;if(w==="__v_raw"&&I===(a?d?f2:f0:d?p0:d0).get(A))return A;const z=Yt(A);if(!a&&z&&Li(Lx,w))return Reflect.get(Lx,w,I);const o=Reflect.get(A,w,I);return(b_(w)?c0.has(w):Xw(w))||(a||On(A,"get",w),d)?o:ar(o)?!z||!E_(w)?o.value:o:wr(o)?a?m0(o):Fo(o):o}}const Kw=u0(),e2=u0(!0);function u0(a=!1){return function(g,A,w,I){let z=g[A];if(_c(z)&&ar(z)&&!ar(w))return!1;if(!a&&!_c(w)&&(_0(w)||(w=Ri(w),z=Ri(z)),!Yt(g)&&ar(z)&&!ar(w)))return z.value=w,!0;const o=Yt(g)&&E_(A)?Number(A)<g.length:Li(g,A),P=Reflect.set(g,A,w,I);return g===Ri(I)&&(o?mh(w,z)&&ls(g,"set",A,w):ls(g,"add",A,w)),P}}function t2(a,d){const g=Li(a,d);a[d];const A=Reflect.deleteProperty(a,d);return A&&g&&ls(a,"delete",d,void 0),A}function i2(a,d){const g=Reflect.has(a,d);return(!b_(d)||!c0.has(d))&&On(a,"has",d),g}function r2(a){return On(a,"iterate",Yt(a)?"length":Ja),Reflect.ownKeys(a)}const h0={get:Hw,set:Kw,deleteProperty:t2,has:i2,ownKeys:r2},n2={get:Yw,set(a,d){return!0},deleteProperty(a,d){return!0}},o2=Zr({},h0,{get:Qw,set:e2}),C_=a=>a,Bp=a=>Reflect.getPrototypeOf(a);function rp(a,d,g=!1,A=!1){a=a.__v_raw;const w=Ri(a),I=Ri(d);d!==I&&!g&&On(w,"get",d),!g&&On(w,"get",I);const{has:z}=Bp(w),o=A?C_:g?k_:gh;if(z.call(w,d))return o(a.get(d));if(z.call(w,I))return o(a.get(I));a!==w&&a.get(d)}function np(a,d=!1){const g=this.__v_raw,A=Ri(g),w=Ri(a);return a!==w&&!d&&On(A,"has",a),!d&&On(A,"has",w),a===w?g.has(a):g.has(a)||g.has(w)}function op(a,d=!1){return a=a.__v_raw,!d&&On(Ri(a),"iterate",Ja),Reflect.get(a,"size",a)}function Rx(a){a=Ri(a);const d=Ri(this);return Bp(d).has.call(d,a)||(d.add(a),ls(d,"add",a,a)),this}function Ox(a,d){d=Ri(d);const g=Ri(this),{has:A,get:w}=Bp(g);let I=A.call(g,a);I||(a=Ri(a),I=A.call(g,a));const z=w.call(g,a);return g.set(a,d),I?mh(d,z)&&ls(g,"set",a,d):ls(g,"add",a,d),this}function Fx(a){const d=Ri(this),{has:g,get:A}=Bp(d);let w=g.call(d,a);w||(a=Ri(a),w=g.call(d,a)),A&&A.call(d,a);const I=d.delete(a);return w&&ls(d,"delete",a,void 0),I}function Ux(){const a=Ri(this),d=a.size!==0,g=a.clear();return d&&ls(a,"clear",void 0,void 0),g}function sp(a,d){return function(A,w){const I=this,z=I.__v_raw,o=Ri(z),P=d?C_:a?k_:gh;return!a&&On(o,"iterate",Ja),z.forEach((V,F)=>A.call(w,P(V),P(F),I))}}function ap(a,d,g){return function(...A){const w=this.__v_raw,I=Ri(w),z=fc(I),o=a==="entries"||a===Symbol.iterator&&z,P=a==="keys"&&z,V=w[a](...A),F=g?C_:d?k_:gh;return!d&&On(I,"iterate",P?Vm:Ja),{next(){const{value:R,done:$}=V.next();return $?{value:R,done:$}:{value:o?[F(R[0]),F(R[1])]:F(R),done:$}},[Symbol.iterator](){return this}}}}function Us(a){return function(...d){return a==="delete"?!1:this}}function s2(){const a={get(I){return rp(this,I)},get size(){return op(this)},has:np,add:Rx,set:Ox,delete:Fx,clear:Ux,forEach:sp(!1,!1)},d={get(I){return rp(this,I,!1,!0)},get size(){return op(this)},has:np,add:Rx,set:Ox,delete:Fx,clear:Ux,forEach:sp(!1,!0)},g={get(I){return rp(this,I,!0)},get size(){return op(this,!0)},has(I){return np.call(this,I,!0)},add:Us("add"),set:Us("set"),delete:Us("delete"),clear:Us("clear"),forEach:sp(!0,!1)},A={get(I){return rp(this,I,!0,!0)},get size(){return op(this,!0)},has(I){return np.call(this,I,!0)},add:Us("add"),set:Us("set"),delete:Us("delete"),clear:Us("clear"),forEach:sp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(I=>{a[I]=ap(I,!1,!1),g[I]=ap(I,!0,!1),d[I]=ap(I,!1,!0),A[I]=ap(I,!0,!0)}),[a,g,d,A]}const[a2,l2,c2,u2]=s2();function M_(a,d){const g=d?a?u2:c2:a?l2:a2;return(A,w,I)=>w==="__v_isReactive"?!a:w==="__v_isReadonly"?a:w==="__v_raw"?A:Reflect.get(Li(g,w)&&w in A?g:A,w,I)}const h2={get:M_(!1,!1)},d2={get:M_(!1,!0)},p2={get:M_(!0,!1)},d0=new WeakMap,p0=new WeakMap,f0=new WeakMap,f2=new WeakMap;function m2(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function _2(a){return a.__v_skip||!Object.isExtensible(a)?0:m2(jw(a))}function Fo(a){return _c(a)?a:z_(a,!1,h0,h2,d0)}function g2(a){return z_(a,!1,o2,d2,p0)}function m0(a){return z_(a,!0,n2,p2,f0)}function z_(a,d,g,A,w){if(!wr(a)||a.__v_raw&&!(d&&a.__v_isReactive))return a;const I=w.get(a);if(I)return I;const z=_2(a);if(z===0)return a;const o=new Proxy(a,z===2?A:g);return w.set(a,o),o}function as(a){return _c(a)?as(a.__v_raw):!!(a&&a.__v_isReactive)}function _c(a){return!!(a&&a.__v_isReadonly)}function _0(a){return!!(a&&a.__v_isShallow)}function g0(a){return as(a)||_c(a)}function Ri(a){const d=a&&a.__v_raw;return d?Ri(d):a}function gc(a){return Ap(a,"__v_skip",!0),a}const gh=a=>wr(a)?Fo(a):a,k_=a=>wr(a)?m0(a):a;function y0(a){Hs&&Ro&&(a=Ri(a),l0(a.dep||(a.dep=T_())))}function x0(a,d){a=Ri(a),a.dep&&jm(a.dep)}function ar(a){return!!(a&&a.__v_isRef===!0)}function $t(a){return v0(a,!1)}function y2(a){return v0(a,!0)}function v0(a,d){return ar(a)?a:new x2(a,d)}class x2{constructor(d,g){this.__v_isShallow=g,this.dep=void 0,this.__v_isRef=!0,this._rawValue=g?d:Ri(d),this._value=g?d:gh(d)}get value(){return y0(this),this._value}set value(d){d=this.__v_isShallow?d:Ri(d),mh(d,this._rawValue)&&(this._rawValue=d,this._value=this.__v_isShallow?d:gh(d),x0(this))}}function hi(a){return ar(a)?a.value:a}const v2={get:(a,d,g)=>hi(Reflect.get(a,d,g)),set:(a,d,g,A)=>{const w=a[d];return ar(w)&&!ar(g)?(w.value=g,!0):Reflect.set(a,d,g,A)}};function A0(a){return as(a)?a:new Proxy(a,v2)}function A2(a){const d=Yt(a)?new Array(a.length):{};for(const g in a)d[g]=w2(a,g);return d}class b2{constructor(d,g,A){this._object=d,this._key=g,this._defaultValue=A,this.__v_isRef=!0}get value(){const d=this._object[this._key];return d===void 0?this._defaultValue:d}set value(d){this._object[this._key]=d}}function w2(a,d,g){const A=a[d];return ar(A)?A:new b2(a,d,g)}class E2{constructor(d,g,A,w){this._setter=g,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new S_(d,()=>{this._dirty||(this._dirty=!0,x0(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!w,this.__v_isReadonly=A}get value(){const d=Ri(this);return y0(d),(d._dirty||!d._cacheable)&&(d._dirty=!1,d._value=d.effect.run()),d._value}set value(d){this._setter(d)}}function T2(a,d,g=!1){let A,w;const I=ai(a);return I?(A=a,w=co):(A=a.get,w=a.set),new E2(A,w,I||!w,g)}Promise.resolve();function Qs(a,d,g,A){let w;try{w=A?a(...A):a()}catch(I){wh(I,d,g)}return w}function Wn(a,d,g,A){if(ai(a)){const I=Qs(a,d,g,A);return I&&w_(I)&&I.catch(z=>{wh(z,d,g)}),I}const w=[];for(let I=0;I<a.length;I++)w.push(Wn(a[I],d,g,A));return w}function wh(a,d,g,A=!0){const w=d?d.vnode:null;if(d){let I=d.parent;const z=d.proxy,o=g;for(;I;){const V=I.ec;if(V){for(let F=0;F<V.length;F++)if(V[F](a,z,o)===!1)return}I=I.parent}const P=d.appContext.config.errorHandler;if(P){Qs(P,null,10,[a,z,o]);return}}S2(a,g,w,A)}function S2(a,d,g,A=!0){console.error(a)}let bp=!1,Nm=!1;const Dn=[];let ss=0;const lh=[];let oh=null,cc=0;const ch=[];let Gs=null,uc=0;const b0=Promise.resolve();let P_=null,$m=null;function Ln(a){const d=P_||b0;return a?d.then(this?a.bind(this):a):d}function I2(a){let d=ss+1,g=Dn.length;for(;d<g;){const A=d+g>>>1;yh(Dn[A])<a?d=A+1:g=A}return d}function w0(a){(!Dn.length||!Dn.includes(a,bp&&a.allowRecurse?ss+1:ss))&&a!==$m&&(a.id==null?Dn.push(a):Dn.splice(I2(a.id),0,a),E0())}function E0(){!bp&&!Nm&&(Nm=!0,P_=b0.then(C0))}function C2(a){const d=Dn.indexOf(a);d>ss&&Dn.splice(d,1)}function T0(a,d,g,A){Yt(a)?g.push(...a):(!d||!d.includes(a,a.allowRecurse?A+1:A))&&g.push(a),E0()}function M2(a){T0(a,oh,lh,cc)}function S0(a){T0(a,Gs,ch,uc)}function D_(a,d=null){if(lh.length){for($m=d,oh=[...new Set(lh)],lh.length=0,cc=0;cc<oh.length;cc++)oh[cc]();oh=null,cc=0,$m=null,D_(a,d)}}function I0(a){if(ch.length){const d=[...new Set(ch)];if(ch.length=0,Gs){Gs.push(...d);return}for(Gs=d,Gs.sort((g,A)=>yh(g)-yh(A)),uc=0;uc<Gs.length;uc++)Gs[uc]();Gs=null,uc=0}}const yh=a=>a.id==null?1/0:a.id;function C0(a){Nm=!1,bp=!0,D_(a),Dn.sort((g,A)=>yh(g)-yh(A));const d=co;try{for(ss=0;ss<Dn.length;ss++){const g=Dn[ss];g&&g.active!==!1&&Qs(g,null,14)}}finally{ss=0,Dn.length=0,I0(),bp=!1,P_=null,(Dn.length||lh.length||ch.length)&&C0(a)}}function z2(a,d,...g){const A=a.vnode.props||tr;let w=g;const I=d.startsWith("update:"),z=I&&d.slice(7);if(z&&z in A){const F=`${z==="modelValue"?"model":z}Modifiers`,{number:R,trim:$}=A[F]||tr;$?w=g.map(ne=>ne.trim()):R&&(w=g.map(_h))}let o,P=A[o=vm(d)]||A[o=vm(Oo(d))];!P&&I&&(P=A[o=vm(Ac(d))]),P&&Wn(P,a,6,w);const V=A[o+"Once"];if(V){if(!a.emitted)a.emitted={};else if(a.emitted[o])return;a.emitted[o]=!0,Wn(V,a,6,w)}}function M0(a,d,g=!1){const A=d.emitsCache,w=A.get(a);if(w!==void 0)return w;const I=a.emits;let z={},o=!1;if(!ai(a)){const P=V=>{const F=M0(V,d,!0);F&&(o=!0,Zr(z,F))};!g&&d.mixins.length&&d.mixins.forEach(P),a.extends&&P(a.extends),a.mixins&&a.mixins.forEach(P)}return!I&&!o?(A.set(a,null),null):(Yt(I)?I.forEach(P=>z[P]=null):Zr(z,I),A.set(a,z),z)}function B_(a,d){return!a||!zp(d)?!1:(d=d.slice(2).replace(/Once$/,""),Li(a,d[0].toLowerCase()+d.slice(1))||Li(a,Ac(d))||Li(a,d))}let qn=null,z0=null;function wp(a){const d=qn;return qn=a,z0=a&&a.type.__scopeId||null,d}function k2(a,d=qn,g){if(!d||a._n)return a;const A=(...w)=>{A._d&&Jx(-1);const I=wp(d),z=a(...w);return wp(I),A._d&&Jx(1),z};return A._n=!0,A._c=!0,A._d=!0,A}function Am(a){const{type:d,vnode:g,proxy:A,withProxy:w,props:I,propsOptions:[z],slots:o,attrs:P,emit:V,render:F,renderCache:R,data:$,setupState:ne,ctx:oe,inheritAttrs:ve}=a;let Ie,Ge;const Ze=wp(a);try{if(g.shapeFlag&4){const ft=w||A;Ie=lo(F.call(ft,ft,R,I,ne,$,oe)),Ge=P}else{const ft=d;Ie=lo(ft.length>1?ft(I,{attrs:P,slots:o,emit:V}):ft(I,null)),Ge=d.props?P:D2(P)}}catch(ft){hh.length=0,wh(ft,a,1),Ie=Wi(Xn)}let st=Ie;if(Ge&&ve!==!1){const ft=Object.keys(Ge),{shapeFlag:He}=st;ft.length&&He&7&&(z&&ft.some(v_)&&(Ge=B2(Ge,z)),st=Ka(st,Ge))}return g.dirs&&(st.dirs=st.dirs?st.dirs.concat(g.dirs):g.dirs),g.transition&&(st.transition=g.transition),Ie=st,wp(Ze),Ie}function P2(a){let d;for(let g=0;g<a.length;g++){const A=a[g];if(Tp(A)){if(A.type!==Xn||A.children==="v-if"){if(d)return;d=A}}else return}return d}const D2=a=>{let d;for(const g in a)(g==="class"||g==="style"||zp(g))&&((d||(d={}))[g]=a[g]);return d},B2=(a,d)=>{const g={};for(const A in a)(!v_(A)||!(A.slice(9)in d))&&(g[A]=a[A]);return g};function L2(a,d,g){const{props:A,children:w,component:I}=a,{props:z,children:o,patchFlag:P}=d,V=I.emitsOptions;if(d.dirs||d.transition)return!0;if(g&&P>=0){if(P&1024)return!0;if(P&16)return A?Vx(A,z,V):!!z;if(P&8){const F=d.dynamicProps;for(let R=0;R<F.length;R++){const $=F[R];if(z[$]!==A[$]&&!B_(V,$))return!0}}}else return(w||o)&&(!o||!o.$stable)?!0:A===z?!1:A?z?Vx(A,z,V):!0:!!z;return!1}function Vx(a,d,g){const A=Object.keys(d);if(A.length!==Object.keys(a).length)return!0;for(let w=0;w<A.length;w++){const I=A[w];if(d[I]!==a[I]&&!B_(g,I))return!0}return!1}function L_({vnode:a,parent:d},g){for(;d&&d.subTree===a;)(a=d.vnode).el=g,d=d.parent}const R2=a=>a.__isSuspense,O2={name:"Suspense",__isSuspense:!0,process(a,d,g,A,w,I,z,o,P,V){a==null?F2(d,g,A,w,I,z,o,P,V):U2(a,d,g,A,w,z,o,P,V)},hydrate:V2,create:R_,normalize:j2},HC=O2;function xh(a,d){const g=a.props&&a.props[d];ai(g)&&g()}function F2(a,d,g,A,w,I,z,o,P){const{p:V,o:{createElement:F}}=P,R=F("div"),$=a.suspense=R_(a,w,A,d,R,g,I,z,o,P);V(null,$.pendingBranch=a.ssContent,R,null,A,$,I,z),$.deps>0?(xh(a,"onPending"),xh(a,"onFallback"),V(null,a.ssFallback,d,g,A,null,I,z),mc($,a.ssFallback)):$.resolve()}function U2(a,d,g,A,w,I,z,o,{p:P,um:V,o:{createElement:F}}){const R=d.suspense=a.suspense;R.vnode=d,d.el=a.el;const $=d.ssContent,ne=d.ssFallback,{activeBranch:oe,pendingBranch:ve,isInFallback:Ie,isHydrating:Ge}=R;if(ve)R.pendingBranch=$,Lo($,ve)?(P(ve,$,R.hiddenContainer,null,w,R,I,z,o),R.deps<=0?R.resolve():Ie&&(P(oe,ne,g,A,w,null,I,z,o),mc(R,ne))):(R.pendingId++,Ge?(R.isHydrating=!1,R.activeBranch=ve):V(ve,w,R),R.deps=0,R.effects.length=0,R.hiddenContainer=F("div"),Ie?(P(null,$,R.hiddenContainer,null,w,R,I,z,o),R.deps<=0?R.resolve():(P(oe,ne,g,A,w,null,I,z,o),mc(R,ne))):oe&&Lo($,oe)?(P(oe,$,g,A,w,R,I,z,o),R.resolve(!0)):(P(null,$,R.hiddenContainer,null,w,R,I,z,o),R.deps<=0&&R.resolve()));else if(oe&&Lo($,oe))P(oe,$,g,A,w,R,I,z,o),mc(R,$);else if(xh(d,"onPending"),R.pendingBranch=$,R.pendingId++,P(null,$,R.hiddenContainer,null,w,R,I,z,o),R.deps<=0)R.resolve();else{const{timeout:Ze,pendingId:st}=R;Ze>0?setTimeout(()=>{R.pendingId===st&&R.fallback(ne)},Ze):Ze===0&&R.fallback(ne)}}function R_(a,d,g,A,w,I,z,o,P,V,F=!1){const{p:R,m:$,um:ne,n:oe,o:{parentNode:ve,remove:Ie}}=V,Ge=_h(a.props&&a.props.timeout),Ze={vnode:a,parent:d,parentComponent:g,isSVG:z,container:A,hiddenContainer:w,anchor:I,deps:0,pendingId:0,timeout:typeof Ge=="number"?Ge:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:F,isUnmounted:!1,effects:[],resolve(st=!1){const{vnode:ft,activeBranch:He,pendingBranch:yt,pendingId:We,effects:xt,parentComponent:Et,container:gt}=Ze;if(Ze.isHydrating)Ze.isHydrating=!1;else if(!st){const ei=He&&yt.transition&&yt.transition.mode==="out-in";ei&&(He.transition.afterLeave=()=>{We===Ze.pendingId&&$(yt,gt,ri,0)});let{anchor:ri}=Ze;He&&(ri=oe(He),ne(He,Et,Ze,!0)),ei||$(yt,gt,ri,0)}mc(Ze,yt),Ze.pendingBranch=null,Ze.isInFallback=!1;let Ft=Ze.parent,At=!1;for(;Ft;){if(Ft.pendingBranch){Ft.effects.push(...xt),At=!0;break}Ft=Ft.parent}At||S0(xt),Ze.effects=[],xh(ft,"onResolve")},fallback(st){if(!Ze.pendingBranch)return;const{vnode:ft,activeBranch:He,parentComponent:yt,container:We,isSVG:xt}=Ze;xh(ft,"onFallback");const Et=oe(He),gt=()=>{!Ze.isInFallback||(R(null,st,We,Et,yt,null,xt,o,P),mc(Ze,st))},Ft=st.transition&&st.transition.mode==="out-in";Ft&&(He.transition.afterLeave=gt),Ze.isInFallback=!0,ne(He,yt,null,!0),Ft||gt()},move(st,ft,He){Ze.activeBranch&&$(Ze.activeBranch,st,ft,He),Ze.container=st},next(){return Ze.activeBranch&&oe(Ze.activeBranch)},registerDep(st,ft){const He=!!Ze.pendingBranch;He&&Ze.deps++;const yt=st.vnode.el;st.asyncDep.catch(We=>{wh(We,st,0)}).then(We=>{if(st.isUnmounted||Ze.isUnmounted||Ze.pendingId!==st.suspenseId)return;st.asyncResolved=!0;const{vnode:xt}=st;Km(st,We,!1),yt&&(xt.el=yt);const Et=!yt&&st.subTree.el;ft(st,xt,ve(yt||st.subTree.el),yt?null:oe(st.subTree),Ze,z,P),Et&&Ie(Et),L_(st,xt.el),He&&--Ze.deps===0&&Ze.resolve()})},unmount(st,ft){Ze.isUnmounted=!0,Ze.activeBranch&&ne(Ze.activeBranch,g,st,ft),Ze.pendingBranch&&ne(Ze.pendingBranch,g,st,ft)}};return Ze}function V2(a,d,g,A,w,I,z,o,P){const V=d.suspense=R_(d,A,g,a.parentNode,document.createElement("div"),null,w,I,z,o,!0),F=P(a,V.pendingBranch=d.ssContent,g,V,I,z);return V.deps===0&&V.resolve(),F}function j2(a){const{shapeFlag:d,children:g}=a,A=d&32;a.ssContent=jx(A?g.default:g),a.ssFallback=A?jx(g.fallback):Wi(Xn)}function jx(a){let d;if(ai(a)){const g=vh&&a._c;g&&(a._d=!1,en()),a=a(),g&&(a._d=!0,d=Ys,W0())}return Yt(a)&&(a=P2(a)),a=lo(a),d&&!a.dynamicChildren&&(a.dynamicChildren=d.filter(g=>g!==a)),a}function N2(a,d){d&&d.pendingBranch?Yt(a)?d.effects.push(...a):d.effects.push(a):S0(a)}function mc(a,d){a.activeBranch=d;const{vnode:g,parentComponent:A}=a,w=g.el=d.el;A&&A.subTree===g&&(A.vnode.el=w,L_(A,w))}function Ar(a,d){if(Fr){let g=Fr.provides;const A=Fr.parent&&Fr.parent.provides;A===g&&(g=Fr.provides=Object.create(A)),g[a]=d}}function ir(a,d,g=!1){const A=Fr||qn;if(A){const w=A.parent==null?A.vnode.appContext&&A.vnode.appContext.provides:A.parent.provides;if(w&&a in w)return w[a];if(arguments.length>1)return g&&ai(d)?d.call(A.proxy):d}}function bn(a,d){return O_(a,null,d)}const Nx={};function An(a,d,g){return O_(a,d,g)}function O_(a,d,{immediate:g,deep:A,flush:w,onTrack:I,onTrigger:z}=tr){const o=Fr;let P,V=!1,F=!1;if(ar(a)?(P=()=>a.value,V=_0(a)):as(a)?(P=()=>a,A=!0):Yt(a)?(F=!0,V=a.some(as),P=()=>a.map(Ge=>{if(ar(Ge))return Ge.value;if(as(Ge))return Ya(Ge);if(ai(Ge))return Qs(Ge,o,2)})):ai(a)?d?P=()=>Qs(a,o,2):P=()=>{if(!(o&&o.isUnmounted))return R&&R(),Wn(a,o,3,[$])}:P=co,d&&A){const Ge=P;P=()=>Ya(Ge())}let R,$=Ge=>{R=Ie.onStop=()=>{Qs(Ge,o,4)}};if(Ah)return $=co,d?g&&Wn(d,o,3,[P(),F?[]:void 0,$]):P(),co;let ne=F?[]:Nx;const oe=()=>{if(!!Ie.active)if(d){const Ge=Ie.run();(A||V||(F?Ge.some((Ze,st)=>mh(Ze,ne[st])):mh(Ge,ne)))&&(R&&R(),Wn(d,o,3,[Ge,ne===Nx?void 0:ne,$]),ne=Ge)}else Ie.run()};oe.allowRecurse=!!d;let ve;w==="sync"?ve=oe:w==="post"?ve=()=>vn(oe,o&&o.suspense):ve=()=>{!o||o.isMounted?M2(oe):oe()};const Ie=new S_(P,ve);return d?g?oe():ne=Ie.run():w==="post"?vn(Ie.run.bind(Ie),o&&o.suspense):Ie.run(),()=>{Ie.stop(),o&&o.scope&&A_(o.scope.effects,Ie)}}function $2(a,d,g){const A=this.proxy,w=br(a)?a.includes(".")?k0(A,a):()=>A[a]:a.bind(A,A);let I;ai(d)?I=d:(I=d.handler,g=d);const z=Fr;ea(this);const o=O_(w,I.bind(A),g);return z?ea(z):Js(),o}function k0(a,d){const g=d.split(".");return()=>{let A=a;for(let w=0;w<g.length&&A;w++)A=A[g[w]];return A}}function Ya(a,d){if(!wr(a)||a.__v_skip||(d=d||new Set,d.has(a)))return a;if(d.add(a),ar(a))Ya(a.value,d);else if(Yt(a))for(let g=0;g<a.length;g++)Ya(a[g],d);else if(e0(a)||fc(a))a.forEach(g=>{Ya(g,d)});else if(i0(a))for(const g in a)Ya(a[g],d);return a}function G2(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Kr(()=>{a.isMounted=!0}),F_(()=>{a.isUnmounting=!0}),a}const Zn=[Function,Array],Z2={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Zn,onEnter:Zn,onAfterEnter:Zn,onEnterCancelled:Zn,onBeforeLeave:Zn,onLeave:Zn,onAfterLeave:Zn,onLeaveCancelled:Zn,onBeforeAppear:Zn,onAppear:Zn,onAfterAppear:Zn,onAppearCancelled:Zn},setup(a,{slots:d}){const g=Eh(),A=G2();let w;return()=>{const I=d.default&&B0(d.default(),!0);if(!I||!I.length)return;const z=Ri(a),{mode:o}=z,P=I[0];if(A.isLeaving)return bm(P);const V=$x(P);if(!V)return bm(P);const F=Gm(V,z,A,g);Zm(V,F);const R=g.subTree,$=R&&$x(R);let ne=!1;const{getTransitionKey:oe}=V.type;if(oe){const ve=oe();w===void 0?w=ve:ve!==w&&(w=ve,ne=!0)}if($&&$.type!==Xn&&(!Lo(V,$)||ne)){const ve=Gm($,z,A,g);if(Zm($,ve),o==="out-in")return A.isLeaving=!0,ve.afterLeave=()=>{A.isLeaving=!1,g.update()},bm(P);o==="in-out"&&V.type!==Xn&&(ve.delayLeave=(Ie,Ge,Ze)=>{const st=D0(A,$);st[String($.key)]=$,Ie._leaveCb=()=>{Ge(),Ie._leaveCb=void 0,delete F.delayedLeave},F.delayedLeave=Ze})}return P}}},P0=Z2;function D0(a,d){const{leavingVNodes:g}=a;let A=g.get(d.type);return A||(A=Object.create(null),g.set(d.type,A)),A}function Gm(a,d,g,A){const{appear:w,mode:I,persisted:z=!1,onBeforeEnter:o,onEnter:P,onAfterEnter:V,onEnterCancelled:F,onBeforeLeave:R,onLeave:$,onAfterLeave:ne,onLeaveCancelled:oe,onBeforeAppear:ve,onAppear:Ie,onAfterAppear:Ge,onAppearCancelled:Ze}=d,st=String(a.key),ft=D0(g,a),He=(We,xt)=>{We&&Wn(We,A,9,xt)},yt={mode:I,persisted:z,beforeEnter(We){let xt=o;if(!g.isMounted)if(w)xt=ve||o;else return;We._leaveCb&&We._leaveCb(!0);const Et=ft[st];Et&&Lo(a,Et)&&Et.el._leaveCb&&Et.el._leaveCb(),He(xt,[We])},enter(We){let xt=P,Et=V,gt=F;if(!g.isMounted)if(w)xt=Ie||P,Et=Ge||V,gt=Ze||F;else return;let Ft=!1;const At=We._enterCb=ei=>{Ft||(Ft=!0,ei?He(gt,[We]):He(Et,[We]),yt.delayedLeave&&yt.delayedLeave(),We._enterCb=void 0)};xt?(xt(We,At),xt.length<=1&&At()):At()},leave(We,xt){const Et=String(a.key);if(We._enterCb&&We._enterCb(!0),g.isUnmounting)return xt();He(R,[We]);let gt=!1;const Ft=We._leaveCb=At=>{gt||(gt=!0,xt(),At?He(oe,[We]):He(ne,[We]),We._leaveCb=void 0,ft[Et]===a&&delete ft[Et])};ft[Et]=a,$?($(We,Ft),$.length<=1&&Ft()):Ft()},clone(We){return Gm(We,d,g,A)}};return yt}function bm(a){if(Lp(a))return a=Ka(a),a.children=null,a}function $x(a){return Lp(a)?a.children?a.children[0]:void 0:a}function Zm(a,d){a.shapeFlag&6&&a.component?Zm(a.component.subTree,d):a.shapeFlag&128?(a.ssContent.transition=d.clone(a.ssContent),a.ssFallback.transition=d.clone(a.ssFallback)):a.transition=d}function B0(a,d=!1){let g=[],A=0;for(let w=0;w<a.length;w++){const I=a[w];I.type===ao?(I.patchFlag&128&&A++,g=g.concat(B0(I.children,d))):(d||I.type!==Xn)&&g.push(I)}if(A>1)for(let w=0;w<g.length;w++)g[w].patchFlag=-2;return g}function hr(a){return ai(a)?{setup:a,name:a.name}:a}const qm=a=>!!a.type.__asyncLoader,Lp=a=>a.type.__isKeepAlive;function q2(a,d){L0(a,"a",d)}function W2(a,d){L0(a,"da",d)}function L0(a,d,g=Fr){const A=a.__wdc||(a.__wdc=()=>{let w=g;for(;w;){if(w.isDeactivated)return;w=w.parent}return a()});if(Rp(d,A,g),g){let w=g.parent;for(;w&&w.parent;)Lp(w.parent.vnode)&&X2(A,d,g,w),w=w.parent}}function X2(a,d,g,A){const w=Rp(d,a,A,!0);uo(()=>{A_(A[d],w)},g)}function Rp(a,d,g=Fr,A=!1){if(g){const w=g[a]||(g[a]=[]),I=d.__weh||(d.__weh=(...z)=>{if(g.isUnmounted)return;bc(),ea(g);const o=Wn(d,g,a,z);return Js(),wc(),o});return A?w.unshift(I):w.push(I),I}}const cs=a=>(d,g=Fr)=>(!Ah||a==="sp")&&Rp(a,d,g),R0=cs("bm"),Kr=cs("m"),H2=cs("bu"),Q2=cs("u"),F_=cs("bum"),uo=cs("um"),Y2=cs("sp"),J2=cs("rtg"),K2=cs("rtc");function eE(a,d=Fr){Rp("ec",a,d)}let Wm=!0;function tE(a){const d=F0(a),g=a.proxy,A=a.ctx;Wm=!1,d.beforeCreate&&Gx(d.beforeCreate,a,"bc");const{data:w,computed:I,methods:z,watch:o,provide:P,inject:V,created:F,beforeMount:R,mounted:$,beforeUpdate:ne,updated:oe,activated:ve,deactivated:Ie,beforeDestroy:Ge,beforeUnmount:Ze,destroyed:st,unmounted:ft,render:He,renderTracked:yt,renderTriggered:We,errorCaptured:xt,serverPrefetch:Et,expose:gt,inheritAttrs:Ft,components:At,directives:ei,filters:ri}=d;if(V&&iE(V,A,null,a.appContext.config.unwrapInjectedRef),z)for(const fi in z){const Bt=z[fi];ai(Bt)&&(A[fi]=Bt.bind(g))}if(w){const fi=w.call(g,g);wr(fi)&&(a.data=Fo(fi))}if(Wm=!0,I)for(const fi in I){const Bt=I[fi],$i=ai(Bt)?Bt.bind(g,g):ai(Bt.get)?Bt.get.bind(g,g):co,lr=!ai(Bt)&&ai(Bt.set)?Bt.set.bind(g):co,Ur=Dt({get:$i,set:lr});Object.defineProperty(A,fi,{enumerable:!0,configurable:!0,get:()=>Ur.value,set:Ai=>Ur.value=Ai})}if(o)for(const fi in o)O0(o[fi],A,g,fi);if(P){const fi=ai(P)?P.call(g):P;Reflect.ownKeys(fi).forEach(Bt=>{Ar(Bt,fi[Bt])})}F&&Gx(F,a,"c");function vi(fi,Bt){Yt(Bt)?Bt.forEach($i=>fi($i.bind(g))):Bt&&fi(Bt.bind(g))}if(vi(R0,R),vi(Kr,$),vi(H2,ne),vi(Q2,oe),vi(q2,ve),vi(W2,Ie),vi(eE,xt),vi(K2,yt),vi(J2,We),vi(F_,Ze),vi(uo,ft),vi(Y2,Et),Yt(gt))if(gt.length){const fi=a.exposed||(a.exposed={});gt.forEach(Bt=>{Object.defineProperty(fi,Bt,{get:()=>g[Bt],set:$i=>g[Bt]=$i})})}else a.exposed||(a.exposed={});He&&a.render===co&&(a.render=He),Ft!=null&&(a.inheritAttrs=Ft),At&&(a.components=At),ei&&(a.directives=ei)}function iE(a,d,g=co,A=!1){Yt(a)&&(a=Xm(a));for(const w in a){const I=a[w];let z;wr(I)?"default"in I?z=ir(I.from||w,I.default,!0):z=ir(I.from||w):z=ir(I),ar(z)&&A?Object.defineProperty(d,w,{enumerable:!0,configurable:!0,get:()=>z.value,set:o=>z.value=o}):d[w]=z}}function Gx(a,d,g){Wn(Yt(a)?a.map(A=>A.bind(d.proxy)):a.bind(d.proxy),d,g)}function O0(a,d,g,A){const w=A.includes(".")?k0(g,A):()=>g[A];if(br(a)){const I=d[a];ai(I)&&An(w,I)}else if(ai(a))An(w,a.bind(g));else if(wr(a))if(Yt(a))a.forEach(I=>O0(I,d,g,A));else{const I=ai(a.handler)?a.handler.bind(g):d[a.handler];ai(I)&&An(w,I,a)}}function F0(a){const d=a.type,{mixins:g,extends:A}=d,{mixins:w,optionsCache:I,config:{optionMergeStrategies:z}}=a.appContext,o=I.get(d);let P;return o?P=o:!w.length&&!g&&!A?P=d:(P={},w.length&&w.forEach(V=>Ep(P,V,z,!0)),Ep(P,d,z)),I.set(d,P),P}function Ep(a,d,g,A=!1){const{mixins:w,extends:I}=d;I&&Ep(a,I,g,!0),w&&w.forEach(z=>Ep(a,z,g,!0));for(const z in d)if(!(A&&z==="expose")){const o=rE[z]||g&&g[z];a[z]=o?o(a[z],d[z]):d[z]}return a}const rE={data:Zx,props:Ha,emits:Ha,methods:Ha,computed:Ha,beforeCreate:ln,created:ln,beforeMount:ln,mounted:ln,beforeUpdate:ln,updated:ln,beforeDestroy:ln,beforeUnmount:ln,destroyed:ln,unmounted:ln,activated:ln,deactivated:ln,errorCaptured:ln,serverPrefetch:ln,components:Ha,directives:Ha,watch:oE,provide:Zx,inject:nE};function Zx(a,d){return d?a?function(){return Zr(ai(a)?a.call(this,this):a,ai(d)?d.call(this,this):d)}:d:a}function nE(a,d){return Ha(Xm(a),Xm(d))}function Xm(a){if(Yt(a)){const d={};for(let g=0;g<a.length;g++)d[a[g]]=a[g];return d}return a}function ln(a,d){return a?[...new Set([].concat(a,d))]:d}function Ha(a,d){return a?Zr(Zr(Object.create(null),a),d):d}function oE(a,d){if(!a)return d;if(!d)return a;const g=Zr(Object.create(null),a);for(const A in d)g[A]=ln(a[A],d[A]);return g}function sE(a,d,g,A=!1){const w={},I={};Ap(I,Op,1),a.propsDefaults=Object.create(null),U0(a,d,w,I);for(const z in a.propsOptions[0])z in w||(w[z]=void 0);g?a.props=A?w:g2(w):a.type.props?a.props=w:a.props=I,a.attrs=I}function aE(a,d,g,A){const{props:w,attrs:I,vnode:{patchFlag:z}}=a,o=Ri(w),[P]=a.propsOptions;let V=!1;if((A||z>0)&&!(z&16)){if(z&8){const F=a.vnode.dynamicProps;for(let R=0;R<F.length;R++){let $=F[R];const ne=d[$];if(P)if(Li(I,$))ne!==I[$]&&(I[$]=ne,V=!0);else{const oe=Oo($);w[oe]=Hm(P,o,oe,ne,a,!1)}else ne!==I[$]&&(I[$]=ne,V=!0)}}}else{U0(a,d,w,I)&&(V=!0);let F;for(const R in o)(!d||!Li(d,R)&&((F=Ac(R))===R||!Li(d,F)))&&(P?g&&(g[R]!==void 0||g[F]!==void 0)&&(w[R]=Hm(P,o,R,void 0,a,!0)):delete w[R]);if(I!==o)for(const R in I)(!d||!Li(d,R)&&!0)&&(delete I[R],V=!0)}V&&ls(a,"set","$attrs")}function U0(a,d,g,A){const[w,I]=a.propsOptions;let z=!1,o;if(d)for(let P in d){if(fp(P))continue;const V=d[P];let F;w&&Li(w,F=Oo(P))?!I||!I.includes(F)?g[F]=V:(o||(o={}))[F]=V:B_(a.emitsOptions,P)||(!(P in A)||V!==A[P])&&(A[P]=V,z=!0)}if(I){const P=Ri(g),V=o||tr;for(let F=0;F<I.length;F++){const R=I[F];g[R]=Hm(w,P,R,V[R],a,!Li(V,R))}}return z}function Hm(a,d,g,A,w,I){const z=a[g];if(z!=null){const o=Li(z,"default");if(o&&A===void 0){const P=z.default;if(z.type!==Function&&ai(P)){const{propsDefaults:V}=w;g in V?A=V[g]:(ea(w),A=V[g]=P.call(null,d),Js())}else A=P}z[0]&&(I&&!o?A=!1:z[1]&&(A===""||A===Ac(g))&&(A=!0))}return A}function V0(a,d,g=!1){const A=d.propsCache,w=A.get(a);if(w)return w;const I=a.props,z={},o=[];let P=!1;if(!ai(a)){const F=R=>{P=!0;const[$,ne]=V0(R,d,!0);Zr(z,$),ne&&o.push(...ne)};!g&&d.mixins.length&&d.mixins.forEach(F),a.extends&&F(a.extends),a.mixins&&a.mixins.forEach(F)}if(!I&&!P)return A.set(a,pc),pc;if(Yt(I))for(let F=0;F<I.length;F++){const R=Oo(I[F]);qx(R)&&(z[R]=tr)}else if(I)for(const F in I){const R=Oo(F);if(qx(R)){const $=I[F],ne=z[R]=Yt($)||ai($)?{type:$}:$;if(ne){const oe=Hx(Boolean,ne.type),ve=Hx(String,ne.type);ne[0]=oe>-1,ne[1]=ve<0||oe<ve,(oe>-1||Li(ne,"default"))&&o.push(R)}}}const V=[z,o];return A.set(a,V),V}function qx(a){return a[0]!=="$"}function Wx(a){const d=a&&a.toString().match(/^\s*function (\w+)/);return d?d[1]:a===null?"null":""}function Xx(a,d){return Wx(a)===Wx(d)}function Hx(a,d){return Yt(d)?d.findIndex(g=>Xx(g,a)):ai(d)&&Xx(d,a)?0:-1}const j0=a=>a[0]==="_"||a==="$stable",U_=a=>Yt(a)?a.map(lo):[lo(a)],lE=(a,d,g)=>{const A=k2((...w)=>U_(d(...w)),g);return A._c=!1,A},N0=(a,d,g)=>{const A=a._ctx;for(const w in a){if(j0(w))continue;const I=a[w];if(ai(I))d[w]=lE(w,I,A);else if(I!=null){const z=U_(I);d[w]=()=>z}}},$0=(a,d)=>{const g=U_(d);a.slots.default=()=>g},cE=(a,d)=>{if(a.vnode.shapeFlag&32){const g=d._;g?(a.slots=Ri(d),Ap(d,"_",g)):N0(d,a.slots={})}else a.slots={},d&&$0(a,d);Ap(a.slots,Op,1)},uE=(a,d,g)=>{const{vnode:A,slots:w}=a;let I=!0,z=tr;if(A.shapeFlag&32){const o=d._;o?g&&o===1?I=!1:(Zr(w,d),!g&&o===1&&delete w._):(I=!d.$stable,N0(d,w)),z=d}else d&&($0(a,d),z={default:1});if(I)for(const o in w)!j0(o)&&!(o in z)&&delete w[o]};function QC(a,d){const g=qn;if(g===null)return a;const A=g.proxy,w=a.dirs||(a.dirs=[]);for(let I=0;I<d.length;I++){let[z,o,P,V=tr]=d[I];ai(z)&&(z={mounted:z,updated:z}),z.deep&&Ya(o),w.push({dir:z,instance:A,value:o,oldValue:void 0,arg:P,modifiers:V})}return a}function Za(a,d,g,A){const w=a.dirs,I=d&&d.dirs;for(let z=0;z<w.length;z++){const o=w[z];I&&(o.oldValue=I[z].value);let P=o.dir[A];P&&(bc(),Wn(P,g,8,[a.el,o,a,d]),wc())}}function G0(){return{app:null,config:{isNativeTag:Fw,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hE=0;function dE(a,d){return function(A,w=null){w!=null&&!wr(w)&&(w=null);const I=G0(),z=new Set;let o=!1;const P=I.app={_uid:hE++,_component:A,_props:w,_container:null,_context:I,_instance:null,version:LE,get config(){return I.config},set config(V){},use(V,...F){return z.has(V)||(V&&ai(V.install)?(z.add(V),V.install(P,...F)):ai(V)&&(z.add(V),V(P,...F))),P},mixin(V){return I.mixins.includes(V)||I.mixins.push(V),P},component(V,F){return F?(I.components[V]=F,P):I.components[V]},directive(V,F){return F?(I.directives[V]=F,P):I.directives[V]},mount(V,F,R){if(!o){const $=Wi(A,w);return $.appContext=I,F&&d?d($,V):a($,V,R),o=!0,P._container=V,V.__vue_app__=P,$_($.component)||$.component.proxy}},unmount(){o&&(a(null,P._container),delete P._container.__vue_app__)},provide(V,F){return I.provides[V]=F,P}};return P}}function Qm(a,d,g,A,w=!1){if(Yt(a)){a.forEach(($,ne)=>Qm($,d&&(Yt(d)?d[ne]:d),g,A,w));return}if(qm(A)&&!w)return;const I=A.shapeFlag&4?$_(A.component)||A.component.proxy:A.el,z=w?null:I,{i:o,r:P}=a,V=d&&d.r,F=o.refs===tr?o.refs={}:o.refs,R=o.setupState;if(V!=null&&V!==P&&(br(V)?(F[V]=null,Li(R,V)&&(R[V]=null)):ar(V)&&(V.value=null)),ai(P))Qs(P,o,12,[z,F]);else{const $=br(P),ne=ar(P);if($||ne){const oe=()=>{if(a.f){const ve=$?F[P]:P.value;w?Yt(ve)&&A_(ve,I):Yt(ve)?ve.includes(I)||ve.push(I):$?F[P]=[I]:(P.value=[I],a.k&&(F[a.k]=P.value))}else $?(F[P]=z,Li(R,P)&&(R[P]=z)):ar(P)&&(P.value=z,a.k&&(F[a.k]=z))};z?(oe.id=-1,vn(oe,g)):oe()}}}const vn=N2;function pE(a){return fE(a)}function fE(a,d){const g=Gw();g.__VUE__=!0;const{insert:A,remove:w,patchProp:I,createElement:z,createText:o,createComment:P,setText:V,setElementText:F,parentNode:R,nextSibling:$,setScopeId:ne=co,cloneNode:oe,insertStaticContent:ve}=a,Ie=(ce,_e,ke,Qe=null,Xe=null,rt=null,vt=!1,Ue=null,lt=!!_e.dynamicChildren)=>{if(ce===_e)return;ce&&!Lo(ce,_e)&&(Qe=kt(ce),Oi(ce,Xe,rt,!0),ce=null),_e.patchFlag===-2&&(lt=!1,_e.dynamicChildren=null);const{type:tt,ref:zt,shapeFlag:St}=_e;switch(tt){case j_:Ge(ce,_e,ke,Qe);break;case Xn:Ze(ce,_e,ke,Qe);break;case _p:ce==null&&st(_e,ke,Qe,vt);break;case ao:ei(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt);break;default:St&1?yt(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt):St&6?ri(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt):(St&64||St&128)&&tt.process(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt,yi)}zt!=null&&Xe&&Qm(zt,ce&&ce.ref,rt,_e||ce,!_e)},Ge=(ce,_e,ke,Qe)=>{if(ce==null)A(_e.el=o(_e.children),ke,Qe);else{const Xe=_e.el=ce.el;_e.children!==ce.children&&V(Xe,_e.children)}},Ze=(ce,_e,ke,Qe)=>{ce==null?A(_e.el=P(_e.children||""),ke,Qe):_e.el=ce.el},st=(ce,_e,ke,Qe)=>{[ce.el,ce.anchor]=ve(ce.children,_e,ke,Qe,ce.el,ce.anchor)},ft=({el:ce,anchor:_e},ke,Qe)=>{let Xe;for(;ce&&ce!==_e;)Xe=$(ce),A(ce,ke,Qe),ce=Xe;A(_e,ke,Qe)},He=({el:ce,anchor:_e})=>{let ke;for(;ce&&ce!==_e;)ke=$(ce),w(ce),ce=ke;w(_e)},yt=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt)=>{vt=vt||_e.type==="svg",ce==null?We(_e,ke,Qe,Xe,rt,vt,Ue,lt):gt(ce,_e,Xe,rt,vt,Ue,lt)},We=(ce,_e,ke,Qe,Xe,rt,vt,Ue)=>{let lt,tt;const{type:zt,props:St,shapeFlag:Rt,transition:Gt,patchFlag:li,dirs:di}=ce;if(ce.el&&oe!==void 0&&li===-1)lt=ce.el=oe(ce.el);else{if(lt=ce.el=z(ce.type,rt,St&&St.is,St),Rt&8?F(lt,ce.children):Rt&16&&Et(ce.children,lt,null,Qe,Xe,rt&&zt!=="foreignObject",vt,Ue),di&&Za(ce,null,Qe,"created"),St){for(const Ti in St)Ti!=="value"&&!fp(Ti)&&I(lt,Ti,null,St[Ti],rt,ce.children,Qe,Xe,ut);"value"in St&&I(lt,"value",null,St.value),(tt=St.onVnodeBeforeMount)&&Bo(tt,Qe,ce)}xt(lt,ce,ce.scopeId,vt,Qe)}di&&Za(ce,null,Qe,"beforeMount");const pi=(!Xe||Xe&&!Xe.pendingBranch)&&Gt&&!Gt.persisted;pi&&Gt.beforeEnter(lt),A(lt,_e,ke),((tt=St&&St.onVnodeMounted)||pi||di)&&vn(()=>{tt&&Bo(tt,Qe,ce),pi&&Gt.enter(lt),di&&Za(ce,null,Qe,"mounted")},Xe)},xt=(ce,_e,ke,Qe,Xe)=>{if(ke&&ne(ce,ke),Qe)for(let rt=0;rt<Qe.length;rt++)ne(ce,Qe[rt]);if(Xe){let rt=Xe.subTree;if(_e===rt){const vt=Xe.vnode;xt(ce,vt,vt.scopeId,vt.slotScopeIds,Xe.parent)}}},Et=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt=0)=>{for(let tt=lt;tt<ce.length;tt++){const zt=ce[tt]=Ue?qs(ce[tt]):lo(ce[tt]);Ie(null,zt,_e,ke,Qe,Xe,rt,vt,Ue)}},gt=(ce,_e,ke,Qe,Xe,rt,vt)=>{const Ue=_e.el=ce.el;let{patchFlag:lt,dynamicChildren:tt,dirs:zt}=_e;lt|=ce.patchFlag&16;const St=ce.props||tr,Rt=_e.props||tr;let Gt;ke&&qa(ke,!1),(Gt=Rt.onVnodeBeforeUpdate)&&Bo(Gt,ke,_e,ce),zt&&Za(_e,ce,ke,"beforeUpdate"),ke&&qa(ke,!0);const li=Xe&&_e.type!=="foreignObject";if(tt?Ft(ce.dynamicChildren,tt,Ue,ke,Qe,li,rt):vt||$i(ce,_e,Ue,null,ke,Qe,li,rt,!1),lt>0){if(lt&16)At(Ue,_e,St,Rt,ke,Qe,Xe);else if(lt&2&&St.class!==Rt.class&&I(Ue,"class",null,Rt.class,Xe),lt&4&&I(Ue,"style",St.style,Rt.style,Xe),lt&8){const di=_e.dynamicProps;for(let pi=0;pi<di.length;pi++){const Ti=di[pi],zr=St[Ti],fr=Rt[Ti];(fr!==zr||Ti==="value")&&I(Ue,Ti,zr,fr,Xe,ce.children,ke,Qe,ut)}}lt&1&&ce.children!==_e.children&&F(Ue,_e.children)}else!vt&&tt==null&&At(Ue,_e,St,Rt,ke,Qe,Xe);((Gt=Rt.onVnodeUpdated)||zt)&&vn(()=>{Gt&&Bo(Gt,ke,_e,ce),zt&&Za(_e,ce,ke,"updated")},Qe)},Ft=(ce,_e,ke,Qe,Xe,rt,vt)=>{for(let Ue=0;Ue<_e.length;Ue++){const lt=ce[Ue],tt=_e[Ue],zt=lt.el&&(lt.type===ao||!Lo(lt,tt)||lt.shapeFlag&70)?R(lt.el):ke;Ie(lt,tt,zt,null,Qe,Xe,rt,vt,!0)}},At=(ce,_e,ke,Qe,Xe,rt,vt)=>{if(ke!==Qe){for(const Ue in Qe){if(fp(Ue))continue;const lt=Qe[Ue],tt=ke[Ue];lt!==tt&&Ue!=="value"&&I(ce,Ue,tt,lt,vt,_e.children,Xe,rt,ut)}if(ke!==tr)for(const Ue in ke)!fp(Ue)&&!(Ue in Qe)&&I(ce,Ue,ke[Ue],null,vt,_e.children,Xe,rt,ut);"value"in Qe&&I(ce,"value",ke.value,Qe.value)}},ei=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt)=>{const tt=_e.el=ce?ce.el:o(""),zt=_e.anchor=ce?ce.anchor:o("");let{patchFlag:St,dynamicChildren:Rt,slotScopeIds:Gt}=_e;Gt&&(Ue=Ue?Ue.concat(Gt):Gt),ce==null?(A(tt,ke,Qe),A(zt,ke,Qe),Et(_e.children,ke,zt,Xe,rt,vt,Ue,lt)):St>0&&St&64&&Rt&&ce.dynamicChildren?(Ft(ce.dynamicChildren,Rt,ke,Xe,rt,vt,Ue),(_e.key!=null||Xe&&_e===Xe.subTree)&&V_(ce,_e,!0)):$i(ce,_e,ke,zt,Xe,rt,vt,Ue,lt)},ri=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt)=>{_e.slotScopeIds=Ue,ce==null?_e.shapeFlag&512?Xe.ctx.activate(_e,ke,Qe,vt,lt):Er(_e,ke,Qe,Xe,rt,vt,lt):vi(ce,_e,lt)},Er=(ce,_e,ke,Qe,Xe,rt,vt)=>{const Ue=ce.component=CE(ce,Qe,Xe);if(Lp(ce)&&(Ue.ctx.renderer=yi),ME(Ue),Ue.asyncDep){if(Xe&&Xe.registerDep(Ue,fi),!ce.el){const lt=Ue.subTree=Wi(Xn);Ze(null,lt,_e,ke)}return}fi(Ue,ce,_e,ke,Xe,rt,vt)},vi=(ce,_e,ke)=>{const Qe=_e.component=ce.component;if(L2(ce,_e,ke))if(Qe.asyncDep&&!Qe.asyncResolved){Bt(Qe,_e,ke);return}else Qe.next=_e,C2(Qe.update),Qe.update();else _e.component=ce.component,_e.el=ce.el,Qe.vnode=_e},fi=(ce,_e,ke,Qe,Xe,rt,vt)=>{const Ue=()=>{if(ce.isMounted){let{next:zt,bu:St,u:Rt,parent:Gt,vnode:li}=ce,di=zt,pi;qa(ce,!1),zt?(zt.el=li.el,Bt(ce,zt,vt)):zt=li,St&&mp(St),(pi=zt.props&&zt.props.onVnodeBeforeUpdate)&&Bo(pi,Gt,zt,li),qa(ce,!0);const Ti=Am(ce),zr=ce.subTree;ce.subTree=Ti,Ie(zr,Ti,R(zr.el),kt(zr),ce,Xe,rt),zt.el=Ti.el,di===null&&L_(ce,Ti.el),Rt&&vn(Rt,Xe),(pi=zt.props&&zt.props.onVnodeUpdated)&&vn(()=>Bo(pi,Gt,zt,li),Xe)}else{let zt;const{el:St,props:Rt}=_e,{bm:Gt,m:li,parent:di}=ce,pi=qm(_e);if(qa(ce,!1),Gt&&mp(Gt),!pi&&(zt=Rt&&Rt.onVnodeBeforeMount)&&Bo(zt,di,_e),qa(ce,!0),St&&qt){const Ti=()=>{ce.subTree=Am(ce),qt(St,ce.subTree,ce,Xe,null)};pi?_e.type.__asyncLoader().then(()=>!ce.isUnmounted&&Ti()):Ti()}else{const Ti=ce.subTree=Am(ce);Ie(null,Ti,ke,Qe,ce,Xe,rt),_e.el=Ti.el}if(li&&vn(li,Xe),!pi&&(zt=Rt&&Rt.onVnodeMounted)){const Ti=_e;vn(()=>Bo(zt,di,Ti),Xe)}_e.shapeFlag&256&&ce.a&&vn(ce.a,Xe),ce.isMounted=!0,_e=ke=Qe=null}},lt=ce.effect=new S_(Ue,()=>w0(ce.update),ce.scope),tt=ce.update=lt.run.bind(lt);tt.id=ce.uid,qa(ce,!0),tt()},Bt=(ce,_e,ke)=>{_e.component=ce;const Qe=ce.vnode.props;ce.vnode=_e,ce.next=null,aE(ce,_e.props,Qe,ke),uE(ce,_e.children,ke),bc(),D_(void 0,ce.update),wc()},$i=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt=!1)=>{const tt=ce&&ce.children,zt=ce?ce.shapeFlag:0,St=_e.children,{patchFlag:Rt,shapeFlag:Gt}=_e;if(Rt>0){if(Rt&128){Ur(tt,St,ke,Qe,Xe,rt,vt,Ue,lt);return}else if(Rt&256){lr(tt,St,ke,Qe,Xe,rt,vt,Ue,lt);return}}Gt&8?(zt&16&&ut(tt,Xe,rt),St!==tt&&F(ke,St)):zt&16?Gt&16?Ur(tt,St,ke,Qe,Xe,rt,vt,Ue,lt):ut(tt,Xe,rt,!0):(zt&8&&F(ke,""),Gt&16&&Et(St,ke,Qe,Xe,rt,vt,Ue,lt))},lr=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt)=>{ce=ce||pc,_e=_e||pc;const tt=ce.length,zt=_e.length,St=Math.min(tt,zt);let Rt;for(Rt=0;Rt<St;Rt++){const Gt=_e[Rt]=lt?qs(_e[Rt]):lo(_e[Rt]);Ie(ce[Rt],Gt,ke,null,Xe,rt,vt,Ue,lt)}tt>zt?ut(ce,Xe,rt,!0,!1,St):Et(_e,ke,Qe,Xe,rt,vt,Ue,lt,St)},Ur=(ce,_e,ke,Qe,Xe,rt,vt,Ue,lt)=>{let tt=0;const zt=_e.length;let St=ce.length-1,Rt=zt-1;for(;tt<=St&&tt<=Rt;){const Gt=ce[tt],li=_e[tt]=lt?qs(_e[tt]):lo(_e[tt]);if(Lo(Gt,li))Ie(Gt,li,ke,null,Xe,rt,vt,Ue,lt);else break;tt++}for(;tt<=St&&tt<=Rt;){const Gt=ce[St],li=_e[Rt]=lt?qs(_e[Rt]):lo(_e[Rt]);if(Lo(Gt,li))Ie(Gt,li,ke,null,Xe,rt,vt,Ue,lt);else break;St--,Rt--}if(tt>St){if(tt<=Rt){const Gt=Rt+1,li=Gt<zt?_e[Gt].el:Qe;for(;tt<=Rt;)Ie(null,_e[tt]=lt?qs(_e[tt]):lo(_e[tt]),ke,li,Xe,rt,vt,Ue,lt),tt++}}else if(tt>Rt)for(;tt<=St;)Oi(ce[tt],Xe,rt,!0),tt++;else{const Gt=tt,li=tt,di=new Map;for(tt=li;tt<=Rt;tt++){const gr=_e[tt]=lt?qs(_e[tt]):lo(_e[tt]);gr.key!=null&&di.set(gr.key,tt)}let pi,Ti=0;const zr=Rt-li+1;let fr=!1,hn=0;const Un=new Array(zr);for(tt=0;tt<zr;tt++)Un[tt]=0;for(tt=Gt;tt<=St;tt++){const gr=ce[tt];if(Ti>=zr){Oi(gr,Xe,rt,!0);continue}let kr;if(gr.key!=null)kr=di.get(gr.key);else for(pi=li;pi<=Rt;pi++)if(Un[pi-li]===0&&Lo(gr,_e[pi])){kr=pi;break}kr===void 0?Oi(gr,Xe,rt,!0):(Un[kr-li]=tt+1,kr>=hn?hn=kr:fr=!0,Ie(gr,_e[kr],ke,null,Xe,rt,vt,Ue,lt),Ti++)}const ho=fr?mE(Un):pc;for(pi=ho.length-1,tt=zr-1;tt>=0;tt--){const gr=li+tt,kr=_e[gr],po=gr+1<zt?_e[gr+1].el:Qe;Un[tt]===0?Ie(null,kr,ke,po,Xe,rt,vt,Ue,lt):fr&&(pi<0||tt!==ho[pi]?Ai(kr,ke,po,2):pi--)}}},Ai=(ce,_e,ke,Qe,Xe=null)=>{const{el:rt,type:vt,transition:Ue,children:lt,shapeFlag:tt}=ce;if(tt&6){Ai(ce.component.subTree,_e,ke,Qe);return}if(tt&128){ce.suspense.move(_e,ke,Qe);return}if(tt&64){vt.move(ce,_e,ke,yi);return}if(vt===ao){A(rt,_e,ke);for(let St=0;St<lt.length;St++)Ai(lt[St],_e,ke,Qe);A(ce.anchor,_e,ke);return}if(vt===_p){ft(ce,_e,ke);return}if(Qe!==2&&tt&1&&Ue)if(Qe===0)Ue.beforeEnter(rt),A(rt,_e,ke),vn(()=>Ue.enter(rt),Xe);else{const{leave:St,delayLeave:Rt,afterLeave:Gt}=Ue,li=()=>A(rt,_e,ke),di=()=>{St(rt,()=>{li(),Gt&&Gt()})};Rt?Rt(rt,li,di):di()}else A(rt,_e,ke)},Oi=(ce,_e,ke,Qe=!1,Xe=!1)=>{const{type:rt,props:vt,ref:Ue,children:lt,dynamicChildren:tt,shapeFlag:zt,patchFlag:St,dirs:Rt}=ce;if(Ue!=null&&Qm(Ue,null,ke,ce,!0),zt&256){_e.ctx.deactivate(ce);return}const Gt=zt&1&&Rt,li=!qm(ce);let di;if(li&&(di=vt&&vt.onVnodeBeforeUnmount)&&Bo(di,_e,ce),zt&6)Tt(ce.component,ke,Qe);else{if(zt&128){ce.suspense.unmount(ke,Qe);return}Gt&&Za(ce,null,_e,"beforeUnmount"),zt&64?ce.type.remove(ce,_e,ke,Xe,yi,Qe):tt&&(rt!==ao||St>0&&St&64)?ut(tt,_e,ke,!1,!0):(rt===ao&&St&384||!Xe&&zt&16)&&ut(lt,_e,ke),Qe&&tn(ce)}(li&&(di=vt&&vt.onVnodeUnmounted)||Gt)&&vn(()=>{di&&Bo(di,_e,ce),Gt&&Za(ce,null,_e,"unmounted")},ke)},tn=ce=>{const{type:_e,el:ke,anchor:Qe,transition:Xe}=ce;if(_e===ao){$e(ke,Qe);return}if(_e===_p){He(ce);return}const rt=()=>{w(ke),Xe&&!Xe.persisted&&Xe.afterLeave&&Xe.afterLeave()};if(ce.shapeFlag&1&&Xe&&!Xe.persisted){const{leave:vt,delayLeave:Ue}=Xe,lt=()=>vt(ke,rt);Ue?Ue(ce.el,rt,lt):lt()}else rt()},$e=(ce,_e)=>{let ke;for(;ce!==_e;)ke=$(ce),w(ce),ce=ke;w(_e)},Tt=(ce,_e,ke)=>{const{bum:Qe,scope:Xe,update:rt,subTree:vt,um:Ue}=ce;Qe&&mp(Qe),Xe.stop(),rt&&(rt.active=!1,Oi(vt,ce,_e,ke)),Ue&&vn(Ue,_e),vn(()=>{ce.isUnmounted=!0},_e),_e&&_e.pendingBranch&&!_e.isUnmounted&&ce.asyncDep&&!ce.asyncResolved&&ce.suspenseId===_e.pendingId&&(_e.deps--,_e.deps===0&&_e.resolve())},ut=(ce,_e,ke,Qe=!1,Xe=!1,rt=0)=>{for(let vt=rt;vt<ce.length;vt++)Oi(ce[vt],_e,ke,Qe,Xe)},kt=ce=>ce.shapeFlag&6?kt(ce.component.subTree):ce.shapeFlag&128?ce.suspense.next():$(ce.anchor||ce.el),Ei=(ce,_e,ke)=>{ce==null?_e._vnode&&Oi(_e._vnode,null,null,!0):Ie(_e._vnode||null,ce,_e,null,null,null,ke),I0(),_e._vnode=ce},yi={p:Ie,um:Oi,m:Ai,r:tn,mt:Er,mc:Et,pc:$i,pbc:Ft,n:kt,o:a};let ni,qt;return d&&([ni,qt]=d(yi)),{render:Ei,hydrate:ni,createApp:dE(Ei,ni)}}function qa({effect:a,update:d},g){a.allowRecurse=d.allowRecurse=g}function V_(a,d,g=!1){const A=a.children,w=d.children;if(Yt(A)&&Yt(w))for(let I=0;I<A.length;I++){const z=A[I];let o=w[I];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=w[I]=qs(w[I]),o.el=z.el),g||V_(z,o))}}function mE(a){const d=a.slice(),g=[0];let A,w,I,z,o;const P=a.length;for(A=0;A<P;A++){const V=a[A];if(V!==0){if(w=g[g.length-1],a[w]<V){d[A]=w,g.push(A);continue}for(I=0,z=g.length-1;I<z;)o=I+z>>1,a[g[o]]<V?I=o+1:z=o;V<a[g[I]]&&(I>0&&(d[A]=g[I-1]),g[I]=A)}}for(I=g.length,z=g[I-1];I-- >0;)g[I]=z,z=d[z];return g}const _E=a=>a.__isTeleport,uh=a=>a&&(a.disabled||a.disabled===""),Qx=a=>typeof SVGElement!="undefined"&&a instanceof SVGElement,Ym=(a,d)=>{const g=a&&a.to;return br(g)?d?d(g):null:g},gE={__isTeleport:!0,process(a,d,g,A,w,I,z,o,P,V){const{mc:F,pc:R,pbc:$,o:{insert:ne,querySelector:oe,createText:ve,createComment:Ie}}=V,Ge=uh(d.props);let{shapeFlag:Ze,children:st,dynamicChildren:ft}=d;if(a==null){const He=d.el=ve(""),yt=d.anchor=ve("");ne(He,g,A),ne(yt,g,A);const We=d.target=Ym(d.props,oe),xt=d.targetAnchor=ve("");We&&(ne(xt,We),z=z||Qx(We));const Et=(gt,Ft)=>{Ze&16&&F(st,gt,Ft,w,I,z,o,P)};Ge?Et(g,yt):We&&Et(We,xt)}else{d.el=a.el;const He=d.anchor=a.anchor,yt=d.target=a.target,We=d.targetAnchor=a.targetAnchor,xt=uh(a.props),Et=xt?g:yt,gt=xt?He:We;if(z=z||Qx(yt),ft?($(a.dynamicChildren,ft,Et,w,I,z,o),V_(a,d,!0)):P||R(a,d,Et,gt,w,I,z,o,!1),Ge)xt||lp(d,g,He,V,1);else if((d.props&&d.props.to)!==(a.props&&a.props.to)){const Ft=d.target=Ym(d.props,oe);Ft&&lp(d,Ft,null,V,0)}else xt&&lp(d,yt,We,V,1)}},remove(a,d,g,A,{um:w,o:{remove:I}},z){const{shapeFlag:o,children:P,anchor:V,targetAnchor:F,target:R,props:$}=a;if(R&&I(F),(z||!uh($))&&(I(V),o&16))for(let ne=0;ne<P.length;ne++){const oe=P[ne];w(oe,d,g,!0,!!oe.dynamicChildren)}},move:lp,hydrate:yE};function lp(a,d,g,{o:{insert:A},m:w},I=2){I===0&&A(a.targetAnchor,d,g);const{el:z,anchor:o,shapeFlag:P,children:V,props:F}=a,R=I===2;if(R&&A(z,d,g),(!R||uh(F))&&P&16)for(let $=0;$<V.length;$++)w(V[$],d,g,2);R&&A(o,d,g)}function yE(a,d,g,A,w,I,{o:{nextSibling:z,parentNode:o,querySelector:P}},V){const F=d.target=Ym(d.props,P);if(F){const R=F._lpa||F.firstChild;d.shapeFlag&16&&(uh(d.props)?(d.anchor=V(z(a),d,o(a),g,A,w,I),d.targetAnchor=R):(d.anchor=z(a),d.targetAnchor=V(R,d,F,g,A,w,I)),F._lpa=d.targetAnchor&&z(d.targetAnchor))}return d.anchor&&z(d.anchor)}const xE=gE,Z0="components",q0=Symbol();function YC(a){return br(a)?vE(Z0,a,!1)||a:a||q0}function vE(a,d,g=!0,A=!1){const w=qn||Fr;if(w){const I=w.type;if(a===Z0){const o=DE(I);if(o&&(o===d||o===Oo(d)||o===Dp(Oo(d))))return I}const z=Yx(w[a]||I[a],d)||Yx(w.appContext[a],d);return!z&&A?I:z}}function Yx(a,d){return a&&(a[d]||a[Oo(d)]||a[Dp(Oo(d))])}const ao=Symbol(void 0),j_=Symbol(void 0),Xn=Symbol(void 0),_p=Symbol(void 0),hh=[];let Ys=null;function en(a=!1){hh.push(Ys=a?null:[])}function W0(){hh.pop(),Ys=hh[hh.length-1]||null}let vh=1;function Jx(a){vh+=a}function X0(a){return a.dynamicChildren=vh>0?Ys||pc:null,W0(),vh>0&&Ys&&Ys.push(a),a}function JC(a,d,g,A,w,I){return X0(Q0(a,d,g,A,w,I,!0))}function un(a,d,g,A,w){return X0(Wi(a,d,g,A,w,!0))}function Tp(a){return a?a.__v_isVNode===!0:!1}function Lo(a,d){return a.type===d.type&&a.key===d.key}const Op="__vInternal",H0=({key:a})=>a!=null?a:null,gp=({ref:a,ref_key:d,ref_for:g})=>a!=null?br(a)||ar(a)||ai(a)?{i:qn,r:a,k:d,f:!!g}:a:null;function Q0(a,d=null,g=null,A=0,w=null,I=a===ao?0:1,z=!1,o=!1){const P={__v_isVNode:!0,__v_skip:!0,type:a,props:d,key:d&&H0(d),ref:d&&gp(d),scopeId:z0,slotScopeIds:null,children:g,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:I,patchFlag:A,dynamicProps:w,dynamicChildren:null,appContext:null};return o?(N_(P,g),I&128&&a.normalize(P)):g&&(P.shapeFlag|=br(g)?8:16),vh>0&&!z&&Ys&&(P.patchFlag>0||I&6)&&P.patchFlag!==32&&Ys.push(P),P}const Wi=AE;function AE(a,d=null,g=null,A=0,w=null,I=!1){if((!a||a===q0)&&(a=Xn),Tp(a)){const o=Ka(a,d,!0);return g&&N_(o,g),o}if(BE(a)&&(a=a.__vccOpts),d){d=bE(d);let{class:o,style:P}=d;o&&!br(o)&&(d.class=x_(o)),wr(P)&&(g0(P)&&!Yt(P)&&(P=Zr({},P)),d.style=y_(P))}const z=br(a)?1:R2(a)?128:_E(a)?64:wr(a)?4:ai(a)?2:0;return Q0(a,d,g,A,w,z,I,!0)}function bE(a){return a?g0(a)||Op in a?Zr({},a):a:null}function Ka(a,d,g=!1){const{props:A,ref:w,patchFlag:I,children:z}=a,o=d?EE(A||{},d):A;return{__v_isVNode:!0,__v_skip:!0,type:a.type,props:o,key:o&&H0(o),ref:d&&d.ref?g&&w?Yt(w)?w.concat(gp(d)):[w,gp(d)]:gp(d):w,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:z,target:a.target,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:d&&a.type!==ao?I===-1?16:I|16:I,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:a.transition,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&Ka(a.ssContent),ssFallback:a.ssFallback&&Ka(a.ssFallback),el:a.el,anchor:a.anchor}}function wE(a=" ",d=0){return Wi(j_,null,a,d)}function KC(a,d){const g=Wi(_p,null,a);return g.staticCount=d,g}function eM(a="",d=!1){return d?(en(),un(Xn,null,a)):Wi(Xn,null,a)}function lo(a){return a==null||typeof a=="boolean"?Wi(Xn):Yt(a)?Wi(ao,null,a.slice()):typeof a=="object"?qs(a):Wi(j_,null,String(a))}function qs(a){return a.el===null||a.memo?a:Ka(a)}function N_(a,d){let g=0;const{shapeFlag:A}=a;if(d==null)d=null;else if(Yt(d))g=16;else if(typeof d=="object")if(A&65){const w=d.default;w&&(w._c&&(w._d=!1),N_(a,w()),w._c&&(w._d=!0));return}else{g=32;const w=d._;!w&&!(Op in d)?d._ctx=qn:w===3&&qn&&(qn.slots._===1?d._=1:(d._=2,a.patchFlag|=1024))}else ai(d)?(d={default:d,_ctx:qn},g=32):(d=String(d),A&64?(g=16,d=[wE(d)]):g=8);a.children=d,a.shapeFlag|=g}function EE(...a){const d={};for(let g=0;g<a.length;g++){const A=a[g];for(const w in A)if(w==="class")d.class!==A.class&&(d.class=x_([d.class,A.class]));else if(w==="style")d.style=y_([d.style,A.style]);else if(zp(w)){const I=d[w],z=A[w];z&&I!==z&&!(Yt(I)&&I.includes(z))&&(d[w]=I?[].concat(I,z):z)}else w!==""&&(d[w]=A[w])}return d}function Bo(a,d,g,A=null){Wn(a,d,7,[g,A])}function tM(a,d,g,A){let w;const I=g&&g[A];if(Yt(a)||br(a)){w=new Array(a.length);for(let z=0,o=a.length;z<o;z++)w[z]=d(a[z],z,void 0,I&&I[z])}else if(typeof a=="number"){w=new Array(a);for(let z=0;z<a;z++)w[z]=d(z+1,z,void 0,I&&I[z])}else if(wr(a))if(a[Symbol.iterator])w=Array.from(a,(z,o)=>d(z,o,void 0,I&&I[o]));else{const z=Object.keys(a);w=new Array(z.length);for(let o=0,P=z.length;o<P;o++){const V=z[o];w[o]=d(a[V],V,o,I&&I[o])}}else w=[];return g&&(g[A]=w),w}const Jm=a=>a?Y0(a)?$_(a)||a.proxy:Jm(a.parent):null,Sp=Zr(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>Jm(a.parent),$root:a=>Jm(a.root),$emit:a=>a.emit,$options:a=>F0(a),$forceUpdate:a=>()=>w0(a.update),$nextTick:a=>Ln.bind(a.proxy),$watch:a=>$2.bind(a)}),TE={get({_:a},d){const{ctx:g,setupState:A,data:w,props:I,accessCache:z,type:o,appContext:P}=a;let V;if(d[0]!=="$"){const ne=z[d];if(ne!==void 0)switch(ne){case 1:return A[d];case 2:return w[d];case 4:return g[d];case 3:return I[d]}else{if(A!==tr&&Li(A,d))return z[d]=1,A[d];if(w!==tr&&Li(w,d))return z[d]=2,w[d];if((V=a.propsOptions[0])&&Li(V,d))return z[d]=3,I[d];if(g!==tr&&Li(g,d))return z[d]=4,g[d];Wm&&(z[d]=0)}}const F=Sp[d];let R,$;if(F)return d==="$attrs"&&On(a,"get",d),F(a);if((R=o.__cssModules)&&(R=R[d]))return R;if(g!==tr&&Li(g,d))return z[d]=4,g[d];if($=P.config.globalProperties,Li($,d))return $[d]},set({_:a},d,g){const{data:A,setupState:w,ctx:I}=a;return w!==tr&&Li(w,d)?(w[d]=g,!0):A!==tr&&Li(A,d)?(A[d]=g,!0):Li(a.props,d)||d[0]==="$"&&d.slice(1)in a?!1:(I[d]=g,!0)},has({_:{data:a,setupState:d,accessCache:g,ctx:A,appContext:w,propsOptions:I}},z){let o;return!!g[z]||a!==tr&&Li(a,z)||d!==tr&&Li(d,z)||(o=I[0])&&Li(o,z)||Li(A,z)||Li(Sp,z)||Li(w.config.globalProperties,z)},defineProperty(a,d,g){return g.get!=null?this.set(a,d,g.get(),null):g.value!=null&&this.set(a,d,g.value,null),Reflect.defineProperty(a,d,g)}},SE=G0();let IE=0;function CE(a,d,g){const A=a.type,w=(d?d.appContext:a.appContext)||SE,I={uid:IE++,vnode:a,type:A,parent:d,appContext:w,root:null,next:null,subTree:null,effect:null,update:null,scope:new r0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(w.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:V0(A,w),emitsOptions:M0(A,w),emit:null,emitted:null,propsDefaults:tr,inheritAttrs:A.inheritAttrs,ctx:tr,data:tr,props:tr,attrs:tr,slots:tr,refs:tr,setupState:tr,setupContext:null,suspense:g,suspenseId:g?g.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return I.ctx={_:I},I.root=d?d.root:I,I.emit=z2.bind(null,I),a.ce&&a.ce(I),I}let Fr=null;const Eh=()=>Fr||qn,ea=a=>{Fr=a,a.scope.on()},Js=()=>{Fr&&Fr.scope.off(),Fr=null};function Y0(a){return a.vnode.shapeFlag&4}let Ah=!1;function ME(a,d=!1){Ah=d;const{props:g,children:A}=a.vnode,w=Y0(a);sE(a,g,w,d),cE(a,A);const I=w?zE(a,d):void 0;return Ah=!1,I}function zE(a,d){const g=a.type;a.accessCache=Object.create(null),a.proxy=gc(new Proxy(a.ctx,TE));const{setup:A}=g;if(A){const w=a.setupContext=A.length>1?PE(a):null;ea(a),bc();const I=Qs(A,a,0,[a.props,w]);if(wc(),Js(),w_(I)){if(I.then(Js,Js),d)return I.then(z=>{Km(a,z,d)}).catch(z=>{wh(z,a,0)});a.asyncDep=I}else Km(a,I,d)}else J0(a,d)}function Km(a,d,g){ai(d)?a.type.__ssrInlineRender?a.ssrRender=d:a.render=d:wr(d)&&(a.setupState=A0(d)),J0(a,g)}let Kx;function J0(a,d,g){const A=a.type;if(!a.render){if(!d&&Kx&&!A.render){const w=A.template;if(w){const{isCustomElement:I,compilerOptions:z}=a.appContext.config,{delimiters:o,compilerOptions:P}=A,V=Zr(Zr({isCustomElement:I,delimiters:o},z),P);A.render=Kx(w,V)}}a.render=A.render||co}ea(a),bc(),tE(a),wc(),Js()}function kE(a){return new Proxy(a.attrs,{get(d,g){return On(a,"get","$attrs"),d[g]}})}function PE(a){const d=A=>{a.exposed=A||{}};let g;return{get attrs(){return g||(g=kE(a))},slots:a.slots,emit:a.emit,expose:d}}function $_(a){if(a.exposed)return a.exposeProxy||(a.exposeProxy=new Proxy(A0(gc(a.exposed)),{get(d,g){if(g in d)return d[g];if(g in Sp)return Sp[g](a)}}))}function DE(a){return ai(a)&&a.displayName||a.name}function BE(a){return ai(a)&&"__vccOpts"in a}const Dt=(a,d)=>T2(a,d,Ah);function iM(a){const d=Eh();let g=a();return Js(),w_(g)&&(g=g.catch(A=>{throw ea(d),A})),[g,()=>ea(d)]}function cn(a,d,g){const A=arguments.length;return A===2?wr(d)&&!Yt(d)?Tp(d)?Wi(a,null,[d]):Wi(a,d):Wi(a,null,d):(A>3?g=Array.prototype.slice.call(arguments,2):A===3&&Tp(g)&&(g=[g]),Wi(a,d,g))}const LE="3.2.31",RE="http://www.w3.org/2000/svg",Qa=typeof document!="undefined"?document:null,ev=Qa&&Qa.createElement("template"),OE={insert:(a,d,g)=>{d.insertBefore(a,g||null)},remove:a=>{const d=a.parentNode;d&&d.removeChild(a)},createElement:(a,d,g,A)=>{const w=d?Qa.createElementNS(RE,a):Qa.createElement(a,g?{is:g}:void 0);return a==="select"&&A&&A.multiple!=null&&w.setAttribute("multiple",A.multiple),w},createText:a=>Qa.createTextNode(a),createComment:a=>Qa.createComment(a),setText:(a,d)=>{a.nodeValue=d},setElementText:(a,d)=>{a.textContent=d},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Qa.querySelector(a),setScopeId(a,d){a.setAttribute(d,"")},cloneNode(a){const d=a.cloneNode(!0);return"_value"in a&&(d._value=a._value),d},insertStaticContent(a,d,g,A,w,I){const z=g?g.previousSibling:d.lastChild;if(w&&(w===I||w.nextSibling))for(;d.insertBefore(w.cloneNode(!0),g),!(w===I||!(w=w.nextSibling)););else{ev.innerHTML=A?`<svg>${a}</svg>`:a;const o=ev.content;if(A){const P=o.firstChild;for(;P.firstChild;)o.appendChild(P.firstChild);o.removeChild(P)}d.insertBefore(o,g)}return[z?z.nextSibling:d.firstChild,g?g.previousSibling:d.lastChild]}};function FE(a,d,g){const A=a._vtc;A&&(d=(d?[d,...A]:[...A]).join(" ")),d==null?a.removeAttribute("class"):g?a.setAttribute("class",d):a.className=d}function UE(a,d,g){const A=a.style,w=br(g);if(g&&!w){for(const I in g)e_(A,I,g[I]);if(d&&!br(d))for(const I in d)g[I]==null&&e_(A,I,"")}else{const I=A.display;w?d!==g&&(A.cssText=g):d&&a.removeAttribute("style"),"_vod"in a&&(A.display=I)}}const tv=/\s*!important$/;function e_(a,d,g){if(Yt(g))g.forEach(A=>e_(a,d,A));else if(d.startsWith("--"))a.setProperty(d,g);else{const A=VE(a,d);tv.test(g)?a.setProperty(Ac(A),g.replace(tv,""),"important"):a[A]=g}}const iv=["Webkit","Moz","ms"],wm={};function VE(a,d){const g=wm[d];if(g)return g;let A=Oo(d);if(A!=="filter"&&A in a)return wm[d]=A;A=Dp(A);for(let w=0;w<iv.length;w++){const I=iv[w]+A;if(I in a)return wm[d]=I}return d}const rv="http://www.w3.org/1999/xlink";function jE(a,d,g,A,w){if(A&&d.startsWith("xlink:"))g==null?a.removeAttributeNS(rv,d.slice(6,d.length)):a.setAttributeNS(rv,d,g);else{const I=Bw(d);g==null||I&&!Jv(g)?a.removeAttribute(d):a.setAttribute(d,I?"":g)}}function NE(a,d,g,A,w,I,z){if(d==="innerHTML"||d==="textContent"){A&&z(A,w,I),a[d]=g==null?"":g;return}if(d==="value"&&a.tagName!=="PROGRESS"&&!a.tagName.includes("-")){a._value=g;const o=g==null?"":g;(a.value!==o||a.tagName==="OPTION")&&(a.value=o),g==null&&a.removeAttribute(d);return}if(g===""||g==null){const o=typeof a[d];if(o==="boolean"){a[d]=Jv(g);return}else if(g==null&&o==="string"){a[d]="",a.removeAttribute(d);return}else if(o==="number"){try{a[d]=0}catch{}a.removeAttribute(d);return}}try{a[d]=g}catch{}}let Ip=Date.now,K0=!1;if(typeof window!="undefined"){Ip()>document.createEvent("Event").timeStamp&&(Ip=()=>performance.now());const a=navigator.userAgent.match(/firefox\/(\d+)/i);K0=!!(a&&Number(a[1])<=53)}let t_=0;const $E=Promise.resolve(),GE=()=>{t_=0},ZE=()=>t_||($E.then(GE),t_=Ip());function hc(a,d,g,A){a.addEventListener(d,g,A)}function qE(a,d,g,A){a.removeEventListener(d,g,A)}function WE(a,d,g,A,w=null){const I=a._vei||(a._vei={}),z=I[d];if(A&&z)z.value=A;else{const[o,P]=XE(d);if(A){const V=I[d]=HE(A,w);hc(a,o,V,P)}else z&&(qE(a,o,z,P),I[d]=void 0)}}const nv=/(?:Once|Passive|Capture)$/;function XE(a){let d;if(nv.test(a)){d={};let g;for(;g=a.match(nv);)a=a.slice(0,a.length-g[0].length),d[g[0].toLowerCase()]=!0}return[Ac(a.slice(2)),d]}function HE(a,d){const g=A=>{const w=A.timeStamp||Ip();(K0||w>=g.attached-1)&&Wn(QE(A,g.value),d,5,[A])};return g.value=a,g.attached=ZE(),g}function QE(a,d){if(Yt(d)){const g=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{g.call(a),a._stopped=!0},d.map(A=>w=>!w._stopped&&A&&A(w))}else return d}const ov=/^on[a-z]/,YE=(a,d,g,A,w=!1,I,z,o,P)=>{d==="class"?FE(a,A,w):d==="style"?UE(a,g,A):zp(d)?v_(d)||WE(a,d,g,A,z):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):JE(a,d,A,w))?NE(a,d,A,I,z,o,P):(d==="true-value"?a._trueValue=A:d==="false-value"&&(a._falseValue=A),jE(a,d,A,w))};function JE(a,d,g,A){return A?!!(d==="innerHTML"||d==="textContent"||d in a&&ov.test(d)&&ai(g)):d==="spellcheck"||d==="draggable"||d==="form"||d==="list"&&a.tagName==="INPUT"||d==="type"&&a.tagName==="TEXTAREA"||ov.test(d)&&br(g)?!1:d in a}const Vs="transition",eh="animation",eA=(a,{slots:d})=>cn(P0,KE(a),d);eA.displayName="Transition";const tA={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};eA.props=Zr({},P0.props,tA);const Wa=(a,d=[])=>{Yt(a)?a.forEach(g=>g(...d)):a&&a(...d)},sv=a=>a?Yt(a)?a.some(d=>d.length>1):a.length>1:!1;function KE(a){const d={};for(const At in a)At in tA||(d[At]=a[At]);if(a.css===!1)return d;const{name:g="v",type:A,duration:w,enterFromClass:I=`${g}-enter-from`,enterActiveClass:z=`${g}-enter-active`,enterToClass:o=`${g}-enter-to`,appearFromClass:P=I,appearActiveClass:V=z,appearToClass:F=o,leaveFromClass:R=`${g}-leave-from`,leaveActiveClass:$=`${g}-leave-active`,leaveToClass:ne=`${g}-leave-to`}=a,oe=eT(w),ve=oe&&oe[0],Ie=oe&&oe[1],{onBeforeEnter:Ge,onEnter:Ze,onEnterCancelled:st,onLeave:ft,onLeaveCancelled:He,onBeforeAppear:yt=Ge,onAppear:We=Ze,onAppearCancelled:xt=st}=d,Et=(At,ei,ri)=>{rc(At,ei?F:o),rc(At,ei?V:z),ri&&ri()},gt=(At,ei)=>{rc(At,ne),rc(At,$),ei&&ei()},Ft=At=>(ei,ri)=>{const Er=At?We:Ze,vi=()=>Et(ei,At,ri);Wa(Er,[ei,vi]),av(()=>{rc(ei,At?P:I),js(ei,At?F:o),sv(Er)||lv(ei,A,ve,vi)})};return Zr(d,{onBeforeEnter(At){Wa(Ge,[At]),js(At,I),js(At,z)},onBeforeAppear(At){Wa(yt,[At]),js(At,P),js(At,V)},onEnter:Ft(!1),onAppear:Ft(!0),onLeave(At,ei){const ri=()=>gt(At,ei);js(At,R),rT(),js(At,$),av(()=>{rc(At,R),js(At,ne),sv(ft)||lv(At,A,Ie,ri)}),Wa(ft,[At,ri])},onEnterCancelled(At){Et(At,!1),Wa(st,[At])},onAppearCancelled(At){Et(At,!0),Wa(xt,[At])},onLeaveCancelled(At){gt(At),Wa(He,[At])}})}function eT(a){if(a==null)return null;if(wr(a))return[Em(a.enter),Em(a.leave)];{const d=Em(a);return[d,d]}}function Em(a){return _h(a)}function js(a,d){d.split(/\s+/).forEach(g=>g&&a.classList.add(g)),(a._vtc||(a._vtc=new Set)).add(d)}function rc(a,d){d.split(/\s+/).forEach(A=>A&&a.classList.remove(A));const{_vtc:g}=a;g&&(g.delete(d),g.size||(a._vtc=void 0))}function av(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let tT=0;function lv(a,d,g,A){const w=a._endId=++tT,I=()=>{w===a._endId&&A()};if(g)return setTimeout(I,g);const{type:z,timeout:o,propCount:P}=iT(a,d);if(!z)return A();const V=z+"end";let F=0;const R=()=>{a.removeEventListener(V,$),I()},$=ne=>{ne.target===a&&++F>=P&&R()};setTimeout(()=>{F<P&&R()},o+1),a.addEventListener(V,$)}function iT(a,d){const g=window.getComputedStyle(a),A=oe=>(g[oe]||"").split(", "),w=A(Vs+"Delay"),I=A(Vs+"Duration"),z=cv(w,I),o=A(eh+"Delay"),P=A(eh+"Duration"),V=cv(o,P);let F=null,R=0,$=0;d===Vs?z>0&&(F=Vs,R=z,$=I.length):d===eh?V>0&&(F=eh,R=V,$=P.length):(R=Math.max(z,V),F=R>0?z>V?Vs:eh:null,$=F?F===Vs?I.length:P.length:0);const ne=F===Vs&&/\b(transform|all)(,|$)/.test(g[Vs+"Property"]);return{type:F,timeout:R,propCount:$,hasTransform:ne}}function cv(a,d){for(;a.length<d.length;)a=a.concat(a);return Math.max(...d.map((g,A)=>uv(g)+uv(a[A])))}function uv(a){return Number(a.slice(0,-1).replace(",","."))*1e3}function rT(){return document.body.offsetHeight}const hv=a=>{const d=a.props["onUpdate:modelValue"];return Yt(d)?g=>mp(d,g):d};function nT(a){a.target.composing=!0}function dv(a){const d=a.target;d.composing&&(d.composing=!1,oT(d,"input"))}function oT(a,d){const g=document.createEvent("HTMLEvents");g.initEvent(d,!0,!0),a.dispatchEvent(g)}const rM={created(a,{modifiers:{lazy:d,trim:g,number:A}},w){a._assign=hv(w);const I=A||w.props&&w.props.type==="number";hc(a,d?"change":"input",z=>{if(z.target.composing)return;let o=a.value;g?o=o.trim():I&&(o=_h(o)),a._assign(o)}),g&&hc(a,"change",()=>{a.value=a.value.trim()}),d||(hc(a,"compositionstart",nT),hc(a,"compositionend",dv),hc(a,"change",dv))},mounted(a,{value:d}){a.value=d==null?"":d},beforeUpdate(a,{value:d,modifiers:{lazy:g,trim:A,number:w}},I){if(a._assign=hv(I),a.composing||document.activeElement===a&&(g||A&&a.value.trim()===d||(w||a.type==="number")&&_h(a.value)===d))return;const z=d==null?"":d;a.value!==z&&(a.value=z)}},sT=Zr({patchProp:YE},OE);let pv;function aT(){return pv||(pv=pE(sT))}const nM=(...a)=>{const d=aT().createApp(...a),{mount:g}=d;return d.mount=A=>{const w=lT(A);if(!w)return;const I=d._component;!ai(I)&&!I.render&&!I.template&&(I.template=w.innerHTML),w.innerHTML="";const z=g(w,!1,w instanceof SVGElement);return w instanceof Element&&(w.removeAttribute("v-cloak"),w.setAttribute("data-v-app","")),z},d};function lT(a){return br(a)?document.querySelector(a):a}function Rn(a,d,...g){if(a in d){let w=d[a];return typeof w=="function"?w(...g):w}let A=new Error(`Tried to handle "${a}" but there is no handler defined. Only defined handlers are: ${Object.keys(d).map(w=>`"${w}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(A,Rn),A}var ta=(a=>(a[a.None=0]="None",a[a.RenderStrategy=1]="RenderStrategy",a[a.Static=2]="Static",a))(ta||{}),Xs=(a=>(a[a.Unmount=0]="Unmount",a[a.Hidden=1]="Hidden",a))(Xs||{});function _r(A){var w=A,{visible:a=!0,features:d=0}=w,g=Do(w,["visible","features"]);var I;if(a||d&2&&g.props.static)return Tm(g);if(d&1){let z=(I=g.props.unmount)==null||I?0:1;return Rn(z,{[0](){return null},[1](){return Tm(xn(ui({},g),{props:xn(ui({},g.props),{hidden:!0,style:{display:"none"}})}))}})}return Tm(g)}function Tm({props:a,attrs:d,slots:g,slot:A,name:w}){var I;let V=iA(a,["unmount","static"]),{as:z}=V,o=Do(V,["as"]),P=(I=g.default)==null?void 0:I.call(g,A);if(z==="template"){if(Object.keys(o).length>0||Object.keys(d).length>0){let[F,...R]=P!=null?P:[];if(!uT(F)||R.length>0)throw new Error(['Passing props on "template"!',"",`The current component <${w} /> is rendering a "template".`,"However we need to passthrough the following props:",Object.keys(o).concat(Object.keys(d)).map($=>`  - ${$}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "template".',"Render a single element as the child so that we can forward the props onto that element."].map($=>`  - ${$}`).join(`
`)].join(`
`));return Ka(F,o)}return Array.isArray(P)&&P.length===1?P[0]:P}return cn(z,o,P)}function cT(a){let d=Object.assign({},a);for(let g in d)d[g]===void 0&&delete d[g];return d}function iA(a,d=[]){let g=Object.assign({},a);for(let A of d)A in g&&delete g[A];return g}function uT(a){return a==null?!1:typeof a.type=="string"||typeof a.type=="object"||typeof a.type=="function"}let hT=0;function dT(){return++hT}function wn(){return dT()}var or=(a=>(a.Space=" ",a.Enter="Enter",a.Escape="Escape",a.Backspace="Backspace",a.Delete="Delete",a.ArrowLeft="ArrowLeft",a.ArrowUp="ArrowUp",a.ArrowRight="ArrowRight",a.ArrowDown="ArrowDown",a.Home="Home",a.End="End",a.PageUp="PageUp",a.PageDown="PageDown",a.Tab="Tab",a))(or||{});function pT(a){throw new Error("Unexpected object: "+a)}var Bn=(a=>(a[a.First=0]="First",a[a.Previous=1]="Previous",a[a.Next=2]="Next",a[a.Last=3]="Last",a[a.Specific=4]="Specific",a[a.Nothing=5]="Nothing",a))(Bn||{});function fT(a,d){let g=d.resolveItems();if(g.length<=0)return null;let A=d.resolveActiveIndex(),w=A!=null?A:-1,I=(()=>{switch(a.focus){case 0:return g.findIndex(z=>!d.resolveDisabled(z));case 1:{let z=g.slice().reverse().findIndex((o,P,V)=>w!==-1&&V.length-P-1>=w?!1:!d.resolveDisabled(o));return z===-1?z:g.length-1-z}case 2:return g.findIndex((z,o)=>o<=w?!1:!d.resolveDisabled(z));case 3:{let z=g.slice().reverse().findIndex(o=>!d.resolveDisabled(o));return z===-1?z:g.length-1-z}case 4:return g.findIndex(z=>d.resolveId(z)===a.id);case 5:return null;default:pT(a)}})();return I===-1?A:I}function Ni(a){return a==null||a.value==null?null:"$el"in a.value?a.value.$el:a.value}let rA=Symbol("Context");var Fn=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(Fn||{});function mT(){return Th()!==null}function Th(){return ir(rA,null)}function G_(a){Ar(rA,a)}function fv(a,d){if(a)return a;let g=d!=null?d:"button";if(typeof g=="string"&&g.toLowerCase()==="button")return"button"}function Z_(a,d){let g=$t(fv(a.value.type,a.value.as));return Kr(()=>{g.value=fv(a.value.type,a.value.as)}),bn(()=>{var A;g.value||!Ni(d)||Ni(d)instanceof HTMLButtonElement&&!((A=Ni(d))!=null&&A.hasAttribute("type"))&&(g.value="button")}),g}function el(a){if(typeof window=="undefined")return null;if(a instanceof Node)return a.ownerDocument;if(a!=null&&a.hasOwnProperty("value")){let d=Ni(a);if(d)return d.ownerDocument}return document}function _T({container:a,accept:d,walk:g,enabled:A}){bn(()=>{let w=a.value;if(!w||A!==void 0&&!A.value)return;let I=el(a);if(!I)return;let z=Object.assign(P=>d(P),{acceptNode:d}),o=I.createTreeWalker(w,NodeFilter.SHOW_ELEMENT,z,!1);for(;o.nextNode();)g(o.currentNode)})}let i_=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(a=>`${a}:not([tabindex='-1'])`).join(",");var sh=(a=>(a[a.First=1]="First",a[a.Previous=2]="Previous",a[a.Next=4]="Next",a[a.Last=8]="Last",a[a.WrapAround=16]="WrapAround",a[a.NoScroll=32]="NoScroll",a))(sh||{}),r_=(a=>(a[a.Error=0]="Error",a[a.Overflow=1]="Overflow",a[a.Success=2]="Success",a[a.Underflow=3]="Underflow",a))(r_||{}),gT=(a=>(a[a.Previous=-1]="Previous",a[a.Next=1]="Next",a))(gT||{});function yT(a=document.body){return a==null?[]:Array.from(a.querySelectorAll(i_))}var nA=(a=>(a[a.Strict=0]="Strict",a[a.Loose=1]="Loose",a))(nA||{});function xT(a,d=0){var g;return a===((g=el(a))==null?void 0:g.body)?!1:Rn(d,{[0](){return a.matches(i_)},[1](){let A=a;for(;A!==null;){if(A.matches(i_))return!0;A=A.parentElement}return!1}})}function th(a){a==null||a.focus({preventScroll:!0})}let vT=["textarea","input"].join(",");function AT(a){var d,g;return(g=(d=a==null?void 0:a.matches)==null?void 0:d.call(a,vT))!=null?g:!1}function oA(a,d=g=>g){return a.slice().sort((g,A)=>{let w=d(g),I=d(A);if(w===null||I===null)return 0;let z=w.compareDocumentPosition(I);return z&Node.DOCUMENT_POSITION_FOLLOWING?-1:z&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function mv(a,d){var g;let A=(g=Array.isArray(a)?a.length>0?a[0].ownerDocument:document:a==null?void 0:a.ownerDocument)!=null?g:document,w=Array.isArray(a)?oA(a):yT(a),I=A.activeElement,z=(()=>{if(d&5)return 1;if(d&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),o=(()=>{if(d&1)return 0;if(d&2)return Math.max(0,w.indexOf(I))-1;if(d&4)return Math.max(0,w.indexOf(I))+1;if(d&8)return w.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),P=d&32?{preventScroll:!0}:{},V=0,F=w.length,R;do{if(V>=F||V+F<=0)return 0;let $=o+V;if(d&16)$=($+F)%F;else{if($<0)return 3;if($>=F)return 1}R=w[$],R==null||R.focus(P),V+=z}while(R!==A.activeElement);return R.hasAttribute("tabindex")||R.setAttribute("tabindex","0"),d&6&&AT(R)&&R.select(),2}function _v(a,d,g){typeof window!="undefined"&&bn(A=>{window.addEventListener(a,d,g),A(()=>window.removeEventListener(a,d,g))})}function bT(a){typeof queueMicrotask=="function"?queueMicrotask(a):Promise.resolve().then(a).catch(d=>setTimeout(()=>{throw d}))}var sA=(a=>(a[a.None=1]="None",a[a.IgnoreScrollbars=2]="IgnoreScrollbars",a))(sA||{});function aA(a,d,g=1){let A=!1;function w(I){if(A)return;A=!0,bT(()=>{A=!1});let z=I.target;if(!z.ownerDocument.documentElement.contains(z))return;let o=function P(V){return typeof V=="function"?P(V()):Array.isArray(V)||V instanceof Set?V:[V]}(a);if((g&2)===2){let P=20,V=z.ownerDocument.documentElement;if(I.clientX>V.clientWidth-P||I.clientX<P||I.clientY>V.clientHeight-P||I.clientY<P)return}for(let P of o){if(P===null)continue;let V=P instanceof HTMLElement?P:Ni(P);if(V!=null&&V.contains(z))return}d(I,z)}_v("pointerdown",w),_v("mousedown",w)}let wT=hr({name:"VisuallyHidden",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:d,attrs:g}){return()=>_r({props:xn(ui({},a),{style:{position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",display:"none"}}),slot:{},attrs:g,slots:d,name:"VisuallyHidden"})}});function ET(a){var d;let g=(d=a==null?void 0:a.form)!=null?d:a.closest("form");if(g){for(let A of g.elements)if(A.tagName==="INPUT"&&A.type==="submit"||A.tagName==="BUTTON"&&A.type==="submit"||A.nodeName==="INPUT"&&A.type==="image"){A.click();return}}}function n_(a,d,g,A){typeof window!="undefined"&&bn(w=>{a=a!=null?a:window,a.addEventListener(d,g,A),w(()=>a.removeEventListener(d,g,A))})}var ah=(a=>(a[a.None=1]="None",a[a.InitialFocus=2]="InitialFocus",a[a.TabLock=4]="TabLock",a[a.FocusLock=8]="FocusLock",a[a.RestoreFocus=16]="RestoreFocus",a[a.All=30]="All",a))(ah||{});function TT(a,d=$t(30),g=$t({})){var A,w;let I=$t(null),z=$t(null),o={value:!1},P=Dt(()=>Boolean(d.value&16)),V=Dt(()=>Boolean(d.value&2)),F=Dt(()=>el(a));return Kr(()=>{An(P,(R,$)=>{var ne;R!==$&&(!P.value||(o.value=!0,I.value||(I.value=(ne=F.value)==null?void 0:ne.activeElement)))},{immediate:!0}),An(P,(R,$,ne)=>{R!==$&&(!P.value||ne(()=>{o.value!==!1&&(o.value=!1,th(I.value),I.value=null)}))},{immediate:!0}),An([a,g,g.value.initialFocus,V],(R,$)=>{var ne,oe;if(R.every((Ze,st)=>($==null?void 0:$[st])===Ze)||!V.value)return;let ve=a.value;if(!ve)return;let Ie=Ni(g.value.initialFocus),Ge=(ne=F.value)==null?void 0:ne.activeElement;if(Ie){if(Ie===Ge){z.value=Ge;return}}else if(ve.contains(Ge)){z.value=Ge;return}Ie?th(Ie):mv(ve,sh.First)===r_.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),z.value=(oe=F.value)==null?void 0:oe.activeElement},{immediate:!0})}),n_((A=F.value)==null?void 0:A.defaultView,"keydown",R=>{var $;!(d.value&4)||!a.value||R.key===or.Tab&&(R.preventDefault(),mv(a.value,(R.shiftKey?sh.Previous:sh.Next)|sh.WrapAround)===r_.Success&&(z.value=($=F.value)==null?void 0:$.activeElement))}),n_((w=F.value)==null?void 0:w.defaultView,"focus",R=>{var $;if(!(d.value&8))return;let ne=new Set(($=g.value.containers)==null?void 0:$.value);if(ne.add(a),!ne.size)return;let oe=z.value;if(!oe||!o.value)return;let ve=R.target;ve&&ve instanceof HTMLElement?ST(ne,ve)?(z.value=ve,th(ve)):(R.preventDefault(),R.stopPropagation(),th(oe)):th(z.value)},!0),I}function ST(a,d){var g;for(let A of a)if((g=A.value)!=null&&g.contains(d))return!0;return!1}let gv="body > *",nc=new Set,Zs=new Map;function yv(a){a.setAttribute("aria-hidden","true"),a.inert=!0}function xv(a){let d=Zs.get(a);!d||(d["aria-hidden"]===null?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden",d["aria-hidden"]),a.inert=d.inert)}function IT(a,d=$t(!0)){bn(g=>{if(!d.value||!a.value)return;let A=a.value,w=el(A);if(w){nc.add(A);for(let I of Zs.keys())I.contains(A)&&(xv(I),Zs.delete(I));w.querySelectorAll(gv).forEach(I=>{if(I instanceof HTMLElement){for(let z of nc)if(I.contains(z))return;nc.size===1&&(Zs.set(I,{"aria-hidden":I.getAttribute("aria-hidden"),inert:I.inert}),yv(I))}}),g(()=>{if(nc.delete(A),nc.size>0)w.querySelectorAll(gv).forEach(I=>{if(I instanceof HTMLElement&&!Zs.has(I)){for(let z of nc)if(I.contains(z))return;Zs.set(I,{"aria-hidden":I.getAttribute("aria-hidden"),inert:I.inert}),yv(I)}});else for(let I of Zs.keys())xv(I),Zs.delete(I)})}})}let lA=Symbol("ForcePortalRootContext");function CT(){return ir(lA,!1)}let o_=hr({name:"ForcePortalRoot",props:{as:{type:[Object,String],default:"template"},force:{type:Boolean,default:!1}},setup(a,{slots:d,attrs:g}){return Ar(lA,a.force),()=>{let I=a,{force:A}=I,w=Do(I,["force"]);return _r({props:w,slot:{},slots:d,attrs:g,name:"ForcePortalRoot"})}}});function MT(a){let d=el(a);if(!d)throw new Error(`[Headless UI]: Cannot find ownerDocument for contextElement: ${a}`);let g=d.getElementById("headlessui-portal-root");if(g)return g;let A=d.createElement("div");return A.setAttribute("id","headlessui-portal-root"),d.body.appendChild(A)}let cA=hr({name:"Portal",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:d,attrs:g}){let A=$t(null),w=Dt(()=>el(A)),I=CT(),z=ir(uA,null),o=$t(I===!0||z==null?MT(A.value):z.resolveTarget());return bn(()=>{I||z!=null&&(o.value=z.resolveTarget())}),uo(()=>{var P,V;let F=(P=w.value)==null?void 0:P.getElementById("headlessui-portal-root");!F||o.value===F&&o.value.children.length<=0&&((V=o.value.parentElement)==null||V.removeChild(o.value))}),()=>{if(o.value===null)return null;let P={ref:A};return cn(xE,{to:o.value},_r({props:ui(ui({},a),P),slot:{},attrs:g,slots:d,name:"Portal"}))}}}),uA=Symbol("PortalGroupContext"),zT=hr({name:"PortalGroup",props:{as:{type:[Object,String],default:"template"},target:{type:Object,default:null}},setup(a,{attrs:d,slots:g}){let A=Fo({resolveTarget(){return a.target}});return Ar(uA,A),()=>{let z=a,{target:w}=z,I=Do(z,["target"]);return _r({props:I,slot:{},attrs:d,slots:g,name:"PortalGroup"})}}}),hA=Symbol("StackContext");var s_=(a=>(a[a.Add=0]="Add",a[a.Remove=1]="Remove",a))(s_||{});function kT(){return ir(hA,()=>{})}function PT({type:a,element:d,onUpdate:g}){let A=kT();function w(...I){g==null||g(...I),A(...I)}Kr(()=>{w(0,a,d),uo(()=>{w(1,a,d)})}),Ar(hA,w)}let dA=Symbol("DescriptionContext");function DT(){let a=ir(dA,null);if(a===null)throw new Error("Missing parent");return a}function pA({slot:a=$t({}),name:d="Description",props:g={}}={}){let A=$t([]);function w(I){return A.value.push(I),()=>{let z=A.value.indexOf(I);z!==-1&&A.value.splice(z,1)}}return Ar(dA,{register:w,slot:a,name:d,props:g}),Dt(()=>A.value.length>0?A.value.join(" "):void 0)}let BT=hr({name:"Description",props:{as:{type:[Object,String],default:"p"}},setup(a,{attrs:d,slots:g}){let A=DT(),w=`headlessui-description-${wn()}`;return Kr(()=>uo(A.register(w))),()=>{let{name:I="Description",slot:z=$t({}),props:o={}}=A,P=a,V=xn(ui({},Object.entries(o).reduce((F,[R,$])=>Object.assign(F,{[R]:hi($)}),{})),{id:w});return _r({props:ui(ui({},P),V),slot:z.value,attrs:d,slots:g,name:I})}}});var LT=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(LT||{});let a_=Symbol("DialogContext");function Sh(a){let d=ir(a_,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,Sh),g}return d}let cp="DC8F892D-2EBD-447C-A4C8-A03058436FF4",oM=hr({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:cp},initialFocus:{type:Object,default:null}},emits:{close:a=>!0},setup(a,{emit:d,attrs:g,slots:A,expose:w}){var I;let z=$t(0),o=Th(),P=Dt(()=>a.open===cp&&o!==null?Rn(o.value,{[Fn.Open]:!0,[Fn.Closed]:!1}):a.open),V=$t(new Set),F=$t(null),R=Dt(()=>el(F));if(w({el:F,$el:F}),!(a.open!==cp||o!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof P.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${P.value===cp?void 0:a.open}`);let $=Dt(()=>P.value?0:1),ne=Dt(()=>$.value===0),oe=Dt(()=>z.value>1),ve=ir(a_,null)!==null,Ie=Dt(()=>oe.value?"parent":"leaf"),Ge=TT(F,Dt(()=>ne.value?Rn(Ie.value,{parent:ah.RestoreFocus,leaf:ah.All&~ah.FocusLock}):ah.None),Dt(()=>({initialFocus:$t(a.initialFocus),containers:V})));IT(F,Dt(()=>oe.value?ne.value:!1)),PT({type:"Dialog",element:F,onUpdate:(We,xt,Et)=>{if(xt==="Dialog")return Rn(We,{[s_.Add](){V.value.add(Et),z.value+=1},[s_.Remove](){V.value.delete(Et),z.value-=1}})}});let Ze=pA({name:"DialogDescription",slot:Dt(()=>({open:P.value}))}),st=`headlessui-dialog-${wn()}`,ft=$t(null),He={titleId:ft,panelRef:$t(null),dialogState:$,setTitleId(We){ft.value!==We&&(ft.value=We)},close(){d("close",!1)}};Ar(a_,He),aA(()=>{var We,xt,Et;return[...Array.from((xt=(We=R.value)==null?void 0:We.querySelectorAll("body > *"))!=null?xt:[]).filter(gt=>!(!(gt instanceof HTMLElement)||gt.contains(Ge.value)||He.panelRef.value&&gt.contains(He.panelRef.value))),(Et=He.panelRef.value)!=null?Et:F.value]},(We,xt)=>{$.value===0&&(oe.value||(He.close(),Ln(()=>xt==null?void 0:xt.focus())))},sA.IgnoreScrollbars),n_((I=R.value)==null?void 0:I.defaultView,"keydown",We=>{We.key===or.Escape&&$.value===0&&(oe.value||(We.preventDefault(),We.stopPropagation(),He.close()))}),bn(We=>{var xt;if($.value!==0||ve)return;let Et=R.value;if(!Et)return;let gt=Et==null?void 0:Et.documentElement,Ft=(xt=Et.defaultView)!=null?xt:window,At=gt.style.overflow,ei=gt.style.paddingRight,ri=Ft.innerWidth-gt.clientWidth;gt.style.overflow="hidden",gt.style.paddingRight=`${ri}px`,We(()=>{gt.style.overflow=At,gt.style.paddingRight=ei})}),bn(We=>{if($.value!==0)return;let xt=Ni(F);if(!xt)return;let Et=new IntersectionObserver(gt=>{for(let Ft of gt)Ft.boundingClientRect.x===0&&Ft.boundingClientRect.y===0&&Ft.boundingClientRect.width===0&&Ft.boundingClientRect.height===0&&He.close()});Et.observe(xt),We(()=>Et.disconnect())});function yt(We){We.stopPropagation()}return()=>{let We=xn(ui({},g),{ref:F,id:st,role:"dialog","aria-modal":$.value===0?!0:void 0,"aria-labelledby":ft.value,"aria-describedby":Ze.value,onClick:yt}),At=a,{open:xt,initialFocus:Et}=At,gt=Do(At,["open","initialFocus"]),Ft={open:$.value===0};return cn(o_,{force:!0},()=>cn(cA,()=>cn(zT,{target:F.value},()=>cn(o_,{force:!1},()=>_r({props:ui(ui({},gt),We),slot:Ft,attrs:g,slots:A,visible:$.value===0,features:ta.RenderStrategy|ta.Static,name:"Dialog"})))))}}});hr({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:d,slots:g}){let A=Sh("DialogOverlay"),w=`headlessui-dialog-overlay-${wn()}`;function I(z){z.target===z.currentTarget&&(z.preventDefault(),z.stopPropagation(),A.close())}return()=>_r({props:xn(ui({},a),{id:w,"aria-hidden":!0,onClick:I}),slot:{open:A.dialogState.value===0},attrs:d,slots:g,name:"DialogOverlay"})}});hr({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(a,{attrs:d,slots:g,expose:A}){let w=Sh("DialogBackdrop"),I=`headlessui-dialog-backdrop-${wn()}`,z=$t(null);return A({el:z,$el:z}),Kr(()=>{if(w.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let o=a,P={id:I,ref:z,"aria-hidden":!0};return cn(o_,{force:!0},()=>cn(cA,()=>_r({props:ui(ui(ui({},d),o),P),slot:{open:w.dialogState.value===0},attrs:d,slots:g,name:"DialogBackdrop"})))}}});let sM=hr({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:d,slots:g}){let A=Sh("DialogPanel"),w=`headlessui-dialog-panel-${wn()}`;return()=>{let I={id:w,ref:A.panelRef};return _r({props:ui(ui({},a),I),slot:{open:A.dialogState.value===0},attrs:d,slots:g,name:"DialogPanel"})}}}),aM=hr({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(a,{attrs:d,slots:g}){let A=Sh("DialogTitle"),w=`headlessui-dialog-title-${wn()}`;return Kr(()=>{A.setTitleId(w),uo(()=>A.setTitleId(null))}),()=>_r({props:xn(ui({},a),{id:w}),slot:{open:A.dialogState.value===0},attrs:d,slots:g,name:"DialogTitle"})}});var RT=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(RT||{});let fA=Symbol("DisclosureContext");function q_(a){let d=ir(fA,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,q_),g}return d}let mA=Symbol("DisclosurePanelContext");function OT(){return ir(mA,null)}let lM=hr({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(a,{slots:d,attrs:g}){let A=`headlessui-disclosure-button-${wn()}`,w=`headlessui-disclosure-panel-${wn()}`,I=$t(a.defaultOpen?0:1),z=$t(null),o=$t(null),P={buttonId:A,panelId:w,disclosureState:I,panel:z,button:o,toggleDisclosure(){I.value=Rn(I.value,{[0]:1,[1]:0})},closeDisclosure(){I.value!==1&&(I.value=1)},close(V){P.closeDisclosure();let F=(()=>V?V instanceof HTMLElement?V:V.value instanceof HTMLElement?Ni(V):Ni(P.button):Ni(P.button))();F==null||F.focus()}};return Ar(fA,P),G_(Dt(()=>Rn(I.value,{[0]:Fn.Open,[1]:Fn.Closed}))),()=>{let $=a,{defaultOpen:V}=$,F=Do($,["defaultOpen"]),R={open:I.value===0,close:P.close};return _r({props:F,slot:R,slots:d,attrs:g,name:"Disclosure"})}}}),cM=hr({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(a,{attrs:d,slots:g,expose:A}){let w=q_("DisclosureButton"),I=OT(),z=I===null?!1:I===w.panelId,o=$t(null);A({el:o,$el:o}),z||bn(()=>{w.button.value=o.value});let P=Z_(Dt(()=>({as:a.as,type:d.type})),o);function V(){var $;a.disabled||(z?(w.toggleDisclosure(),($=Ni(w.button))==null||$.focus()):w.toggleDisclosure())}function F($){var ne;if(!a.disabled)if(z)switch($.key){case or.Space:case or.Enter:$.preventDefault(),$.stopPropagation(),w.toggleDisclosure(),(ne=Ni(w.button))==null||ne.focus();break}else switch($.key){case or.Space:case or.Enter:$.preventDefault(),$.stopPropagation(),w.toggleDisclosure();break}}function R($){switch($.key){case or.Space:$.preventDefault();break}}return()=>{let $={open:w.disclosureState.value===0},ne=z?{ref:o,type:P.value,onClick:V,onKeydown:F}:{id:w.buttonId,ref:o,type:P.value,"aria-expanded":a.disabled?void 0:w.disclosureState.value===0,"aria-controls":Ni(w.panel)?w.panelId:void 0,disabled:a.disabled?!0:void 0,onClick:V,onKeydown:F,onKeyup:R};return _r({props:ui(ui({},a),ne),slot:$,attrs:d,slots:g,name:"DisclosureButton"})}}}),uM=hr({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:d,slots:g,expose:A}){let w=q_("DisclosurePanel");A({el:w.panel,$el:w.panel}),Ar(mA,w.panelId);let I=Th(),z=Dt(()=>I!==null?I.value===Fn.Open:w.disclosureState.value===0);return()=>{let o={open:w.disclosureState.value===0,close:w.close},P={id:w.panelId,ref:w.panel};return _r({props:ui(ui({},a),P),slot:o,attrs:d,slots:g,features:ta.RenderStrategy|ta.Static,visible:z.value,name:"DisclosurePanel"})}}});var FT=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(FT||{}),UT=(a=>(a[a.Pointer=0]="Pointer",a[a.Other=1]="Other",a))(UT||{});function VT(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let _A=Symbol("MenuContext");function Fp(a){let d=ir(_A,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,Fp),g}return d}let hM=hr({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:d,attrs:g}){let A=$t(1),w=$t(null),I=$t(null),z=$t([]),o=$t(""),P=$t(null),V=$t(1);function F($=ne=>ne){let ne=P.value!==null?z.value[P.value]:null,oe=oA($(z.value.slice()),Ie=>Ni(Ie.dataRef.domRef)),ve=ne?oe.indexOf(ne):null;return ve===-1&&(ve=null),{items:oe,activeItemIndex:ve}}let R={menuState:A,buttonRef:w,itemsRef:I,items:z,searchQuery:o,activeItemIndex:P,activationTrigger:V,closeMenu:()=>{A.value=1,P.value=null},openMenu:()=>A.value=0,goToItem($,ne,oe){let ve=F(),Ie=fT($===Bn.Specific?{focus:Bn.Specific,id:ne}:{focus:$},{resolveItems:()=>ve.items,resolveActiveIndex:()=>ve.activeItemIndex,resolveId:Ge=>Ge.id,resolveDisabled:Ge=>Ge.dataRef.disabled});o.value="",P.value=Ie,V.value=oe!=null?oe:1,z.value=ve.items},search($){let ne=o.value!==""?0:1;o.value+=$.toLowerCase();let oe=(P.value!==null?z.value.slice(P.value+ne).concat(z.value.slice(0,P.value+ne)):z.value).find(Ie=>Ie.dataRef.textValue.startsWith(o.value)&&!Ie.dataRef.disabled),ve=oe?z.value.indexOf(oe):-1;ve===-1||ve===P.value||(P.value=ve,V.value=1)},clearSearch(){o.value=""},registerItem($,ne){let oe=F(ve=>[...ve,{id:$,dataRef:ne}]);z.value=oe.items,P.value=oe.activeItemIndex,V.value=1},unregisterItem($){let ne=F(oe=>{let ve=oe.findIndex(Ie=>Ie.id===$);return ve!==-1&&oe.splice(ve,1),oe});z.value=ne.items,P.value=ne.activeItemIndex,V.value=1}};return aA([w,I],($,ne)=>{var oe;A.value===0&&(R.closeMenu(),xT(ne,nA.Loose)||($.preventDefault(),(oe=Ni(w))==null||oe.focus()))}),Ar(_A,R),G_(Dt(()=>Rn(A.value,{[0]:Fn.Open,[1]:Fn.Closed}))),()=>{let $={open:A.value===0};return _r({props:a,slot:$,slots:d,attrs:g,name:"Menu"})}}}),dM=hr({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"}},setup(a,{attrs:d,slots:g,expose:A}){let w=Fp("MenuButton"),I=`headlessui-menu-button-${wn()}`;A({el:w.buttonRef,$el:w.buttonRef});function z(F){switch(F.key){case or.Space:case or.Enter:case or.ArrowDown:F.preventDefault(),F.stopPropagation(),w.openMenu(),Ln(()=>{var R;(R=Ni(w.itemsRef))==null||R.focus({preventScroll:!0}),w.goToItem(Bn.First)});break;case or.ArrowUp:F.preventDefault(),F.stopPropagation(),w.openMenu(),Ln(()=>{var R;(R=Ni(w.itemsRef))==null||R.focus({preventScroll:!0}),w.goToItem(Bn.Last)});break}}function o(F){switch(F.key){case or.Space:F.preventDefault();break}}function P(F){a.disabled||(w.menuState.value===0?(w.closeMenu(),Ln(()=>{var R;return(R=Ni(w.buttonRef))==null?void 0:R.focus({preventScroll:!0})})):(F.preventDefault(),F.stopPropagation(),w.openMenu(),VT(()=>{var R;return(R=Ni(w.itemsRef))==null?void 0:R.focus({preventScroll:!0})})))}let V=Z_(Dt(()=>({as:a.as,type:d.type})),w.buttonRef);return()=>{var F;let R={open:w.menuState.value===0},$={ref:w.buttonRef,id:I,type:V.value,"aria-haspopup":!0,"aria-controls":(F=Ni(w.itemsRef))==null?void 0:F.id,"aria-expanded":a.disabled?void 0:w.menuState.value===0,onKeydown:z,onKeyup:o,onClick:P};return _r({props:ui(ui({},a),$),slot:R,attrs:d,slots:g,name:"MenuButton"})}}}),pM=hr({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:d,slots:g,expose:A}){let w=Fp("MenuItems"),I=`headlessui-menu-items-${wn()}`,z=$t(null);A({el:w.itemsRef,$el:w.itemsRef}),_T({container:Dt(()=>Ni(w.itemsRef)),enabled:Dt(()=>w.menuState.value===0),accept(R){return R.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:R.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(R){R.setAttribute("role","none")}});function o(R){var $;switch(z.value&&clearTimeout(z.value),R.key){case or.Space:if(w.searchQuery.value!=="")return R.preventDefault(),R.stopPropagation(),w.search(R.key);case or.Enter:if(R.preventDefault(),R.stopPropagation(),w.activeItemIndex.value!==null){let ne=w.items.value[w.activeItemIndex.value];($=Ni(ne.dataRef.domRef))==null||$.click()}w.closeMenu(),Ln(()=>{var ne;return(ne=Ni(w.buttonRef))==null?void 0:ne.focus({preventScroll:!0})});break;case or.ArrowDown:return R.preventDefault(),R.stopPropagation(),w.goToItem(Bn.Next);case or.ArrowUp:return R.preventDefault(),R.stopPropagation(),w.goToItem(Bn.Previous);case or.Home:case or.PageUp:return R.preventDefault(),R.stopPropagation(),w.goToItem(Bn.First);case or.End:case or.PageDown:return R.preventDefault(),R.stopPropagation(),w.goToItem(Bn.Last);case or.Escape:R.preventDefault(),R.stopPropagation(),w.closeMenu(),Ln(()=>{var ne;return(ne=Ni(w.buttonRef))==null?void 0:ne.focus({preventScroll:!0})});break;case or.Tab:R.preventDefault(),R.stopPropagation();break;default:R.key.length===1&&(w.search(R.key),z.value=setTimeout(()=>w.clearSearch(),350));break}}function P(R){switch(R.key){case or.Space:R.preventDefault();break}}let V=Th(),F=Dt(()=>V!==null?V.value===Fn.Open:w.menuState.value===0);return()=>{var R,$;let ne={open:w.menuState.value===0},oe={"aria-activedescendant":w.activeItemIndex.value===null||(R=w.items.value[w.activeItemIndex.value])==null?void 0:R.id,"aria-labelledby":($=Ni(w.buttonRef))==null?void 0:$.id,id:I,onKeydown:o,onKeyup:P,role:"menu",tabIndex:0,ref:w.itemsRef};return _r({props:ui(ui({},a),oe),slot:ne,attrs:d,slots:g,features:ta.RenderStrategy|ta.Static,visible:F.value,name:"MenuItems"})}}}),fM=hr({name:"MenuItem",props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1}},setup(a,{slots:d,attrs:g,expose:A}){let w=Fp("MenuItem"),I=`headlessui-menu-item-${wn()}`,z=$t(null);A({el:z,$el:z});let o=Dt(()=>w.activeItemIndex.value!==null?w.items.value[w.activeItemIndex.value].id===I:!1),P=Dt(()=>({disabled:a.disabled,textValue:"",domRef:z}));Kr(()=>{var ne,oe;let ve=(oe=(ne=Ni(z))==null?void 0:ne.textContent)==null?void 0:oe.toLowerCase().trim();ve!==void 0&&(P.value.textValue=ve)}),Kr(()=>w.registerItem(I,P)),uo(()=>w.unregisterItem(I)),bn(()=>{w.menuState.value===0&&(!o.value||w.activationTrigger.value!==0&&Ln(()=>{var ne,oe;return(oe=(ne=Ni(z))==null?void 0:ne.scrollIntoView)==null?void 0:oe.call(ne,{block:"nearest"})}))});function V(ne){if(a.disabled)return ne.preventDefault();w.closeMenu(),Ln(()=>{var oe;return(oe=Ni(w.buttonRef))==null?void 0:oe.focus({preventScroll:!0})})}function F(){if(a.disabled)return w.goToItem(Bn.Nothing);w.goToItem(Bn.Specific,I)}function R(){a.disabled||o.value||w.goToItem(Bn.Specific,I,0)}function $(){a.disabled||!o.value||w.goToItem(Bn.Nothing)}return()=>{let{disabled:ne}=a,oe={active:o.value,disabled:ne};return _r({props:xn(ui({},a),{id:I,ref:z,role:"menuitem",tabIndex:ne===!0?void 0:-1,"aria-disabled":ne===!0?!0:void 0,onClick:V,onFocus:F,onPointermove:R,onMousemove:R,onPointerleave:$,onMouseleave:$}),slot:oe,attrs:g,slots:d,name:"MenuItem"})}}}),gA=Symbol("LabelContext");function yA(){let a=ir(gA,null);if(a===null){let d=new Error("You used a <Label /> component, but it is not inside a parent.");throw Error.captureStackTrace&&Error.captureStackTrace(d,yA),d}return a}function jT({slot:a={},name:d="Label",props:g={}}={}){let A=$t([]);function w(I){return A.value.push(I),()=>{let z=A.value.indexOf(I);z!==-1&&A.value.splice(z,1)}}return Ar(gA,{register:w,slot:a,name:d,props:g}),Dt(()=>A.value.length>0?A.value.join(" "):void 0)}let NT=hr({name:"Label",props:{as:{type:[Object,String],default:"label"},passive:{type:[Boolean],default:!1}},setup(a,{slots:d,attrs:g}){let A=yA(),w=`headlessui-label-${wn()}`;return Kr(()=>uo(A.register(w))),()=>{let{name:I="Label",slot:z={},props:o={}}=A,$=a,{passive:P}=$,V=Do($,["passive"]),F=xn(ui({},Object.entries(o).reduce((ne,[oe,ve])=>Object.assign(ne,{[oe]:hi(ve)}),{})),{id:w}),R=ui(ui({},V),F);return P&&delete R.onClick,_r({props:R,slot:z,attrs:g,slots:d,name:I})}}}),xA=Symbol("GroupContext"),mM=hr({name:"SwitchGroup",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:d,attrs:g}){let A=$t(null),w=jT({name:"SwitchLabel",props:{onClick(){!A.value||(A.value.click(),A.value.focus({preventScroll:!0}))}}}),I=pA({name:"SwitchDescription"});return Ar(xA,{switchRef:A,labelledby:w,describedby:I}),()=>_r({props:a,slot:{},slots:d,attrs:g,name:"SwitchGroup"})}}),_M=hr({name:"Switch",emits:{"update:modelValue":a=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:!1},name:{type:String,optional:!0},value:{type:String,optional:!0}},inheritAttrs:!1,setup(a,{emit:d,attrs:g,slots:A,expose:w}){let I=ir(xA,null),z=`headlessui-switch-${wn()}`;function o(){d("update:modelValue",!a.modelValue)}let P=$t(null),V=I===null?P:I.switchRef,F=Z_(Dt(()=>({as:a.as,type:g.type})),V);w({el:V,$el:V});function R(oe){oe.preventDefault(),o()}function $(oe){oe.key===or.Space?(oe.preventDefault(),o()):oe.key===or.Enter&&ET(oe.currentTarget)}function ne(oe){oe.preventDefault()}return()=>{let ft=a,{name:oe,value:ve,modelValue:Ie}=ft,Ge=Do(ft,["name","value","modelValue"]),Ze={checked:Ie},st={id:z,ref:V,role:"switch",type:F.value,tabIndex:0,"aria-checked":Ie,"aria-labelledby":I==null?void 0:I.labelledby.value,"aria-describedby":I==null?void 0:I.describedby.value,onClick:R,onKeyup:$,onKeypress:ne};return cn(ao,[oe!=null&&Ie!=null?cn(wT,cT({as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:Ie,name:oe,value:ve})):null,_r({props:ui(ui(ui({},g),Ge),st),slot:Ze,attrs:g,slots:A,name:"Switch"})])}}}),gM=NT,yM=BT;function $T(a){let d={called:!1};return(...g)=>{if(!d.called)return d.called=!0,a(...g)}}function vA(){let a=[],d=[],g={enqueue(A){d.push(A)},requestAnimationFrame(...A){let w=requestAnimationFrame(...A);g.add(()=>cancelAnimationFrame(w))},nextFrame(...A){g.requestAnimationFrame(()=>{g.requestAnimationFrame(...A)})},setTimeout(...A){let w=setTimeout(...A);g.add(()=>clearTimeout(w))},add(A){a.push(A)},dispose(){for(let A of a.splice(0))A()},async workQueue(){for(let A of d.splice(0))await A()}};return g}function Sm(a,...d){a&&d.length>0&&a.classList.add(...d)}function up(a,...d){a&&d.length>0&&a.classList.remove(...d)}var l_=(a=>(a.Finished="finished",a.Cancelled="cancelled",a))(l_||{});function GT(a,d){let g=vA();if(!a)return g.dispose;let{transitionDuration:A,transitionDelay:w}=getComputedStyle(a),[I,z]=[A,w].map(o=>{let[P=0]=o.split(",").filter(Boolean).map(V=>V.includes("ms")?parseFloat(V):parseFloat(V)*1e3).sort((V,F)=>F-V);return P});return I!==0?g.setTimeout(()=>d("finished"),I+z):d("finished"),g.add(()=>d("cancelled")),g.dispose}function vv(a,d,g,A,w,I){let z=vA(),o=I!==void 0?$T(I):()=>{};return up(a,...w),Sm(a,...d,...g),z.nextFrame(()=>{up(a,...g),Sm(a,...A),z.add(GT(a,P=>(up(a,...A,...d),Sm(a,...w),o(P))))}),z.add(()=>up(a,...d,...g,...A,...w)),z.add(()=>o("cancelled")),z.dispose}function Xa(a=""){return a.split(" ").filter(d=>d.trim().length>1)}let W_=Symbol("TransitionContext");var ZT=(a=>(a.Visible="visible",a.Hidden="hidden",a))(ZT||{});function qT(){return ir(W_,null)!==null}function WT(){let a=ir(W_,null);if(a===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return a}function XT(){let a=ir(X_,null);if(a===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return a}let X_=Symbol("NestingContext");function Up(a){return"children"in a?Up(a.children):a.value.filter(({state:d})=>d==="visible").length>0}function AA(a){let d=$t([]),g=$t(!1);Kr(()=>g.value=!0),uo(()=>g.value=!1);function A(I,z=Xs.Hidden){let o=d.value.findIndex(({id:P})=>P===I);o!==-1&&(Rn(z,{[Xs.Unmount](){d.value.splice(o,1)},[Xs.Hidden](){d.value[o].state="hidden"}}),!Up(d)&&g.value&&(a==null||a()))}function w(I){let z=d.value.find(({id:o})=>o===I);return z?z.state!=="visible"&&(z.state="visible"):d.value.push({id:I,state:"visible"}),()=>A(I,Xs.Unmount)}return{children:d,register:w,unregister:A}}let bA=ta.RenderStrategy,HT=hr({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(a,{emit:d,attrs:g,slots:A,expose:w}){if(!qT()&&mT())return()=>cn(YT,xn(ui({},a),{onBeforeEnter:()=>d("beforeEnter"),onAfterEnter:()=>d("afterEnter"),onBeforeLeave:()=>d("beforeLeave"),onAfterLeave:()=>d("afterLeave")}),A);let I=$t(null),z=$t("visible"),o=Dt(()=>a.unmount?Xs.Unmount:Xs.Hidden);w({el:I,$el:I});let{show:P,appear:V}=WT(),{register:F,unregister:R}=XT(),$={value:!0},ne=wn(),oe={value:!1},ve=AA(()=>{oe.value||(z.value="hidden",R(ne),d("afterLeave"))});Kr(()=>{let xt=F(ne);uo(xt)}),bn(()=>{if(o.value===Xs.Hidden&&!!ne){if(P&&z.value!=="visible"){z.value="visible";return}Rn(z.value,{hidden:()=>R(ne),visible:()=>F(ne)})}});let Ie=Xa(a.enter),Ge=Xa(a.enterFrom),Ze=Xa(a.enterTo),st=Xa(a.entered),ft=Xa(a.leave),He=Xa(a.leaveFrom),yt=Xa(a.leaveTo);Kr(()=>{bn(()=>{if(z.value==="visible"){let xt=Ni(I);if(xt instanceof Comment&&xt.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function We(xt){let Et=$.value&&!V.value,gt=Ni(I);!gt||!(gt instanceof HTMLElement)||Et||(oe.value=!0,P.value&&d("beforeEnter"),P.value||d("beforeLeave"),xt(P.value?vv(gt,Ie,Ge,Ze,st,Ft=>{oe.value=!1,Ft===l_.Finished&&d("afterEnter")}):vv(gt,ft,He,yt,st,Ft=>{oe.value=!1,Ft===l_.Finished&&(Up(ve)||(z.value="hidden",R(ne),d("afterLeave")))})))}return Kr(()=>{An([P,V],(xt,Et,gt)=>{We(gt),$.value=!1},{immediate:!0})}),Ar(X_,ve),G_(Dt(()=>Rn(z.value,{visible:Fn.Open,hidden:Fn.Closed}))),()=>{let Bt=a,{appear:xt,show:Et,enter:gt,enterFrom:Ft,enterTo:At,entered:ei,leave:ri,leaveFrom:Er,leaveTo:vi}=Bt,fi=Do(Bt,["appear","show","enter","enterFrom","enterTo","entered","leave","leaveFrom","leaveTo"]);return _r({props:xn(ui({},fi),{ref:I}),slot:{},slots:A,attrs:g,features:bA,visible:z.value==="visible",name:"TransitionChild"})}}}),QT=HT,YT=hr({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(a,{emit:d,attrs:g,slots:A}){let w=Th(),I=Dt(()=>a.show===null&&w!==null?Rn(w.value,{[Fn.Open]:!0,[Fn.Closed]:!1}):a.show);bn(()=>{if(![!0,!1].includes(I.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let z=$t(I.value?"visible":"hidden"),o=AA(()=>{z.value="hidden"}),P={value:!0},V={show:I,appear:Dt(()=>a.appear||!P.value)};return Kr(()=>{bn(()=>{P.value=!1,I.value?z.value="visible":Up(o)||(z.value="hidden")})}),Ar(X_,o),Ar(W_,V),()=>{let F=iA(a,["show","appear","unmount"]),R={unmount:a.unmount};return _r({props:xn(ui({},R),{as:"template"}),slot:{},slots:xn(ui({},A),{default:()=>[cn(QT,ui(ui(ui({onBeforeEnter:()=>d("beforeEnter"),onAfterEnter:()=>d("afterEnter"),onBeforeLeave:()=>d("beforeLeave"),onAfterLeave:()=>d("afterLeave")},g),R),F),A.default)]}),attrs:{},features:bA,visible:z.value==="visible",name:"Transition"})}}});/*!
  * vue-router v4.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const wA=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",Ec=a=>wA?Symbol(a):"_vr_"+a,JT=Ec("rvlm"),Av=Ec("rvd"),Vp=Ec("r"),EA=Ec("rl"),c_=Ec("rvl"),dc=typeof window!="undefined";function KT(a){return a.__esModule||wA&&a[Symbol.toStringTag]==="Module"}const er=Object.assign;function Im(a,d){const g={};for(const A in d){const w=d[A];g[A]=Array.isArray(w)?w.map(a):a(w)}return g}const dh=()=>{},eS=/\/$/,tS=a=>a.replace(eS,"");function Cm(a,d,g="/"){let A,w={},I="",z="";const o=d.indexOf("?"),P=d.indexOf("#",o>-1?o:0);return o>-1&&(A=d.slice(0,o),I=d.slice(o+1,P>-1?P:d.length),w=a(I)),P>-1&&(A=A||d.slice(0,P),z=d.slice(P,d.length)),A=oS(A!=null?A:d,g),{fullPath:A+(I&&"?")+I+z,path:A,query:w,hash:z}}function iS(a,d){const g=d.query?a(d.query):"";return d.path+(g&&"?")+g+(d.hash||"")}function bv(a,d){return!d||!a.toLowerCase().startsWith(d.toLowerCase())?a:a.slice(d.length)||"/"}function rS(a,d,g){const A=d.matched.length-1,w=g.matched.length-1;return A>-1&&A===w&&yc(d.matched[A],g.matched[w])&&TA(d.params,g.params)&&a(d.query)===a(g.query)&&d.hash===g.hash}function yc(a,d){return(a.aliasOf||a)===(d.aliasOf||d)}function TA(a,d){if(Object.keys(a).length!==Object.keys(d).length)return!1;for(const g in a)if(!nS(a[g],d[g]))return!1;return!0}function nS(a,d){return Array.isArray(a)?wv(a,d):Array.isArray(d)?wv(d,a):a===d}function wv(a,d){return Array.isArray(d)?a.length===d.length&&a.every((g,A)=>g===d[A]):a.length===1&&a[0]===d}function oS(a,d){if(a.startsWith("/"))return a;if(!a)return d;const g=d.split("/"),A=a.split("/");let w=g.length-1,I,z;for(I=0;I<A.length;I++)if(z=A[I],!(w===1||z==="."))if(z==="..")w--;else break;return g.slice(0,w).join("/")+"/"+A.slice(I-(I===A.length?1:0)).join("/")}var bh;(function(a){a.pop="pop",a.push="push"})(bh||(bh={}));var ph;(function(a){a.back="back",a.forward="forward",a.unknown=""})(ph||(ph={}));function sS(a){if(!a)if(dc){const d=document.querySelector("base");a=d&&d.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),tS(a)}const aS=/^[^#]+#/;function lS(a,d){return a.replace(aS,"#")+d}function cS(a,d){const g=document.documentElement.getBoundingClientRect(),A=a.getBoundingClientRect();return{behavior:d.behavior,left:A.left-g.left-(d.left||0),top:A.top-g.top-(d.top||0)}}const jp=()=>({left:window.pageXOffset,top:window.pageYOffset});function uS(a){let d;if("el"in a){const g=a.el,A=typeof g=="string"&&g.startsWith("#"),w=typeof g=="string"?A?document.getElementById(g.slice(1)):document.querySelector(g):g;if(!w)return;d=cS(w,a)}else d=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(d):window.scrollTo(d.left!=null?d.left:window.pageXOffset,d.top!=null?d.top:window.pageYOffset)}function Ev(a,d){return(history.state?history.state.position-d:-1)+a}const u_=new Map;function hS(a,d){u_.set(a,d)}function dS(a){const d=u_.get(a);return u_.delete(a),d}let pS=()=>location.protocol+"//"+location.host;function SA(a,d){const{pathname:g,search:A,hash:w}=d,I=a.indexOf("#");if(I>-1){let o=w.includes(a.slice(I))?a.slice(I).length:1,P=w.slice(o);return P[0]!=="/"&&(P="/"+P),bv(P,"")}return bv(g,a)+A+w}function fS(a,d,g,A){let w=[],I=[],z=null;const o=({state:$})=>{const ne=SA(a,location),oe=g.value,ve=d.value;let Ie=0;if($){if(g.value=ne,d.value=$,z&&z===oe){z=null;return}Ie=ve?$.position-ve.position:0}else A(ne);w.forEach(Ge=>{Ge(g.value,oe,{delta:Ie,type:bh.pop,direction:Ie?Ie>0?ph.forward:ph.back:ph.unknown})})};function P(){z=g.value}function V($){w.push($);const ne=()=>{const oe=w.indexOf($);oe>-1&&w.splice(oe,1)};return I.push(ne),ne}function F(){const{history:$}=window;!$.state||$.replaceState(er({},$.state,{scroll:jp()}),"")}function R(){for(const $ of I)$();I=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",F)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",F),{pauseListeners:P,listen:V,destroy:R}}function Tv(a,d,g,A=!1,w=!1){return{back:a,current:d,forward:g,replaced:A,position:window.history.length,scroll:w?jp():null}}function mS(a){const{history:d,location:g}=window,A={value:SA(a,g)},w={value:d.state};w.value||I(A.value,{back:null,current:A.value,forward:null,position:d.length-1,replaced:!0,scroll:null},!0);function I(P,V,F){const R=a.indexOf("#"),$=R>-1?(g.host&&document.querySelector("base")?a:a.slice(R))+P:pS()+a+P;try{d[F?"replaceState":"pushState"](V,"",$),w.value=V}catch(ne){console.error(ne),g[F?"replace":"assign"]($)}}function z(P,V){const F=er({},d.state,Tv(w.value.back,P,w.value.forward,!0),V,{position:w.value.position});I(P,F,!0),A.value=P}function o(P,V){const F=er({},w.value,d.state,{forward:P,scroll:jp()});I(F.current,F,!0);const R=er({},Tv(A.value,P,null),{position:F.position+1},V);I(P,R,!1),A.value=P}return{location:A,state:w,push:o,replace:z}}function xM(a){a=sS(a);const d=mS(a),g=fS(a,d.state,d.location,d.replace);function A(I,z=!0){z||g.pauseListeners(),history.go(I)}const w=er({location:"",base:a,go:A,createHref:lS.bind(null,a)},d,g);return Object.defineProperty(w,"location",{enumerable:!0,get:()=>d.location.value}),Object.defineProperty(w,"state",{enumerable:!0,get:()=>d.state.value}),w}function _S(a){return typeof a=="string"||a&&typeof a=="object"}function IA(a){return typeof a=="string"||typeof a=="symbol"}const Ns={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},CA=Ec("nf");var Sv;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(Sv||(Sv={}));function xc(a,d){return er(new Error,{type:a,[CA]:!0},d)}function $s(a,d){return a instanceof Error&&CA in a&&(d==null||!!(a.type&d))}const Iv="[^/]+?",gS={sensitive:!1,strict:!1,start:!0,end:!0},yS=/[.+*?^${}()[\]/\\]/g;function xS(a,d){const g=er({},gS,d),A=[];let w=g.start?"^":"";const I=[];for(const V of a){const F=V.length?[]:[90];g.strict&&!V.length&&(w+="/");for(let R=0;R<V.length;R++){const $=V[R];let ne=40+(g.sensitive?.25:0);if($.type===0)R||(w+="/"),w+=$.value.replace(yS,"\\$&"),ne+=40;else if($.type===1){const{value:oe,repeatable:ve,optional:Ie,regexp:Ge}=$;I.push({name:oe,repeatable:ve,optional:Ie});const Ze=Ge||Iv;if(Ze!==Iv){ne+=10;try{new RegExp(`(${Ze})`)}catch(ft){throw new Error(`Invalid custom RegExp for param "${oe}" (${Ze}): `+ft.message)}}let st=ve?`((?:${Ze})(?:/(?:${Ze}))*)`:`(${Ze})`;R||(st=Ie&&V.length<2?`(?:/${st})`:"/"+st),Ie&&(st+="?"),w+=st,ne+=20,Ie&&(ne+=-8),ve&&(ne+=-20),Ze===".*"&&(ne+=-50)}F.push(ne)}A.push(F)}if(g.strict&&g.end){const V=A.length-1;A[V][A[V].length-1]+=.7000000000000001}g.strict||(w+="/?"),g.end?w+="$":g.strict&&(w+="(?:/|$)");const z=new RegExp(w,g.sensitive?"":"i");function o(V){const F=V.match(z),R={};if(!F)return null;for(let $=1;$<F.length;$++){const ne=F[$]||"",oe=I[$-1];R[oe.name]=ne&&oe.repeatable?ne.split("/"):ne}return R}function P(V){let F="",R=!1;for(const $ of a){(!R||!F.endsWith("/"))&&(F+="/"),R=!1;for(const ne of $)if(ne.type===0)F+=ne.value;else if(ne.type===1){const{value:oe,repeatable:ve,optional:Ie}=ne,Ge=oe in V?V[oe]:"";if(Array.isArray(Ge)&&!ve)throw new Error(`Provided param "${oe}" is an array but it is not repeatable (* or + modifiers)`);const Ze=Array.isArray(Ge)?Ge.join("/"):Ge;if(!Ze)if(Ie)$.length<2&&(F.endsWith("/")?F=F.slice(0,-1):R=!0);else throw new Error(`Missing required param "${oe}"`);F+=Ze}}return F}return{re:z,score:A,keys:I,parse:o,stringify:P}}function vS(a,d){let g=0;for(;g<a.length&&g<d.length;){const A=d[g]-a[g];if(A)return A;g++}return a.length<d.length?a.length===1&&a[0]===40+40?-1:1:a.length>d.length?d.length===1&&d[0]===40+40?1:-1:0}function AS(a,d){let g=0;const A=a.score,w=d.score;for(;g<A.length&&g<w.length;){const I=vS(A[g],w[g]);if(I)return I;g++}return w.length-A.length}const bS={type:0,value:""},wS=/[a-zA-Z0-9_]/;function ES(a){if(!a)return[[]];if(a==="/")return[[bS]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function d(ne){throw new Error(`ERR (${g})/"${V}": ${ne}`)}let g=0,A=g;const w=[];let I;function z(){I&&w.push(I),I=[]}let o=0,P,V="",F="";function R(){!V||(g===0?I.push({type:0,value:V}):g===1||g===2||g===3?(I.length>1&&(P==="*"||P==="+")&&d(`A repeatable param (${V}) must be alone in its segment. eg: '/:ids+.`),I.push({type:1,value:V,regexp:F,repeatable:P==="*"||P==="+",optional:P==="*"||P==="?"})):d("Invalid state to consume buffer"),V="")}function $(){V+=P}for(;o<a.length;){if(P=a[o++],P==="\\"&&g!==2){A=g,g=4;continue}switch(g){case 0:P==="/"?(V&&R(),z()):P===":"?(R(),g=1):$();break;case 4:$(),g=A;break;case 1:P==="("?g=2:wS.test(P)?$():(R(),g=0,P!=="*"&&P!=="?"&&P!=="+"&&o--);break;case 2:P===")"?F[F.length-1]=="\\"?F=F.slice(0,-1)+P:g=3:F+=P;break;case 3:R(),g=0,P!=="*"&&P!=="?"&&P!=="+"&&o--,F="";break;default:d("Unknown state");break}}return g===2&&d(`Unfinished custom RegExp for param "${V}"`),R(),z(),w}function TS(a,d,g){const A=xS(ES(a.path),g),w=er(A,{record:a,parent:d,children:[],alias:[]});return d&&!w.record.aliasOf==!d.record.aliasOf&&d.children.push(w),w}function SS(a,d){const g=[],A=new Map;d=Mv({strict:!1,end:!0,sensitive:!1},d);function w(F){return A.get(F)}function I(F,R,$){const ne=!$,oe=CS(F);oe.aliasOf=$&&$.record;const ve=Mv(d,F),Ie=[oe];if("alias"in F){const st=typeof F.alias=="string"?[F.alias]:F.alias;for(const ft of st)Ie.push(er({},oe,{components:$?$.record.components:oe.components,path:ft,aliasOf:$?$.record:oe}))}let Ge,Ze;for(const st of Ie){const{path:ft}=st;if(R&&ft[0]!=="/"){const He=R.record.path,yt=He[He.length-1]==="/"?"":"/";st.path=R.record.path+(ft&&yt+ft)}if(Ge=TS(st,R,ve),$?$.alias.push(Ge):(Ze=Ze||Ge,Ze!==Ge&&Ze.alias.push(Ge),ne&&F.name&&!Cv(Ge)&&z(F.name)),"children"in oe){const He=oe.children;for(let yt=0;yt<He.length;yt++)I(He[yt],Ge,$&&$.children[yt])}$=$||Ge,P(Ge)}return Ze?()=>{z(Ze)}:dh}function z(F){if(IA(F)){const R=A.get(F);R&&(A.delete(F),g.splice(g.indexOf(R),1),R.children.forEach(z),R.alias.forEach(z))}else{const R=g.indexOf(F);R>-1&&(g.splice(R,1),F.record.name&&A.delete(F.record.name),F.children.forEach(z),F.alias.forEach(z))}}function o(){return g}function P(F){let R=0;for(;R<g.length&&AS(F,g[R])>=0&&(F.record.path!==g[R].record.path||!MA(F,g[R]));)R++;g.splice(R,0,F),F.record.name&&!Cv(F)&&A.set(F.record.name,F)}function V(F,R){let $,ne={},oe,ve;if("name"in F&&F.name){if($=A.get(F.name),!$)throw xc(1,{location:F});ve=$.record.name,ne=er(IS(R.params,$.keys.filter(Ze=>!Ze.optional).map(Ze=>Ze.name)),F.params),oe=$.stringify(ne)}else if("path"in F)oe=F.path,$=g.find(Ze=>Ze.re.test(oe)),$&&(ne=$.parse(oe),ve=$.record.name);else{if($=R.name?A.get(R.name):g.find(Ze=>Ze.re.test(R.path)),!$)throw xc(1,{location:F,currentLocation:R});ve=$.record.name,ne=er({},R.params,F.params),oe=$.stringify(ne)}const Ie=[];let Ge=$;for(;Ge;)Ie.unshift(Ge.record),Ge=Ge.parent;return{name:ve,path:oe,params:ne,matched:Ie,meta:zS(Ie)}}return a.forEach(F=>I(F)),{addRoute:I,resolve:V,removeRoute:z,getRoutes:o,getRecordMatcher:w}}function IS(a,d){const g={};for(const A of d)A in a&&(g[A]=a[A]);return g}function CS(a){return{path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:void 0,beforeEnter:a.beforeEnter,props:MS(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||{}:{default:a.component}}}function MS(a){const d={},g=a.props||!1;if("component"in a)d.default=g;else for(const A in a.components)d[A]=typeof g=="boolean"?g:g[A];return d}function Cv(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function zS(a){return a.reduce((d,g)=>er(d,g.meta),{})}function Mv(a,d){const g={};for(const A in a)g[A]=A in d?d[A]:a[A];return g}function MA(a,d){return d.children.some(g=>g===a||MA(a,g))}const zA=/#/g,kS=/&/g,PS=/\//g,DS=/=/g,BS=/\?/g,kA=/\+/g,LS=/%5B/g,RS=/%5D/g,PA=/%5E/g,OS=/%60/g,DA=/%7B/g,FS=/%7C/g,BA=/%7D/g,US=/%20/g;function H_(a){return encodeURI(""+a).replace(FS,"|").replace(LS,"[").replace(RS,"]")}function VS(a){return H_(a).replace(DA,"{").replace(BA,"}").replace(PA,"^")}function h_(a){return H_(a).replace(kA,"%2B").replace(US,"+").replace(zA,"%23").replace(kS,"%26").replace(OS,"`").replace(DA,"{").replace(BA,"}").replace(PA,"^")}function jS(a){return h_(a).replace(DS,"%3D")}function NS(a){return H_(a).replace(zA,"%23").replace(BS,"%3F")}function $S(a){return a==null?"":NS(a).replace(PS,"%2F")}function Cp(a){try{return decodeURIComponent(""+a)}catch{}return""+a}function GS(a){const d={};if(a===""||a==="?")return d;const A=(a[0]==="?"?a.slice(1):a).split("&");for(let w=0;w<A.length;++w){const I=A[w].replace(kA," "),z=I.indexOf("="),o=Cp(z<0?I:I.slice(0,z)),P=z<0?null:Cp(I.slice(z+1));if(o in d){let V=d[o];Array.isArray(V)||(V=d[o]=[V]),V.push(P)}else d[o]=P}return d}function zv(a){let d="";for(let g in a){const A=a[g];if(g=jS(g),A==null){A!==void 0&&(d+=(d.length?"&":"")+g);continue}(Array.isArray(A)?A.map(I=>I&&h_(I)):[A&&h_(A)]).forEach(I=>{I!==void 0&&(d+=(d.length?"&":"")+g,I!=null&&(d+="="+I))})}return d}function ZS(a){const d={};for(const g in a){const A=a[g];A!==void 0&&(d[g]=Array.isArray(A)?A.map(w=>w==null?null:""+w):A==null?A:""+A)}return d}function ih(){let a=[];function d(A){return a.push(A),()=>{const w=a.indexOf(A);w>-1&&a.splice(w,1)}}function g(){a=[]}return{add:d,list:()=>a,reset:g}}function Ws(a,d,g,A,w){const I=A&&(A.enterCallbacks[w]=A.enterCallbacks[w]||[]);return()=>new Promise((z,o)=>{const P=R=>{R===!1?o(xc(4,{from:g,to:d})):R instanceof Error?o(R):_S(R)?o(xc(2,{from:d,to:R})):(I&&A.enterCallbacks[w]===I&&typeof R=="function"&&I.push(R),z())},V=a.call(A&&A.instances[w],d,g,P);let F=Promise.resolve(V);a.length<3&&(F=F.then(P)),F.catch(R=>o(R))})}function Mm(a,d,g,A){const w=[];for(const I of a)for(const z in I.components){let o=I.components[z];if(!(d!=="beforeRouteEnter"&&!I.instances[z]))if(qS(o)){const V=(o.__vccOpts||o)[d];V&&w.push(Ws(V,g,A,I,z))}else{let P=o();w.push(()=>P.then(V=>{if(!V)return Promise.reject(new Error(`Couldn't resolve component "${z}" at "${I.path}"`));const F=KT(V)?V.default:V;I.components[z]=F;const $=(F.__vccOpts||F)[d];return $&&Ws($,g,A,I,z)()}))}}return w}function qS(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function kv(a){const d=ir(Vp),g=ir(EA),A=Dt(()=>d.resolve(hi(a.to))),w=Dt(()=>{const{matched:P}=A.value,{length:V}=P,F=P[V-1],R=g.matched;if(!F||!R.length)return-1;const $=R.findIndex(yc.bind(null,F));if($>-1)return $;const ne=Pv(P[V-2]);return V>1&&Pv(F)===ne&&R[R.length-1].path!==ne?R.findIndex(yc.bind(null,P[V-2])):$}),I=Dt(()=>w.value>-1&&QS(g.params,A.value.params)),z=Dt(()=>w.value>-1&&w.value===g.matched.length-1&&TA(g.params,A.value.params));function o(P={}){return HS(P)?d[hi(a.replace)?"replace":"push"](hi(a.to)).catch(dh):Promise.resolve()}return{route:A,href:Dt(()=>A.value.href),isActive:I,isExactActive:z,navigate:o}}const WS=hr({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:kv,setup(a,{slots:d}){const g=Fo(kv(a)),{options:A}=ir(Vp),w=Dt(()=>({[Dv(a.activeClass,A.linkActiveClass,"router-link-active")]:g.isActive,[Dv(a.exactActiveClass,A.linkExactActiveClass,"router-link-exact-active")]:g.isExactActive}));return()=>{const I=d.default&&d.default(g);return a.custom?I:cn("a",{"aria-current":g.isExactActive?a.ariaCurrentValue:null,href:g.href,onClick:g.navigate,class:w.value},I)}}}),XS=WS;function HS(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const d=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(d))return}return a.preventDefault&&a.preventDefault(),!0}}function QS(a,d){for(const g in d){const A=d[g],w=a[g];if(typeof A=="string"){if(A!==w)return!1}else if(!Array.isArray(w)||w.length!==A.length||A.some((I,z)=>I!==w[z]))return!1}return!0}function Pv(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const Dv=(a,d,g)=>a!=null?a:d!=null?d:g,YS=hr({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(a,{attrs:d,slots:g}){const A=ir(c_),w=Dt(()=>a.route||A.value),I=ir(Av,0),z=Dt(()=>w.value.matched[I]);Ar(Av,I+1),Ar(JT,z),Ar(c_,w);const o=$t();return An(()=>[o.value,z.value,a.name],([P,V,F],[R,$,ne])=>{V&&(V.instances[F]=P,$&&$!==V&&P&&P===R&&(V.leaveGuards.size||(V.leaveGuards=$.leaveGuards),V.updateGuards.size||(V.updateGuards=$.updateGuards))),P&&V&&(!$||!yc(V,$)||!R)&&(V.enterCallbacks[F]||[]).forEach(oe=>oe(P))},{flush:"post"}),()=>{const P=w.value,V=z.value,F=V&&V.components[a.name],R=a.name;if(!F)return Bv(g.default,{Component:F,route:P});const $=V.props[a.name],ne=$?$===!0?P.params:typeof $=="function"?$(P):$:null,ve=cn(F,er({},ne,d,{onVnodeUnmounted:Ie=>{Ie.component.isUnmounted&&(V.instances[R]=null)},ref:o}));return Bv(g.default,{Component:ve,route:P})||ve}}});function Bv(a,d){if(!a)return null;const g=a(d);return g.length===1?g[0]:g}const JS=YS;function vM(a){const d=SS(a.routes,a),g=a.parseQuery||GS,A=a.stringifyQuery||zv,w=a.history,I=ih(),z=ih(),o=ih(),P=y2(Ns);let V=Ns;dc&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const F=Im.bind(null,$e=>""+$e),R=Im.bind(null,$S),$=Im.bind(null,Cp);function ne($e,Tt){let ut,kt;return IA($e)?(ut=d.getRecordMatcher($e),kt=Tt):kt=$e,d.addRoute(kt,ut)}function oe($e){const Tt=d.getRecordMatcher($e);Tt&&d.removeRoute(Tt)}function ve(){return d.getRoutes().map($e=>$e.record)}function Ie($e){return!!d.getRecordMatcher($e)}function Ge($e,Tt){if(Tt=er({},Tt||P.value),typeof $e=="string"){const qt=Cm(g,$e,Tt.path),ce=d.resolve({path:qt.path},Tt),_e=w.createHref(qt.fullPath);return er(qt,ce,{params:$(ce.params),hash:Cp(qt.hash),redirectedFrom:void 0,href:_e})}let ut;if("path"in $e)ut=er({},$e,{path:Cm(g,$e.path,Tt.path).path});else{const qt=er({},$e.params);for(const ce in qt)qt[ce]==null&&delete qt[ce];ut=er({},$e,{params:R($e.params)}),Tt.params=R(Tt.params)}const kt=d.resolve(ut,Tt),Ei=$e.hash||"";kt.params=F($(kt.params));const yi=iS(A,er({},$e,{hash:VS(Ei),path:kt.path})),ni=w.createHref(yi);return er({fullPath:yi,hash:Ei,query:A===zv?ZS($e.query):$e.query||{}},kt,{redirectedFrom:void 0,href:ni})}function Ze($e){return typeof $e=="string"?Cm(g,$e,P.value.path):er({},$e)}function st($e,Tt){if(V!==$e)return xc(8,{from:Tt,to:$e})}function ft($e){return We($e)}function He($e){return ft(er(Ze($e),{replace:!0}))}function yt($e){const Tt=$e.matched[$e.matched.length-1];if(Tt&&Tt.redirect){const{redirect:ut}=Tt;let kt=typeof ut=="function"?ut($e):ut;return typeof kt=="string"&&(kt=kt.includes("?")||kt.includes("#")?kt=Ze(kt):{path:kt},kt.params={}),er({query:$e.query,hash:$e.hash,params:$e.params},kt)}}function We($e,Tt){const ut=V=Ge($e),kt=P.value,Ei=$e.state,yi=$e.force,ni=$e.replace===!0,qt=yt(ut);if(qt)return We(er(Ze(qt),{state:Ei,force:yi,replace:ni}),Tt||ut);const ce=ut;ce.redirectedFrom=Tt;let _e;return!yi&&rS(A,kt,ut)&&(_e=xc(16,{to:ce,from:kt}),lr(kt,kt,!0,!1)),(_e?Promise.resolve(_e):Et(ce,kt)).catch(ke=>$s(ke)?$s(ke,2)?ke:$i(ke):fi(ke,ce,kt)).then(ke=>{if(ke){if($s(ke,2))return We(er(Ze(ke.to),{state:Ei,force:yi,replace:ni}),Tt||ce)}else ke=Ft(ce,kt,!0,ni,Ei);return gt(ce,kt,ke),ke})}function xt($e,Tt){const ut=st($e,Tt);return ut?Promise.reject(ut):Promise.resolve()}function Et($e,Tt){let ut;const[kt,Ei,yi]=KS($e,Tt);ut=Mm(kt.reverse(),"beforeRouteLeave",$e,Tt);for(const qt of kt)qt.leaveGuards.forEach(ce=>{ut.push(Ws(ce,$e,Tt))});const ni=xt.bind(null,$e,Tt);return ut.push(ni),oc(ut).then(()=>{ut=[];for(const qt of I.list())ut.push(Ws(qt,$e,Tt));return ut.push(ni),oc(ut)}).then(()=>{ut=Mm(Ei,"beforeRouteUpdate",$e,Tt);for(const qt of Ei)qt.updateGuards.forEach(ce=>{ut.push(Ws(ce,$e,Tt))});return ut.push(ni),oc(ut)}).then(()=>{ut=[];for(const qt of $e.matched)if(qt.beforeEnter&&!Tt.matched.includes(qt))if(Array.isArray(qt.beforeEnter))for(const ce of qt.beforeEnter)ut.push(Ws(ce,$e,Tt));else ut.push(Ws(qt.beforeEnter,$e,Tt));return ut.push(ni),oc(ut)}).then(()=>($e.matched.forEach(qt=>qt.enterCallbacks={}),ut=Mm(yi,"beforeRouteEnter",$e,Tt),ut.push(ni),oc(ut))).then(()=>{ut=[];for(const qt of z.list())ut.push(Ws(qt,$e,Tt));return ut.push(ni),oc(ut)}).catch(qt=>$s(qt,8)?qt:Promise.reject(qt))}function gt($e,Tt,ut){for(const kt of o.list())kt($e,Tt,ut)}function Ft($e,Tt,ut,kt,Ei){const yi=st($e,Tt);if(yi)return yi;const ni=Tt===Ns,qt=dc?history.state:{};ut&&(kt||ni?w.replace($e.fullPath,er({scroll:ni&&qt&&qt.scroll},Ei)):w.push($e.fullPath,Ei)),P.value=$e,lr($e,Tt,ut,ni),$i()}let At;function ei(){At=w.listen(($e,Tt,ut)=>{const kt=Ge($e),Ei=yt(kt);if(Ei){We(er(Ei,{replace:!0}),kt).catch(dh);return}V=kt;const yi=P.value;dc&&hS(Ev(yi.fullPath,ut.delta),jp()),Et(kt,yi).catch(ni=>$s(ni,12)?ni:$s(ni,2)?(We(ni.to,kt).then(qt=>{$s(qt,20)&&!ut.delta&&ut.type===bh.pop&&w.go(-1,!1)}).catch(dh),Promise.reject()):(ut.delta&&w.go(-ut.delta,!1),fi(ni,kt,yi))).then(ni=>{ni=ni||Ft(kt,yi,!1),ni&&(ut.delta?w.go(-ut.delta,!1):ut.type===bh.pop&&$s(ni,20)&&w.go(-1,!1)),gt(kt,yi,ni)}).catch(dh)})}let ri=ih(),Er=ih(),vi;function fi($e,Tt,ut){$i($e);const kt=Er.list();return kt.length?kt.forEach(Ei=>Ei($e,Tt,ut)):console.error($e),Promise.reject($e)}function Bt(){return vi&&P.value!==Ns?Promise.resolve():new Promise(($e,Tt)=>{ri.add([$e,Tt])})}function $i($e){return vi||(vi=!$e,ei(),ri.list().forEach(([Tt,ut])=>$e?ut($e):Tt()),ri.reset()),$e}function lr($e,Tt,ut,kt){const{scrollBehavior:Ei}=a;if(!dc||!Ei)return Promise.resolve();const yi=!ut&&dS(Ev($e.fullPath,0))||(kt||!ut)&&history.state&&history.state.scroll||null;return Ln().then(()=>Ei($e,Tt,yi)).then(ni=>ni&&uS(ni)).catch(ni=>fi(ni,$e,Tt))}const Ur=$e=>w.go($e);let Ai;const Oi=new Set;return{currentRoute:P,addRoute:ne,removeRoute:oe,hasRoute:Ie,getRoutes:ve,resolve:Ge,options:a,push:ft,replace:He,go:Ur,back:()=>Ur(-1),forward:()=>Ur(1),beforeEach:I.add,beforeResolve:z.add,afterEach:o.add,onError:Er.add,isReady:Bt,install($e){const Tt=this;$e.component("RouterLink",XS),$e.component("RouterView",JS),$e.config.globalProperties.$router=Tt,Object.defineProperty($e.config.globalProperties,"$route",{enumerable:!0,get:()=>hi(P)}),dc&&!Ai&&P.value===Ns&&(Ai=!0,ft(w.location).catch(Ei=>{}));const ut={};for(const Ei in Ns)ut[Ei]=Dt(()=>P.value[Ei]);$e.provide(Vp,Tt),$e.provide(EA,Fo(ut)),$e.provide(c_,P);const kt=$e.unmount;Oi.add($e),$e.unmount=function(){Oi.delete($e),Oi.size<1&&(V=Ns,At&&At(),P.value=Ns,Ai=!1,vi=!1),kt()}}}}function oc(a){return a.reduce((d,g)=>d.then(()=>g()),Promise.resolve())}function KS(a,d){const g=[],A=[],w=[],I=Math.max(d.matched.length,a.matched.length);for(let z=0;z<I;z++){const o=d.matched[z];o&&(a.matched.find(V=>yc(V,o))?A.push(o):g.push(o));const P=a.matched[z];P&&(d.matched.find(V=>yc(V,P))||w.push(P))}return[g,A,w]}function AM(){return ir(Vp)}var eI=!1;/*!
  * pinia v2.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let LA;const Np=a=>LA=a,RA=Symbol();function d_(a){return a&&typeof a=="object"&&Object.prototype.toString.call(a)==="[object Object]"&&typeof a.toJSON!="function"}var fh;(function(a){a.direct="direct",a.patchObject="patch object",a.patchFunction="patch function"})(fh||(fh={}));function bM(){const a=n0(!0),d=a.run(()=>$t({}));let g=[],A=[];const w=gc({install(I){Np(w),w._a=I,I.provide(RA,w),I.config.globalProperties.$pinia=w,A.forEach(z=>g.push(z)),A=[]},use(I){return!this._a&&!eI?A.push(I):g.push(I),this},_p:g,_a:null,_e:a,_s:new Map,state:d});return w}const OA=()=>{};function Lv(a,d,g,A=OA){a.push(d);const w=()=>{const I=a.indexOf(d);I>-1&&(a.splice(I,1),A())};return!g&&Eh()&&uo(w),w}function sc(a,...d){a.slice().forEach(g=>{g(...d)})}function p_(a,d){for(const g in d){if(!d.hasOwnProperty(g))continue;const A=d[g],w=a[g];d_(w)&&d_(A)&&a.hasOwnProperty(g)&&!ar(A)&&!as(A)?a[g]=p_(w,A):a[g]=A}return a}const tI=Symbol();function iI(a){return!d_(a)||!a.hasOwnProperty(tI)}const{assign:os}=Object;function rI(a){return!!(ar(a)&&a.effect)}function nI(a,d,g,A){const{state:w,actions:I,getters:z}=d,o=g.state.value[a];let P;function V(){o||(g.state.value[a]=w?w():{});const F=A2(g.state.value[a]);return os(F,I,Object.keys(z||{}).reduce((R,$)=>(R[$]=gc(Dt(()=>{Np(g);const ne=g._s.get(a);return z[$].call(ne,ne)})),R),{}))}return P=FA(a,V,d,g),P.$reset=function(){const R=w?w():{};this.$patch($=>{os($,R)})},P}function FA(a,d,g={},A,w){let I;const z=g.state,o=os({actions:{}},g),P={deep:!0};let V,F,R=gc([]),$=gc([]),ne;const oe=A.state.value[a];!z&&!oe&&(A.state.value[a]={}),$t({});function ve(yt){let We;V=F=!1,typeof yt=="function"?(yt(A.state.value[a]),We={type:fh.patchFunction,storeId:a,events:ne}):(p_(A.state.value[a],yt),We={type:fh.patchObject,payload:yt,storeId:a,events:ne}),Ln().then(()=>{V=!0}),F=!0,sc(R,We,A.state.value[a])}const Ie=OA;function Ge(){I.stop(),R=[],$=[],A._s.delete(a)}function Ze(yt,We){return function(){Np(A);const xt=Array.from(arguments),Et=[],gt=[];function Ft(ri){Et.push(ri)}function At(ri){gt.push(ri)}sc($,{args:xt,name:yt,store:ft,after:Ft,onError:At});let ei;try{ei=We.apply(this&&this.$id===a?this:ft,xt)}catch(ri){throw sc(gt,ri),ri}return ei instanceof Promise?ei.then(ri=>(sc(Et,ri),ri)).catch(ri=>(sc(gt,ri),Promise.reject(ri))):(sc(Et,ei),ei)}}const st={_p:A,$id:a,$onAction:Lv.bind(null,$),$patch:ve,$reset:Ie,$subscribe(yt,We={}){const xt=Lv(R,yt,We.detached,()=>Et()),Et=I.run(()=>An(()=>A.state.value[a],gt=>{(We.flush==="sync"?F:V)&&yt({storeId:a,type:fh.direct,events:ne},gt)},os({},P,We)));return xt},$dispose:Ge},ft=Fo(os({},st));A._s.set(a,ft);const He=A._e.run(()=>(I=n0(),I.run(()=>d())));for(const yt in He){const We=He[yt];if(ar(We)&&!rI(We)||as(We))z||(oe&&iI(We)&&(ar(We)?We.value=oe[yt]:p_(We,oe[yt])),A.state.value[a][yt]=We);else if(typeof We=="function"){const xt=Ze(yt,We);He[yt]=xt,o.actions[yt]=We}}return os(ft,He),os(Ri(ft),He),Object.defineProperty(ft,"$state",{get:()=>A.state.value[a],set:yt=>{ve(We=>{os(We,yt)})}}),A._p.forEach(yt=>{os(ft,I.run(()=>yt({store:ft,app:A._a,pinia:A,options:o})))}),oe&&z&&g.hydrate&&g.hydrate(ft.$state,oe),V=!0,F=!0,ft}function wM(a,d,g){let A,w;const I=typeof d=="function";typeof a=="string"?(A=a,w=I?g:d):(w=a,A=a.id);function z(o,P){const V=Eh();return o=o||V&&ir(RA),o&&Np(o),o=LA,o._s.has(A)||(I?FA(A,d,w,o):nI(A,w,o)),o._s.get(A)}return z.$id=A,z}try{self["workbox:window:6.5.2"]&&_()}catch{}function Rv(a,d){return new Promise(function(g){var A=new MessageChannel;A.port1.onmessage=function(w){g(w.data)},a.postMessage(d,[A.port2])})}function oI(a,d){for(var g=0;g<d.length;g++){var A=d[g];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(a,A.key,A)}}function Ov(a,d){(d==null||d>a.length)&&(d=a.length);for(var g=0,A=new Array(d);g<d;g++)A[g]=a[g];return A}function sI(a,d){var g;if(typeof Symbol=="undefined"||a[Symbol.iterator]==null){if(Array.isArray(a)||(g=function(w,I){if(w){if(typeof w=="string")return Ov(w,I);var z=Object.prototype.toString.call(w).slice(8,-1);return z==="Object"&&w.constructor&&(z=w.constructor.name),z==="Map"||z==="Set"?Array.from(w):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?Ov(w,I):void 0}}(a))||d&&a&&typeof a.length=="number"){g&&(a=g);var A=0;return function(){return A>=a.length?{done:!0}:{done:!1,value:a[A++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(g=a[Symbol.iterator]()).next.bind(g)}try{self["workbox:core:6.5.2"]&&_()}catch{}var zm=function(){var a=this;this.promise=new Promise(function(d,g){a.resolve=d,a.reject=g})};function km(a,d){var g=location.href;return new URL(a,g).href===new URL(d,g).href}var rh=function(a,d){this.type=a,Object.assign(this,d)};function hp(a,d,g){return g?d?d(a):a:(a&&a.then||(a=Promise.resolve(a)),d?a.then(d):a)}function aI(){}var lI={type:"SKIP_WAITING"};function Fv(a,d){if(!d)return a&&a.then?a.then(aI):Promise.resolve()}var EM=function(a){var d,g;function A(o,P){var V,F;return P===void 0&&(P={}),(V=a.call(this)||this).nn={},V.tn=0,V.rn=new zm,V.en=new zm,V.on=new zm,V.un=0,V.an=new Set,V.cn=function(){var R=V.fn,$=R.installing;V.tn>0||!km($.scriptURL,V.sn.toString())||performance.now()>V.un+6e4?(V.vn=$,R.removeEventListener("updatefound",V.cn)):(V.hn=$,V.an.add($),V.rn.resolve($)),++V.tn,$.addEventListener("statechange",V.ln)},V.ln=function(R){var $=V.fn,ne=R.target,oe=ne.state,ve=ne===V.vn,Ie={sw:ne,isExternal:ve,originalEvent:R};!ve&&V.mn&&(Ie.isUpdate=!0),V.dispatchEvent(new rh(oe,Ie)),oe==="installed"?V.wn=self.setTimeout(function(){oe==="installed"&&$.waiting===ne&&V.dispatchEvent(new rh("waiting",Ie))},200):oe==="activating"&&(clearTimeout(V.wn),ve||V.en.resolve(ne))},V.dn=function(R){var $=V.hn,ne=$!==navigator.serviceWorker.controller;V.dispatchEvent(new rh("controlling",{isExternal:ne,originalEvent:R,sw:$,isUpdate:V.mn})),ne||V.on.resolve($)},V.gn=(F=function(R){var $=R.data,ne=R.ports,oe=R.source;return hp(V.getSW(),function(){V.an.has(oe)&&V.dispatchEvent(new rh("message",{data:$,originalEvent:R,ports:ne,sw:oe}))})},function(){for(var R=[],$=0;$<arguments.length;$++)R[$]=arguments[$];try{return Promise.resolve(F.apply(this,R))}catch(ne){return Promise.reject(ne)}}),V.sn=o,V.nn=P,navigator.serviceWorker.addEventListener("message",V.gn),V}g=a,(d=A).prototype=Object.create(g.prototype),d.prototype.constructor=d,d.__proto__=g;var w,I,z=A.prototype;return z.register=function(o){var P=(o===void 0?{}:o).immediate,V=P!==void 0&&P;try{var F=this;return function(R,$){var ne=R();return ne&&ne.then?ne.then($):$(ne)}(function(){if(!V&&document.readyState!=="complete")return Fv(new Promise(function(R){return window.addEventListener("load",R)}))},function(){return F.mn=Boolean(navigator.serviceWorker.controller),F.yn=F.pn(),hp(F.bn(),function(R){F.fn=R,F.yn&&(F.hn=F.yn,F.en.resolve(F.yn),F.on.resolve(F.yn),F.yn.addEventListener("statechange",F.ln,{once:!0}));var $=F.fn.waiting;return $&&km($.scriptURL,F.sn.toString())&&(F.hn=$,Promise.resolve().then(function(){F.dispatchEvent(new rh("waiting",{sw:$,wasWaitingBeforeRegister:!0}))}).then(function(){})),F.hn&&(F.rn.resolve(F.hn),F.an.add(F.hn)),F.fn.addEventListener("updatefound",F.cn),navigator.serviceWorker.addEventListener("controllerchange",F.dn),F.fn})})}catch(R){return Promise.reject(R)}},z.update=function(){try{return this.fn?Fv(this.fn.update()):void 0}catch(o){return Promise.reject(o)}},z.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},z.messageSW=function(o){try{return hp(this.getSW(),function(P){return Rv(P,o)})}catch(P){return Promise.reject(P)}},z.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&Rv(this.fn.waiting,lI)},z.pn=function(){var o=navigator.serviceWorker.controller;return o&&km(o.scriptURL,this.sn.toString())?o:void 0},z.bn=function(){try{var o=this;return function(P,V){try{var F=P()}catch(R){return V(R)}return F&&F.then?F.then(void 0,V):F}(function(){return hp(navigator.serviceWorker.register(o.sn,o.nn),function(P){return o.un=performance.now(),P})},function(P){throw P})}catch(P){return Promise.reject(P)}},w=A,(I=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&oI(w.prototype,I),A}(function(){function a(){this.Pn=new Map}var d=a.prototype;return d.addEventListener=function(g,A){this.Sn(g).add(A)},d.removeEventListener=function(g,A){this.Sn(g).delete(A)},d.dispatchEvent=function(g){g.target=this;for(var A,w=sI(this.Sn(g.type));!(A=w()).done;)(0,A.value)(g)},d.Sn=function(g){return this.Pn.has(g)||this.Pn.set(g,new Set),this.Pn.get(g)},a}()),cI=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},uI={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"};const{webm:hI,mp4:dI}=uI,Pm=()=>typeof navigator!="undefined"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,Dm=()=>"wakeLock"in navigator;class pI{constructor(){if(this.enabled=!1,Dm()){this._wakeLock=null;const d=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",d),document.addEventListener("fullscreenchange",d)}else Pm()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",hI),this._addSourceToVideo(this.noSleepVideo,"mp4",dI),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(d,g,A){var w=document.createElement("source");w.src=A,w.type=`video/${g}`,d.appendChild(w)}get isEnabled(){return this.enabled}enable(){return Dm()?navigator.wakeLock.request("screen").then(d=>{this._wakeLock=d,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(d=>{throw this.enabled=!1,console.error(`${d.name}, ${d.message}`),d}):Pm()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(g=>(this.enabled=!0,g)).catch(g=>{throw this.enabled=!1,g})}disable(){Dm()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):Pm()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var TM=pI;function SM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})])}function IM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])}function CM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function MM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function zM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])}function kM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})])}function PM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])}function DM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})])}function BM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"})])}function LM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}function RM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function OM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function FM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[Wi("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])}var UA={exports:{}};(function(a,d){(function(g,A){a.exports=A()})(cI,function(){var g,A,w;function I(o,P){if(!g)g=P;else if(!A)A=P;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+A+")(sharedChunk); self.onerror = null;",F={};g(F),w=P(F),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}I(["exports"],function(o){var P=typeof self!="undefined"?self:{},V=F;function F(i,e,t,n){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=t,this.p2y=n}F.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},F.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},F.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},F.prototype.solveCurveX=function(i,e){var t,n,l,u,p;for(e===void 0&&(e=1e-6),l=i,p=0;p<8;p++){if(u=this.sampleCurveX(l)-i,Math.abs(u)<e)return l;var f=this.sampleCurveDerivativeX(l);if(Math.abs(f)<1e-6)break;l-=u/f}if((l=i)<(t=0))return t;if(l>(n=1))return n;for(;t<n;){if(u=this.sampleCurveX(l),Math.abs(u-i)<e)return l;i>u?t=l:n=l,l=.5*(n-t)+t}return l},F.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var R=$;function $(i,e){this.x=i,this.y=e}$.prototype={clone:function(){return new $(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),n=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=n,this},_rotateAround:function(i,e){var t=Math.cos(i),n=Math.sin(i),l=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-n*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},$.convert=function(i){return i instanceof $?i:Array.isArray(i)?new $(i[0],i[1]):i};const ne=Math.PI/180,oe=180/Math.PI;function ve(i){return i*ne}function Ie(i){return i*oe}const Ge=[[0,0],[1,0],[1,1],[0,1]];function Ze(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function st(i,e,t,n){const l=new V(i,e,t,n);return function(u){return l.solve(u)}}const ft=st(.25,.1,.25,1);function He(i,e,t){return Math.min(t,Math.max(e,i))}function yt(i,e,t){return(t=He((t-i)/(e-i),0,1))*t*(3-2*t)}function We(i,e,t){const n=t-e,l=((i-e)%n+n)%n+e;return l===e?t:l}function xt(i,e,t){if(!i.length)return t(null,[]);let n=i.length;const l=new Array(i.length);let u=null;i.forEach((p,f)=>{e(p,(x,v)=>{x&&(u=x),l[f]=v,--n==0&&t(u,l)})})}function Et(i){const e=[];for(const t in i)e.push(i[t]);return e}function gt(i,...e){for(const t of e)for(const n in t)i[n]=t[n];return i}let Ft=1;function At(){return Ft++}function ei(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function ri(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Er(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function vi(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function fi(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Bt(i,e,t){const n={};for(const l in i)n[l]=e.call(t||this,i[l],l,i);return n}function $i(i,e,t){const n={};for(const l in i)e.call(t||this,i[l],l,i)&&(n[l]=i[l]);return n}function lr(i){return Array.isArray(i)?i.map(lr):typeof i=="object"&&i?Bt(i,lr):i}const Ur={};function Ai(i){Ur[i]||(typeof console!="undefined"&&console.warn(i),Ur[i]=!0)}function Oi(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function tn(i){let e=0;for(let t,n,l=0,u=i.length,p=u-1;l<u;p=l++)t=i[l],n=i[p],e+=(n.x-t.x)*(t.y+n.y);return e}function $e(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Tt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,l,u)=>{const p=l||u;return e[n]=!p||p.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let ut=null;function kt(i){if(ut==null){const e=i.navigator?i.navigator.userAgent:null;ut=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ut}function Ei(i){try{const e=P[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function yi(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const ni=P.performance;function qt(i){const e=i?i.url.toString():void 0;return ni.getEntriesByName(e)}var ce="2.10.0";let _e,ke,Qe,Xe;const rt={now:()=>Qe!==void 0?Qe:P.performance.now(),setNow(i){Qe=i},restoreNow(){Qe=void 0},frame(i){const e=P.requestAnimationFrame(i);return{cancel:()=>P.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:n}=i;Xe||(Xe=P.document.createElement("canvas"));const l=Xe.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(t>Xe.width||n>Xe.height)&&(Xe.width=t,Xe.height=n),l.clearRect(-e,-e,t+2*e,n+2*e),l.drawImage(i,0,0,t,n),l.getImageData(-e,-e,t+2*e,n+2*e)},resolveURL:i=>(_e||(_e=P.document.createElement("a")),_e.href=i,_e.href),get devicePixelRatio(){return P.devicePixelRatio},get prefersReducedMotion(){return!!P.matchMedia&&(ke==null&&(ke=P.matchMedia("(prefers-reduced-motion: reduce)")),ke.matches)}};let vt;const Ue={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(vt==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{vt={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{vt=i}}return vt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},lt={supported:!1,testSupport:function(i){!St&&zt&&(Rt?Gt(i):tt=i)}};let tt,zt,St=!1,Rt=!1;function Gt(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,zt),i.isContextLost())return;lt.supported=!0}catch{}i.deleteTexture(e),St=!0}P.document&&(zt=P.document.createElement("img"),zt.onload=function(){tt&&Gt(tt),tt=null,Rt=!0},zt.onerror=function(){St=!0,tt=null},zt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const li="01",di="NO_ACCESS_TOKEN";function pi(i){return i.indexOf("mapbox:")===0}function Ti(i){return Ue.API_URL_REGEX.test(i)}const zr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fr(i){const e=i.match(zr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function hn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Un(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(P.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ho{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Un(Ue.ACCESS_TOKEN);let n="";return n=t&&t.u?P.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):Ue.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=Ei("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const l=P.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));const u=P.localStorage.getItem(n);u&&(this.anonId=u)}catch{Ai("Unable to read from LocalStorage")}}saveEventData(){const e=Ei("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{P.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&P.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{Ai("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,l){if(!Ue.EVENTS_URL)return;const u=fr(Ue.EVENTS_URL);u.params.push(`access_token=${l||Ue.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:li,userId:this.anonId},f=t?gt(p,t):p,x={url:hn(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=Ve(x,v=>{this.pendingRequest=null,n(v),this.saveEventData(),this.processRequests(l)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const gr=new class extends ho{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Ue.EVENTS_URL&&Ue.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>pi(t)||Ti(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Un(Ue.ACCESS_TOKEN),t=e?e.u:Ue.ACCESS_TOKEN;let n=t!==this.eventData.tokenU;Er(this.anonId)||(this.anonId=ei(),n=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(l),f=(l-this.eventData.lastSuccess)/864e5;n=n||f>=1||f<-1||u.getDate()!==p.getDate()}else n=!0;n?this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=t)},i):this.processRequests()}},kr=gr.postTurnstileEvent.bind(gr),po=new class extends ho{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,n){this.skuToken=e,this.errorCb=n,Ue.EVENTS_URL&&(t||Ue.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(di)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Er(this.anonId)||(this.anonId=ei()),this.postEvent(t,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},il=po.postMapLoadEvent.bind(po),rl=new class extends ho{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,n){if(!Ue.API_URL||!Ue.SESSION_PATH)return;const l=fr(Ue.API_URL+Ue.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${n||Ue.ACCESS_TOKEN||""}`);const u={url:hn(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ht(u,p=>{this.pendingRequest=null,t(p),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,t,n){this.skuToken=e,this.errorCb=n,Ue.SESSION_PATH&&Ue.API_URL&&(t||Ue.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(di)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},Tc=rl.getSessionAPI.bind(rl),fo=new Set;let Hn,us=500,nl=50,qr={};function ra(i){const e=j(i);let t,n;e&&e.forEach(u=>{const p=u.split("=");p[0]==="language"?t=p[1]:p[0]==="worldview"&&(n=p[1])});let l="mapbox-tiles";return t&&(l+=`-${t}`),n&&(l+=`-${n}`),l}function ee(){try{return P.caches}catch{}}function O(i){const e=ee();e&&!qr[i]&&(qr[i]=e.open(i))}function j(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function J(i){const e=i.indexOf("?");if(e<0)return i;const t=j(i).filter(n=>{const l=n.split("=");return l[0]==="language"||l[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let re=1/0;const ge={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ge);class we extends Error{constructor(e,t,n){t===401&&Ti(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ae=$e()?()=>self.worker&&self.worker.referrer:()=>(P.location.protocol==="blob:"?P.parent:P).location.href,ye=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(Ae())&&!/^\w+:/.test(t))){if(P.fetch&&P.Request&&P.AbortController&&P.Request.prototype.hasOwnProperty("signal"))return function(n,l){const u=new P.AbortController,p=new P.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Ae(),signal:u.signal});let f=!1,x=!1;const v=(T=p.url).indexOf("sku=")>0&&Ti(T);var T;n.type==="json"&&p.headers.set("Accept","application/json");const C=(B,L,N)=>{if(x)return;if(B&&B.message!=="SecurityError"&&Ai(B),L&&N)return M(L);const Z=Date.now();P.fetch(p).then(K=>{if(K.ok){const le=v?K.clone():null;return M(K,le,Z)}return l(new we(K.statusText,K.status,n.url))}).catch(K=>{K.code!==20&&l(new Error(K.message))})},M=(B,L,N)=>{(n.type==="arrayBuffer"?B.arrayBuffer():n.type==="json"?B.json():B.text()).then(Z=>{x||(L&&N&&function(K,le,ie){const se=ra(K.url);if(O(se),!qr[se])return;const me={status:le.status,statusText:le.statusText,headers:new P.Headers};le.headers.forEach((Se,De)=>me.headers.set(De,Se));const ue=Tt(le.headers.get("Cache-Control")||"");if(ue["no-store"])return;ue["max-age"]&&me.headers.set("Expires",new Date(ie+1e3*ue["max-age"]).toUTCString());const Ce=me.headers.get("Expires");Ce&&(new Date(Ce).getTime()-ie<42e4||function(Se,De){if(Hn===void 0)try{new Response(new ReadableStream),Hn=!0}catch{Hn=!1}Hn?De(Se.body):Se.blob().then(De)}(le,Se=>{const De=new P.Response(Se,me);O(se),qr[se]&&qr[se].then(et=>et.put(J(K.url),De)).catch(et=>Ai(et.message))}))}(p,L,N),f=!0,l(null,Z,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(Z=>{x||l(new Error(Z.message))})};return v?function(B,L){const N=ra(B.url);if(O(N),!qr[N])return L(null);const Z=J(B.url);qr[N].then(K=>{K.match(Z).then(le=>{const ie=function(se){if(!se)return!1;const me=new Date(se.headers.get("Expires")||0),ue=Tt(se.headers.get("Cache-Control")||"");return me>Date.now()&&!ue["no-cache"]}(le);K.delete(Z),ie&&K.put(Z,le.clone()),L(null,le,ie)}).catch(L)}).catch(L)}(p,C):C(null,null),{cancel:()=>{x=!0,f||u.abort()}}}(i,e);if($e()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(n,l){const u=new P.XMLHttpRequest;u.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in n.headers)u.setRequestHeader(p,n.headers[p]);return n.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=n.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(n.type==="json")try{p=JSON.parse(u.response)}catch(f){return l(f)}l(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new we(u.statusText,u.status,n.url))},u.send(n.body),{cancel:()=>u.abort()}}(i,e)},Ee=function(i,e){return ye(gt(i,{type:"arrayBuffer"}),e)},Ve=function(i,e){return ye(gt(i,{method:"POST"}),e)},ht=function(i,e){return ye(gt(i,{method:"GET"}),e)};function qe(i){const e=P.document.createElement("a");return e.href=i,e.protocol===P.document.location.protocol&&e.host===P.document.location.host}const Lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ot,It;Ot=[],It=0;const Ut=function(i,e){if(lt.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),It>=Ue.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ot.push(u),u}It++;let t=!1;const n=()=>{if(!t)for(t=!0,It--;Ot.length&&It<Ue.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Ot.shift(),{requestParameters:p,callback:f,cancelled:x}=u;x||(u.cancel=Ut(p,f).cancel)}},l=Ee(i,(u,p,f,x)=>{n(),u?e(u):p&&(P.createImageBitmap?function(v,T){const C=new P.Blob([new Uint8Array(v)],{type:"image/png"});P.createImageBitmap(C).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,T)=>e(v,T,f,x)):function(v,T){const C=new P.Image,M=P.URL;C.onload=()=>{T(null,C),M.revokeObjectURL(C.src),C.onload=null,P.requestAnimationFrame(()=>{C.src=Lt})},C.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new P.Blob([new Uint8Array(v)],{type:"image/png"});C.src=v.byteLength?M.createObjectURL(B):Lt}(p,(v,T)=>e(v,T,f,x)))});return{cancel:()=>{l.cancel(),n()}}};function Jt(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function Ii(i,e,t){if(t&&t[i]){const n=t[i].indexOf(e);n!==-1&&t[i].splice(n,1)}}class Pi{constructor(e,t={}){gt(this,t),this.type=e}}class Ci extends Pi{constructor(e,t={}){super("error",gt({error:e},t))}}class Pt{on(e,t){return this._listeners=this._listeners||{},Jt(e,t,this._listeners),this}off(e,t){return Ii(e,t,this._listeners),Ii(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(e,t,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,t){typeof e=="string"&&(e=new Pi(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const l=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const f of l)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const f of u)Ii(n,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(gt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Ci&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rn(i,...e){for(const t of e)for(const n in t)i[n]=t[n];return i}function rr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function mo(i){if(Array.isArray(i))return i.map(mo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=mo(i[t]);return e}return rr(i)}class ol extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Tn=ol;class sl{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,l]of t)this.bindings[n]=l}concat(e){return new sl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Wp=sl;const hs={kind:"null"},dt={kind:"number"},ti={kind:"string"},ii={kind:"boolean"},Sn={kind:"color"},In={kind:"object"},Xt={kind:"value"},na={kind:"collator"},oa={kind:"formatted"},sa={kind:"resolvedImage"};function nn(i,e){return{kind:"array",itemType:i,N:e}}function Yi(i){if(i.kind==="array"){const e=Yi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ch=[hs,dt,ti,ii,Sn,oa,In,nn(Xt),sa];function ds(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ds(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of Ch)if(!ds(t,e))return null}}return`Expected ${Yi(i)} but found ${Yi(e)} instead.`}function al(i,e){return e.some(t=>t.kind===i.kind)}function _o(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Sc(i){var e={exports:{}};return i(e,e.exports),e.exports}var go=Sc(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function l(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function u(f){return(x=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:x>1?1:x;var x}function p(f,x,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?f+(x-f)*v*6:2*v<1?x:3*v<2?f+(x-f)*(2/3-v)*6:f}try{e.parseCSSColor=function(f){var x,v=f.replace(/ /g,"").toLowerCase();if(v in t)return t[v].slice();if(v[0]==="#")return v.length===4?(x=parseInt(v.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:v.length===7&&(x=parseInt(v.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var T=v.indexOf("("),C=v.indexOf(")");if(T!==-1&&C+1===v.length){var M=v.substr(0,T),B=v.substr(T+1,C-(T+1)).split(","),L=1;switch(M){case"rgba":if(B.length!==4)return null;L=u(B.pop());case"rgb":return B.length!==3?null:[l(B[0]),l(B[1]),l(B[2]),L];case"hsla":if(B.length!==4)return null;L=u(B.pop());case"hsl":if(B.length!==3)return null;var N=(parseFloat(B[0])%360+360)%360/360,Z=u(B[1]),K=u(B[2]),le=K<=.5?K*(Z+1):K+Z-K*Z,ie=2*K-le;return[n(255*p(ie,le,N+1/3)),n(255*p(ie,le,N)),n(255*p(ie,le,N-1/3)),L];default:return null}}return null}}catch{}});class Vr{constructor(e,t,n,l=1){this.r=e,this.g=t,this.b=n,this.a=l}static parse(e){if(!e)return;if(e instanceof Vr)return e;if(typeof e!="string")return;const t=go.parseCSSColor(e);return t?new Vr(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${l})`}toArray(){const{r:e,g:t,b:n,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*t/l,255*n/l,l]}toArray01(){const{r:e,g:t,b:n,a:l}=this;return l===0?[0,0,0,0]:[e/l,t/l,n/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:l}=this;return[e,t,n,l]}}Vr.black=new Vr(0,0,0,1),Vr.white=new Vr(1,1,1,1),Vr.transparent=new Vr(0,0,0,0),Vr.red=new Vr(1,0,0,1),Vr.blue=new Vr(0,0,1,1);var Mi=Vr;class Ic{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(e,t,n,l,u){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=l,this.textColor=u}}class Wr{constructor(e){this.sections=e}static fromString(e){return new Wr([new aa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Wr?e:Wr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class Xr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Xr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Cc(i,e,t,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,t,n]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Mi||i instanceof Ic||i instanceof Wr||i instanceof Xr)return!0;if(Array.isArray(i)){for(const e of i)if(!yo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!yo(i[e]))return!1;return!0}return!1}function cr(i){if(i===null)return hs;if(typeof i=="string")return ti;if(typeof i=="boolean")return ii;if(typeof i=="number")return dt;if(i instanceof Mi)return Sn;if(i instanceof Ic)return na;if(i instanceof Wr)return oa;if(i instanceof Xr)return sa;if(Array.isArray(i)){const e=i.length;let t;for(const n of i){const l=cr(n);if(t){if(t===l)continue;t=Xt;break}t=l}return nn(t||Xt,e)}return In}function la(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Mi||i instanceof Wr||i instanceof Xr?i.toString():JSON.stringify(i)}class Mc{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!yo(e[1]))return t.error("invalid value");const n=e[1];let l=cr(n);const u=t.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Mc(l,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mi?["rgba"].concat(this.value.toArray()):this.value instanceof Wr?this.value.serialize():this.value}}var ca=Mc,xr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const ua={string:ti,number:dt,boolean:ii,object:In};class zc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,l=1;const u=e[0];if(u==="array"){let f,x;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in ua)||v==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);f=ua[v],l++}else f=Xt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}n=nn(f,x)}else n=ua[u];const p=[];for(;l<e.length;l++){const f=t.parse(e[l],l,Xt);if(!f)return null;p.push(f)}return new zc(n,p)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!ds(this.type,cr(n)))return n;if(t===this.args.length-1)throw new xr(`Expected value to be of type ${Yi(this.type)}, but found ${Yi(cr(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){t.push(n.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(n=>n.serialize()))}}var dn=zc;class ha{constructor(e){this.type=oa,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const l=[];let u=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let x=null;if(f["font-scale"]&&(x=t.parse(f["font-scale"],1,dt),!x))return null;let v=null;if(f["text-font"]&&(v=t.parse(f["text-font"],1,nn(ti)),!v))return null;let T=null;if(f["text-color"]&&(T=t.parse(f["text-color"],1,Sn),!T))return null;const C=l[l.length-1];C.scale=x,C.font=v,C.textColor=T}else{const x=t.parse(e[p],1,Xt);if(!x)return null;const v=x.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new ha(l)}evaluate(e){return new Wr(this.sections.map(t=>{const n=t.content.evaluate(e);return cr(n)===sa?new aa("",n,null,null,null):new aa(la(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class ll{constructor(e){this.type=sa,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,ti);return n?new ll(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Xr.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Xp={"to-boolean":ii,"to-color":Sn,"to-number":dt,"to-string":ti};class kc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const l=Xp[n],u=[];for(let p=1;p<e.length;p++){const f=t.parse(e[p],p,Xt);if(!f)return null;u.push(f)}return new kc(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,n;for(const l of this.args){if(t=l.evaluate(e),n=null,t instanceof Mi)return t;if(typeof t=="string"){const u=e.parseColor(t);if(u)return u}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Cc(t[0],t[1],t[2],t[3]),!n))return new Mi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new xr(n||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const l=Number(t);if(!isNaN(l))return l}throw new xr(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?Wr.fromString(la(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Xr.fromString(la(this.args[0].evaluate(e))):la(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ha([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ll(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var ps=kc;const Hp=["Unknown","Point","LineString","Polygon"];var Mh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(n*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Mi.parse(i)),e}};class Vo{constructor(e,t,n,l){this.name=e,this.type=t,this._evaluate=n,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],l=Vo.definitions[n];if(!l)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let x=null;for(const[v,T]of f){x=new No(t.registry,t.path,null,t.scope);const C=[];let M=!1;for(let B=1;B<e.length;B++){const L=e[B],N=Array.isArray(v)?v[B-1]:v.type,Z=x.parse(L,1+C.length,N);if(!Z){M=!0;break}C.push(Z)}if(!M)if(Array.isArray(v)&&v.length!==C.length)x.error(`Expected ${v.length} arguments, but found ${C.length} instead.`);else{for(let B=0;B<C.length;B++){const L=Array.isArray(v)?v[B]:v.type,N=C[B];x.concat(B+1).checkSubtype(L,N.type)}if(x.errors.length===0)return new Vo(n,u,T,C)}}if(f.length===1)t.errors.push(...x.errors);else{const v=(f.length?f:p).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Yi).join(", ")})`:`(${Yi(M.type)}...)`;var M}).join(" | "),T=[];for(let C=1;C<e.length;C++){const M=t.parse(e[C],1+T.length);if(!M)return null;T.push(Yi(M.type))}t.error(`Expected arguments of type ${v}, but found (${T.join(", ")}) instead.`)}return null}static register(e,t){Vo.definitions=t;for(const n in t)e[n]=Vo}}var Cn=Vo;class cl{constructor(e,t,n){this.type=na,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const l=t.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,ii);if(!l)return null;const u=t.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,ii);if(!u)return null;let p=null;return n.locale&&(p=t.parse(n.locale,1,ti),!p)?null:new cl(l,u,p)}evaluate(e){return new Ic(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const xo=8192;function Pc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ul(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Qp(i,e){const t=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(t*l*xo),Math.round(n*l*xo)]}function Yp(i,e,t){const n=i[0]-e[0],l=i[1]-e[1],u=i[0]-t[0],p=i[1]-t[1];return n*p-u*l==0&&n*u<=0&&l*p<=0}function hl(i,e){let t=!1;for(let p=0,f=e.length;p<f;p++){const x=e[p];for(let v=0,T=x.length;v<T-1;v++){if(Yp(i,x[v],x[v+1]))return!1;(l=x[v])[1]>(n=i)[1]!=(u=x[v+1])[1]>n[1]&&n[0]<(u[0]-l[0])*(n[1]-l[1])/(u[1]-l[1])+l[0]&&(t=!t)}}var n,l,u;return t}function dl(i,e){for(let t=0;t<e.length;t++)if(hl(i,e[t]))return!0;return!1}function zh(i,e,t,n){const l=n[0]-t[0],u=n[1]-t[1],p=(i[0]-t[0])*u-l*(i[1]-t[1]),f=(e[0]-t[0])*u-l*(e[1]-t[1]);return p>0&&f<0||p<0&&f>0}function Jp(i,e,t){for(const v of t)for(let T=0;T<v.length-1;++T)if((f=[(p=v[T+1])[0]-(u=v[T])[0],p[1]-u[1]])[0]*(x=[(l=e)[0]-(n=i)[0],l[1]-n[1]])[1]-f[1]*x[0]!=0&&zh(n,l,u,p)&&zh(u,p,n,l))return!0;var n,l,u,p,f,x;return!1}function kh(i,e){for(let t=0;t<i.length;++t)if(!hl(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(Jp(i[t],i[t+1],e))return!1;return!0}function Kp(i,e){for(let t=0;t<e.length;t++)if(kh(i,e[t]))return!0;return!1}function pn(i,e,t){const n=[];for(let l=0;l<i.length;l++){const u=[];for(let p=0;p<i[l].length;p++){const f=Qp(i[l][p],t);Pc(e,f),u.push(f)}n.push(u)}return n}function Dc(i,e,t){const n=[];for(let l=0;l<i.length;l++){const u=pn(i[l],e,t);n.push(u)}return n}function Bc(i,e,t,n){if(i[0]<t[0]||i[0]>t[2]){const l=.5*n;let u=i[0]-t[0]>l?-n:t[0]-i[0]>l?n:0;u===0&&(u=i[0]-t[2]>l?-n:t[2]-i[0]>l?n:0),i[0]+=u}Pc(e,i)}function Lc(i,e,t,n){const l=Math.pow(2,n.z)*xo,u=[n.x*xo,n.y*xo],p=[];if(!i)return p;for(const f of i)for(const x of f){const v=[x.x+u[0],x.y+u[1]];Bc(v,e,t,l),p.push(v)}return p}function Rc(i,e,t,n){const l=Math.pow(2,n.z)*xo,u=[n.x*xo,n.y*xo],p=[];if(!i)return p;for(const x of i){const v=[];for(const T of x){const C=[T.x+u[0],T.y+u[1]];Pc(e,C),v.push(C)}p.push(v)}if(e[2]-e[0]<=l/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const x of p)for(const v of x)Bc(v,e,t,l)}var f;return p}class fs{constructor(e,t){this.type=ii,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(yo(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let l=0;l<n.features.length;++l){const u=n.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new fs(n,n.features[l].geometry)}else if(n.type==="Feature"){const l=n.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new fs(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new fs(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=t.canonicalID();if(!p)return!1;if(n.type==="Polygon"){const f=pn(n.coordinates,u,p),x=Lc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!hl(v,f))return!1}if(n.type==="MultiPolygon"){const f=Dc(n.coordinates,u,p),x=Lc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!dl(v,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=t.canonicalID();if(!p)return!1;if(n.type==="Polygon"){const f=pn(n.coordinates,u,p),x=Rc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!kh(v,f))return!1}if(n.type==="MultiPolygon"){const f=Dc(n.coordinates,u,p),x=Rc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!Kp(v,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var pl=fs;function jo(i){if(i instanceof Cn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof pl)return!1;let e=!0;return i.eachChild(t=>{e&&!jo(t)&&(e=!1)}),e}function vo(i){if(i instanceof Cn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!vo(t)&&(e=!1)}),e}function da(i,e){if(i instanceof Cn&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(n=>{t&&!da(n,e)&&(t=!1)}),t}class fl{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new fl(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ml=fl;class _l{constructor(e,t=[],n,l=new Wp,u=[]){this.registry=e,this.path=t,this.key=t.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=u,this.expectedType=n}parse(e,t,n,l,u={}){return t?this.concat(t,n,l)._parse(e,u):this._parse(e,u)}_parse(e,t){function n(l,u,p){return p==="assert"?new dn(u,[l]):p==="coerce"?new ps(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,x=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||x.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(f,x))return null}else p=n(p,f,t.typeAnnotation||"coerce");else p=n(p,f,t.typeAnnotation||"assert")}if(!(p instanceof ca)&&p.type.kind!=="resolvedImage"&&xi(p)){const f=new Mh;try{p=new ca(p.type,p.evaluate(f))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const l=typeof e=="number"?this.path.concat(e):this.path,u=n?this.scope.concat(n):this.scope;return new _l(this.registry,l,t||null,u,this.errors)}error(e,...t){const n=`${this.key}${t.map(l=>`[${l}]`).join("")}`;this.errors.push(new Tn(n,e))}checkSubtype(e,t){const n=ds(e,t);return n&&this.error(n),n}}var No=_l;function xi(i){if(i instanceof ml)return xi(i.boundExpression);if(i instanceof Cn&&i.name==="error"||i instanceof cl||i instanceof pl)return!1;const e=i instanceof ps||i instanceof dn;let t=!0;return i.eachChild(n=>{t=e?t&&xi(n):t&&n instanceof ca}),!!t&&jo(i)&&da(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function gl(i,e){const t=i.length-1;let n,l,u=0,p=t,f=0;for(;u<=p;)if(f=Math.floor((u+p)/2),n=i[f],l=i[f+1],n<=e){if(f===t||e<l)return f;u=f+1}else{if(!(n>e))throw new xr("Input is not a number.");p=f-1}return 0}class Oc{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[l,u]of n)this.labels.push(l),this.outputs.push(u)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,dt);if(!n)return null;const l=[];let u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],x=e[p+1],v=p,T=p+1;if(typeof f!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=f)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const C=t.parse(x,T,u);if(!C)return null;u=u||C.type,l.push([f,C])}return new Oc(u,n,l)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return n[0].evaluate(e);const u=t.length;return l>=t[u-1]?n[u-1].evaluate(e):n[gl(t,l)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Fc=Oc;function mi(i,e,t){return i*(1-t)+e*t}function ms(i,e,t){return i.map((n,l)=>mi(n,e[l],t))}var pa=Object.freeze({__proto__:null,number:mi,color:function(i,e,t){return new Mi(mi(i.r,e.r,t),mi(i.g,e.g,t),mi(i.b,e.b,t),mi(i.a,e.a,t))},array:ms});const Uc=.95047,Vc=1.08883,jc=4/29,Ao=6/29,fa=3*Ao*Ao,ef=Math.PI/180,Nc=180/Math.PI;function yl(i){return i>.008856451679035631?Math.pow(i,1/3):i/fa+jc}function $c(i){return i>Ao?i*i*i:fa*(i-jc)}function Gc(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function xl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ph(i){const e=xl(i.r),t=xl(i.g),n=xl(i.b),l=yl((.4124564*e+.3575761*t+.1804375*n)/Uc),u=yl((.2126729*e+.7151522*t+.072175*n)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-yl((.0193339*e+.119192*t+.9503041*n)/Vc)),alpha:i.a}}function Zc(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*$c(e),t=Uc*$c(t),n=Vc*$c(n),new Mi(Gc(3.2404542*t-1.5371385*e-.4985314*n),Gc(-.969266*t+1.8760108*e+.041556*n),Gc(.0556434*t-.2040259*e+1.0572252*n),i.alpha)}function Dh(i,e,t){const n=e-i;return i+t*(n>180||n<-180?n-360*Math.round(n/360):n)}const ma={forward:Ph,reverse:Zc,interpolate:function(i,e,t){return{l:mi(i.l,e.l,t),a:mi(i.a,e.a,t),b:mi(i.b,e.b,t),alpha:mi(i.alpha,e.alpha,t)}}},_s={forward:function(i){const{l:e,a:t,b:n}=Ph(i),l=Math.atan2(n,t)*Nc;return{h:l<0?l+360:l,c:Math.sqrt(t*t+n*n),l:e,alpha:i.a}},reverse:function(i){const e=i.h*ef,t=i.c;return Zc({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:Dh(i.h,e.h,t),c:mi(i.c,e.c,t),l:mi(i.l,e.l,t),alpha:mi(i.alpha,e.alpha,t)}}};var Bh=Object.freeze({__proto__:null,lab:ma,hcl:_s});class _a{constructor(e,t,n,l,u){this.type=e,this.operator=t,this.interpolation=n,this.input=l,this.labels=[],this.outputs=[];for(const[p,f]of u)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,t,n,l){let u=0;if(e.name==="exponential")u=vl(t,e.base,n,l);else if(e.name==="linear")u=vl(t,1,n,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new V(p[0],p[1],p[2],p[3]).solve(vl(t,1,n,l))}return u}static parse(e,t){let[n,l,u,...p]=e;if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some(T=>typeof T!="number"||T<0||T>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(u=t.parse(u,2,dt),!u)return null;const f=[];let x=null;n==="interpolate-hcl"||n==="interpolate-lab"?x=Sn:t.expectedType&&t.expectedType.kind!=="value"&&(x=t.expectedType);for(let v=0;v<p.length;v+=2){const T=p[v],C=p[v+1],M=v+3,B=v+4;if(typeof T!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=T)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const L=t.parse(C,B,x);if(!L)return null;x=x||L.type,f.push([T,L])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new _a(x,n,l,u,f):t.error(`Type ${Yi(x)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return n[0].evaluate(e);const u=t.length;if(l>=t[u-1])return n[u-1].evaluate(e);const p=gl(t,l),f=_a.interpolationFactor(this.interpolation,l,t[p],t[p+1]),x=n[p].evaluate(e),v=n[p+1].evaluate(e);return this.operator==="interpolate"?pa[this.type.kind.toLowerCase()](x,v,f):this.operator==="interpolate-hcl"?_s.reverse(_s.interpolate(_s.forward(x),_s.forward(v),f)):ma.reverse(ma.interpolate(ma.forward(x),ma.forward(v),f))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function vl(i,e,t,n){const l=n-t,u=i-t;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var Vn=_a;class qc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const l=t.expectedType;l&&l.kind!=="value"&&(n=l);const u=[];for(const f of e.slice(1)){const x=t.parse(f,1+u.length,n,void 0,{typeAnnotation:"omit"});if(!x)return null;n=n||x.type,u.push(x)}const p=l&&u.some(f=>ds(l,f.type));return new qc(p?Xt:n,u)}evaluate(e){let t,n=null,l=0;for(const u of this.args){if(l++,n=u.evaluate(e),n&&n instanceof Xr&&!n.available&&(t||(t=n),n=null,l===this.args.length))return t;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Lh=qc;class Wc{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return t.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return t.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=t.parse(e[u+1],u+1);if(!f)return null;n.push([p,f])}const l=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return l?new Wc(n,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var Rh=Wc;class Xc{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,dt),l=t.parse(e[2],2,nn(t.expectedType||Xt));return n&&l?new Xc(l.type.itemType,n,l):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new xr(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new xr(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new xr(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Oh=Xc;class Hc{constructor(e,t){this.type=ii,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Xt),l=t.parse(e[2],2,Xt);return n&&l?al(n.type,[ii,ti,dt,hs,Xt])?new Hc(n,l):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!_o(t,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(cr(t))} instead.`);if(!_o(n,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Yi(cr(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var tf=Hc;class Al{constructor(e,t,n){this.type=dt,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Xt),l=t.parse(e[2],2,Xt);if(!n||!l)return null;if(!al(n.type,[ii,ti,dt,hs,Xt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(n.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,dt);return u?new Al(n,l,u):null}return new Al(n,l)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!_o(t,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(cr(t))} instead.`);if(!_o(n,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Yi(cr(n))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return n.indexOf(t,l)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var rf=Al;class bl{constructor(e,t,n,l,u,p){this.inputType=e,this.type=t,this.input=n,this.cases=l,this.outputs=u,this.otherwise=p}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);const u={},p=[];for(let v=2;v<e.length-1;v+=2){let T=e[v];const C=e[v+1];Array.isArray(T)||(T=[T]);const M=t.concat(v);if(T.length===0)return M.error("Expected at least one branch label.");for(const L of T){if(typeof L!="number"&&typeof L!="string")return M.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return M.error("Numeric branch labels must be integer values.");if(n){if(M.checkSubtype(n,cr(L)))return null}else n=cr(L);if(u[String(L)]!==void 0)return M.error("Branch labels must be unique.");u[String(L)]=p.length}const B=t.parse(C,v,l);if(!B)return null;l=l||B.type,p.push(B)}const f=t.parse(e[1],1,Xt);if(!f)return null;const x=t.parse(e[e.length-1],e.length-1,l);return x?f.type.kind!=="value"&&t.concat(1).checkSubtype(n,f.type)?null:new bl(n,l,f,u,p,x):null}evaluate(e){const t=this.input.evaluate(e);return(cr(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],l={};for(const p of t){const f=l[this.cases[p]];f===void 0?(l[this.cases[p]]=n.length,n.push([this.cases[p],[p]])):n[f][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,f]of n)e.push(f.length===1?u(f[0]):f.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Fh=bl;class wl{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const f=t.parse(e[p],p,ii);if(!f)return null;const x=t.parse(e[p+1],p+1,n);if(!x)return null;l.push([f,x]),n=n||x.type}const u=t.parse(e[e.length-1],e.length-1,n);return u?new wl(n,l,u):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var nf=wl;class El{constructor(e,t,n,l){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=l}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Xt),l=t.parse(e[2],2,dt);if(!n||!l)return null;if(!al(n.type,[nn(Xt),ti,Xt]))return t.error(`Expected first argument to be of type array or string, but found ${Yi(n.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,dt);return u?new El(n.type,n,l,u):null}return new El(n.type,n,l)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!_o(t,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${Yi(cr(t))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return t.slice(n,l)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Uh=El;function Qc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Yc(i,e,t,n){return n.compare(e,t)===0}function gs(i,e,t){const n=i!=="=="&&i!=="!=";return class VA{constructor(u,p,f){this.type=ii,this.lhs=u,this.rhs=p,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const f=u[0];let x=p.parse(u[1],1,Xt);if(!x)return null;if(!Qc(f,x.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${Yi(x.type)}'.`);let v=p.parse(u[2],2,Xt);if(!v)return null;if(!Qc(f,v.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${Yi(v.type)}'.`);if(x.type.kind!==v.type.kind&&x.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${Yi(x.type)}' and '${Yi(v.type)}'.`);n&&(x.type.kind==="value"&&v.type.kind!=="value"?x=new dn(v.type,[x]):x.type.kind!=="value"&&v.type.kind==="value"&&(v=new dn(x.type,[v])));let T=null;if(u.length===4){if(x.type.kind!=="string"&&v.type.kind!=="string"&&x.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(u[3],3,na),!T)return null}return new VA(x,v,T)}evaluate(u){const p=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(n&&this.hasUntypedArgument){const x=cr(p),v=cr(f);if(x.kind!==v.kind||x.kind!=="string"&&x.kind!=="number")throw new xr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${v.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const x=cr(p),v=cr(f);if(x.kind!=="string"||v.kind!=="string")return e(u,p,f)}return this.collator?t(u,p,f,this.collator.evaluate(u)):e(u,p,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const of=gs("==",function(i,e,t){return e===t},Yc),sf=gs("!=",function(i,e,t){return e!==t},function(i,e,t,n){return!Yc(0,e,t,n)}),af=gs("<",function(i,e,t){return e<t},function(i,e,t,n){return n.compare(e,t)<0}),Tl=gs(">",function(i,e,t){return e>t},function(i,e,t,n){return n.compare(e,t)>0}),Vh=gs("<=",function(i,e,t){return e<=t},function(i,e,t,n){return n.compare(e,t)<=0}),jh=gs(">=",function(i,e,t){return e>=t},function(i,e,t,n){return n.compare(e,t)>=0});class Jc{constructor(e,t,n,l,u,p){this.type=ti,this.number=e,this.locale=t,this.currency=n,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,dt);if(!n)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=t.parse(l.locale,1,ti),!u))return null;let p=null;if(l.currency&&(p=t.parse(l.currency,1,ti),!p))return null;let f=null;if(l.unit&&(f=t.parse(l.unit,1,ti),!f))return null;let x=null;if(l["min-fraction-digits"]&&(x=t.parse(l["min-fraction-digits"],1,dt),!x))return null;let v=null;return l["max-fraction-digits"]&&(v=t.parse(l["max-fraction-digits"],1,dt),!v)?null:new Jc(n,u,p,f,x,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kc{constructor(e){this.type=dt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Yi(n.type)} instead.`):new Kc(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new xr(`Expected value to be of type string or array, but found ${Yi(cr(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Nh={"==":of,"!=":sf,">":Tl,"<":af,">=":jh,"<=":Vh,array:dn,at:Oh,boolean:dn,case:nf,coalesce:Lh,collator:cl,format:ha,image:ll,in:tf,"index-of":rf,interpolate:Vn,"interpolate-hcl":Vn,"interpolate-lab":Vn,length:Kc,let:Rh,literal:ca,match:Fh,number:dn,"number-format":Jc,object:dn,slice:Uh,step:Fc,string:dn,"to-boolean":ps,"to-color":ps,"to-number":ps,"to-string":ps,var:ml,within:pl};function eu(i,[e,t,n,l]){e=e.evaluate(i),t=t.evaluate(i),n=n.evaluate(i);const u=l?l.evaluate(i):1,p=Cc(e,t,n,u);if(p)throw new xr(p);return new Mi(e/255*u,t/255*u,n/255*u,u)}function tu(i,e){return i in e}function Sl(i,e){const t=e[i];return t===void 0?null:t}function Qn(i){return{type:i}}Cn.register(Nh,{error:[{kind:"error"},[ti],(i,[e])=>{throw new xr(e.evaluate(i))}],typeof:[ti,[Xt],(i,[e])=>Yi(cr(e.evaluate(i)))],"to-rgba":[nn(dt,4),[Sn],(i,[e])=>e.evaluate(i).toArray()],rgb:[Sn,[dt,dt,dt],eu],rgba:[Sn,[dt,dt,dt,dt],eu],has:{type:ii,overloads:[[[ti],(i,[e])=>tu(e.evaluate(i),i.properties())],[[ti,In],(i,[e,t])=>tu(e.evaluate(i),t.evaluate(i))]]},get:{type:Xt,overloads:[[[ti],(i,[e])=>Sl(e.evaluate(i),i.properties())],[[ti,In],(i,[e,t])=>Sl(e.evaluate(i),t.evaluate(i))]]},"feature-state":[Xt,[ti],(i,[e])=>Sl(e.evaluate(i),i.featureState||{})],properties:[In,[],i=>i.properties()],"geometry-type":[ti,[],i=>i.geometryType()],id:[Xt,[],i=>i.id()],zoom:[dt,[],i=>i.globals.zoom],pitch:[dt,[],i=>i.globals.pitch||0],"distance-from-center":[dt,[],i=>i.distanceFromCenter()],"heatmap-density":[dt,[],i=>i.globals.heatmapDensity||0],"line-progress":[dt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[dt,[],i=>i.globals.skyRadialProgress||0],accumulated:[Xt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[dt,Qn(dt),(i,e)=>{let t=0;for(const n of e)t+=n.evaluate(i);return t}],"*":[dt,Qn(dt),(i,e)=>{let t=1;for(const n of e)t*=n.evaluate(i);return t}],"-":{type:dt,overloads:[[[dt,dt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[dt],(i,[e])=>-e.evaluate(i)]]},"/":[dt,[dt,dt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[dt,[dt,dt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[dt,[dt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[dt,[dt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[dt,[dt],(i,[e])=>Math.log(e.evaluate(i))],log2:[dt,[dt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[dt,[dt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[dt,[dt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[dt,[dt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[dt,[dt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[dt,[dt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[dt,[dt],(i,[e])=>Math.atan(e.evaluate(i))],min:[dt,Qn(dt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[dt,Qn(dt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[dt,[dt],(i,[e])=>Math.abs(e.evaluate(i))],round:[dt,[dt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[dt,[dt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[dt,[dt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ii,[ti,Xt],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[ii,[Xt],(i,[e])=>i.id()===e.value],"filter-type-==":[ii,[ti],(i,[e])=>i.geometryType()===e.value],"filter-<":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n<l}],"filter-id-<":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n>l}],"filter-id->":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n<=l}],"filter-id-<=":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n>=l}],"filter-id->=":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[ii,[Xt],(i,[e])=>e.value in i.properties()],"filter-has-id":[ii,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ii,[nn(ti)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ii,[nn(Xt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ii,[ti,nn(Xt)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ii,[ti,nn(Xt)],(i,[e,t])=>function(n,l,u,p){for(;u<=p;){const f=u+p>>1;if(l[f]===n)return!0;l[f]>n?p=f-1:u=f+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[Qn(ii),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[Qn(ii),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[ii,[ii],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ii,[ti],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[ti,[ti],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ti,[ti],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ti,Qn(Xt),(i,e)=>e.map(t=>la(t.evaluate(i))).join("")],"resolved-locale":[ti,[na],(i,[e])=>e.evaluate(i).resolvedLocale()]});var ga=Nh;function $h(i){return{result:"success",value:i}}function ys(i){return{result:"error",value:i}}function xs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Gh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function iu(i){return!!i.expression&&i.expression.interpolated}function bi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ya(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Zh(i){return i}function xa(i,e){const t=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),u=i.type||(iu(e)?"exponential":"interval");if(t&&((i=rn({},i)).stops&&(i.stops=i.stops.map(v=>[v[0],Mi.parse(v[1])])),i.default=Mi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Bh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,f,x;if(u==="exponential")p=ru;else if(u==="interval")p=bo;else if(u==="categorical"){p=lf,f=Object.create(null);for(const v of i.stops)f[v[0]]=v[1];x=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=vs}if(n){const v={},T=[];for(let B=0;B<i.stops.length;B++){const L=i.stops[B],N=L[0].zoom;v[N]===void 0&&(v[N]={zoom:N,type:i.type,property:i.property,default:i.default,stops:[]},T.push(N)),v[N].stops.push([L[0].value,L[1]])}const C=[];for(const B of T)C.push([v[B].zoom,xa(v[B],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Vn.interpolationFactor.bind(void 0,M),zoomStops:C.map(B=>B[0]),evaluate:({zoom:B},L)=>ru({stops:C,base:i.base},e,B).evaluate(B,L)}}if(l){const v=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:Vn.interpolationFactor.bind(void 0,v),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(i,e,T,f,x)}}return{kind:"source",evaluate(v,T){const C=T&&T.properties?T.properties[i.property]:void 0;return C===void 0?va(i.default,e.default):p(i,e,C,f,x)}}}function va(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function lf(i,e,t,n,l){return va(typeof t===l?n[t]:void 0,i.default,e.default)}function bo(i,e,t){if(bi(t)!=="number")return va(i.default,e.default);const n=i.stops.length;if(n===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[n-1][0])return i.stops[n-1][1];const l=gl(i.stops.map(u=>u[0]),t);return i.stops[l][1]}function ru(i,e,t){const n=i.base!==void 0?i.base:1;if(bi(t)!=="number")return va(i.default,e.default);const l=i.stops.length;if(l===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[l-1][0])return i.stops[l-1][1];const u=gl(i.stops.map(T=>T[0]),t),p=function(T,C,M,B){const L=B-M,N=T-M;return L===0?0:C===1?N/L:(Math.pow(C,N)-1)/(Math.pow(C,L)-1)}(t,n,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],x=i.stops[u+1][1];let v=pa[e.type]||Zh;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=Bh[i.colorSpace];v=(C,M)=>T.reverse(T.interpolate(T.forward(C),T.forward(M),p))}return typeof f.evaluate=="function"?{evaluate(...T){const C=f.evaluate.apply(void 0,T),M=x.evaluate.apply(void 0,T);if(C!==void 0&&M!==void 0)return v(C,M,p)}}:v(f,x,p)}function vs(i,e,t){return e.type==="color"?t=Mi.parse(t):e.type==="formatted"?t=Wr.fromString(t.toString()):e.type==="resolvedImage"?t=Xr.fromString(t.toString()):bi(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),va(t,i.default,e.default)}class nu{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Mh,this._defaultValue=t?function(n){return n.type==="color"&&(ya(n.default)||Array.isArray(n.default))?new Mi(0,0,0,0):n.type==="color"?Mi.parse(n.default)||null:n.default===void 0?null:n.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,l,u,p,f,x){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,l,u,p,f,x){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=x||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console!="undefined"&&console.warn(v.message)),this._defaultValue}}}function Il(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ga}function As(i,e){const t=new No(ga,[],e?function(l){const u={color:Sn,string:ti,number:dt,enum:ti,boolean:ii,formatted:oa,resolvedImage:sa};return l.type==="array"?nn(u[l.value]||Xt,l.length):u[l.type]}(e):void 0),n=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?$h(new nu(n,e)):ys(t.errors)}class ou{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!vo(t.expression)}evaluateWithoutErrorHandling(e,t,n,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,l,u,p)}evaluate(e,t,n,l,u,p){return this._styleExpression.evaluate(e,t,n,l,u,p)}}class Aa{constructor(e,t,n,l){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!vo(t.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,t,n,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,l,u,p)}evaluate(e,t,n,l,u,p){return this._styleExpression.evaluate(e,t,n,l,u,p)}interpolationFactor(e,t,n){return this.interpolationType?Vn.interpolationFactor(this.interpolationType,e,t,n):0}}function su(i,e){if((i=As(i,e)).result==="error")return i;const t=i.value.expression,n=jo(t);if(!n&&!xs(e))return ys([new Tn("","data expressions not supported")]);const l=da(t,["zoom","pitch","distance-from-center"]);if(!l&&!Gh(e))return ys([new Tn("","zoom expressions not supported")]);const u=ws(t);return u||l?u instanceof Tn?ys([u]):u instanceof Vn&&!iu(e)?ys([new Tn("",'"interpolate" expressions cannot be used with this property')]):$h(u?new Aa(n?"camera":"composite",i.value,u.labels,u instanceof Vn?u.interpolation:void 0):new ou(n?"constant":"source",i.value)):ys([new Tn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class bs{constructor(e,t){this._parameters=e,this._specification=t,rn(this,xa(this._parameters,this._specification))}static deserialize(e){return new bs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ws(i){let e=null;if(i instanceof Rh)e=ws(i.result);else if(i instanceof Lh){for(const t of i.args)if(e=ws(t),e)break}else(i instanceof Fc||i instanceof Vn)&&i.input instanceof Cn&&i.input.name==="zoom"&&(e=i);return e instanceof Tn||i.eachChild(t=>{const n=ws(t);n instanceof Tn?e=n:!e&&n?e=new Tn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Tn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class pt{constructor(e,t,n,l){this.message=(e?`${e}: `:"")+n,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)}}function on(i){const e=i.key,t=i.value,n=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,p=i.styleSpec;let f=[];const x=bi(t);if(x!=="object")return[new pt(e,t,`object expected, ${x} found`)];for(const v in t){const T=v.split(".")[0],C=n[T]||n["*"];let M;l[T]?M=l[T]:n[T]?M=Tr:l["*"]?M=l["*"]:n["*"]&&(M=Tr),M?f=f.concat(M({key:(e&&`${e}.`)+v,value:t[v],valueSpec:C,style:u,styleSpec:p,object:t,objectKey:v},t)):f.push(new pt(e,t[v],`unknown property "${v}"`))}for(const v in n)l[v]||n[v].required&&n[v].default===void 0&&t[v]===void 0&&f.push(new pt(e,t,`missing required property "${v}"`));return f}function au(i){const e=i.value,t=i.valueSpec,n=i.style,l=i.styleSpec,u=i.key,p=i.arrayElementValidator||Tr;if(bi(e)!=="array")return[new pt(u,e,`array expected, ${bi(e)} found`)];if(t.length&&e.length!==t.length)return[new pt(u,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new pt(u,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let f={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};l.$version<7&&(f.function=t.function),bi(t.value)==="object"&&(f=t.value);let x=[];for(let v=0;v<e.length;v++)x=x.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:f,style:n,styleSpec:l,key:`${u}[${v}]`}));return x}function lu(i){const e=i.key,t=i.value,n=i.valueSpec;let l=bi(t);if(l==="number"&&t!=t&&(l="NaN"),l!=="number")return[new pt(e,t,`number expected, ${l} found`)];if("minimum"in n){let u=n.minimum;if(bi(n.minimum)==="array"&&(u=n.minimum[i.arrayIndex]),t<u)return[new pt(e,t,`${t} is less than the minimum value ${u}`)]}if("maximum"in n){let u=n.maximum;if(bi(n.maximum)==="array"&&(u=n.maximum[i.arrayIndex]),t>u)return[new pt(e,t,`${t} is greater than the maximum value ${u}`)]}return[]}function ba(i){const e=i.valueSpec,t=rr(i.value.type);let n,l,u,p={};const f=t!=="categorical"&&i.value.property===void 0,x=!f,v=bi(i.value.stops)==="array"&&bi(i.value.stops[0])==="array"&&bi(i.value.stops[0][0])==="object",T=on({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(B){if(t==="identity")return[new pt(B.key,B.value,'identity function may not have a "stops" property')];let L=[];const N=B.value;return L=L.concat(au({key:B.key,value:N,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:C})),bi(N)==="array"&&N.length===0&&L.push(new pt(B.key,N,"array must have at least one stop")),L},default:function(B){return Tr({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return t==="identity"&&f&&T.push(new pt(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||T.push(new pt(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!iu(i.valueSpec)&&T.push(new pt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!xs(i.valueSpec)?T.push(new pt(i.key,i.value,"property functions not supported")):f&&!Gh(i.valueSpec)&&T.push(new pt(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!v||i.value.property!==void 0||T.push(new pt(i.key,i.value,'"property" property is required')),T;function C(B){let L=[];const N=B.value,Z=B.key;if(bi(N)!=="array")return[new pt(Z,N,`array expected, ${bi(N)} found`)];if(N.length!==2)return[new pt(Z,N,`array length 2 expected, length ${N.length} found`)];if(v){if(bi(N[0])!=="object")return[new pt(Z,N,`object expected, ${bi(N[0])} found`)];if(N[0].zoom===void 0)return[new pt(Z,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new pt(Z,N,"object stop key must have value")];const K=rr(N[0].zoom);if(typeof K!="number")return[new pt(Z,N[0].zoom,"stop zoom values must be numbers")];if(u&&u>K)return[new pt(Z,N[0].zoom,"stop zoom values must appear in ascending order")];K!==u&&(u=K,l=void 0,p={}),L=L.concat(on({key:`${Z}[0]`,value:N[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:lu,value:M}}))}else L=L.concat(M({key:`${Z}[0]`,value:N[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},N));return Il(mo(N[1]))?L.concat([new pt(`${Z}[1]`,N[1],"expressions are not allowed in function stops.")]):L.concat(Tr({key:`${Z}[1]`,value:N[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function M(B,L){const N=bi(B.value),Z=rr(B.value),K=B.value!==null?B.value:L;if(n){if(N!==n)return[new pt(B.key,K,`${N} stop domain type must match previous stop domain type ${n}`)]}else n=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new pt(B.key,K,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&t!=="categorical"){let le=`number expected, ${N} found`;return xs(e)&&t===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(B.key,K,le)]}return t!=="categorical"||N!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?t!=="categorical"&&N==="number"&&typeof Z=="number"&&typeof l=="number"&&l!==void 0&&Z<l?[new pt(B.key,K,"stop domain values must appear in ascending order")]:(l=Z,t==="categorical"&&Z in p?[new pt(B.key,K,"stop domain values must be unique")]:(p[Z]=!0,[])):[new pt(B.key,K,`integer expected, found ${String(Z)}`)]}}function Mn(i){const e=(i.expressionContext==="property"?su:As)(mo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new pt(`${i.key}${n.key}`,i.value,n.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new pt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!vo(t))return[new pt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return cu(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!da(t,["zoom","feature-state"]))return[new pt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!jo(t))return[new pt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cu(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)t.delete(l);if(t.size===0)return[];const n=[];return i instanceof Cn&&t.has(i.name)?[new pt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{n.push(...cu(l,e))}),n)}function wa(i){const e=i.key,t=i.value,n=i.valueSpec,l=[];return Array.isArray(n.values)?n.values.indexOf(rr(t))===-1&&l.push(new pt(e,t,`expected one of [${n.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(n.values).indexOf(rr(t))===-1&&l.push(new pt(e,t,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(t)} found`)),l}function Ea(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ea(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ta(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ea(i)||(i=Cl(i));const t=i;let n=!0;try{n=function(v){if(!Yn(v))return v;let T=mo(v);return uu(T),T=qh(T),T}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const l=Pe[`filter_${e}`],u=As(n,l);let p=null;if(u.result==="error")throw new Error(u.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,T,C)=>u.value.evaluate(v,T,{},C);let f=null,x=null;if(n!==t){const v=As(t,l);if(v.result==="error")throw new Error(v.value.map(T=>`${T.key}: ${T.message}`).join(", "));f=(T,C,M,B,L)=>v.value.evaluate(T,C,{},M,void 0,void 0,B,L),x=!jo(v.value.expression)}return p=p,{filter:p,dynamicFilter:f||void 0,needGeometry:Wh(n),needFeature:!!x}}function qh(i){if(!Array.isArray(i))return i;const e=function(t){if(cf.has(t[0])){for(let n=1;n<t.length;n++)if(Yn(t[n]))return!0}return t}(i);return e===!0?e:e.map(t=>qh(t))}function uu(i){let e=!1;const t=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||Yn(i[n]),t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||Yn(i[1]);for(let n=2;n<i.length-1;n+=2)t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||Yn(i[1]);for(let n=1;n<i.length-1;n+=2)t.push(i[n+1])}e&&(i.length=0,i.push("any",...t));for(let n=1;n<i.length;n++)uu(i[n])}function Yn(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(Yn(i[t]))return!0;return!1}const cf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uf(i,e){return i<e?-1:i>e?1:0}function Wh(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Wh(i[e]))return!0;return!1}function Cl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?hu(i[1],i[2],"=="):e==="!="?Pr(hu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?hu(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(Cl))):e==="all"?["all"].concat(i.slice(1).map(Cl)):e==="none"?["all"].concat(i.slice(1).map(Cl).map(Pr)):e==="in"?Sa(i[1],i.slice(2)):e==="!in"?Pr(Sa(i[1],i.slice(2))):e==="has"?Ia(i[1]):e==="!has"?Pr(Ia(i[1])):e!=="within"||i;var t}function hu(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function Sa(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(uf)]]:["filter-in-small",i,["literal",e]]}}function Ia(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Pr(i){return["!",i]}function Es(i){return Ea(mo(i.value))?Mn(rn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Xh(i)}function Xh(i){const e=i.value,t=i.key;if(bi(e)!=="array")return[new pt(t,e,`array expected, ${bi(e)} found`)];const n=i.styleSpec;let l,u=[];if(e.length<1)return[new pt(t,e,"filter array must have at least 1 element")];switch(u=u.concat(wa({key:`${t}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),rr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&rr(e[1])==="$type"&&u.push(new pt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new pt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=bi(e[1]),l!=="string"&&u.push(new pt(`${t}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=bi(e[p]),rr(e[1])==="$type"?u=u.concat(wa({key:`${t}[${p}]`,value:e[p],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new pt(`${t}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(Xh({key:`${t}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=bi(e[1]),e.length!==2?u.push(new pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new pt(`${t}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=bi(e[1]),e.length!==2?u.push(new pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new pt(`${t}[1]`,e[1],`object expected, ${l} found`))}return u}function Hh(i,e){const t=i.key,n=i.style,l=i.styleSpec,u=i.value,p=i.objectKey,f=l[`${e}_${i.layerType}`];if(!f)return[];const x=p.match(/^(.*)-transition$/);if(e==="paint"&&x&&f[x[1]]&&f[x[1]].transition)return Tr({key:t,value:u,valueSpec:l.transition,style:n,styleSpec:l});const v=i.valueSpec||f[p];if(!v)return[new pt(t,u,`unknown property "${p}"`)];let T;if(bi(u)==="string"&&xs(v)&&!v.tokens&&(T=/^{([^}]+)}$/.exec(u)))return[new pt(t,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const C=[];return i.layerType==="symbol"&&(p==="text-field"&&n&&!n.glyphs&&C.push(new pt(t,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&ya(mo(u))&&rr(u.type)==="identity"&&C.push(new pt(t,u,'"text-font" does not support identity functions'))),C.concat(Tr({key:i.key,value:u,valueSpec:v,style:n,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Qh(i){return Hh(i,"paint")}function Yh(i){return Hh(i,"layout")}function Ml(i){let e=[];const t=i.value,n=i.key,l=i.style,u=i.styleSpec;t.type||t.ref||e.push(new pt(n,t,'either "type" or "ref" is required'));let p=rr(t.type);const f=rr(t.ref);if(t.id){const x=rr(t.id);for(let v=0;v<i.arrayIndex;v++){const T=l.layers[v];rr(T.id)===x&&e.push(new pt(n,t.id,`duplicate layer id "${t.id}", previously used at line ${T.id.__line__}`))}}if("ref"in t){let x;["type","source","source-layer","filter","layout"].forEach(v=>{v in t&&e.push(new pt(n,t[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{rr(v.id)===f&&(x=v)}),x?x.ref?e.push(new pt(n,t.ref,"ref cannot reference another ref layer")):p=rr(x.type):typeof f=="string"&&e.push(new pt(n,t.ref,`ref layer "${f}" not found`))}else if(p!=="background"&&p!=="sky")if(t.source){const x=l.sources&&l.sources[t.source],v=x&&rr(x.type);x?v==="vector"&&p==="raster"?e.push(new pt(n,t.source,`layer "${t.id}" requires a raster source`)):v==="raster"&&p!=="raster"?e.push(new pt(n,t.source,`layer "${t.id}" requires a vector source`)):v!=="vector"||t["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new pt(n,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||v==="geojson"&&x.lineMetrics||e.push(new pt(n,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new pt(n,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new pt(n,t.source,`source "${t.source}" not found`))}else e.push(new pt(n,t,'missing required property "source"'));return e=e.concat(on({key:n,value:t,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Tr({key:`${n}.type`,value:t.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:x=>Es(rn({layerType:p},x)),layout:x=>on({layer:t,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":v=>Yh(rn({layerType:p},v))}}),paint:x=>on({layer:t,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":v=>Qh(rn({layerType:p},v))}})}})),e}function Ts(i){const e=i.value,t=i.key,n=bi(e);return n!=="string"?[new pt(t,e,`string expected, ${n} found`)]:[]}const zl={promoteId:function({key:i,value:e}){if(bi(e)==="string")return Ts({key:i,value:e});{const t=[];for(const n in e)t.push(...Ts({key:`${i}.${n}`,value:e[n]}));return t}}};function Jh(i){const e=i.value,t=i.key,n=i.styleSpec,l=i.style;if(!e.type)return[new pt(t,e,'"type" is required')];const u=rr(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=on({key:t,value:e,valueSpec:n[`source_${u.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:zl}),p;case"geojson":if(p=on({key:t,value:e,valueSpec:n.source_geojson,style:l,styleSpec:n,objectElementValidators:zl}),e.cluster)for(const f in e.clusterProperties){const[x,v]=e.clusterProperties[f],T=typeof x=="string"?[x,["accumulated"],["get",f]]:x;p.push(...Mn({key:`${t}.${f}.map`,value:v,expressionContext:"cluster-map"})),p.push(...Mn({key:`${t}.${f}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return on({key:t,value:e,valueSpec:n.source_video,style:l,styleSpec:n});case"image":return on({key:t,value:e,valueSpec:n.source_image,style:l,styleSpec:n});case"canvas":return[new pt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wa({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:n})}}function Kh(i){const e=i.value,t=i.styleSpec,n=t.light,l=i.style;let u=[];const p=bi(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new pt("light",e,`object expected, ${p} found`)]),u;for(const f in e){const x=f.match(/^(.*)-transition$/);u=u.concat(x&&n[x[1]]&&n[x[1]].transition?Tr({key:f,value:e[f],valueSpec:t.transition,style:l,styleSpec:t}):n[f]?Tr({key:f,value:e[f],valueSpec:n[f],style:l,styleSpec:t}):[new pt(f,e[f],`unknown property "${f}"`)])}return u}function kl(i){const e=i.value,t=i.key,n=i.style,l=i.styleSpec,u=l.terrain;let p=[];const f=bi(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new pt("terrain",e,`object expected, ${f} found`)]),p;for(const x in e){const v=x.match(/^(.*)-transition$/);p=p.concat(v&&u[v[1]]&&u[v[1]].transition?Tr({key:x,value:e[x],valueSpec:l.transition,style:n,styleSpec:l}):u[x]?Tr({key:x,value:e[x],valueSpec:u[x],style:n,styleSpec:l}):[new pt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=n.sources&&n.sources[e.source],v=x&&rr(x.type);x?v!=="raster-dem"&&p.push(new pt(t,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):p.push(new pt(t,e.source,`source "${e.source}" not found`))}else p.push(new pt(t,e,'terrain is missing required property "source"'));return p}function ed(i){const e=i.value,t=i.style,n=i.styleSpec,l=n.fog;let u=[];const p=bi(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new pt("fog",e,`object expected, ${p} found`)]),u;for(const f in e){const x=f.match(/^(.*)-transition$/);u=u.concat(x&&l[x[1]]&&l[x[1]].transition?Tr({key:f,value:e[f],valueSpec:n.transition,style:t,styleSpec:n}):l[f]?Tr({key:f,value:e[f],valueSpec:l[f],style:t,styleSpec:n}):[new pt(f,e[f],`unknown property "${f}"`)])}return u}const du={"*":()=>[],array:au,boolean:function(i){const e=i.value,t=i.key,n=bi(e);return n!=="boolean"?[new pt(t,e,`boolean expected, ${n} found`)]:[]},number:lu,color:function(i){const e=i.key,t=i.value,n=bi(t);return n!=="string"?[new pt(e,t,`color expected, ${n} found`)]:go.parseCSSColor(t)===null?[new pt(e,t,`color expected, "${t}" found`)]:[]},enum:wa,filter:Es,function:ba,layer:Ml,object:on,source:Jh,light:Kh,terrain:kl,fog:ed,string:Ts,formatted:function(i){return Ts(i).length===0?[]:Mn(i)},resolvedImage:function(i){return Ts(i).length===0?[]:Mn(i)},projection:function(i){const e=i.value,t=i.styleSpec,n=t.projection,l=i.style;let u=[];const p=bi(e);if(p==="object")for(const f in e)u=u.concat(Tr({key:f,value:e[f],valueSpec:n[f],style:l,styleSpec:t}));else p!=="string"&&(u=u.concat([new pt("projection",e,`object or string expected, ${p} found`)]));return u}};function Tr(i){const e=i.value,t=i.valueSpec,n=i.styleSpec;return t.expression&&ya(rr(e))?ba(i):t.expression&&Il(mo(e))?Mn(i):t.type&&du[t.type]?du[t.type](i):on(rn({},i,{valueSpec:t.type?n[t.type]:t}))}function hf(i){const e=i.value,t=i.key,n=Ts(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new pt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new pt(t,e,'"glyphs" url must include a "{range}" token'))),n}function Pl(i,e=Pe){return Jn(Tr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:hf,"*":()=>[]}}))}const Dl=i=>Jn(Qh(i)),td=i=>Jn(Yh(i));function Jn(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function pu(i,e){let t=!1;if(e&&e.length)for(const n of e)i.fire(new Ci(new Error(n.message))),t=!0;return t}var Ss=fn;function fn(i,e,t){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(t=l[2]);for(var u=0;u<this.d*this.d;u++){var p=l[3+u],f=l[3+u+1];n.push(p===f?null:l.subarray(p,f))}var x=l[3+n.length+1];this.keys=l.subarray(l[3+n.length],x),this.bboxes=l.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var v=0;v<this.d*this.d;v++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var T=t/e*i;this.min=-T,this.max=i+T}fn.prototype.insert=function(i,e,t,n,l){this._forEachCell(e,t,n,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(l)},fn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fn.prototype._insertCell=function(i,e,t,n,l,u){this.cells[l].push(u)},fn.prototype.query=function(i,e,t,n,l){var u=this.min,p=this.max;if(i<=u&&e<=u&&p<=t&&p<=n&&!l)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(i,e,t,n,this._queryCell,f,{},l),f},fn.prototype._queryCell=function(i,e,t,n,l,u,p,f){var x=this.cells[l];if(x!==null)for(var v=this.keys,T=this.bboxes,C=0;C<x.length;C++){var M=x[C];if(p[M]===void 0){var B=4*M;(f?f(T[B+0],T[B+1],T[B+2],T[B+3]):i<=T[B+2]&&e<=T[B+3]&&t>=T[B+0]&&n>=T[B+1])?(p[M]=!0,u.push(v[M])):p[M]=!1}}},fn.prototype._forEachCell=function(i,e,t,n,l,u,p,f){for(var x=this._convertToCellCoord(i),v=this._convertToCellCoord(e),T=this._convertToCellCoord(t),C=this._convertToCellCoord(n),M=x;M<=T;M++)for(var B=v;B<=C;B++){var L=this.d*B+M;if((!f||f(this._convertFromCellCoord(M),this._convertFromCellCoord(B),this._convertFromCellCoord(M+1),this._convertFromCellCoord(B+1)))&&l.call(this,i,e,t,n,L,u,p,f))return}},fn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},fn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},fn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,n=0;n<this.cells.length;n++)t+=this.cells[n].length;var l=new Int32Array(e+t+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,p=0;p<i.length;p++){var f=i[p];l[3+p]=u,l.set(f,u),u+=f.length}return l[3+i.length]=u,l.set(this.keys,u),l[3+i.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const Bl={};function _t(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Bl[e]={klass:i,omit:t.omit||[]}}_t(Object,"Object"),Ss.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},Ss.deserialize=function(i){return new Ss(i.buffer)},Object.defineProperty(Ss,"name",{value:"Grid"}),_t(Ss,"Grid"),_t(Mi,"Color"),_t(Error,"Error"),_t(we,"AJAXError"),_t(Xr,"ResolvedImage"),_t(bs,"StylePropertyFunction"),_t(nu,"StyleExpression",{omit:["_evaluator"]}),_t(Aa,"ZoomDependentExpression"),_t(ou,"ZoomConstantExpression"),_t(Cn,"CompoundExpression",{omit:["_evaluate"]});for(const i in ga)Bl[ga[i]._classRegistryKey]||_t(ga[i],`Expression${i}`);function id(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function rd(i){return P.ImageBitmap&&i instanceof P.ImageBitmap}function Is(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(id(i)||rd(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof P.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const n of i)t.push(Is(n,e));return t}if(typeof i=="object"){const t=i.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const l=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const u in i)i.hasOwnProperty(u)&&(Bl[n].omit.indexOf(u)>=0||(l[u]=Is(i[u],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(l.$name=n),l}throw new Error("can't serialize object of type "+typeof i)}function Ca(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||id(i)||rd(i)||ArrayBuffer.isView(i)||i instanceof P.ImageData)return i;if(Array.isArray(i))return i.map(Ca);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=Bl[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const n=Object.create(t.prototype);for(const l of Object.keys(i))l!=="$name"&&(n[l]=Ca(i[l]));return n}throw new Error("can't deserialize object of type "+typeof i)}class nd{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const od=i=>i>=1536&&i<=1791,sd=i=>i>=1872&&i<=1919,ad=i=>i>=2208&&i<=2303,ld=i=>i>=11904&&i<=12031,cd=i=>i>=12032&&i<=12255,Ma=i=>i>=12272&&i<=12287,Ll=i=>i>=12288&&i<=12351,fu=i=>i>=12352&&i<=12447,$o=i=>i>=12448&&i<=12543,ud=i=>i>=12544&&i<=12591,mu=i=>i>=12704&&i<=12735,hd=i=>i>=12736&&i<=12783,_u=i=>i>=12784&&i<=12799,gu=i=>i>=12800&&i<=13055,yu=i=>i>=13056&&i<=13311,xu=i=>i>=13312&&i<=19903,za=i=>i>=19968&&i<=40959,Rl=i=>i>=40960&&i<=42127,dd=i=>i>=42128&&i<=42191,pd=i=>i>=44032&&i<=55215,fd=i=>i>=63744&&i<=64255,ka=i=>i>=64336&&i<=65023,md=i=>i>=65040&&i<=65055,vu=i=>i>=65072&&i<=65103,_d=i=>i>=65104&&i<=65135,Au=i=>i>=65136&&i<=65279,bu=i=>i>=65280&&i<=65519;function Ol(i){for(const e of i)if(Fl(e.charCodeAt(0)))return!0;return!1}function df(i){for(const e of i)if(!pf(e.charCodeAt(0)))return!1;return!0}function pf(i){return!(od(i)||sd(i)||ad(i)||ka(i)||Au(i))}function Fl(i){return!(i!==746&&i!==747&&(i<4352||!(mu(i)||ud(i)||vu(i)&&!(i>=65097&&i<=65103)||fd(i)||yu(i)||ld(i)||hd(i)||!(!Ll(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||xu(i)||za(i)||gu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||pd(i)||fu(i)||Ma(i)||(e=>e>=12688&&e<=12703)(i)||cd(i)||_u(i)||$o(i)&&i!==12540||!(!bu(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!_d(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||md(i)||(e=>e>=19904&&e<=19967)(i)||Rl(i)||dd(i))))}function Pa(i){return!(Fl(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ll(e)||$o(e)||(t=>t>=57344&&t<=63743)(e)||vu(e)||_d(e)||bu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function c(i){return i>=1424&&i<=2303||ka(i)||Au(i)}function r(i,e){return!(!e&&c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function s(i){for(const e of i)if(c(e.charCodeAt(0)))return!0;return!1}const h="deferred",m="loading",y="loaded";let b=null,E="unavailable",S=null;const k=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(E="error"),b&&b(i)};function D(){U.fire(new Pi("pluginStateChange",{pluginStatus:E,pluginURL:S}))}const U=new Pt,G=function(){return E},Q=function(){if(E!==h||!S)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");E=m,D(),S&&Ee({url:S},i=>{i?k(i):(E=y,D())})},W={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>E===y||W.applyArabicShaping!=null,isLoading:()=>E===m,setState(i){E=i.pluginStatus,S=i.pluginURL},isParsed:()=>W.applyArabicShaping!=null&&W.processBidirectionalText!=null&&W.processStyledBidirectionalText!=null,getPluginURL:()=>S};class X{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new nd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,n){for(const l of t)if(!r(l.charCodeAt(0),n))return!1;return!0}(e,W.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class H{constructor(e,t){this.property=e,this.value=t,this.expression=function(n,l){if(ya(n))return new bs(n,l);if(Il(n)){const u=su(n,l);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=n;return typeof n=="string"&&l.type==="color"&&(u=Mi.parse(n)),{kind:"constant",evaluate:()=>u}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class q{constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,t){return new Y(this.property,this.value,t,gt({},e.transition,this.transition),e.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return lr(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new q(this._values[e].property)),this._values[e].value=new H(this._values[e].property,t===null?void 0:lr(t))}getTransition(e){return lr(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new q(this._values[e].property)),this._values[e].transition=lr(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n);const l=this.getTransition(t);l!==void 0&&(e[`${t}-transition`]=l)}return e}transitioned(e,t){const n=new fe(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].transitioned(e,t._values[l]);return n}untransitioned(){const e=new fe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Y{constructor(e,t,n,l,u){const p=l.delay||0,f=l.duration||0;u=u||0,this.property=e,this.value=t,this.begin=u+p,this.end=this.begin+f,e.specification.transition&&(l.delay||l.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const l=e.now||0,u=this.value.possiblyEvaluate(e,t,n),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(e,t,n);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,t,n),u,Ze(f))}}return u}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const l=new pe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,n);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return lr(this._values[e].value)}setValue(e,t){this._values[e]=new H(this._values[e].property,t===null?void 0:lr(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const l=new pe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,n);return l}}class ae{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,n,l){return this.property.evaluate(this.value,this.parameters,e,t,n,l)}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class he{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const l=pa[this.specification.type];return l?l(e,t,n):e}}class xe{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,l){return new ae(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},n,l)}:e.expression,t)}interpolate(e,t,n){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ae(this,{kind:"constant",value:void 0},e.parameters);const l=pa[this.specification.type];return l?new ae(this,{kind:"constant",value:l(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,l,u,p){return e.kind==="constant"?e.value:e.evaluate(t,n,l,u,p)}}class Te extends xe{possiblyEvaluate(e,t,n,l){if(e.value===void 0)return new ae(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},n,l),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(p,p,p,t);return new ae(this,{kind:"constant",value:f},t)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new ae(this,{kind:"constant",value:u},t)}return new ae(this,e.expression,t)}evaluate(e,t,n,l,u,p){if(e.kind==="source"){const f=e.evaluate(t,n,l,u,p);return this._calculate(f,f,f,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,l),e.evaluate({zoom:Math.floor(t.zoom)},n,l),e.evaluate({zoom:Math.floor(t.zoom)+1},n,l),t):e.value}_calculate(e,t,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t,other:n}:{from:n,to:t,other:e}}interpolate(e){return e}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},n,l);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new X(Math.floor(t.zoom-1),t)),e.expression.evaluate(new X(Math.floor(t.zoom),t)),e.expression.evaluate(new X(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class be{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,l){return!!e.expression.evaluate(t,null,{},n,l)}interpolate(){return!1}}class Be{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new X(0,{});for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new H(l,void 0),p=this.defaultTransitionablePropertyValues[n]=new q(l);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate(t)}}}function Fe(i,e){return 256*(i=He(Math.floor(i),0,255))+He(Math.floor(e),0,255)}_t(xe,"DataDrivenProperty"),_t(he,"DataConstantProperty"),_t(Te,"CrossFadedDataDrivenProperty"),_t(Ye,"CrossFadedProperty"),_t(be,"ColorRampProperty");const it={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ze{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ke{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Oe(i,e=1){let t=0,n=0;return{members:i.map(l=>{const u=it[l.type].BYTES_PER_ELEMENT,p=t=at(t,Math.max(e,u)),f=l.components||1;return n=Math.max(n,u),t+=u*f,{name:l.name,type:l.type,components:f,offset:p}}),size:at(t,Math.max(n,e)),alignment:e}}function at(i,e){return Math.ceil(i/e)*e}class ot extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const l=2*e;return this.int16[l+0]=t,this.int16[l+1]=n,e}}ot.prototype.bytesPerElement=4,_t(ot,"StructArrayLayout2i4");class bt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n)}emplace(e,t,n,l){const u=3*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=l,e}}bt.prototype.bytesPerElement=6,_t(bt,"StructArrayLayout3i6");class Mt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=4*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=l,this.int16[p+3]=u,e}}Mt.prototype.bytesPerElement=8,_t(Mt,"StructArrayLayout4i8");class jt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,n,l,u,p,f)}emplace(e,t,n,l,u,p,f,x){const v=6*e,T=12*e,C=3*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.uint8[T+4]=l,this.uint8[T+5]=u,this.uint8[T+6]=p,this.uint8[T+7]=f,this.float32[C+2]=x,e}}jt.prototype.bytesPerElement=12,_t(jt,"StructArrayLayout2i4ub1f12");class oi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=4*e;return this.float32[p+0]=t,this.float32[p+1]=n,this.float32[p+2]=l,this.float32[p+3]=u,e}}oi.prototype.bytesPerElement=16,_t(oi,"StructArrayLayout4f16");class wt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,t,n,l,u,p,f,x,v,T)}emplace(e,t,n,l,u,p,f,x,v,T,C){const M=10*e;return this.uint16[M+0]=t,this.uint16[M+1]=n,this.uint16[M+2]=l,this.uint16[M+3]=u,this.uint16[M+4]=p,this.uint16[M+5]=f,this.uint16[M+6]=x,this.uint16[M+7]=v,this.uint16[M+8]=T,this.uint16[M+9]=C,e}}wt.prototype.bytesPerElement=20,_t(wt,"StructArrayLayout10ui20");class Zt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,n,l,u,p,f,x)}emplace(e,t,n,l,u,p,f,x,v){const T=8*e;return this.uint16[T+0]=t,this.uint16[T+1]=n,this.uint16[T+2]=l,this.uint16[T+3]=u,this.uint16[T+4]=p,this.uint16[T+5]=f,this.uint16[T+6]=x,this.uint16[T+7]=v,e}}Zt.prototype.bytesPerElement=16,_t(Zt,"StructArrayLayout8ui16");class _i extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,l,u,p)}emplace(e,t,n,l,u,p,f){const x=6*e;return this.int16[x+0]=t,this.int16[x+1]=n,this.int16[x+2]=l,this.int16[x+3]=u,this.int16[x+4]=p,this.int16[x+5]=f,e}}_i.prototype.bytesPerElement=12,_t(_i,"StructArrayLayout6i12");class Gi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,T,C,M){const B=this.length;return this.resize(B+1),this.emplace(B,e,t,n,l,u,p,f,x,v,T,C,M)}emplace(e,t,n,l,u,p,f,x,v,T,C,M,B){const L=12*e;return this.int16[L+0]=t,this.int16[L+1]=n,this.int16[L+2]=l,this.int16[L+3]=u,this.uint16[L+4]=p,this.uint16[L+5]=f,this.uint16[L+6]=x,this.uint16[L+7]=v,this.int16[L+8]=T,this.int16[L+9]=C,this.int16[L+10]=M,this.int16[L+11]=B,e}}Gi.prototype.bytesPerElement=24,_t(Gi,"StructArrayLayout4i4ui4i24");class nr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,l,u,p)}emplace(e,t,n,l,u,p,f){const x=10*e,v=5*e;return this.int16[x+0]=t,this.int16[x+1]=n,this.int16[x+2]=l,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=f,e}}nr.prototype.bytesPerElement=20,_t(nr,"StructArrayLayout3i3f20");class zi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}zi.prototype.bytesPerElement=4,_t(zi,"StructArrayLayout1ul4");class Sr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,T,C,M,B){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,n,l,u,p,f,x,v,T,C,M,B)}emplace(e,t,n,l,u,p,f,x,v,T,C,M,B,L){const N=20*e,Z=10*e;return this.int16[N+0]=t,this.int16[N+1]=n,this.int16[N+2]=l,this.int16[N+3]=u,this.int16[N+4]=p,this.float32[Z+3]=f,this.float32[Z+4]=x,this.float32[Z+5]=v,this.float32[Z+6]=T,this.int16[N+14]=C,this.uint32[Z+8]=M,this.uint16[N+18]=B,this.uint16[N+19]=L,e}}Sr.prototype.bytesPerElement=40,_t(Sr,"StructArrayLayout5i4f1i1ul2ui40");class zn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,n,l,u,p,f)}emplace(e,t,n,l,u,p,f,x){const v=8*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.int16[v+2]=l,this.int16[v+4]=u,this.int16[v+5]=p,this.int16[v+6]=f,this.int16[v+7]=x,e}}zn.prototype.bytesPerElement=16,_t(zn,"StructArrayLayout3i2i2i16");class Kn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,l,u)}emplace(e,t,n,l,u,p){const f=4*e,x=8*e;return this.float32[f+0]=t,this.float32[f+1]=n,this.float32[f+2]=l,this.int16[x+6]=u,this.int16[x+7]=p,e}}Kn.prototype.bytesPerElement=16,_t(Kn,"StructArrayLayout2f1f2i16");class Zi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=12*e,f=3*e;return this.uint8[p+0]=t,this.uint8[p+1]=n,this.float32[f+1]=l,this.float32[f+2]=u,e}}Zi.prototype.bytesPerElement=12,_t(Zi,"StructArrayLayout2ub2f12");class Xi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n)}emplace(e,t,n,l){const u=3*e;return this.float32[u+0]=t,this.float32[u+1]=n,this.float32[u+2]=l,e}}Xi.prototype.bytesPerElement=12,_t(Xi,"StructArrayLayout3f12");class Kt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n)}emplace(e,t,n,l){const u=3*e;return this.uint16[u+0]=t,this.uint16[u+1]=n,this.uint16[u+2]=l,e}}Kt.prototype.bytesPerElement=6,_t(Kt,"StructArrayLayout3ui6");class dr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z,K,le,ie,se,me){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z,K,le,ie,se,me)}emplace(e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z,K,le,ie,se,me,ue){const Ce=30*e,Se=15*e,De=60*e;return this.int16[Ce+0]=t,this.int16[Ce+1]=n,this.int16[Ce+2]=l,this.float32[Se+2]=u,this.float32[Se+3]=p,this.uint16[Ce+8]=f,this.uint16[Ce+9]=x,this.uint32[Se+5]=v,this.uint32[Se+6]=T,this.uint32[Se+7]=C,this.uint16[Ce+16]=M,this.uint16[Ce+17]=B,this.uint16[Ce+18]=L,this.float32[Se+10]=N,this.float32[Se+11]=Z,this.uint8[De+48]=K,this.uint8[De+49]=le,this.uint8[De+50]=ie,this.uint32[Se+13]=se,this.int16[Ce+28]=me,this.uint8[De+58]=ue,e}}dr.prototype.bytesPerElement=60,_t(dr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Dr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z,K,le,ie,se,me,ue,Ce,Se,De,et,Me,Le,je,Re){const Je=this.length;return this.resize(Je+1),this.emplace(Je,e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z,K,le,ie,se,me,ue,Ce,Se,De,et,Me,Le,je,Re)}emplace(e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z,K,le,ie,se,me,ue,Ce,Se,De,et,Me,Le,je,Re,Je){const Ne=38*e,ct=19*e;return this.int16[Ne+0]=t,this.int16[Ne+1]=n,this.int16[Ne+2]=l,this.float32[ct+2]=u,this.float32[ct+3]=p,this.int16[Ne+8]=f,this.int16[Ne+9]=x,this.int16[Ne+10]=v,this.int16[Ne+11]=T,this.int16[Ne+12]=C,this.int16[Ne+13]=M,this.uint16[Ne+14]=B,this.uint16[Ne+15]=L,this.uint16[Ne+16]=N,this.uint16[Ne+17]=Z,this.uint16[Ne+18]=K,this.uint16[Ne+19]=le,this.uint16[Ne+20]=ie,this.uint16[Ne+21]=se,this.uint16[Ne+22]=me,this.uint16[Ne+23]=ue,this.uint16[Ne+24]=Ce,this.uint16[Ne+25]=Se,this.uint16[Ne+26]=De,this.uint16[Ne+27]=et,this.uint16[Ne+28]=Me,this.uint32[ct+15]=Le,this.float32[ct+16]=je,this.float32[ct+17]=Re,this.float32[ct+18]=Je,e}}Dr.prototype.bytesPerElement=76,_t(Dr,"StructArrayLayout3i2f6i15ui1ul3f76");class Fi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Fi.prototype.bytesPerElement=4,_t(Fi,"StructArrayLayout1f4");class Br extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,l,u)}emplace(e,t,n,l,u,p){const f=5*e;return this.float32[f+0]=t,this.float32[f+1]=n,this.float32[f+2]=l,this.float32[f+3]=u,this.float32[f+4]=p,e}}Br.prototype.bytesPerElement=20,_t(Br,"StructArrayLayout5f20");class Go extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=6*e;return this.uint32[3*e+0]=t,this.uint16[p+2]=n,this.uint16[p+3]=l,this.uint16[p+4]=u,e}}Go.prototype.bytesPerElement=12,_t(Go,"StructArrayLayout1ul3ui12");class jr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const l=2*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,e}}jr.prototype.bytesPerElement=4,_t(jr,"StructArrayLayout2ui4");class Zo extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Zo.prototype.bytesPerElement=2,_t(Zo,"StructArrayLayout1ui2");class qo extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const l=2*e;return this.float32[l+0]=t,this.float32[l+1]=n,e}}qo.prototype.bytesPerElement=8,_t(qo,"StructArrayLayout2f8");class Wo extends ze{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Wo.prototype.size=12;class Nr extends _i{get(e){return new Wo(this,e)}}_t(Nr,"FillExtrusionExtArray");class Xo extends ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xo.prototype.size=40;class wo extends Sr{get(e){return new Xo(this,e)}}_t(wo,"CollisionBoxArray");class Da extends ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Da.prototype.size=60;class rg extends dr{get(e){return new Da(this,e)}}_t(rg,"PlacedSymbolArray");class ng extends ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ng.prototype.size=76;class og extends Dr{get(e){return new ng(this,e)}}_t(og,"SymbolInstanceArray");class sg extends Fi{getoffsetX(e){return this.float32[1*e+0]}}_t(sg,"GlyphOffsetArray");class ag extends bt{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}_t(ag,"SymbolLineVertexArray");class lg extends ze{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}lg.prototype.size=12;class cg extends Go{get(e){return new lg(this,e)}}_t(cg,"FeatureIndexArray");class ug extends ze{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ug.prototype.size=4;class hg extends jr{get(e){return new ug(this,e)}}_t(hg,"FillExtrusionCentroidArray");class dg extends ze{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}dg.prototype.size=12;class pg extends _i{get(e){return new dg(this,e)}}_t(pg,"CircleGlobeExtArray");const o1=Oe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),s1=Oe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var fg=Sc(function(i){i.exports=function(e,t){var n,l,u,p,f,x,v,T;for(l=e.length-(n=3&e.length),u=t,f=3432918353,x=461845907,T=0;T<l;)v=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,u=27492+(65535&(p=5*(65535&(u=(u^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*x+(((v>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,n){case 3:v^=(255&e.charCodeAt(T+2))<<16;case 2:v^=(255&e.charCodeAt(T+1))<<8;case 1:u^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(T)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*x+(((v>>>16)*x&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),a1=Sc(function(i){i.exports=function(e,t){for(var n,l=e.length,u=t^l,p=0;l>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),wu=fg,l1=a1;wu.murmur3=fg,wu.murmur2=l1;class gd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,l){this.ids.push(mg(e)),this.positions.push(t,n,l)}getPositions(e){const t=mg(e);let n=0,l=this.ids.length-1;for(;n<l;){const p=n+l>>1;this.ids[p]>=t?l=p:n=p+1}const u=[];for(;this.ids[n]===t;)u.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return u}static serialize(e,t){const n=new Float64Array(e.ids),l=new Uint32Array(e.positions);return ff(n,l,0,n.length-1),t&&t.push(n.buffer,l.buffer),{ids:n,positions:l}}static deserialize(e){const t=new gd;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function mg(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:wu(String(i))}function ff(i,e,t,n){for(;t<n;){const l=i[t+n>>1];let u=t-1,p=n+1;for(;;){do u++;while(i[u]<l);do p--;while(i[p]>l);if(u>=p)break;yd(i,u,p),yd(e,3*u,3*p),yd(e,3*u+1,3*p+1),yd(e,3*u+2,3*p+2)}p-t<n-p?(ff(i,e,t,p),t=p+1):(ff(i,e,p+1,n),n=p)}}function yd(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}_t(gd,"FeaturePositionMap");class Ho{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class xd extends Ho{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class _g extends Ho{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class gg extends Ho{constructor(e){super(e),this.current=Mi.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const c1=new Float32Array(16),u1=new Float32Array(9),h1=new Float32Array(4);function mf(i){return[Fe(255*i.r,255*i.g),Fe(255*i.b,255*i.a)]}class Eu{constructor(e,t,n){this.value=e,this.uniformNames=t.map(l=>`u_${l}`),this.type=n}setUniform(e,t,n,l,u){t.set(e,u,l.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new gg(e):new xd(e)}}class Ul{constructor(e,t){this.uniformNames=t.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,n,l,u){const p=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(e,u,p)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new _g(e):new xd(e)}}class Qo{constructor(e,t,n,l){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(u=>({name:`a_${u}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,t,n,l,u,p){const f=this.paintVertexArray.length,x=this.expression.evaluate(new X(0),t,{},u,l,p);this.paintVertexArray.resize(e),this._setPaintValue(f,e,x)}updatePaintArray(e,t,n,l,u){const p=this.expression.evaluate({zoom:0},n,l,void 0,u);this._setPaintValue(e,t,p)}_setPaintValue(e,t,n){if(this.type==="color"){const l=mf(n);for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eo{constructor(e,t,n,l,u,p){this.expression=e,this.uniformNames=t.map(f=>`u_${f}_t`),this.type=n,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,t,n,l,u,p){const f=this.expression.evaluate(new X(this.zoom),t,{},u,l,p),x=this.expression.evaluate(new X(this.zoom+1),t,{},u,l,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,f,x)}updatePaintArray(e,t,n,l,u){const p=this.expression.evaluate({zoom:this.zoom},n,l,void 0,u),f=this.expression.evaluate({zoom:this.zoom+1},n,l,void 0,u);this._setPaintValue(e,t,p,f)}_setPaintValue(e,t,n,l){if(this.type==="color"){const u=mf(n),p=mf(l);for(let f=e;f<t;f++)this.paintVertexArray.emplace(f,u[0],u[1],p[0],p[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,n,l);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,l,u){const p=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=He(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);t.set(e,u,f)}getBinding(e,t){return new xd(e)}}class Cs{constructor(e,t,n,l,u,p,f){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=u,this.layerId=f,this.paintVertexAttributes=(n==="array"?s1:o1).members;for(let x=0;x<t.length;++x);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,t,n){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,l,u,p){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(e,t,n,l){if(!l||!n)return;const{min:u,mid:p,max:f}=n,x=l[u],v=l[p],T=l[f];if(x&&v&&T)for(let C=e;C<t;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,v,x),this._setPaintValue(this.zoomOutPaintVertexArray,C,v,T)}_setPaintValue(e,t,n,l){e.emplace(t,n.tl[0],n.tl[1],n.br[0],n.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],n.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ms{constructor(e,t,n=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!n(u))continue;const p=e.paint.get(u);if(!(p instanceof ae&&xs(p.property.specification)))continue;const f=p1(u,e.type),x=p.value,v=p.property.specification.type,T=p.property.useIntegerZoom,C=p.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven",B=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||B)if(x.kind==="source"||B||M){const L=yg(u,v,"source");this.binders[u]=M?new Cs(x,f,v,T,t,L,e.id):new Qo(x,f,v,L),l.push(`/a_${u}`)}else{const L=yg(u,v,"composite");this.binders[u]=new eo(x,f,v,T,t,L),l.push(`/z_${u}`)}else this.binders[u]=M?new Ul(x.value,f):new Eu(x.value,f,v),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Qo||t instanceof eo?t.maxValue:0}populatePaintArrays(e,t,n,l,u,p){for(const f in this.binders){const x=this.binders[f];(x instanceof Qo||x instanceof eo||x instanceof Cs)&&x.populatePaintArray(e,t,n,l,u,p)}}setConstantPatternPositions(e,t){for(const n in this.binders){const l=this.binders[n];l instanceof Ul&&l.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,l,u,p){let f=!1;for(const x in e){const v=t.getPositions(x);for(const T of v){const C=n.feature(T.index);for(const M in this.binders){const B=this.binders[M];if((B instanceof Qo||B instanceof eo||B instanceof Cs)&&B.expression.isStateDependent===!0){const L=l.paint.get(M);B.expression=L.value,B.updatePaintArray(T.start,T.end,C,e[x],u,p),f=!0}}}}return f}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Eu||n instanceof Ul)&&e.push(...n.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Qo||n instanceof eo||n instanceof Cs)for(let l=0;l<n.paintVertexAttributes.length;l++)e.push(n.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Eu||n instanceof Ul||n instanceof eo)for(const l of n.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Eu||l instanceof Ul||l instanceof eo)for(const u of l.uniformNames)t.push({name:u,property:n,binding:l.getBinding(e,u)})}return t}setUniforms(e,t,n,l,u){for(const{name:p,property:f,binding:x}of n)this.binders[f].setUniform(e,x,u,l.get(f),p)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof Cs){const l=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(n instanceof Qo||n instanceof eo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Qo||n instanceof eo||n instanceof Cs)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Qo||t instanceof eo||t instanceof Cs)&&t.destroy()}}}class Ba{constructor(e,t,n=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ms(l,t,n);this.needsUpload=!1,this._featureMap=new gd,this._bufferOffset=0}populatePaintArrays(e,t,n,l,u,p,f){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,l,u,p,f);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,l,u){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,t,p,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const d1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function p1(i,e){return d1[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const f1={"line-pattern":{source:wt,composite:wt},"fill-pattern":{source:wt,composite:wt},"fill-extrusion-pattern":{source:wt,composite:wt},"line-dasharray":{source:Zt,composite:Zt}},m1={color:{source:qo,composite:oi},number:{source:Fi,composite:qo}};function yg(i,e,t){const n=f1[i];return n&&n[t]||m1[e][t]}_t(Eu,"ConstantBinder"),_t(Ul,"CrossFadedConstantBinder"),_t(Qo,"SourceExpressionBinder"),_t(Cs,"CrossFadedCompositeBinder"),_t(eo,"CompositeExpressionBinder"),_t(Ms,"ProgramConfiguration",{omit:["_buffers"]}),_t(Ba,"ProgramConfigurationSet");const vd="-transition";class to extends Pt{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new de(t.layout)),t.paint)){this._transitionablePaint=new te(t.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pe(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){t!=null&&this._validate(td,`layers.${this.id}.layout.${e}`,e,t,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return fi(e,vd)?this._transitionablePaint.getTransition(e.slice(0,-vd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(t!=null&&this._validate(Dl,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(fi(e,vd))return this._transitionablePaint.setTransition(e.slice(0,-vd.length),t||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,f,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),$i(e,(t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length))}_validate(e,t,n,l,u={}){return(!u||u.validate!==!1)&&pu(this,e.call(Pl,{key:t,layerType:this.type,objectKey:n,value:l,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ae&&xs(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ta(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _1=Oe([{name:"a_pos",components:2,type:"Int16"}],4),g1=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mr{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,l){let u=this.segments[this.segments.length-1];return e>mr.MAX_VERTEX_ARRAY_LENGTH&&Ai(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>mr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,l){return new mr([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:l,vaos:{},sortKey:0}])}}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t(mr,"SegmentVector");var Vt=8192;class zs{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Si?new Si(e.lng,e.lat):Si.convert(e),this}setSouthWest(e){return this._sw=e instanceof Si?new Si(e.lng,e.lat):Si.convert(e),this}extend(e){const t=this._sw,n=this._ne;let l,u;if(e instanceof Si)l=e,u=e;else{if(!(e instanceof zs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(zs.convert(e)):this.extend(Si.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return t||n?(t.lng=Math.min(l.lng,t.lng),t.lat=Math.min(l.lat,t.lat),n.lng=Math.max(u.lng,n.lng),n.lat=Math.max(u.lat,n.lat)):(this._sw=new Si(l.lng,l.lat),this._ne=new Si(u.lng,u.lat)),this}getCenter(){return new Si((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Si(this.getWest(),this.getNorth())}getSouthEast(){return new Si(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Si.convert(e);let l=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&l}static convert(e){return!e||e instanceof zs?e:new zs(e)}}const _f=63710088e-1;class Si{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Si(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,l=e.lat*t,u=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return _f*Math.acos(Math.min(u,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new zs(new Si(this.lng-n,this.lat-t),new Si(this.lng+n,this.lat+t))}static convert(e){if(e instanceof Si)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Si(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Si(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xg=2*Math.PI*_f;function gf(i){return xg*Math.cos(i*Math.PI/180)}function Eo(i){return(180+i)/360}function Yo(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function jn(i,e){return i/gf(e)}function Nn(i){return 360*i-180}function Lr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function vg(i,e){return i*gf(Lr(e))}const To=85.051129;function Ag(i){return 1/Math.cos(i*Math.PI/180)}class Vl{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Si.convert(e);return new Vl(Eo(n.lng),Yo(n.lat),jn(t,n.lat))}toLngLat(){return new Si(Nn(this.x),Lr(this.y))}toAltitude(){return vg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xg*Ag(Lr(this.y))}}function yf(i,e,t,n,l,u,p,f,x){const v=(e+n)/2,T=(t+l)/2,C=new R(v,T);f(C),function(M,B,L,N,Z,K){const le=L-Z,ie=N-K;return Math.abs((N-B)*le-(L-M)*ie)/Math.hypot(le,ie)}(C.x,C.y,u.x,u.y,p.x,p.y)>=x?(yf(i,e,t,v,T,u,C,f,x),yf(i,v,T,n,l,C,p,f,x)):i.push(p)}function bg(i,e,t){let n=i[0],l=n.x,u=n.y;e(n);const p=[n];for(let f=1;f<i.length;f++){const x=i[f],{x:v,y:T}=x;e(x),yf(p,l,u,v,T,n,x,e,t),l=v,u=T,n=x}return p}function xf(i,e,t,n,l){if(l(e,t)){const u=e.add(t).mult(.5);n(u),xf(i,e,u,n,l),xf(i,u,t,n,l)}else i.push(t)}function y1(i,e,t){let n=i[0];e(n);const l=[n];for(let u=1;u<i.length;u++){const p=i[u];e(p),xf(l,n,p,e,t),n=p}return l}const vf=Math.pow(2,14)-1,wg=-vf-1;function x1(i,e){const t=Math.round(i.x*e),n=Math.round(i.y*e);return i.x=He(t,wg,vf),i.y=He(n,wg,vf),(t<i.x||t>i.x+1||n<i.y||n>i.y+1)&&Ai("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Jo(i,e,t){const n=i.loadGeometry(),l=i.extent,u=Vt/l;if(e&&t&&t.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:f,x,y:v,projection:T}=t,C=M=>{const B=Nn((e.x+M.x/l)/p),L=Lr((e.y+M.y/l)/p),N=T.project(B,L);M.x=(N.x*f-x)*l,M.y=(N.y*f-v)*l};for(let M=0;M<n.length;M++)if(i.type!==1)n[M]=bg(n[M],C,1);else{const B=[];for(const L of n[M])L.x<0||L.x>=l||L.y<0||L.y>=l||(C(L),B.push(L));n[M]=B}}for(const p of n)for(const f of p)x1(f,u);return n}function La(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Jo(i):[]}}function Ad(i,e,t,n,l){i.emplaceBack(2*e+(n+1)/2,2*t+(l+1)/2)}function bd(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Af{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ot,this.indexArray=new Kt,this.segments=new mr,this.programConfigurations=new Ba(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,l){const u=this.layers[0],p=[];let f=null;u.type==="circle"&&(f=u.layout.get("circle-sort-key"));for(const{feature:v,id:T,index:C,sourceLayerIndex:M}of e){const B=this.layers[0]._featureFilter.needGeometry,L=La(v,B);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),L,n))continue;const N=f?f.evaluate(L,{},n):void 0,Z={id:T,properties:v.properties,type:v.type,sourceLayerIndex:M,index:C,geometry:B?L.geometry:Jo(v,n,l),patterns:{},sortKey:N};p.push(Z)}f&&p.sort((v,T)=>v.sortKey-T.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new pg,x=l.projection);for(const v of p){const{geometry:T,index:C,sourceLayerIndex:M}=v,B=e[C].feature;this.addFeature(v,T,C,t.availableImages,n,x),t.featureIndex.insert(B,T,C,M,this.index)}}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,g1.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,l,u,p){for(const f of t)for(const x of f){const v=x.x,T=x.y;if(v<0||v>=Vt||T<0||T>=Vt)continue;if(p){const B=p.projectTilePoint(v,T,u),L=p.upVector(u,v,T),N=this.globeExtVertexArray;bd(N,B,L),bd(N,B,L),bd(N,B,L),bd(N,B,L)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=C.vertexLength;Ad(this.layoutVertexArray,v,T,-1,-1),Ad(this.layoutVertexArray,v,T,1,-1),Ad(this.layoutVertexArray,v,T,1,1),Ad(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},l,u)}}function Eg(i,e){for(let t=0;t<i.length;t++)if(Ra(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Ra(i,e[t]))return!0;return!!bf(i,e)}function v1(i,e,t){return!!Ra(i,e)||!!wf(e,i,t)}function Tg(i,e){if(i.length===1)return Ig(e,i[0]);for(let t=0;t<e.length;t++){const n=e[t];for(let l=0;l<n.length;l++)if(Ra(i,n[l]))return!0}for(let t=0;t<i.length;t++)if(Ig(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(bf(i,e[t]))return!0;return!1}function A1(i,e,t){if(i.length>1){if(bf(i,e))return!0;for(let n=0;n<e.length;n++)if(wf(e[n],i,t))return!0}for(let n=0;n<i.length;n++)if(wf(i[n],e,t))return!0;return!1}function bf(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const n=i[t],l=i[t+1];for(let u=0;u<e.length-1;u++)if(b1(n,l,e[u],e[u+1]))return!0}return!1}function b1(i,e,t,n){return Oi(i,t,n)!==Oi(e,t,n)&&Oi(i,e,t)!==Oi(i,e,n)}function wf(i,e,t){const n=t*t;if(e.length===1)return i.distSqr(e[0])<n;for(let l=1;l<e.length;l++)if(Sg(i,e[l-1],e[l])<n)return!0;return!1}function Sg(i,e,t){const n=e.distSqr(t);if(n===0)return i.distSqr(e);const l=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/n;return i.distSqr(l<0?e:l>1?t:t.sub(e)._mult(l)._add(e))}function Ig(i,e){let t,n,l,u=!1;for(let p=0;p<i.length;p++){t=i[p];for(let f=0,x=t.length-1;f<t.length;x=f++)n=t[f],l=t[x],n.y>e.y!=l.y>e.y&&e.x<(l.x-n.x)*(e.y-n.y)/(l.y-n.y)+n.x&&(u=!u)}return u}function Ra(i,e){let t=!1;for(let n=0,l=i.length-1;n<i.length;l=n++){const u=i[n],p=i[l];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(t=!t)}return t}function Cg(i,e,t,n,l){for(const p of i)if(e<=p.x&&t<=p.y&&n>=p.x&&l>=p.y)return!0;const u=[new R(e,t),new R(e,l),new R(n,l),new R(n,t)];if(i.length>2){for(const p of u)if(Ra(i,p))return!0}for(let p=0;p<i.length-1;p++)if(w1(i[p],i[p+1],u))return!0;return!1}function w1(i,e,t){const n=t[0],l=t[2];if(i.x<n.x&&e.x<n.x||i.x>l.x&&e.x>l.x||i.y<n.y&&e.y<n.y||i.y>l.y&&e.y>l.y)return!1;const u=Oi(i,e,t[0]);return u!==Oi(i,e,t[1])||u!==Oi(i,e,t[2])||u!==Oi(i,e,t[3])}function jl(i,e,t){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:t.programConfigurations.get(e.id).getMaxValue(i)}function wd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Mg(i,e,t,n,l){if(!e[0]&&!e[1])return i;const u=R.convert(e)._mult(l);t==="viewport"&&u._rotate(-n);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(u));return p}function zg(i,e,t,n){const l=R.convert(i)._mult(n);return e==="viewport"&&l._rotate(-t),l}_t(Af,"CircleBucket",{omit:["layers"]});const E1=new Be({"circle-sort-key":new xe(Pe.layout_circle["circle-sort-key"])});var T1={paint:new Be({"circle-radius":new xe(Pe.paint_circle["circle-radius"]),"circle-color":new xe(Pe.paint_circle["circle-color"]),"circle-blur":new xe(Pe.paint_circle["circle-blur"]),"circle-opacity":new xe(Pe.paint_circle["circle-opacity"]),"circle-translate":new he(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new he(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xe(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xe(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xe(Pe.paint_circle["circle-stroke-opacity"])}),layout:E1},Ed=1e-6,mn=typeof Float32Array!="undefined"?Float32Array:Array;function kg(){var i=new mn(9);return mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function So(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ef(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=e[4],f=e[5],x=e[6],v=e[7],T=e[8],C=e[9],M=e[10],B=e[11],L=e[12],N=e[13],Z=e[14],K=e[15],le=t*f-n*p,ie=t*x-l*p,se=t*v-u*p,me=n*x-l*f,ue=n*v-u*f,Ce=l*v-u*x,Se=T*N-C*L,De=T*Z-M*L,et=T*K-B*L,Me=C*Z-M*N,Le=C*K-B*N,je=M*K-B*Z,Re=le*je-ie*Le+se*Me+me*et-ue*De+Ce*Se;return Re?(i[0]=(f*je-x*Le+v*Me)*(Re=1/Re),i[1]=(l*Le-n*je-u*Me)*Re,i[2]=(N*Ce-Z*ue+K*me)*Re,i[3]=(M*ue-C*Ce-B*me)*Re,i[4]=(x*et-p*je-v*De)*Re,i[5]=(t*je-l*et+u*De)*Re,i[6]=(Z*se-L*Ce-K*ie)*Re,i[7]=(T*Ce-M*se+B*ie)*Re,i[8]=(p*Le-f*et+v*Se)*Re,i[9]=(n*et-t*Le-u*Se)*Re,i[10]=(L*ue-N*se+K*le)*Re,i[11]=(C*se-T*ue-B*le)*Re,i[12]=(f*De-p*Me-x*Se)*Re,i[13]=(t*Me-n*De+l*Se)*Re,i[14]=(N*ie-L*me-Z*le)*Re,i[15]=(T*me-C*ie+M*le)*Re,i):null}function Nl(i,e,t){var n=e[0],l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],T=e[7],C=e[8],M=e[9],B=e[10],L=e[11],N=e[12],Z=e[13],K=e[14],le=e[15],ie=t[0],se=t[1],me=t[2],ue=t[3];return i[0]=ie*n+se*f+me*C+ue*N,i[1]=ie*l+se*x+me*M+ue*Z,i[2]=ie*u+se*v+me*B+ue*K,i[3]=ie*p+se*T+me*L+ue*le,i[4]=(ie=t[4])*n+(se=t[5])*f+(me=t[6])*C+(ue=t[7])*N,i[5]=ie*l+se*x+me*M+ue*Z,i[6]=ie*u+se*v+me*B+ue*K,i[7]=ie*p+se*T+me*L+ue*le,i[8]=(ie=t[8])*n+(se=t[9])*f+(me=t[10])*C+(ue=t[11])*N,i[9]=ie*l+se*x+me*M+ue*Z,i[10]=ie*u+se*v+me*B+ue*K,i[11]=ie*p+se*T+me*L+ue*le,i[12]=(ie=t[12])*n+(se=t[13])*f+(me=t[14])*C+(ue=t[15])*N,i[13]=ie*l+se*x+me*M+ue*Z,i[14]=ie*u+se*v+me*B+ue*K,i[15]=ie*p+se*T+me*L+ue*le,i}function Tu(i,e,t){var n,l,u,p,f,x,v,T,C,M,B,L,N=t[0],Z=t[1],K=t[2];return e===i?(i[12]=e[0]*N+e[4]*Z+e[8]*K+e[12],i[13]=e[1]*N+e[5]*Z+e[9]*K+e[13],i[14]=e[2]*N+e[6]*Z+e[10]*K+e[14],i[15]=e[3]*N+e[7]*Z+e[11]*K+e[15]):(l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],T=e[7],C=e[8],M=e[9],B=e[10],L=e[11],i[0]=n=e[0],i[1]=l,i[2]=u,i[3]=p,i[4]=f,i[5]=x,i[6]=v,i[7]=T,i[8]=C,i[9]=M,i[10]=B,i[11]=L,i[12]=n*N+f*Z+C*K+e[12],i[13]=l*N+x*Z+M*K+e[13],i[14]=u*N+v*Z+B*K+e[14],i[15]=p*N+T*Z+L*K+e[15]),i}function Oa(i,e,t){var n=t[0],l=t[1],u=t[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Tf(i,e,t){var n=Math.sin(t),l=Math.cos(t),u=e[4],p=e[5],f=e[6],x=e[7],v=e[8],T=e[9],C=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+v*n,i[5]=p*l+T*n,i[6]=f*l+C*n,i[7]=x*l+M*n,i[8]=v*l-u*n,i[9]=T*l-p*n,i[10]=C*l-f*n,i[11]=M*l-x*n,i}function Td(i,e,t){var n=Math.sin(t),l=Math.cos(t),u=e[0],p=e[1],f=e[2],x=e[3],v=e[8],T=e[9],C=e[10],M=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l-v*n,i[1]=p*l-T*n,i[2]=f*l-C*n,i[3]=x*l-M*n,i[8]=u*n+v*l,i[9]=p*n+T*l,i[10]=f*n+C*l,i[11]=x*n+M*l,i}function Pg(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Dg(i,e,t){var n,l,u,p=t[0],f=t[1],x=t[2],v=Math.hypot(p,f,x);return v<Ed?null:(p*=v=1/v,f*=v,x*=v,n=Math.sin(e),l=Math.cos(e),i[0]=p*p*(u=1-l)+l,i[1]=f*p*u+x*n,i[2]=x*p*u-f*n,i[3]=0,i[4]=p*f*u-x*n,i[5]=f*f*u+l,i[6]=x*f*u+p*n,i[7]=0,i[8]=p*x*u+f*n,i[9]=f*x*u-p*n,i[10]=x*x*u+l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var S1=Nl;function Sf(){var i=new mn(3);return mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Bg(i){var e=new mn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Su(i){return Math.hypot(i[0],i[1],i[2])}function $l(i,e,t){var n=new mn(3);return n[0]=i,n[1]=e,n[2]=t,n}function ks(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function If(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function Lg(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function Cf(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function Mf(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function io(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function Sd(i,e,t,n){return i[0]=e[0]+t[0]*n,i[1]=e[1]+t[1]*n,i[2]=e[2]+t[2]*n,i}function Hr(i,e){var t=e[0],n=e[1],l=e[2],u=t*t+n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function $n(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function zf(i,e,t){var n=e[0],l=e[1],u=e[2],p=t[0],f=t[1],x=t[2];return i[0]=l*x-u*f,i[1]=u*p-n*x,i[2]=n*f-l*p,i}function yr(i,e,t){var n=e[0],l=e[1],u=e[2],p=t[3]*n+t[7]*l+t[11]*u+t[15];return i[0]=(t[0]*n+t[4]*l+t[8]*u+t[12])/(p=p||1),i[1]=(t[1]*n+t[5]*l+t[9]*u+t[13])/p,i[2]=(t[2]*n+t[6]*l+t[10]*u+t[14])/p,i}function Rg(i,e,t){var n=t[0],l=t[1],u=t[2],p=e[0],f=e[1],x=e[2],v=l*x-u*f,T=u*p-n*x,C=n*f-l*p,M=l*C-u*T,B=u*v-n*C,L=n*T-l*v,N=2*t[3];return T*=N,C*=N,B*=2,L*=2,i[0]=p+(v*=N)+(M*=2),i[1]=f+T+B,i[2]=x+C+L,i}var Iu,ro=If,I1=Lg,C1=Su;function Og(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Fa(i,e,t){var n=e[0],l=e[1],u=e[2],p=e[3];return i[0]=t[0]*n+t[4]*l+t[8]*u+t[12]*p,i[1]=t[1]*n+t[5]*l+t[9]*u+t[13]*p,i[2]=t[2]*n+t[6]*l+t[10]*u+t[14]*p,i[3]=t[3]*n+t[7]*l+t[11]*u+t[15]*p,i}function Fg(){var i=new mn(4);return mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ug(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Vg(i,e,t){t*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(t),x=Math.cos(t);return i[0]=n*x+p*f,i[1]=l*x+u*f,i[2]=u*x-l*f,i[3]=p*x-n*f,i}function jg(i,e,t){t*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(t),x=Math.cos(t);return i[0]=n*x-u*f,i[1]=l*x+p*f,i[2]=u*x+n*f,i[3]=p*x-l*f,i}Sf(),Iu=new mn(4),mn!=Float32Array&&(Iu[0]=0,Iu[1]=0,Iu[2]=0,Iu[3]=0),Sf(),$l(1,0,0),$l(0,1,0),Fg(),Fg(),kg();class kf{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const l=$n(t,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/l;return n[0]=this.pos[0]+this.dir[0]*u,n[1]=this.pos[1]+this.dir[1]*u,n[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,t,n){if(function(B,L){var N=B[0],Z=B[1],K=B[2],le=L[0],ie=L[1],se=L[2];return Math.abs(N-le)<=Ed*Math.max(1,Math.abs(N),Math.abs(le))&&Math.abs(Z-ie)<=Ed*Math.max(1,Math.abs(Z),Math.abs(ie))&&Math.abs(K-se)<=Ed*Math.max(1,Math.abs(K),Math.abs(se))}(this.pos,e)||t===0)return n[0]=n[1]=n[2]=0,!1;const[l,u,p]=this.dir,f=this.pos[0]-e[0],x=this.pos[1]-e[1],v=this.pos[2]-e[2],T=l*l+u*u+p*p,C=2*(f*l+x*u+v*p),M=C*C-4*T*(f*f+x*x+v*v-t*t);if(M<0){const B=Math.max(-C/2,0),L=f+l*B,N=x+u*B,Z=v+p*B,K=Math.hypot(L,N,Z);return n[0]=L*t/K,n[1]=N*t/K,n[2]=Z*t/K,!1}{const B=(-C-Math.sqrt(M))/(2*T);if(B<0){const L=Math.hypot(f,x,v);return n[0]=f*t/L,n[1]=x*t/L,n[2]=v*t/L,!1}return n[0]=f+l*B,n[1]=x+u*B,n[2]=v+p*B,!0}}}class Pf{constructor(e,t,n,l,u){this.TL=e,this.TR=t,this.BR=n,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,t,n){const l=[-1,1,1],u=[1,1,1],p=[1,-1,1],f=[-1,-1,1],x=yr(l,l,e),v=yr(u,u,e),T=yr(p,p,e),C=yr(f,f,e);return new Pf(x,v,T,C,t/n)}}class Df{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,n,l){const u=Math.pow(2,n),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const v=Fa([],x,e),T=1/v[3]/t*u;return function(C,M,B){return C[0]=M[0]*B[0],C[1]=M[1]*B[1],C[2]=M[2]*B[2],C[3]=M[3]*B[3],C}(v,v,[T,T,l?1/v[3]:T,T])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const v=Hr([],zf([],ro([],p[x[0]],p[x[1]]),ro([],p[x[2]],p[x[1]]))),T=-$n(v,p[x[1]]);return v.concat(T)});return new Df(p,f)}}class sn{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],n=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const l of e)t[0]=Math.min(t[0],l[0]),t[1]=Math.min(t[1],l[1]),t[2]=Math.min(t[2],l[2]),n[0]=Math.max(n[0],l[0]),n[1]=Math.max(n[1],l[1]),n[2]=Math.max(n[2],l[2]);return new sn(t,n)}constructor(e,t){this.min=e,this.max=t,this.center=io([],ks([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=Bg(this.min),l=Bg(this.max);for(let u=0;u<t.length;u++)n[u]=t[u]?this.min[u]:this.center[u],l[u]=t[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new sn(n,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let n=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let p=0;for(let f=0;f<t.length;f++)p+=$n(u,t[f])+u[3]>=0;if(p===0)return 0;p!==t.length&&(n=!1)}if(n)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let f=0;f<e.points.length;f++){const x=e.points[f][l]-this.min[l];u=Math.min(u,x),p=Math.max(p,x)}if(p<0||u>this.max[l]-this.min[l])return 0}return 1}}function Ng(i,e,t,n,l,u,p,f,x){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(x*=i.pixelToTileUnitsFactor);const v=i.tileID.canonical,T=t.projection.upVectorScale(v,t.center.lat,t.worldSize).metersToTile;for(const C of e)for(const M of C){const B=M.add(f),L=l&&t.elevation?t.elevation.exaggeration()*l.getElevationAt(B.x,B.y,!0):0,N=t.projection.projectTilePoint(B.x,B.y,v);if(L>0){const ie=t.projection.upVector(v,B.x,B.y);N.x+=ie[0]*T*L,N.y+=ie[1]*T*L,N.z+=ie[2]*T*L}const Z=u?B:M1(N.x,N.y,N.z,n),K=u?i.tilespaceRays.map(ie=>k1(ie,L)):i.queryGeometry.screenGeometry,le=Fa([],[N.x,N.y,N.z,1],n);if(!p&&u?x*=le[3]/t.cameraToCenterDistance:p&&!u&&(x*=t.cameraToCenterDistance/le[3]),u){const ie=Lr((M.y/Vt+v.y)/(1<<v.z));x/=t.projection.pixelsPerMeter(ie,1)/jn(1,ie)}if(v1(K,Z,x))return!0}return!1}function M1(i,e,t,n){const l=Fa([],[i,e,t,1],n);return new R(l[0]/l[3],l[1]/l[3])}const $g=$l(0,0,0),z1=$l(0,0,1);function k1(i,e){const t=Sf();return $g[2]=e,i.intersectsPlane($g,z1,t),new R(t[0],t[1])}class Gg extends Af{}function Zg(i,{width:e,height:t},n,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*t*n)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*t*n);return i.width=e,i.height=t,i.data=l,i}function qg(i,e,t){const{width:n,height:l}=e;n===i.width&&l===i.height||(Bf(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,l)},t),i.width=n,i.height=l,i.data=e.data)}function Bf(i,e,t,n,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||t.x>i.width-l.width||t.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||n.x>e.width-l.width||n.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;for(let x=0;x<l.height;x++){const v=((t.y+x)*i.width+t.x)*u,T=((n.y+x)*e.width+n.x)*u;for(let C=0;C<l.width*u;C++)f[T+C]=p[v+C]}return e}_t(Gg,"HeatmapBucket",{omit:["layers"]});class Ko{constructor(e,t){Zg(this,e,1,t)}resize(e){qg(this,new Ko(e),1)}clone(){return new Ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,l,u){Bf(e,t,n,l,u,1)}}class _n{constructor(e,t){Zg(this,e,4,t)}resize(e){qg(this,new _n(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _n({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,l,u){Bf(e,t,n,l,u,4)}}_t(Ko,"AlphaImage"),_t(_n,"RGBAImage");var P1={paint:new Be({"heatmap-radius":new xe(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xe(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new be(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(Pe.paint_heatmap["heatmap-opacity"])})};function Lf(i){const e={},t=i.resolution||256,n=i.clips?i.clips.length:1,l=i.image||new _n({width:t,height:n}),u=(p,f,x)=>{e[i.evaluationKey]=x;const v=i.expression.evaluate(e);l.data[p+f+0]=Math.floor(255*v.r/v.a),l.data[p+f+1]=Math.floor(255*v.g/v.a),l.data[p+f+2]=Math.floor(255*v.b/v.a),l.data[p+f+3]=Math.floor(255*v.a)};if(i.clips)for(let p=0,f=0;p<n;++p,f+=4*t)for(let x=0,v=0;x<t;x++,v+=4){const T=x/(t-1),{start:C,end:M}=i.clips[p];u(f,v,C*(1-T)+M*T)}else for(let p=0,f=0;p<t;p++,f+=4)u(0,f,p/(t-1));return l}var D1={paint:new Be({"hillshade-illumination-direction":new he(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(Pe.paint_hillshade["hillshade-accent-color"])})};const B1=Oe([{name:"a_pos",components:2,type:"Int16"}],4),{members:L1}=B1;var Id=Cd,R1=Cd;function Cd(i,e,t){t=t||2;var n,l,u,p,f,x,v,T=e&&e.length,C=T?e[0]*t:i.length,M=Wg(i,0,C,t,!0),B=[];if(!M||M.next===M.prev)return B;if(T&&(M=function(N,Z,K,le){var ie,se,me,ue=[];for(ie=0,se=Z.length;ie<se;ie++)(me=Wg(N,Z[ie]*le,ie<se-1?Z[ie+1]*le:N.length,le,!1))===me.next&&(me.steiner=!0),ue.push(G1(me));for(ue.sort(j1),ie=0;ie<ue.length;ie++)K=N1(ue[ie],K);return K}(i,e,M,t)),i.length>80*t){n=u=i[0],l=p=i[1];for(var L=t;L<C;L+=t)(f=i[L])<n&&(n=f),(x=i[L+1])<l&&(l=x),f>u&&(u=f),x>p&&(p=x);v=(v=Math.max(u-n,p-l))!==0?32767/v:0}return Cu(M,B,t,n,l,v,0),B}function Wg(i,e,t,n,l){var u,p;if(l===Ff(i,e,t,n)>0)for(u=e;u<t;u+=n)p=Qg(u,i[u],i[u+1],p);else for(u=t-n;u>=e;u-=n)p=Qg(u,i[u],i[u+1],p);return p&&Md(p,p.next)&&(zu(p),p=p.next),p}function Ua(i,e){if(!i)return i;e||(e=i);var t,n=i;do if(t=!1,n.steiner||!Md(n,n.next)&&pr(n.prev,n,n.next)!==0)n=n.next;else{if(zu(n),(n=e=n.prev)===n.next)break;t=!0}while(t||n!==e);return e}function Cu(i,e,t,n,l,u,p){if(i){!p&&u&&function(T,C,M,B){var L=T;do L.z===0&&(L.z=Rf(L.x,L.y,C,M,B)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==T);L.prevZ.nextZ=null,L.prevZ=null,function(N){var Z,K,le,ie,se,me,ue,Ce,Se=1;do{for(K=N,N=null,se=null,me=0;K;){for(me++,le=K,ue=0,Z=0;Z<Se&&(ue++,le=le.nextZ);Z++);for(Ce=Se;ue>0||Ce>0&&le;)ue!==0&&(Ce===0||!le||K.z<=le.z)?(ie=K,K=K.nextZ,ue--):(ie=le,le=le.nextZ,Ce--),se?se.nextZ=ie:N=ie,ie.prevZ=se,se=ie;K=le}se.nextZ=null,Se*=2}while(me>1)}(L)}(i,n,l,u);for(var f,x,v=i;i.prev!==i.next;)if(f=i.prev,x=i.next,u?F1(i,n,l,u):O1(i))e.push(f.i/t|0),e.push(i.i/t|0),e.push(x.i/t|0),zu(i),i=x.next,v=x.next;else if((i=x)===v){p?p===1?Cu(i=U1(Ua(i),e,t),e,t,n,l,u,2):p===2&&V1(i,e,t,n,l,u):Cu(Ua(i),e,t,n,l,u,1);break}}}function O1(i){var e=i.prev,t=i,n=i.next;if(pr(e,t,n)>=0)return!1;for(var l=e.x,u=t.x,p=n.x,f=e.y,x=t.y,v=n.y,T=l<u?l<p?l:p:u<p?u:p,C=f<x?f<v?f:v:x<v?x:v,M=l>u?l>p?l:p:u>p?u:p,B=f>x?f>v?f:v:x>v?x:v,L=n.next;L!==e;){if(L.x>=T&&L.x<=M&&L.y>=C&&L.y<=B&&Gl(l,f,u,x,p,v,L.x,L.y)&&pr(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function F1(i,e,t,n){var l=i.prev,u=i,p=i.next;if(pr(l,u,p)>=0)return!1;for(var f=l.x,x=u.x,v=p.x,T=l.y,C=u.y,M=p.y,B=f<x?f<v?f:v:x<v?x:v,L=T<C?T<M?T:M:C<M?C:M,N=f>x?f>v?f:v:x>v?x:v,Z=T>C?T>M?T:M:C>M?C:M,K=Rf(B,L,e,t,n),le=Rf(N,Z,e,t,n),ie=i.prevZ,se=i.nextZ;ie&&ie.z>=K&&se&&se.z<=le;){if(ie.x>=B&&ie.x<=N&&ie.y>=L&&ie.y<=Z&&ie!==l&&ie!==p&&Gl(f,T,x,C,v,M,ie.x,ie.y)&&pr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,se.x>=B&&se.x<=N&&se.y>=L&&se.y<=Z&&se!==l&&se!==p&&Gl(f,T,x,C,v,M,se.x,se.y)&&pr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ie&&ie.z>=K;){if(ie.x>=B&&ie.x<=N&&ie.y>=L&&ie.y<=Z&&ie!==l&&ie!==p&&Gl(f,T,x,C,v,M,ie.x,ie.y)&&pr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;se&&se.z<=le;){if(se.x>=B&&se.x<=N&&se.y>=L&&se.y<=Z&&se!==l&&se!==p&&Gl(f,T,x,C,v,M,se.x,se.y)&&pr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function U1(i,e,t){var n=i;do{var l=n.prev,u=n.next.next;!Md(l,u)&&Xg(l,n,n.next,u)&&Mu(l,u)&&Mu(u,l)&&(e.push(l.i/t|0),e.push(n.i/t|0),e.push(u.i/t|0),zu(n),zu(n.next),n=i=u),n=n.next}while(n!==i);return Ua(n)}function V1(i,e,t,n,l,u){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&Z1(p,f)){var x=Hg(p,f);return p=Ua(p,p.next),x=Ua(x,x.next),Cu(p,e,t,n,l,u,0),void Cu(x,e,t,n,l,u,0)}f=f.next}p=p.next}while(p!==i)}function j1(i,e){return i.x-e.x}function N1(i,e){var t=function(l,u){var p,f=u,x=l.x,v=l.y,T=-1/0;do{if(v<=f.y&&v>=f.next.y&&f.next.y!==f.y){var C=f.x+(v-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(C<=x&&C>T&&(T=C,p=f.x<f.next.x?f:f.next,C===x))return p}f=f.next}while(f!==u);if(!p)return null;var M,B=p,L=p.x,N=p.y,Z=1/0;f=p;do x>=f.x&&f.x>=L&&x!==f.x&&Gl(v<N?x:T,v,L,N,v<N?T:x,v,f.x,f.y)&&(M=Math.abs(v-f.y)/(x-f.x),Mu(f,l)&&(M<Z||M===Z&&(f.x>p.x||f.x===p.x&&$1(p,f)))&&(p=f,Z=M)),f=f.next;while(f!==B);return p}(i,e);if(!t)return e;var n=Hg(t,i);return Ua(n,n.next),Ua(t,t.next)}function $1(i,e){return pr(i.prev,i,e.prev)<0&&pr(e.next,i,i.next)<0}function Rf(i,e,t,n,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function G1(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Gl(i,e,t,n,l,u,p,f){return(l-p)*(e-f)>=(i-p)*(u-f)&&(i-p)*(n-f)>=(t-p)*(e-f)&&(t-p)*(u-f)>=(l-p)*(n-f)}function Z1(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,n){var l=t;do{if(l.i!==t.i&&l.next.i!==t.i&&l.i!==n.i&&l.next.i!==n.i&&Xg(l,l.next,t,n))return!0;l=l.next}while(l!==t);return!1}(i,e)&&(Mu(i,e)&&Mu(e,i)&&function(t,n){var l=t,u=!1,p=(t.x+n.x)/2,f=(t.y+n.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&p<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==t);return u}(i,e)&&(pr(i.prev,i,e.prev)||pr(i,e.prev,e))||Md(i,e)&&pr(i.prev,i,i.next)>0&&pr(e.prev,e,e.next)>0)}function pr(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Md(i,e){return i.x===e.x&&i.y===e.y}function Xg(i,e,t,n){var l=kd(pr(i,e,t)),u=kd(pr(i,e,n)),p=kd(pr(t,n,i)),f=kd(pr(t,n,e));return l!==u&&p!==f||!(l!==0||!zd(i,t,e))||!(u!==0||!zd(i,n,e))||!(p!==0||!zd(t,i,n))||!(f!==0||!zd(t,e,n))}function zd(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function kd(i){return i>0?1:i<0?-1:0}function Mu(i,e){return pr(i.prev,i,i.next)<0?pr(i,e,i.next)>=0&&pr(i,i.prev,e)>=0:pr(i,e,i.prev)<0||pr(i,i.next,e)<0}function Hg(i,e){var t=new Of(i.i,i.x,i.y),n=new Of(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=l,l.prev=t,n.next=t,t.prev=n,u.next=n,n.prev=u,n}function Qg(i,e,t,n){var l=new Of(i,e,t);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function zu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Of(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ff(i,e,t,n){for(var l=0,u=e,p=t-n;u<t;u+=n)l+=(i[p]-i[u])*(i[u+1]+i[p+1]),p=u;return l}function q1(i,e,t,n,l){Yg(i,e,t||0,n||i.length-1,l||W1)}function Yg(i,e,t,n,l){for(;n>t;){if(n-t>600){var u=n-t+1,p=e-t+1,f=Math.log(u),x=.5*Math.exp(2*f/3),v=.5*Math.sqrt(f*x*(u-x)/u)*(p-u/2<0?-1:1);Yg(i,e,Math.max(t,Math.floor(e-p*x/u+v)),Math.min(n,Math.floor(e+(u-p)*x/u+v)),l)}var T=i[e],C=t,M=n;for(ku(i,t,e),l(i[n],T)>0&&ku(i,t,n);C<M;){for(ku(i,C,M),C++,M--;l(i[C],T)<0;)C++;for(;l(i[M],T)>0;)M--}l(i[t],T)===0?ku(i,t,M):ku(i,++M,n),M<=e&&(t=M+1),e<=M&&(n=M-1)}}function ku(i,e,t){var n=i[e];i[e]=i[t],i[t]=n}function W1(i,e){return i<e?-1:i>e?1:0}function Uf(i,e){const t=i.length;if(t<=1)return[i];const n=[];let l,u;for(let p=0;p<t;p++){const f=tn(i[p]);f!==0&&(i[p].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(l&&n.push(l),l=[i[p]]):l.push(i[p]))}if(l&&n.push(l),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(q1(n[p],e,1,n[p].length-1,X1),n[p]=n[p].slice(0,e));return n}function X1(i,e){return e.area-i.area}function Vf(i,e,t){const n=t.patternDependencies;let l=!1;for(const u of e){const p=u.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const f=p.constantOr(null);f&&(l=!0,n[f.to]=!0,n[f.from]=!0)}return l}function jf(i,e,t,n,l){const u=l.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let x=f.evaluate({zoom:n-1},t,{},l.availableImages),v=f.evaluate({zoom:n},t,{},l.availableImages),T=f.evaluate({zoom:n+1},t,{},l.availableImages);x=x&&x.name?x.name:x,v=v&&v.name?v.name:v,T=T&&T.name?T.name:T,u[x]=!0,u[v]=!0,u[T]=!0,t.patterns[p.id]={min:x,mid:v,max:T}}}return t}Cd.deviation=function(i,e,t,n){var l=e&&e.length,u=Math.abs(Ff(i,0,l?e[0]*t:i.length,t));if(l)for(var p=0,f=e.length;p<f;p++)u-=Math.abs(Ff(i,e[p]*t,p<f-1?e[p+1]*t:i.length,t));var x=0;for(p=0;p<n.length;p+=3){var v=n[p]*t,T=n[p+1]*t,C=n[p+2]*t;x+=Math.abs((i[v]-i[C])*(i[T+1]-i[v+1])-(i[v]-i[T])*(i[C+1]-i[v+1]))}return u===0&&x===0?0:Math.abs((x-u)/u)},Cd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var p=0;p<e;p++)t.vertices.push(i[l][u][p]);l>0&&t.holes.push(n+=i[l-1].length)}return t},Id.default=R1;class Pd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ot,this.indexArray=new Kt,this.indexArray2=new jr,this.programConfigurations=new Ba(e.layers,e.zoom),this.segments=new mr,this.segments2=new mr,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,n,l){this.hasPattern=Vf("fill",this.layers,t);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:f,id:x,index:v,sourceLayerIndex:T}of e){const C=this.layers[0]._featureFilter.needGeometry,M=La(f,C);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),M,n))continue;const B=u?u.evaluate(M,{},n,t.availableImages):void 0,L={id:x,properties:f.properties,type:f.type,sourceLayerIndex:T,index:v,geometry:C?M.geometry:Jo(f,n,l),patterns:{},sortKey:B};p.push(L)}u&&p.sort((f,x)=>f.sortKey-x.sortKey);for(const f of p){const{geometry:x,index:v,sourceLayerIndex:T}=f;if(this.hasPattern){const C=jf("fill",this.layers,f,this.zoom,t);this.patternFeatures.push(C)}else this.addFeature(f,x,v,n,{},t.availableImages);t.featureIndex.insert(e[v].feature,x,v,T,this.index)}}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}addFeatures(e,t,n,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,t,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,L1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,l,u,p=[]){for(const f of Uf(t,500)){let x=0;for(const L of f)x+=L.length;const v=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),T=v.vertexLength,C=[],M=[];for(const L of f){if(L.length===0)continue;L!==f[0]&&M.push(C.length/2);const N=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),Z=N.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(Z+L.length-1,Z),C.push(L[0].x),C.push(L[0].y);for(let K=1;K<L.length;K++)this.layoutVertexArray.emplaceBack(L[K].x,L[K].y),this.indexArray2.emplaceBack(Z+K-1,Z+K),C.push(L[K].x),C.push(L[K].y);N.vertexLength+=L.length,N.primitiveLength+=L.length}const B=Id(C,M);for(let L=0;L<B.length;L+=3)this.indexArray.emplaceBack(T+B[L],T+B[L+1],T+B[L+2]);v.vertexLength+=x,v.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}}_t(Pd,"FillBucket",{omit:["layers","patternFeatures"]});const H1=new Be({"fill-sort-key":new xe(Pe.layout_fill["fill-sort-key"])});var Q1={paint:new Be({"fill-antialias":new he(Pe.paint_fill["fill-antialias"]),"fill-opacity":new xe(Pe.paint_fill["fill-opacity"]),"fill-color":new xe(Pe.paint_fill["fill-color"]),"fill-outline-color":new xe(Pe.paint_fill["fill-outline-color"]),"fill-translate":new he(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new he(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Te(Pe.paint_fill["fill-pattern"])}),layout:H1};const Y1=Oe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),J1=Oe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),K1=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:eb}=Y1;var Jg=Zl;function Zl(i,e,t,n,l){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=l,i.readFields(tb,this,e)}function tb(i,e,t){i==1?e.id=t.readVarint():i==2?function(n,l){for(var u=n.readVarint()+n.pos;n.pos<u;){var p=l._keys[n.readVarint()],f=l._values[n.readVarint()];l.properties[p]=f}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function ib(i){for(var e,t,n=0,l=0,u=i.length,p=u-1;l<u;p=l++)n+=((t=i[p]).x-(e=i[l]).x)*(e.y+t.y);return n}Zl.types=["Unknown","Point","LineString","Polygon"],Zl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,n=1,l=0,u=0,p=0,f=[];i.pos<t;){if(l<=0){var x=i.readVarint();n=7&x,l=x>>3}if(l--,n===1||n===2)u+=i.readSVarint(),p+=i.readSVarint(),n===1&&(e&&f.push(e),e=[]),e.push(new R(u,p));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Zl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,n=0,l=0,u=0,p=1/0,f=-1/0,x=1/0,v=-1/0;i.pos<e;){if(n<=0){var T=i.readVarint();t=7&T,n=T>>3}if(n--,t===1||t===2)(l+=i.readSVarint())<p&&(p=l),l>f&&(f=l),(u+=i.readSVarint())<x&&(x=u),u>v&&(v=u);else if(t!==7)throw new Error("unknown command "+t)}return[p,x,f,v]},Zl.prototype.toGeoJSON=function(i,e,t){var n,l,u=this.extent*Math.pow(2,t),p=this.extent*i,f=this.extent*e,x=this.loadGeometry(),v=Zl.types[this.type];function T(B){for(var L=0;L<B.length;L++){var N=B[L];B[L]=[360*(N.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+f)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(n=0;n<x.length;n++)C[n]=x[n][0];T(x=C);break;case 2:for(n=0;n<x.length;n++)T(x[n]);break;case 3:for(x=function(B){var L=B.length;if(L<=1)return[B];for(var N,Z,K=[],le=0;le<L;le++){var ie=ib(B[le]);ie!==0&&(Z===void 0&&(Z=ie<0),Z===ie<0?(N&&K.push(N),N=[B[le]]):N.push(B[le]))}return N&&K.push(N),K}(x),n=0;n<x.length;n++)for(l=0;l<x[n].length;l++)T(x[n][l])}x.length===1?x=x[0]:v="Multi"+v;var M={type:"Feature",geometry:{type:v,coordinates:x},properties:this.properties};return"id"in this&&(M.id=this.id),M};var Kg=ey;function ey(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(rb,this,e),this.length=this._features.length}function rb(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(n){for(var l=null,u=n.readVarint()+n.pos;n.pos<u;){var p=n.readVarint()>>3;l=p===1?n.readString():p===2?n.readFloat():p===3?n.readDouble():p===4?n.readVarint64():p===5?n.readVarint():p===6?n.readSVarint():p===7?n.readBoolean():null}return l}(t))}function nb(i,e,t){if(i===3){var n=new Kg(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}ey.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Jg(this._pbf,e,this.extent,this._keys,this._values)};var Va={VectorTile:function(i,e){this.layers=i.readFields(nb,{},e)},VectorTileFeature:Jg,VectorTileLayer:Kg};function Dd(i,e,t,n){const l=[],u=n===0?(p,f,x,v,T,C)=>{p.push(new R(C,x+(C-f)/(v-f)*(T-x)))}:(p,f,x,v,T,C)=>{p.push(new R(f+(C-x)/(T-x)*(v-f),C))};for(const p of i){const f=[];for(const x of p){if(x.length<=2)continue;const v=[];for(let M=0;M<x.length-1;M++){const B=x[M].x,L=x[M].y,N=x[M+1].x,Z=x[M+1].y,K=n===0?B:L,le=n===0?N:Z;K<e?le>e&&u(v,B,L,N,Z,e):K>t?le<t&&u(v,B,L,N,Z,t):v.push(x[M]),le<e&&K>=e&&u(v,B,L,N,Z,e),le>t&&K<=t&&u(v,B,L,N,Z,t)}let T=x[x.length-1];const C=n===0?T.x:T.y;C>=e&&C<=t&&v.push(T),v.length&&(T=v[v.length-1],v[0].x===T.x&&v[0].y===T.y||v.push(v[0]),f.push(v))}f.length&&l.push(f)}return l}const ob=Va.VectorTileFeature.types,sb=Math.pow(2,13);function Pu(i,e,t,n,l,u,p,f){i.emplaceBack((e<<1)+p,(t<<1)+u,(Math.floor(n*sb)<<1)+l,Math.round(f))}function Du(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class ty{constructor(){this.acc=new R(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new R(e.x,e.y),this.max=new R(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,l=this.max;e.x<n.x?n.x=e.x:e.x>l.x&&(l.x=e.x),e.y<n.y?n.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===Vt)&&e.x===t.x)!=((e.y===0||e.y===Vt)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,mi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Vt!=e.x>Vt&&this.addBorderIntersection(1,mi(t.y,e.y,(Vt-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,mi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Vt!=e.y>Vt&&this.addBorderIntersection(3,mi(t.x,e.x,(Vt-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((t,n)=>t+n.edges,0);return e!==0?this.acc.div(e)._round():new R(0,0)}span(){return new R(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Bu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Mt,this.centroidVertexArray=new hg,this.indexArray=new Kt,this.programConfigurations=new Ba(e.layers,e.zoom),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,n,l){this.features=[],this.hasPattern=Vf("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const p=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*p/(p*p+1)/Vt/(1<<u.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:p,index:f,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,T=La(u,v);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),T,n))continue;const C={id:p,sourceLayerIndex:x,index:f,geometry:v?T.geometry:Jo(u,n,l),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(jf("fill-extrusion",this.layers,C,this.zoom,t)):this.addFeature(C,C.geometry,f,n,{},t.availableImages,l),t.featureIndex.insert(u,C.geometry,f,x,this.index,M)}this.sortBorders()}addFeatures(e,t,n,l,u){for(const p of this.features){const{geometry:f}=p;this.addFeature(p,f,p.index,t,n,l,u)}this.sortBorders()}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,K1.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,J1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,l,u,p,f){const x=[new R(0,0),new R(Vt,Vt)],v=f.projection,T=v.name==="globe",C=this.enableTerrain&&!T?new ty:null,M=ob[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Nr);const B=Uf(t,500);for(let K=B.length-1;K>=0;K--){const le=B[K];(le.length===0||(L=le[0]).every(ie=>ie.x<=0)||L.every(ie=>ie.x>=Vt)||L.every(ie=>ie.y<=0)||L.every(ie=>ie.y>=Vt))&&B.splice(K,1)}var L;let N;if(T)N=ly(B,x,l);else{N=[];for(const K of B)N.push({polygon:K,bounds:x})}const Z=M?this.edgeRadius:0;for(const{polygon:K,bounds:le}of N){let ie=0,se=0;for(const ue of K)M&&!ue[0].equals(ue[ue.length-1])&&ue.push(ue[0]),se+=M?ue.length-1:ue.length;const me=this.segments.prepareSegment((M?5:4)*se,this.layoutVertexArray,this.indexArray);if(M){const ue=[],Ce=[];ie=me.vertexLength;for(const De of K){let et,Me;De.length&&De!==K[0]&&Ce.push(ue.length/2),et=De[1].sub(De[0])._perp()._unit();for(let Le=1;Le<De.length;Le++){const je=De[Le],Re=De[Le===De.length-1?1:Le+1];let{x:Je,y:Ne}=je;if(Z){Me=Re.sub(je)._perp()._unit();const ct=et.add(Me)._unit(),Wt=Z*Math.min(4,1/(et.x*ct.x+et.y*ct.y));Je+=Wt*ct.x,Ne+=Wt*ct.y,et=Me}Pu(this.layoutVertexArray,Je,Ne,0,0,1,1,0),me.vertexLength++,ue.push(je.x,je.y),T&&Du(this.layoutVertexExtArray,v.projectTilePoint(Je,Ne,l),v.upVector(l,Je,Ne))}}const Se=Id(ue,Ce);for(let De=0;De<Se.length;De+=3)this.indexArray.emplaceBack(ie+Se[De],ie+Se[De+2],ie+Se[De+1]),me.primitiveLength++}for(const ue of K){C&&ue.length&&C.startRing(ue[0]);let Ce,Se,De,et=ue.length>4&&oy(ue[ue.length-2],ue[0],ue[1]),Me=Z?ab(ue[ue.length-2],ue[0],ue[1],Z):0;Se=ue[1].sub(ue[0])._perp()._unit();for(let Le=1,je=0;Le<ue.length;Le++){let Re=ue[Le-1],Je=ue[Le];const Ne=ue[Le===ue.length-1?1:Le+1];if(C&&M&&C.currentPolyCount.top++,ny(Je,Re,le)){Z&&(Se=Ne.sub(Je)._perp()._unit());continue}C&&C.append(Je,Re);const ct=Je.sub(Re)._perp(),Wt=ct.x/(Math.abs(ct.x)+Math.abs(ct.y)),Ht=ct.y>0?1:0,Ct=Re.dist(Je);if(je+Ct>32768&&(je=0),Z){De=Ne.sub(Je)._perp()._unit();let mt=ry(Re,Je,Ne,iy(Se,De),Z);isNaN(mt)&&(mt=0);const Vi=Je.sub(Re)._unit();Re=Re.add(Vi.mult(Me))._round(),Je=Je.add(Vi.mult(-mt))._round(),Me=mt,Se=De}const nt=me.vertexLength,si=ue.length>4&&oy(Re,Je,Ne);let Nt=sy(je,et,!0);if(Pu(this.layoutVertexArray,Re.x,Re.y,Wt,Ht,0,0,Nt),Pu(this.layoutVertexArray,Re.x,Re.y,Wt,Ht,0,1,Nt),je+=Ct,Nt=sy(je,si,!1),et=si,Pu(this.layoutVertexArray,Je.x,Je.y,Wt,Ht,0,0,Nt),Pu(this.layoutVertexArray,Je.x,Je.y,Wt,Ht,0,1,Nt),me.vertexLength+=4,this.indexArray.emplaceBack(nt+0,nt+1,nt+2),this.indexArray.emplaceBack(nt+1,nt+3,nt+2),me.primitiveLength+=2,Z){const mt=ie+(Le===1?ue.length-2:Le-2),Vi=Le===1?ie:mt+1;if(this.indexArray.emplaceBack(nt+1,mt,nt+3),this.indexArray.emplaceBack(mt,Vi,nt+3),me.primitiveLength+=2,Ce===void 0&&(Ce=nt),!ny(Ne,ue[Le],le)){const Di=Le===ue.length-1?Ce:me.vertexLength;this.indexArray.emplaceBack(nt+2,nt+3,Di),this.indexArray.emplaceBack(nt+3,Di+1,Di),this.indexArray.emplaceBack(nt+3,Vi,Di+1),me.primitiveLength+=3}}if(T){const mt=this.layoutVertexExtArray,Vi=v.projectTilePoint(Re.x,Re.y,l),Di=v.projectTilePoint(Je.x,Je.y,l),Hi=v.upVector(l,Re.x,Re.y),Qt=v.upVector(l,Je.x,Je.y);Du(mt,Vi,Hi),Du(mt,Vi,Hi),Du(mt,Di,Qt),Du(mt,Di,Qt)}}M&&(ie+=ue.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const K=C.borders,le=this.featuresOnBorder.push(C)-1;for(let ie=0;ie<4;ie++)K[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(le)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,t,n=!0){let l,u;if(e)if(e.y!==0){const f=t.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(f.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(f.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+n;let p=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const f of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*f.edges+f.top);for(let x=0;x<f.top;x++)this.centroidVertexArray.emplace(p++,l,u);for(let x=0;x<2*f.edges;x++)this.centroidVertexArray.emplace(p++,0,u),this.centroidVertexArray.emplace(p++,l,u)}}}function iy(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function ab(i,e,t,n){const l=e.sub(i)._perp()._unit(),u=t.sub(e)._perp()._unit();return ry(i,e,t,iy(l,u),n)}function ry(i,e,t,n,l){const u=Math.sqrt(1-n*n);return Math.min(i.dist(e)/3,e.dist(t)/3,l*u/n)}function ny(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function oy(i,e,t){if(i.x<0||i.x>=Vt||e.x<0||e.x>=Vt||t.x<0||t.x>=Vt)return!1;const n=t.sub(e),l=n.perp(),u=i.sub(e);return(n.x*u.x+n.y*u.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function sy(i,e,t){const n=e?2|i:-3&i;return t?1|n:-2&n}function ay(){const i=Math.PI/32,e=Math.tan(i),t=_f;return t*Math.sqrt(1+2*e*e)-t}function ly(i,e,t){const n=1<<t.z,l=Nn(t.x/n),u=Nn((t.x+1)/n),p=Lr(t.y/n),f=Lr((t.y+1)/n);return function(x,v,T,C,M=0,B){const L=[];if(!x.length||!T||!C)return L;const N=(ue,Ce)=>{for(const Se of ue)L.push({polygon:Se,bounds:Ce})},Z=Math.ceil(Math.log2(T)),K=Math.ceil(Math.log2(C)),le=Z-K,ie=[];for(let ue=0;ue<Math.abs(le);ue++)ie.push(le>0?0:1);for(let ue=0;ue<Math.min(Z,K);ue++)ie.push(0),ie.push(1);let se=x;if(se=Dd(se,v[0].y-M,v[1].y+M,1),se=Dd(se,v[0].x-M,v[1].x+M,0),!se.length)return L;const me=[];for(ie.length?me.push({polygons:se,bounds:v,depth:0}):N(se,v);me.length;){const ue=me.pop(),Ce=ue.depth,Se=ie[Ce],De=ue.bounds[0],et=ue.bounds[1],Me=Se===0?De.x:De.y,Le=Se===0?et.x:et.y,je=B?B(Se,Me,Le):.5*(Me+Le),Re=Dd(ue.polygons,Me-M,je+M,Se),Je=Dd(ue.polygons,je-M,Le+M,Se);if(Re.length){const Ne=[De,new R(Se===0?je:et.x,Se===1?je:et.y)];ie.length>Ce+1?me.push({polygons:Re,bounds:Ne,depth:Ce+1}):N(Re,Ne)}if(Je.length){const Ne=[new R(Se===0?je:De.x,Se===1?je:De.y),et];ie.length>Ce+1?me.push({polygons:Je,bounds:Ne,depth:Ce+1}):N(Je,Ne)}}return L}(i,e,Math.ceil((u-l)/11.25),Math.ceil((p-f)/11.25),1,(x,v,T)=>{if(x===0)return .5*(v+T);{const C=Lr((t.y+v/Vt)/n);return(Yo(.5*(Lr((t.y+T/Vt)/n)+C))*n-t.y)*Vt}})}_t(Bu,"FillExtrusionBucket",{omit:["layers","features"]}),_t(ty,"PartMetadata");const lb=new Be({"fill-extrusion-edge-radius":new he(Pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var cb={paint:new Be({"fill-extrusion-opacity":new he(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xe(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Te(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xe(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xe(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:lb};function cy(i,e,t){var n=2*Math.PI*6378137/256/Math.pow(2,t);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Bd{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Lu(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=function(u,p,f){var x=cy(256*u,256*(p=Math.pow(2,f)-p-1),f),v=cy(256*(u+1),256*(p+1),f);return x[0]+","+x[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),l=function(u,p,f){let x,v="";for(let T=u;T>0;T--)x=1<<T-1,v+=(p&x?1:0)+(f&x?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uy{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Lu(e,t.z,t.z,t.x,t.y)}}class Qr{constructor(e,t,n,l,u){this.overscaledZ=e,this.wrap=t,this.canonical=new Bd(n,+l,+u),this.key=t===0&&e===n?this.canonical.key:Lu(t,e,n,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Qr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qr(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Lu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Lu(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Qr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,l=2*this.canonical.y;return[new Qr(t,this.wrap,t,n,l),new Qr(t,this.wrap,t,n+1,l),new Qr(t,this.wrap,t,n,l+1),new Qr(t,this.wrap,t,n+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Qr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Qr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Lu(i,e,t,n,l){const u=1<<Math.min(t,22);let p=u*(l%u)+n%u;return i&&t<22&&(p+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*p+t)+(e-t)}function Ru(i,e){return i.x*e.x+i.y*e.y}function hy(i,e){if(i.length===1){let t=0;const n=e[t++];let l;for(;!l||n.equals(l);)if(l=e[t++],!l)return 1/0;for(;t<e.length;t++){const u=e[t],p=i[0],f=l.sub(n),x=u.sub(n),v=p.sub(n),T=Ru(f,f),C=Ru(f,x),M=Ru(x,x),B=Ru(v,f),L=Ru(v,x),N=T*M-C*C,Z=(M*B-C*L)/N,K=(T*L-C*B)/N,le=n.z*(1-Z-K)+l.z*Z+u.z*K;if(isFinite(le))return le}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function Ld(i){const e=new R(i[0],i[1]);return e.z=i[2],e}function dy(i,e,t,n,l,u,p,f){const x=p*l.getElevationAt(i,e,!0,!0),v=u[0]!==0,T=v?u[1]===0?p*(u[0]/7-450):p*function(C,M,B){const L=Math.floor(M[0]/8),N=Math.floor(M[1]/8),Z=10*(M[0]-8*L),K=10*(M[1]-8*N),le=C.getElevationAt(L,N,!0,!0),ie=C.getMeterToDEM(B),se=Math.floor(.5*(Z*ie-1)),me=Math.floor(.5*(K*ie-1)),ue=C.tileCoordToPixel(L,N),Ce=2*se+1,Se=2*me+1,De=function(Je,Ne,ct,Wt,Ht){return[Je.getElevationAtPixel(Ne,ct,!0),Je.getElevationAtPixel(Ne+Ht,ct,!0),Je.getElevationAtPixel(Ne,ct+Ht,!0),Je.getElevationAtPixel(Ne+Wt,ct+Ht,!0)]}(C,ue.x-se,ue.y-me,Ce,Se),et=Math.abs(De[0]-De[1]),Me=Math.abs(De[2]-De[3]),Le=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),je=Math.min(.25,.5*ie*(et+Me)/Ce),Re=Math.min(.25,.5*ie*Le/Se);return le+Math.max(je*Z,Re*K)}(l,u,f):x;return{base:x+(t===0)?-1:t,top:v?Math.max(T+n,x+t+2):x+n}}_t(Bd,"CanonicalTileID"),_t(Qr,"OverscaledTileID",{omit:["projMatrix"]});const ub=Oe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:hb}=ub,db=Oe([{name:"a_packed",components:4,type:"Float32"}]),{members:pb}=db,fb=Va.VectorTileFeature.types,mb=Math.cos(Math.PI/180*37.5);class Rd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new jt,this.layoutVertexArray2=new oi,this.indexArray=new Kt,this.programConfigurations=new Ba(e.layers,e.zoom),this.segments=new mr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,l){this.hasPattern=Vf("line",this.layers,t);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:C,index:M,sourceLayerIndex:B}of e){const L=this.layers[0]._featureFilter.needGeometry,N=La(T,L);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),N,n))continue;const Z=u?u.evaluate(N,{},n):void 0,K={id:C,properties:T.properties,type:T.type,sourceLayerIndex:B,index:M,geometry:L?N.geometry:Jo(T,n,l),patterns:{},sortKey:Z};p.push(K)}u&&p.sort((T,C)=>T.sortKey-C.sortKey);const{lineAtlas:f,featureIndex:x}=t,v=this.addConstantDashes(f);for(const T of p){const{geometry:C,index:M,sourceLayerIndex:B}=T;if(v&&this.addFeatureDashes(T,f),this.hasPattern){const L=jf("line",this.layers,T,this.zoom,t);this.patternFeatures.push(L)}else this.addFeature(T,C,M,n,f.positions,t.availableImages);x.insert(e[M].feature,C,M,B,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const l=n.paint.get("line-dasharray").value,u=n.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")t=!0;else{const p=u.value,f=l.value;if(!f)continue;e.addDash(f.from,p),e.addDash(f.to,p),f.other&&e.addDash(f.other,p)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let f,x,v,T,C,M;if(u.kind==="constant"){const Z=u.value;if(!Z)continue;f=Z.other||Z.to,x=Z.to,v=Z.from}else f=u.evaluate({zoom:n-1},e),x=u.evaluate({zoom:n},e),v=u.evaluate({zoom:n+1},e);p.kind==="constant"?T=C=M=p.value:(T=p.evaluate({zoom:n-1},e),C=p.evaluate({zoom:n},e),M=p.evaluate({zoom:n+1},e)),t.addDash(f,T),t.addDash(x,C),t.addDash(v,M);const B=t.getKey(f,T),L=t.getKey(x,C),N=t.getKey(v,M);e.patterns[l.id]={min:B,mid:L,max:N}}}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}addFeatures(e,t,n,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,t,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,pb)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,l,u,p){const f=this.layers[0].layout,x=f.get("line-join").evaluate(e,{}),v=f.get("line-cap").evaluate(e,{}),T=f.get("line-miter-limit"),C=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of t)this.addLine(M,e,x,v,T,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}addLine(e,t,n,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<e.length-1;K++)this.totalDistance+=e[K].dist(e[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=fb[t.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let v=0;for(;v<x-1&&e[v].equals(e[v+1]);)v++;if(x<(f?3:2))return;n==="bevel"&&(u=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,B,L,N,Z;this.e1=this.e2=-1,f&&(M=e[x-2],Z=e[v].sub(M)._unit()._perp());for(let K=v;K<x;K++){if(L=K===x-1?f?e[v+1]:void 0:e[K+1],L&&e[K].equals(L))continue;Z&&(N=Z),M&&(B=M),M=e[K],Z=L?L.sub(M)._unit()._perp():N,N=N||Z;let le=N.add(Z);le.x===0&&le.y===0||le._unit();const ie=N.x*Z.x+N.y*Z.y,se=le.x*Z.x+le.y*Z.y,me=se!==0?1/se:1/0,ue=2*Math.sqrt(2-2*se),Ce=se<mb&&B&&L,Se=N.x*Z.y-N.y*Z.x>0;if(Ce&&K>v){const Me=M.dist(B);if(Me>2*T){const Le=M.sub(M.sub(B)._mult(T/Me)._round());this.updateDistance(B,Le),this.addCurrentVertex(Le,N,0,0,C),B=Le}}const De=B&&L;let et=De?n:f?"butt":l;if(De&&et==="round"&&(me<p?et="miter":me<=2&&(et="fakeround")),et==="miter"&&me>u&&(et="bevel"),et==="bevel"&&(me>2&&(et="flipbevel"),me<u&&(et="miter")),B&&this.updateDistance(B,M),et==="miter")le._mult(me),this.addCurrentVertex(M,le,0,0,C);else if(et==="flipbevel"){if(me>100)le=Z.mult(-1);else{const Me=me*N.add(Z).mag()/N.sub(Z).mag();le._perp()._mult(Me*(Se?-1:1))}this.addCurrentVertex(M,le,0,0,C),this.addCurrentVertex(M,le.mult(-1),0,0,C)}else if(et==="bevel"||et==="fakeround"){const Me=-Math.sqrt(me*me-1),Le=Se?Me:0,je=Se?0:Me;if(B&&this.addCurrentVertex(M,N,Le,je,C),et==="fakeround"){const Re=Math.round(180*ue/Math.PI/20);for(let Je=1;Je<Re;Je++){let Ne=Je/Re;if(Ne!==.5){const Wt=Ne-.5;Ne+=Ne*Wt*(Ne-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Wt*Wt+(.848013+ie*(.215638*ie-1.06021)))}const ct=Z.sub(N)._mult(Ne)._add(N)._unit()._mult(Se?-1:1);this.addHalfVertex(M,ct.x,ct.y,!1,Se,0,C)}}L&&this.addCurrentVertex(M,Z,-Le,-je,C)}else if(et==="butt")this.addCurrentVertex(M,le,0,0,C);else if(et==="square"){const Me=B?1:-1;B||this.addCurrentVertex(M,le,Me,Me,C),this.addCurrentVertex(M,le,0,0,C),B&&this.addCurrentVertex(M,le,Me,Me,C)}else et==="round"&&(B&&(this.addCurrentVertex(M,N,0,0,C),this.addCurrentVertex(M,N,1,1,C,!0)),L&&(this.addCurrentVertex(M,Z,-1,-1,C,!0),this.addCurrentVertex(M,Z,0,0,C)));if(Ce&&K<x-1){const Me=M.dist(L);if(Me>2*T){const Le=M.add(L.sub(M)._mult(T/Me)._round());this.updateDistance(M,Le),this.addCurrentVertex(Le,Z,0,0,C),M=Le}}}}addCurrentVertex(e,t,n,l,u,p=!1){const f=t.y*l-t.x,x=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,p,!1,n,u),this.addHalfVertex(e,f,x,p,!0,-l,u)}addHalfVertex({x:e,y:t},n,l,u,p,f,x){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(t<<1)+(p?1:0),Math.round(63*n)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),x.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}_t(Rd,"LineBucket",{omit:["layers","patternFeatures"]});const _b=new Be({"line-cap":new xe(Pe.layout_line["line-cap"]),"line-join":new xe(Pe.layout_line["line-join"]),"line-miter-limit":new he(Pe.layout_line["line-miter-limit"]),"line-round-limit":new he(Pe.layout_line["line-round-limit"]),"line-sort-key":new xe(Pe.layout_line["line-sort-key"])});var py={paint:new Be({"line-opacity":new xe(Pe.paint_line["line-opacity"]),"line-color":new xe(Pe.paint_line["line-color"]),"line-translate":new he(Pe.paint_line["line-translate"]),"line-translate-anchor":new he(Pe.paint_line["line-translate-anchor"]),"line-width":new xe(Pe.paint_line["line-width"]),"line-gap-width":new xe(Pe.paint_line["line-gap-width"]),"line-offset":new xe(Pe.paint_line["line-offset"]),"line-blur":new xe(Pe.paint_line["line-blur"]),"line-dasharray":new Te(Pe.paint_line["line-dasharray"]),"line-pattern":new Te(Pe.paint_line["line-pattern"]),"line-gradient":new be(Pe.paint_line["line-gradient"]),"line-trim-offset":new he(Pe.paint_line["line-trim-offset"])}),layout:_b};const fy=new class extends xe{possiblyEvaluate(i,e){return e=new X(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,n){return e=gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,n)}}(py.paint.properties["line-width"].specification);function my(i,e){return e>0?e+2*i:i}fy.useIntegerZoom=!0;const gb=Oe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yb=Oe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),xb=Oe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Oe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vb=Oe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ab=Oe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _y=Oe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bb=Oe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oe([{name:"triangle",components:3,type:"Uint16"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oe([{type:"Float32",name:"offsetX"}]),Oe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Rr=24;const Io=128;function Nf(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new X(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:l}=t;let u=0;for(;u<n.length&&n[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<n.length&&n[p]<i+1;)p++;p=Math.min(n.length-1,p);const f=n[u],x=n[p];return t.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:x,minSize:t.evaluate(new X(f)),maxSize:t.evaluate(new X(x)),interpolationType:l}}}function Od(i,{uSize:e,uSizeT:t},{lowerSize:n,upperSize:l}){return i.kind==="source"?n/Io:i.kind==="composite"?mi(n/Io,l/Io,t):e}function ql(i,e){let t=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:p}=i,f=l?He(Vn.interpolationFactor(l,e,u,p),0,1):0;i.kind==="camera"?n=mi(i.minSize,i.maxSize,f):t=f}return{uSizeT:t,uSize:n}}var wb=Object.freeze({__proto__:null,getSizeData:Nf,evaluateSizeForFeature:Od,evaluateSizeForZoom:ql,SIZE_PACK_FACTOR:Io});function Eb(i,e,t){return i.sections.forEach(n=>{n.text=function(l,u,p){const f=u.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),W.applyArabicShaping&&(l=W.applyArabicShaping(l)),l}(n.text,e,t)}),i}const Ou={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Tb(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Sb(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var gy=function(i,e,t,n,l){var u,p,f=8*l-n-1,x=(1<<f)-1,v=x>>1,T=-7,C=t?l-1:0,M=t?-1:1,B=i[e+C];for(C+=M,u=B&(1<<-T)-1,B>>=-T,T+=f;T>0;u=256*u+i[e+C],C+=M,T-=8);for(p=u&(1<<-T)-1,u>>=-T,T+=n;T>0;p=256*p+i[e+C],C+=M,T-=8);if(u===0)u=1-v;else{if(u===x)return p?NaN:1/0*(B?-1:1);p+=Math.pow(2,n),u-=v}return(B?-1:1)*p*Math.pow(2,u-n)},yy=function(i,e,t,n,l,u){var p,f,x,v=8*u-l-1,T=(1<<v)-1,C=T>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=n?0:u-1,L=n?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-p))<1&&(p--,x*=2),(e+=p+C>=1?M/x:M*Math.pow(2,1-C))*x>=2&&(p++,x/=2),p+C>=T?(f=0,p=T):p+C>=1?(f=(e*x-1)*Math.pow(2,l),p+=C):(f=e*Math.pow(2,C-1)*Math.pow(2,l),p=0));l>=8;i[t+B]=255&f,B+=L,f/=256,l-=8);for(p=p<<l|f,v+=l;v>0;i[t+B]=255&p,B+=L,p/=256,v-=8);i[t+B-L]|=128*N},Fu=Ui;function Ui(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ui.Varint=0,Ui.Fixed64=1,Ui.Bytes=2,Ui.Fixed32=5;var $f=4294967296,xy=1/$f,vy=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function es(i){return i.type===Ui.Bytes?i.readVarint()+i.pos:i.pos+1}function Wl(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Ay(i,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(n);for(var l=t.pos-1;l>=i;l--)t.buf[l+n]=t.buf[l]}function Ib(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function Cb(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function Mb(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function zb(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function kb(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function Pb(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function Db(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function Bb(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function Lb(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Fd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Xl(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function by(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Rb(i,e,t){e.glyphs=[],i===1&&t.readMessage(Ob,e)}function Ob(i,e,t){if(i===3){const{id:n,bitmap:l,width:u,height:p,left:f,top:x,advance:v}=t.readMessage(Fb,{});e.glyphs.push({id:n,bitmap:new Ko({width:u+6,height:p+6},l),metrics:{width:u,height:p,left:f,top:x,advance:v}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function Fb(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function Gf(i){let e=0,t=0;for(const p of i)e+=p.w*p.h,t=Math.max(t,p.w);i.sort((p,f)=>f.h-p.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let l=0,u=0;for(const p of i)for(let f=n.length-1;f>=0;f--){const x=n[f];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===x.w&&p.h===x.h){const v=n.pop();f<n.length&&(n[f]=v)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(n.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Ui.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),l=n>>3,u=this.pos;this.type=7&n,i(l,e,this),this.pos===u&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Fd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=by(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Fd(this.buf,this.pos)+Fd(this.buf,this.pos+4)*$f;return this.pos+=8,i},readSFixed64:function(){var i=Fd(this.buf,this.pos)+by(this.buf,this.pos+4)*$f;return this.pos+=8,i},readFloat:function(){var i=gy(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=gy(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,n=this.buf;return e=127&(t=n[this.pos++]),t<128?e:(e|=(127&(t=n[this.pos++]))<<7,t<128?e:(e|=(127&(t=n[this.pos++]))<<14,t<128?e:(e|=(127&(t=n[this.pos++]))<<21,t<128?e:function(l,u,p){var f,x,v=p.buf;if(f=(112&(x=v[p.pos++]))>>4,x<128||(f|=(127&(x=v[p.pos++]))<<3,x<128)||(f|=(127&(x=v[p.pos++]))<<10,x<128)||(f|=(127&(x=v[p.pos++]))<<17,x<128)||(f|=(127&(x=v[p.pos++]))<<24,x<128)||(f|=(1&(x=v[p.pos++]))<<31,x<128))return Wl(l,f,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&vy?function(t,n,l){return vy.decode(t.subarray(n,l))}(this.buf,e,i):function(t,n,l){for(var u="",p=n;p<l;){var f,x,v,T=t[p],C=null,M=T>239?4:T>223?3:T>191?2:1;if(p+M>l)break;M===1?T<128&&(C=T):M===2?(192&(f=t[p+1]))==128&&(C=(31&T)<<6|63&f)<=127&&(C=null):M===3?(x=t[p+2],(192&(f=t[p+1]))==128&&(192&x)==128&&((C=(15&T)<<12|(63&f)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(x=t[p+2],v=t[p+3],(192&(f=t[p+1]))==128&&(192&x)==128&&(192&v)==128&&((C=(15&T)<<18|(63&f)<<12|(63&x)<<6|63&v)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),p+=M}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ui.Bytes)return i.push(this.readVarint(e));var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ui.Bytes)return i.push(this.readSVarint());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ui.Bytes)return i.push(this.readBoolean());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ui.Bytes)return i.push(this.readFloat());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ui.Bytes)return i.push(this.readDouble());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ui.Bytes)return i.push(this.readFixed32());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ui.Bytes)return i.push(this.readSFixed32());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ui.Bytes)return i.push(this.readFixed64());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ui.Bytes)return i.push(this.readSFixed64());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ui.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ui.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ui.Fixed32)this.pos+=4;else{if(e!==Ui.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Xl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Xl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Xl(this.buf,-1&i,this.pos),Xl(this.buf,Math.floor(i*xy),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Xl(this.buf,-1&i,this.pos),Xl(this.buf,Math.floor(i*xy),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var n,l;if(e>=0?(n=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(u,p,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)}(n,0,t),function(u,p){var f=(7&u)<<4;p.buf[p.pos++]|=f|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,l,u){for(var p,f,x=0;x<l.length;x++){if((p=l.charCodeAt(x))>55295&&p<57344){if(!f){p>56319||x+1===l.length?(n[u++]=239,n[u++]=191,n[u++]=189):f=p;continue}if(p<56320){n[u++]=239,n[u++]=191,n[u++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(n[u++]=239,n[u++]=191,n[u++]=189,f=null);p<128?n[u++]=p:(p<2048?n[u++]=p>>6|192:(p<65536?n[u++]=p>>12|224:(n[u++]=p>>18|240,n[u++]=p>>12&63|128),n[u++]=p>>6&63|128),n[u++]=63&p|128)}return u}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&Ay(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),yy(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),yy(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var n=this.pos-t;n>=128&&Ay(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,t){this.writeTag(i,Ui.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Ib,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Cb,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,kb,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Mb,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,zb,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Pb,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Db,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Bb,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Lb,e)},writeBytesField:function(i,e){this.writeTag(i,Ui.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ui.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ui.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ui.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ui.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ui.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ui.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ui.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ui.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ui.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Zf{constructor(e,{pixelRatio:t,version:n,stretchX:l,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=l,this.stretchY=u,this.content=p,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class wy{constructor(e,t){const n={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,n,u),this.addImages(t,l,u);const{w:p,h:f}=Gf(u),x=new _n({width:p||1,height:f||1});for(const v in e){const T=e[v],C=n[v].paddedRect;_n.copy(T.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},T.data)}for(const v in t){const T=t[v],C=l[v].paddedRect,M=C.x+1,B=C.y+1,L=T.data.width,N=T.data.height;_n.copy(T.data,x,{x:0,y:0},{x:M,y:B},T.data),_n.copy(T.data,x,{x:0,y:N-1},{x:M,y:B-1},{width:L,height:1}),_n.copy(T.data,x,{x:0,y:0},{x:M,y:B+N},{width:L,height:1}),_n.copy(T.data,x,{x:L-1,y:0},{x:M-1,y:B},{width:1,height:N}),_n.copy(T.data,x,{x:0,y:0},{x:M+L,y:B},{width:1,height:N})}this.image=x,this.iconPositions=n,this.patternPositions=l}addImages(e,t,n){for(const l in e){const u=e[l],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};n.push(p),t[l]=new Zf(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;const[l,u]=e.tl;n.update(t.data,void 0,{x:l,y:u})}}_t(Zf,"ImagePosition"),_t(wy,"ImageAtlas");const kn={horizontal:1,vertical:2,horizontalOnly:3};class Uu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Uu;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Uu;return t.imageName=e,t}}class Hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Hl;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?n.addImageSection(u):n.addTextSection(u,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,n){let l="";for(let u=0;u<t.length;u++){const p=t.charCodeAt(u+1)||null,f=t.charCodeAt(u-1)||null;l+=!n&&(p&&Pa(p)&&!Ou[t[u+1]]||f&&Pa(f)&&!Ou[t[u-1]])||!Ou[t[u]]?t[u]:Ou[t[u]]}return l}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Ud[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Ud[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Hl;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Uu.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void Ai("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Uu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ai("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qf(i,e,t,n,l,u,p,f,x,v,T,C,M,B,L,N){const Z=Hl.fromFeature(i,l);let K;C===kn.vertical&&Z.verticalizePunctuation(M);const{processBidirectionalText:le,processStyledBidirectionalText:ie}=W;if(le&&Z.sections.length===1){K=[];const ue=le(Z.toString(),Wf(Z,v,u,e,n,B,L));for(const Ce of ue){const Se=new Hl;Se.text=Ce,Se.sections=Z.sections;for(let De=0;De<Ce.length;De++)Se.sectionIndex.push(0);K.push(Se)}}else if(ie){K=[];const ue=ie(Z.text,Z.sectionIndex,Wf(Z,v,u,e,n,B,L));for(const Ce of ue){const Se=new Hl;Se.text=Ce[0],Se.sectionIndex=Ce[1],Se.sections=Z.sections,K.push(Se)}}else K=function(ue,Ce){const Se=[],De=ue.text;let et=0;for(const Me of Ce)Se.push(ue.substring(et,Me)),et=Me;return et<De.length&&Se.push(ue.substring(et,De.length)),Se}(Z,Wf(Z,v,u,e,n,B,L));const se=[],me={positionedLines:se,text:Z.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,Ce,Se,De,et,Me,Le,je,Re,Je,Ne,ct){let Wt=0,Ht=0,Ct=0;const nt=je==="right"?1:je==="left"?0:.5;let si=!1;for(const Qt of et){const gi=Qt.getSections();for(const ji of gi){if(ji.imageName)continue;const Bi=Ce[ji.fontStack];if(Bi&&(si=Bi.ascender!==void 0&&Bi.descender!==void 0,!si))break}if(!si)break}let Nt=0;for(const Qt of et){Qt.trim();const gi=Qt.getMaxScale(),ji=(gi-1)*Rr,Bi={positionedGlyphs:[],lineOffset:0};ue.positionedLines[Nt]=Bi;const ki=Bi.positionedGlyphs;let qi=0;if(!Qt.length()){Ht+=Me,++Nt;continue}let Ji=0,Ir=0;for(let ci=0;ci<Qt.length();ci++){const sr=Qt.getSection(ci),$r=Qt.getSectionIndex(ci),wi=Qt.getCharCode(ci);let Ki=sr.scale,Yr=null,Qi=null,ur=null,Cr=Rr,vr=0;const Or=!(Re===kn.horizontal||!Ne&&!Fl(wi)||Ne&&(Ud[wi]||(mt=wi,od(mt)||sd(mt)||ad(mt)||ka(mt)||Au(mt))));if(sr.imageName){const Jr=De[sr.imageName];if(!Jr)continue;ur=sr.imageName,ue.iconsInText=ue.iconsInText||!0,Qi=Jr.paddedRect;const Mr=Jr.displaySize;Ki=Ki*Rr/ct,Yr={width:Mr[0],height:Mr[1],left:1,top:-3,advance:Or?Mr[1]:Mr[0],localGlyph:!1},vr=si?-Yr.height*Ki:gi*Rr-17-Mr[1]*Ki,Cr=Yr.advance;const rs=(Or?Mr[0]:Mr[1])*Ki-Rr*gi;rs>0&&rs>qi&&(qi=rs)}else{const Jr=Se[sr.fontStack];if(!Jr)continue;Jr[wi]&&(Qi=Jr[wi]);const Mr=Ce[sr.fontStack];if(!Mr)continue;const rs=Mr.glyphs[wi];if(!rs)continue;if(Yr=rs.metrics,Cr=wi!==8203?Rr:0,si){const ic=Mr.ascender!==void 0?Math.abs(Mr.ascender):0,Yu=Mr.descender!==void 0?Math.abs(Mr.descender):0,Ju=(ic+Yu)*Ki;Ji<Ju&&(Ji=Ju,Ir=(ic-Yu)/2*Ki),vr=-ic*Ki}else vr=(gi-Ki)*Rr-17}Or?(ue.verticalizable=!0,ki.push({glyph:wi,imageName:ur,x:Wt,y:Ht+vr,vertical:Or,scale:Ki,localGlyph:Yr.localGlyph,fontStack:sr.fontStack,sectionIndex:$r,metrics:Yr,rect:Qi}),Wt+=Cr*Ki+Je):(ki.push({glyph:wi,imageName:ur,x:Wt,y:Ht+vr,vertical:Or,scale:Ki,localGlyph:Yr.localGlyph,fontStack:sr.fontStack,sectionIndex:$r,metrics:Yr,rect:Qi}),Wt+=Yr.advance*Ki+Je)}ki.length!==0&&(Ct=Math.max(Wt-Je,Ct),si?Cy(ki,nt,qi,Ir,Me*gi/2):Cy(ki,nt,qi,0,Me/2)),Wt=0;const an=Me*gi+qi;Bi.lineOffset=Math.max(qi,ji),Ht+=an,++Nt}var mt;const Vi=Ht,{horizontalAlign:Di,verticalAlign:Hi}=Xf(Le);(function(Qt,gi,ji,Bi,ki,qi){const Ji=(gi-ji)*ki,Ir=-qi*Bi;for(const an of Qt)for(const ci of an.positionedGlyphs)ci.x+=Ji,ci.y+=Ir})(ue.positionedLines,nt,Di,Hi,Ct,Vi),ue.top+=-Hi*Vi,ue.bottom=ue.top+Vi,ue.left+=-Di*Ct,ue.right=ue.left+Ct,ue.hasBaseline=si}(me,e,t,n,K,p,f,x,C,v,M,N),!function(ue){for(const Ce of ue)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(se)&&me}const Ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ub={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ey(i,e,t,n,l,u){if(e.imageName){const p=n[e.imageName];return p?p.displaySize[0]*e.scale*Rr/u+l:0}{const p=t[e.fontStack],f=p&&p.glyphs[i];return f?f.metrics.advance*e.scale+l:0}}function Ty(i,e,t,n){const l=Math.pow(i-e,2);return n?i<e?l/2:2*l:l+Math.abs(t)*t}function Vb(i,e,t){let n=0;return i===10&&(n-=1e4),t&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Sy(i,e,t,n,l,u){let p=null,f=Ty(e,t,l,u);for(const x of n){const v=Ty(e-x.x,t,l,u)+x.badness;v<=f&&(p=x,f=v)}return{index:i,x:e,priorBreak:p,badness:f}}function Iy(i){return i?Iy(i.priorBreak).concat(i.index):[]}function Wf(i,e,t,n,l,u,p){if(u!=="point")return[];if(!i)return[];const f=[],x=function(M,B,L,N,Z,K){let le=0;for(let ie=0;ie<M.length();ie++){const se=M.getSection(ie);le+=Ey(M.getCharCode(ie),se,N,Z,B,K)}return le/Math.max(1,Math.ceil(le/L))}(i,e,t,n,l,p),v=i.text.indexOf("\u200B")>=0;let T=0;for(let M=0;M<i.length();M++){const B=i.getSection(M),L=i.getCharCode(M);if(Ud[L]||(T+=Ey(L,B,n,l,e,p)),M<i.length()-1){const N=!((C=L)<11904||!(mu(C)||ud(C)||vu(C)||fd(C)||yu(C)||ld(C)||hd(C)||Ll(C)||xu(C)||za(C)||gu(C)||bu(C)||fu(C)||Ma(C)||cd(C)||_u(C)||$o(C)||md(C)||dd(C)||Rl(C)));(Ub[L]||N||B.imageName)&&f.push(Sy(M+1,T,x,f,Vb(L,i.getCharCode(M+1),N&&v),!1))}}var C;return Iy(Sy(i.length(),T,x,f,0,!0))}function Xf(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function Cy(i,e,t,n,l){if(!(e||t||n||l))return;const u=i.length-1,p=i[u],f=(p.x+p.metrics.advance*p.scale)*e;for(let x=0;x<=u;x++)i[x].x-=f,i[x].y+=t+n+l}function jb(i,e,t){const{horizontalAlign:n,verticalAlign:l}=Xf(t),u=e[0]-i.displaySize[0]*n,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function My(i,e,t,n,l,u){const p=i.image;let f;if(p.content){const Z=p.content,K=p.pixelRatio||1;f=[Z[0]/K,Z[1]/K,p.displaySize[0]-Z[2]/K,p.displaySize[1]-Z[3]/K]}const x=e.left*u,v=e.right*u;let T,C,M,B;t==="width"||t==="both"?(B=l[0]+x-n[3],C=l[0]+v+n[1]):(B=l[0]+(x+v-p.displaySize[0])/2,C=B+p.displaySize[0]);const L=e.top*u,N=e.bottom*u;return t==="height"||t==="both"?(T=l[1]+L-n[0],M=l[1]+N+n[2]):(T=l[1]+(L+N-p.displaySize[1])/2,M=T+p.displaySize[1]),{image:p,top:T,right:C,bottom:M,left:B,collisionPadding:f}}class ts extends R{constructor(e,t,n,l,u){super(e,t),this.angle=l,this.z=n,u!==void 0&&(this.segment=u)}clone(){return new ts(this.x,this.y,this.z,this.angle,this.segment)}}function zy(i,e,t,n,l){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,f=0;for(;f>-t/2;){if(p--,p<0)return!1;f-=i[p].dist(u),u=i[p]}f+=i[p].dist(i[p+1]),p++;const x=[];let v=0;for(;f<t/2;){const T=i[p],C=i[p+1];if(!C)return!1;let M=i[p-1].angleTo(T)-T.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:f,angleDelta:M}),v+=M;f-x[0].distance>n;)v-=x.shift().angleDelta;if(v>l)return!1;p++,f+=T.dist(C)}return!0}function ky(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function Py(i,e,t){return i?.6*e*t:0}function Dy(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Nb(i,e,t,n,l,u){const p=Py(t,l,u),f=Dy(t,n)*u;let x=0;const v=ky(i)/2;for(let T=0;T<i.length-1;T++){const C=i[T],M=i[T+1],B=C.dist(M);if(x+B>v){const L=(v-x)/B,N=mi(C.x,M.x,L),Z=mi(C.y,M.y,L),K=new ts(N,Z,0,M.angleTo(C),T);return!p||zy(i,K,f,p,e)?K:void 0}x+=B}}function $b(i,e,t,n,l,u,p,f,x){const v=Py(n,u,p),T=Dy(n,l),C=T*p,M=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return e-C<e/4&&(e=C+e/4),By(i,M?e/2*f%e:(T/2+2*u)*p*f%e,e,v,t,C,M,!1,x)}function By(i,e,t,n,l,u,p,f,x){const v=u/2,T=ky(i);let C=0,M=e-t,B=[];for(let L=0;L<i.length-1;L++){const N=i[L],Z=i[L+1],K=N.dist(Z),le=Z.angleTo(N);for(;M+t<C+K;){M+=t;const ie=(M-C)/K,se=mi(N.x,Z.x,ie),me=mi(N.y,Z.y,ie);if(se>=0&&se<x&&me>=0&&me<x&&M-v>=0&&M+v<=T){const ue=new ts(se,me,0,le,L);ue._round(),n&&!zy(i,ue,u,n,l)||B.push(ue)}}C+=K}return f||B.length||p||(B=By(i,C/2,t,n,l,u,p,!0,x)),B}function Ly(i,e,t,n,l){const u=[];for(let p=0;p<i.length;p++){const f=i[p];let x;for(let v=0;v<f.length-1;v++){let T=f[v],C=f[v+1];T.x<e&&C.x<e||(T.x<e?T=new R(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x<e&&(C=new R(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y<t&&C.y<t||(T.y<t?T=new R(T.x+(t-T.y)/(C.y-T.y)*(C.x-T.x),t)._round():C.y<t&&(C=new R(T.x+(t-T.y)/(C.y-T.y)*(C.x-T.x),t)._round()),T.x>=n&&C.x>=n||(T.x>=n?T=new R(n,T.y+(n-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x>=n&&(C=new R(n,T.y+(n-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y>=l&&C.y>=l||(T.y>=l?T=new R(T.x+(l-T.y)/(C.y-T.y)*(C.x-T.x),l)._round():C.y>=l&&(C=new R(T.x+(l-T.y)/(C.y-T.y)*(C.x-T.x),l)._round()),x&&T.equals(x[x.length-1])||(x=[T],u.push(x)),x.push(C)))))}}return u}_t(ts,"Anchor");const Vu=1e20;function Ry(i,e,t,n,l,u,p,f,x){for(let v=e;v<e+n;v++)Oy(i,t*u+v,u,l,p,f,x);for(let v=t;v<t+l;v++)Oy(i,v*u+e,1,n,p,f,x)}function Oy(i,e,t,n,l,u,p){u[0]=0,p[0]=-Vu,p[1]=Vu,l[0]=i[e];for(let f=1,x=0,v=0;f<n;f++){l[f]=i[e+f*t];const T=f*f;do{const C=u[x];v=(l[f]-l[C]+T-C*C)/(f-C)/2}while(v<=p[x]&&--x>-1);x++,u[x]=f,p[x]=v,p[x+1]=Vu}for(let f=0,x=0;f<n;f++){for(;p[x+1]<f;)x++;const v=u[x],T=f-v;i[e+f*t]=l[v]+T*T}}const Hf={none:0,ideographs:1,all:2};class Ql{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[];for(const l in e)for(const u of e[l])n.push({stack:l,id:u});xt(n,({stack:l,id:u},p)=>{let f=this.entries[l];f||(f=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=f.glyphs[u];if(x!==void 0)return void p(null,{stack:l,id:u,glyph:x});if(x=this._tinySDF(f,l,u),x)return f.glyphs[u]=x,void p(null,{stack:l,id:u,glyph:x});const v=Math.floor(u/256);if(256*v>65535)return void p(new Error("glyphs > 65535 not supported"));if(f.ranges[v])return void p(null,{stack:l,id:u,glyph:x});let T=f.requests[v];T||(T=f.requests[v]=[],Ql.loadGlyphRange(l,v,this.url,this.requestManager,(C,M)=>{if(M){f.ascender=M.ascender,f.descender=M.descender;for(const B in M.glyphs)this._doesCharSupportLocalGlyph(+B)||(f.glyphs[+B]=M.glyphs[+B]);f.ranges[v]=!0}for(const B of T)B(C,M);delete f.requests[v]})),T.push((C,M)=>{C?p(C):M&&p(null,{stack:l,id:u,glyph:M.glyphs[u]||null})})},(l,u)=>{if(l)t(l);else if(u){const p={};for(const{stack:f,id:x,glyph:v}of u)p[f]===void 0&&(p[f]={}),p[f].glyphs===void 0&&(p[f].glyphs={}),p[f].glyphs[x]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},p[f].ascender=this.entries[f].ascender,p[f].descender=this.entries[f].descender;t(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Hf.none&&(this.localGlyphMode===Hf.all?!!this.localFontFamily:!!this.localFontFamily&&(za(e)||pd(e)||fu(e)||$o(e)||Ll(e)))}_tinySDF(e,t,n){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(n))return;let u=e.tinySDF;if(!u){let N="400";/bold/i.test(t)?N="900":/medium/i.test(t)?N="500":/light/i.test(t)&&(N="200"),u=e.tinySDF=new Ql.TinySDF({fontFamily:l,fontWeight:N,fontSize:48,buffer:6,radius:16}),u.fontWeight=N}if(this.localGlyphs[u.fontWeight][n])return this.localGlyphs[u.fontWeight][n];const p=String.fromCharCode(n),{data:f,width:x,height:v,glyphWidth:T,glyphHeight:C,glyphLeft:M,glyphTop:B,glyphAdvance:L}=u.draw(p);return this.localGlyphs[u.fontWeight][n]={id:n,bitmap:new Ko({width:x,height:v},f),metrics:{width:T/2,height:C/2,left:M/2,top:B/2-27,advance:L/2,localGlyph:!0}}}}function Fy(i,e,t,n){const l=[],u=i.image,p=u.pixelRatio,f=u.paddedRect.w-2,x=u.paddedRect.h-2,v=i.right-i.left,T=i.bottom-i.top,C=u.stretchX||[[0,f]],M=u.stretchY||[[0,x]],B=(Me,Le)=>Me+Le[1]-Le[0],L=C.reduce(B,0),N=M.reduce(B,0),Z=f-L,K=x-N;let le=0,ie=L,se=0,me=N,ue=0,Ce=Z,Se=0,De=K;if(u.content&&n){const Me=u.content;le=Vd(C,0,Me[0]),se=Vd(M,0,Me[1]),ie=Vd(C,Me[0],Me[2]),me=Vd(M,Me[1],Me[3]),ue=Me[0]-le,Se=Me[1]-se,Ce=Me[2]-Me[0]-ie,De=Me[3]-Me[1]-me}const et=(Me,Le,je,Re)=>{const Je=jd(Me.stretch-le,ie,v,i.left),Ne=Nd(Me.fixed-ue,Ce,Me.stretch,L),ct=jd(Le.stretch-se,me,T,i.top),Wt=Nd(Le.fixed-Se,De,Le.stretch,N),Ht=jd(je.stretch-le,ie,v,i.left),Ct=Nd(je.fixed-ue,Ce,je.stretch,L),nt=jd(Re.stretch-se,me,T,i.top),si=Nd(Re.fixed-Se,De,Re.stretch,N),Nt=new R(Je,ct),mt=new R(Ht,ct),Vi=new R(Ht,nt),Di=new R(Je,nt),Hi=new R(Ne/p,Wt/p),Qt=new R(Ct/p,si/p),gi=e*Math.PI/180;if(gi){const ki=Math.sin(gi),qi=Math.cos(gi),Ji=[qi,-ki,ki,qi];Nt._matMult(Ji),mt._matMult(Ji),Di._matMult(Ji),Vi._matMult(Ji)}const ji=Me.stretch+Me.fixed,Bi=Le.stretch+Le.fixed;return{tl:Nt,tr:mt,bl:Di,br:Vi,tex:{x:u.paddedRect.x+1+ji,y:u.paddedRect.y+1+Bi,w:je.stretch+je.fixed-ji,h:Re.stretch+Re.fixed-Bi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:Qt,minFontScaleX:Ce/p/v,minFontScaleY:De/p/T,isSDF:t}};if(n&&(u.stretchX||u.stretchY)){const Me=Uy(C,Z,L),Le=Uy(M,K,N);for(let je=0;je<Me.length-1;je++){const Re=Me[je],Je=Me[je+1];for(let Ne=0;Ne<Le.length-1;Ne++)l.push(et(Re,Le[Ne],Je,Le[Ne+1]))}}else l.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:x+1}));return l}function Vd(i,e,t){let n=0;for(const l of i)n+=Math.max(e,Math.min(t,l[1]))-Math.max(e,Math.min(t,l[0]));return n}function Uy(i,e,t){const n=[{fixed:-1,stretch:0}];for(const[l,u]of i){const p=n[n.length-1];n.push({fixed:l-p.stretch,stretch:p.stretch}),n.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return n.push({fixed:e+1,stretch:t}),n}function jd(i,e,t,n){return i/e*t+n}function Nd(i,e,t,n){return i-e*t/n}function Gb(i,e,t,n){const l=e+i.positionedLines[n].lineOffset;return n===0?t+l/2:t+(l+(e+i.positionedLines[n-1].lineOffset))/2}Ql.loadGlyphRange=function(i,e,t,n,l){const u=256*e,p=u+255,f=n.transformRequest(n.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${u}-${p}`),ge.Glyphs);Ee(f,(x,v)=>{if(x)l(x);else if(v){const T={},C=function(M){return new Fu(M).readFields(Rb,{})}(v);for(const M of C.glyphs)T[M.id]=M;l(null,{glyphs:T,ascender:C.ascender,descender:C.descender})}})},Ql.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:n=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=t;const f=this.size=i+4*e,x=this._createCanvas(f),v=this.ctx=x.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${u} ${i}px ${l}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:n,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(i),p=Math.ceil(t),f=Math.min(this.size-this.buffer,Math.ceil(u-l)),x=Math.min(this.size-this.buffer,p+Math.ceil(n)),v=f+2*this.buffer,T=x+2*this.buffer,C=Math.max(v*T,0),M=new Uint8ClampedArray(C),B={data:M,width:v,height:T,glyphWidth:f,glyphHeight:x,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(f===0||x===0)return B;const{ctx:L,buffer:N,gridInner:Z,gridOuter:K}=this;L.clearRect(N,N,f,x),L.fillText(i,N,N+p);const le=L.getImageData(N,N,f,x);K.fill(Vu,0,C),Z.fill(0,0,C);for(let ie=0;ie<x;ie++)for(let se=0;se<f;se++){const me=le.data[4*(ie*f+se)+3]/255;if(me===0)continue;const ue=(ie+N)*v+se+N;if(me===1)K[ue]=0,Z[ue]=Vu;else{const Ce=.5-me;K[ue]=Ce>0?Ce*Ce:0,Z[ue]=Ce<0?Ce*Ce:0}}Ry(K,0,0,v,T,v,this.f,this.v,this.z),Ry(Z,N,N,f,x,v,this.f,this.v,this.z);for(let ie=0;ie<C;ie++){const se=Math.sqrt(K[ie])-Math.sqrt(Z[ie]);M[ie]=Math.round(255-255*(se/this.radius+this.cutoff))}return B}};class Zb{constructor(e=[],t=qb){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,l=t[e];for(;e>0;){const u=e-1>>1,p=t[u];if(n(l,p)>=0)break;t[e]=p,e=u}t[e]=l}_down(e){const{data:t,compare:n}=this,l=this.length>>1,u=t[e];for(;e<l;){let p=1+(e<<1),f=t[p];const x=p+1;if(x<this.length&&n(t[x],f)<0&&(p=x,f=t[x]),n(f,u)>=0)break;t[e]=f,e=p}t[e]=u}}function qb(i,e){return i<e?-1:i>e?1:0}function Wb(i,e=1,t=!1){let n=1/0,l=1/0,u=-1/0,p=-1/0;const f=i[0];for(let B=0;B<f.length;B++){const L=f[B];(!B||L.x<n)&&(n=L.x),(!B||L.y<l)&&(l=L.y),(!B||L.x>u)&&(u=L.x),(!B||L.y>p)&&(p=L.y)}const x=Math.min(u-n,p-l);let v=x/2;const T=new Zb([],Xb);if(x===0)return new R(n,l);for(let B=n;B<u;B+=x)for(let L=l;L<p;L+=x)T.push(new Yl(B+v,L+v,v,i));let C=function(B){let L=0,N=0,Z=0;const K=B[0];for(let le=0,ie=K.length,se=ie-1;le<ie;se=le++){const me=K[le],ue=K[se],Ce=me.x*ue.y-ue.x*me.y;N+=(me.x+ue.x)*Ce,Z+=(me.y+ue.y)*Ce,L+=3*Ce}return new Yl(N/L,Z/L,0,B)}(i),M=T.length;for(;T.length;){const B=T.pop();(B.d>C.d||!C.d)&&(C=B,t&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,M)),B.max-C.d<=e||(v=B.h/2,T.push(new Yl(B.p.x-v,B.p.y-v,v,i)),T.push(new Yl(B.p.x+v,B.p.y-v,v,i)),T.push(new Yl(B.p.x-v,B.p.y+v,v,i)),T.push(new Yl(B.p.x+v,B.p.y+v,v,i)),M+=4)}return t&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function Xb(i,e){return e.max-i.max}function Yl(i,e,t,n){this.p=new R(i,e),this.h=t,this.d=function(l,u){let p=!1,f=1/0;for(let x=0;x<u.length;x++){const v=u[x];for(let T=0,C=v.length,M=C-1;T<C;M=T++){const B=v[T],L=v[M];B.y>l.y!=L.y>l.y&&l.x<(L.x-B.x)*(l.y-B.y)/(L.y-B.y)+B.x&&(p=!p),f=Math.min(f,Sg(l,B,L))}}return(p?1:-1)*Math.sqrt(f)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Qf=Number.POSITIVE_INFINITY,Hb=Math.sqrt(2);function Vy(i,e){return e[1]!==Qf?function(t,n,l){let u=0,p=0;switch(n=Math.abs(n),l=Math.abs(l),t){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(t){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}return[u,p]}(i,e[0],e[1]):function(t,n){let l=0,u=0;n<0&&(n=0);const p=n/Hb;switch(t){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-n;break;case"top":u=n-7}switch(t){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=n;break;case"right":l=-n}return[l,u]}(i,e[0])}function Qb(i,e,t,n,l,u,p,f,x,v){i.createArrays(),i.tilePixelRatio=Vt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const T=i.layers[0].layout,C=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:Z}=i.textSizeData;M.compositeTextSizes=[C["text-size"].possiblyEvaluate(new X(N),f),C["text-size"].possiblyEvaluate(new X(Z),f)]}if(i.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:Z}=i.iconSizeData;M.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new X(N),f),C["icon-size"].possiblyEvaluate(new X(Z),f)]}M.layoutTextSize=C["text-size"].possiblyEvaluate(new X(x+1),f),M.layoutIconSize=C["icon-size"].possiblyEvaluate(new X(x+1),f),M.textMaxSize=C["text-size"].possiblyEvaluate(new X(18),f);const B=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",L=T.get("text-size");for(const N of i.features){const Z=T.get("text-font").evaluate(N,{},f).join(","),K=L.evaluate(N,{},f),le=M.layoutTextSize.evaluate(N,{},f),ie=(M.layoutIconSize.evaluate(N,{},f),{horizontal:{},vertical:void 0}),se=N.text;let me,ue=[0,0];if(se){const De=se.toString(),et=T.get("text-letter-spacing").evaluate(N,{},f)*Rr,Me=T.get("text-line-height").evaluate(N,{},f)*Rr,Le=df(De)?et:0,je=T.get("text-anchor").evaluate(N,{},f),Re=T.get("text-variable-anchor");if(!Re){const Ct=T.get("text-radial-offset").evaluate(N,{},f);ue=Ct?Vy(je,[Ct*Rr,Qf]):T.get("text-offset").evaluate(N,{},f).map(nt=>nt*Rr)}let Je=B?"center":T.get("text-justify").evaluate(N,{},f);const Ne=T.get("symbol-placement"),ct=Ne==="point",Wt=Ne==="point"?T.get("text-max-width").evaluate(N,{},f)*Rr:0,Ht=Ct=>{i.allowVerticalPlacement&&Ol(De)&&(ie.vertical=qf(se,e,t,l,Z,Wt,Me,je,Ct,Le,ue,kn.vertical,!0,Ne,le,K))};if(!B&&Re){const Ct=Je==="auto"?Re.map(si=>Yf(si)):[Je];let nt=!1;for(let si=0;si<Ct.length;si++){const Nt=Ct[si];if(!ie.horizontal[Nt])if(nt)ie.horizontal[Nt]=ie.horizontal[0];else{const mt=qf(se,e,t,l,Z,Wt,Me,"center",Nt,Le,ue,kn.horizontal,!1,Ne,le,K);mt&&(ie.horizontal[Nt]=mt,nt=mt.positionedLines.length===1)}}Ht("left")}else{if(Je==="auto"&&(Je=Yf(je)),ct||T.get("text-writing-mode").indexOf("horizontal")>=0||!Ol(De)){const Ct=qf(se,e,t,l,Z,Wt,Me,je,Je,Le,ue,kn.horizontal,!1,Ne,le,K);Ct&&(ie.horizontal[Je]=Ct)}Ht(Ne==="point"?"left":Je)}}let Ce=!1;if(N.icon&&N.icon.name){const De=n[N.icon.name];De&&(me=jb(l[N.icon.name],T.get("icon-offset").evaluate(N,{},f),T.get("icon-anchor").evaluate(N,{},f)),Ce=De.sdf,i.sdfIcons===void 0?i.sdfIcons=De.sdf:i.sdfIcons!==De.sdf&&Ai("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Se=Ny(ie.horizontal)||ie.vertical;i.iconsInText||(i.iconsInText=!!Se&&Se.iconsInText),(Se||me)&&Yb(i,N,ie,me,n,M,le,0,ue,Ce,p,f,v)}u&&i.generateCollisionDebugBuffers(x,i.collisionBoxArray)}function Yf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Yb(i,e,t,n,l,u,p,f,x,v,T,C,M){let B=u.textMaxSize.evaluate(e,{},C);B===void 0&&(B=p);const L=i.layers[0].layout,N=L.get("icon-offset").evaluate(e,{},C),Z=Ny(t.horizontal)||t.vertical,K=M.name==="globe",le=p/24,ie=i.tilePixelRatio*B/24,se=(Le=i.overscaling,i.zoom>18&&Le>2&&(Le>>=1),Math.max(Vt/(512*Le),1)*L.get("symbol-spacing")),me=L.get("text-padding")*i.tilePixelRatio,ue=L.get("icon-padding")*i.tilePixelRatio,Ce=ve(L.get("text-max-angle")),Se=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",De=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",et=L.get("symbol-placement"),Me=se/2;var Le;const je=L.get("icon-text-fit");let Re;n&&je!=="none"&&(i.allowVerticalPlacement&&t.vertical&&(Re=My(n,t.vertical,je,L.get("icon-text-fit-padding"),N,le)),Z&&(n=My(n,Z,je,L.get("icon-text-fit-padding"),N,le)));const Je=(Ne,ct,Wt)=>{if(ct.x<0||ct.x>=Vt||ct.y<0||ct.y>=Vt)return;let Ht=null;if(K){const{x:Ct,y:nt,z:si}=M.projectTilePoint(ct.x,ct.y,Wt);Ht={anchor:new ts(Ct,nt,si,0,void 0),up:M.upVector(Wt,ct.x,ct.y)}}(function(Ct,nt,si,Nt,mt,Vi,Di,Hi,Qt,gi,ji,Bi,ki,qi,Ji,Ir,an,ci,sr,$r,wi,Ki,Yr,Qi,ur){const Cr=Ct.addToLineVertexArray(nt,Nt);let vr,Or,Jr,Mr,rs,ic,Yu,Ju=0,Tx=0,Sx=0,Ix=0,fm=-1,mm=-1;const Po={};let Cx=wu("");const $a=si?si.anchor:nt;let _m=0,gm=0;if(Qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[_m,gm]=Qt.layout.get("text-offset").evaluate(wi,{},ur).map(gn=>gn*Rr):(_m=Qt.layout.get("text-radial-offset").evaluate(wi,{},ur)*Rr,gm=Qf),Ct.allowVerticalPlacement&&mt.vertical){const gn=mt.vertical;if(Ji)ic=Jf(gn),Hi&&(Yu=Jf(Hi));else{const yn=Qt.layout.get("text-rotate").evaluate(wi,{},ur)+90;Jr=$d(gi,$a,nt,ji,Bi,ki,gn,qi,yn,Ir),Hi&&(Mr=$d(gi,$a,nt,ji,Bi,ki,Hi,ci,yn))}}if(Vi){const gn=Qt.layout.get("icon-rotate").evaluate(wi,{},ur),yn=Qt.layout.get("icon-text-fit")!=="none",Ku=Fy(Vi,gn,Yr,yn),xm=Hi?Fy(Hi,gn,Yr,yn):void 0;Or=$d(gi,$a,nt,ji,Bi,ki,Vi,ci,gn),Ju=4*Ku.length;const Mx=Ct.iconSizeData;let Ga=null;Mx.kind==="source"?(Ga=[Io*Qt.layout.get("icon-size").evaluate(wi,{},ur)],Ga[0]>Ps&&Ai(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Mx.kind==="composite"&&(Ga=[Io*Ki.compositeIconSizes[0].evaluate(wi,{},ur),Io*Ki.compositeIconSizes[1].evaluate(wi,{},ur)],(Ga[0]>Ps||Ga[1]>Ps)&&Ai(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,Ku,Ga,$r,sr,wi,!1,si,nt,Cr.lineStartIndex,Cr.lineLength,-1,Qi,ur),fm=Ct.icon.placedSymbolArray.length-1,xm&&(Tx=4*xm.length,Ct.addSymbols(Ct.icon,xm,Ga,$r,sr,wi,kn.vertical,si,nt,Cr.lineStartIndex,Cr.lineLength,-1,Qi,ur),mm=Ct.icon.placedSymbolArray.length-1)}for(const gn in mt.horizontal){const yn=mt.horizontal[gn];vr||(Cx=wu(yn.text),Ji?rs=Jf(yn):vr=$d(gi,$a,nt,ji,Bi,ki,yn,qi,Qt.layout.get("text-rotate").evaluate(wi,{},ur),Ir));const Ku=yn.positionedLines.length===1;if(Sx+=jy(Ct,si,nt,yn,Di,Qt,Ji,wi,Ir,Cr,mt.vertical?kn.horizontal:kn.horizontalOnly,Ku?Object.keys(mt.horizontal):[gn],Po,fm,Ki,Qi,ur),Ku)break}mt.vertical&&(Ix+=jy(Ct,si,nt,mt.vertical,Di,Qt,Ji,wi,Ir,Cr,kn.vertical,["vertical"],Po,mm,Ki,Qi,ur));let Fs=-1;const ym=(gn,yn)=>gn?Math.max(gn,yn):yn;Fs=ym(rs,Fs),Fs=ym(ic,Fs),Fs=ym(Yu,Fs);const Mw=Fs>-1?1:0;Ct.glyphOffsetArray.length>=Bs.MAX_GLYPHS&&Ai("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wi.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,wi.sortKey),Ct.symbolInstances.emplaceBack($a.x,$a.y,$a.z,nt.x,nt.y,Po.right>=0?Po.right:-1,Po.center>=0?Po.center:-1,Po.left>=0?Po.left:-1,Po.vertical>=0?Po.vertical:-1,fm,mm,Cx,vr!==void 0?vr:Ct.collisionBoxArray.length,vr!==void 0?vr+1:Ct.collisionBoxArray.length,Jr!==void 0?Jr:Ct.collisionBoxArray.length,Jr!==void 0?Jr+1:Ct.collisionBoxArray.length,Or!==void 0?Or:Ct.collisionBoxArray.length,Or!==void 0?Or+1:Ct.collisionBoxArray.length,Mr||Ct.collisionBoxArray.length,Mr?Mr+1:Ct.collisionBoxArray.length,ji,Sx,Ix,Ju,Tx,Mw,0,_m,gm,Fs)})(i,ct,Ht,Ne,t,n,l,Re,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,me,Se,x,0,ue,De,N,e,u,v,T,C)};if(et==="line")for(const Ne of Ly(e.geometry,0,0,Vt,Vt)){const ct=$b(Ne,se,Ce,t.vertical||Z,n,24,ie,i.overscaling,Vt);for(const Wt of ct){const Ht=Z;Ht&&Jb(i,Ht.text,Me,Wt)||Je(Ne,Wt,C)}}else if(et==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const ct=Nb(Ne,Ce,t.vertical||Z,n,24,ie);ct&&Je(Ne,ct,C)}}else if(e.type==="Polygon")for(const Ne of Uf(e.geometry,0)){const ct=Wb(Ne,16);Je(Ne[0],new ts(ct.x,ct.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Ne of e.geometry)Je(Ne,new ts(Ne[0].x,Ne[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Ne of e.geometry)for(const ct of Ne)Je([ct],new ts(ct.x,ct.y,0,0,void 0),C)}const Ps=32640;function jy(i,e,t,n,l,u,p,f,x,v,T,C,M,B,L,N,Z){const K=function(se,me,ue,Ce,Se,De,et,Me){const Le=[];if(me.positionedLines.length===0)return Le;const je=Ce.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Re=function(Ht){const Ct=Ht[0],nt=Ht[1],si=Ct*nt;return si>0?[Ct,-nt]:si<0?[-Ct,nt]:Ct===0?[nt,Ct]:[nt,-Ct]}(ue);let Je=Math.abs(me.top-me.bottom);for(const Ht of me.positionedLines)Je-=Ht.lineOffset;const Ne=me.positionedLines.length,ct=Je/Ne;let Wt=me.top-ue[1];for(let Ht=0;Ht<Ne;++Ht){const Ct=me.positionedLines[Ht];Wt=Gb(me,ct,Wt,Ht);for(const nt of Ct.positionedGlyphs){if(!nt.rect)continue;const si=nt.rect||{};let Nt=4,mt=!0,Vi=1,Di=0;if(nt.imageName){const Qi=et[nt.imageName];if(!Qi)continue;if(Qi.sdf){Ai("SDF images are not supported in formatted text and will be ignored.");continue}mt=!1,Vi=Qi.pixelRatio,Nt=1/Vi}const Hi=(Se||Me)&&nt.vertical,Qt=nt.metrics.advance*nt.scale/2,gi=nt.metrics,ji=nt.rect;if(ji===null)continue;Me&&me.verticalizable&&(Di=nt.imageName?Qt-nt.metrics.width*nt.scale/2:0);const Bi=Se?[nt.x+Qt,nt.y]:[0,0];let ki=[0,0],qi=[0,0],Ji=!1;Se||(Hi?(qi=[nt.x+Qt+Re[0],nt.y+Re[1]-Di],Ji=!0):ki=[nt.x+Qt+ue[0],nt.y+ue[1]-Di]);const Ir=ji.w*nt.scale/(Vi*(nt.localGlyph?2:1)),an=ji.h*nt.scale/(Vi*(nt.localGlyph?2:1));let ci,sr,$r,wi;if(Hi){const Qi=nt.y-Wt,ur=new R(-Qt,Qt-Qi),Cr=-Math.PI/2,vr=new R(...qi);ci=new R(-Qt+ki[0],ki[1]),ci._rotateAround(Cr,ur)._add(vr),ci.x+=-Qi+Qt,ci.y-=(gi.left-Nt)*nt.scale;const Or=nt.imageName?gi.advance*nt.scale:Rr*nt.scale,Jr=String.fromCharCode(nt.glyph);Tb(Jr)?ci.x+=(1-Nt)*nt.scale:Sb(Jr)?ci.x+=Or-gi.height*nt.scale+(-Nt-1)*nt.scale:ci.x+=nt.imageName||gi.width+2*Nt===ji.w&&gi.height+2*Nt===ji.h?(Or-an)/2:(Or-(gi.height+2*Nt)*nt.scale)/2,sr=new R(ci.x,ci.y-Ir),$r=new R(ci.x+an,ci.y),wi=new R(ci.x+an,ci.y-Ir)}else{const Qi=(gi.left-Nt)*nt.scale-Qt+ki[0],ur=(-gi.top-Nt)*nt.scale+ki[1],Cr=Qi+Ir,vr=ur+an;ci=new R(Qi,ur),sr=new R(Cr,ur),$r=new R(Qi,vr),wi=new R(Cr,vr)}if(je){let Qi;Qi=Se?new R(0,0):Ji?new R(Re[0],Re[1]):new R(ue[0],ue[1]),ci._rotateAround(je,Qi),sr._rotateAround(je,Qi),$r._rotateAround(je,Qi),wi._rotateAround(je,Qi)}const Ki=new R(0,0),Yr=new R(0,0);Le.push({tl:ci,tr:sr,bl:$r,br:wi,tex:si,writingMode:me.writingMode,glyphOffset:Bi,sectionIndex:nt.sectionIndex,isSDF:mt,pixelOffsetTL:Ki,pixelOffsetBR:Yr,minFontScaleX:0,minFontScaleY:0})}}return Le}(0,n,x,u,p,f,l,i.allowVerticalPlacement),le=i.textSizeData;let ie=null;le.kind==="source"?(ie=[Io*u.layout.get("text-size").evaluate(f,{},Z)],ie[0]>Ps&&Ai(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(ie=[Io*L.compositeTextSizes[0].evaluate(f,{},Z),Io*L.compositeTextSizes[1].evaluate(f,{},Z)],(ie[0]>Ps||ie[1]>Ps)&&Ai(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,K,ie,x,p,f,T,e,t,v.lineStartIndex,v.lineLength,B,N,Z);for(const se of C)M[se]=i.text.placedSymbolArray.length-1;return 4*K.length}function Ny(i){for(const e in i)return i[e];return null}function $d(i,e,t,n,l,u,p,f,x,v){let T=p.top,C=p.bottom,M=p.left,B=p.right;const L=p.collisionPadding;if(L&&(M-=L[0],T-=L[1],B+=L[2],C+=L[3]),x){const N=new R(M,T),Z=new R(B,T),K=new R(M,C),le=new R(B,C),ie=ve(x);let se=new R(0,0);v&&(se=new R(v[0],v[1])),N._rotateAround(ie,se),Z._rotateAround(ie,se),K._rotateAround(ie,se),le._rotateAround(ie,se),M=Math.min(N.x,Z.x,K.x,le.x),B=Math.max(N.x,Z.x,K.x,le.x),T=Math.min(N.y,Z.y,K.y,le.y),C=Math.max(N.y,Z.y,K.y,le.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,M,T,B,C,f,n,l,u),i.length-1}function Jf(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function Jb(i,e,t,n){const l=i.compareText;if(e in l){const u=l[e];for(let p=u.length-1;p>=0;p--)if(n.dist(u[p])<t)return!0}else l[e]=[];return l[e].push(n),!1}const Kb=Oe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$y}=Kb,Gy=Oe([{name:"a_pos_3",components:3,type:"Int16"}]);var ju=Oe([{name:"a_pos",type:"Int16",components:2}]);const is=Vt/Math.PI/2,Kf=2*jn(1,0)*is*Math.PI,Jl=[64,32,16],no=-is,oo=is,ew=[new sn([no,no,no],[oo,oo,oo]),new sn([no,no,no],[0,0,oo]),new sn([0,no,no],[oo,0,oo]),new sn([no,0,no],[0,oo,oo]),new sn([0,0,no],[oo,oo,oo])];function Zy(i,e,t,n=!0){const l=io([],i._camera.position,i.worldSize),u=[e,t,1,1];Fa(u,u,i.pixelMatrixInverse),Og(u,u,1/u[3]);const p=Hr([],ro([],u,l)),f=i.globeMatrix,x=[f[12],f[13],f[14]],v=ro([],x,l),T=Su(v),C=Hr([],v),M=i.worldSize/(2*Math.PI),B=$n(C,p),L=Math.asin(M/T);if(L<Math.acos(B)){if(!n)return null;const et=[],Me=[];io(et,p,T/B),Hr(Me,ro(Me,et,v)),Hr(p,ks(p,v,io(p,Me,Math.tan(L)*T)))}const N=[];new kf(l,p).closestPointOnSphere(x,M,N);const Z=Hr([],yi(f,0)),K=Hr([],yi(f,1)),le=Hr([],yi(f,2)),ie=$n(Z,N),se=$n(K,N),me=$n(le,N),ue=Ie(Math.asin(-se/M));let Ce=Ie(Math.atan2(ie,me));Ce=i.center.lng+function(et,Me){const Le=(Me-et+180)%360-180;return Le<-180?Le+360:Le}(i.center.lng,Ce);const Se=Eo(Ce),De=He(Yo(ue),0,1);return new Vl(Se,De)}class tw{constructor(e,t,n){this.a=ro([],e,n),this.b=ro([],t,n),this.center=n;const l=Hr([],this.a),u=Hr([],this.b);this.angle=Math.acos($n(l,u))}}function em(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(n,l,u,p){const f=Math.sin(u);return n*(Math.sin((1-p)*u)/f)+l*(Math.sin(p*u)/f)}(i.a[e],i.b[e],i.angle,He(t,0,1))+i.center[e]}function Co(i){if(i.z<=1)return ew[i.z+2*i.y+i.x];const e=tm(Gd(i));return sn.fromPoints(e)}function qy(i,e){const t=Gu(e.zoom);if(t===0)return Co(i);const n=Gd(i),l=tm(n),u=Eo(n.getWest())*e.worldSize,p=Eo(n.getEast())*e.worldSize,f=Yo(n.getNorth())*e.worldSize,x=Yo(n.getSouth())*e.worldSize,v=[u,f,0],T=[p,f,0],C=[u,x,0],M=[p,x,0],B=Ef([],e.globeMatrix);return yr(v,v,B),yr(T,T,B),yr(C,C,B),yr(M,M,B),l[0]=ms(l[0],C,t),l[1]=ms(l[1],M,t),l[2]=ms(l[2],T,t),l[3]=ms(l[3],v,t),sn.fromPoints(l)}function Wy(i,e,t,n,l){for(const u of t)yr(u,u,n),io(u,u,l),Cf(i,i,u),Mf(e,e,u)}function iw(i,e,t){const n=e/i.worldSize,l=Number.MAX_VALUE,u=[-l,-l,-l],p=[l,l,l],f=i.globeMatrix;if(t.z<=1)return Wy(p,u,Co(t).getCorners(),f,n),new sn(p,u);const x=Gd(t),v=tm(x);if(Wy(p,u,v,f,n),x.contains(i.center)){u[2]=0;const Ce=i.point,Se=[Ce.x*n,Ce.y*n,0];return Cf(p,p,Se),Mf(u,u,Se),new sn(p,u)}const T=[f[12]*n,f[13]*n,f[14]*n],C=x.getCenter(),M=He(i.center.lat,-85.051129,To),B=He(C.lat,-85.051129,To),L=Eo(i.center.lng),N=Yo(M);let Z=L-Eo(C.lng);const K=N-Yo(B);Z>.5?Z-=1:Z<-.5&&(Z+=1);let le=0;Math.abs(Z)>Math.abs(K)?le=Z>=0?1:3:(le=K>=0?0:2,Sd(T,T,[f[4]*n,f[5]*n,f[6]*n],-Math.sin(ve(K>=0?x.getSouth():x.getNorth()))*is));const ie=v[le],se=v[(le+1)%4],me=new tw(ie,se,T),ue=[em(me,0)||ie[0],em(me,1)||ie[1],em(me,2)||ie[2]];return p[2]=Math.min(ie[2],se[2]),Cf(p,p,ue),Mf(u,u,ue),new sn(p,u)}function Gd({x:i,y:e,z:t}){const n=1/(1<<t),l=new Si(Nn(i*n),Lr((e+1)*n)),u=new Si(Nn((i+1)*n),Lr(e*n));return new zs(l,u)}function tm(i){const e=ve(i.getNorth()),t=ve(i.getSouth()),n=Math.cos(e),l=Math.cos(t),u=Math.sin(e),p=Math.sin(t),f=i.getWest(),x=i.getEast();return[Kl(l,p,f),Kl(l,p,x),Kl(n,u,x),Kl(n,u,f)]}function Kl(i,e,t,n=is){return t=ve(t),[i*Math.sin(t)*n,-e*n,i*Math.cos(t)*n]}function Zd(i,e,t){return Kl(Math.cos(ve(i)),Math.sin(ve(i)),e,t)}function Nu(i,e,t,n){const l=1<<t.z,u=(i/Vt+t.x)/l;return Zd(Lr((e/Vt+t.y)/l),Nn(u),n)}function qd({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const Xy=new Float64Array(16);function $u(i){const e=qd(i),t=Pg(Xy,[e,e,e]);return Tu(t,t,((n=[])[0]=-(l=i.min)[0],n[1]=-l[1],n[2]=-l[2],n));var n,l}function im(i){const e=(n=i.min,(t=Xy)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t);var t,n;const l=1/qd(i);return Oa(e,e,[l,l,l])}function Hy(i,e,t,n,l){const u=function(x){const v=Vt/(2*Math.PI);return x/(2*Math.PI)/v}(t),p=[i,e,-t/(2*Math.PI)],f=So(new Float64Array(16));return Tu(f,f,p),Oa(f,f,[u,u,u]),Tf(f,f,ve(-l)),Td(f,f,ve(-n)),f}function Gu(i){return yt(5,6,i)}function Qy(i,e){const t=Zd(e.lat,e.lng);return u=(n=If([],function(B){const L=Zd(B._center.lat,B._center.lng);let N=zf([],$l(0,1,0),L);const Z=Dg([],-B.angle,L);N=yr(N,N,Z),Dg(Z,-B._pitch,N);const K=Hr([],L);return io(K,K,B.cameraToCenterDistance/B.pixelsPerMeter*Kf),yr(K,K,Z),ks([],L,K)}(i),t))[0],p=n[1],f=n[2],x=(l=t)[0],v=l[1],T=l[2],M=(C=Math.sqrt(u*u+p*p+f*f)*Math.sqrt(x*x+v*v+T*T))&&$n(n,l)/C,Math.acos(Math.min(Math.max(M,-1),1));var n,l,u,p,f,x,v,T,C,M}const Yy=ve(85),rw=Math.cos(Yy),nw=Math.sin(Yy);function Jy(i,e){const t=i.fovAboveCenter,n=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,l=(i._camera.position[2]*i.worldSize-n)/Math.cos(i._pitch),u=Math.sin(t)*l/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),p=Math.sin(i._pitch)*u+l;return Math.min(1.01*p,l*(1/i._horizonShift))}function ja(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),n=i.x*t,l=(i.x+1)*t,u=i.y*t,p=(i.y+1)*t,f=Nn(n),x=Nn(l),v=Lr(u),T=Lr(p),C=e.project(f,v),M=e.project(x,v),B=e.project(x,T),L=e.project(f,T);let N=Math.min(C.x,M.x,B.x,L.x),Z=Math.min(C.y,M.y,B.y,L.y),K=Math.max(C.x,M.x,B.x,L.x),le=Math.max(C.y,M.y,B.y,L.y);const ie=t/16;function se(ue,Ce,Se,De,et,Me){const Le=(Se+et)/2,je=(De+Me)/2,Re=e.project(Nn(Le),Lr(je)),Je=Math.max(0,N-Re.x,Z-Re.y,Re.x-K,Re.y-le);N=Math.min(N,Re.x),K=Math.max(K,Re.x),Z=Math.min(Z,Re.y),le=Math.max(le,Re.y),Je>ie&&(se(ue,Re,Se,De,Le,je),se(Re,Ce,Le,je,et,Me))}se(C,M,n,u,l,u),se(M,B,l,u,l,p),se(B,L,l,p,n,p),se(L,C,n,p,n,u),N-=ie,Z-=ie,K+=ie,le+=ie;const me=1/Math.max(K-N,le-Z);return{scale:me,x:N*me,y:Z*me,x2:K*me,y2:le*me,projection:e}}const ow=So(new Float32Array(16));class Ds{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Si(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n=!0){return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return jn(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return Jy(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,l){const u=e.horizonLineFromTop(!1),p=new R(t,Math.max(u,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,t,n){const l=new R(t,n);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return ow}createTileMatrix(e,t,n){let l,u,p;const f=n.canonical,x=So(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=ja(f,this);l=1,u=v.x+n.wrap*v.scale,p=v.y,Oa(x,x,[l/v.scale,l/v.scale,e.pixelsPerMeter/t])}else l=t/e.zoomScale(f.z),u=(f.x+Math.pow(2,f.z)*n.wrap)*l,p=f.y*l;return Tu(x,x,[u,p,0]),Oa(x,x,[l/Vt,l/Vt,1]),x}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class sw extends Ds{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(ve(t));this.n=(l+Math.sin(ve(n)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n,c:l,r0:u}=this,p=ve(e-this.center[0]),f=ve(t),x=Math.sqrt(l-2*n*Math.sin(f))/n;return{x:x*Math.sin(p*n),y:x*Math.cos(p*n)-u,z:0}}unproject(e,t){const{n,c:l,r0:u}=this,p=u+t;let f=Math.atan2(e,Math.abs(p))*Math.sign(p);p*n<0&&(f-=Math.PI*Math.sign(e)*Math.sign(p));const x=ve(this.center[0])*n;f=We(f,-Math.PI-x,Math.PI-x);const v=Ie(f/n)+this.center[0],T=Math.asin(He((l-(e*e+p*p)*n*n)/(2*n),-1,1)),C=He(Ie(T),-85.051129,To);return new Si(v,C)}}const Zu=1.340264,qu=-.081106,Wu=893e-6,Xu=.003796,Wd=Math.sqrt(3)/2;class aw extends Ds{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Wd*Math.sin(t)),l=n*n,u=l*l*l;return{x:.5*(e*Math.cos(n)/(Wd*(Zu+3*qu*l+u*(7*Wu+9*Xu*l)))/Math.PI+.5),y:1-.5*(n*(Zu+qu*l+u*(Wu+Xu*l))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,l=n*n,u=l*l*l;for(let T,C,M,B=0;B<12&&(C=n*(Zu+qu*l+u*(Wu+Xu*l))-t,M=Zu+3*qu*l+u*(7*Wu+9*Xu*l),T=C/M,n=He(n-T,-Math.PI/3,Math.PI/3),l=n*n,u=l*l*l,!(Math.abs(T)<1e-12));++B);const p=Wd*e*(Zu+3*qu*l+u*(7*Wu+9*Xu*l))/Math.cos(n),f=Math.asin(Math.sin(n)/Wd),x=He(180*p/Math.PI,-180,180),v=He(180*f/Math.PI,-85.051129,To);return new Si(x,v)}}class lw extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),l=He(360*(.5-t),-85.051129,To);return new Si(n,l)}}const ec=Math.PI/2;function Xd(i){return Math.tan((ec+i)/2)}class cw extends Ds{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30],l=ve(t),u=ve(n),p=Math.cos(l);this.n=l===u?Math.sin(l):Math.log(p/Math.cos(u))/Math.log(Xd(u)/Xd(l)),this.f=p*Math.pow(Xd(l),this.n)/this.n}project(e,t){t=ve(t),e=ve(e-this.center[0]);const n=1e-6,{n:l,f:u}=this;u>0?t<-ec+n&&(t=-ec+n):t>ec-n&&(t=ec-n);const p=u/Math.pow(Xd(t),l),f=p*Math.sin(l*e),x=u-p*Math.cos(l*e);return{x:.5*(f/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n,f:l}=this,u=l-t,p=Math.sign(u),f=Math.sign(n)*Math.sqrt(e*e+u*u);let x=Math.atan2(e,Math.abs(u))*p;u*n<0&&(x-=Math.PI*Math.sign(e)*p);const v=He(Ie(x/n)+this.center[0],-180,180),T=He(Ie(2*Math.atan(Math.pow(l/f,1/n))-ec),-85.051129,To);return new Si(v,T)}}class Ky extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Eo(e),y:Yo(t),z:0}}unproject(e,t){const n=Nn(e),l=Lr(t);return new Si(n,l)}}const ex=ve(To);class uw extends Ds{project(e,t){const n=(t=ve(t))*t,l=n*n;return{x:.5*((e=ve(e))*(.8707-.131979*n+l*(l*(.003971*n-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+l*(.028874*n-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,l=25,u=0,p=n*n;do{p=n*n;const v=p*p;u=(n*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-t)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),n=He(n-u,-ex,ex)}while(Math.abs(u)>1e-6&&--l>0);p=n*n;const f=He(Ie(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=Ie(n);return new Si(f,x)}}const tx=ve(To);class hw extends Ds{project(e,t){t=ve(t),e=ve(e);const n=Math.cos(t),l=2/Math.PI,u=Math.acos(n*Math.cos(e/2)),p=Math.sin(u)/u,f=.5*(e*l+2*n*Math.sin(e/2)/p)||0,x=.5*(t+Math.sin(t)/p)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,l=t=(2*(1-t)-1)*Math.PI,u=25;const p=1e-6;let f=0,x=0;do{const v=Math.cos(l),T=Math.sin(l),C=2*T*v,M=T*T,B=v*v,L=Math.cos(n/2),N=Math.sin(n/2),Z=2*L*N,K=N*N,le=1-B*L*L,ie=le?1/le:0,se=le?Math.acos(v*L)*Math.sqrt(1/le):0,me=.5*(2*se*v*N+2*n/Math.PI)-e,ue=.5*(se*T+l)-t,Ce=.5*ie*(B*K+se*v*L*M)+1/Math.PI,Se=ie*(Z*C/4-se*T*N),De=.125*ie*(C*N-se*T*B*Z),et=.5*ie*(M*L+se*K*v)+.5,Me=Se*De-et*Ce;f=(ue*Se-me*et)/Me,x=(me*De-ue*Ce)/Me,n=He(n-f,-Math.PI,Math.PI),l=He(l-x,-tx,tx)}while((Math.abs(f)>p||Math.abs(x)>p)&&--u>0);return new Si(Ie(n),Ie(l))}}class ix extends Ds{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:l}=this;return{x:ve(e)*l*n+.5,y:-Math.sin(ve(t))/l*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:l}=this,u=-(t-.5)/n,p=He(Ie((e-.5)/n)/l,-180,180),f=Math.asin(He(u*l,-1,1)),x=He(Ie(f),-85.051129,To);return new Si(p,x)}}class dw extends Ky{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,n){const l=Nu(e,t,n);return yr(l,l,$u(Co(n))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,t){const n=Zd(t.lat,t.lng),l=Hr([],n),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Sd(n,n,l,jn(1,0)*Vt*u);const p=So(new Float64Array(16));return Nl(p,e.pixelMatrix,e.globeMatrix),yr(n,n,p),new R(n[0],n[1])}pixelsPerMeter(e,t){return jn(1,0)*t}pixelSpaceConversion(e,t,n){const l=mi(jn(1,45)*t,jn(1,e)*t,n);return this.pixelsPerMeter(e,t)/l}createTileMatrix(e,t,n){const l=im(Co(n.canonical));return Nl(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,t){const{center:n}=e,l=$u(Co(t));return Td(l,l,ve(n.lng)),Tf(l,l,ve(n.lat)),Oa(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,t,n,l){return Zy(e,t,n,!0)||new Vl(0,0)}pointCoordinate3D(e,t,n){const l=this.pointCoordinate(e,t,n,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,t){return!Zy(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(l,u){const p=l.cameraToCenterDistance,f=l._centerAltitude*u,x=l._camera,v=l._camera.forward(),T=ks([],io([],v,-p),[0,0,f]),C=l.worldSize/(2*Math.PI),M=[0,0,-C],B=l.width/l.height,L=Math.tan(l.fovAboveCenter),N=io([],x.up(),L),Z=io([],x.right(),L*B),K=Hr([],ks([],ks([],v,N),Z)),le=[];let ie;if(new kf(T,K).closestPointOnSphere(M,C,le)){const se=ks([],le,M),me=ro([],se,T);ie=Math.cos(l.fovAboveCenter)*Su(me)}else{const se=ro([],T,M),me=ro([],M,T);Hr(me,me);const ue=Su(se)-C;ie=Math.sqrt(ue*(ue+2*C));const Ce=Math.acos(ie/(C+ue))-Math.acos($n(v,me));ie*=Math.cos(Ce)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Gu(e.zoom);if(n>0){const l=Jy(e,jn(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return mi(t,l+u*(1-Math.cos(p)),Math.pow(n,10))}return t}upVector(e,t,n){return Nu(t,n,e,1)}upVectorScale(e){return{metersToTile:Kf*qd(Co(e))}}}function rx(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Ky(i);case"equirectangular":return new lw(i);case"naturalEarth":return new uw(i);case"equalEarth":return new aw(i);case"winkelTripel":return new hw(i);case"albers":return t?new ix(i):new sw(i);case"lambertConformalConic":return t?new ix(i):new cw(i);case"globe":return new dw(i)}throw new Error(`Invalid projection name: ${i.name}`)}const pw=Va.VectorTileFeature.types,fw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hd(i,e,t,n,l,u,p,f,x,v,T,C,M){const B=f?Math.min(Ps,Math.round(f[0])):0,L=f?Math.min(Ps,Math.round(f[1])):0;i.emplaceBack(e,t,Math.round(32*n),Math.round(32*l),u,p,(B<<1)+(x?1:0),L,16*v,16*T,256*C,256*M)}function Qd(i,e,t,n,l,u,p){i.emplaceBack(e,t,n,l,u,p)}function Yd(i,e,t,n,l){i.emplaceBack(e,t,n,l),i.emplaceBack(e,t,n,l),i.emplaceBack(e,t,n,l),i.emplaceBack(e,t,n,l)}function mw(i){for(const e of i.sections)if(s(e.text))return!0;return!1}class rm{constructor(e){this.layoutVertexArray=new Gi,this.indexArray=new Kt,this.programConfigurations=e,this.segments=new mr,this.dynamicLayoutVertexArray=new oi,this.opacityVertexArray=new zi,this.placedSymbolArray=new rg,this.globeExtVertexArray=new nr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,n,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,xb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yb.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}_t(rm,"SymbolBuffers");class nm{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new mr,this.collisionVertexArray=new Zi,this.collisionVertexArrayExt=new Xi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vb.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ab.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_t(nm,"CollisionBuffers");class Bs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=So([]),this.placementViewportMatrix=So([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nf(this.zoom,t["text-size"]),this.iconSizeData=Nf(this.zoom,t["icon-size"]);const n=this.layers[0].layout,l=n.get("symbol-sort-key"),u=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(p=>kn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new rm(new Ba(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new rm(new Ba(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new sg,this.lineVertexArray=new ag,this.symbolInstances=new og}calculateGlyphDependencies(e,t,n,l,u){for(let p=0;p<e.length;p++)if(t[e.charCodeAt(p)]=!0,l&&u){const f=Ou[e.charAt(p)];f&&(t[f.charCodeAt(0)]=!0)}}populate(e,t,n,l){const u=this.layers[0],p=u.layout,f=this.projection.name==="globe",x=p.get("text-font"),v=p.get("text-field"),T=p.get("icon-image"),C=(v.value.kind!=="constant"||v.value.value instanceof Wr&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,B=p.get("symbol-sort-key");if(this.features=[],!C&&!M)return;const L=t.iconDependencies,N=t.glyphDependencies,Z=t.availableImages,K=new X(this.zoom);for(const{feature:le,id:ie,index:se,sourceLayerIndex:me}of e){const ue=u._featureFilter.needGeometry,Ce=La(le,ue);if(!u._featureFilter.filter(K,Ce,n))continue;if(ue||(Ce.geometry=Jo(le,n,l)),f&&le.type!==1&&n.z<=5){const Me=Ce.geometry,Le=.98078528056;for(let je=0;je<Me.length;je++)Me[je]=y1(Me[je],Re=>Re,(Re,Je)=>$n(Nu(Re.x,Re.y,n,1),Nu(Je.x,Je.y,n,1))<Le)}let Se,De;if(C){const Me=u.getValueAndResolveTokens("text-field",Ce,n,Z),Le=Wr.factory(Me);mw(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||G()==="unavailable"||this.hasRTLText&&W.isParsed())&&(Se=Eb(Le,u,Ce))}if(M){const Me=u.getValueAndResolveTokens("icon-image",Ce,n,Z);De=Me instanceof Xr?Me:Xr.fromString(Me)}if(!Se&&!De)continue;const et=this.sortFeaturesByKey?B.evaluate(Ce,{},n):void 0;if(this.features.push({id:ie,text:Se,icon:De,index:se,sourceLayerIndex:me,geometry:Ce.geometry,properties:le.properties,type:pw[le.type],sortKey:et}),De&&(L[De.name]=!0),Se){const Me=x.evaluate(Ce,{},n).join(","),Le=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kn.vertical)>=0;for(const je of Se.sections)if(je.image)L[je.image.name]=!0;else{const Re=Ol(Se.toString()),Je=je.fontStack||Me,Ne=N[Je]=N[Je]||{};this.calculateGlyphDependencies(je.text,Ne,Le,this.allowVerticalPlacement,Re)}}}p.get("symbol-placement")==="line"&&(this.features=function(le){const ie={},se={},me=[];let ue=0;function Ce(Me){me.push(le[Me]),ue++}function Se(Me,Le,je){const Re=se[Me];return delete se[Me],se[Le]=Re,me[Re].geometry[0].pop(),me[Re].geometry[0]=me[Re].geometry[0].concat(je[0]),Re}function De(Me,Le,je){const Re=ie[Le];return delete ie[Le],ie[Me]=Re,me[Re].geometry[0].shift(),me[Re].geometry[0]=je[0].concat(me[Re].geometry[0]),Re}function et(Me,Le,je){const Re=je?Le[0][Le[0].length-1]:Le[0][0];return`${Me}:${Re.x}:${Re.y}`}for(let Me=0;Me<le.length;Me++){const Le=le[Me],je=Le.geometry,Re=Le.text?Le.text.toString():null;if(!Re){Ce(Me);continue}const Je=et(Re,je),Ne=et(Re,je,!0);if(Je in se&&Ne in ie&&se[Je]!==ie[Ne]){const ct=De(Je,Ne,je),Wt=Se(Je,Ne,me[ct].geometry);delete ie[Je],delete se[Ne],se[et(Re,me[Wt].geometry,!0)]=Wt,me[ct].geometry=null}else Je in se?Se(Je,Ne,je):Ne in ie?De(Je,Ne,je):(Ce(Me),ie[Je]=ue-1,se[Ne]=ue-1)}return me.filter(Me=>Me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,ie)=>le.sortKey-ie.sortKey)}update(e,t,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n,l),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let u=e.dist(t[l+1]),p=e.dist(t[l]);const f={};for(let x=l+1;x<t.length;x++)f[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:u},x<t.length-1&&(u+=t[x+1].dist(t[x]));for(let x=l||0;x>=0;x--)f[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=t[x-1].dist(t[x]));for(let x=0;x<t.length;x++){const v=f[x];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,l,u,p,f,x,v,T,C,M,B,L){const N=e.indexArray,Z=e.layoutVertexArray,K=e.globeExtVertexArray,le=e.segments.prepareSegment(4*t.length,Z,N,this.canOverlap?p.sortKey:void 0),ie=this.glyphOffsetArray.length,se=le.vertexLength,me=this.allowVerticalPlacement&&f===kn.vertical?Math.PI/2:0,ue=p.text&&p.text.sections;for(let Se=0;Se<t.length;Se++){const{tl:De,tr:et,bl:Me,br:Le,tex:je,pixelOffsetTL:Re,pixelOffsetBR:Je,minFontScaleX:Ne,minFontScaleY:ct,glyphOffset:Wt,isSDF:Ht,sectionIndex:Ct}=t[Se],nt=le.vertexLength,si=Wt[1];if(Hd(Z,v.x,v.y,De.x,si+De.y,je.x,je.y,n,Ht,Re.x,Re.y,Ne,ct),Hd(Z,v.x,v.y,et.x,si+et.y,je.x+je.w,je.y,n,Ht,Je.x,Re.y,Ne,ct),Hd(Z,v.x,v.y,Me.x,si+Me.y,je.x,je.y+je.h,n,Ht,Re.x,Je.y,Ne,ct),Hd(Z,v.x,v.y,Le.x,si+Le.y,je.x+je.w,je.y+je.h,n,Ht,Je.x,Je.y,Ne,ct),x){const Nt=x.anchor,mt=x.up;Qd(K,Nt.x,Nt.y,Nt.z,mt[0],mt[1],mt[2]),Qd(K,Nt.x,Nt.y,Nt.z,mt[0],mt[1],mt[2]),Qd(K,Nt.x,Nt.y,Nt.z,mt[0],mt[1],mt[2]),Qd(K,Nt.x,Nt.y,Nt.z,mt[0],mt[1],mt[2]),Yd(e.dynamicLayoutVertexArray,Nt.x,Nt.y,Nt.z,me)}else Yd(e.dynamicLayoutVertexArray,v.x,v.y,v.z,me);N.emplaceBack(nt,nt+1,nt+2),N.emplaceBack(nt+1,nt+2,nt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wt[0]),Se!==t.length-1&&Ct===t[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,p,p.index,{},B,L,ue&&ue[Ct])}const Ce=x?x.anchor:v;e.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,v.x,v.y,ie,this.glyphOffsetArray.length-ie,se,T,C,v.segment,n?n[0]:0,n?n[1]:0,l[0],l[1],f,0,!1,0,M,0)}_commitLayoutVertex(e,t,n,l,u,p,f){e.emplaceBack(t,n,l,u,p,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,t,n,l,u,p,f){const x=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),v=x.vertexLength,T=f.tileAnchorX,C=f.tileAnchorY;for(let B=0;B<4;B++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,C,new R(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,C,new R(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,C,new R(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,C,new R(e.x1,e.y2)),x.vertexLength+=4;const M=n.indexArray;M.emplaceBack(v,v+1),M.emplaceBack(v+1,v+2),M.emplaceBack(v+2,v+3),M.emplaceBack(v+3,v),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),v=this.getSymbolInstanceTextSize(e,p,t,f);this._addCollisionDebugVertices(x,v,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,t,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),v=this.getSymbolInstanceIconSize(e,t,f);this._addCollisionDebugVertices(x,v,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nm(zn,_y.members,jr),this.iconCollisionBox=new nm(zn,_y.members,jr);const n=ql(this.iconSizeData,e),l=ql(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,t,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,t,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,t,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,t,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,t,n,l){const u=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:l),p=Od(this.textSizeData,e,u)/Rr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,t,n){const l=this.icon.placedSymbolArray.get(n),u=Od(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),v=this.getSymbolInstanceTextSize(e,p,t,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,x.padding)}}_updateIconDebugCollisionBoxes(e,t,n,l,u){for(let p=l;p<u;p++){const f=n.get(p),x=this.getSymbolInstanceIconSize(e,t,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,f.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=ql(this.iconSizeData,e),l=ql(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,t,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,t,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(n,e,t,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,t,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,l,u,p,f,x,v){const T={};for(let C=t;C<n;C++){const M=e.get(C);T.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.textFeatureIndex=M.featureIndex;break}for(let C=l;C<u;C++){const M=e.get(C);T.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalTextFeatureIndex=M.featureIndex;break}for(let C=p;C<f;C++){const M=e.get(C);T.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.iconFeatureIndex=M.featureIndex;break}for(let C=x;C<v;C++){const M=e.get(C);T.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalIconFeatureIndex=M.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),l=n.vertexStartIndex+4*n.numGlyphs;for(let u=n.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),l=[],u=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const x=this.symbolInstances.get(f);l.push(0|Math.round(t*x.tileAnchorX+n*x.tileAnchorY)),u.push(x.featureIndex)}return p.sort((f,x)=>l[f]-l[x]||u[x]-u[f]),p}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const n=this.symbolInstances.get(t);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((l,u,p)=>{l>=0&&p.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}_t(Bs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Bs.MAX_GLYPHS=65535,Bs.addDynamicAttributes=Yd;const _w=new Be({"symbol-placement":new he(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new he(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xe(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new he(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new xe(Pe.layout_symbol["icon-size"]),"icon-text-fit":new he(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new he(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new xe(Pe.layout_symbol["icon-image"]),"icon-rotate":new xe(Pe.layout_symbol["icon-rotate"]),"icon-padding":new he(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new he(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new xe(Pe.layout_symbol["icon-offset"]),"icon-anchor":new xe(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new xe(Pe.layout_symbol["text-field"]),"text-font":new xe(Pe.layout_symbol["text-font"]),"text-size":new xe(Pe.layout_symbol["text-size"]),"text-max-width":new xe(Pe.layout_symbol["text-max-width"]),"text-line-height":new xe(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new xe(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new xe(Pe.layout_symbol["text-justify"]),"text-radial-offset":new xe(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new xe(Pe.layout_symbol["text-anchor"]),"text-max-angle":new he(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new he(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new xe(Pe.layout_symbol["text-rotate"]),"text-padding":new he(Pe.layout_symbol["text-padding"]),"text-keep-upright":new he(Pe.layout_symbol["text-keep-upright"]),"text-transform":new xe(Pe.layout_symbol["text-transform"]),"text-offset":new xe(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new he(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new he(Pe.layout_symbol["text-optional"])});var om={paint:new Be({"icon-opacity":new xe(Pe.paint_symbol["icon-opacity"]),"icon-color":new xe(Pe.paint_symbol["icon-color"]),"icon-halo-color":new xe(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new xe(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xe(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new he(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new xe(Pe.paint_symbol["text-opacity"]),"text-color":new xe(Pe.paint_symbol["text-color"],{runtimeType:Sn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new xe(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new xe(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new xe(Pe.paint_symbol["text-halo-blur"]),"text-translate":new he(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new he(Pe.paint_symbol["text-translate-anchor"])}),layout:_w};class nx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:hs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t(nx,"FormatSectionOverride",{omit:["defaultValue"]});class Jd extends to{constructor(e){super(e,om)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const l=[];for(const u of n)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,l){const u=this.layout.get(e).evaluate(t,{},n,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Il(p.value)||!u?u:function(f,x){return x.replace(/{([^{}]+)}/g,(v,T)=>T in f?String(f[T]):"")}(t.properties,u)}createBucket(e){return new Bs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of om.paint.overridableProperties){if(!Jd.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new nx(t),l=new nu(n,t.property.specification);let u=null;u=t.value.kind==="constant"||t.value.kind==="source"?new ou("source",l):new Aa("composite",l,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new ae(t.property,u,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&Jd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),l=om.paint.properties[t];let u=!1;const p=f=>{for(const x of f)if(l.overrides&&l.overrides.hasOverride(x))return void(u=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Wr)p(n.value.value.sections);else if(n.value.kind==="source"){const f=v=>{u||(v instanceof ca&&cr(v.value)===oa?p(v.value.sections):v instanceof ha?p(v.sections):v.eachChild(f))},x=n.value;x._styleExpression&&f(x._styleExpression.expression)}return u}getProgramConfiguration(e){return new Ms(this,e)}}var gw={paint:new Be({"background-color":new he(Pe.paint_background["background-color"]),"background-pattern":new Ye(Pe.paint_background["background-pattern"]),"background-opacity":new he(Pe.paint_background["background-opacity"])})},yw={paint:new Be({"raster-opacity":new he(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new he(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new he(Pe.paint_raster["raster-saturation"]),"raster-contrast":new he(Pe.paint_raster["raster-contrast"]),"raster-resampling":new he(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new he(Pe.paint_raster["raster-fade-duration"])})};class xw extends to{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var vw={paint:new Be({"sky-type":new he(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new be(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(Pe.paint_sky["sky-opacity"])})};function sm(i,e,t){const n=[0,0,1],l=Ug([]);return jg(l,l,t?-ve(i)+Math.PI:ve(i)),Vg(l,l,-ve(e)),Rg(n,n,l),Hr(n,n)}const Aw={circle:class extends to{constructor(i){super(i,T1)}createBucket(i){return new Af(i)}queryRadius(i){const e=i;return jl("circle-radius",this,e)+jl("circle-stroke-width",this,e)+wd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,n,l,u,p,f){const x=zg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return Ng(i,n,u,p,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,v)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Ms(this,i)}},heatmap:class extends to{createBucket(i){return new Gg(i)}constructor(i){super(i,P1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return jl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,n,l,u,p,f){const x=this.paint.get("heatmap-radius").evaluate(e,t);return Ng(i,n,u,p,f,!0,!0,new R(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Ms(this,i)}},hillshade:class extends to{constructor(i){super(i,D1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends to{constructor(i){super(i,Q1)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new Ms(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Pd(i)}queryRadius(){return wd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,n,l,u){return!i.queryGeometry.isAboveHorizon&&Tg(Mg(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends to{constructor(i){super(i,cb)}createBucket(i){return new Bu(i)}queryRadius(){return wd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Ms(this,i)}queryIntersectsFeature(i,e,t,n,l,u,p,f,x){const v=zg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,t),C=this.paint.get("fill-extrusion-base").evaluate(e,t),M=[0,0],B=f&&u.elevation,L=u.elevation?u.elevation.exaggeration():1,N=i.tile.getBucket(this);if(B&&N instanceof Bu){const le=N.centroidVertexArray,ie=x+1;if(ie<le.length){const se=le.get(ie);M[0]=se.a_centroid_pos0,M[1]=se.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;u.projection.name==="globe"&&(n=ly([n],[new R(0,0),new R(Vt,Vt)],i.tileID.canonical).map(le=>le.polygon).flat());const Z=function(le,ie,se,me,ue,Ce,Se,De,et,Me,Le){return le.projection.name==="globe"?function(je,Re,Je,Ne,ct,Wt,Ht,Ct,nt,si,Nt){const mt=[],Vi=[],Di=je.projection.upVectorScale(Nt,je.center.lat,je.worldSize).metersToTile,Hi=[0,0,0,1],Qt=[0,0,0,1],gi=(Bi,ki,qi,Ji)=>{Bi[0]=ki,Bi[1]=qi,Bi[2]=Ji,Bi[3]=1},ji=ay();Je>0&&(Je+=ji),Ne+=ji;for(const Bi of Re){const ki=[],qi=[];for(const Ji of Bi){const Ir=Ji.x+ct.x,an=Ji.y+ct.y,ci=je.projection.projectTilePoint(Ir,an,Nt),sr=je.projection.upVector(Nt,Ji.x,Ji.y);let $r=Je,wi=Ne;if(Ht){const Ki=dy(Ir,an,Je,Ne,Ht,Ct,nt,si);$r+=Ki.base,wi+=Ki.top}Je!==0?gi(Hi,ci.x+sr[0]*Di*$r,ci.y+sr[1]*Di*$r,ci.z+sr[2]*Di*$r):gi(Hi,ci.x,ci.y,ci.z),gi(Qt,ci.x+sr[0]*Di*wi,ci.y+sr[1]*Di*wi,ci.z+sr[2]*Di*wi),yr(Hi,Hi,Wt),yr(Qt,Qt,Wt),ki.push(Ld(Hi)),qi.push(Ld(Qt))}mt.push(ki),Vi.push(qi)}return[mt,Vi]}(le,ie,se,me,ue,Ce,Se,De,et,Me,Le):Se?function(je,Re,Je,Ne,ct,Wt,Ht,Ct,nt){const si=[],Nt=[],mt=[0,0,0,1];for(const Vi of je){const Di=[],Hi=[];for(const Qt of Vi){const gi=Qt.x+Ne.x,ji=Qt.y+Ne.y,Bi=dy(gi,ji,Re,Je,Wt,Ht,Ct,nt);mt[0]=gi,mt[1]=ji,mt[2]=Bi.base,mt[3]=1,Fa(mt,mt,ct),mt[3]=Math.max(mt[3],1e-5);const ki=Ld([mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]]);mt[0]=gi,mt[1]=ji,mt[2]=Bi.top,mt[3]=1,Fa(mt,mt,ct),mt[3]=Math.max(mt[3],1e-5);const qi=Ld([mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]]);Di.push(ki),Hi.push(qi)}si.push(Di),Nt.push(Hi)}return[si,Nt]}(ie,se,me,ue,Ce,Se,De,et,Me):function(je,Re,Je,Ne,ct){const Wt=[],Ht=[],Ct=ct[8]*Re,nt=ct[9]*Re,si=ct[10]*Re,Nt=ct[11]*Re,mt=ct[8]*Je,Vi=ct[9]*Je,Di=ct[10]*Je,Hi=ct[11]*Je;for(const Qt of je){const gi=[],ji=[];for(const Bi of Qt){const ki=Bi.x+Ne.x,qi=Bi.y+Ne.y,Ji=ct[0]*ki+ct[4]*qi+ct[12],Ir=ct[1]*ki+ct[5]*qi+ct[13],an=ct[2]*ki+ct[6]*qi+ct[14],ci=ct[3]*ki+ct[7]*qi+ct[15],sr=Ji+Ct,$r=Ir+nt,wi=an+si,Ki=Math.max(ci+Nt,1e-5),Yr=Ji+mt,Qi=Ir+Vi,ur=an+Di,Cr=Math.max(ci+Hi,1e-5),vr=new R(sr/Ki,$r/Ki);vr.z=wi/Ki,gi.push(vr);const Or=new R(Yr/Cr,Qi/Cr);Or.z=ur/Cr,ji.push(Or)}Wt.push(gi),Ht.push(ji)}return[Wt,Ht]}(ie,se,me,ue,Ce)}(u,n,C,T,v,p,B?f:null,M,L,u.center.lat,i.tileID.canonical),K=i.queryGeometry;return function(le,ie,se){let me=1/0;Tg(se,ie)&&(me=hy(se,ie[0]));for(let ue=0;ue<ie.length;ue++){const Ce=ie[ue],Se=le[ue];for(let De=0;De<Ce.length-1;De++){const et=Ce[De],Me=[et,Ce[De+1],Se[De+1],Se[De],et];Eg(se,Me)&&(me=Math.min(me,hy(se,Me)))}}return me!==1/0&&me}(Z[0],Z[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends to{constructor(i){super(i,py),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=fy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Rd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Ms(this,i)}queryRadius(i){const e=i,t=my(jl("line-width",this,e),jl("line-gap-width",this,e)),n=jl("line-offset",this,e);return t/2+Math.abs(n)+wd(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,n,l,u){if(i.queryGeometry.isAboveHorizon)return!1;const p=Mg(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),f=i.pixelToTileUnitsFactor/2*my(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),x=this.paint.get("line-offset").evaluate(e,t);return x&&(n=function(v,T){const C=[],M=new R(0,0);for(let B=0;B<v.length;B++){const L=v[B],N=[];for(let Z=0;Z<L.length;Z++){const K=L[Z-1],le=L[Z],ie=L[Z+1],se=Z===0?M:le.sub(K)._unit()._perp(),me=Z===L.length-1?M:ie.sub(le)._unit()._perp(),ue=se._add(me)._unit();ue._mult(1/(ue.x*me.x+ue.y*me.y)),N.push(ue._mult(T)._add(le))}C.push(N)}return C}(n,x*i.pixelToTileUnitsFactor)),function(v,T,C){for(let M=0;M<T.length;M++){const B=T[M];if(v.length>=3){for(let L=0;L<B.length;L++)if(Ra(v,B[L]))return!0}if(A1(v,B,C))return!0}return!1}(p,n,f)}isTileClipped(){return!0}},symbol:Jd,background:class extends to{constructor(i){super(i,gw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends to{constructor(i){super(i,yw)}getProgramIds(){return["raster"]}},sky:class extends to{constructor(i){super(i,vw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),l=!n,u=i.style.light,p=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&Ai("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?sm(p.azimuthal,90-p.polar,e):sm(n[0],90-n[1],e)}const t=this.paint.get("sky-gradient-center");return sm(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class Hu{constructor(e,t,n,l){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,l)}update(e,t,n){const{width:l,height:u}=e,{context:p}=this,{gl:f}=p,{HTMLImageElement:x,HTMLCanvasElement:v,HTMLVideoElement:T,ImageData:C,ImageBitmap:M}=P;if(f.bindTexture(f.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!t||t.premultiply!==!1)),n||this.size&&this.size[0]===l&&this.size[1]===u){const{x:B,y:L}=n||{x:0,y:0};e instanceof x||e instanceof v||e instanceof T||e instanceof C||M&&e instanceof M?f.texSubImage2D(f.TEXTURE_2D,0,B,L,f.RGBA,f.UNSIGNED_BYTE,e):f.texSubImage2D(f.TEXTURE_2D,0,B,L,l,u,f.RGBA,f.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof x||e instanceof v||e instanceof T||e instanceof C||M&&e instanceof M?f.texImage2D(f.TEXTURE_2D,0,this.format,this.format,f.UNSIGNED_BYTE,e):f.texImage2D(f.TEXTURE_2D,0,this.format,l,u,0,this.format,f.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class am{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Ko({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=ri(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const l=[];let u=e.length%2==1?-e[e.length-1]*n:0,p=e[0]*n,f=!0;l.push({left:u,right:p,isDash:f,zeroLength:e[0]===0});let x=e[0];for(let v=1;v<e.length;v++){f=!f;const T=e[v];u=x*n,x+=T,p=x*n,l.push({left:u,right:p,isDash:f,zeroLength:T===0})}return l}addRoundDash(e,t,n){const l=t/2;for(let u=-n;u<=n;u++){const p=this.width*(this.nextRow+n+u);let f=0,x=e[f];for(let v=0;v<this.width;v++){v/x.right>1&&(x=e[++f]);const T=Math.abs(v-x.left),C=Math.abs(v-x.right),M=Math.min(T,C);let B;const L=u/n*(l+1);if(x.isDash){const N=l-Math.abs(L);B=Math.sqrt(M*M+N*N)}else B=l-Math.sqrt(M*M+L*L);this.image.data[p+v]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,t){for(let x=e.length-1;x>=0;--x){const v=e[x],T=e[x+1];v.zeroLength?e.splice(x,1):T&&T.isDash===v.isDash&&(T.left=v.left,e.splice(x,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let p=0,f=e[p];for(let x=0;x<this.width;x++){x/f.right>1&&(f=e[++p]);const v=Math.abs(x-f.left),T=Math.abs(x-f.right),C=Math.min(v,T);this.image.data[u+x]=Math.max(0,Math.min(255,(f.isDash?C:-C)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const l=t==="round",u=l?7:0,p=2*u+1;if(this.nextRow+p>this.height)return Ai("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let T=0;T<e.length;T++)e[T]<0&&(Ai("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),f+=e[T];if(f!==0){const T=this.width/f,C=this.getDashRanges(e,this.width,T);l?this.addRoundDash(C,T,u):this.addRegularDash(C,t==="square"?.5*T:0)}const x=this.nextRow+u;this.nextRow+=p;const v={tl:[x,u],br:[f,0]};return this.positions[n]=v,v}}_t(am,"LineAtlas");class bw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ww{constructor(){this.tasks={},this.taskQueue=[],vi(["process"],this),this.invoker=new bw(this.process),this.nextId=0}add(e,t){const n=this.nextId++,l=function({type:u,isSymbolTile:p,zoom:f}){return f=f||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-f:u==="maybePrepare"&&p?400-f:500:200-f:100-f}(t);if(l===0){$e();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:l,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){$e();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<t&&(t=u.priority,e=l)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class ox{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Ew=["tile","layer","source","sourceLayer","state"];class sx{constructor(e,t,n,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of Ew)this[t]!==void 0&&(e[t]=this[t]);return e}}const Gn=32,Mo=33,Ls=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,n=0,l=0,u=0,p=0,f=0;for(1&e?l=u=p=Gn:t=n=f=Gn;(e>>=1)>1;){const v=t+l>>1,T=n+u>>1;1&e?(l=t,u=n,t=p,n=f):(t=l,n=u,l=p,u=f),p=v,f=T}const x=4*i;Ls[x+0]=t,Ls[x+1]=n,Ls[x+2]=l,Ls[x+3]=u}const zo=new Uint16Array(2178),Rs=new Uint8Array(1089),Kd=new Uint16Array(1089);function ax(i){return i===0?-.03125:i===32?.03125:0}var lx=Oe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const cx={type:2,extent:Vt,loadGeometry:()=>[[new R(0,0),new R(8193,0),new R(8193,8193),new R(0,8193),new R(0,0)]]};class lm{constructor(e,t,n,l,u){this.tileID=e,this.uid=At(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<rt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ja(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const p={};if(!u)return p;for(const f of l){const x=f.layerIds.map(v=>u.getLayer(v)).filter(Boolean);if(x.length!==0){f.layers=x,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>x.filter(T=>T.id===v)[0]));for(const v of x)p[v.id]=f}}return p}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Bs){if(this.hasSymbolBuckets=!0,!n)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Bs&&u.hasRTLText){this.hasRTLText=!0,W.isLoading()||W.isLoaded()||G()!=="deferred"||Q();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new wo}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const l=this.buckets[n];l.uploadPending()&&l.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hu(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hu(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hu(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,l,u,p,f,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:f,transform:p,params:u,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const l=n.loadVTLayers(),u=t?t.sourceLayer:"",p=l._geojsonTileLayer||l[u];if(!p)return;const f=Ta(t&&t.filter),{z:x,x:v,y:T}=this.tileID.canonical,C={z:x,x:v,y:T};for(let M=0;M<p.length;M++){const B=p.feature(M);if(f.needGeometry){const Z=La(B,!0);if(!f.filter(new X(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!f.filter(new X(this.tileID.overscaledZ),B))continue;const L=n.getId(B,u),N=new sx(B,x,v,T,L);N.tile=C,e.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const n=Tt(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let l=!1;if(this.expirationTime>n)l=!1;else if(t)if(this.expirationTime<t)l=!0;else{const u=this.expirationTime-t;u?this.expirationTime=n+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const n=this.latestFeatureIndex.loadVTLayers(),l=t.style.listImages();for(const u in this.buckets){if(!t.style.hasLayer(u))continue;const p=this.buckets[u],f=p.layers[0].sourceLayer||"_geojsonTileLayer",x=n[f],v=e[f];if(!x||!v||Object.keys(v).length===0)continue;if(p.update(v,x,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof Rd||p instanceof Pd){const C=t.style._getSourceCache(p.layers[0].source);t._terrain&&t._terrain.enabled&&C&&p.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(C.id,this.tileID)}const T=t&&t.style&&t.style.getLayer(u);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<rt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=rt.now()+e}setTexture(e,t){const n=t.context,l=n.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Hu(n,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,t){const n={};for(const l of t)n[l]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const l=this.dependencies[n];if(l){for(const u of t)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const n=Jo(cx,this.tileID.canonical,this.tileTransform)[0],l=new ot,u=new Zo;for(let p=0;p<n.length;p++){const{x:f,y:x}=n[p];l.emplaceBack(f,x),u.emplaceBack(p)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,ju.members),this._tileDebugSegments=mr.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const n=Jo(cx,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const p=function(f,x){const v=ja(f,x),T=Math.pow(2,f.z);for(let Z=0;Z<Mo;Z++)for(let K=0;K<Mo;K++){const le=Nn((f.x+(K+ax(K))/Gn)/T),ie=Lr((f.y+(Z+ax(Z))/Gn)/T),se=x.project(le,ie),me=Z*Mo+K;zo[2*me+0]=Math.round((se.x*v.scale-v.x)*Vt),zo[2*me+1]=Math.round((se.y*v.scale-v.y)*Vt)}Rs.fill(0),Kd.fill(0);for(let Z=2045;Z>=0;Z--){const K=4*Z,le=Ls[K+0],ie=Ls[K+1],se=Ls[K+2],me=Ls[K+3],ue=le+se>>1,Ce=ie+me>>1,Se=ue+Ce-ie,De=Ce+le-ue,et=ie*Mo+le,Me=me*Mo+se,Le=Ce*Mo+ue,je=Math.hypot((zo[2*et+0]+zo[2*Me+0])/2-zo[2*Le+0],(zo[2*et+1]+zo[2*Me+1])/2-zo[2*Le+1])>=16;if(Rs[Le]=Rs[Le]||(je?1:0),Z<1022){const Re=(ie+De>>1)*Mo+(le+Se>>1),Je=(me+De>>1)*Mo+(se+Se>>1);Rs[Le]=Rs[Le]||Rs[Re]||Rs[Je]}}const C=new Mt,M=new Kt;let B=0;function L(Z,K){const le=K*Mo+Z;return Kd[le]===0&&(C.emplaceBack(zo[2*le+0],zo[2*le+1],Z*Vt/Gn,K*Vt/Gn),Kd[le]=++B),Kd[le]-1}function N(Z,K,le,ie,se,me){const ue=Z+le>>1,Ce=K+ie>>1;if(Math.abs(Z-se)+Math.abs(K-me)>1&&Rs[Ce*Mo+ue])N(se,me,Z,K,ue,Ce),N(le,ie,se,me,ue,Ce);else{const Se=L(Z,K),De=L(le,ie),et=L(se,me);M.emplaceBack(Se,De,et)}}return N(0,0,Gn,Gn,Gn,0),N(Gn,Gn,0,0,0,Gn),{vertices:C,indices:M}}(this.tileID.canonical,t);l=p.vertices,u=p.indices}else{l=new Mt,u=new Kt;for(const{x:f,y:x}of n)l.emplaceBack(f,x,0,0);const p=Id(l.int16,void 0,4);for(let f=0;f<p.length;f+=3)u.emplaceBack(p[f],p[f+1],p[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,lx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=mr.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||n.name!=="globe"||t.freezeTileCoverage)return;const l=this.tileID.canonical,u=$u(qy(l,t)),p=Gu(t.zoom);let f;p>0&&(f=Ef(new Float64Array(16),t.globeMatrix));const x=(l.x+.5)/(1<<l.z)-Eo(t.center.lng);let v=0;x>.5?v=-1:x<-.5&&(v=1),this._makeGlobeTileDebugBorderBuffer(e,l,t,u,f,p,v),this._makeGlobeTileDebugTextBuffer(e,l,t,u,f,p,v)}_globePoint(e,t,n,l,u,p,f,x){let v=Nu(e,t,n);if(p){const T=1<<n.z,C=[((e/Vt+n.x)/T+x)*l,(t/Vt+n.y)/T*l,0];yr(C,C,p),v=ms(v,C,f)}return yr(v,v,u)}_makeGlobeTileDebugBorderBuffer(e,t,n,l,u,p,f){const x=new ot,v=new Zo,T=new bt,C=(B,L,N,Z,K)=>{const le=(N-B)/(K-1),ie=(Z-L)/(K-1),se=x.length;for(let me=0;me<K;me++){const ue=B+me*le,Ce=L+me*ie;x.emplaceBack(ue,Ce);const Se=this._globePoint(ue,Ce,t,n.worldSize,l,u,p,f);T.emplaceBack(Se[0],Se[1],Se[2]),v.emplaceBack(se+me)}},M=Vt;C(0,0,M,0,16),C(M,0,M,M,16),C(M,M,0,M,16),C(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(x,ju.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(T,Gy.members),this._tileDebugSegments=mr.simpleSegment(0,0,x.length,v.length)}_makeGlobeTileDebugTextBuffer(e,t,n,l,u,p,f){const x=new ot,v=new Kt,T=new bt,C=25;v.reserve(32),x.reserve(C),T.reserve(C);const M=(B,L)=>C*B+L;for(let B=0;B<C;B++){const L=2048*B;for(let N=0;N<C;N++){const Z=2048*N;x.emplaceBack(Z,L);const K=this._globePoint(Z,L,t,n.worldSize,l,u,p,f);T.emplaceBack(K[0],K[1],K[2])}}for(let B=0;B<4;B++)for(let L=0;L<4;L++){const N=M(B,L),Z=M(B,L+1),K=M(B+1,L),le=M(B+1,L+1);v.emplaceBack(N,Z,K),v.emplaceBack(K,Z,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(v),this._tileDebugTextBuffer=e.createVertexBuffer(x,ju.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(T,Gy.members),this._tileDebugTextSegments=mr.simpleSegment(0,0,C,32)}}class Tw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},gt(this.stateChanges[e][l],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])n[u]||(this.deletedStates[e][l][u]=null)}else for(const u in n)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,t,n){if(this.deletedStates[e]===null)return;const l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(n in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][n]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),l=gt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][t];if(u===null)return{};for(const p in u)delete l[p]}return l}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),gt(this.state[l][p],this.stateChanges[l][p]),u[p]=this.state[l][p];n[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const p in this.state[l])u[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else for(const f of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][f];u[p]=this.state[l][p]}n[l]=n[l]||{},gt(n[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const l in e)e[l].setFeatureState(n,t)}}class ux{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function hx(i,e,t,n){let l=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(n[p])<1e-15){if(t[p]<i[p]||t[p]>e[p])return null}else{const f=1/n[p];let x=(i[p]-t[p])*f,v=(e[p]-t[p])*f;if(x>v){const T=x;x=v,v=T}if(x>l&&(l=x),v<u&&(u=v),l>u)return null}return l}function dx(i,e,t,n,l,u,p,f,x,v,T){const C=n-i,M=l-e,B=u-t,L=p-i,N=f-e,Z=x-t,K=T[1]*Z-T[2]*N,le=T[2]*L-T[0]*Z,ie=T[0]*N-T[1]*L,se=C*K+M*le+B*ie;if(Math.abs(se)<1e-15)return null;const me=1/se,ue=v[0]-i,Ce=v[1]-e,Se=v[2]-t,De=(ue*K+Ce*le+Se*ie)*me;if(De<0||De>1)return null;const et=Ce*B-Se*M,Me=Se*C-ue*B,Le=ue*M-Ce*C,je=(T[0]*et+T[1]*Me+T[2]*Le)*me;return je<0||De+je>1?null:(L*et+N*Me+Z*Le)*me}function px(i,e,t){return(i-e)/(t-e)}function fx(i,e,t,n,l,u,p,f,x){const v=1<<t,T=u-n,C=p-l,M=(i+1)/v*T+n,B=(e+0)/v*C+l,L=(e+1)/v*C+l;f[0]=(i+0)/v*T+n,f[1]=B,x[0]=M,x[1]=L}class mx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(u){const p=Math.ceil(Math.log2(u.dim/8)),f=[];let x=Math.ceil(Math.pow(2,p));const v=1/x,T=(B,L,N,Z,K)=>{const le=Z?1:0,ie=(B+1)*N-le,se=L*N,me=(L+1)*N-le;K[0]=B*N,K[1]=se,K[2]=ie,K[3]=me};let C=new ux(x);const M=[];for(let B=0;B<x*x;B++){T(B%x,Math.floor(B/x),v,!1,M);const L=Os(M[0],M[1],u),N=Os(M[2],M[1],u),Z=Os(M[2],M[3],u),K=Os(M[0],M[3],u);C.minimums.push(Math.min(L,N,Z,K)),C.maximums.push(Math.max(L,N,Z,K)),C.leaves.push(1)}for(f.push(C),x/=2;x>=1;x/=2){const B=f[f.length-1];C=new ux(x);for(let L=0;L<x*x;L++){T(L%x,Math.floor(L/x),2,!0,M);const N=B.getElevation(M[0],M[1]),Z=B.getElevation(M[2],M[1]),K=B.getElevation(M[2],M[3]),le=B.getElevation(M[0],M[3]),ie=B.isLeaf(M[0],M[1]),se=B.isLeaf(M[2],M[1]),me=B.isLeaf(M[2],M[3]),ue=B.isLeaf(M[0],M[3]),Ce=Math.min(N.min,Z.min,K.min,le.min),Se=Math.max(N.max,Z.max,K.max,le.max),De=ie&&se&&me&&ue;C.maximums.push(Se),C.minimums.push(Ce),C.leaves.push(Se-Ce<=5&&De?1:0)}f.push(C)}return f}(this.dem),n=t.length-1,l=t[n];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,l,u,p,f=1){return hx([e,t,-100],[n,l,this.maximums[0]*f],u,p)}raycast(e,t,n,l,u,p,f=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,t,n,l,u,p,f);if(x==null)return null;const v=[],T=[],C=[],M=[],B=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:L,t:N,nodex:Z,nodey:K,depth:le}=B.pop();if(this.leaves[L]){fx(Z,K,le,e,t,n,l,C,M);const se=1<<le,me=(Z+0)/se,ue=(Z+1)/se,Ce=(K+0)/se,Se=(K+1)/se,De=Os(me,Ce,this.dem)*f,et=Os(ue,Ce,this.dem)*f,Me=Os(ue,Se,this.dem)*f,Le=Os(me,Se,this.dem)*f,je=dx(C[0],C[1],De,M[0],C[1],et,M[0],M[1],Me,u,p),Re=dx(M[0],M[1],Me,C[0],M[1],Le,C[0],C[1],De,u,p),Je=Math.min(je!==null?je:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const Ne=Sd([],u,p,N);if(_x(De,et,Le,Me,px(Ne[0],C[0],M[0]),px(Ne[1],C[1],M[1]))>=Ne[2])return N}continue}let ie=0;for(let se=0;se<this._siblingOffset.length;se++){fx((Z<<1)+this._siblingOffset[se][0],(K<<1)+this._siblingOffset[se][1],le+1,e,t,n,l,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[L]+se]*f;const me=hx(C,M,u,p);if(me!=null){const ue=me;v[se]=ue;let Ce=!1;for(let Se=0;Se<ie&&!Ce;Se++)ue>=v[T[Se]]&&(T.splice(Se,0,se),Ce=!0);Ce||(T[ie]=se),ie++}}for(let se=0;se<ie;se++){const me=T[se];B.push({idx:this.childOffsets[L]+me,t:v[me],nodex:(Z<<1)+this._siblingOffset[me][0],nodey:(K<<1)+this._siblingOffset[me][1],depth:le+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,l,u){if(e[l].isLeaf(t,n)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=l-1,f=e[p];let x=0,v=0;for(let T=0;T<this._siblingOffset.length;T++){const C=2*t+this._siblingOffset[T][0],M=2*n+this._siblingOffset[T][1],B=f.getElevation(C,M),L=f.isLeaf(C,M),N=this._addNode(B.min,B.max,L);L&&(x|=1<<T),v||(v=N)}for(let T=0;T<this._siblingOffset.length;T++)x&1<<T||this._construct(e,2*t+this._siblingOffset[T][0],2*n+this._siblingOffset[T][1],p,v+T)}}function _x(i,e,t,n,l,u){return mi(mi(i,t,u),mi(e,n,u),l)}function Os(i,e,t){const n=t.dim,l=He(i*n-.5,0,n-1),u=He(e*n-.5,0,n-1),p=Math.floor(l),f=Math.floor(u),x=Math.min(p+1,n-1),v=Math.min(f+1,n-1);return _x(t.get(p,f),t.get(x,f),t.get(p,v),t.get(x,v),l-p,u-f)}const gx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ep{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,l=!1,u=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Ai(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const p=this.dim=t.height-2,f=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=l,!l){for(let x=0;x<p;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(p,x)]=f[this._idx(p-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,p)]=f[this._idx(x,p-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(p,-1)]=f[this._idx(p-1,0)],f[this._idx(-1,p)]=f[this._idx(0,p-1)],f[this._idx(p,p)]=f[this._idx(p-1,p-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mx(this)}get(e,t,n=!1){n&&(e=He(e,-1,this.dim),t=He(t,-1,this.dim));const l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return gx[e]}get unpackVector(){return gx[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,n){return(256*e*256+256*t+n)/10-1e4}_unpackTerrarium(e,t,n){return 256*e+t+n/256-32768}static pack(e,t){const n=[0,0,0,0],l=ep.getUnpackVector(t);let u=Math.floor((e+l[3])/l[2]);return n[2]=u%256,u=Math.floor(u/256),n[1]=u%256,u=Math.floor(u/256),n[0]=u,n}getPixels(){return new _n({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=t*this.dim,u=t*this.dim+this.dim,p=n*this.dim,f=n*this.dim+this.dim;switch(t){case-1:l=u-1;break;case 1:u=l+1}switch(n){case-1:p=f-1;break;case 1:f=p+1}const x=-t*this.dim,v=-n*this.dim;for(let T=p;T<f;T++)for(let C=l;C<u;C++){const M=4*this._idx(C,T),B=4*this._idx(C+x,T+v);this.pixels[M+0]=e.pixels[B+0],this.pixels[M+1]=e.pixels[B+1],this.pixels[M+2]=e.pixels[B+2],this.pixels[M+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}_t(ep,"DEMData"),_t(mx,"DemMinMaxQuadTree",{omit:["dem"]});class Sw{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:t,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},n)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,l=t===void 0?0:this.data[n].indexOf(t),u=this.data[n][l];return this.data[n].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const n in this.data)for(const l of this.data[n])e(l.value)||t.push(l);for(const n of t)this.remove(n.value.tileID,n)}}class tc{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}tc.ReadOnly=!1,tc.ReadWrite=!0,tc.disabled=new tc(519,tc.ReadOnly,[0,1]);const cm=7680;class um{constructor(e,t,n,l,u,p){this.test=e,this.ref=t,this.mask=n,this.fail=l,this.depthFail=u,this.pass=p}}um.disabled=new um({func:519,mask:0},0,0,cm,cm,cm);class ko{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}ko.Replace=[1,0],ko.disabled=new ko(ko.Replace,Mi.transparent,[!1,!1,!1,!1]),ko.unblended=new ko(ko.Replace,Mi.transparent,[!0,!0,!0,!0]),ko.alphaBlended=new ko([1,771],Mi.transparent,[!0,!0,!0,!0]);const hm=1029,dm=2305;class so{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}so.disabled=new so(!1,hm,dm),so.backCCW=new so(!0,hm,dm),so.backCW=new so(!0,hm,2304),so.frontCW=new so(!0,1028,2304),so.frontCCW=new so(!0,1028,dm);class Na extends Pt{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Sw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tw,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const n=this._tiles[t];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(e),n.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Et(this._tiles).map(e=>e.tileID).sort(yx).map(e=>e.key)}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort((n,l)=>{const u=n.tileID,p=l.tileID,f=new R(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),x=new R(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-p.overscaledZ||x.y-f.y||x.x-f.x}).map(n=>n.tileID.key):t.map(n=>n.tileID).sort(yx).map(n=>n.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Ci(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=rt.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Pi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let l=0;l<t.length;l++){const u=t[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const p=this.getTileByID(u);n(e,p),n(p,e)}}function n(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=u.tileID.canonical.x-l.tileID.canonical.x;const f=u.tileID.canonical.y-l.tileID.canonical.y,x=Math.pow(2,l.tileID.canonical.z),v=u.tileID.key;p===0&&f===0||Math.abs(f)>1||(Math.abs(p)>1&&(Math.abs(p+x)===1?p+=x:Math.abs(p-x)===1&&(p-=x)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,p,f),l.neighboringTiles&&l.neighboringTiles[v]&&(l.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,l){for(const u in this._tiles){let p=this._tiles[u];if(l[u]||!p.hasData()||p.tileID.overscaledZ<=t||p.tileID.overscaledZ>n)continue;let f=p.tileID;for(;p&&p.tileID.overscaledZ>t+1;){const v=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[v.key],p&&p.hasData()&&(f=v)}let x=f;for(;x.overscaledZ>t;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){l[f.key]=f;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const l=e.scaledTo(n),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,l=Math.ceil(e.height/t)+1,u=Math.floor(n*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(f)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const n={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+t),n[u.tileID.key]=u}this._tiles=n;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let l;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Qr(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[];const u=this._updateRetainedTiles(l);if(xx(this._source.type)&&l.length!==0){const f={},x={},v=Object.keys(u);for(const C of v){const M=u[C],B=this._tiles[C];if(!B||B.fadeEndTime&&B.fadeEndTime<=rt.now())continue;const L=this.findLoadedParent(M,Math.max(M.overscaledZ-Na.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),f[L.tileID.key]=L.tileID),x[C]=M}const T=l[l.length-1].overscaledZ;for(const C in this._tiles){const M=this._tiles[C];if(u[C]||!M.hasData())continue;let B=M.tileID;for(;B.overscaledZ>T;){B=B.scaledTo(B.overscaledZ-1);const L=this._tiles[B.key];if(L&&L.hasData()&&x[B.key]){u[C]=M.tileID;break}}}for(const C in f)u[C]||(this._coveredTiles[C]=!0,u[C]=f[C])}for(const f in u)this._tiles[f].clearFadeHold();const p=function(f,x){const v=[];for(const T in f)T in x||v.push(T);return v}(this._tiles,u);for(const f of p){const x=this._tiles[f];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const n={},l=e.reduce((v,T)=>Math.min(v,T.overscaledZ),1/0),u=e[0].overscaledZ,p=Math.max(u-Na.maxOverzooming,this._source.minzoom),f=Math.max(u+Na.maxUnderzooming,this._source.minzoom),x={};for(const v of e){const T=this._addTile(v);t[v.key]=v,T.hasData()||l<this._source.maxzoom&&(x[v.key]=v)}this._retainLoadedChildren(x,l,f,t);for(const v of e){let T=this._tiles[v.key];if(T.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const M=v.children(this._source.maxzoom)[0],B=this.getTile(M);if(B&&B.hasData()){t[M.key]=M;continue}}else{const M=v.children(this._source.maxzoom);if(t[M[0].key]&&t[M[1].key]&&t[M[2].key]&&t[M[3].key])continue}let C=T.wasRequested();for(let M=v.overscaledZ-1;M>=p;--M){const B=v.scaledTo(M);if(n[B.key]||(n[B.key]=!0,T=this.getTile(B),!T&&C&&(T=this._addTile(B)),T&&(t[B.key]=B,C=T.wasRequested(),T.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){n=this._loadedParentTiles[l.key];break}t.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(n=this._getLoadedTile(u),n)break;l=u}for(const u of t)this._loadedParentTiles[u]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const l=this.map?this.map.painter:null;t=new lm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new Pi("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const l=[],u=this.transform;if(!u)return l;const p=u.projection.name==="globe",f=Eo(u.center.lng);for(const x in this._tiles){const v=this._tiles[x];if(n&&v.clearQueryDebugViz(),v.holdingForFade())continue;let T;if(p){const C=v.tileID.canonical;if(C.z===0){const M=[Math.abs(He(f,...Qu(C,-1))-f),Math.abs(He(f,...Qu(C,1))-f)];T=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(He(f,...Qu(C,-1))-f),Math.abs(He(f,...Qu(C,0))-f),Math.abs(He(f,...Qu(C,1))-f)];T=[M.indexOf(Math.min(...M))-1]}}else T=[0];for(const C of T){const M=e.containsTile(v,u,t,C);M&&l.push(M)}}return l}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of t)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(xx(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=rt.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const l=this._tiles[e];l&&l.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(e,t){const n=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,p=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const f of l){const x=f.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of x)n.set(v.key,v);this.usedForTerrain&&f.updateElevation(!1)}xt(Array.from(n.values()),(f,x)=>{const v=new lm(f,this._source.tileSize*f.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,T=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),x(T,v)})},t)}}function yx(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function xx(i){return i==="raster"||i==="image"||i==="video"}function Qu(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}Na.maxOverzooming=10,Na.maxUnderzooming=3;class tp{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const l=n||e.findDEMTileFor(t);if(!l||!l.dem)return;const u=l.dem,p=l.tileID,f=1<<t.canonical.z-p.canonical.z;return new tp(l,l.tileSize/Vt/f,[(t.canonical.x/f-p.canonical.x)*u.dim,(t.canonical.y/f-p.canonical.y)*u.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(n);return new R(l,u)}getElevationAt(e,t,n,l){const u=e*this._scale+this._offset[0],p=t*this._scale+this._offset[1],f=Math.floor(u),x=Math.floor(p),v=this._dem;return l=!!l,n?mi(mi(v.get(f,x,l),v.get(f,x+1,l),p-x),mi(v.get(f+1,x,l),v.get(f+1,x+1,l),p-x),u-f):v.get(f,x,l)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*jn(1,e)*this._dem.stride}}class vx{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ss(Vt,16,0),this.featureIndexArray=new cg,this.promoteId=t}insert(e,t,n,l,u,p=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,l,u,p);const x=this.grid;for(let v=0;v<t.length;v++){const T=t[v],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const B=T[M];C[0]=Math.min(C[0],B.x),C[1]=Math.min(C[1],B.y),C[2]=Math.max(C[2],B.x),C[3]=Math.max(C[3],B.y)}C[0]<Vt&&C[1]<Vt&&C[2]>=0&&C[3]>=0&&x.insert(f,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Va.VectorTile(new Fu(this.rawTileData)).layers,this.sourceLayerCoder=new ox(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,l){this.loadVTLayers();const u=e.params||{},p=Ta(u.filter),f=e.tileResult,x=e.transform,v=f.bufferedTilespaceBounds,T=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(L,N,Z,K)=>Cg(f.bufferedTilespaceGeometry,L,N,Z,K));T.sort(Iw);let C=null;x.elevation&&T.length>0&&(C=tp.create(x.elevation,this.tileID));const M={};let B;for(let L=0;L<T.length;L++){const N=T[L];if(N===B)continue;B=N;const Z=this.featureIndexArray.get(N);let K=null;this.loadMatchingFeature(M,Z,p,u.layers,u.availableImages,t,n,l,(le,ie,se,me=0)=>(K||(K=Jo(le,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(f,le,se,K,this.z,e.transform,e.pixelPosMatrix,C,me)))}return M}loadMatchingFeature(e,t,n,l,u,p,f,x,v){const{featureIndex:T,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:B}=t,L=this.bucketLayerIDs[C];if(l&&!function(le,ie){for(let se=0;se<le.length;se++)if(ie.indexOf(le[se])>=0)return!0;return!1}(l,L))return;const N=this.sourceLayerCoder.decode(M),Z=this.vtLayers[N].feature(T);if(n.needGeometry){const le=La(Z,!0);if(!n.filter(new X(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!n.filter(new X(this.tileID.overscaledZ),Z))return;const K=this.getId(Z,N);for(let le=0;le<L.length;le++){const ie=L[le];if(l&&l.indexOf(ie)<0)continue;const se=p[ie];if(!se)continue;let me={};K!==void 0&&x&&(me=x.getState(se.sourceLayer||"_geojsonTileLayer",K));const ue=gt({},f[ie]);ue.paint=Ax(ue.paint,se.paint,Z,me,u),ue.layout=Ax(ue.layout,se.layout,Z,me,u);const Ce=!v||v(Z,se,me,B);if(!Ce)continue;const Se=new sx(Z,this.z,this.x,this.y,K);Se.layer=ue;let De=e[ie];De===void 0&&(De=e[ie]=[]),De.push({featureIndex:T,feature:Se,intersectionZ:Ce})}}lookupSymbolFeatures(e,t,n,l,u,p,f,x){const v={};this.loadVTLayers();const T=Ta(u);for(const C of e)this.loadMatchingFeature(v,{bucketIndex:n,sourceLayerIndex:l,featureIndex:C,layoutVertexArrayOffset:0},T,p,f,x,t);return v}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(n),u=this.vtFeatures[l];if(u[t])return u[t];const p=this.vtLayers[l].feature(t);return u[t]=p,p}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof n=="boolean"&&(n=Number(n))),n}}function Ax(i,e,t,n,l){return Bt(i,(u,p)=>{const f=e instanceof pe?e.get(p):null;return f&&f.evaluate?f.evaluate(t,n,l):f})}function Iw(i,e){return e-i}_t(vx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class bx{constructor(e){const t={},n=[];for(const f in e){const x=e[f],v=t[f]={};for(const T in x.glyphs){const C=x.glyphs[+T];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const M=C.metrics.localGlyph?2:1,B={x:0,y:0,w:C.bitmap.width+2*M,h:C.bitmap.height+2*M};n.push(B),v[T]=B}}const{w:l,h:u}=Gf(n),p=new Ko({width:l||1,height:u||1});for(const f in e){const x=e[f];for(const v in x.glyphs){const T=x.glyphs[+v];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const C=t[f][v],M=T.metrics.localGlyph?2:1;Ko.copy(T.bitmap,p,{x:0,y:0},{x:C.x+M,y:C.y+M},T.bitmap)}}this.image=p,this.positions=t}}_t(bx,"GlyphAtlas");class Cw{constructor(e){this.tileID=new Qr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ja(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,n,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new wo;const p=new ox(Object.keys(e.layers).sort()),f=new vx(this.tileID,this.promoteId);f.bucketLayerIDs=[];const x={},v=new am(256,256),T={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:n},C=t.familiesBySource[this.source];for(const me in C){const ue=e.layers[me];if(!ue)continue;let Ce=!1,Se=!1;for(const Me of C[me])Me[0].type==="symbol"?Ce=!0:Se=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!Se)continue;ue.version===1&&Ai(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const De=p.encode(me),et=[];for(let Me=0;Me<ue.length;Me++){const Le=ue.feature(Me),je=f.getId(Le,me);et.push({feature:Le,id:je,index:Me,sourceLayerIndex:De})}for(const Me of C[me]){const Le=Me[0];this.isSymbolTile!==void 0&&Le.type==="symbol"!==this.isSymbolTile||Le.minzoom&&this.zoom<Math.floor(Le.minzoom)||Le.maxzoom&&this.zoom>=Le.maxzoom||Le.visibility!=="none"&&(pm(Me,this.zoom,n),(x[Le.id]=Le.createBucket({index:f.bucketLayerIDs.length,layers:Me,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:De,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(et,T,this.tileID.canonical,this.tileTransform),f.bucketLayerIDs.push(Me.map(je=>je.id)))}}let M,B,L,N;v.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=Bt(T.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(K).length?l.send("getGlyphs",{uid:this.uid,stacks:K},(me,ue)=>{M||(M=me,B=ue,se.call(this))},void 0,!1,Z):B={};const le=Object.keys(T.iconDependencies);le.length?l.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(me,ue)=>{M||(M=me,L=ue,se.call(this))},void 0,!1,Z):L={};const ie=Object.keys(T.patternDependencies);function se(){if(M)return u(M);if(B&&L&&N){const me=new bx(B),ue=new wy(L,N);for(const Ce in x){const Se=x[Ce];Se instanceof Bs?(pm(Se.layers,this.zoom,n),Qb(Se,B,me.positions,L,ue.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):Se.hasPattern&&(Se instanceof Rd||Se instanceof Pd||Se instanceof Bu)&&(pm(Se.layers,this.zoom,n),Se.addFeatures(T,this.tileID.canonical,ue.patternPositions,n,this.tileTransform))}this.status="done",u(null,{buckets:Et(x).filter(Ce=>!Ce.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:v,imageAtlas:ue,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?me.positions:null})}}ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(me,ue)=>{M||(M=me,N=ue,se.call(this))},void 0,!1,Z):N={},se.call(this)}}function pm(i,e,t){const n=new X(e);for(const l of i)l.recalculate(n,t)}class wx{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[p,f]=u.result;return this.scheduler?this.scheduler.add(()=>{l(p,f)},t):l(p,f),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n((p,f)=>{u.result=[p,f];for(const x of u.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,f)},t):x(p,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function Ex(i,e,t){const n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const u=Ee(i.request,(p,f,x,v)=>{p?l(p):f&&l(null,{vectorTile:t?void 0:new Va.VectorTile(new Fu(f)),rawData:f,cacheControl:x,expires:v})});return()=>{u.cancel(),l()}},e)}o.ARRAY_TYPE=mn,o.AUTH_ERR_MSG=di,o.Aabb=sn,o.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},vi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$e()?i:P,this.scheduler=new ww}send(i,e,t,n,l=!1,u){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=u,this.callbacks[p]=t);const f=kt(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!t,targetMapId:n,mustQueue:l,sourceMapId:this.mapId,data:Is(e,f)},f),{cancel:()=>{t&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[t];delete this.cancelCallbacks[t],n&&n.cancel()}else if(e.mustQueue||$e()){const n=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),n&&n.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(Ca(e.error)):t(null,Ca(e.data)))}else{const t=kt(this.globalScope)?void 0:[],n=e.hasCallback?(u,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?Is(u):null,data:Is(p,t)},t)}:u=>{},l=Ca(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,n);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Bd,o.Color=Mi,o.ColorMode=ko,o.CullFaceMode=so,o.DEMData=ep,o.DataConstantProperty=he,o.DedupedRequest=wx,o.DepthMode=tc,o.EXTENT=Vt,o.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,n=1<<t,l=Math.floor(i.x),u=Math.floor((i.x-l)*n),p=Math.floor(i.y*n),f=this.findDEMTileFor(new Qr(t,l,t,u,p));return!(!f||!f.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const n=this._source();if(!n||i.y<0||i.y>1)return e;const l=n.getSource().maxzoom,u=1<<l,p=Math.floor(i.x),f=i.x-p,x=new Qr(l,p,l,Math.floor(f*u),Math.floor(i.y*u)),v=this.findDEMTileFor(x);if(!v||!v.dem)return e;const T=v.dem,C=1<<v.tileID.canonical.z,M=(f*C-v.tileID.canonical.x)*T.dim,B=(i.y*C-v.tileID.canonical.y)*T.dim,L=Math.floor(M),N=Math.floor(B);return(t?this.exaggeration():1)*mi(mi(T.get(L,N),T.get(L,N+1),B-N),mi(T.get(L+1,N),T.get(L+1,N+1),B-N),M-L)}getAtTileOffset(i,e,t){const n=1<<i.canonical.z;return this.getAtPointOrZero(new Vl(i.wrap+(i.canonical.x+e/Vt)/n,(i.canonical.y+t/Vt)/n))}getAtTileOffsetFunc(i,e,t,n){return l=>{const u=this.getAtTileOffset(i,l.x,l.y),p=n.upVector(i.canonical,l.x,l.y);return io(p,p,u*n.upVectorScale(i.canonical,e,t).metersToTile),p}}getForTilePoints(i,e,t,n){const l=tp.create(this,i,n);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,n=e.tileID,l=1<<i.canonical.z-n.canonical.z;let u=i.canonical.x/l-n.canonical.x,p=i.canonical.y/l-n.canonical.y,f=0;for(let x=0;x<i.canonical.z-n.canonical.z&&!t.leaves[f];x++){u*=2,p*=2;const v=2*Math.floor(p)+Math.floor(u);f=t.childOffsets[f]+v,u%=1,p%=1}return{min:this.exaggeration()*t.minimums[f],max:this.exaggeration()*t.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Ci,o.EvaluationParameters=X,o.Event=Pi,o.Evented=Pt,o.FillExtrusionBucket=Bu,o.Frustum=Df,o.FrustumCorners=Pf,o.GLOBE_METERS_TO_ECEF=Kf,o.GLOBE_RADIUS=is,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new ot,t=new Kt,n=65;for(let l=0;l<n;l++)for(let u=0;u<n;u++)e.emplaceBack(u,l);this._gridSegments=[];for(let l=0,u=0;l<Jl.length;l++){const p=Jl[l];for(let x=0;x<p;x++)for(let v=0;v<64;v++){const T=x*n+v;t.emplaceBack(T+1,T,T+n),t.emplaceBack(T+n,T+n+1,T+1)}const f=64*p*2;this._gridSegments.push(mr.simpleSegment(0,u,(p+1)*n,f)),u+=f}this._gridBuffer=i.createVertexBuffer(e,ju.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new Kt;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new Br,n=new Br;this._poleSegments=[];for(let l=0,u=0;l<5;l++){const p=360/(1<<l);t.emplaceBack(0,-is,0,.5,0),n.emplaceBack(0,-is,0,.5,1);for(let f=0;f<=64;f++){const x=f/64,v=mi(0,p,x),[T,C,M]=Kl(rw,nw,v,is);t.emplaceBack(T,C,M,x,0),n.emplaceBack(T,C,M,x,1)}this._poleSegments.push(mr.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,$y,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(n,$y,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new jr,n=64,l=n+1;this._wireframeSegments=[];for(let u=0,p=0;u<Jl.length;u++){const f=Jl[u];for(let v=0;v<f;v++)for(let T=0;T<n;T++){const C=v*l+T;t.emplaceBack(C,C+1),t.emplaceBack(C,C+l),t.emplaceBack(C,C+l+1)}const x=f*n*3;this._wireframeSegments.push(mr.simpleSegment(0,p,(f+1)*l,x)),p+=x}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=Ql,o.ImagePosition=Zf,o.LineAtlas=am,o.LngLat=Si,o.LngLatBounds=zs,o.LocalGlyphMode=Hf,o.MAX_MERCATOR_LATITUDE=To,o.MercatorCoordinate=Vl,o.ONE_EM=Rr,o.OverscaledTileID=Qr,o.Properties=Be,o.RGBAImage=_n,o.Ray=kf,o.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",li,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!pi(i))return i;const t=fr(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!pi(i))return i;const t=fr(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,n){if(!pi(i))return i;const l=fr(i);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),t&&l.params.push(`language=${t}`),n&&l.params.push(`worldview=${n}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,n){const l=fr(i);return pi(i)?(l.path=`/styles/v1${l.path}/sprite${e}${t}`,this._makeAPIURL(l,this._customAccessToken||n)):(l.path+=`${e}${t}`,hn(l))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!pi(i))return i;const n=fr(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&n.authority!=="raster"&&t===512?"@2x":""}${lt.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Ue.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Ue.TILE_URL_VERSION}${n.path}`);const l=this._customAccessToken||function(u){for(const p of u){const f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(n.params)||Ue.ACCESS_TOKEN;return Ue.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,l)}canonicalizeTileURL(i,e){const t=fr(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let n="mapbox://";t.path.match(/^\/raster\/v1\//)?n+=`raster/${t.path.replace(`/${Ue.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${t.path.replace(`/${Ue.TILE_URL_VERSION}/`,"")}`;let l=t.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(n+=`?${l.join("&")}`),n}canonicalizeTileset(i,e){const t=!!e&&pi(e),n=[];for(const l of i.tiles||[])Ti(l)?n.push(this.canonicalizeTileURL(l,t)):n.push(l);return n}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=fr(Ue.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!Ue.REQUIRE_ACCESS_TOKEN)return hn(i);if(e=e||Ue.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),hn(i)}},o.ResourceType=ge,o.SegmentVector=mr,o.SourceCache=Na,o.StencilMode=um,o.StructArrayLayout1ui2=Zo,o.StructArrayLayout2f1f2i16=Kn,o.StructArrayLayout2i4=ot,o.StructArrayLayout2ui4=jr,o.StructArrayLayout3f12=Xi,o.StructArrayLayout3ui6=Kt,o.StructArrayLayout4i8=Mt,o.StructArrayLayout5f20=Br,o.Texture=Hu,o.Tile=lm,o.Transitionable=te,o.Uniform1f=xd,o.Uniform1i=class extends Ho{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends Ho{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},o.Uniform3f=class extends Ho{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},o.Uniform4f=_g,o.UniformColor=gg,o.UniformMatrix2f=class extends Ho{constructor(i){super(i),this.current=h1}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let n=0;n<4;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},o.UniformMatrix3f=class extends Ho{constructor(i){super(i),this.current=u1}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let n=0;n<9;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},o.UniformMatrix4f=class extends Ho{constructor(i){super(i),this.current=c1}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let n=1;n<16;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},o.UnwrappedTileID=uy,o.ValidationError=pt,o.VectorTileWorkerSource=class extends Pt{constructor(i,e,t,n,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=l||Ex,this.loading={},this.loaded={},this.deduped=new wx(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,n=i&&i.request,l=n&&n.collectResourceTiming,u=this.loading[t]=new Cw(i);u.abort=this.loadVectorData(i,(p,f)=>{const x=!this.loading[t];if(delete this.loading[t],x||p||!f)return u.status="done",x||(this.loaded[t]=u),e(p);const v=f.rawData,T={};f.expires&&(T.expires=f.expires),f.cacheControl&&(T.cacheControl=f.cacheControl),u.vectorTile=f.vectorTile||new Va.VectorTile(new Fu(v));const C=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,B)=>{if(M||!B)return e(M);const L={};if(l){const N=qt(n);N.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(N)))}e(null,gt({rawTileData:v.slice(0)},B,T,L))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[t]=u})}reloadTile(i,e){const t=this.loaded,n=i.uid,l=this;if(t&&t[n]){const u=t[n];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=ja(i.tileID.canonical,i.projection);const p=(f,x)=>{const v=u.reloadCallback;v&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,v)),e(f,x)};u.status==="parsing"?u.reloadCallback=p:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const t=i.uid,n=this.loading[t];n&&(n.abort&&n.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,n=i.uid;t&&t[n]&&delete t[n],e()}},o.WritingMode=kn,o.ZoomHistory=nd,o.add=ks,o.addDynamicAttributes=Yd,o.adjoint=function(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=e[4],f=e[5],x=e[6],v=e[7],T=e[8];return i[0]=p*T-f*v,i[1]=l*v-n*T,i[2]=n*f-l*p,i[3]=f*x-u*T,i[4]=t*T-l*x,i[5]=l*u-t*f,i[6]=u*v-p*x,i[7]=n*x-t*v,i[8]=t*p-n*u,i},o.asyncAll=xt,o.bezier=st,o.bindAll=vi,o.boundsAttributes=lx,o.bufferConvexPolygon=function(i,e){const t=[];for(let n=0;n<i.length;n++){const l=We(n-1,-1,i.length-1),u=We(n+1,-1,i.length-1),p=i[n],f=i[u],x=i[l].sub(p).unit(),v=f.sub(p).unit(),T=v.angleWithSep(x.x,x.y),C=x.add(v).unit().mult(-1*e/Math.sin(T/2));t.push(p.add(C))}return t},o.cacheEntryPossiblyAdded=function(i){re++,re>nl&&(i.getActor().send("enforceCacheSizeLimit",us),re=0)},o.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:n}=i.point,l=Hy(t,n,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Nl(l,l,im(Co(e)))},o.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:n,lat:l}=i._center;return Hy(e,t,i.worldSize,n,l)},o.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/jn(1,i.center.lat),n=So(new Float64Array(16));return Tu(n,n,[i.point.x,i.point.y,0]),Oa(n,n,[t,t,e]),Float32Array.from(n)},o.circumferenceAtLatitude=gf,o.clamp=He,o.clearTileCache=function(i){const e=ee(),t=[];for(const n in qr)e&&t.push(e.delete(n)),delete qr[n];i&&Promise.all(t).catch(i).then(()=>i())},o.clipLine=Ly,o.clone=function(i){var e=new mn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=lr,o.collisionCircleLayout=bb,o.config=Ue,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new mn(16);return mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=kg,o.createExpression=As,o.createLayout=Oe,o.createStyleLayer=function(i){return i.type==="custom"?new xw(i):new Aw[i.type](i)},o.cross=zf,o.degToRad=ve,o.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},o.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},o.dot=$n,o.ease=ft,o.easeCubicInOut=Ze,o.emitValidationErrors=pu,o.endsWith=fi,o.enforceCacheSizeLimit=function(i){for(const e in qr)O(e),qr[e].then(t=>{t.keys().then(n=>{for(let l=0;l<n.length-i;l++)t.delete(n[l])})})},o.evaluateSizeForFeature=Od,o.evaluateSizeForZoom=ql,o.evaluateVariableOffset=Vy,o.evented=U,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=rt,o.exported$1=lt,o.extend=gt,o.extend$1=rn,o.fillExtrusionHeightLift=ay,o.filterObject=$i,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=t+t,f=n+n,x=l+l,v=t*p,T=n*p,C=n*f,M=l*p,B=l*f,L=l*x,N=u*p,Z=u*f,K=u*x;return i[0]=1-C-L,i[1]=T+K,i[2]=M-Z,i[3]=0,i[4]=T-K,i[5]=1-v-L,i[6]=B+N,i[7]=0,i[8]=M+Z,i[9]=B-N,i[10]=1-v-C,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var t=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=t,i[2]=0,i[3]=-t,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=Pg,o.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ge[e]},o.getAABBPointSquareDist=function(i,e,t){let n=0;for(let l=0;l<2;++l){const u=t?t[l]:0;i[l]>u&&(n+=(i[l]-u)*(i[l]-u)),e[l]<u&&(n+=(u-e[l])*(u-e[l]))}return n},o.getAnchorAlignment=Xf,o.getAnchorJustification=Yf,o.getBounds=function(i){let e=1/0,t=1/0,n=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),t=Math.min(t,u.y),n=Math.max(n,u.x),l=Math.max(l,u.y);return{min:new R(e,t),max:new R(n,l)}},o.getColumn=yi,o.getGridMatrix=function(i,e,t){const n=e.getNorth(),l=e.getSouth(),u=e.getWest(),p=.015625;return[0,(e.getEast()-u)*p,1<<i.z,(l-n)/Jl[t],0,i.y,n,u,p]},o.getImage=Ut,o.getJSON=function(i,e){return ye(gt(i,{type:"json"}),e)},o.getLatitudinalLod=function(i){const e=80.051129;i=He(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(ve(i))),3);return Math.round(t*(Jl.length-1))},o.getMapSessionAPI=Tc,o.getPerformanceMeasurement=qt,o.getProjection=rx,o.getRTLTextPluginStatus=G,o.getReferrer=Ae,o.getTilePoint=function(i,{x:e,y:t},n=0){return new R(((e-n)*i.scale-i.x)*Vt,(t*i.scale-i.y)*Vt)},o.getTileVec3=function(i,e,t=0){return $l(((e.x-t)*i.scale-i.x)*Vt,(e.y*i.scale-i.y)*Vt,vg(e.z,e.y))},o.getVideo=function(i,e){const t=P.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let n=0;n<i.length;n++){const l=P.document.createElement("source");qe(i[n])||(t.crossOrigin="Anonymous"),l.src=i[n],t.appendChild(l)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=So(new Float64Array(16));return Nl(t,i.pixelMatrix,i.globeMatrix),yr(e,e,t),new R(e[0],e[1])},o.globeDenormalizeECEF=im,o.globeECEFOrigin=function(i,e){const t=[0,0,0];return yr(t,t,$u(Co(e.canonical))),yr(t,t,i),t},o.globeNormalizeECEF=$u,o.globePixelsToTileUnits=function(i,e){return Vt/(512*Math.pow(2,i))*qd(Co(e))},o.globePoleMatrixForTile=function(i,e,t){const n=So(new Float64Array(16)),l=(e/(1<<i)-.5)*Math.PI*2;return Td(n,t.globeMatrix,l),Float32Array.from(n)},o.globeTileBounds=Co,o.globeTiltAtLngLat=Qy,o.globeToMercatorTransition=Gu,o.globeUseCustomAntiAliasing=function(i,e,t){const n=Gu(t.zoom),l=i.style.map._antialias,u=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return n===0&&!l&&!p&&u},o.identity=So,o.identity$1=Ug,o.invert=Ef,o.isFullscreen=function(){return!!P.document.fullscreenElement||!!P.document.webkitFullscreenElement},o.isLngLatBehindGlobe=function(i,e){return Qy(i,e)>Math.PI/2*1.01},o.isMapAuthenticated=function(i){return fo.has(i)},o.isMapboxURL=pi,o.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!kt(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Lr,o.len=C1,o.length=Su,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=Ex,o.makeRequest=ye,o.mapValue=function(i,e,t,n,l){return He((i-e)/(t-e)*(l-n)+n,n,l)},o.mercatorScale=Ag,o.mercatorXfromLng=Eo,o.mercatorYfromLat=Yo,o.mercatorZfromAltitude=jn,o.mul=S1,o.mul$1=I1,o.multiply=Nl,o.multiply$1=function(i,e,t){var n=e[0],l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],T=e[7],C=e[8],M=t[0],B=t[1],L=t[2],N=t[3],Z=t[4],K=t[5],le=t[6],ie=t[7],se=t[8];return i[0]=M*n+B*p+L*v,i[1]=M*l+B*f+L*T,i[2]=M*u+B*x+L*C,i[3]=N*n+Z*p+K*v,i[4]=N*l+Z*f+K*T,i[5]=N*u+Z*x+K*C,i[6]=le*n+ie*p+se*v,i[7]=le*l+ie*f+se*T,i[8]=le*u+ie*x+se*C,i},o.multiply$2=Lg,o.nextPowerOfTwo=ri,o.normalize=Hr,o.normalize$1=function(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=t*t+n*n+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=t*p,i[1]=n*p,i[2]=l*p,i[3]=u*p,i},o.number=mi,o.ortho=function(i,e,t,n,l,u,p){var f=1/(e-t),x=1/(n-l),v=1/(u-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+t)*f,i[13]=(l+n)*x,i[14]=(p+u)*v,i[15]=1,i},o.pbf=Fu,o.perspective=function(i,e,t,n,l){var u,p=1/Math.tan(e/2);return i[0]=p/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+n)*(u=1/(n-l)),i[14]=2*l*n*u):(i[10]=-1,i[14]=-2*n),i},o.pick=function(i,e){const t={};for(let n=0;n<e.length;n++){const l=e[n];l in i&&(t[l]=i[l])}return t},o.plugin=W,o.pointGeometry=R,o.polygonContainsPoint=Ra,o.polygonIntersectsBox=Cg,o.polygonIntersectsPolygon=Eg,o.polygonizeBounds=function(i,e,t=0,n=!0){const l=new R(t,t),u=i.sub(l),p=e.add(l),f=[u,new R(p.x,u.y),p,new R(u.x,p.y)];return n&&f.push(u.clone()),f},o.posAttributes=ju,o.postMapLoadEvent=il,o.postTurnstileEvent=kr,o.potpack=Gf,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=Ie,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:E,pluginURL:S}),U.on("pluginStateChange",i),i},o.removeAuthState=function(i){fo.delete(i)},o.renderColorRamp=Lf,o.resample=bg,o.rotateX=Tf,o.rotateX$1=Vg,o.rotateY=Td,o.rotateY$1=jg,o.rotateZ=function(i,e,t){var n=Math.sin(t),l=Math.cos(t),u=e[0],p=e[1],f=e[2],x=e[3],v=e[4],T=e[5],C=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+v*n,i[1]=p*l+T*n,i[2]=f*l+C*n,i[3]=x*l+M*n,i[4]=v*l-u*n,i[5]=T*l-p*n,i[6]=C*l-f*n,i[7]=M*l-x*n,i},o.rotateZ$1=function(i,e,t){t*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(t),x=Math.cos(t);return i[0]=n*x+l*f,i[1]=l*x-n*f,i[2]=u*x+p*f,i[3]=p*x-u*f,i},o.scale=Oa,o.scale$1=Og,o.scale$2=io,o.scaleAndAdd=Sd,o.setCacheLimits=function(i,e){us=i,nl=e},o.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},o.setRTLTextPlugin=function(i,e,t=!1){if(E===h||E===m||E===y)throw new Error("setRTLTextPlugin cannot be called multiple times.");S=rt.resolveURL(i),E=h,b=e,D(),t||Q()},o.smoothstep=yt,o.spec=Pe,o.storeAuthState=function(i,e){e?fo.add(i):fo.delete(i)},o.sub=ro,o.subtract=If,o.symbolSize=wb,o.tileAABB=function(i,e,t,n,l,u,p,f,x){if(x.name==="globe")return iw(i,e,new Bd(t,n,l));const v=ja({z:t,x:n,y:l},x);return new sn([(u+v.x/v.scale)*e,e*(v.y/v.scale),p],[(u+v.x2/v.scale)*e,e*(v.y2/v.scale),f])},o.tileCornersToBounds=Gd,o.tileTransform=ja,o.transformMat3=function(i,e,t){var n=e[0],l=e[1],u=e[2];return i[0]=n*t[0]+l*t[3]+u*t[6],i[1]=n*t[1]+l*t[4]+u*t[7],i[2]=n*t[2]+l*t[5]+u*t[8],i},o.transformMat4=yr,o.transformMat4$1=Fa,o.transformQuat=Rg,o.transitionTileAABBinECEF=qy,o.translate=Tu,o.transpose=function(i,e){if(i===e){var t=e[1],n=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=n,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=k,o.uniqueId=At,o.updateGlobeVertexNormal=function(i,e,t,n,l){const u=5*e+2;i.float32[u+0]=t,i.float32[u+1]=n,i.float32[u+2]=l},o.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=i=>Jn(Es(i)),o.validateFog=i=>Jn(ed(i)),o.validateLayer=i=>Jn(Ml(i)),o.validateLight=i=>Jn(Kh(i)),o.validateSource=i=>Jn(Jh(i)),o.validateStyle=Pl,o.validateTerrain=i=>Jn(kl(i)),o.values=Et,o.vectorTile=Va,o.version=ce,o.warnOnce=Ai,o.window=P,o.wrap=We}),I(["./shared"],function(o){function P(ee){if(typeof ee=="number"||typeof ee=="boolean"||typeof ee=="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let j="[";for(const J of ee)j+=`${P(J)},`;return`${j}]`}let O="{";for(const j of Object.keys(ee).sort())O+=`${j}:${P(ee[j])},`;return`${O}}`}function V(ee){let O="";for(const j of o.refProperties)O+=`/${P(ee[j])}`;return O}class F{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,j){for(const re of O)this._layerConfigs[re.id]=re,(this._layers[re.id]=o.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of j)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const J=function(re,ge){const we={};for(let ye=0;ye<re.length;ye++){const Ee=ge&&ge[re[ye].id]||V(re[ye]);ge&&(ge[re[ye].id]=Ee);let Ve=we[Ee];Ve||(Ve=we[Ee]=[]),Ve.push(re[ye])}const Ae=[];for(const ye in we)Ae.push(we[ye]);return Ae}(o.values(this._layerConfigs),this.keyCache);for(const re of J){const ge=re.map(ht=>this._layers[ht.id]),we=ge[0];if(we.visibility==="none")continue;const Ae=we.source||"";let ye=this.familiesBySource[Ae];ye||(ye=this.familiesBySource[Ae]={});const Ee=we.sourceLayer||"_geojsonTileLayer";let Ve=ye[Ee];Ve||(Ve=ye[Ee]=[]),Ve.push(ge)}}}class R{loadTile(O,j){const{uid:J,encoding:re,rawImageData:ge,padding:we,buildQuadTree:Ae}=O,ye=o.window.ImageBitmap&&ge instanceof o.window.ImageBitmap?this.getImageData(ge,we):ge;j(null,new o.DEMData(J,ye,re,we<1,Ae))}getImageData(O,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const J=this.offscreenCanvasContext.getImageData(-j,-j,O.width+2*j,O.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var $=function ee(O,j){var J,re=O&&O.type;if(re==="FeatureCollection")for(J=0;J<O.features.length;J++)ee(O.features[J],j);else if(re==="GeometryCollection")for(J=0;J<O.geometries.length;J++)ee(O.geometries[J],j);else if(re==="Feature")ee(O.geometry,j);else if(re==="Polygon")ne(O.coordinates,j);else if(re==="MultiPolygon")for(J=0;J<O.coordinates.length;J++)ne(O.coordinates[J],j);return O};function ne(ee,O){if(ee.length!==0){oe(ee[0],O);for(var j=1;j<ee.length;j++)oe(ee[j],!O)}}function oe(ee,O){for(var j=0,J=0,re=0,ge=ee.length,we=ge-1;re<ge;we=re++){var Ae=(ee[re][0]-ee[we][0])*(ee[we][1]+ee[re][1]),ye=j+Ae;J+=Math.abs(j)>=Math.abs(Ae)?j-ye+Ae:Ae-ye+j,j=ye}j+J>=0!=!!O&&ee.reverse()}const ve=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ie{constructor(O){this._feature=O,this.extent=o.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(this._feature.type===1){const O=[];for(const j of this._feature.geometry)O.push([new o.pointGeometry(j[0],j[1])]);return O}{const O=[];for(const j of this._feature.geometry){const J=[];for(const re of j)J.push(new o.pointGeometry(re[0],re[1]));O.push(J)}return O}}toGeoJSON(O,j,J){return ve.call(this,O,j,J)}}class Ge{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=O.length,this._features=O}feature(O){return new Ie(this._features[O])}}var Ze=o.vectorTile.VectorTileFeature,st=ft;function ft(ee,O){this.options=O||{},this.features=ee,this.length=ee.length}function He(ee,O){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=O||4096}ft.prototype.feature=function(ee){return new He(this.features[ee],this.options.extent)},He.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var O=0;O<ee.length;O++){for(var j=ee[O],J=[],re=0;re<j.length;re++)J.push(new o.pointGeometry(j[re][0],j[re][1]));this.geometry.push(J)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,O=1/0,j=-1/0,J=1/0,re=-1/0,ge=0;ge<ee.length;ge++)for(var we=ee[ge],Ae=0;Ae<we.length;Ae++){var ye=we[Ae];O=Math.min(O,ye.x),j=Math.max(j,ye.x),J=Math.min(J,ye.y),re=Math.max(re,ye.y)}return[O,J,j,re]},He.prototype.toGeoJSON=Ze.prototype.toGeoJSON;var yt=xt,We=st;function xt(ee){var O=new o.pbf;return function(j,J){for(var re in j.layers)J.writeMessage(3,Et,j.layers[re])}(ee,O),O.finish()}function Et(ee,O){var j;O.writeVarintField(15,ee.version||1),O.writeStringField(1,ee.name||""),O.writeVarintField(5,ee.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ee.length;j++)J.feature=ee.feature(j),O.writeMessage(2,gt,J);var re=J.keys;for(j=0;j<re.length;j++)O.writeStringField(3,re[j]);var ge=J.values;for(j=0;j<ge.length;j++)O.writeMessage(4,Er,ge[j])}function gt(ee,O){var j=ee.feature;j.id!==void 0&&O.writeVarintField(1,j.id),O.writeMessage(2,Ft,ee),O.writeVarintField(3,j.type),O.writeMessage(4,ri,j)}function Ft(ee,O){var j=ee.feature,J=ee.keys,re=ee.values,ge=ee.keycache,we=ee.valuecache;for(var Ae in j.properties){var ye=j.properties[Ae],Ee=ge[Ae];if(ye!==null){Ee===void 0&&(J.push(Ae),ge[Ae]=Ee=J.length-1),O.writeVarint(Ee);var Ve=typeof ye;Ve!=="string"&&Ve!=="boolean"&&Ve!=="number"&&(ye=JSON.stringify(ye));var ht=Ve+":"+ye,qe=we[ht];qe===void 0&&(re.push(ye),we[ht]=qe=re.length-1),O.writeVarint(qe)}}}function At(ee,O){return(O<<3)+(7&ee)}function ei(ee){return ee<<1^ee>>31}function ri(ee,O){for(var j=ee.loadGeometry(),J=ee.type,re=0,ge=0,we=j.length,Ae=0;Ae<we;Ae++){var ye=j[Ae],Ee=1;J===1&&(Ee=ye.length),O.writeVarint(At(1,Ee));for(var Ve=J===3?ye.length-1:ye.length,ht=0;ht<Ve;ht++){ht===1&&J!==1&&O.writeVarint(At(2,Ve-1));var qe=ye[ht].x-re,Lt=ye[ht].y-ge;O.writeVarint(ei(qe)),O.writeVarint(ei(Lt)),re+=qe,ge+=Lt}J===3&&O.writeVarint(At(7,1))}}function Er(ee,O){var j=typeof ee;j==="string"?O.writeStringField(1,ee):j==="boolean"?O.writeBooleanField(7,ee):j==="number"&&(ee%1!=0?O.writeDoubleField(3,ee):ee<0?O.writeSVarintField(6,ee):O.writeVarintField(5,ee))}function vi(ee,O,j,J,re,ge){if(re-J<=j)return;const we=J+re>>1;fi(ee,O,we,J,re,ge%2),vi(ee,O,j,J,we-1,ge+1),vi(ee,O,j,we+1,re,ge+1)}function fi(ee,O,j,J,re,ge){for(;re>J;){if(re-J>600){const Ee=re-J+1,Ve=j-J+1,ht=Math.log(Ee),qe=.5*Math.exp(2*ht/3),Lt=.5*Math.sqrt(ht*qe*(Ee-qe)/Ee)*(Ve-Ee/2<0?-1:1);fi(ee,O,j,Math.max(J,Math.floor(j-Ve*qe/Ee+Lt)),Math.min(re,Math.floor(j+(Ee-Ve)*qe/Ee+Lt)),ge)}const we=O[2*j+ge];let Ae=J,ye=re;for(Bt(ee,O,J,j),O[2*re+ge]>we&&Bt(ee,O,J,re);Ae<ye;){for(Bt(ee,O,Ae,ye),Ae++,ye--;O[2*Ae+ge]<we;)Ae++;for(;O[2*ye+ge]>we;)ye--}O[2*J+ge]===we?Bt(ee,O,J,ye):(ye++,Bt(ee,O,ye,re)),ye<=j&&(J=ye+1),j<=ye&&(re=ye-1)}}function Bt(ee,O,j,J){$i(ee,j,J),$i(O,2*j,2*J),$i(O,2*j+1,2*J+1)}function $i(ee,O,j){const J=ee[O];ee[O]=ee[j],ee[j]=J}function lr(ee,O,j,J){const re=ee-j,ge=O-J;return re*re+ge*ge}yt.fromVectorTileJs=xt,yt.fromGeojsonVt=function(ee,O){O=O||{};var j={};for(var J in ee)j[J]=new st(ee[J].features,O),j[J].name=J,j[J].version=O.version,j[J].extent=O.extent;return xt({layers:j})},yt.GeoJSONWrapper=We;const Ur=ee=>ee[0],Ai=ee=>ee[1];class Oi{constructor(O,j=Ur,J=Ai,re=64,ge=Float64Array){this.nodeSize=re,this.points=O;const we=O.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new we(O.length),ye=this.coords=new ge(2*O.length);for(let Ee=0;Ee<O.length;Ee++)Ae[Ee]=Ee,ye[2*Ee]=j(O[Ee]),ye[2*Ee+1]=J(O[Ee]);vi(Ae,ye,re,0,Ae.length-1,0)}range(O,j,J,re){return function(ge,we,Ae,ye,Ee,Ve,ht){const qe=[0,ge.length-1,0],Lt=[];let Ot,It;for(;qe.length;){const Ut=qe.pop(),Jt=qe.pop(),Ii=qe.pop();if(Jt-Ii<=ht){for(let Pt=Ii;Pt<=Jt;Pt++)Ot=we[2*Pt],It=we[2*Pt+1],Ot>=Ae&&Ot<=Ee&&It>=ye&&It<=Ve&&Lt.push(ge[Pt]);continue}const Pi=Math.floor((Ii+Jt)/2);Ot=we[2*Pi],It=we[2*Pi+1],Ot>=Ae&&Ot<=Ee&&It>=ye&&It<=Ve&&Lt.push(ge[Pi]);const Ci=(Ut+1)%2;(Ut===0?Ae<=Ot:ye<=It)&&(qe.push(Ii),qe.push(Pi-1),qe.push(Ci)),(Ut===0?Ee>=Ot:Ve>=It)&&(qe.push(Pi+1),qe.push(Jt),qe.push(Ci))}return Lt}(this.ids,this.coords,O,j,J,re,this.nodeSize)}within(O,j,J){return function(re,ge,we,Ae,ye,Ee){const Ve=[0,re.length-1,0],ht=[],qe=ye*ye;for(;Ve.length;){const Lt=Ve.pop(),Ot=Ve.pop(),It=Ve.pop();if(Ot-It<=Ee){for(let Ci=It;Ci<=Ot;Ci++)lr(ge[2*Ci],ge[2*Ci+1],we,Ae)<=qe&&ht.push(re[Ci]);continue}const Ut=Math.floor((It+Ot)/2),Jt=ge[2*Ut],Ii=ge[2*Ut+1];lr(Jt,Ii,we,Ae)<=qe&&ht.push(re[Ut]);const Pi=(Lt+1)%2;(Lt===0?we-ye<=Jt:Ae-ye<=Ii)&&(Ve.push(It),Ve.push(Ut-1),Ve.push(Pi)),(Lt===0?we+ye>=Jt:Ae+ye>=Ii)&&(Ve.push(Ut+1),Ve.push(Ot),Ve.push(Pi))}return ht}(this.ids,this.coords,O,j,J,this.nodeSize)}}const tn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},$e=Math.fround||(Tt=new Float32Array(1),ee=>(Tt[0]=+ee,Tt[0]));var Tt;class ut{constructor(O){this.options=ke(Object.create(tn),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:j,minZoom:J,maxZoom:re,nodeSize:ge}=this.options;j&&console.time("total time");const we=`prepare ${O.length} points`;j&&console.time(we),this.points=O;let Ae=[];for(let ye=0;ye<O.length;ye++)O[ye].geometry&&Ae.push(Ei(O[ye],ye));this.trees[re+1]=new Oi(Ae,Qe,Xe,ge,Float32Array),j&&console.timeEnd(we);for(let ye=re;ye>=J;ye--){const Ee=+Date.now();Ae=this._cluster(Ae,ye),this.trees[ye]=new Oi(Ae,Qe,Xe,ge,Float32Array),j&&console.log("z%d: %d clusters in %dms",ye,Ae.length,+Date.now()-Ee)}return j&&console.timeEnd("total time"),this}getClusters(O,j){let J=((O[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,O[1]));let ge=O[2]===180?180:((O[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)J=-180,ge=180;else if(J>ge){const Ve=this.getClusters([J,re,180,we],j),ht=this.getClusters([-180,re,ge,we],j);return Ve.concat(ht)}const Ae=this.trees[this._limitZoom(j)],ye=Ae.range(qt(J),ce(we),qt(ge),ce(re)),Ee=[];for(const Ve of ye){const ht=Ae.points[Ve];Ee.push(ht.numPoints?yi(ht):this.points[ht.index])}return Ee}getChildren(O){const j=this._getOriginId(O),J=this._getOriginZoom(O),re="No cluster with the specified id.",ge=this.trees[J];if(!ge)throw new Error(re);const we=ge.points[j];if(!we)throw new Error(re);const Ae=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ye=ge.within(we.x,we.y,Ae),Ee=[];for(const Ve of ye){const ht=ge.points[Ve];ht.parentId===O&&Ee.push(ht.numPoints?yi(ht):this.points[ht.index])}if(Ee.length===0)throw new Error(re);return Ee}getLeaves(O,j,J){const re=[];return this._appendLeaves(re,O,j=j||10,J=J||0,0),re}getTile(O,j,J){const re=this.trees[this._limitZoom(O)],ge=Math.pow(2,O),{extent:we,radius:Ae}=this.options,ye=Ae/we,Ee=(J-ye)/ge,Ve=(J+1+ye)/ge,ht={features:[]};return this._addTileFeatures(re.range((j-ye)/ge,Ee,(j+1+ye)/ge,Ve),re.points,j,J,ge,ht),j===0&&this._addTileFeatures(re.range(1-ye/ge,Ee,1,Ve),re.points,ge,J,ge,ht),j===ge-1&&this._addTileFeatures(re.range(0,Ee,ye/ge,Ve),re.points,-1,J,ge,ht),ht.features.length?ht:null}getClusterExpansionZoom(O){let j=this._getOriginZoom(O)-1;for(;j<=this.options.maxZoom;){const J=this.getChildren(O);if(j++,J.length!==1)break;O=J[0].properties.cluster_id}return j}_appendLeaves(O,j,J,re,ge){const we=this.getChildren(j);for(const Ae of we){const ye=Ae.properties;if(ye&&ye.cluster?ge+ye.point_count<=re?ge+=ye.point_count:ge=this._appendLeaves(O,ye.cluster_id,J,re,ge):ge<re?ge++:O.push(Ae),O.length===J)break}return ge}_addTileFeatures(O,j,J,re,ge,we){for(const Ae of O){const ye=j[Ae],Ee=ye.numPoints;let Ve,ht,qe;if(Ee)Ve=ni(ye),ht=ye.x,qe=ye.y;else{const It=this.points[ye.index];Ve=It.properties,ht=qt(It.geometry.coordinates[0]),qe=ce(It.geometry.coordinates[1])}const Lt={type:1,geometry:[[Math.round(this.options.extent*(ht*ge-J)),Math.round(this.options.extent*(qe*ge-re))]],tags:Ve};let Ot;Ee?Ot=ye.id:this.options.generateId?Ot=ye.index:this.points[ye.index].id&&(Ot=this.points[ye.index].id),Ot!==void 0&&(Lt.id=Ot),we.features.push(Lt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,j){const J=[],{radius:re,extent:ge,reduce:we,minPoints:Ae}=this.options,ye=re/(ge*Math.pow(2,j));for(let Ee=0;Ee<O.length;Ee++){const Ve=O[Ee];if(Ve.zoom<=j)continue;Ve.zoom=j;const ht=this.trees[j+1],qe=ht.within(Ve.x,Ve.y,ye),Lt=Ve.numPoints||1;let Ot=Lt;for(const It of qe){const Ut=ht.points[It];Ut.zoom>j&&(Ot+=Ut.numPoints||1)}if(Ot>Lt&&Ot>=Ae){let It=Ve.x*Lt,Ut=Ve.y*Lt,Jt=we&&Lt>1?this._map(Ve,!0):null;const Ii=(Ee<<5)+(j+1)+this.points.length;for(const Pi of qe){const Ci=ht.points[Pi];if(Ci.zoom<=j)continue;Ci.zoom=j;const Pt=Ci.numPoints||1;It+=Ci.x*Pt,Ut+=Ci.y*Pt,Ci.parentId=Ii,we&&(Jt||(Jt=this._map(Ve,!0)),we(Jt,this._map(Ci)))}Ve.parentId=Ii,J.push(kt(It/Ot,Ut/Ot,Ii,Ot,Jt))}else if(J.push(Ve),Ot>1)for(const It of qe){const Ut=ht.points[It];Ut.zoom<=j||(Ut.zoom=j,J.push(Ut))}}return J}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,j){if(O.numPoints)return j?ke({},O.properties):O.properties;const J=this.points[O.index].properties,re=this.options.map(J);return j&&re===J?ke({},re):re}}function kt(ee,O,j,J,re){return{x:$e(ee),y:$e(O),zoom:1/0,id:j,parentId:-1,numPoints:J,properties:re}}function Ei(ee,O){const[j,J]=ee.geometry.coordinates;return{x:$e(qt(j)),y:$e(ce(J)),zoom:1/0,index:O,parentId:-1}}function yi(ee){return{type:"Feature",id:ee.id,properties:ni(ee),geometry:{type:"Point",coordinates:[(O=ee.x,360*(O-.5)),_e(ee.y)]}};var O}function ni(ee){const O=ee.numPoints,j=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return ke(ke({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:O,point_count_abbreviated:j})}function qt(ee){return ee/360+.5}function ce(ee){const O=Math.sin(ee*Math.PI/180),j=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return j<0?0:j>1?1:j}function _e(ee){const O=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function ke(ee,O){for(const j in O)ee[j]=O[j];return ee}function Qe(ee){return ee.x}function Xe(ee){return ee.y}function rt(ee,O,j,J){for(var re,ge=J,we=j-O>>1,Ae=j-O,ye=ee[O],Ee=ee[O+1],Ve=ee[j],ht=ee[j+1],qe=O+3;qe<j;qe+=3){var Lt=vt(ee[qe],ee[qe+1],ye,Ee,Ve,ht);if(Lt>ge)re=qe,ge=Lt;else if(Lt===ge){var Ot=Math.abs(qe-we);Ot<Ae&&(re=qe,Ae=Ot)}}ge>J&&(re-O>3&&rt(ee,O,re,J),ee[re+2]=ge,j-re>3&&rt(ee,re,j,J))}function vt(ee,O,j,J,re,ge){var we=re-j,Ae=ge-J;if(we!==0||Ae!==0){var ye=((ee-j)*we+(O-J)*Ae)/(we*we+Ae*Ae);ye>1?(j=re,J=ge):ye>0&&(j+=we*ye,J+=Ae*ye)}return(we=ee-j)*we+(Ae=O-J)*Ae}function Ue(ee,O,j,J){var re={id:ee===void 0?null:ee,type:O,geometry:j,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var we=ge.geometry,Ae=ge.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")lt(ge,we);else if(Ae==="Polygon"||Ae==="MultiLineString")for(var ye=0;ye<we.length;ye++)lt(ge,we[ye]);else if(Ae==="MultiPolygon")for(ye=0;ye<we.length;ye++)for(var Ee=0;Ee<we[ye].length;Ee++)lt(ge,we[ye][Ee])}(re),re}function lt(ee,O){for(var j=0;j<O.length;j+=3)ee.minX=Math.min(ee.minX,O[j]),ee.minY=Math.min(ee.minY,O[j+1]),ee.maxX=Math.max(ee.maxX,O[j]),ee.maxY=Math.max(ee.maxY,O[j+1])}function tt(ee,O,j,J){if(O.geometry){var re=O.geometry.coordinates,ge=O.geometry.type,we=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),Ae=[],ye=O.id;if(j.promoteId?ye=O.properties[j.promoteId]:j.generateId&&(ye=J||0),ge==="Point")zt(re,Ae);else if(ge==="MultiPoint")for(var Ee=0;Ee<re.length;Ee++)zt(re[Ee],Ae);else if(ge==="LineString")St(re,Ae,we,!1);else if(ge==="MultiLineString"){if(j.lineMetrics){for(Ee=0;Ee<re.length;Ee++)St(re[Ee],Ae=[],we,!1),ee.push(Ue(ye,"LineString",Ae,O.properties));return}Rt(re,Ae,we,!1)}else if(ge==="Polygon")Rt(re,Ae,we,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Ee=0;Ee<O.geometry.geometries.length;Ee++)tt(ee,{id:ye,geometry:O.geometry.geometries[Ee],properties:O.properties},j,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ee=0;Ee<re.length;Ee++){var Ve=[];Rt(re[Ee],Ve,we,!0),Ae.push(Ve)}}ee.push(Ue(ye,ge,Ae,O.properties))}}function zt(ee,O){O.push(Gt(ee[0])),O.push(li(ee[1])),O.push(0)}function St(ee,O,j,J){for(var re,ge,we=0,Ae=0;Ae<ee.length;Ae++){var ye=Gt(ee[Ae][0]),Ee=li(ee[Ae][1]);O.push(ye),O.push(Ee),O.push(0),Ae>0&&(we+=J?(re*Ee-ye*ge)/2:Math.sqrt(Math.pow(ye-re,2)+Math.pow(Ee-ge,2))),re=ye,ge=Ee}var Ve=O.length-3;O[2]=1,rt(O,0,Ve,j),O[Ve+2]=1,O.size=Math.abs(we),O.start=0,O.end=O.size}function Rt(ee,O,j,J){for(var re=0;re<ee.length;re++){var ge=[];St(ee[re],ge,j,J),O.push(ge)}}function Gt(ee){return ee/360+.5}function li(ee){var O=Math.sin(ee*Math.PI/180),j=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return j<0?0:j>1?1:j}function di(ee,O,j,J,re,ge,we,Ae){if(J/=O,ge>=(j/=O)&&we<J)return ee;if(we<j||ge>=J)return null;for(var ye=[],Ee=0;Ee<ee.length;Ee++){var Ve=ee[Ee],ht=Ve.geometry,qe=Ve.type,Lt=re===0?Ve.minX:Ve.minY,Ot=re===0?Ve.maxX:Ve.maxY;if(Lt>=j&&Ot<J)ye.push(Ve);else if(!(Ot<j||Lt>=J)){var It=[];if(qe==="Point"||qe==="MultiPoint")pi(ht,It,j,J,re);else if(qe==="LineString")Ti(ht,It,j,J,re,!1,Ae.lineMetrics);else if(qe==="MultiLineString")fr(ht,It,j,J,re,!1);else if(qe==="Polygon")fr(ht,It,j,J,re,!0);else if(qe==="MultiPolygon")for(var Ut=0;Ut<ht.length;Ut++){var Jt=[];fr(ht[Ut],Jt,j,J,re,!0),Jt.length&&It.push(Jt)}if(It.length){if(Ae.lineMetrics&&qe==="LineString"){for(Ut=0;Ut<It.length;Ut++)ye.push(Ue(Ve.id,qe,It[Ut],Ve.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(It.length===1?(qe="LineString",It=It[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=It.length===3?"Point":"MultiPoint"),ye.push(Ue(Ve.id,qe,It,Ve.tags))}}}return ye.length?ye:null}function pi(ee,O,j,J,re){for(var ge=0;ge<ee.length;ge+=3){var we=ee[ge+re];we>=j&&we<=J&&(O.push(ee[ge]),O.push(ee[ge+1]),O.push(ee[ge+2]))}}function Ti(ee,O,j,J,re,ge,we){for(var Ae,ye,Ee=zr(ee),Ve=re===0?Un:ho,ht=ee.start,qe=0;qe<ee.length-3;qe+=3){var Lt=ee[qe],Ot=ee[qe+1],It=ee[qe+2],Ut=ee[qe+3],Jt=ee[qe+4],Ii=re===0?Lt:Ot,Pi=re===0?Ut:Jt,Ci=!1;we&&(Ae=Math.sqrt(Math.pow(Lt-Ut,2)+Math.pow(Ot-Jt,2))),Ii<j?Pi>j&&(ye=Ve(Ee,Lt,Ot,Ut,Jt,j),we&&(Ee.start=ht+Ae*ye)):Ii>J?Pi<J&&(ye=Ve(Ee,Lt,Ot,Ut,Jt,J),we&&(Ee.start=ht+Ae*ye)):hn(Ee,Lt,Ot,It),Pi<j&&Ii>=j&&(ye=Ve(Ee,Lt,Ot,Ut,Jt,j),Ci=!0),Pi>J&&Ii<=J&&(ye=Ve(Ee,Lt,Ot,Ut,Jt,J),Ci=!0),!ge&&Ci&&(we&&(Ee.end=ht+Ae*ye),O.push(Ee),Ee=zr(ee)),we&&(ht+=Ae)}var Pt=ee.length-3;Lt=ee[Pt],Ot=ee[Pt+1],It=ee[Pt+2],(Ii=re===0?Lt:Ot)>=j&&Ii<=J&&hn(Ee,Lt,Ot,It),Pt=Ee.length-3,ge&&Pt>=3&&(Ee[Pt]!==Ee[0]||Ee[Pt+1]!==Ee[1])&&hn(Ee,Ee[0],Ee[1],Ee[2]),Ee.length&&O.push(Ee)}function zr(ee){var O=[];return O.size=ee.size,O.start=ee.start,O.end=ee.end,O}function fr(ee,O,j,J,re,ge){for(var we=0;we<ee.length;we++)Ti(ee[we],O,j,J,re,ge,!1)}function hn(ee,O,j,J){ee.push(O),ee.push(j),ee.push(J)}function Un(ee,O,j,J,re,ge){var we=(ge-O)/(J-O);return ee.push(ge),ee.push(j+(re-j)*we),ee.push(1),we}function ho(ee,O,j,J,re,ge){var we=(ge-j)/(re-j);return ee.push(O+(J-O)*we),ee.push(ge),ee.push(1),we}function gr(ee,O){for(var j=[],J=0;J<ee.length;J++){var re,ge=ee[J],we=ge.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")re=kr(ge.geometry,O);else if(we==="MultiLineString"||we==="Polygon"){re=[];for(var Ae=0;Ae<ge.geometry.length;Ae++)re.push(kr(ge.geometry[Ae],O))}else if(we==="MultiPolygon")for(re=[],Ae=0;Ae<ge.geometry.length;Ae++){for(var ye=[],Ee=0;Ee<ge.geometry[Ae].length;Ee++)ye.push(kr(ge.geometry[Ae][Ee],O));re.push(ye)}j.push(Ue(ge.id,we,re,ge.tags))}return j}function kr(ee,O){var j=[];j.size=ee.size,ee.start!==void 0&&(j.start=ee.start,j.end=ee.end);for(var J=0;J<ee.length;J+=3)j.push(ee[J]+O,ee[J+1],ee[J+2]);return j}function po(ee,O){if(ee.transformed)return ee;var j,J,re,ge=1<<ee.z,we=ee.x,Ae=ee.y;for(j=0;j<ee.features.length;j++){var ye=ee.features[j],Ee=ye.geometry,Ve=ye.type;if(ye.geometry=[],Ve===1)for(J=0;J<Ee.length;J+=2)ye.geometry.push(il(Ee[J],Ee[J+1],O,ge,we,Ae));else for(J=0;J<Ee.length;J++){var ht=[];for(re=0;re<Ee[J].length;re+=2)ht.push(il(Ee[J][re],Ee[J][re+1],O,ge,we,Ae));ye.geometry.push(ht)}}return ee.transformed=!0,ee}function il(ee,O,j,J,re,ge){return[Math.round(j*(ee*J-re)),Math.round(j*(O*J-ge))]}function rl(ee,O,j,J,re){for(var ge=O===re.maxZoom?0:re.tolerance/((1<<O)*re.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:J,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<ee.length;Ae++){we.numFeatures++,Tc(we,ee[Ae],ge,re);var ye=ee[Ae].minX,Ee=ee[Ae].minY,Ve=ee[Ae].maxX,ht=ee[Ae].maxY;ye<we.minX&&(we.minX=ye),Ee<we.minY&&(we.minY=Ee),Ve>we.maxX&&(we.maxX=Ve),ht>we.maxY&&(we.maxY=ht)}return we}function Tc(ee,O,j,J){var re=O.geometry,ge=O.type,we=[];if(ge==="Point"||ge==="MultiPoint")for(var Ae=0;Ae<re.length;Ae+=3)we.push(re[Ae]),we.push(re[Ae+1]),ee.numPoints++,ee.numSimplified++;else if(ge==="LineString")fo(we,re,ee,j,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ae=0;Ae<re.length;Ae++)fo(we,re[Ae],ee,j,ge==="Polygon",Ae===0);else if(ge==="MultiPolygon")for(var ye=0;ye<re.length;ye++){var Ee=re[ye];for(Ae=0;Ae<Ee.length;Ae++)fo(we,Ee[Ae],ee,j,!0,Ae===0)}if(we.length){var Ve=O.tags||null;if(ge==="LineString"&&J.lineMetrics){for(var ht in Ve={},O.tags)Ve[ht]=O.tags[ht];Ve.mapbox_clip_start=re.start/re.size,Ve.mapbox_clip_end=re.end/re.size}var qe={geometry:we,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Ve};O.id!==null&&(qe.id=O.id),ee.features.push(qe)}}function fo(ee,O,j,J,re,ge){var we=J*J;if(J>0&&O.size<(re?we:J))j.numPoints+=O.length/3;else{for(var Ae=[],ye=0;ye<O.length;ye+=3)(J===0||O[ye+2]>we)&&(j.numSimplified++,Ae.push(O[ye]),Ae.push(O[ye+1])),j.numPoints++;re&&function(Ee,Ve){for(var ht=0,qe=0,Lt=Ee.length,Ot=Lt-2;qe<Lt;Ot=qe,qe+=2)ht+=(Ee[qe]-Ee[Ot])*(Ee[qe+1]+Ee[Ot+1]);if(ht>0===Ve)for(qe=0,Lt=Ee.length;qe<Lt/2;qe+=2){var It=Ee[qe],Ut=Ee[qe+1];Ee[qe]=Ee[Lt-2-qe],Ee[qe+1]=Ee[Lt-1-qe],Ee[Lt-2-qe]=It,Ee[Lt-1-qe]=Ut}}(Ae,ge),ee.push(Ae)}}function Hn(ee,O){var j=(O=this.options=function(re,ge){for(var we in ge)re[we]=ge[we];return re}(Object.create(this.options),O)).debug;if(j&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(re,ge){var we=[];if(re.type==="FeatureCollection")for(var Ae=0;Ae<re.features.length;Ae++)tt(we,re.features[Ae],ge,Ae);else tt(we,re.type==="Feature"?re:{geometry:re},ge);return we}(ee,O);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=function(re,ge){var we=ge.buffer/ge.extent,Ae=re,ye=di(re,1,-1-we,we,0,-1,2,ge),Ee=di(re,1,1-we,2+we,0,-1,2,ge);return(ye||Ee)&&(Ae=di(re,1,-we,1+we,0,-1,2,ge)||[],ye&&(Ae=gr(ye,1).concat(Ae)),Ee&&(Ae=Ae.concat(gr(Ee,-1)))),Ae}(J,O)).length&&this.splitTile(J,0,0,0),j&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function us(ee,O,j){return 32*((1<<ee)*j+O)+ee}function nl(ee,O){const j=ee.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const J=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!J)return O(null,null);const re=new Ge(J.features);let ge=yt(re);ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),O(null,{vectorTile:re,rawData:ge.buffer})}Hn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hn.prototype.splitTile=function(ee,O,j,J,re,ge,we){for(var Ae=[ee,O,j,J],ye=this.options,Ee=ye.debug;Ae.length;){J=Ae.pop(),j=Ae.pop(),O=Ae.pop(),ee=Ae.pop();var Ve=1<<O,ht=us(O,j,J),qe=this.tiles[ht];if(!qe&&(Ee>1&&console.time("creation"),qe=this.tiles[ht]=rl(ee,O,j,J,ye),this.tileCoords.push({z:O,x:j,y:J}),Ee)){Ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,j,J,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));var Lt="z"+O;this.stats[Lt]=(this.stats[Lt]||0)+1,this.total++}if(qe.source=ee,re){if(O===ye.maxZoom||O===re)continue;var Ot=1<<re-O;if(j!==Math.floor(ge/Ot)||J!==Math.floor(we/Ot))continue}else if(O===ye.indexMaxZoom||qe.numPoints<=ye.indexMaxPoints)continue;if(qe.source=null,ee.length!==0){Ee>1&&console.time("clipping");var It,Ut,Jt,Ii,Pi,Ci,Pt=.5*ye.buffer/ye.extent,Pe=.5-Pt,rn=.5+Pt,rr=1+Pt;It=Ut=Jt=Ii=null,Pi=di(ee,Ve,j-Pt,j+rn,0,qe.minX,qe.maxX,ye),Ci=di(ee,Ve,j+Pe,j+rr,0,qe.minX,qe.maxX,ye),ee=null,Pi&&(It=di(Pi,Ve,J-Pt,J+rn,1,qe.minY,qe.maxY,ye),Ut=di(Pi,Ve,J+Pe,J+rr,1,qe.minY,qe.maxY,ye),Pi=null),Ci&&(Jt=di(Ci,Ve,J-Pt,J+rn,1,qe.minY,qe.maxY,ye),Ii=di(Ci,Ve,J+Pe,J+rr,1,qe.minY,qe.maxY,ye),Ci=null),Ee>1&&console.timeEnd("clipping"),Ae.push(It||[],O+1,2*j,2*J),Ae.push(Ut||[],O+1,2*j,2*J+1),Ae.push(Jt||[],O+1,2*j+1,2*J),Ae.push(Ii||[],O+1,2*j+1,2*J+1)}}},Hn.prototype.getTile=function(ee,O,j){var J=this.options,re=J.extent,ge=J.debug;if(ee<0||ee>24)return null;var we=1<<ee,Ae=us(ee,O=(O%we+we)%we,j);if(this.tiles[Ae])return po(this.tiles[Ae],re);ge>1&&console.log("drilling down to z%d-%d-%d",ee,O,j);for(var ye,Ee=ee,Ve=O,ht=j;!ye&&Ee>0;)Ee--,Ve=Math.floor(Ve/2),ht=Math.floor(ht/2),ye=this.tiles[us(Ee,Ve,ht)];return ye&&ye.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Ee,Ve,ht),ge>1&&console.time("drilling down"),this.splitTile(ye.source,Ee,Ve,ht,ee,O,j),ge>1&&console.timeEnd("drilling down"),this.tiles[Ae]?po(this.tiles[Ae],re):null):null};class qr extends o.VectorTileWorkerSource{constructor(O,j,J,re,ge){super(O,j,J,re,nl),ge&&(this.loadGeoJSON=ge)}loadData(O,j){const J=O&&O.request,re=J&&J.collectResourceTiming;this.loadGeoJSON(O,(ge,we)=>{if(ge||!we)return j(ge);if(typeof we!="object")return j(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{$(we,!0);try{if(O.filter){const ye=o.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));const Ee=we.features.filter(Ve=>ye.value.evaluate({zoom:0},Ve));we={type:"FeatureCollection",features:Ee}}this._geoJSONIndex=O.cluster?new ut(function({superclusterOptions:ye,clusterProperties:Ee}){if(!Ee||!ye)return ye;const Ve={},ht={},qe={accumulated:null,zoom:0},Lt={properties:null},Ot=Object.keys(Ee);for(const It of Ot){const[Ut,Jt]=Ee[It],Ii=o.createExpression(Jt),Pi=o.createExpression(typeof Ut=="string"?[Ut,["accumulated"],["get",It]]:Ut);Ve[It]=Ii.value,ht[It]=Pi.value}return ye.map=It=>{Lt.properties=It;const Ut={};for(const Jt of Ot)Ut[Jt]=Ve[Jt].evaluate(qe,Lt);return Ut},ye.reduce=(It,Ut)=>{Lt.properties=Ut;for(const Jt of Ot)qe.accumulated=It[Jt],It[Jt]=ht[Jt].evaluate(qe,Lt)},ye}(O)).load(we.features):function(ye,Ee){return new Hn(ye,Ee)}(we,O.geojsonVtOptions)}catch(ye){return j(ye)}this.loaded={};const Ae={};if(re){const ye=o.getPerformanceMeasurement(J);ye&&(Ae.resourceTiming={},Ae.resourceTiming[O.source]=JSON.parse(JSON.stringify(ye)))}j(null,Ae)}})}reloadTile(O,j){const J=this.loaded;return J&&J[O.uid]?super.reloadTile(O,j):this.loadTile(O,j)}loadGeoJSON(O,j){if(O.request)o.getJSON(O.request,j);else{if(typeof O.data!="string")return j(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(O.data))}catch{return j(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(J){j(J)}}getClusterChildren(O,j){try{j(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(J){j(J)}}getClusterLeaves(O,j){try{j(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(J){j(J)}}}class ra{constructor(O){this.self=O,this.actor=new o.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:qr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,J)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=J},this.self.registerRTLTextPlugin=j=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=j.applyArabicShaping,o.plugin.processBidirectionalText=j.processBidirectionalText,o.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(O,j,J){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],J()}checkIfReady(O,j,J){J()}setReferrer(O,j){this.referrer=j}spriteLoaded(O,j){this.isSpriteLoaded[O]=j;for(const J in this.workerSources[O]){const re=this.workerSources[O][J];for(const ge in re)re[ge]instanceof o.VectorTileWorkerSource&&(re[ge].isSpriteLoaded=j,re[ge].fire(new o.Event("isSpriteLoaded")))}}setImages(O,j,J){this.availableImages[O]=j;for(const re in this.workerSources[O]){const ge=this.workerSources[O][re];for(const we in ge)ge[we].availableImages=j}J()}enableTerrain(O,j,J){this.terrain=j,J()}setProjection(O,j){this.projections[O]=o.getProjection(j)}setLayers(O,j,J){this.getLayerIndex(O).replace(j),J()}updateLayers(O,j,J){this.getLayerIndex(O).update(j.layers,j.removedIds),J()}loadTile(O,j,J){const re=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,j.type,j.source).loadTile(re,J)}loadDEMTile(O,j,J){const re=this.enableTerrain?o.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(O,j.source).loadTile(re,J)}reloadTile(O,j,J){const re=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,j.type,j.source).reloadTile(re,J)}abortTile(O,j,J){this.getWorkerSource(O,j.type,j.source).abortTile(j,J)}removeTile(O,j,J){this.getWorkerSource(O,j.type,j.source).removeTile(j,J)}removeSource(O,j,J){if(!this.workerSources[O]||!this.workerSources[O][j.type]||!this.workerSources[O][j.type][j.source])return;const re=this.workerSources[O][j.type][j.source];delete this.workerSources[O][j.type][j.source],re.removeSource!==void 0?re.removeSource(j,J):J()}loadWorkerSource(O,j,J){try{this.self.importScripts(j.url),J()}catch(re){J(re.toString())}}syncRTLPluginState(O,j,J){try{o.plugin.setState(j);const re=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&re!=null){this.self.importScripts(re);const ge=o.plugin.isParsed();J(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),ge)}}catch(re){J(re.toString())}}getAvailableImages(O){let j=this.availableImages[O];return j||(j=[]),j}getLayerIndex(O){let j=this.layerIndexes[O];return j||(j=this.layerIndexes[O]=new F),j}getWorkerSource(O,j,J){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][j]||(this.workerSources[O][j]={}),this.workerSources[O][j][J]||(this.workerSources[O][j][J]=new this.workerSourceTypes[j]({send:(re,ge,we,Ae,ye,Ee)=>{this.actor.send(re,ge,we,O,ye,Ee)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][j][J]}getDEMWorkerSource(O,j){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][j]||(this.demWorkerSources[O][j]=new R),this.demWorkerSources[O][j]}enforceCacheSizeLimit(O,j){o.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(O,j,J){J(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ra(self)),ra}),I(["./shared"],function(o){function P(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(!P(c[s],r[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const s in c)if(!P(c[s],r[s]))return!1;return!0}return c===r}var V=F;function F(c){return!function(r){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{m=new Worker(b),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(b),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===h.width}()?(R[s=r&&r.failIfMajorPerformanceCaveat]===void 0&&(R[s]=function(h){var m,y=function(b){var E=document.createElement("canvas"),S=Object.create(F.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=b,E.getContext("webgl",S)||E.getContext("experimental-webgl",S)}(h);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(s)),R[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(c)}var R={};function $(c,r,s){const h=o.window.document.createElement(c);return r!==void 0&&(h.className=r),s&&s.appendChild(h),h}function ne(c,r,s){const h=o.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const m of Object.keys(r))h.setAttributeNS(null,m,r[m]);return s&&s.appendChild(h),h}F.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const oe=o.window.document&&o.window.document.documentElement.style,ve=oe&&oe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ie;function Ge(){oe&&ve&&(Ie=oe[ve],oe[ve]="none")}function Ze(){oe&&ve&&(oe[ve]=Ie)}function st(c){c.preventDefault(),c.stopPropagation(),o.window.removeEventListener("click",st,!0)}function ft(){o.window.addEventListener("click",st,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",st,!0)},0)}function He(c,r){const s=c.getBoundingClientRect();return xt(c,s,r)}function yt(c,r){const s=c.getBoundingClientRect(),h=[];for(let m=0;m<r.length;m++)h.push(xt(c,s,r[m]));return h}function We(c){return o.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function xt(c,r,s){const h=c.offsetWidth===r.width?1:c.offsetWidth/r.width;return new o.pointGeometry((s.clientX-r.left)*h,(s.clientY-r.top)*h)}function Et(c,r){var s=r[0],h=r[1],m=r[2],y=r[3],b=s*y-m*h;return b?(c[0]=y*(b=1/b),c[1]=-h*b,c[2]=-m*b,c[3]=s*b,c):null}function gt(c){const{userImage:r}=c;return!!(r&&r.render&&r.render())&&(c.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ft extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,s){this._validate(r,s)&&(this.images[r]=s)}_validate(r,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),h=!1),h}_validateStretch(r,s){if(!r)return!0;let h=0;for(const m of r){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(r,s){return!(r&&(r.length!==4||r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,s){s.version=this.images[r].version+1,this.images[r]=s,this.updatedImages[r]=!0}removeImage(r){const s=this.images[r];delete this.images[r],delete this.patterns[r],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,s){let h=!0;if(!this.isLoaded())for(const m of r)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(r,s):this.requestors.push({ids:r,callback:s})}_notify(r,s){const h={};for(const m of r){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const y=this.images[m];y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:r,height:s}=this.atlasImage;return{width:r,height:s}}getPattern(r){const s=this.patterns[r],h=this.getImage(r);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new o.ImagePosition(m,h);this.patterns[r]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const s=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:s,h}=o.potpack(r),m=this.atlasImage;m.resize({width:s||1,height:h||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],E=b.x+1,S=b.y+1,k=this.images[y].data,D=k.width,U=k.height;o.RGBAImage.copy(k,m,{x:0,y:0},{x:E,y:S},{width:D,height:U}),o.RGBAImage.copy(k,m,{x:0,y:U-1},{x:E,y:S-1},{width:D,height:1}),o.RGBAImage.copy(k,m,{x:0,y:0},{x:E,y:S+U},{width:D,height:1}),o.RGBAImage.copy(k,m,{x:D-1,y:0},{x:E-1,y:S},{width:1,height:U}),o.RGBAImage.copy(k,m,{x:0,y:0},{x:E+D,y:S},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const s of r){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];gt(h)&&this.updateImage(s,h)}}}const At=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(c,r){return function([s,h,m]){const y=o.degToRad(h+90),b=o.degToRad(m);return{x:s*Math.cos(y)*Math.sin(b),y:s*Math.sin(y)*Math.sin(b),z:s*Math.cos(b),azimuthal:h,polar:m}}(c.expression.evaluate(r))}interpolate(c,r,s){return{x:o.number(c.x,r.x,s),y:o.number(c.y,r.y,s),z:o.number(c.z,r.z,s),azimuthal:o.number(c.azimuthal,r.azimuthal,s),polar:o.number(c.polar,r.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ei="-transition";class ri extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(At),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s={}){if(!this._validate(o.validateLight,r,s))for(const h in r){const m=r[h];o.endsWith(h,ei)?this._transitionable.setTransition(h.slice(0,-ei.length),m):this._transitionable.setValue(h,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Er=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),vi="-transition";class fi extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(Er),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(r){for(const s in r){const h=r[s];o.endsWith(s,vi)?this._transitionable.setTransition(s.slice(0,-vi.length),h):this._transitionable.setValue(s,h)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Bt(c,r,s,h){const m=o.smoothstep(45,65,s),[y,b]=$i(c,h),E=o.length(r);let S=1-Math.min(1,Math.exp((E-y)/(b-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*c.alpha}function $i(c,r){const s=.5/Math.tan(.5*r);return[c.range[0]+s,c.range[1]+s]}const lr=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),Ur="-transition";class Ai extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(lr),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const r=this._transform,s=r.projection.name==="globe",h=o.globeToMercatorTransition(r.zoom),m=this.properties.get("range"),y=[.5,3];return{range:s?[o.number(y[0],m[0],h),o.number(y[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s={}){if(!this._validate(o.validateFog,r,s)){for(const h of Object.keys(o.spec.fog))r&&r[h]===void 0&&(r[h]=o.spec.fog[h].default);for(const h in r){const m=r[h];o.endsWith(h,Ur)?this._transitionable.setTransition(h.slice(0,-Ur.length),m):this._transitionable.setValue(h,m)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(h,m,y){const b=o.MercatorCoordinate.fromLngLat(m),E=y.elevation?y.elevation.getAtPointOrZero(b):0,S=[b.x,b.y,E];return o.transformMat4(S,S,y.mercatorFogMatrix),Bt(h,S,y.pitch,y._fov)}(this.state,r,s):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?$i(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Oi{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const y=new Oi.Actor(h[m],s,this.id);y.name=`Worker ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,h){o.asyncAll(this.actors,(m,y)=>{m.send(r,s,y)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function tn(c,r,s){return r*(o.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}Oi.Actor=o.Actor;class $e{constructor(r,s,h,m){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(r,s){let h,m;if(r instanceof o.pointGeometry||typeof r[0]=="number"){const y=o.pointGeometry.convert(r);h=[o.pointGeometry.convert(r)],m=s.isPointAboveHorizon(y)}else{const y=o.pointGeometry.convert(r[0]),b=o.pointGeometry.convert(r[1]);h=[y,b],m=o.polygonizeBounds(y,b).every(E=>s.isPointAboveHorizon(E))}return new $e(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,r),y=this.cameraPoint.clone();switch(3*((y.y>s.y)+(y.y>h.y))+((y.x>s.x)+(y.x>h.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(r,s,h,m=0){const y=r.queryPadding/s._pixelsPerMercatorPixel+1,b=h?this._bufferedCameraMercator(y,s):this._bufferedScreenMercator(y,s);let E=r.tileID.wrap+(b.unwrapped?m:0);const S=b.polygon.map(H=>o.getTilePoint(r.tileTransform,H,E));if(!o.polygonIntersectsBox(S,0,0,o.EXTENT,o.EXTENT))return;E=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const k=this.screenGeometryMercator.polygon.map(H=>o.getTileVec3(r.tileTransform,H,E)),D=k.map(H=>new o.pointGeometry(H[0],H[1])),U=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),G=o.getTileVec3(r.tileTransform,U,E),Q=k.map(H=>{const q=o.sub(H,H,G);return o.normalize(q,q),new o.Ray(G,q)}),W=tn(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:Q,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(X=o.getBounds(S),X.min.x=o.clamp(X.min.x,0,o.EXTENT),X.min.y=o.clamp(X.min.y,0,o.EXTENT),X.max.x=o.clamp(X.max.x,0,o.EXTENT),X.max.y=o.clamp(X.max.y,0,o.EXTENT),X),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:W};var X}_bufferedScreenMercator(r,s){const h=kt(r);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(r,s){const h=kt(r);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(r,s){const h=function(y,b){const E=o.multiply([],b.pixelMatrix,b.globeMatrix),S=[0,-o.GLOBE_RADIUS,0,1],k=[0,o.GLOBE_RADIUS,0,1],D=[0,0,0,1];o.transformMat4$1(S,S,E),o.transformMat4$1(k,k,E),o.transformMat4$1(D,D,E);const U=new o.pointGeometry(S[0]/S[3],S[1]/S[3]),G=new o.pointGeometry(k[0]/k[3],k[1]/k[3]),Q=o.polygonContainsPoint(y,U)&&S[3]<D[3],W=o.polygonContainsPoint(y,G)&&k[3]<D[3];if(!Q&&!W)return null;const X=function(pe,he,xe){for(let Te=1;Te<pe.length;Te++){const Ye=ut(he.pointCoordinate3D(pe[Te-1]).x),be=ut(he.pointCoordinate3D(pe[Te]).x);if(xe<0){if(Ye<be)return{idx:Te,t:-Ye/(be-1-Ye)}}else if(be<Ye)return{idx:Te,t:(1-Ye)/(be+1-Ye)}}return null}(y,b,Q?-1:1);if(!X)return null;const{idx:H,t:q}=X;let te=H>1?Tt(y.slice(0,H),b):[],Y=H<y.length?Tt(y.slice(H),b):[];te=te.map(pe=>new o.pointGeometry(ut(pe.x),pe.y)),Y=Y.map(pe=>new o.pointGeometry(ut(pe.x),pe.y));const fe=[...te];fe.length===0&&fe.push(Y[Y.length-1]);const de=o.number(fe[fe.length-1].y,(Y.length===0?te[0]:Y[0]).y,q);let ae;return ae=Q?[new o.pointGeometry(0,de),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,de)]:[new o.pointGeometry(1,de),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,de)],fe.push(...ae),Y.length===0?fe.push(te[0]):fe.push(...Y),{polygon:fe.map(pe=>new o.MercatorCoordinate(pe.x,pe.y)),unwrapped:!1}}(r,s);if(h)return h;const m=function(y,b){let E=!1,S=-1/0,k=0;for(let U=0;U<y.length-1;U++)y[U].x>S&&(S=y[U].x,k=U);for(let U=0;U<y.length-1;U++){const G=(k+U)%(y.length-1),Q=y[G],W=y[G+1];Math.abs(Q.x-W.x)>.5&&(Q.x<W.x?(Q.x+=1,G===0&&(y[y.length-1].x+=1)):(W.x+=1,G+1===y.length-1&&(y[0].x+=1)),E=!0)}const D=o.mercatorXfromLng(b.center.lng);return E&&D<Math.abs(D-1)&&y.forEach(U=>{U.x-=1}),{polygon:y,unwrapped:E}}(Tt(r,s).map(y=>new o.pointGeometry(ut(y.x),y.y)),s);return{polygon:m.polygon.map(y=>new o.MercatorCoordinate(y.x,y.y)),unwrapped:m.unwrapped}}}function Tt(c,r){return o.resample(c,s=>{const h=r.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function ut(c){return c<0?1+c%1:c%1}function kt(c){return 100*c|0}function Ei(c,r,s,h,m){const y=function(b,E){if(b)return m(b);if(E){const S=o.pick(o.extend(E,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(S.vectorLayers=E.vector_layers,S.vectorLayerIds=S.vectorLayers.map(k=>k.id)),E.language_options&&(S.languageOptions=E.language_options),E.language&&E.language[E.id]&&(S.language=E.language[E.id]),E.worldview_options&&(S.worldviewOptions=E.worldview_options),E.worldview?S.worldview=E.worldview[E.id]:E.worldview_default&&(S.worldview=E.worldview_default),S.tiles=r.canonicalizeTileset(S,c.url),m(null,S)}};return c.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(c.url,null,s,h),o.ResourceType.Source),y):o.exported.frame(()=>y(null,c))}class yi{constructor(r,s,h){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const s=Math.pow(2,r.z),h=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),b=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return r.x>=h&&r.x<y&&r.y>=m&&r.y<b}}class ni{constructor(r,s,h){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ce{constructor(r,s,h,m){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,s,h){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],b=s.attributes[y.name];b!==void 0&&r.vertexAttribPointer(b,y.components,r[qt[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _e{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ke extends _e{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Qe extends _e{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Xe extends _e{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class rt extends _e{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class vt extends _e{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ue extends _e{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class lt extends _e{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class tt extends _e{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class zt extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class St extends _e{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Rt extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class Gt extends _e{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class li extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class di extends _e{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class pi extends _e{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ti extends _e{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class zr extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class fr extends _e{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class hn extends _e{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Un extends _e{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class ho extends _e{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class gr extends _e{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kr extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class po extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class il extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class rl extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Tc extends _e{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class fo extends _e{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Hn extends _e{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class us extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class nl extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class qr extends _e{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class ra extends qr{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ee extends qr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class O extends ee{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class j{constructor(r,s,h,m){this.context=r,this.width=s,this.height=h;const y=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new ra(r,y),m&&(this.depthAttachment=new ee(r,y))}destroy(){const r=this.context.gl,s=this.colorAttachment.get();if(s&&r.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}r.deleteFramebuffer(this.framebuffer)}}class J{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ke(this),this.clearDepth=new Qe(this),this.clearStencil=new Xe(this),this.colorMask=new rt(this),this.depthMask=new vt(this),this.stencilMask=new Ue(this),this.stencilFunc=new lt(this),this.stencilOp=new tt(this),this.stencilTest=new zt(this),this.depthRange=new St(this),this.depthTest=new Rt(this),this.depthFunc=new Gt(this),this.blend=new li(this),this.blendFunc=new di(this),this.blendColor=new pi(this),this.blendEquation=new Ti(this),this.cullFace=new zr(this),this.cullFaceSide=new fr(this),this.frontFace=new hn(this),this.program=new Un(this),this.activeTexture=new ho(this),this.viewport=new gr(this),this.bindFramebuffer=new kr(this),this.bindRenderbuffer=new po(this),this.bindTexture=new il(this),this.bindVertexBuffer=new rl(this),this.bindElementBuffer=new Tc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new fo(this),this.pixelStoreUnpack=new Hn(this),this.pixelStoreUnpackPremultiplyAlpha=new us(this),this.pixelStoreUnpackFlipY=new nl(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s){return new ni(this,r,s)}createVertexBuffer(r,s,h){return new ce(this,r,s,h)}createRenderbuffer(r,s,h){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,r,s,h),this.bindRenderbuffer.set(null),y}createFramebuffer(r,s,h){return new j(this,r,s,h)}clear({color:r,depth:s,stencil:h}){const m=this.gl;let y=0;r&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){P(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class re extends o.Evented{constructor(r,s,h,m){super(),this.id=r,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ei(this._options,this.map._requestManager,null,null,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new yi(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const h=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(y,b,E,S)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):y?(r.state="errored",s(y)):b?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:S}),r.setTexture(b,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(r,s,h){r.setTexture(s,h)}static unloadTileData(r,s){r.texture&&s.saveTileTexture(r.texture)}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s()}unloadTile(r,s){r.texture&&this.map.painter.saveTileTexture(r.texture),s()}hasTransition(){return!1}}let ge;function we(c,r,s,h,m,y,b,E){const S=[c,s,m,r,h,y,1,1,1],k=[b,E,1],D=o.adjoint([],S),[U,G,Q]=o.transformMat3(k,k,o.transpose(D,D));return o.multiply$1(S,[U,0,0,0,G,0,0,0,Q],S)}class Ae extends o.Evented{constructor(r,s,h,m){super(),this.id=r,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(r,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(h,m)=>{if(this._loaded=!0,h)this.fire(new o.ErrorEvent(h));else if(m){const{HTMLImageElement:y}=o.window;this.image=m instanceof y?o.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const s=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let m=1/0,y=1/0,b=-1/0,E=-1/0;for(const U of h)m=Math.min(m,U.x),y=Math.min(y,U.y),b=Math.max(b,U.x),E=Math.max(E,U.y);const S=Math.max(b-m,E-y),k=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),D=Math.pow(2,k);return new o.CanonicalTileID(k,Math.floor((m+b)/2*D),Math.floor((y+E)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const S in this.tiles){const k=this.tiles[S];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[h,m,y,b]=this.coordinates.map(S=>{const k=s.projection.project(S[0],S[1]);return o.getTilePoint(s,k)._round()});this.perspectiveTransform=function(S,k,D,U,G,Q,W,X,H,q){const te=we(0,0,S,0,0,k,S,k),Y=we(D,U,G,Q,W,X,H,q);return o.multiply$1(Y,o.adjoint(te,te),Y),[Y[6]/Y[8]*S/o.EXTENT,Y[7]/Y[8]*k/o.EXTENT]}(this.width,this.height,h.x,h.y,m.x,m.y,b.x,b.y,y.x,y.y);const E=this._boundsArray=new o.StructArrayLayout4i8;E.emplaceBack(h.x,h.y,0,0),E.emplaceBack(m.x,m.y,o.EXTENT,0),E.emplaceBack(b.x,b.y,0,o.EXTENT),E.emplaceBack(y.x,y.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(E,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,s=r.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ye={vector:class extends o.Evented{constructor(c,r,s,h){if(super(),this.id=c,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,s=this.worldview||this.map._worldview;this._tileJSONRequest=Ei(this._options,this.map._requestManager,r,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.ErrorEvent(h))):m&&(o.extend(this,m),m.bounds&&(this.tileBounds=new yi(m.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const s of r)s.clearTiles()})}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}_setLanguage(c){return c===this.language||this.setSourceProperty(()=>{this.language=c}),this}_setWorldview(c){return c===this.worldview?this:this.worldviewOptions&&c&&!this.worldviewOptions[c]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${c}".`),this):(this.setSourceProperty(()=>{this.worldview=c}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(c,r){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=r:c.request=c.actor.send("reloadTile",h,m.bind(this));else if(c.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const y=o.loadVectorTile.call({deduped:this._deduped},h,(b,E)=>{b||!E?m.call(this,b):(h.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},c.actor&&c.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);c.request={cancel:y}}function m(y,b){return delete c.request,c.aborted?r(null):y&&y.status!==404?r(y):(b&&b.resourceTiming&&(c.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&c.setExpiryData(b),c.loadVectorData(b,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:re,"raster-dem":class extends re{constructor(c,r,s,h){super(c,r,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(c,r){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,y){m&&(c.state="errored",r(m)),y&&(c.dem=y,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",r(null))}c.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(m,y,b,E){if(delete c.request,c.aborted)c.state="unloaded",r(null);else if(m)c.state="errored",r(m);else if(y){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:b,expires:E});const S=o.window.ImageBitmap&&y instanceof o.window.ImageBitmap&&(ge==null&&(ge=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),ge),k=1-(y.width-o.prevPowerOfTwo(y.width))/2;k<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const D=S?y:o.exported.getImageData(y,k),U={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:k};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",U,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const r=c.canonical,s=Math.pow(2,r.z),h=(r.x-1+s)%s,m=r.x===0?c.wrap-1:c.wrap,y=(r.x+1+s)%s,b=r.x+1===s?c.wrap+1:c.wrap,E={};return E[new o.OverscaledTileID(c.overscaledZ,m,r.z,h,r.y).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,b,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(E[new o.OverscaledTileID(c.overscaledZ,m,r.z,h,r.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,b,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<s&&(E[new o.OverscaledTileID(c.overscaledZ,m,r.z,h,r.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,b,r.z,y,r.y+1).key]={backfilled:!1}),E}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends o.Evented{constructor(c,r,s,h){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*m,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*m,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},r),this}getClusterChildren(c,r){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},r),this}getClusterLeaves(c,r,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:r,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(c.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,r){const s=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(s,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete c.request,c.unloadVectorData(),c.aborted?r(null):h?r(h):(c.loadVectorData(m,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ae{constructor(c,r,s,h){super(c,r,s,h),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const r of c.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const r=this.video.seekable;c<r.start(0)||c>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,r=c.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(c,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ae,canvas:class extends Ae{constructor(c,r,s,h){super(c,r,s,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.Evented{constructor(c,r,s,h){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new yi(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:r,y:s,z:h}=c.canonical;return this._implementation.hasTile({x:r,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,r){const{x:s,y:h,z:m}=c.tileID.canonical,y=new o.window.AbortController,b=this._implementation.loadTile({x:s,y:h,z:m},{signal:y.signal});if(!b)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",r(null);b.cancel=()=>y.abort(),c.request=b.then(function(E){return delete c.request,c.aborted?(c.state="unloaded",r(null)):E?function(S){return S instanceof o.window.ImageData||S instanceof o.window.ImageBitmap||S instanceof o.window.HTMLCanvasElement}(E)?(this.loadTileData(c,E),c.state="loaded",void r(null)):(c.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",r(null))}.bind(this)).catch(E=>{E.code!==20&&(c.state="errored",r(E))})}loadTileData(c,r){re.loadTileData(c,r,this._map.painter)}unloadTileData(c){re.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:r,y:s,z:h}=c.tileID.canonical,m=this._implementation.prepareTile({x:r,y:s,z:h});return m?(this.loadTileData(c,m),c.state="loaded",m):null}unloadTile(c,r){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:s,y:h,z:m}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}r()}abortTile(c,r){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ee=function(c,r,s,h){const m=new ye[r.type](c,r,s,h);if(m.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function Ve(c,r){const s=o.identity([]);return o.scale(s,s,[.5*c.width,.5*-c.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,c.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(s)}function ht(c,r,s,h,m,y,b,E=!1){const S=c.tilesIn(h,b,E);S.sort(Lt);const k=[];for(const U of S)k.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,s,c._state,U,m,y,Ve(c.transform,U.tile.tileID),E)});const D=function(U){const G={},Q={};for(const W of U){const X=W.queryResults,H=W.wrappedTileID,q=Q[H]=Q[H]||{};for(const te in X){const Y=X[te],fe=q[te]=q[te]||{},de=G[te]=G[te]||[];for(const ae of Y)fe[ae.featureIndex]||(fe[ae.featureIndex]=!0,de.push(ae))}}return G}(k);for(const U in D)D[U].forEach(G=>{const Q=G.feature,W=Q.layer;W&&W.type!=="background"&&W.type!=="sky"&&(Q.source=W.source,W["source-layer"]&&(Q.sourceLayer=W["source-layer"]),Q.state=Q.id!==void 0?c.getFeatureState(W["source-layer"],Q.id):{})});return D}function qe(c,r){const s=c.getRenderableIds().map(y=>c.getTileByID(y)),h=[],m={};for(let y=0;y<s.length;y++){const b=s[y],E=b.tileID.canonical.key;m[E]||(m[E]=!0,b.querySourceFeatures(h,r))}return h}function Lt(c,r){const s=c.tileID,h=r.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Ot(){return Pa.workerClass!=null?new Pa.workerClass:new o.window.Worker(Pa.workerUrl)}const It="mapboxgl_preloaded_worker_pool";class Ut{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Ut.workerCount;)this.workers.push(new Ot);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}let Jt;function Ii(){return Jt||(Jt=new Ut),Jt}function Pi(c,r){const s={};for(const h in c)h!=="ref"&&(s[h]=c[h]);return o.refProperties.forEach(h=>{h in r&&(s[h]=r[h])}),s}function Ci(c){c=c.slice();const r=Object.create(null);for(let s=0;s<c.length;s++)r[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=Pi(c[s],r[c[s].ref]));return c}Ut.workerCount=2;const Pt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pe(c,r,s){s.push({command:Pt.addSource,args:[c,r[c]]})}function rn(c,r,s){r.push({command:Pt.removeSource,args:[c]}),s[c]=!0}function rr(c,r,s,h){rn(c,s,h),Pe(c,r,s)}function mo(c,r,s){let h;for(h in c[s])if(c[s].hasOwnProperty(h)&&h!=="data"&&!P(c[s][h],r[s][h]))return!1;for(h in r[s])if(r[s].hasOwnProperty(h)&&h!=="data"&&!P(c[s][h],r[s][h]))return!1;return!0}function ol(c,r,s,h,m,y){let b;for(b in r=r||{},c=c||{})c.hasOwnProperty(b)&&(P(c[b],r[b])||s.push({command:y,args:[h,b,r[b],m]}));for(b in r)r.hasOwnProperty(b)&&!c.hasOwnProperty(b)&&(P(c[b],r[b])||s.push({command:y,args:[h,b,r[b],m]}))}function Tn(c){return c.id}function sl(c,r){return c[r.id]=r,c}class Wp{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let s=1,h=this._distances[s];const m=r*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const y=s-1,b=this._distances[y],E=h-b,S=E>0?(m-b)/E:0;return this.points[y].mult(1-S).add(this.points[s].mult(S))}}class hs{constructor(r,s,h){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/h),this.yCellCount=Math.ceil(s/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,h,m,y){this._forEachCell(s,h,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(r,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(r,s,h,m,y,b){this.boxCells[y].push(b)}_insertCircleCell(r,s,h,m,y,b){this.circleCells[y].push(b)}_query(r,s,h,m,y,b){if(h<0||r>this.width||m<0||s>this.height)return!y&&[];const E=[];if(r<=0&&s<=0&&this.width<=h&&this.height<=m){if(y)return!0;for(let S=0;S<this.boxKeys.length;S++)E.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const k=this.circles[3*S],D=this.circles[3*S+1],U=this.circles[3*S+2];E.push({key:this.circleKeys[S],x1:k-U,y1:D-U,x2:k+U,y2:D+U})}return b?E.filter(b):E}return this._forEachCell(r,s,h,m,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?E.length>0:E}_queryCircle(r,s,h,m,y){const b=r-h,E=r+h,S=s-h,k=s+h;if(E<0||b>this.width||k<0||S>this.height)return!m&&[];const D=[];return this._forEachCell(b,S,E,k,this._queryCellCircle,D,{hitTest:m,circle:{x:r,y:s,radius:h},seenUids:{box:{},circle:{}}},y),m?D.length>0:D}query(r,s,h,m,y){return this._query(r,s,h,m,!1,y)}hitTest(r,s,h,m,y){return this._query(r,s,h,m,!0,y)}hitTestCircle(r,s,h,m){return this._queryCircle(r,s,h,!0,m)}_queryCell(r,s,h,m,y,b,E,S){const k=E.seenUids,D=this.boxCells[y];if(D!==null){const G=this.bboxes;for(const Q of D)if(!k.box[Q]){k.box[Q]=!0;const W=4*Q;if(r<=G[W+2]&&s<=G[W+3]&&h>=G[W+0]&&m>=G[W+1]&&(!S||S(this.boxKeys[Q]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[Q],x1:G[W],y1:G[W+1],x2:G[W+2],y2:G[W+3]})}}}const U=this.circleCells[y];if(U!==null){const G=this.circles;for(const Q of U)if(!k.circle[Q]){k.circle[Q]=!0;const W=3*Q;if(this._circleAndRectCollide(G[W],G[W+1],G[W+2],r,s,h,m)&&(!S||S(this.circleKeys[Q]))){if(E.hitTest)return b.push(!0),!0;{const X=G[W],H=G[W+1],q=G[W+2];b.push({key:this.circleKeys[Q],x1:X-q,y1:H-q,x2:X+q,y2:H+q})}}}}}_queryCellCircle(r,s,h,m,y,b,E,S){const k=E.circle,D=E.seenUids,U=this.boxCells[y];if(U!==null){const Q=this.bboxes;for(const W of U)if(!D.box[W]){D.box[W]=!0;const X=4*W;if(this._circleAndRectCollide(k.x,k.y,k.radius,Q[X+0],Q[X+1],Q[X+2],Q[X+3])&&(!S||S(this.boxKeys[W])))return b.push(!0),!0}}const G=this.circleCells[y];if(G!==null){const Q=this.circles;for(const W of G)if(!D.circle[W]){D.circle[W]=!0;const X=3*W;if(this._circlesCollide(Q[X],Q[X+1],Q[X+2],k.x,k.y,k.radius)&&(!S||S(this.circleKeys[W])))return b.push(!0),!0}}}_forEachCell(r,s,h,m,y,b,E,S){const k=this._convertToXCellCoord(r),D=this._convertToYCellCoord(s),U=this._convertToXCellCoord(h),G=this._convertToYCellCoord(m);for(let Q=k;Q<=U;Q++)for(let W=D;W<=G;W++)if(y.call(this,r,s,h,m,this.xCellCount*W+Q,b,E,S))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,h,m,y,b){const E=m-r,S=y-s,k=h+b;return k*k>E*E+S*S}_circleAndRectCollide(r,s,h,m,y,b,E){const S=(b-m)/2,k=Math.abs(r-(m+S));if(k>S+h)return!1;const D=(E-y)/2,U=Math.abs(s-(y+D));if(U>D+h)return!1;if(k<=S||U<=D)return!0;const G=k-S,Q=U-D;return G*G+Q*Q<=h*h}}const dt=Math.tan(85*Math.PI/180);function ti(c,r,s,h,m,y,b){const E=o.create();if(s)if(y.name==="globe"){const S=o.calculateGlobeLabelMatrix(m,r);o.multiply(E,E,S)}else{const S=Et([],b);E[0]=S[0],E[1]=S[1],E[4]=S[2],E[5]=S[3],h||o.rotateZ(E,E,m.angle)}else o.multiply(E,m.labelPlaneMatrix,c);return E}function ii(c,r,s,h,m,y,b){const E=ti(c,r,s,h,m,y,b);return y.name==="globe"&&s||(E[2]=E[6]=E[10]=E[14]=0),E}function Sn(c,r,s,h,m,y,b){if(s){if(y.name==="globe"){const E=ti(c,r,s,h,m,y,b);return o.invert(E,E),o.multiply(E,c,E),E}{const E=o.clone(c),S=o.identity([]);return S[0]=b[0],S[1]=b[1],S[4]=b[2],S[5]=b[3],o.multiply(E,E,S),h||o.rotateZ(E,E,-m.angle),E}}return m.glCoordMatrix}function In(c,r,s=0){const h=[c.x,c.y,s,1];s?o.transformMat4$1(h,h,r):Vr(h,h,r);const m=h[3];return{point:[h[0]/m,h[1]/m,h[2]/m],signedDistanceFromCamera:m}}function Xt(c,r){const s=[c[0],c[1],c[2],1];o.transformMat4$1(s,s,r);const h=s[3];return{point:[s[0]/h,s[1]/h,s[2]/h],signedDistanceFromCamera:h}}function na(c,r){return Math.min(.5+c/r*.5,1.5)}function oa(c,r){const s=c[0]/c[3],h=c[1]/c[3];return s>=-r[0]&&s<=r[0]&&h>=-r[1]&&h<=r[1]}function sa(c,r,s,h,m,y,b,E,S,k){const D=s.transform,U=h?c.textSizeData:c.iconSizeData,G=o.evaluateSizeForZoom(U,s.transform.zoom),Q=D.projection.name==="globe",W=[256/s.width*2+1,256/s.height*2+1],X=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;X.clear();let H=null;Q&&(H=h?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const q=c.lineVertexArray,te=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,Y=s.transform.width/s.transform.height;let fe=!1;for(let de=0;de<te.length;de++){const ae=te.get(de);if(ae.writingMode!==o.WritingMode.vertical||fe||de!==0&&te.get(de-1).writingMode===o.WritingMode.horizontal||(fe=!0),(ae.hidden||ae.writingMode===o.WritingMode.vertical)&&!fe){go(ae.numGlyphs,X);continue}fe=!1;const pe=new o.pointGeometry(ae.tileAnchorX,ae.tileAnchorY),he=S?S(pe):[0,0,0],xe=D.projection.projectTilePoint(pe.x,pe.y,k.canonical),Te=[xe.x+he[0],xe.y+he[1],xe.z+he[2]],Ye=[...Te,1];if(o.transformMat4$1(Ye,Ye,r),!oa(Ye,W)){go(ae.numGlyphs,X);continue}const be=na(s.transform.cameraToCenterDistance,Ye[3]),Be=o.evaluateSizeForFeature(U,G,ae),Fe=b?Be/be:Be*be,it=In(new o.pointGeometry(Te[0],Te[1]),m,Te[2]);if(it.signedDistanceFromCamera<=0){go(ae.numGlyphs,X);continue}let ze={};const Ke=b?null:S,Oe=Ch(ae,Fe,!1,E,r,m,y,c.glyphOffsetArray,q,X,H,it.point,pe,ze,Y,Ke,D.projection,k,b);fe=Oe.useVertical,Ke&&Oe.needsFlipping&&(ze={}),(Oe.notEnoughRoom||fe||Oe.needsFlipping&&Ch(ae,Fe,!0,E,r,m,y,c.glyphOffsetArray,q,X,H,it.point,pe,ze,Y,Ke,D.projection,k,b).notEnoughRoom)&&go(ae.numGlyphs,X)}h?(c.text.dynamicLayoutVertexBuffer.updateData(X),H&&c.text.globeExtVertexBuffer.updateData(H)):(c.icon.dynamicLayoutVertexBuffer.updateData(X),H&&c.icon.globeExtVertexBuffer.updateData(H))}function nn(c,r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X){const H=E.glyphStartIndex+E.numGlyphs,q=E.lineStartIndex,te=E.lineStartIndex+E.lineLength,Y=r.getoffsetX(E.glyphStartIndex),fe=r.getoffsetX(H-1),de=_o(c*Y,s,h,m,y,b,E.segment,q,te,S,k,D,U,G,!0,Q,W,X);if(!de)return null;const ae=_o(c*fe,s,h,m,y,b,E.segment,q,te,S,k,D,U,G,!0,Q,W,X);return ae?{first:de,last:ae}:null}function Yi(c,r,s,h){return c.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-r.y)>Math.abs(s.x-r.x)*h?{useVertical:!0}:c.writingMode===o.WritingMode.vertical?r.y<s.y?{needsFlipping:!0}:null:c.flipState!==0&&function(m,y,b){const E=(y.x-m.x)*b;return E===0||Math.abs((y.y-m.y)/E)>dt}(r,s,h)?c.flipState===1?{needsFlipping:!0}:null:r.x>s.x?{needsFlipping:!0}:null}function Ch(c,r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X,H,q,te){const Y=r/24,fe=c.lineOffsetX*Y,de=c.lineOffsetY*Y;let ae;if(c.numGlyphs>1){const pe=c.glyphStartIndex+c.numGlyphs,he=c.lineStartIndex,xe=c.lineStartIndex+c.lineLength,Te=nn(Y,E,fe,de,s,U,G,c,S,y,Q,X,!1,H,q,te);if(!Te)return{notEnoughRoom:!0};const Ye=Xt(Te.first.point,b).point,be=Xt(Te.last.point,b).point,Be=new o.pointGeometry(Ye[0],Ye[1]),Fe=new o.pointGeometry(be[0],be[1]);if(h&&!s){const it=Yi(c,Be,Fe,W);if(c.flipState=it&&it.needsFlipping?1:2,it)return it}ae=[Te.first];for(let it=c.glyphStartIndex+1;it<pe-1;it++)ae.push(_o(Y*E.getoffsetX(it),fe,de,s,U,G,c.segment,he,xe,S,y,Q,X,!1,!1,H,q,te));ae.push(Te.last)}else{if(h&&!s){const he=In(G,m).point,xe=c.lineStartIndex+c.segment+1,Te=new o.pointGeometry(S.getx(xe),S.gety(xe)),Ye=In(Te,m),be=Ye.signedDistanceFromCamera>0?Ye.point:al(G,Te,he,1,m,void 0,H,q.canonical),Be=Yi(c,new o.pointGeometry(he[0],he[1]),new o.pointGeometry(be[0],be[1]),W);if(c.flipState=Be&&Be.needsFlipping?1:2,Be)return Be}const pe=_o(Y*E.getoffsetX(c.glyphStartIndex),fe,de,s,U,G,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,S,y,Q,X,!1,!1,H,q,te);if(!pe)return{notEnoughRoom:!0};ae=[pe]}if(D)for(const pe of ae)o.updateGlobeVertexNormal(D,k.length+0,pe.up[0],pe.up[1],pe.up[2]),o.updateGlobeVertexNormal(D,k.length+1,pe.up[0],pe.up[1],pe.up[2]),o.updateGlobeVertexNormal(D,k.length+2,pe.up[0],pe.up[1],pe.up[2]),o.updateGlobeVertexNormal(D,k.length+3,pe.up[0],pe.up[1],pe.up[2]),o.addDynamicAttributes(k,pe.point[0],pe.point[1],pe.point[2],pe.angle);else for(const pe of ae)o.addDynamicAttributes(k,pe.point[0],pe.point[1],pe.point[2],pe.angle);return{}}function ds(c,r,s,h,m){const y=h.projectTilePoint(c.x,c.y,r);if(!m)return In(y,s,y.z);const b=m(c);return In(new o.pointGeometry(y.x+b[0],y.y+b[1]),s,y.z+b[2])}function al(c,r,s,h,m,y,b,E){const S=ds(c.add(c.sub(r)._unit()),E,m,b,y).point,k=o.sub([],s,S);return o.scaleAndAdd([],s,k,h/o.length(k))}function _o(c,r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X,H,q){const te=h?c-r:c+r;let Y=te>0?1:-1,fe=0;h&&(Y*=-1,fe=Math.PI),Y<0&&(fe+=Math.PI);let de=Y>0?E+b:E+b+1,ae=m,pe=m,he=0,xe=0;const Te=Math.abs(te),Ye=[],be=[];let Be=y;const Fe=()=>{const wt=de-Y;return he===0?y:new o.pointGeometry(k.getx(wt),k.gety(wt))},it=()=>al(Fe(),Be,pe,Te-he+1,D,G,X,H.canonical);for(;he+xe<=Te;){if(de+=Y,de<E||de>=S)return null;if(pe=ae,Ye.push(ae),Q&&be.push(Be||Fe()),ae=U[de],ae===void 0){Be=new o.pointGeometry(k.getx(de),k.gety(de));const wt=ds(Be,H.canonical,D,X,G);ae=wt.signedDistanceFromCamera>0?U[de]=wt.point:it()}else Be=null;he+=xe,xe=o.distance(pe,ae)}Be=Be||new o.pointGeometry(k.getx(de),k.gety(de));const ze=Fe();W&&G&&(U[de]=ae=U[de]===void 0?ae:it(),xe=o.distance(pe,ae));const Ke=(Te-he)/xe,Oe=Be.sub(ze).mult(Ke)._add(ze),at=o.sub([],ae,pe),ot=o.scaleAndAdd([],pe,at,Ke);let bt=[0,0,1],Mt=at[0],jt=at[1];if(q&&(bt=X.upVector(H.canonical,Oe.x,Oe.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const wt=[1,0,0],Zt=[0,1,0];wt[0]=bt[2],wt[1]=0,wt[2]=-bt[0],o.cross(Zt,bt,wt),o.normalize(wt,wt),o.normalize(Zt,Zt),Mt=o.dot(at,wt),jt=o.dot(at,Zt)}if(s){const wt=o.cross([],bt,at);o.normalize(wt,wt),o.scaleAndAdd(ot,ot,wt,s*Y)}const oi=fe+Math.atan2(jt,Mt);return Ye.push(ot),Q&&be.push(Oe),{point:ot,angle:oi,path:Ye,tilePath:be,up:bt}}const Sc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function go(c,r){for(let s=0;s<c;s++){const h=r.length;r.resize(h+4),r.float32.set(Sc,4*h)}}function Vr(c,r,s){const h=r[0],m=r[1];return c[0]=s[0]*h+s[4]*m+s[12],c[1]=s[1]*h+s[5]*m+s[13],c[3]=s[3]*h+s[7]*m+s[15],c}const Mi=100;class Ic{constructor(r,s,h=new hs(r.width+200,r.height+200,25),m=new hs(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Mi,this.screenBottomBoundary=r.height+Mi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,h,m,y,b,E,S){let k=h.projectedAnchorX,D=h.projectedAnchorY,U=h.projectedAnchorZ;const G=h.elevation,Q=h.tileID;if(G&&Q){const de=r.getProjection().upVector(Q.canonical,h.tileAnchorX,h.tileAnchorY),ae=r.getProjection().upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=de[0]*G*ae,D+=de[1]*G*ae,U+=de[2]*G*ae}const W=this.projectAndGetPerspectiveRatio(E,[k,D,U],h.tileID,r.projection.name==="globe"||!!G||this.transform.pitch>0,r.getProjection()),X=b*W.perspectiveRatio,H=(h.x1*s+m.x-h.padding)*X+W.point.x,q=(h.y1*s+m.y-h.padding)*X+W.point.y,te=(h.x2*s+m.x+h.padding)*X+W.point.x,Y=(h.y2*s+m.y+h.padding)*X+W.point.y,fe=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(H,q,te,Y)||!y&&this.grid.hitTest(H,q,te,Y,S)||fe?{box:[],offscreen:!1,occluded:W.occluded}:{box:[H,q,te,Y],offscreen:this.isOffscreen(H,q,te,Y),occluded:!1}}placeCollisionCircles(r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X){const H=[],q=this.transform.elevation,te=q?q.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,r.getProjection()):ze=>[0,0,0],Y=new o.pointGeometry(h.tileAnchorX,h.tileAnchorY),fe=r.getProjection().projectTilePoint(h.tileAnchorX,h.tileAnchorY,X.canonical),de=te(Y),ae=[fe.x+de[0],fe.y+de[1],fe.z+de[2]],pe=r.projection.name==="globe",he=this.projectAndGetPerspectiveRatio(E,[ae[0],ae[1],ae[2]],X,pe||!!q||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:xe}=he,Te=(U?b/xe:b*xe)/o.ONE_EM,Ye=In(new o.pointGeometry(ae[0],ae[1]),S,ae[2]).point,be=he.signedDistanceFromCamera>0?nn(Te,y,h.lineOffsetX*Te,h.lineOffsetY*Te,!1,Ye,Y,h,m,S,{},q&&!U?te:null,U&&!!q,r.getProjection(),X,U):null;let Be=!1,Fe=!1,it=!0;if(be&&!he.occluded){const ze=.5*Q*xe+W,Ke=new o.pointGeometry(-100,-100),Oe=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),at=new Wp,ot=be.first,bt=be.last;let Mt=[];for(let wt=ot.path.length-1;wt>=1;wt--)Mt.push(ot.path[wt]);for(let wt=1;wt<bt.path.length;wt++)Mt.push(bt.path[wt]);const jt=2.5*ze;if(k){const wt=Mt.map(q&&!pe?(Zt,_i)=>{const Gi=te(_i<ot.path.length-1?ot.tilePath[ot.path.length-1-_i]:bt.tilePath[_i-ot.path.length+2]);return Zt[2]=Gi[2],Xt(Zt,k)}:Zt=>Xt(Zt,k));Mt=wt.some(Zt=>Zt.signedDistanceFromCamera<=0)?[]:wt.map(Zt=>Zt.point)}let oi=[];if(Mt.length>0){const wt=Mt.map(zi=>new o.pointGeometry(zi[0],zi[1]));let Zt=1/0,_i=-1/0,Gi=1/0,nr=-1/0;for(let zi=0;zi<wt.length;zi++)Zt=Math.min(Zt,wt[zi].x),Gi=Math.min(Gi,wt[zi].y),_i=Math.max(_i,wt[zi].x),nr=Math.max(nr,wt[zi].y);oi=Zt>=Ke.x&&_i<=Oe.x&&Gi>=Ke.y&&nr<=Oe.y?[wt]:_i<Ke.x||Zt>Oe.x||nr<Ke.y||Gi>Oe.y?[]:o.clipLine([wt],Ke.x,Ke.y,Oe.x,Oe.y)}for(const wt of oi){at.reset(wt,.25*ze);let Zt=0;Zt=at.length<=.5*ze?1:Math.ceil(at.paddedLength/jt)+1;for(let _i=0;_i<Zt;_i++){const Gi=_i/Math.max(Zt-1,1),nr=at.lerp(Gi),zi=nr.x+Mi,Sr=nr.y+Mi;H.push(zi,Sr,ze,0);const zn=zi-ze,Kn=Sr-ze,Zi=zi+ze,Xi=Sr+ze;if(it=it&&this.isOffscreen(zn,Kn,Zi,Xi),Fe=Fe||this.isInsideGrid(zn,Kn,Zi,Xi),!s&&this.grid.hitTestCircle(zi,Sr,ze,G)&&(Be=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!D&&Be||!Fe?[]:H,offscreen:it,collisionDetected:Be,occluded:he.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,y=-1/0,b=-1/0;for(const D of r){const U=new o.pointGeometry(D.x+Mi,D.y+Mi);h=Math.min(h,U.x),m=Math.min(m,U.y),y=Math.max(y,U.x),b=Math.max(b,U.y),s.push(U)}const E=this.grid.query(h,m,y,b).concat(this.ignoredGrid.query(h,m,y,b)),S={},k={};for(const D of E){const U=D.key;if(S[U.bucketInstanceId]===void 0&&(S[U.bucketInstanceId]={}),S[U.bucketInstanceId][U.featureIndex])continue;const G=[new o.pointGeometry(D.x1,D.y1),new o.pointGeometry(D.x2,D.y1),new o.pointGeometry(D.x2,D.y2),new o.pointGeometry(D.x1,D.y2)];o.polygonIntersectsPolygon(s,G)&&(S[U.bucketInstanceId][U.featureIndex]=!0,k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]=[]),k[U.bucketInstanceId].push(U.featureIndex))}return k}insertCollisionBox(r,s,h,m,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,h,m,y){const b=s?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:m,collisionGroupID:y};for(let S=0;S<r.length;S+=4)b.insertCircle(E,r[S],r[S+1],r[S+2])}projectAndGetPerspectiveRatio(r,s,h,m,y){const b=[s[0],s[1],s[2],1];let E=!1;if(s[2]||this.transform.pitch>0){o.transformMat4$1(b,b,r);const S=y.name==="globe";this.fogState&&h&&!S&&(E=function(k,D,U,G,Q,W){const X=W.calculateFogTileMatrix(Q),H=[D,U,G];return o.transformMat4(H,H,X),Bt(k,H,W.pitch,W._fov)}(this.fogState,s[0],s[1],s[2],h.toUnwrapped(),this.transform)>.9)}else Vr(b,b,r);return{point:new o.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Mi,(-b[1]/b[3]+1)/2*this.transform.height+Mi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:m&&b[2]>b[3]||E}}isOffscreen(r,s,h,m){return h<Mi||r>=this.screenRightBoundary||m<Mi||s>this.screenBottomBoundary}isInsideGrid(r,s,h,m){return h>=0&&r<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function aa(c,r,s){const h=r.createTileMatrix(c,c.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),c.projMatrix,h)}function Wr(c,r,s){if(r.projection.name===s.projection.name)return c.projMatrix;const h=s.clone();return h.setProjection(r.projection),aa(h,r.getProjection(),c)}function Xr(c,r,s){return r.name===s.projection.name?c.projMatrix:aa(s,r,c)}class Cc{constructor(r,s,h,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class yo{constructor(r,s,h,m,y,b=!1){this.text=new Cc(r?r.text:null,s,h,y),this.icon=new Cc(r?r.icon:null,s,m,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cr{constructor(r,s,h,m=!1){this.text=r,this.icon=s,this.skipFade=h,this.clipped=m}}class la{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Mc{constructor(r,s,h,m,y){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=y}}class ca{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[r]}}function xr(c,r,s,h,m){const{horizontalAlign:y,verticalAlign:b}=o.getAnchorAlignment(c),E=-(y-.5)*r,S=-(b-.5)*s,k=o.evaluateVariableOffset(c,h);return new o.pointGeometry(E+k[0]*m,S+k[1]*m)}function ua(c,r,s,h,m){const y=new o.pointGeometry(c,r);return s&&y._rotate(h?m:-m),y}class zc{constructor(r,s,h,m,y){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Ic(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new ca(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,h,m){const y=h.getBucket(s),b=h.latestFeatureIndex;if(!y||!b||s.id!==y.layerIds[0])return;const E=y.layers[0].layout,S=h.collisionBoxArray,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),D=h.tileSize/o.EXTENT,U=h.tileID.toUnwrapped();this.transform.setProjection(y.projection);const G=(Q=h.tileID,W=y.getProjection(),X=this.transform,W.name===this.projection?X.calculateProjMatrix(Q.toUnwrapped()):aa(X,W,Q));var Q,W,X;const H=E.get("text-pitch-alignment")==="map",q=E.get("text-rotation-alignment")==="map";s.compileFilter();const te=s.dynamicFilter(),Y=s.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(h),de=ii(G,h.tileID.canonical,H,q,this.transform,y.getProjection(),fe);let ae=null;if(H){const xe=Sn(G,h.tileID.canonical,H,q,this.transform,y.getProjection(),fe);ae=o.multiply([],this.transform.labelPlaneMatrix,xe)}let pe=null;te&&h.latestFeatureIndex&&(pe={unwrappedTileID:U,dynamicFilter:te,dynamicFilterNeedsFeature:Y,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Mc(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,h.tileID);const he={bucket:y,layout:E,posMatrix:G,textLabelPlaneMatrix:de,labelToScreenMatrix:ae,clippingData:pe,scale:k,textPixelRatio:D,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const xe of y.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:Ye,symbolInstanceEnd:be}=xe;r.push({sortKey:Te,symbolInstanceStart:Ye,symbolInstanceEnd:be,parameters:he})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:he})}attemptAnchorPlacement(r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X,H,q,te){const Y=[G.textOffset0,G.textOffset1],fe=xr(r,h,m,Y,y),de=this.collisionIndex.placeCollisionBox(W,y,s,ua(fe.x,fe.y,b,E,this.transform.angle),U,S,k,D.predicate);if((!H||this.collisionIndex.placeCollisionBox(W,W.getSymbolInstanceIconSize(te,this.transform.zoom,Q),H,ua(fe.x,fe.y,b,E,this.transform.angle),U,S,k,D.predicate).box.length!==0)&&de.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:Y,width:h,height:m,anchor:r,textScale:y,prevAnchor:ae},this.markUsedJustification(W,r,G,X),W.allowVerticalPlacement&&(this.markUsedOrientation(W,X,G),this.placedOrientations[G.crossTileID]=X),{shift:fe,placedGlyphBoxes:de}}}placeLayerBucketPart(r,s,h,m){const{bucket:y,layout:b,posMatrix:E,textLabelPlaneMatrix:S,labelToScreenMatrix:k,clippingData:D,textPixelRatio:U,holdingForFade:G,collisionBoxArray:Q,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:X,collisionGroup:H}=r.parameters,q=b.get("text-optional"),te=b.get("icon-optional"),Y=b.get("text-allow-overlap"),fe=b.get("icon-allow-overlap"),de=b.get("text-rotation-alignment")==="map",ae=b.get("text-pitch-alignment")==="map",pe=b.get("icon-text-fit")!=="none",he=b.get("symbol-z-order")==="viewport-y";this.transform.setProjection(y.projection);let xe=Y&&(fe||!y.hasIconData()||te),Te=fe&&(Y||!y.hasTextData()||q);!y.collisionArrays&&Q&&y.deserializeCollisionBoxes(Q),h&&m&&y.updateCollisionDebugBuffers(this.transform.zoom,Q);const Ye=(be,Be,Fe)=>{if(D){const Zi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Xi=null;if(D.dynamicFilterNeedsFeature){const Kt=this.retainedQueryData[y.bucketInstanceId];Xi=D.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Kt.bucketIndex,sourceLayerIndex:Kt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(Zi,Xi,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.pointGeometry(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[be.crossTileID]=new cr(!1,!1,!1,!0),void(s[be.crossTileID]=!0)}if(s[be.crossTileID])return;if(G)return void(this.placements[be.crossTileID]=new cr(!1,!1,!1));let it=!1,ze=!1,Ke=!0,Oe=!1,at=!1,ot=null,bt={box:null,offscreen:null,occluded:null},Mt={box:null,offscreen:null,occluded:null},jt=null,oi=null,wt=null,Zt=0,_i=0,Gi=0;Fe.textFeatureIndex?Zt=Fe.textFeatureIndex:be.useRuntimeCollisionCircles&&(Zt=be.featureIndex),Fe.verticalTextFeatureIndex&&(_i=Fe.verticalTextFeatureIndex);const nr=Zi=>{Zi.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||Zi.elevation)&&(Zi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,Zi.tileAnchorX,Zi.tileAnchorY):0)},zi=Fe.textBox;if(zi){nr(zi);const Zi=Kt=>{let dr=o.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Kt&&this.prevPlacement){const Dr=this.prevPlacement.placedOrientations[be.crossTileID];Dr&&(this.placedOrientations[be.crossTileID]=Dr,dr=Dr,this.markUsedOrientation(y,dr,be))}return dr},Xi=(Kt,dr)=>{if(y.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const Dr of y.writingModes)if(Dr===o.WritingMode.vertical?(bt=dr(),Mt=bt):bt=Kt(),bt&&bt.box&&bt.box.length)break}else bt=Kt()};if(b.get("text-variable-anchor")){let Kt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const Fi=this.prevPlacement.variableOffsets[be.crossTileID];Kt.indexOf(Fi.anchor)>0&&(Kt=Kt.filter(Br=>Br!==Fi.anchor),Kt.unshift(Fi.anchor))}const dr=(Fi,Br,Go)=>{const jr=y.getSymbolInstanceTextSize(W,be,this.transform.zoom,Be),Zo=(Fi.x2-Fi.x1)*jr+2*Fi.padding,qo=(Fi.y2-Fi.y1)*jr+2*Fi.padding,Wo=pe&&!fe?Br:null;Wo&&nr(Wo);let Nr={box:[],offscreen:!1,occluded:!1};const Xo=Y?2*Kt.length:Kt.length;for(let wo=0;wo<Xo;++wo){const Da=this.attemptAnchorPlacement(Kt[wo%Kt.length],Fi,Zo,qo,jr,de,ae,U,E,H,wo>=Kt.length,be,Be,y,Go,Wo,W,X);if(Da&&(Nr=Da.placedGlyphBoxes,Nr&&Nr.box&&Nr.box.length)){it=!0,ot=Da.shift;break}}return Nr};Xi(()=>dr(zi,Fe.iconBox,o.WritingMode.horizontal),()=>{const Fi=Fe.verticalTextBox;return Fi&&nr(Fi),y.allowVerticalPlacement&&!(bt&&bt.box&&bt.box.length)&&be.numVerticalGlyphVertices>0&&Fi?dr(Fi,Fe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),bt&&(it=bt.box,Ke=bt.offscreen,Oe=bt.occluded);const Dr=Zi(bt&&bt.box);if(!it&&this.prevPlacement){const Fi=this.prevPlacement.variableOffsets[be.crossTileID];Fi&&(this.variableOffsets[be.crossTileID]=Fi,this.markUsedJustification(y,Fi.anchor,be,Dr))}}else{const Kt=(dr,Dr)=>{const Fi=y.getSymbolInstanceTextSize(W,be,this.transform.zoom,Be),Br=this.collisionIndex.placeCollisionBox(y,Fi,dr,new o.pointGeometry(0,0),Y,U,E,H.predicate);return Br&&Br.box&&Br.box.length&&(this.markUsedOrientation(y,Dr,be),this.placedOrientations[be.crossTileID]=Dr),Br};Xi(()=>Kt(zi,o.WritingMode.horizontal),()=>{const dr=Fe.verticalTextBox;return y.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&dr?(nr(dr),Kt(dr,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Zi(bt&&bt.box&&bt.box.length)}}if(jt=bt,it=jt&&jt.box&&jt.box.length>0,Ke=jt&&jt.offscreen,Oe=jt&&jt.occluded,be.useRuntimeCollisionCircles){const Zi=y.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),Xi=o.evaluateSizeForFeature(y.textSizeData,W,Zi),Kt=b.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(y,Y,Zi,y.lineVertexArray,y.glyphOffsetArray,Xi,E,S,k,h,ae,H.predicate,be.collisionCircleDiameter*Xi/o.ONE_EM,Kt,this.retainedQueryData[y.bucketInstanceId].tileID),it=Y||oi.circles.length>0&&!oi.collisionDetected,Ke=Ke&&oi.offscreen,Oe=oi.occluded}if(Fe.iconFeatureIndex&&(Gi=Fe.iconFeatureIndex),Fe.iconBox){const Zi=Xi=>{nr(Xi);const Kt=pe&&ot?ua(ot.x,ot.y,de,ae,this.transform.angle):new o.pointGeometry(0,0),dr=y.getSymbolInstanceIconSize(X,this.transform.zoom,Be);return this.collisionIndex.placeCollisionBox(y,dr,Xi,Kt,fe,U,E,H.predicate)};Mt&&Mt.box&&Mt.box.length&&Fe.verticalIconBox?(wt=Zi(Fe.verticalIconBox),ze=wt.box.length>0):(wt=Zi(Fe.iconBox),ze=wt.box.length>0),Ke=Ke&&wt.offscreen,at=wt.occluded}const Sr=q||be.numHorizontalGlyphVertices===0&&be.numVerticalGlyphVertices===0,zn=te||be.numIconVertices===0;if(Sr||zn?zn?Sr||(ze=ze&&it):it=ze&&it:ze=it=ze&&it,it&&jt&&jt.box&&this.collisionIndex.insertCollisionBox(jt.box,b.get("text-ignore-placement"),y.bucketInstanceId,Mt&&Mt.box&&_i?_i:Zt,H.ID),ze&&wt&&this.collisionIndex.insertCollisionBox(wt.box,b.get("icon-ignore-placement"),y.bucketInstanceId,Gi,H.ID),oi&&(it&&this.collisionIndex.insertCollisionCircles(oi.circles,b.get("text-ignore-placement"),y.bucketInstanceId,Zt,H.ID),h)){const Zi=y.bucketInstanceId;let Xi=this.collisionCircleArrays[Zi];Xi===void 0&&(Xi=this.collisionCircleArrays[Zi]=new la);for(let Kt=0;Kt<oi.circles.length;Kt+=4)Xi.circles.push(oi.circles[Kt+0]),Xi.circles.push(oi.circles[Kt+1]),Xi.circles.push(oi.circles[Kt+2]),Xi.circles.push(oi.collisionDetected?1:0)}const Kn=y.projection.name!=="globe";xe=xe&&(Kn||!Oe),Te=Te&&(Kn||!at),this.placements[be.crossTileID]=new cr(it||xe,ze||Te,Ke||y.justReloaded),s[be.crossTileID]=!0};if(he){const be=y.getSortedSymbolIndexes(this.transform.angle);for(let Be=be.length-1;Be>=0;--Be){const Fe=be[Be];Ye(y.symbolInstances.get(Fe),Fe,y.collisionArrays[Fe])}}else for(let be=r.symbolInstanceStart;be<r.symbolInstanceEnd;be++)Ye(y.symbolInstances.get(be),be,y.collisionArrays[be]);if(h&&y.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[y.bucketInstanceId];o.invert(be.invProjMatrix,E),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(r,s,h,m){let y;y=m===o.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const b=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const E of b)E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:h.crossTileID)}markUsedOrientation(r,s,h){const m=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,y=s===o.WritingMode.vertical?s:0,b=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const E of b)r.text.placedSymbolArray.get(E).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(r):1,y=s?s.opacities:{},b=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const S in this.placements){const k=this.placements[S],D=y[S];D?(this.opacities[S]=new yo(D,m,k.text,k.icon,null,k.clipped),h=h||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[S]=new yo(null,m,k.text,k.icon,k.skipFade,k.clipped),h=h||k.text||k.icon)}for(const S in y){const k=y[S];if(!this.opacities[S]){const D=new yo(k,m,!1,!1);D.isHidden()||(this.opacities[S]=D,h=h||k.text.placed||k.icon.placed)}}for(const S in b)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=b[S]);for(const S in E)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=E[S]);h?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s){const h={};for(const m of s){const y=m.getBucket(r);y&&m.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,h,m.collisionBoxArray)}}updateBucketOpacities(r,s,h){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0].layout,y=!!r.layers[0].dynamicFilter(),b=new yo(null,0,!1,!1,!0),E=m.get("text-allow-overlap"),S=m.get("icon-allow-overlap"),k=m.get("text-variable-anchor"),D=m.get("text-rotation-alignment")==="map",U=m.get("text-pitch-alignment")==="map",G=m.get("icon-text-fit")!=="none",Q=new yo(null,0,E&&(S||!r.hasIconData()||m.get("icon-optional")),S&&(E||!r.hasTextData()||m.get("text-optional")),!0);!r.collisionArrays&&h&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(h);const W=(H,q,te)=>{for(let Y=0;Y<q/4;Y++)H.opacityVertexArray.emplaceBack(te)};let X=0;for(let H=0;H<r.symbolInstances.length;H++){const q=r.symbolInstances.get(H),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:Y,crossTileID:fe}=q;let de=this.opacities[fe];s[fe]?de=b:de||(de=Q,this.opacities[fe]=de),s[fe]=!0;const ae=te>0||Y>0,pe=q.numIconVertices>0,he=this.placedOrientations[q.crossTileID],xe=he===o.WritingMode.vertical,Te=he===o.WritingMode.horizontal||he===o.WritingMode.horizontalOnly;if(!ae&&!pe||de.isHidden()||X++,ae){const Ye=Vo(de.text);W(r.text,te,xe?Cn:Ye),W(r.text,Y,Te?Cn:Ye);const be=de.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(r.text.placedSymbolArray.get(it).hidden=be||xe?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=be||Te?1:0);const Be=this.variableOffsets[q.crossTileID];Be&&this.markUsedJustification(r,Be.anchor,q,he);const Fe=this.placedOrientations[q.crossTileID];Fe&&(this.markUsedJustification(r,"left",q,Fe),this.markUsedOrientation(r,Fe,q))}if(pe){const Ye=Vo(de.icon);q.placedIconSymbolIndex>=0&&(W(r.icon,q.numIconVertices,xe?Cn:Ye),r.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=de.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(W(r.icon,q.numVerticalIconVertices,Te?Cn:Ye),r.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ye=r.collisionArrays[H];if(Ye){let be=new o.pointGeometry(0,0),Be=!0;if(Ye.textBox||Ye.verticalTextBox){if(k){const it=this.variableOffsets[fe];it?(be=xr(it.anchor,it.width,it.height,it.textOffset,it.textScale),D&&be._rotate(U?this.transform.angle:-this.transform.angle)):Be=!1}y&&(Be=!de.clipped),Ye.textBox&&dn(r.textCollisionBox.collisionVertexArray,de.text.placed,!Be||xe,be.x,be.y),Ye.verticalTextBox&&dn(r.textCollisionBox.collisionVertexArray,de.text.placed,!Be||Te,be.x,be.y)}const Fe=Be&&Boolean(!Te&&Ye.verticalIconBox);Ye.iconBox&&dn(r.iconCollisionBox.collisionVertexArray,de.icon.placed,Fe,G?be.x:0,G?be.y:0),Ye.verticalIconBox&&dn(r.iconCollisionBox.collisionVertexArray,de.icon.placed,!Fe,G?be.x:0,G?be.y:0)}}}if(r.fullyClipped=X===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=H.invProjMatrix,r.placementViewportMatrix=H.viewportMatrix,r.collisionCircleArray=H.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>r}setStale(){this.stale=!0}}function dn(c,r,s,h,m){c.emplaceBack(r?1:0,s?1:0,h||0,m||0),c.emplaceBack(r?1:0,s?1:0,h||0,m||0),c.emplaceBack(r?1:0,s?1:0,h||0,m||0),c.emplaceBack(r?1:0,s?1:0,h||0,m||0)}const ha=Math.pow(2,25),ll=Math.pow(2,24),Xp=Math.pow(2,17),kc=Math.pow(2,16),ps=Math.pow(2,9),Hp=Math.pow(2,8),Mh=Math.pow(2,1);function Vo(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const r=c.placed?1:0,s=Math.floor(127*c.opacity);return s*ha+r*ll+s*Xp+r*kc+s*ps+r*Hp+s*Mh+r}const Cn=0;class cl{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,s,h,m,y){const b=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(b,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,S)=>E.sortKey-S.sortKey));this._currentPartIndex<b.length;){const E=b[this._currentPartIndex];if(s.placeLayerBucketPart(E,this._seenCrossTileIDs,h,E.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class xo{constructor(r,s,h,m,y,b,E,S){this.placement=new zc(r,y,b,E,S),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(r,s,h){const m=o.exported.now(),y=()=>{const b=o.exported.now()-m;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=s[r[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new cl(b)),this._inProgressLayer.continuePlacement(h[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Pc=512/o.EXTENT/2;class ul{constructor(r,s,h){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<s.length;m++){const y=s.get(m),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,r)})}}getScaledCoordinates(r,s){const h=Pc/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+r.tileAnchorX)*h),y:Math.floor((s.canonical.y*o.EXTENT+r.tileAnchorY)*h)}}findMatches(r,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<r.length;y++){const b=r.get(y);if(b.crossTileID)continue;const E=this.indexedSymbolInstances[b.key];if(!E)continue;const S=this.getScaledCoordinates(b,s);for(const k of E)if(Math.abs(k.coord.x-S.x)<=m&&Math.abs(k.coord.y-S.y)<=m&&!h[k.crossTileID]){h[k.crossTileID]=!0,b.crossTileID=k.crossTileID;break}}}}class Qp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],y={};for(const b in m){const E=m[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),y[E.tileID.key]=E}this.indexes[h]=y}this.lng=r}addBucket(r,s,h){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>r.overscaledZ)for(const E in b){const S=b[E];S.tileID.isChildOf(r)&&S.findMatches(s.symbolInstances,r,m)}else{const E=b[r.scaledTo(Number(y)).key];E&&E.findMatches(s.symbolInstances,r,m)}}for(let y=0;y<s.symbolInstances.length;y++){const b=s.symbolInstances.get(y);b.crossTileID||(b.crossTileID=h.generate(),m[b.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new ul(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const h in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[r][m.crossTileID]}removeStaleBuckets(r){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const y in m)r[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[y]),delete m[y],s=!0)}return s}}class hl{constructor(){this.layerIndexes={},this.crossTileIDs=new Qp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,h,m){let y=this.layerIndexes[r.id];y===void 0&&(y=this.layerIndexes[r.id]=new Yp);let b=!1;const E={};m.name!=="globe"&&y.handleWrapJump(h);for(const S of s){const k=S.getBucket(r);k&&r.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(S.tileID,k,this.crossTileIDs)&&(b=!0),E[k.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(r){const s={};r.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const dl=(c,r)=>o.emitValidationErrors(c,r&&r.filter(s=>s.identifier!=="source.canvas")),zh=o.pick(Pt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Jp=o.pick(Pt,["setCenter","setZoom","setBearing","setPitch"]),kh={version:8,layers:[],sources:{}},Kp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class pn extends o.Evented{constructor(r,s={}){super(),this.map=r,this.dispatcher=new Oi(Ii(),this),this.imageManager=new Ft,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new hl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const h=this;this._rtlTextPluginCallback=pn.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,b)=>{if(o.triggerPluginCompletionEvent(y),b&&b.every(E=>E))for(const E in h._sourceCaches){const S=h._sourceCaches[E],k=S.getSource().type;k!=="vector"&&k!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getSource(m.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===y.id&&this._validateLayer(E)}})}loadURL(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,s.accessToken);const m=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(m,(y,b)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):b&&this._load(b,h)})}loadJSON(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(kh,!1)}_updateLayerCount(r,s){const h=s?1:-1;r.is3D()&&(this._num3DLayers+=h),r.type==="circle"&&(this._numCircleLayers+=h),r.type==="symbol"&&(this._numSymbolLayers+=h)}_load(r,s){if(s&&dl(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const m in r.sources)this.addSource(m,r.sources[m],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const h=Ci(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ri(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(s,h,m){let y,b,E;const S=o.exported.devicePixelRatio>1?"@2x":"";let k=o.getJSON(h.transformRequest(h.normalizeSpriteURL(s,S,".json"),o.ResourceType.SpriteJSON),(G,Q)=>{k=null,E||(E=G,y=Q,U())}),D=o.getImage(h.transformRequest(h.normalizeSpriteURL(s,S,".png"),o.ResourceType.SpriteImage),(G,Q)=>{D=null,E||(E=G,b=Q,U())});function U(){if(E)m(E);else if(y&&b){const G=o.exported.getImageData(b),Q={};for(const W in y){const{width:X,height:H,x:q,y:te,sdf:Y,pixelRatio:fe,stretchX:de,stretchY:ae,content:pe}=y[W],he=new o.RGBAImage({width:X,height:H});o.RGBAImage.copy(G,he,{x:q,y:te},{x:0,y:0},{width:X,height:H}),Q[W]={data:he,pixelRatio:fe,sdf:Y,stretchX:de,stretchY:ae,content:pe}}m(null,Q)}}return{cancel(){k&&(k.cancel(),k=null),D&&(D.cancel(),D=null)}}}(r,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const s=this.getSource(r.source);if(!s)return;const h=r.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const s=[];for(const h of r){const m=this._layers[h];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Kp[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const b in this._updatedSources){const E=this._updatedSources[b];E==="reload"?this._reloadSource(b):E==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const y=this._sourceCaches[m];h[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];if(y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)){const E=this._getLayerSourceCache(y);E&&(E.used=!0)}const b=this.map.painter;if(b){const E=y.getProgramIds();if(!E)continue;const S=y.getProgramConfiguration(r.zoom);for(const k of E)b.useProgram(k,S)}}for(const m in h){const y=this._sourceCaches[m];h[m]!==y.used&&y.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),dl(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Ci(r.layers);const s=function(m,y){if(!m)return[{command:Pt.setStyle,args:[y]}];let b=[];try{if(!P(m.version,y.version))return[{command:Pt.setStyle,args:[y]}];P(m.center,y.center)||b.push({command:Pt.setCenter,args:[y.center]}),P(m.zoom,y.zoom)||b.push({command:Pt.setZoom,args:[y.zoom]}),P(m.bearing,y.bearing)||b.push({command:Pt.setBearing,args:[y.bearing]}),P(m.pitch,y.pitch)||b.push({command:Pt.setPitch,args:[y.pitch]}),P(m.sprite,y.sprite)||b.push({command:Pt.setSprite,args:[y.sprite]}),P(m.glyphs,y.glyphs)||b.push({command:Pt.setGlyphs,args:[y.glyphs]}),P(m.transition,y.transition)||b.push({command:Pt.setTransition,args:[y.transition]}),P(m.light,y.light)||b.push({command:Pt.setLight,args:[y.light]}),P(m.fog,y.fog)||b.push({command:Pt.setFog,args:[y.fog]}),P(m.projection,y.projection)||b.push({command:Pt.setProjection,args:[y.projection]});const E={},S=[];(function(U,G,Q,W){let X;for(X in G=G||{},U=U||{})U.hasOwnProperty(X)&&(G.hasOwnProperty(X)||rn(X,Q,W));for(X in G)G.hasOwnProperty(X)&&(U.hasOwnProperty(X)?P(U[X],G[X])||(U[X].type==="geojson"&&G[X].type==="geojson"&&mo(U,G,X)?Q.push({command:Pt.setGeoJSONSourceData,args:[X,G[X].data]}):rr(X,G,Q,W)):Pe(X,G,Q))})(m.sources,y.sources,S,E);const k=[];m.layers&&m.layers.forEach(U=>{U.source&&E[U.source]?b.push({command:Pt.removeLayer,args:[U.id]}):k.push(U)});let D=m.terrain;D&&E[D.source]&&(b.push({command:Pt.setTerrain,args:[void 0]}),D=void 0),b=b.concat(S),P(D,y.terrain)||b.push({command:Pt.setTerrain,args:[y.terrain]}),function(U,G,Q){G=G||[];const W=(U=U||[]).map(Tn),X=G.map(Tn),H=U.reduce(sl,{}),q=G.reduce(sl,{}),te=W.slice(),Y=Object.create(null);let fe,de,ae,pe,he,xe,Te;for(fe=0,de=0;fe<W.length;fe++)ae=W[fe],q.hasOwnProperty(ae)?de++:(Q.push({command:Pt.removeLayer,args:[ae]}),te.splice(te.indexOf(ae,de),1));for(fe=0,de=0;fe<X.length;fe++)ae=X[X.length-1-fe],te[te.length-1-fe]!==ae&&(H.hasOwnProperty(ae)?(Q.push({command:Pt.removeLayer,args:[ae]}),te.splice(te.lastIndexOf(ae,te.length-de),1)):de++,xe=te[te.length-fe],Q.push({command:Pt.addLayer,args:[q[ae],xe]}),te.splice(te.length-fe,0,ae),Y[ae]=!0);for(fe=0;fe<X.length;fe++)if(ae=X[fe],pe=H[ae],he=q[ae],!Y[ae]&&!P(pe,he))if(P(pe.source,he.source)&&P(pe["source-layer"],he["source-layer"])&&P(pe.type,he.type)){for(Te in ol(pe.layout,he.layout,Q,ae,null,Pt.setLayoutProperty),ol(pe.paint,he.paint,Q,ae,null,Pt.setPaintProperty),P(pe.filter,he.filter)||Q.push({command:Pt.setFilter,args:[ae,he.filter]}),P(pe.minzoom,he.minzoom)&&P(pe.maxzoom,he.maxzoom)||Q.push({command:Pt.setLayerZoomRange,args:[ae,he.minzoom,he.maxzoom]}),pe)pe.hasOwnProperty(Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ol(pe[Te],he[Te],Q,ae,Te.slice(6),Pt.setPaintProperty):P(pe[Te],he[Te])||Q.push({command:Pt.setLayerProperty,args:[ae,Te,he[Te]]}));for(Te in he)he.hasOwnProperty(Te)&&!pe.hasOwnProperty(Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ol(pe[Te],he[Te],Q,ae,Te.slice(6),Pt.setPaintProperty):P(pe[Te],he[Te])||Q.push({command:Pt.setLayerProperty,args:[ae,Te,he[Te]]}))}else Q.push({command:Pt.removeLayer,args:[ae]}),xe=te[te.lastIndexOf(ae)+1],Q.push({command:Pt.addLayer,args:[he,xe]})}(k,y.layers,b)}catch(E){console.warn("Unable to compute style diff:",E),b=[{command:Pt.setStyle,args:[y]}]}return b}(this.serialize(),r).filter(m=>!(m.command in Jp));if(s.length===0)return!1;const h=s.filter(m=>!(m.command in zh));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&m.command!=="setProjection"&&this[m.command].apply(this,m.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,s){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,s),this._afterImageUpdated(r),this)}updateImage(r,s){this.imageManager.updateImage(r,s)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,s,h={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${r}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Ee(r,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:m.serialize(),sourceId:r}));const y=b=>{const E=(b?"symbol:":"other:")+r,S=this._sourceCaches[E]=new o.SourceCache(E,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[r]=S,S.style=this,S.onAdd(this.map)};y(!1),s.type!=="vector"&&s.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const s=this.getSource(r);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(r);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getSource(r).setData(s),this._changed=!0}getSource(r){const s=this._getSourceCache(r);return s&&s.getSource()}addLayer(r,s,h={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(r.type==="custom"){if(dl(this,o.validateCustomStyleLayer(r)))return;y=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(m,r.source),r=o.clone$1(r),r=o.extend(r,{source:m})),this._validate(o.validateLayer,`layers.${m}`,r,{arrayIndex:-1},h))return;y=o.createStyleLayer(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const E=this._getLayerSourceCache(y);if(this._removedLayers[m]&&y.source&&E&&y.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,s){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===s)return;const h=this._order.indexOf(r);this._order.splice(h,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const s=this._layers[r];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(r);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=s,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,h){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,s,h={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!P(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateFilter,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=o.clone$1(s),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const s=this.getLayer(r);return s&&o.clone$1(s.filter)}setLayoutProperty(r,s,h,m={}){this._checkLoaded();const y=this.getLayer(r);y?P(y.getLayoutProperty(s),h)||(y.setLayoutProperty(s,h,m),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,s){const h=this.getLayer(r);if(h)return h.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,s,h,m={}){this._checkLoaded();const y=this.getLayer(r);y?P(y.getPaintProperty(s),h)||(y.setPaintProperty(s,h,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,s){const h=this.getLayer(r);return h&&h.getPaintProperty(s)}setFeatureState(r,s){this._checkLoaded();const h=r.source,m=r.sourceLayer,y=this.getSource(h);if(!y)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const b=y.type;if(b==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(h);for(const S of E)S.setFeatureState(m,r.id,s)}removeFeatureState(r,s){this._checkLoaded();const h=r.source,m=this.getSource(h);if(!m)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const y=m.type,b=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(h);for(const S of E)S.removeFeatureState(b,r.id,s)}getFeatureState(r){this._checkLoaded();const s=r.source,h=r.sourceLayer,m=this.getSource(s);if(m){if(m.type!=="vector"||h)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();r[h.id]||(r[h.id]=h.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const s=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",s.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=b=>this._layers[b].type==="fill-extrusion",h={},m=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(s(E)){h[E]=b;for(const S of r){const k=S[E];if(k)for(const D of k)m.push(D)}}}m.sort((b,E)=>E.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(s(E))for(let S=m.length-1;S>=0;S--){const k=m[S].feature;if(h[k.layer.id]<b)break;y.push(k),m.pop()}else for(const S of r){const k=S[E];if(k)for(const D of k)y.push(D.feature)}}return y}queryRenderedFeatures(r,s,h){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of s.layers){const k=this._layers[S];if(!k)return this.fire(new o.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];m[k.source]=!0}}const y=[];s.availableImages=this._availableImages;const b=s&&s.layers?s.layers.some(S=>{const k=this.getLayer(S);return k&&k.is3D()}):this.has3DLayers(),E=$e.createFromScreenPoints(r,h);for(const S in this._sourceCaches){const k=this._sourceCaches[S].getSource().id;s.layers&&!m[k]||y.push(ht(this._sourceCaches[S],this._layers,this._serializedLayers,E,s,h,b,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(S,k,D,U,G,Q,W){const X={},H=Q.queryRenderedSymbols(U),q=[];for(const te of Object.keys(H).map(Number))q.push(W[te]);q.sort(Lt);for(const te of q){const Y=te.featureIndex.lookupSymbolFeatures(H[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,G.filter,G.layers,G.availableImages,S);for(const fe in Y){const de=X[fe]=X[fe]||[],ae=Y[fe];ae.sort((pe,he)=>{const xe=te.featureSortOrder;if(xe){const Te=xe.indexOf(pe.featureIndex);return xe.indexOf(he.featureIndex)-Te}return he.featureIndex-pe.featureIndex});for(const pe of ae)de.push(pe)}}for(const te in X)X[te].forEach(Y=>{const fe=Y.feature,de=D(S[te]).getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=de});return X}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(r);let m=[];for(const y of h)m=m.concat(qe(y,s));return m}addSourceType(r,s,h){return pn.getSourceType(r)?h(new Error(`A source type called "${r}" already exists.`)):(pn.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(r,s={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const b in r)if(!P(r[b],h[b])){m=!0;break}if(!m)return;const y=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,s),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,s=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof r.source=="object"){const h="terrain-dem-src";this.addSource(h,r.source),r=o.clone$1(r),r=o.extend(r,{source:h})}if(this._validate(o.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(r,s);else{const h=this.terrain,m=h.get();for(const y of Object.keys(o.spec.terrain))!r.hasOwnProperty(y)&&o.spec.terrain[y].default&&(r[y]=o.spec.terrain[y].default);for(const y in r)if(!P(r[y],m[y])){h.set(r),this.stylesheet.terrain=r;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new Ai(r,this.map.transform);this.stylesheet.fog=r;const h=this._setTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();Object.keys(r).length===0&&s.set(r);for(const m in r)if(!P(r[m],h[m])){s.set(r),this.stylesheet.fog=r;const y=this._setTransitionParameters({duration:0});s.updateTransitions(y);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const h=this.terrain=new fi(r,s);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m=this._setTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,h,m,y={}){return(!y||y.validate!==!1)&&dl(this,r.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:h,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const s=this._getSourceCaches(r);for(const h of s)h.clearTiles()}_reloadSource(r){const s=this._getSourceCaches(r);for(const h of s)h.resume(),h.reload()}_updateSources(r){for(const s in this._sourceCaches)this._sourceCaches[s].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,h,m,y=!1){let b=!1,E=!1;const S={};for(const k of this._order){const D=this._layers[k];if(D.type!=="symbol")continue;if(!S[D.source]){const G=this._getLayerSourceCache(D);if(!G)continue;S[D.source]=G.getRenderableIds(!0).map(Q=>G.getTileByID(Q)).sort((Q,W)=>W.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(W.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(D,S[D.source],r.center.lng,r.projection);b=b||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new xo(r,this._order,y,s,h,m,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(const k of this._order){const D=this._layers[k];D.type==="symbol"&&this.placement.updateLayerOpacities(D,S[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const m=y=>{y&&y.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(r,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(r,s,h){return o.makeRequest(s,h)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this._getSourceCaches(r);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}pn.getSourceType=function(c){return ye[c]},pn.setSourceType=function(c,r){ye[c]=r},pn.registerForPluginStateChange=o.registerForPluginStateChange;var Dc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Bc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Rc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let pl={},jo={};const vo=[];No(Dc,vo),No(Lc,vo),No(Rc,vo),No(fs,vo),pl=xi("",Lc),jo=xi(fs,Rc);const da=xi(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),fl=Dc,ml=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var _l={background:xi(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:xi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:xi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:xi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:xi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:xi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:xi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:xi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:xi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:xi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:xi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:xi(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:xi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:xi(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:xi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:xi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:xi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:xi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:xi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:xi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:xi(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:xi(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bc),skyboxGradient:xi(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bc),skyboxCapture:xi(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:xi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:xi(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function No(c,r){const s=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const y of m)r.includes(y)||r.push(y)}}function xi(c,r){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),m={},y=[...vo];return No(c,y),No(r,y),{fragmentSource:c=c.replace(s,(b,E,S,k,D)=>(m[D]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${S} ${k} ${D};
#else
uniform ${S} ${k} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${S} ${k} ${D} = u_${D};
#endif
`)),vertexSource:r=r.replace(s,(b,E,S,k,D)=>{const U=k==="float"?"vec2":"vec4",G=D.match(/color/)?"color":U;return m[D]?E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${S} ${U} a_${D};
varying ${S} ${k} ${D};
#else
uniform ${S} ${k} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${S} ${k} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${S} ${k} ${D} = u_${D};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${S} ${U} a_${D};
#else
uniform ${S} ${k} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${S} ${k} ${D} = a_${D};
#else
    ${S} ${k} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${S} ${k} ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${S} ${k} ${D} = u_${D};
#endif
`}),staticAttributes:h,usedDefines:y}}class gl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,h,m,y,b,E){this.context=r;let S=this.boundPaintVertexBuffers.length!==m.length;for(let D=0;!S&&D<m.length;D++)this.boundPaintVertexBuffers[D]!==m[D]&&(S=!0);let k=this.boundDynamicVertexBuffers.length!==E.length;for(let D=0;!k&&D<E.length;D++)this.boundDynamicVertexBuffers[D]!==E[D]&&(k=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||S||k||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(s,h,m,y,b,E);else{r.bindVertexArrayOES.set(this.vao);for(const D of E)D&&D.bind();y&&y.dynamicDraw&&y.bind()}}freshBind(r,s,h,m,y,b){let E;const S=r.numAttributes,k=this.context,D=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b;else{E=k.currentNumAttributes||0;for(let U=S;U<E;U++)D.disableVertexAttribArray(U)}s.enableAttributes(D,r),s.bind(),s.setVertexAttribPointers(D,r,y);for(const U of h)U.enableAttributes(D,r),U.bind(),U.setVertexAttribPointers(D,r,y);for(const U of b)U&&(U.enableAttributes(D,r),U.bind(),U.setVertexAttribPointers(D,r,y));m&&m.bind(),k.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Oc(c,r){const s=Math.pow(2,r.canonical.z),h=r.canonical.y;return[new o.MercatorCoordinate(0,h/s).toLngLat().lat,new o.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function Fc(c,r,s,h,m,y,b){const E=c.context,S=E.gl,k=s.fbo;if(!k)return;c.prepareDrawTile();const D=c.useProgram("hillshade");E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get());const U=((X,H,q,te)=>{const Y=q.paint.get("hillshade-shadow-color"),fe=q.paint.get("hillshade-highlight-color"),de=q.paint.get("hillshade-accent-color");let ae=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=X.transform.angle);const pe=!X.options.moving;return{u_matrix:te||X.transform.calculateProjMatrix(H.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Oc(0,H.tileID),u_light:[q.paint.get("hillshade-exaggeration"),ae],u_shadow:Y,u_highlight:fe,u_accent:de}})(c,s,h,c.terrain?r.projMatrix:null);c.prepareDrawProgram(E,D,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Q,tileBoundsSegments:W}=c.getTileBoundsBuffers(s);D.draw(E,S.TRIANGLES,m,y,b,o.CullFaceMode.disabled,U,h.id,G,Q,W)}function mi(c,r,s){if(!r.needsDEMTextureUpload)return;const h=c.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||c.getTileTexture(s.stride);const y=s.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new o.Texture(h,y,m.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function ms(c,r,s,h,m,y){const b=c.context,E=b.gl;if(!r.dem)return;const S=r.dem;if(b.activeTexture.set(E.TEXTURE1),mi(c,r,S),!r.demTexture)return;r.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=S.dim;b.activeTexture.set(E.TEXTURE0);let D=r.fbo;if(!D){const W=new o.Texture(b,{width:k,height:k,data:null},E.RGBA);W.bind(E.LINEAR,E.CLAMP_TO_EDGE),D=r.fbo=b.createFramebuffer(k,k,!0),D.colorAttachment.set(W.texture)}b.bindFramebuffer.set(D.framebuffer),b.viewport.set([0,0,k,k]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:Q}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(b,E.TRIANGLES,h,m,y,o.CullFaceMode.disabled,((W,X)=>{const H=X.stride,q=o.create();return o.ortho(q,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(q,q,[0,-o.EXTENT,0]),{u_matrix:q,u_image:1,u_dimension:[H,H],u_zoom:W.overscaledZ,u_unpack:X.unpackVector}})(r.tileID,S),s.id,U,G,Q),r.needsHillshadePrepare=!1}const pa=c=>({u_matrix:new o.UniformMatrix4f(c),u_image0:new o.Uniform1i(c),u_skirt_height:new o.Uniform1f(c)}),Uc=(c,r)=>({u_matrix:c,u_image0:0,u_skirt_height:r}),Vc=(c,r,s,h,m,y,b,E,S,k,D,U,G,Q)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:S,u_frustum_bl:k,u_globe_pos:D,u_globe_radius:U,u_viewport:G,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9)});function jc(c,r){return c!=null&&r!=null&&!(!c.hasData()||!r.hasData())&&c.demTexture!=null&&r.demTexture!=null&&c.tileID.key!==r.tileID.key}const Ao=new class{constructor(){this.operations={}}newMorphing(c,r,s,h,m){if(c in this.operations){const y=this.operations[c];y.to.tileID.key!==s.tileID.key&&(y.queued=s)}else this.operations[c]={startTime:h,phase:0,duration:m,from:r,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const r=this.operations[c];return{from:r.from,to:r.to,phase:r.phase}}update(c){for(const r in this.operations){const s=this.operations[r];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[r];break}}}_nextOp(c,r){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=r,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},fa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ef(c,r){const s=1<<c.z;return!r&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}const Nc=c=>({u_matrix:c});function yl(c,r,s,h,m){if(m>0){const y=o.exported.now(),b=(y-c.timeAdded)/m,E=r?(y-r.timeAdded)/m:-1,S=s.getSource(),k=h.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),D=!r||Math.abs(r.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),U=D&&c.refreshedUponExpiration?1:o.clamp(D?b:1-E,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class $c extends o.SourceCache{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},h=new Oi(Ii(),null),m=Ee("mock-dem",s,h,r.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class Gc extends o.SourceCache{constructor(r){const s=Ee("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Oi(Ii(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,h){if(r.freezeTileCoverage)return;this.transform=r;const m=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const E=new o.Tile(b,this._source.tileSize*b.overscaleFactor(),r.tileZoom);E.state="loaded",this._tiles[b.key]=E}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xl extends o.OverscaledTileID{constructor(r,s,h){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Ph extends o.Elevation{constructor(r,s){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,y]=function(S){const k=new o.StructArrayLayout4i8,D=new o.StructArrayLayout3ui6,U=131;k.reserve(17161),D.reserve(33800);const G=o.EXTENT/128,Q=o.EXTENT+G/2,W=Q+G;for(let H=-G;H<W;H+=G)for(let q=-G;q<W;q+=G){const te=q<0||q>Q||H<0||H>Q?24575:0,Y=o.clamp(Math.round(q),0,o.EXTENT),fe=o.clamp(Math.round(H),0,o.EXTENT);k.emplaceBack(Y+te,fe,Y,fe)}const X=(H,q)=>{const te=q*U+H;D.emplaceBack(te+1,te,te+U),D.emplaceBack(te+U,te+U+1,te+1)};for(let H=1;H<129;H++)for(let q=1;q<129;q++)X(q,H);return[0,129].forEach(H=>{for(let q=0;q<130;q++)X(q,H),X(H,q)}),[k,D,32768]}(),b=r.context;this.gridBuffer=b.createVertexBuffer(h,o.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gc(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const E=b.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $c(s.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,s,h){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const m=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const y=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(s,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),s.updateElevation(!h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(S=>{const k=s.getTileByID(S).tileID;return k.projMatrix=h.calculateProjMatrix(k.toUnwrapped()),k});(function(S,k){const D=k.transform.pointCoordinate(k.transform.getCameraPoint()),U=new o.pointGeometry(D.x,D.y);S.sort((G,Q)=>{if(Q.overscaledZ-G.overscaledZ)return Q.overscaledZ-G.overscaledZ;const W=new o.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),X=new o.pointGeometry(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),H=U.mult(1<<G.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(W)-H.distSqr(X)})})(m,this.painter),this._previousZoom=h.zoom;const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const S in b){const k=b[S];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,r[S],y),k.usedForTerrain))continue;const D=r[S];k.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[s.id]=m.map(S=>new xl(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const k=this.terrainTileForTile[S.key];if(!k)continue;const D=k.tileID.key;D in E||(this._visibleDemTiles.push(k),E[D]=D)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),mi(this.painter,m,y))}}_prepareDemTileUniforms(r,s,h,m){if(!s||s.demTexture==null)return!1;const y=r.tileID.canonical,b=Math.pow(2,s.tileID.canonical.z-y.z),E=m||"";return h[`u_dem_tl${E}`]=[y.x*b%1,y.y*b%1],h[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,s=r.gl;if(!this._emptyDepthBufferTexture){const h=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const y=m.dem.tree.minimums[0];return y>0&&r++,h+y},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new o.Texture(r,m,s.RGBA,{premultiply:!1}),y}setupElevationDraw(r,s,h){const m=this.painter.context,y=m.gl,b=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();const S=this.painter.transform,k=S.projection,D=r.tileID.canonical;b.u_tile_tl_up=k.upVector(D,0,0),b.u_tile_tr_up=k.upVector(D,o.EXTENT,0),b.u_tile_br_up=k.upVector(D,o.EXTENT,o.EXTENT),b.u_tile_bl_up=k.upVector(D,0,o.EXTENT),b.u_tile_up_scale=h&&h.useDenormalizedUpVectorScale?o.GLOBE_METERS_TO_ECEF:k.upVectorScale(D,S.center.lat,S.worldSize).metersToTile;let U=null,G=null,Q=1;if(h&&h.morphing&&this._useVertexMorphing){const W=h.morphing.srcDemTile,X=h.morphing.dstDemTile;Q=h.morphing.phase,W&&X&&(this._prepareDemTileUniforms(r,W,b,"_prev")&&(G=W),this._prepareDemTileUniforms(r,X,b)&&(U=X))}if(G&&U?(m.activeTexture.set(y.TEXTURE2),U.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),m.activeTexture.set(y.TEXTURE4),G.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),b.u_dem_lerp=Q):(U=this.terrainTileForTile[r.tileID.key],m.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(r,U,b)?U.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),m.activeTexture.set(y.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&U){const W=(1<<U.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=W}h&&h.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,b)}renderToBackBuffer(r){const s=this.painter,h=this.painter.context;r.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,b,E,S){if(m.transform.projection.name==="globe")(function(k,D,U,G,Q){const W=k.context,X=W.gl;let H,q;const te=k.options.showTerrainWireframe?2:0,Y=k.transform,fe=o.globeUseCustomAntiAliasing(k,W,Y),de=(it,ze)=>{if(q===it)return;const Ke=[fa[it],"PROJECTION_GLOBE_VIEW"];fe&&Ke.push("CUSTOM_ANTIALIASING"),ze&&Ke.push(fa[te]),H=k.useProgram("globeRaster",null,Ke),q=it},ae=k.colorModeForRenderPass(),pe=new o.DepthMode(X.LEQUAL,o.DepthMode.ReadWrite,k.depthRangeFor3D);Ao.update(Q);const he=o.calculateGlobeMercatorMatrix(Y),xe=[o.mercatorXfromLng(Y.center.lng),o.mercatorYfromLat(Y.center.lat)],Te=te?[!1,!0]:[!1],Ye=k.globeSharedBuffers,be=[Y.width*o.exported.devicePixelRatio,Y.height*o.exported.devicePixelRatio],Be=Float32Array.from(Y.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};if(Te.forEach(it=>{q=-1;const ze=it?X.LINES:X.TRIANGLES;for(const Ke of G){const Oe=U.getTile(Ke),at=o.StencilMode.disabled,ot=D.prevTerrainTileForTile[Ke.key],bt=D.terrainTileForTile[Ke.key];jc(ot,bt)&&Ao.newMorphing(Ke.key,ot,bt,Q,250),W.activeTexture.set(X.TEXTURE0),Oe.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Mt=Ao.getMorphValuesForProxy(Ke.key),jt=Mt?1:0;Mt&&o.extend$1(Fe,{morphing:{srcDemTile:Mt.from,dstDemTile:Mt.to,phase:o.easeCubicInOut(Mt.phase)}});const oi=o.tileCornersToBounds(Ke.canonical),wt=o.getLatitudinalLod(oi.getCenter().lat),Zt=o.getGridMatrix(Ke.canonical,oi,wt),_i=o.globeNormalizeECEF(o.globeTileBounds(Ke.canonical)),Gi=Vc(Y.projMatrix,Be,he,_i,o.globeToMercatorTransition(Y.zoom),xe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,be,Zt);if(de(jt,it),D.setupElevationDraw(Oe,H,Fe),k.prepareDrawProgram(W,H,Ke.toUnwrapped()),Ye){const[nr,zi,Sr]=it?Ye.getWirefameBuffers(k.context,wt):Ye.getGridBuffers(wt);H.draw(W,ze,pe,at,ae,o.CullFaceMode.backCCW,Gi,"globe_raster",nr,zi,Sr)}}}),Ye){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&it.push("CUSTOM_ANTIALIASING"),H=k.useProgram("globeRaster",null,it);for(const ze of G){const{x:Ke,y:Oe,z:at}=ze.canonical,ot=Oe===0,bt=Oe===(1<<at)-1,[Mt,jt,oi,wt]=Ye.getPoleBuffers(at);if(wt&&(ot||bt)){const Zt=U.getTile(ze);W.activeTexture.set(X.TEXTURE0),Zt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let _i=o.globePoleMatrixForTile(at,Ke,Y);const Gi=o.globeNormalizeECEF(o.globeTileBounds(ze.canonical)),nr=(zi,Sr)=>zi.draw(W,X.TRIANGLES,pe,o.StencilMode.disabled,ae,o.CullFaceMode.disabled,Vc(Y.projMatrix,_i,_i,Gi,0,xe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,be),"globe_pole_raster",Sr,oi,wt);D.setupElevationDraw(Zt,H,Fe),k.prepareDrawProgram(W,H,ze.toUnwrapped()),ot&&nr(H,Mt),bt&&(_i=o.scale(o.create(),_i,[1,-1,1]),nr(H,jt))}}}})(m,y,b,E,S);else{const k=m.context,D=k.gl;let U,G;const Q=m.options.showTerrainWireframe?2:0,W=(Y,fe)=>{if(G===Y)return;const de=[fa[Y]];fe&&de.push(fa[Q]),U=m.useProgram("terrainRaster",null,de),G=Y},X=m.colorModeForRenderPass(),H=new o.DepthMode(D.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);Ao.update(S);const q=m.transform,te=6*Math.pow(1.5,22-q.zoom)*y.exaggeration();(Q?[!1,!0]:[!1]).forEach(Y=>{G=-1;const fe=Y?D.LINES:D.TRIANGLES,[de,ae]=Y?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const pe of E){const he=b.getTile(pe),xe=o.StencilMode.disabled,Te=y.prevTerrainTileForTile[pe.key],Ye=y.terrainTileForTile[pe.key];jc(Te,Ye)&&Ao.newMorphing(pe.key,Te,Ye,S,250),k.activeTexture.set(D.TEXTURE0),he.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const be=Ao.getMorphValuesForProxy(pe.key),Be=be?1:0;let Fe;be&&(Fe={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:o.easeCubicInOut(be.phase)}});const it=Uc(pe.projMatrix,ef(pe.canonical,q.renderWorldCopies)?te/10:te);W(Be,Y),y.setupElevationDraw(he,U,Fe),m.prepareDrawProgram(k,U,pe.toUnwrapped()),U.draw(k,fe,H,xe,X,o.CullFaceMode.backCCW,it,"terrain_raster",y.gridBuffer,de,ae)}})}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),E=[],S=s.style.order;let k=0;for(const D of y){const U=m.getTileByID(D.proxyTileKey),G=m.proxyCachedFBO[D.key]?m.proxyCachedFBO[D.key][r]:void 0,Q=G!==void 0?m.renderCache[G]:this.pool[k++],W=G!==void 0;if(U.texture=Q.tex,W&&!Q.dirty){E.push(U.tileID);continue}let X;h.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(h.clear({color:o.Color.transparent,stencil:0}),Q.dirty=!1);for(let H=b.start;H<=b.end;++H){const q=s.style._layers[S[H]];if(q.isHidden(s.transform.zoom))continue;const te=s.style._getLayerSourceCache(q),Y=te?this.proxyToSource[D.key][te.id]:[D];if(!Y)continue;const fe=Y;h.viewport.set([0,0,Q.fb.width,Q.fb.height]),X!==(te?te.id:null)&&(this._setupStencil(Q,Y,q,te),X=te?te.id:null),s.renderLayer(s,te,q,fe)}this.renderedToTile?(Q.dirty=!0,E.push(U.tileID)):W||--k,k===5&&(k=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),b.end+1}postRender(){}renderCacheEfficiency(r){const s=r.order.length;if(s===0)return{efficiency:100};let h,m=0,y=0,b=!1;for(let E=0;E<s;++E){const S=r._layers[r.order[E]];this._style.isLayerDraped(S)?(b&&++m,++y):b||(b=!0,h=S.id)}return y===0?{efficiency:100}:{efficiency:100*(1-m/y),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,E=1<<b.overscaledZ,{x:S,y:k}=b.canonical,D=S/E,U=(S+1)/E,G=k/E,Q=(k+1)/E;return{minx:D,miny:G,maxx:U,maxy:Q,t:y.dem.tree.raycastRoot(D,G,U,Q,r,s,h),tile:y}});m.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,s,h);if(b!=null)return b}return null}_createFBO(){const r=this.painter.context,s=r.gl,h=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const m=new o.Texture(r,{width:h[0],height:h[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const y=r.createFramebuffer(h[0],h[1],!1);return y.colorAttachment.set(m.texture),y.depthAttachment=new O(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._layers[r],h=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),y=!!m&&m.t!==1,b=s.hasTransition();return s.type!=="custom"&&!h&&(y||b)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof re){r=!0;break}if(r)for(let s=0;s<this._style.order.length;++s){const h=this._style._layers[this._style.order[s]],m=h.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!y)continue;const b=h.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const S=this.proxyToSource[E.key][y.id];if(S)for(const k of S){const D=yl(y.getTile(k),y.findLoadedParent(k,0),y,this.painter.transform,b);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(y.id,k)}}}}_setupDrapedRenderBatches(){const r=this._style.order,s=r.length;if(s===0)return;const h=[];let m,y=0,b=this._style._layers[r[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<s;)b=this._style._layers[r[y]];for(;y<s;++y){const E=this._style._layers[r[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?m===void 0&&(m=y):m!==void 0&&(h.push({start:m,end:y-1}),m=void 0))}m!==void 0&&h.push({start:m,end:y-1}),this._drapedRenderBatches=h}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const b=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let E=0;E<b.length;++E){const S=Object.values(b[E]);s.renderCachePool.push(...S)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let b=h.length-1;b>=0;b--){const E=h[b];if(s.getTileByID(E.key),s.proxyCachedFBO[E.key]!==void 0){const S=r[E.key],k=this.proxyToSource[E.key];let D=0;for(const U in k){const G=k[U],Q=S[U];if(!Q||Q.length!==G.length||G.some((W,X)=>W!==Q[X]||m[U]&&m[U].hasOwnProperty(W.key))){D=-1;break}++D}for(const U in s.proxyCachedFBO[E.key])s.renderCache[s.proxyCachedFBO[E.key][U]].dirty=D<0||D!==Object.values(S).length}}const y=[...this._drapedRenderBatches];y.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of y)for(const E of h){if(s.proxyCachedFBO[E.key])continue;let S=s.renderCachePool.pop();S===void 0&&s.renderCache.length<50&&(S=s.renderCache.length,s.renderCache.push(this._createFBO())),S!==void 0&&(s.proxyCachedFBO[E.key]={},s.proxyCachedFBO[E.key][b.start]=S,s.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let E;if(h.isTileClipped())E=s.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,s){const h=this.painter,m=this.painter.context,y=m.gl;h._tileClippingMaskIDs={},m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const b=h.useProgram("clippingMask");for(const E of r){const S=h._tileClippingMaskIDs[E.key]=--s;b.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},S,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Nc(E.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const h=[r.x,r.y,1,1];o.transformMat4$1(h,h,s.pixelMatrixInverse),o.scale$1(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,y=o.mercatorZfromAltitude(1,s.center.lat),b=[m[0],m[1],m[2]/y,0],E=o.subtract([],h.slice(0,3),b);o.normalize(E,E);const S=this.raycast(b,E,this._exaggeration);return S!==null&&S?(o.scaleAndAdd(b,b,E,S),b[3]=b[2],b[2]*=y,b):null}drawDepth(){const r=this.painter,s=r.context,h=this.proxySourceCache,m=Math.ceil(r.width),y=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=s.gl,E=s.createFramebuffer(m,y,!0);s.activeTexture.set(b.TEXTURE0);const S=new o.Texture(s,{width:m,height:y,data:null},b.RGBA);S.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.colorAttachment.set(S.texture);const k=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,y);E.depthAttachment.set(k),this._depthFBO=E,this._depthTexture=S}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,y]),function(b,E,S,k){if(b.transform.projection.name==="globe")return;const D=b.context,U=D.gl;D.clear({depth:1});const G=b.useProgram("terrainDepth"),Q=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,b.depthRangeFor3D);for(const W of k){const X=S.getTile(W),H=Uc(W.projMatrix,0);E.setupElevationDraw(X,G),G.draw(D,U.TRIANGLES,Q,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,H,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(r,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,s,h){if(r.getSource()instanceof Ae)return this._setupProxiedCoordsForImageSource(r,s,h);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const m=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const S=y[E],k=this._findTileCoveringTileID(S,r);if(k){const D=this._createProxiedId(S,k,h[S.key]&&h[S.key][r.id]);m.push(D),this.proxyToSource[S.key][r.id]=[D]}}let b=!1;for(let E=0;E<s.length;E++){const S=r.getTile(s[E]);if(!S||!S.hasData())continue;const k=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==S.tileID.canonical.z){const D=this.proxyToSource[k.tileID.key][r.id],U=this._createProxiedId(k.tileID,S,h[k.tileID.key]&&h[k.tileID.key][r.id]);D?D.splice(D.length-1,0,U):this.proxyToSource[k.tileID.key][r.id]=[U],m.push(U),b=!0}}this._sourceTilesOverlap[r.id]=b}_setupProxiedCoordsForImageSource(r,s,h){if(!r.getSource().loaded())return;const m=this.proxiedCoords[r.id]=[],y=this.proxyCoords,b=r.getSource(),E=new o.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),S=b.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((D,U)=>(D.min.x=Math.min(D.min.x,U.x-E.x),D.min.y=Math.min(D.min.y,U.y-E.y),D.max.x=Math.max(D.max.x,U.x-E.x),D.max.y=Math.max(D.max.y,U.y-E.y),D),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(D,U)=>{const G=D.wrap+D.canonical.x/(1<<D.canonical.z),Q=D.canonical.y/(1<<D.canonical.z),W=o.EXTENT/(1<<D.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),H=U.canonical.y/(1<<U.canonical.z);return G+W<X+S.min.x||G>X+S.max.x||Q+W<H+S.min.y||Q>H+S.max.y};for(let D=0;D<y.length;D++){const U=y[D];for(let G=0;G<s.length;G++){const Q=r.getTile(s[G]);if(!Q||!Q.hasData()||k(U,Q.tileID))continue;const W=this._createProxiedId(U,Q,h[U.key]&&h[U.key][r.id]),X=this.proxyToSource[U.key][r.id];X?X.push(W):this.proxyToSource[U.key][r.id]=[W],m.push(W)}}}_createProxiedId(r,s,h){let m=this.orthoMatrix;if(h){const y=h.find(b=>b.key===s.tileID.key);if(y)return y}if(s.tileID.key!==r.key){const y=r.canonical.z-s.tileID.canonical.z;let b,E,S;m=o.create();const k=s.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(b=o.EXTENT>>y,E=b*((s.tileID.canonical.x<<y)-r.canonical.x+k),S=b*((s.tileID.canonical.y<<y)-r.canonical.y)):(b=o.EXTENT<<-y,E=o.EXTENT*(s.tileID.canonical.x-(r.canonical.x+k<<-y)),S=o.EXTENT*(s.tileID.canonical.y-(r.canonical.y<<-y))),o.ortho(m,0,b,0,b,0,1),o.translate(m,m,[E,S,0])}return new xl(s.tileID,r.key,m)}_findTileCoveringTileID(r,s){let h=s.getTile(r);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],y=m[r.key];if(h=y?s.getTileByID(y):null,h&&h.hasData()||y===null)return h;let b=h?h.tileID:r,E=b.overscaledZ;const S=s.getSource().minzoom,k=[];if(!y){const U=s.getSource().maxzoom;if(r.canonical.z>=U){const G=r.canonical.z-U;s.getSource().reparseOverscaled?(E=Math.max(r.canonical.z+2,s.transform.tileZoom),b=new o.OverscaledTileID(E,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G)):G!==0&&(E=U,b=new o.OverscaledTileID(E,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G))}b.key!==r.key&&(k.push(b.key),h=s.getTile(b))}const D=U=>{k.forEach(G=>{m[G]=U}),k.length=0};for(E-=1;E>=S&&(!h||!h.hasData());E--){h&&D(h.tileID.key);const U=b.calculateScaledKey(E);if(h=s.getTileByID(U),h&&h.hasData())break;const G=m[U];if(G===null)break;G===void 0?k.push(U):h=s.getTileByID(G)}return D(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let h=this._tilesDirty[r];h||(h=this._tilesDirty[r]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(s){let h=0;const m=new o.StructArrayLayout2ui4,y=131;for(let b=1;b<129;b++){for(let E=1;E<129;E++)h=b*y+E,m.emplaceBack(h,h+1),m.emplaceBack(h,h+y),m.emplaceBack(h+1,h+y),b===128&&m.emplaceBack(h+y,h+y+1);m.emplaceBack(h+1,h+1+y)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Zc{static cacheKey(r,s,h,m){let y=`${s}${m?m.cacheKey:""}`;for(const b of h)r.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(r,s,h,m,y,b){const E=r.gl;this.program=E.createProgram();const S=function(H){const q=[];for(let te=0;te<H.length;te++){if(H[te]===null)continue;const Y=H[te].split(" ");q.push(Y.pop())}return q}(h.staticAttributes),k=m?m.getBinderAttributes():[],D=S.concat(k);let U=m?m.defines():[];U=U.concat(b.map(H=>`#define ${H}`));const G=U.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(ml):ml,ml,fl,da.fragmentSource,jo.fragmentSource,h.fragmentSource).join(`
`),Q=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,fl,da.vertexSource,jo.vertexSource,pl.vertexSource,h.vertexSource).join(`
`),W=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(W,G),E.compileShader(W),E.attachShader(this.program,W);const X=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(X,Q),E.compileShader(X),E.attachShader(this.program,X),this.attributes={},this.numAttributes=D.length;for(let H=0;H<this.numAttributes;H++)D[H]&&(E.bindAttribLocation(this.program,H,D[H]),this.attributes[D[H]]=H);E.linkProgram(this.program),E.deleteShader(X),E.deleteShader(W),this.fixedUniforms=y(r),this.binderUniforms=m?m.getUniforms(r):[],b.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(H=>({u_dem:new o.Uniform1i(H),u_dem_prev:new o.Uniform1i(H),u_dem_unpack:new o.Uniform4f(H),u_dem_tl:new o.Uniform2f(H),u_dem_scale:new o.Uniform1f(H),u_dem_tl_prev:new o.Uniform2f(H),u_dem_scale_prev:new o.Uniform1f(H),u_dem_size:new o.Uniform1f(H),u_dem_lerp:new o.Uniform1f(H),u_exaggeration:new o.Uniform1f(H),u_depth:new o.Uniform1i(H),u_depth_size_inv:new o.Uniform2f(H),u_meter_to_dem:new o.Uniform1f(H),u_label_plane_matrix_inv:new o.UniformMatrix4f(H),u_tile_tl_up:new o.Uniform3f(H),u_tile_tr_up:new o.Uniform3f(H),u_tile_br_up:new o.Uniform3f(H),u_tile_bl_up:new o.Uniform3f(H),u_tile_up_scale:new o.Uniform1f(H)}))(r)),b.indexOf("FOG")!==-1&&(this.fogUniforms=(H=>({u_fog_matrix:new o.UniformMatrix4f(H),u_fog_range:new o.Uniform2f(H),u_fog_color:new o.Uniform4f(H),u_fog_horizon_blend:new o.Uniform1f(H),u_fog_temporal_offset:new o.Uniform1f(H),u_frustum_tl:new o.Uniform3f(H),u_frustum_tr:new o.Uniform3f(H),u_frustum_br:new o.Uniform3f(H),u_frustum_bl:new o.Uniform3f(H),u_globe_pos:new o.Uniform3f(H),u_globe_radius:new o.Uniform1f(H),u_globe_transition:new o.Uniform1f(H),u_is_globe:new o.Uniform1i(H),u_viewport:new o.Uniform2f(H)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}draw(r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X){const H=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(h),r.setStencilMode(m),r.setColorMode(y),r.setCullFace(b);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,E[te]);W&&W.setUniforms(this.program,r,this.binderUniforms,G,{zoom:Q});const q={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[s];for(const te of U.get()){const Y=te.vaos||(te.vaos={});(Y[S]||(Y[S]=new gl)).bind(r,this,k,W?W.getPaintVertexBuffers():[],D,te.vertexOffset,X||[]),H.drawElements(s,te.primitiveLength*q,H.UNSIGNED_SHORT,te.primitiveOffset*q*2)}}}function Dh(c,r,s){const h=1/tn(s,1,r.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,r.transform.tileZoom)/m,b=y*(s.tileID.canonical.x+s.tileID.wrap*m),E=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const ma=o.create(),_s=(c,r,s,h,m,y,b,E,S,k,D)=>{const U=r.style.light,G=U.properties.get("position"),Q=[G.x,G.y,G.z],W=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(W,-r.transform.angle),o.transformMat3(Q,Q,W));const X=U.properties.get("color"),H=r.transform,q={u_matrix:c,u_lightpos:Q,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ma,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:y};return H.projection.name==="globe"&&(q.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],q.u_zoom_transition=S,q.u_inv_rot_matrix=D,q.u_merc_center=k,q.u_up_dir=H.projection.upVector(new o.CanonicalTileID(0,0,0),k[0]*o.EXTENT,k[1]*o.EXTENT),q.u_height_lift=E),q},Bh=(c,r,s,h,m,y,b,E,S,k,D,U,G)=>{const Q=_s(c,r,s,h,m,y,b,k,D,U,G),W={u_height_factor:-Math.pow(2,b.overscaledZ)/S.tileSize/8};return o.extend(Q,Dh(E,r,S),W)},_a=c=>({u_matrix:c}),vl=(c,r,s,h)=>o.extend(_a(c),Dh(s,r,h)),Vn=(c,r)=>({u_matrix:c,u_world:r}),qc=(c,r,s,h,m)=>o.extend(vl(c,r,s,h),{u_world:m}),Lh=o.create(),Wc=(c,r,s,h,m,y)=>{const b=c.transform,E=b.projection.name==="globe";let S;if(y.paint.get("circle-pitch-alignment")==="map")if(E){const D=o.globePixelsToTileUnits(b.zoom,r.canonical)*b._pixelsPerMercatorPixel;S=Float32Array.from([D,0,0,D])}else S=b.calculatePixelsToTileUnitsMatrix(s);else S=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:c.translatePosMatrix(r.projMatrix,s,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Lh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){k.u_inv_rot_matrix=h,k.u_merc_center=m,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=o.globeToMercatorTransition(b.zoom);const D=m[0]*o.EXTENT,U=m[1]*o.EXTENT;k.u_up_dir=b.projection.upVector(new o.CanonicalTileID(0,0,0),D,U)}return k},Rh=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},Xc=(c,r,s,h)=>{const m=o.EXTENT/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:r.getCameraToCenterDistance(h),u_extrude_scale:[r.pixelsToGLUnits[0]/m,r.pixelsToGLUnits[1]/m]}},Oh=(c,r,s=1)=>({u_matrix:c,u_color:r,u_overlay:0,u_overlay_scale:s}),Hc=o.create(),tf=(c,r,s,h,m,y,b)=>{const E=c.transform,S=E.projection.name==="globe",k=S?o.globePixelsToTileUnits(E.zoom,r.canonical)*E._pixelsPerMercatorPixel:tn(s,1,y),D={u_matrix:r.projMatrix,u_extrude_scale:k,u_intensity:b,u_inv_rot_matrix:Hc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=h,D.u_merc_center=m,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=o.globeToMercatorTransition(E.zoom);const U=m[0]*o.EXTENT,G=m[1]*o.EXTENT;D.u_up_dir=E.projection.upVector(new o.CanonicalTileID(0,0,0),U,G)}return D},Al=(c,r,s,h,m,y,b,E)=>{const S=c.transform,k=S.calculatePixelsToTileUnitsMatrix(r),D={u_matrix:Fh(c,r,s,m),u_pixels_to_tile_units:k,u_device_pixel_ratio:b,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:E};if(wl(s)){const U=bl(r,c.transform);D.u_texsize=r.lineAtlasTexture.size,D.u_scale=[U,h.fromScale,h.toScale],D.u_mix=h.t}return D},rf=(c,r,s,h,m,y)=>{const b=c.transform,E=bl(r,b);return{u_matrix:Fh(c,r,s,m),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:y,u_image:0,u_scale:[E,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function bl(c,r){return 1/tn(c,1,r.tileZoom)}function Fh(c,r,s,h){return c.translatePosMatrix(h||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function wl(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const nf=(c,r,s,h,m,y)=>{return{u_matrix:c,u_tl_parent:r,u_scale_parent:s,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:El(m.paint.get("raster-hue-rotate")),u_perspective_transform:y};var b,E};function El(c){c*=Math.PI/180;const r=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const Uh=o.create(),Qc=(c,r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X)=>{const H=m.transform,q={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+S,u_pitch_with_map:+h,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Uh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Uh,u_up_vector:[0,-1,0]};return X.name==="globe"&&(q.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],q.u_zoom_transition=U,q.u_inv_rot_matrix=Q,q.u_merc_center=G,q.u_camera_forward=H._camera.forward(),q.u_ecef_origin=o.globeECEFOrigin(H.globeMatrix,D.toUnwrapped()),q.u_tile_matrix=Float32Array.from(H.globeMatrix),q.u_up_vector=W),q},Yc=(c,r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X,H)=>o.extend(Qc(c,r,s,h,m,y,b,E,S,k,U,G,Q,W,X,H),{u_gamma_scale:h?m.transform.cameraToCenterDistance*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+D}),gs=(c,r,s,h,m,y,b,E,S,k,D,U,G,Q,W,X)=>o.extend(Yc(c,r,s,h,m,y,b,E,!0,S,!0,D,U,G,Q,W,X),{u_texsize_icon:k,u_texture_icon:1}),of=(c,r,s)=>({u_matrix:c,u_opacity:r,u_color:s}),sf=(c,r,s,h,m,y)=>o.extend(function(b,E,S,k){const D=S.imageManager.getPattern(b.from.toString()),U=S.imageManager.getPattern(b.to.toString()),{width:G,height:Q}=S.imageManager.getPixelSize(),W=Math.pow(2,k.tileID.overscaledZ),X=k.tileSize*Math.pow(2,S.transform.tileZoom)/W,H=X*(k.tileID.canonical.x+k.tileID.wrap*W),q=X*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[G,Q],u_mix:E.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/tn(k,1,S.transform.tileZoom),u_pixel_coord_upper:[H>>16,q>>16],u_pixel_coord_lower:[65535&H,65535&q]}}(h,y,s,m),{u_matrix:c,u_opacity:r}),af={fillExtrusion:c=>({u_matrix:new o.UniformMatrix4f(c),u_lightpos:new o.Uniform3f(c),u_lightintensity:new o.Uniform1f(c),u_lightcolor:new o.Uniform3f(c),u_vertical_gradient:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_edge_radius:new o.Uniform1f(c),u_ao:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_up_dir:new o.Uniform3f(c),u_height_lift:new o.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_lightpos:new o.Uniform3f(c),u_lightintensity:new o.Uniform1f(c),u_lightcolor:new o.Uniform3f(c),u_vertical_gradient:new o.Uniform1f(c),u_height_factor:new o.Uniform1f(c),u_edge_radius:new o.Uniform1f(c),u_ao:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_up_dir:new o.Uniform3f(c),u_height_lift:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c)}),fill:c=>({u_matrix:new o.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c)}),fillOutline:c=>({u_matrix:new o.UniformMatrix4f(c),u_world:new o.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_world:new o.Uniform2f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new o.Uniform1f(c),u_extrude_scale:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_up_dir:new o.Uniform3f(c)}),collisionBox:c=>({u_matrix:new o.UniformMatrix4f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_extrude_scale:new o.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new o.UniformMatrix4f(c),u_inv_matrix:new o.UniformMatrix4f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_viewport_size:new o.Uniform2f(c)}),debug:c=>({u_color:new o.UniformColor(c),u_matrix:new o.UniformMatrix4f(c),u_overlay:new o.Uniform1i(c),u_overlay_scale:new o.Uniform1f(c)}),clippingMask:c=>({u_matrix:new o.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new o.Uniform1f(c),u_intensity:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_up_dir:new o.Uniform3f(c)}),heatmapTexture:c=>({u_image:new o.Uniform1i(c),u_color_ramp:new o.Uniform1i(c),u_opacity:new o.Uniform1f(c)}),hillshade:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_latrange:new o.Uniform2f(c),u_light:new o.Uniform2f(c),u_shadow:new o.UniformColor(c),u_highlight:new o.UniformColor(c),u_accent:new o.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_dimension:new o.Uniform2f(c),u_zoom:new o.Uniform1f(c),u_unpack:new o.Uniform4f(c)}),line:c=>({u_matrix:new o.UniformMatrix4f(c),u_pixels_to_tile_units:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_units_to_pixels:new o.Uniform2f(c),u_dash_image:new o.Uniform1i(c),u_gradient_image:new o.Uniform1i(c),u_image_height:new o.Uniform1f(c),u_texsize:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_mix:new o.Uniform1f(c),u_alpha_discard_threshold:new o.Uniform1f(c),u_trim_offset:new o.Uniform2f(c)}),linePattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_texsize:new o.Uniform2f(c),u_pixels_to_tile_units:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_units_to_pixels:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c),u_alpha_discard_threshold:new o.Uniform1f(c)}),raster:c=>({u_matrix:new o.UniformMatrix4f(c),u_tl_parent:new o.Uniform2f(c),u_scale_parent:new o.Uniform1f(c),u_fade_t:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_image0:new o.Uniform1i(c),u_image1:new o.Uniform1i(c),u_brightness_low:new o.Uniform1f(c),u_brightness_high:new o.Uniform1f(c),u_saturation_factor:new o.Uniform1f(c),u_contrast_factor:new o.Uniform1f(c),u_spin_weights:new o.Uniform3f(c),u_perspective_transform:new o.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_camera_forward:new o.Uniform3f(c),u_tile_matrix:new o.UniformMatrix4f(c),u_up_vector:new o.Uniform3f(c),u_ecef_origin:new o.Uniform3f(c),u_texture:new o.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_texture:new o.Uniform1i(c),u_gamma_scale:new o.Uniform1f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_camera_forward:new o.Uniform3f(c),u_tile_matrix:new o.UniformMatrix4f(c),u_up_vector:new o.Uniform3f(c),u_ecef_origin:new o.Uniform3f(c),u_is_halo:new o.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_texsize_icon:new o.Uniform2f(c),u_texture:new o.Uniform1i(c),u_texture_icon:new o.Uniform1i(c),u_gamma_scale:new o.Uniform1f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_is_halo:new o.Uniform1i(c)}),background:c=>({u_matrix:new o.UniformMatrix4f(c),u_opacity:new o.Uniform1f(c),u_color:new o.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_opacity:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_pattern_tl_a:new o.Uniform2f(c),u_pattern_br_a:new o.Uniform2f(c),u_pattern_tl_b:new o.Uniform2f(c),u_pattern_br_b:new o.Uniform2f(c),u_texsize:new o.Uniform2f(c),u_mix:new o.Uniform1f(c),u_pattern_size_a:new o.Uniform2f(c),u_pattern_size_b:new o.Uniform2f(c),u_scale_a:new o.Uniform1f(c),u_scale_b:new o.Uniform1f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c)}),terrainRaster:pa,terrainDepth:pa,skybox:c=>({u_matrix:new o.UniformMatrix4f(c),u_sun_direction:new o.Uniform3f(c),u_cubemap:new o.Uniform1i(c),u_opacity:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new o.UniformMatrix4f(c),u_color_ramp:new o.Uniform1i(c),u_center_direction:new o.Uniform3f(c),u_radius:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new o.UniformMatrix3f(c),u_sun_direction:new o.Uniform3f(c),u_sun_intensity:new o.Uniform1f(c),u_color_tint_r:new o.Uniform4f(c),u_color_tint_m:new o.Uniform4f(c),u_luminance:new o.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new o.UniformMatrix4f(c),u_globe_matrix:new o.UniformMatrix4f(c),u_normalize_matrix:new o.UniformMatrix4f(c),u_merc_matrix:new o.UniformMatrix4f(c),u_zoom_transition:new o.Uniform1f(c),u_merc_center:new o.Uniform2f(c),u_image0:new o.Uniform1i(c),u_grid_matrix:new o.UniformMatrix3f(c),u_frustum_tl:new o.Uniform3f(c),u_frustum_tr:new o.Uniform3f(c),u_frustum_br:new o.Uniform3f(c),u_frustum_bl:new o.Uniform3f(c),u_globe_pos:new o.Uniform3f(c),u_globe_radius:new o.Uniform1f(c),u_viewport:new o.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new o.Uniform3f(c),u_frustum_tr:new o.Uniform3f(c),u_frustum_br:new o.Uniform3f(c),u_frustum_bl:new o.Uniform3f(c),u_horizon:new o.Uniform1f(c),u_transition:new o.Uniform1f(c),u_fadeout_range:new o.Uniform1f(c),u_color:new o.Uniform4f(c),u_high_color:new o.Uniform4f(c),u_space_color:new o.Uniform4f(c),u_star_intensity:new o.Uniform1f(c),u_star_density:new o.Uniform1f(c),u_star_size:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c),u_horizon_angle:new o.Uniform1f(c),u_rotation_matrix:new o.UniformMatrix4f(c)})};let Tl;function Vh(c,r,s,h,m,y,b){const E=c.context,S=E.gl,k=c.transform,D=c.useProgram("collisionBox"),U=[];let G=0,Q=0;for(let fe=0;fe<h.length;fe++){const de=h[fe],ae=r.getTile(de),pe=ae.getBucket(s);if(!pe)continue;const he=Wr(de,pe,k);let xe=he;m[0]===0&&m[1]===0||(xe=c.translatePosMatrix(he,ae,m,y));const Te=b?pe.textCollisionBox:pe.iconCollisionBox,Ye=pe.collisionCircleArray;if(Ye.length>0){const be=o.create(),Be=xe;o.mul(be,pe.placementInvProjMatrix,k.glCoordMatrix),o.mul(be,be,pe.placementViewportMatrix),U.push({circleArray:Ye,circleOffset:Q,transform:Be,invTransform:be,projection:pe.getProjection()}),G+=Ye.length/4,Q=G}Te&&(c.terrain&&c.terrain.setupElevationDraw(ae,D),D.draw(E,S.LINES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,Xc(xe,k,ae,pe.getProjection()),s.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,k.zoom,null,[Te.collisionVertexBuffer,Te.collisionVertexBufferExt]))}if(!b||!U.length)return;const W=c.useProgram("collisionCircle"),X=new o.StructArrayLayout2f1f2i16;X.resize(4*G),X._trim();let H=0;for(const fe of U)for(let de=0;de<fe.circleArray.length/4;de++){const ae=4*de,pe=fe.circleArray[ae+0],he=fe.circleArray[ae+1],xe=fe.circleArray[ae+2],Te=fe.circleArray[ae+3];X.emplace(H++,pe,he,xe,Te,0),X.emplace(H++,pe,he,xe,Te,1),X.emplace(H++,pe,he,xe,Te,2),X.emplace(H++,pe,he,xe,Te,3)}(!Tl||Tl.length<2*G)&&(Tl=function(fe){const de=2*fe,ae=new o.StructArrayLayout3ui6;ae.resize(de),ae._trim();for(let pe=0;pe<de;pe++){const he=6*pe;ae.uint16[he+0]=4*pe+0,ae.uint16[he+1]=4*pe+1,ae.uint16[he+2]=4*pe+2,ae.uint16[he+3]=4*pe+2,ae.uint16[he+4]=4*pe+3,ae.uint16[he+5]=4*pe+0}return ae}(G));const q=E.createIndexBuffer(Tl,!0),te=E.createVertexBuffer(X,o.collisionCircleLayout.members,!0);for(const fe of U){const de={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(Y=k).getCameraToCenterDistance(fe.projection),u_viewport_size:[Y.width,Y.height]};W.draw(E,S.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,de,s.id,te,q,o.SegmentVector.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,k.zoom)}var Y;te.destroy(),q.destroy()}const jh=o.create();function Jc(c,r,s,h,m,y){const{horizontalAlign:b,verticalAlign:E}=o.getAnchorAlignment(c),S=-(b-.5)*r,k=-(E-.5)*s,D=o.evaluateVariableOffset(c,h);return new o.pointGeometry((S/m+D[0])*y,(k/m+D[1])*y)}function Kc(c,r,s,h,m,y,b,E,S,k,D){const U=c.text.placedSymbolArray,G=c.text.dynamicLayoutVertexArray,Q=c.icon.dynamicLayoutVertexArray,W={},X=Xr(E,c.getProjection(),y),H=y.elevation,q=c.getProjection().upVectorScale(E.canonical,y.center.lat,y.worldSize);G.clear();for(let te=0;te<U.length;te++){const Y=U.get(te),fe=c.allowVerticalPlacement&&!Y.placedOrientation,de=Y.hidden||!Y.crossTileID||fe?null:h[Y.crossTileID];if(de){const ae=new o.pointGeometry(Y.tileAnchorX,Y.tileAnchorY),pe=c.getProjection().upVector(E.canonical,ae.x,ae.y),he=H?H.getAtTileOffset(E,ae.x,ae.y):0,xe=Xt([Y.projectedAnchorX+he*pe[0]*q.metersToTile,Y.projectedAnchorY+he*pe[1]*q.metersToTile,Y.projectedAnchorZ+he*pe[2]*q.metersToTile],s?X:b),Te=na(y.getCameraToCenterDistance(c.getProjection()),xe.signedDistanceFromCamera);let Ye=m.evaluateSizeForFeature(c.textSizeData,k,Y)*Te/o.ONE_EM;s&&(Ye*=c.tilePixelRatio/S);const{width:be,height:Be,anchor:Fe,textOffset:it,textScale:ze}=de,Ke=Jc(Fe,be,Be,it,ze,Ye);let Oe;if(s){const ot=ae.add(Ke),{x:bt,y:Mt,z:jt}=c.getProjection().projectTilePoint(ot.x,ot.y,E.canonical);Oe=Xt([bt+he*pe[0]*q.metersToTile,Mt+he*pe[1]*q.metersToTile,jt+he*pe[2]*q.metersToTile],b).point}else{const ot=r?Ke.rotate(-y.angle):Ke;Oe=[xe.point[0]+ot.x,xe.point[1]+ot.y,0]}const at=c.allowVerticalPlacement&&Y.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<Y.numGlyphs;ot++)o.addDynamicAttributes(G,Oe[0],Oe[1],Oe[2],at);D&&Y.associatedIconIndex>=0&&(W[Y.associatedIconIndex]={shiftedAnchor:Oe,angle:at})}else go(Y.numGlyphs,G)}if(D){Q.clear();const te=c.icon.placedSymbolArray;for(let Y=0;Y<te.length;Y++){const fe=te.get(Y);if(fe.hidden)go(fe.numGlyphs,Q);else{const de=W[Y];if(de)for(let ae=0;ae<fe.numGlyphs;ae++)o.addDynamicAttributes(Q,de.shiftedAnchor[0],de.shiftedAnchor[1],de.shiftedAnchor[2],de.angle);else go(fe.numGlyphs,Q)}}c.icon.dynamicLayoutVertexBuffer.updateData(Q)}c.text.dynamicLayoutVertexBuffer.updateData(G)}function Nh(c,r,s){return s.iconsInText&&r?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function eu(c,r,s,h,m,y,b,E,S,k,D,U){const G=c.context,Q=G.gl,W=c.transform,X=E==="map",H=S==="map",q=X&&s.layout.get("symbol-placement")!=="point",te=X&&!H&&!q,Y=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let fe=!1;const de=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),ae=[o.mercatorXfromLng(W.center.lng),o.mercatorYfromLat(W.center.lat)],pe=s.layout.get("text-variable-anchor"),he=W.projection.name==="globe",xe=[],Te=[0,-1,0];let Ye=Te;!he&&!W.mercatorFromTransition||X||(Ye=function(be){const Be=be._camera.getWorldToCamera(be.worldSize,1),Fe=o.multiply([],Be,be.globeMatrix);o.invert(Fe,Fe);const it=[0,0,0],ze=[0,1,0,0];return o.transformMat4$1(ze,ze,Fe),it[0]=ze[0],it[1]=ze[1],it[2]=ze[2],o.normalize(it,it),it}(W));for(const be of h){const Be=r.getTile(be),Fe=Be.getBucket(s);if(!Fe||Fe.projection.name==="mercator"&&he)continue;const it=m?Fe.text:Fe.icon;if(!it||Fe.fullyClipped||!it.segments.get().length)continue;const ze=it.programConfigurations.get(s.id),Ke=m||Fe.sdfIcons,Oe=m?Fe.textSizeData:Fe.iconSizeData,at=H||W.pitch!==0,ot=o.evaluateSizeForZoom(Oe,W.zoom);let bt,Mt,jt,oi,wt=[0,0],Zt=null;if(m){if(Mt=Be.glyphAtlasTexture,jt=Q.LINEAR,bt=Be.glyphAtlasTexture.size,Fe.iconsInText){wt=Be.imageAtlasTexture.size,Zt=Be.imageAtlasTexture;const Nr=Oe.kind==="composite"||Oe.kind==="camera";oi=at||c.options.rotating||c.options.zooming||Nr?Q.LINEAR:Q.NEAREST}}else{const Nr=s.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;Mt=Be.imageAtlasTexture,jt=Ke||c.options.rotating||c.options.zooming||Nr||at?Q.LINEAR:Q.NEAREST,bt=Be.imageAtlasTexture.size}const _i=Fe.projection.name==="globe",Gi=_i?Ye:Te,nr=_i?o.globeToMercatorTransition(W.zoom):0,zi=Xr(be,Fe.getProjection(),W),Sr=W.calculatePixelsToTileUnitsMatrix(Be),zn=ti(zi,Be.tileID.canonical,H,X,W,Fe.getProjection(),Sr),Kn=c.terrain&&H&&q?o.invert(o.create(),zn):jh,Zi=Sn(zi,Be.tileID.canonical,H,X,W,Fe.getProjection(),Sr),Xi=pe&&Fe.hasTextData(),Kt=s.layout.get("icon-text-fit")!=="none"&&Xi&&Fe.hasIconData();if(q){const Nr=W.elevation,Xo=Nr?Nr.getAtTileOffsetFunc(be,W.center.lat,W.worldSize,Fe.getProjection()):Da=>[0,0,0],wo=ii(zi,Be.tileID.canonical,H,X,W,Fe.getProjection(),Sr);sa(Fe,zi,c,m,wo,Zi,H,k,Xo,be)}const dr=q||m&&pe||Kt,Dr=c.translatePosMatrix(zi,Be,y,b),Fi=dr?jh:zn,Br=c.translatePosMatrix(Zi,Be,y,b,!0),Go=Fe.getProjection().createInversionMatrix(W,be.canonical),jr=[];c.terrain&&H&&jr.push("PITCH_WITH_MAP_TERRAIN"),_i&&jr.push("PROJECTION_GLOBE_VIEW"),dr&&jr.push("PROJECTED_POS_ON_VIEWPORT");const Zo=Ke&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qo;qo=Ke?Fe.iconsInText?gs(Oe.kind,ot,te,H,c,Dr,Fi,Br,bt,wt,be,nr,ae,Go,Gi,Fe.getProjection()):Yc(Oe.kind,ot,te,H,c,Dr,Fi,Br,m,bt,!0,be,nr,ae,Go,Gi,Fe.getProjection()):Qc(Oe.kind,ot,te,H,c,Dr,Fi,Br,m,bt,be,nr,ae,Go,Gi,Fe.getProjection());const Wo={program:c.useProgram(Nh(Ke,m,Fe),ze,jr),buffers:it,uniformValues:qo,atlasTexture:Mt,atlasTextureIcon:Zt,atlasInterpolation:jt,atlasInterpolationIcon:oi,isSDF:Ke,hasHalo:Zo,tile:Be,labelPlaneMatrixInv:Kn};if(Y&&Fe.canOverlap){fe=!0;const Nr=it.segments.get();for(const Xo of Nr)xe.push({segments:new o.SegmentVector([Xo]),sortKey:Xo.sortKey,state:Wo})}else xe.push({segments:it.segments,sortKey:0,state:Wo})}fe&&xe.sort((be,Be)=>be.sortKey-Be.sortKey);for(const be of xe){const Be=be.state;if(c.terrain&&c.terrain.setupElevationDraw(Be.tile,Be.program,{useDepthForOcclusion:!he,labelPlaneMatrixInv:Be.labelPlaneMatrixInv}),G.activeTexture.set(Q.TEXTURE0),Be.atlasTexture.bind(Be.atlasInterpolation,Q.CLAMP_TO_EDGE),Be.atlasTextureIcon&&(G.activeTexture.set(Q.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Be.isSDF){const Fe=Be.uniformValues;Be.hasHalo&&(Fe.u_is_halo=1,tu(Be.buffers,be.segments,s,c,Be.program,de,D,U,Fe)),Fe.u_is_halo=0}tu(Be.buffers,be.segments,s,c,Be.program,de,D,U,Be.uniformValues)}}function tu(c,r,s,h,m,y,b,E,S){const k=h.context,D=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];m.draw(k,k.gl.TRIANGLES,y,b,E,o.CullFaceMode.disabled,S,s.id,c.layoutVertexBuffer,c.indexBuffer,r,s.paint,h.transform.zoom,c.programConfigurations.get(s.id),D)}function Sl(c,r,s,h,m,y,b){const E=c.context.gl,S=s.paint.get("fill-pattern"),k=S&&S.constantOr(1),D=s.getCrossfadeParameters();let U,G,Q,W,X;b?(G=k&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=E.LINES):(G=k?"fillPattern":"fill",U=E.TRIANGLES);for(const H of h){const q=r.getTile(H);if(k&&!q.patternsLoaded())continue;const te=q.getBucket(s);if(!te)continue;c.prepareDrawTile();const Y=te.programConfigurations.get(s.id),fe=c.useProgram(G,Y);k&&(c.context.activeTexture.set(E.TEXTURE0),q.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers(D));const de=S.constantOr(null);if(de&&q.imageAtlas){const pe=q.imageAtlas,he=pe.patternPositions[de.to.toString()],xe=pe.patternPositions[de.from.toString()];he&&xe&&Y.setConstantPatternPositions(he,xe)}const ae=c.translatePosMatrix(H.projMatrix,q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){W=te.indexBuffer2,X=te.segments2;const pe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];Q=G==="fillOutlinePattern"&&k?qc(ae,c,D,q,pe):Vn(ae,pe)}else W=te.indexBuffer,X=te.segments,Q=k?vl(ae,c,D,q):_a(ae);c.prepareDrawProgram(c.context,fe,H.toUnwrapped()),fe.draw(c.context,U,m,c.stencilModeForClipping(H),y,o.CullFaceMode.disabled,Q,s.id,te.layoutVertexBuffer,W,X,s.paint,c.transform.zoom,Y)}}function Qn(c,r,s,h,m,y,b){const E=c.context,S=E.gl,k=c.transform,D=s.paint.get("fill-extrusion-pattern"),U=D.constantOr(1),G=s.getCrossfadeParameters(),Q=s.paint.get("fill-extrusion-opacity"),W=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],X=s.layout.get("fill-extrusion-edge-radius"),H=k.projection.name==="globe"?o.fillExtrusionHeightLift():0,q=k.projection.name==="globe",te=q?o.globeToMercatorTransition(k.zoom):0,Y=[o.mercatorXfromLng(k.center.lng),o.mercatorYfromLat(k.center.lat)],fe=[];q&&(fe.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&fe.push("TERRAIN")),W[0]>0&&fe.push("FAUX_AO");for(const de of h){const ae=r.getTile(de),pe=ae.getBucket(s);if(!pe||pe.projection.name!==k.projection.name)continue;const he=pe.programConfigurations.get(s.id),xe=c.useProgram(U?"fillExtrusionPattern":"fillExtrusion",he,fe);if(c.terrain){const ze=c.terrain;if(c.style.terrainSetForDrapingOnly())ze.setupElevationDraw(ae,xe,{useMeterToDem:!0});else{if(!pe.enableTerrain)continue;if(ze.setupElevationDraw(ae,xe,{useMeterToDem:!0}),ga(E,r,de,pe,s,ze),!pe.centroidVertexBuffer){const Ke=xe.attributes.a_centroid_pos;Ke!==void 0&&S.vertexAttrib2f(Ke,0,0)}}}U&&(c.context.activeTexture.set(S.TEXTURE0),ae.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),he.updatePaintBuffers(G));const Te=D.constantOr(null);if(Te&&ae.imageAtlas){const ze=ae.imageAtlas,Ke=ze.patternPositions[Te.to.toString()],Oe=ze.patternPositions[Te.from.toString()];Ke&&Oe&&he.setConstantPatternPositions(Ke,Oe)}const Ye=c.translatePosMatrix(de.projMatrix,ae,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),be=k.projection.createInversionMatrix(k,de.canonical),Be=s.paint.get("fill-extrusion-vertical-gradient"),Fe=U?Bh(Ye,c,Be,Q,W,X,de,G,ae,H,te,Y,be):_s(Ye,c,Be,Q,W,X,de,H,te,Y,be);c.prepareDrawProgram(E,xe,de.toUnwrapped());const it=[];c.terrain&&it.push(pe.centroidVertexBuffer),q&&it.push(pe.layoutVertexExtBuffer),xe.draw(E,E.gl.TRIANGLES,m,y,b,o.CullFaceMode.backCCW,Fe,s.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,s.paint,c.transform.zoom,he,it)}}function ga(c,r,s,h,m,y){const b=[q=>{let te=q.canonical.x-1,Y=q.wrap;return te<0&&(te=(1<<q.canonical.z)-1,Y--),new o.OverscaledTileID(q.overscaledZ,Y,q.canonical.z,te,q.canonical.y)},q=>{let te=q.canonical.x+1,Y=q.wrap;return te===1<<q.canonical.z&&(te=0,Y++),new o.OverscaledTileID(q.overscaledZ,Y,q.canonical.z,te,q.canonical.y)},q=>new o.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,(q.canonical.y===0?1<<q.canonical.z:q.canonical.y)-1),q=>new o.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y===(1<<q.canonical.z)-1?0:q.canonical.y+1)],E=q=>{const te=r.getSource().minzoom,Y=de=>{const ae=r.getTileByID(de);if(ae&&ae.hasData())return ae.getBucket(m)},fe=[0,-1,1];for(const de of fe){if(q.overscaledZ+de<te)continue;const ae=Y(q.calculateScaledKey(q.overscaledZ+de));if(ae)return ae}},S=[0,0,0],k=(q,te)=>(S[0]=Math.min(q.min.y,te.min.y),S[1]=Math.max(q.max.y,te.max.y),S[2]=o.EXTENT-te.min.x>q.max.x?te.min.x-o.EXTENT:q.max.x,S),D=(q,te)=>(S[0]=Math.min(q.min.x,te.min.x),S[1]=Math.max(q.max.x,te.max.x),S[2]=o.EXTENT-te.min.y>q.max.y?te.min.y-o.EXTENT:q.max.y,S),U=[(q,te)=>k(q,te),(q,te)=>k(te,q),(q,te)=>D(q,te),(q,te)=>D(te,q)],G=new o.pointGeometry(0,0);let Q,W,X;const H=(q,te,Y,fe,de)=>{const ae=[[fe?Y:q,fe?q:Y,0],[fe?Y:te,fe?te:Y,0]],pe=de<0?o.EXTENT+de:de,he=[fe?pe:(q+te)/2,fe?(q+te)/2:pe,0];return Y===0&&de<0||Y!==0&&de>0?y.getForTilePoints(X,[he],!0,W):ae.push(he),y.getForTilePoints(s,ae,!0,Q),Math.max(ae[0][2],ae[1][2],he[2])/y.exaggeration()};for(let q=0;q<4;q++){const te=(q<2?1:5)-q,Y=h.borders[q];if(Y.length===0)continue;const fe=X=b[q](s),de=E(fe);if(!(de&&de instanceof o.FillExtrusionBucket&&de.enableTerrain)||h.borderDoneWithNeighborZ[q]===de.canonical.z&&de.borderDoneWithNeighborZ[te]===h.canonical.z||(W=y.findDEMTileFor(fe),!W||!W.dem))continue;if(!Q){const xe=y.findDEMTileFor(s);if(!xe||!xe.dem)return;Q=xe}const ae=de.borders[te];let pe=0;const he=de.borderDoneWithNeighborZ[te]!==h.canonical.z;if(h.canonical.z===de.canonical.z){for(let xe=0;xe<Y.length;xe++){const Te=h.featuresOnBorder[Y[xe]],Ye=Te.borders[q];let be;for(;pe<ae.length&&(be=de.featuresOnBorder[ae[pe]],!(be.borders[te][1]>Ye[0]+3));)he&&de.encodeCentroid(void 0,be,!1),pe++;if(be&&pe<ae.length){const Be=pe;let Fe=0;for(;!(be.borders[te][0]>Ye[1]-3)&&(Fe++,++pe!==ae.length);)be=de.featuresOnBorder[ae[pe]];if(be=de.featuresOnBorder[ae[Be]],Te.intersectsCount()>1||be.intersectsCount()>1||Fe!==1){Fe!==1&&(pe=Be),h.encodeCentroid(void 0,Te,!1),he&&de.encodeCentroid(void 0,be,!1);continue}const it=U[q](Te,be),ze=q%2?o.EXTENT-1:0;G.x=H(it[0],Math.min(o.EXTENT-1,it[1]),ze,q<2,it[2]),G.y=0,h.encodeCentroid(G,Te,!1),he&&de.encodeCentroid(G,be,!1)}else h.encodeCentroid(void 0,Te,!1)}h.borderDoneWithNeighborZ[q]=de.canonical.z,h.needsCentroidUpdate=!0,he&&(de.borderDoneWithNeighborZ[te]=h.canonical.z,de.needsCentroidUpdate=!0)}else{for(const xe of Y)h.encodeCentroid(void 0,h.featuresOnBorder[xe],!1);if(he){for(const xe of ae)de.encodeCentroid(void 0,de.featuresOnBorder[xe],!1);de.borderDoneWithNeighborZ[te]=h.canonical.z,de.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[q]=de.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(c)}const $h=new o.Color(1,0,0,1),ys=new o.Color(0,1,0,1),xs=new o.Color(0,0,1,1),Gh=new o.Color(1,0,1,1),iu=new o.Color(0,1,1,1);function bi(c,r,s){const h=c.context,m=c.transform,y=h.gl,b=m.projection.name==="globe",E=b?["PROJECTION_GLOBE_VIEW"]:null;let S=s.projMatrix;if(b&&o.globeToMercatorTransition(m.zoom)>0){const Te=o.transitionTileAABBinECEF(s.canonical,m),Ye=o.globeDenormalizeECEF(Te);S=o.multiply(new Float32Array(16),m.globeMatrix,Ye),o.multiply(S,m.projMatrix,S)}const k=c.useProgram("debug",null,E),D=r.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(D,k);const U=o.DepthMode.disabled,G=o.StencilMode.disabled,Q=c.colorModeForRenderPass(),W="$debug";h.activeTexture.set(y.TEXTURE0),c.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),b?D._makeGlobeTileDebugBuffers(c.context,m):D._makeDebugTileBoundsBuffers(c.context,m.projection);const X=D._tileDebugBuffer||c.debugBuffer,H=D._tileDebugIndexBuffer||c.debugIndexBuffer,q=D._tileDebugSegments||c.debugSegments;k.draw(h,y.LINE_STRIP,U,G,Q,o.CullFaceMode.disabled,Oh(S,o.Color.red),W,X,H,q,null,null,null,[D._globeTileDebugBorderBuffer]);const te=D.latestRawTileData,Y=Math.floor((te&&te.byteLength||0)/1024),fe=r.getTile(s).tileSize,de=512/Math.min(fe,512)*(s.overscaledZ/m.zoom)*.5;let ae=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ae+=` => ${s.overscaledZ}`),ae+=` ${Y}kb`,function(Te,Ye){Te.initDebugOverlayCanvas();const be=Te.debugOverlayCanvas,Be=Te.context.gl,Fe=Te.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,be.width,be.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(Ye,5,5),Fe.strokeText(Ye,5,5),Te.debugOverlayTexture.update(be),Te.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(c,ae);const pe=D._tileDebugTextBuffer||c.debugBuffer,he=D._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,xe=D._tileDebugTextSegments||c.debugSegments;k.draw(h,y.TRIANGLES,U,G,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Oh(S,o.Color.transparent,de),W,pe,he,xe,null,null,null,[D._globeTileDebugTextBuffer])}function ya(c,r,s,h){xa(c,0,r+s/2,c.transform.width,s,h)}function Zh(c,r,s,h){xa(c,r-s/2,0,s,c.transform.height,h)}function xa(c,r,s,h,m,y){const b=c.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,h*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),b.clear({color:y}),E.disable(E.SCISSOR_TEST)}const va=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:lf}=va;function bo(c,r,s,h){c.emplaceBack(r,s,h)}class ru{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,bo(this.vertexArray,-1,-1,1),bo(this.vertexArray,1,-1,1),bo(this.vertexArray,-1,1,1),bo(this.vertexArray,1,1,1),bo(this.vertexArray,-1,-1,-1),bo(this.vertexArray,1,-1,-1),bo(this.vertexArray,-1,1,-1),bo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,lf),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function vs(c,r,s,h,m,y){const b=c.gl,E=r.paint.get("sky-atmosphere-color"),S=r.paint.get("sky-atmosphere-halo-color"),k=r.paint.get("sky-atmosphere-sun-intensity"),D=((U,G,Q,W,X)=>({u_matrix_3f:U,u_sun_direction:G,u_sun_intensity:Q,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),h),m,k,E,S);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),s.draw(c,b.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,D,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const nu=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Il{constructor(r){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new o.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,nu.members),this.indexBuffer=r.createIndexBuffer(h),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const As={symbol:function(c,r,s,h,m){if(c.renderPass!=="translucent")return;const y=o.StencilMode.disabled,b=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(E,S,k,D,U,G,Q){const W=S.transform,X=U==="map",H=G==="map";for(const q of E){const te=D.getTile(q),Y=te.getBucket(k);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const fe=o.evaluateSizeForZoom(Y.textSizeData,W.zoom),de=Xr(q,Y.getProjection(),W),ae=W.calculatePixelsToTileUnitsMatrix(te),pe=ti(de,te.tileID.canonical,H,X,W,Y.getProjection(),ae),he=k.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(fe){const xe=Math.pow(2,W.zoom-te.tileID.overscaledZ);Kc(Y,X,H,Q,o.symbolSize,W,pe,q,xe,fe,he)}}}(h,c,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&eu(c,r,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),y,b),s.paint.get("text-opacity").constantOr(1)!==0&&eu(c,r,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),y,b),r.map.showCollisionBoxes&&(Vh(c,r,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Vh(c,r,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,r,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),b=s.paint.get("circle-stroke-opacity"),E=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const S=c.context,k=S.gl,D=c.transform,U=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),G=o.StencilMode.disabled,Q=c.colorModeForRenderPass(),W=D.projection.name==="globe",X=[o.mercatorXfromLng(D.center.lng),o.mercatorYfromLat(D.center.lat)],H=[];for(let te=0;te<h.length;te++){const Y=h[te],fe=r.getTile(Y),de=fe.getBucket(s);if(!de||de.projection.name!==D.projection.name)continue;const ae=de.programConfigurations.get(s.id),pe=Rh(s);W&&pe.push("PROJECTION_GLOBE_VIEW");const he=c.useProgram("circle",ae,pe),xe=de.layoutVertexBuffer,Te=de.globeExtVertexBuffer,Ye=de.indexBuffer,be=D.projection.createInversionMatrix(D,Y.canonical),Be={programConfiguration:ae,program:he,layoutVertexBuffer:xe,globeExtVertexBuffer:Te,indexBuffer:Ye,uniformValues:Wc(c,Y,fe,be,X,s),tile:fe};if(E){const Fe=de.segments.get();for(const it of Fe)H.push({segments:new o.SegmentVector([it]),sortKey:it.sortKey,state:Be})}else H.push({segments:de.segments,sortKey:0,state:Be})}E&&H.sort((te,Y)=>te.sortKey-Y.sortKey);const q={useDepthForOcclusion:!W};for(const te of H){const{programConfiguration:Y,program:fe,layoutVertexBuffer:de,globeExtVertexBuffer:ae,indexBuffer:pe,uniformValues:he,tile:xe}=te.state,Te=te.segments;c.terrain&&c.terrain.setupElevationDraw(xe,fe,q),c.prepareDrawProgram(S,fe,xe.tileID.toUnwrapped()),fe.draw(S,k.TRIANGLES,U,G,Q,o.CullFaceMode.disabled,he,s.id,de,pe,Te,s.paint,D.zoom,Y,[ae])}},heatmap:function(c,r,s,h){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const m=c.context,y=m.gl,b=o.StencilMode.disabled,E=new o.ColorMode([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Q,W,X,H){const q=Q.gl,te=W.width*H,Y=W.height*H;Q.activeTexture.set(q.TEXTURE1),Q.viewport.set([0,0,te,Y]);let fe=X.heatmapFbo;if(!fe||fe&&(fe.width!==te||fe.height!==Y)){fe&&fe.destroy();const de=q.createTexture();q.bindTexture(q.TEXTURE_2D,de),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),fe=X.heatmapFbo=Q.createFramebuffer(te,Y,!1),function(ae,pe,he,xe,Te,Ye){const be=ae.gl;be.texImage2D(be.TEXTURE_2D,0,be.RGBA,Te,Ye,0,be.RGBA,ae.extRenderToTextureHalfFloat?ae.extTextureHalfFloat.HALF_FLOAT_OES:be.UNSIGNED_BYTE,null),xe.colorAttachment.set(he)}(Q,0,de,fe,te,Y)}else q.bindTexture(q.TEXTURE_2D,fe.colorAttachment.get()),Q.bindFramebuffer.set(fe.framebuffer)})(m,c,s,c.transform.projection.name==="globe"?.5:.25),m.clear({color:o.Color.transparent});const S=c.transform,k=S.projection.name==="globe",D=k?["PROJECTION_GLOBE_VIEW"]:null,U=k?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,G=[o.mercatorXfromLng(S.center.lng),o.mercatorYfromLat(S.center.lat)];for(let Q=0;Q<h.length;Q++){const W=h[Q];if(r.hasRenderableParent(W))continue;const X=r.getTile(W),H=X.getBucket(s);if(!H||H.projection.name!==S.projection.name)continue;const q=H.programConfigurations.get(s.id),te=c.useProgram("heatmap",q,D),{zoom:Y}=c.transform;c.terrain&&c.terrain.setupElevationDraw(X,te),c.prepareDrawProgram(m,te,W.toUnwrapped());const fe=S.projection.createInversionMatrix(S,W.canonical);te.draw(m,y.TRIANGLES,o.DepthMode.disabled,b,E,U,tf(c,W,X,fe,G,Y,s.paint.get("heatmap-intensity")),s.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,s.paint,c.transform.zoom,q,k?[H.globeExtVertexBuffer]:null)}m.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(m,y){const b=m.context,E=b.gl,S=y.heatmapFbo;if(!S)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,S.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let k=y.colorRampTexture;k||(k=y.colorRampTexture=new o.Texture(b,y.colorRamp,E.RGBA)),k.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(b,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((D,U,G,Q)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(c,s))},line:function(c,r,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const b=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=c.colorModeForRenderPass(),S=c.terrain&&c.terrain.renderingToTexture?1:o.exported.devicePixelRatio,k=s.paint.get("line-dasharray"),D=k.constantOr(1),U=s.layout.get("line-cap"),G=s.paint.get("line-pattern"),Q=G.constantOr(1),W=s.paint.get("line-gradient"),X=s.getCrossfadeParameters(),H=Q?"linePattern":"line",q=c.context,te=q.gl,Y=(de=>{const ae=[];wl(de)&&ae.push("RENDER_LINE_DASH"),de.paint.get("line-gradient")&&ae.push("RENDER_LINE_GRADIENT");const pe=de.paint.get("line-trim-offset");pe[0]===0&&pe[1]===0||ae.push("RENDER_LINE_TRIM_OFFSET");const he=de.paint.get("line-pattern").constantOr(1),xe=de.paint.get("line-opacity").constantOr(1)!==1;return!he&&xe&&ae.push("RENDER_LINE_ALPHA_DISCARD"),ae})(s);let fe=Y.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const de of h){const ae=r.getTile(de);if(Q&&!ae.patternsLoaded())continue;const pe=ae.getBucket(s);if(!pe)continue;c.prepareDrawTile();const he=pe.programConfigurations.get(s.id),xe=c.useProgram(H,he,Y),Te=G.constantOr(null);if(Te&&ae.imageAtlas){const Oe=ae.imageAtlas,at=Oe.patternPositions[Te.to.toString()],ot=Oe.patternPositions[Te.from.toString()];at&&ot&&he.setConstantPatternPositions(at,ot)}const Ye=k.constantOr(null),be=U.constantOr(null);if(!Q&&Ye&&be&&ae.lineAtlas){const Oe=ae.lineAtlas,at=Oe.getDash(Ye.to,be),ot=Oe.getDash(Ye.from,be);at&&ot&&he.setConstantPatternPositions(at,ot)}let[Be,Fe]=s.paint.get("line-trim-offset");(be==="round"||be==="square")&&Be!==Fe&&(Be===0&&(Be-=1),Fe===1&&(Fe+=1));const it=c.terrain?de.projMatrix:null,ze=Q?rf(c,ae,s,X,it,S):Al(c,ae,s,X,it,pe.lineClipsArray.length,S,[Be,Fe]);if(W){const Oe=pe.gradients[s.id];let at=Oe.texture;if(s.gradientVersion!==Oe.version){let ot=256;if(s.stepInterpolant){const bt=r.getSource().maxzoom,Mt=de.canonical.z===bt?Math.ceil(1<<c.transform.maxZoom-de.canonical.z):1;ot=o.clamp(o.nextPowerOfTwo(pe.maxLineLength/o.EXTENT*1024*Mt),256,q.maxTextureSize)}Oe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ot,image:Oe.gradient||void 0,clips:pe.lineClipsArray}),Oe.texture?Oe.texture.update(Oe.gradient):Oe.texture=new o.Texture(q,Oe.gradient,te.RGBA),Oe.version=s.gradientVersion,at=Oe.texture}q.activeTexture.set(te.TEXTURE1),at.bind(s.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}D&&(q.activeTexture.set(te.TEXTURE0),ae.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),he.updatePaintBuffers(X)),Q&&(q.activeTexture.set(te.TEXTURE0),ae.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),he.updatePaintBuffers(X)),c.prepareDrawProgram(q,xe,de.toUnwrapped());const Ke=Oe=>{xe.draw(q,te.TRIANGLES,b,Oe,E,o.CullFaceMode.disabled,ze,s.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,s.paint,c.transform.zoom,he,[pe.layoutVertexBuffer2])};if(fe){const Oe=c.stencilModeForClipping(de).ref;Oe===0&&c.terrain&&q.clear({stencil:0});const at={func:te.EQUAL,mask:255};ze.u_alpha_discard_threshold=.8,Ke(new o.StencilMode(at,Oe,255,te.KEEP,te.KEEP,te.INVERT)),ze.u_alpha_discard_threshold=0,Ke(new o.StencilMode(at,Oe,255,te.KEEP,te.KEEP,te.KEEP))}else Ke(c.stencilModeForClipping(de))}fe&&(c.resetStencilClippingMasks(),c.terrain&&q.clear({stencil:0}))},fill:function(c,r,s,h){const m=s.paint.get("fill-color"),y=s.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=c.colorModeForRenderPass(),E=s.paint.get("fill-pattern"),S=c.opaquePassEnabledForLayer()&&!E.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===S){const k=c.depthModeForSublayer(1,c.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Sl(c,r,s,h,k,b,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const k=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Sl(c,r,s,h,k,b,!0)}},"fill-extrusion":function(c,r,s,h){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&c.renderPass==="translucent"){const y=new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Qn(c,r,s,h,y,o.StencilMode.disabled,o.ColorMode.disabled),Qn(c,r,s,h,y,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const b=c.colorModeForRenderPass();Qn(c,r,s,h,y,o.StencilMode.disabled,b)}}},hillshade:function(c,r,s,h){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const m=c.context,y=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),b=c.colorModeForRenderPass(),E=c.terrain&&c.terrain.renderingToTexture,[S,k]=c.renderPass!=="translucent"||E?[{},h]:c.stencilConfigForOverlap(h);for(const D of k){const U=r.getTile(D);if(U.needsHillshadePrepare&&c.renderPass==="offscreen")ms(c,U,s,y,o.StencilMode.disabled,b);else if(c.renderPass==="translucent"){const G=E&&c.terrain?c.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];Fc(c,D,U,s,y,G,b)}}m.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,r,s,h,m,y){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const b=c.context,E=b.gl,S=r.getSource(),k=c.useProgram("raster"),D=c.colorModeForRenderPass(),U=c.terrain&&c.terrain.renderingToTexture,[G,Q]=S instanceof Ae||U?[{},h]:c.stencilConfigForOverlap(h),W=Q[Q.length-1].overscaledZ,X=!c.options.moving;for(const H of Q){const q=U?o.DepthMode.disabled:c.depthModeForSublayer(H.overscaledZ-W,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),te=H.toUnwrapped(),Y=r.getTile(H);if(U&&(!Y||!Y.hasData()))continue;const fe=U?H.projMatrix:c.transform.calculateProjMatrix(te,X),de=c.terrain&&U?c.terrain.stencilModeForRTTOverlap(H):G[H.overscaledZ],ae=y?0:s.paint.get("raster-fade-duration");Y.registerFadeDuration(ae);const pe=r.findLoadedParent(H,0),he=yl(Y,pe,r,c.transform,ae);let xe,Te;c.terrain&&c.terrain.prepareDrawTile();const Ye=s.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;b.activeTexture.set(E.TEXTURE0),Y.texture.bind(Ye,E.CLAMP_TO_EDGE),b.activeTexture.set(E.TEXTURE1),pe?(pe.texture.bind(Ye,E.CLAMP_TO_EDGE),xe=Math.pow(2,pe.tileID.overscaledZ-Y.tileID.overscaledZ),Te=[Y.tileID.canonical.x*xe%1,Y.tileID.canonical.y*xe%1]):Y.texture.bind(Ye,E.CLAMP_TO_EDGE);const be=nf(fe,Te||[0,0],xe||1,he,s,S instanceof Ae?S.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(b,k,te),S instanceof Ae)S.boundsBuffer&&S.boundsSegments&&k.draw(b,E.TRIANGLES,q,o.StencilMode.disabled,D,o.CullFaceMode.disabled,be,s.id,S.boundsBuffer,c.quadTriangleIndexBuffer,S.boundsSegments);else{const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:Fe,tileBoundsSegments:it}=c.getTileBoundsBuffers(Y);k.draw(b,E.TRIANGLES,q,de,D,o.CullFaceMode.disabled,be,s.id,Be,Fe,it)}}c.resetStencilClippingMasks()},background:function(c,r,s,h){const m=s.paint.get("background-color"),y=s.paint.get("background-opacity");if(y===0)return;const b=c.context,E=b.gl,S=c.transform,k=S.tileSize,D=s.paint.get("background-pattern");if(c.isPatternMissing(D))return;const U=!D&&m.a===1&&y===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==U)return;const G=o.StencilMode.disabled,Q=c.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),W=c.colorModeForRenderPass(),X=c.useProgram(D?"backgroundPattern":"background");let H,q=h;q||(H=c.getBackgroundTiles(),q=Object.values(H).map(Y=>Y.tileID)),D&&(b.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context));const te=s.getCrossfadeParameters();for(const Y of q){const fe=Y.toUnwrapped(),de=h?Y.projMatrix:c.transform.calculateProjMatrix(fe);c.prepareDrawTile();const ae=r?r.getTile(Y):H?H[Y.key]:new o.Tile(Y,k,S.zoom,c),pe=D?sf(de,y,c,D,{tileID:Y,tileSize:k},te):of(de,y,m);c.prepareDrawProgram(b,X,fe);const{tileBoundsBuffer:he,tileBoundsIndexBuffer:xe,tileBoundsSegments:Te}=c.getTileBoundsBuffers(ae);X.draw(b,E.TRIANGLES,Q,G,W,o.CullFaceMode.disabled,pe,s.id,he,xe,Te)}},sky:function(c,r,s){const h=c.transform,m=h.projection.name==="mercator"||h.projection.name==="globe"?1:o.smoothstep(7,8,h.zoom),y=s.paint.get("sky-opacity")*m;if(y===0)return;const b=c.context,E=s.paint.get("sky-type"),S=new o.DepthMode(b.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),k=c.frameCounter/1e3%1;E==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(D,U,G,Q){const W=D.context,X=W.gl;let H=U.skyboxFbo;if(!H){H=U.skyboxFbo=W.createFramebuffer(32,32,!1),U.skyboxGeometry=new ru(W),U.skyboxTexture=W.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,U.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let fe=0;fe<6;++fe)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(H.framebuffer),W.viewport.set([0,0,32,32]);const q=U.getCenter(D,!0),te=D.useProgram("skyboxCapture"),Y=new Float64Array(16);o.identity(Y),o.rotateY(Y,Y,.5*-Math.PI),vs(W,U,te,Y,q,0),o.identity(Y),o.rotateY(Y,Y,.5*Math.PI),vs(W,U,te,Y,q,1),o.identity(Y),o.rotateX(Y,Y,.5*-Math.PI),vs(W,U,te,Y,q,2),o.identity(Y),o.rotateX(Y,Y,.5*Math.PI),vs(W,U,te,Y,q,3),o.identity(Y),vs(W,U,te,Y,q,4),o.identity(Y),o.rotateY(Y,Y,Math.PI),vs(W,U,te,Y,q,5),W.viewport.set([0,0,D.width,D.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(D,U,G,Q,W){const X=D.context,H=X.gl,q=D.transform,te=D.useProgram("skybox");X.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,U.skyboxTexture);const Y=((fe,de,ae,pe,he)=>({u_matrix:fe,u_sun_direction:de,u_cubemap:0,u_opacity:pe,u_temporal_offset:he}))(q.skyboxMatrix,U.getCenter(D,!1),0,Q,W);D.prepareDrawProgram(X,te),te.draw(X,H.TRIANGLES,G,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,Y,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,s,S,y,k):E==="gradient"&&c.renderPass==="sky"&&function(D,U,G,Q,W){const X=D.context,H=X.gl,q=D.transform,te=D.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new ru(X)),X.activeTexture.set(H.TEXTURE0);let Y=U.colorRampTexture;Y||(Y=U.colorRampTexture=new o.Texture(X,U.colorRamp,H.RGBA)),Y.bind(H.LINEAR,H.CLAMP_TO_EDGE);const fe=((de,ae,pe,he,xe)=>({u_matrix:de,u_color_ramp:0,u_center_direction:ae,u_radius:o.degToRad(pe),u_opacity:he,u_temporal_offset:xe}))(q.skyboxMatrix,U.getCenter(D,!1),U.paint.get("sky-gradient-radius"),Q,W);D.prepareDrawProgram(X,te),te.draw(X,H.TRIANGLES,G,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,fe,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,s,S,y,k)},debug:function(c,r,s){for(let h=0;h<s.length;h++)bi(c,r,s[h])},custom:function(c,r,s){const h=c.context,m=s.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const y=m.prerender;y&&(c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),y.call(m,h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),h.setStencilMode(o.StencilMode.disabled);const y=m.renderingMode==="3d"?new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,o.DepthMode.ReadOnly);h.setDepthMode(y),m.render(h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState(),h.bindFramebuffer.set(null)}}};class ou{constructor(r,s){this.context=new J(r),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,s){const h=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ph(this,r));const m=this._terrain;this.transform.elevation=h?m:null,m.update(r,this.transform,s)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const y=h+.78*(m-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,s){if(this.width=r*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const r=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const h=new o.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(o.EXTENT,0),h.emplaceBack(0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(h,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(o.EXTENT,0,o.EXTENT,0),y.emplaceBack(0,o.EXTENT,0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(y,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const b=new o.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(b);const E=new o.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])E.emplaceBack(k);this.debugIndexBuffer=r.createIndexBuffer(E),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const S=this.context.gl;this.stencilClearMode=new o.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Il(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,s=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Nc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,h){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const S of h)if(this._tileClippingMaskIDs[S.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=s.id;const m=this.context,y=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const S=s.getTile(E),k=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=this.getTileBoundsBuffers(S);b.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},k,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Nc(E.projMatrix),"$clipping",D,U,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,h=r.sort((b,E)=>E.overscaledZ-b.overscaledZ),m=h[h.length-1].overscaledZ,y=h[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let E=0;E<y;E++)b[E+m]=new o.StencilMode({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[b,h]}return[{[m]:o.StencilMode.disabled},h]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,s,h){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(h||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,s){this.style=r,this.options=s,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const S in m){const k=m[S];k.used&&k.prepare(this.context)}const y={},b={},E={};for(const S in m){const k=m[S];y[S]=k.getVisibleCoordinates(),b[S]=y[S].slice().reverse(),E[S]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<h.length;S++)if(this.style._layers[h[S]].is3D()){this.opaquePassCutoff=S;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const S of h){const k=this.style._layers[S],D=r._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const U=D?b[D.id]:void 0;(k.type==="custom"||k.isSky()||U&&U.length)&&this.renderLayer(this,D,k,U)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[h[this.currentLayer]],k=r._getLayerSourceCache(S);if(S.isSky())continue;const D=k?b[k.id]:void 0;this._renderTileClippingMasks(S,k,D),this.renderLayer(this,k,S,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(S,k){const D=S.context,U=D.gl,G=S.transform,Q=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),W=S.useProgram("globeAtmosphere",null,G.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),X=o.globeToMercatorTransition(G.zoom),H=k.properties.get("color").toArray01(),q=k.properties.get("high-color").toArray01(),te=k.properties.get("space-color").toArray01PremultipliedAlpha(),Y=o.identity$1([]);o.rotateY$1(Y,Y,-o.degToRad(G._center.lng)),o.rotateX$1(Y,Y,o.degToRad(G._center.lat)),o.rotateZ$1(Y,Y,G.angle),o.rotateX$1(Y,Y,-G._pitch);const fe=o.fromQuat(new Float32Array(16),Y),de=o.mapValue(k.properties.get("star-intensity"),0,1,0,.25),ae=5e-4,pe=o.mapValue(k.properties.get("horizon-blend"),0,1,ae,.25),he=o.globeUseCustomAntiAliasing(S,D,G)&&pe===ae?G.worldSize/(2*Math.PI*1.025)-1:G.globeRadius,xe=S.frameCounter/1e3%1,Te=o.length(G.globeCenterInViewSpace),Ye=Math.sqrt(Math.pow(Te,2)-Math.pow(he,2)),be=Math.acos(Ye/Te),Be=((it,ze,Ke,Oe,at,ot,bt,Mt,jt,oi,wt,Zt,_i,Gi)=>({u_frustum_tl:it,u_frustum_tr:ze,u_frustum_br:Ke,u_frustum_bl:Oe,u_horizon:at,u_transition:ot,u_fadeout_range:bt,u_color:Mt,u_high_color:jt,u_space_color:oi,u_star_intensity:wt,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Zt,u_horizon_angle:_i,u_rotation_matrix:Gi}))(G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.frustumCorners.horizon,X,pe,H,q,te,de,xe,be,fe);S.prepareDrawProgram(D,W);const Fe=S.atmosphereBuffer;Fe&&W.draw(D,U.TRIANGLES,Q,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Be,"skybox",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const S=this.style._layers[h[this.currentLayer]],k=r._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,k,S,k?b[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const S=this.style._layers[h[this.currentLayer]],k=r._getLayerSourceCache(S);if(S.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(S)){if(S.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=k?(S.type==="symbol"?E:b)[k.id]:void 0;this._renderTileClippingMasks(S,k,k?y[k.id]:void 0),this.renderLayer(this,k,S,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let S=null;o.values(this.style._layers).forEach(k=>{const D=r._getLayerSourceCache(k);D&&!k.isHidden(this.transform.zoom)&&(!S||S.getSource().maxzoom<D.getSource().maxzoom)&&(S=D)}),S&&this.options.showTileBoundaries&&As.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const k=S.transform.padding;ya(S,S.transform.height-(k.top||0),3,$h),ya(S,k.bottom||0,3,ys),Zh(S,k.left||0,3,xs),Zh(S,S.transform.width-(k.right||0),3,Gh);const D=S.transform.centerPoint;(function(U,G,Q,W){xa(U,G-1,Q-10,2,20,W),xa(U,G-10,Q-1,20,2,W)})(S,D.x,S.transform.height-D.y,iu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(h.type)||As[h.type](r,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[r.id];h||(h=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),r.beginQueryEXT(r.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const h in r){const m=r[h],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),s[h]=b}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let h=0;for(const m of r)h+=s.getQueryObjectEXT(m,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(m);return h}translatePosMatrix(r,s,h,m,y){if(!h[0]&&!h[1])return r;const b=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(b){const k=Math.sin(b),D=Math.cos(b);h=[h[0]*D-h[1]*k,h[0]*k+h[1]*D]}const E=[y?h[0]:tn(s,h[0],this.transform.zoom),y?h[1]:tn(s,h[1],this.transform.zoom),0],S=new Float32Array(16);return o.translate(S,r,E),S}saveTileTexture(r){const s=this._tileTextures[r.size[0]];s?s.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const s=this.imageManager.getPattern(r.from.toString()),h=this.imageManager.getPattern(r.to.toString());return!s||!h}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),s&&!r&&s.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),r&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(r,s,h){this.cache=this.cache||{};const m=h||[],y=this.currentGlobalDefines().concat(m),b=Zc.cacheKey(_l[r],r,y,s);return this.cache[b]||(this.cache[b]=new Zc(this.context,r,_l[r],s,af[r],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const y=m.getOpacity(this.transform.pitch),b=((E,S,k,D,U,G,Q,W,X,H,q)=>{const te=E.transform,Y=S.properties.get("color").toArray01();Y[3]=D;const fe=E.frameCounter/1e3%1;return{u_fog_matrix:k?te.calculateFogTileMatrix(k):E.identityMat,u_fog_range:S.getFovAdjustedRange(te._fov),u_fog_color:Y,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:fe,u_frustum_tl:U,u_frustum_tr:G,u_frustum_br:Q,u_frustum_bl:W,u_globe_pos:X,u_globe_radius:H,u_viewport:q,u_globe_transition:o.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,m,h,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(r,b)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=r[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class Aa{constructor(r=0,s=0,h=0,m=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=h,this.right=m}interpolate(r,s,h){return s.top!=null&&r.top!=null&&(this.top=o.number(r.top,s.top,h)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,s.bottom,h)),s.left!=null&&r.left!=null&&(this.left=o.number(r.left,s.left,h)),s.right!=null&&r.right!=null&&(this.right=o.number(r.right,s.right,h)),this}getCenter(r,s){const h=o.clamp((this.left+r-this.right)/2,0,r),m=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(h,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function su(c,r){const s=o.getColumn(c,3);o.fromQuat(c,r),o.setColumn(c,3,s)}function bs(c,r){const s=o.identity$1([]);return o.rotateZ$1(s,s,-r),o.rotateX$1(s,s,-c),s}function ws(c,r){const s=[c[0],c[1],0],h=[r[0],r[1],0];if(o.length(s)>=1e-15){const b=o.normalize([],s);o.scale$2(h,b,o.dot(h,b)),r[0]=h[0],r[1]=h[1]}const m=o.cross([],r,c);if(o.len(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return bs(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),y)}class pt{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,m=this.position,y=o.MercatorCoordinate.fromLngLat(r,h),b=[y.x-m.x,y.y-m.y,y.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=ws(b,s)}setPitchBearing(r,s){this.orientation=bs(o.degToRad(r),o.degToRad(-s))}}class on{constructor(r,s){this._transform=o.identity([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.setColumn(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&su(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=bs(r,s),su(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const h=new Float64Array(16);return o.invert(h,this.getWorldToCamera(r,s)),h}getWorldToCameraPosition(r,s,h){const m=this.position;o.scale$2(m,m,-r);const y=new Float64Array(16);return o.fromScaling(y,[h,h,h]),o.translate(y,y,m),y[10]*=s,y}getWorldToCamera(r,s){const h=new Float64Array(16),m=new Float64Array(4),y=this.position;return o.conjugate(m,this._orientation),o.scale$2(y,y,-r),o.fromQuat(h,m),o.translate(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(r,s,h,m){const y=new Float64Array(16);return o.perspective(y,r,s,h,m),y}getDistanceToElevation(r){const s=r===0?0:o.mercatorZfromAltitude(r,this.position[1]),h=this.forward();return(s-this.position[2])/h[2]}clone(){return new on([...this.position],[...this.orientation])}}function au(c,r){const s=ba(c.projection,c.zoom,c.width,c.height),h=function(y,b,E,S,k){const D=new o.LngLat(E.lng-180*Mn,E.lat),U=new o.LngLat(E.lng+180*Mn,E.lat),G=y.project(D.lng,D.lat),Q=y.project(U.lng,U.lat),W=-Math.atan2(Q.y-G.y,Q.x-G.x),X=o.MercatorCoordinate.fromLngLat(E);X.y=o.clamp(X.y,-.999975,.999975);const H=X.toLngLat(),q=y.project(H.lng,H.lat),te=o.MercatorCoordinate.fromLngLat(H);te.x+=Mn;const Y=te.toLngLat(),fe=y.project(Y.lng,Y.lat),de=wa(fe.x-q.x,fe.y-q.y,W),ae=o.MercatorCoordinate.fromLngLat(H);ae.y+=Mn;const pe=ae.toLngLat(),he=y.project(pe.lng,pe.lat),xe=wa(he.x-q.x,he.y-q.y,W),Te=Math.abs(de.x)/Math.abs(xe.y),Ye=o.identity([]);o.rotateZ(Ye,Ye,-W*(1-(k?0:S)));const be=o.identity([]);return o.scale(be,be,[1,1-(1-Te)*S,1]),be[4]=-xe.x/xe.y*S,o.rotateZ(be,be,W),o.multiply(be,Ye,be),be}(c.projection,0,c.center,s,r),m=lu(c);return o.scale(h,h,[m,m,1]),h}function lu(c){const r=c.projection,s=ba(c.projection,c.zoom,c.width,c.height),h=cu(r,c.center),m=cu(r,o.LngLat.convert(r.center));return Math.pow(2,h*s+(1-s)*m)}function ba(c,r,s,h,m=1/0){const y=c.range;if(!y)return 0;const b=Math.min(m,Math.max(s,h)),E=Math.log(b/1024)/Math.LN2;return o.smoothstep(y[0]+E,y[1]+E,r)}const Mn=1/4e4;function cu(c,r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=new o.LngLat(r.lng-180*Mn,s),m=new o.LngLat(r.lng+180*Mn,s),y=c.project(h.lng,s),b=c.project(m.lng,s),E=o.MercatorCoordinate.fromLngLat(h),S=o.MercatorCoordinate.fromLngLat(m),k=b.x-y.x,D=b.y-y.y,U=S.x-E.x,G=S.y-E.y,Q=Math.sqrt((U*U+G*G)/(k*k+D*D));return Math.log(Q)/Math.LN2}function wa(c,r,s){const h=Math.cos(s),m=Math.sin(s);return{x:c*h-r*m,y:c*m+r*h}}class Ea{constructor(r,s,h,m,y,b,E){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=h==null?0:h,this._maxPitch=m==null?60:m,this.setProjection(b),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Aa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new on,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Ea(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||s)&&this._updateCameraOnTerrain(),(r||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const h=!P(s,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,y,b){var E=y[0],S=y[1],k=y[2],D=y[3],U=Math.sin(b),G=Math.cos(b);m[0]=E*G+k*U,m[1]=S*G+D*U,m[2]=E*-U+k*G,m[3]=S*-U+D*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,y=0;for(let b=0;b<s.length;b++){const E=new o.pointGeometry(s[b][0]*this.width,h+s[b][1]*(this.height-h)),S=r.pointCoordinate(E);if(!S)continue;const k=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*k,y+=k}return y===0?NaN:m/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-h,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let h;h=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const m=o.length(o.sub([],this._camera.position,h));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const h=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new pt;return s.position=new o.MercatorCoordinate(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const s=o.transformQuat([],[0,0,-1],r),h=o.transformQuat([],[0,-1,0],r);if(h[2]<0)return!1;const m=ws(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;r[2]=o.clamp(r[2],m/h,m/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,h){this._unmodified=!1,this._edgeInsets.interpolate(r,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(h.x,m.x,y.x,b.x)),S=Math.floor(Math.max(h.x,m.x,y.x,b.x)),k=1;for(let D=E-k;D<=S+k;D++)D!==0&&s.push(new o.UnwrappedTileID(D,r))}return s}coveringTiles(r){let s=this.coveringZoomLevel(r);const h=s,m=this.elevation&&!r.isTerrainDEM,y=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const b=this.locationCoordinate(this.center),E=this.center.lat,S=1<<s,k=[S*b.x,S*b.y,0],D=this.projection.name==="globe",U=!D,G=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,U),Q=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=S*o.mercatorZfromAltitude(1,this.center.lat),X=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),H=[S*Q.x,S*Q.y,X*(U?1:W)],q=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,Y=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,fe=r.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?lu(this):1,ae=ze=>{const Oe=new o.MercatorCoordinate(ze.x+25e-6,ze.y,ze.z),at=new o.MercatorCoordinate(ze.x,ze.y+25e-6,ze.z),ot=ze.toLngLat(),bt=Oe.toLngLat(),Mt=at.toLngLat(),jt=this.locationCoordinate(ot),oi=this.locationCoordinate(bt),wt=this.locationCoordinate(Mt),Zt=Math.hypot(oi.x-jt.x,oi.y-jt.y),_i=Math.hypot(wt.x-jt.x,wt.y-jt.y);return Math.sqrt(Zt*_i)*de/25e-6},pe=ze=>{const Ke=Y,Oe=fe;return{aabb:o.tileAABB(this,S,0,0,0,ze,Oe,Ke,this.projection),zoom:0,x:0,y:0,minZ:Oe,maxZ:Ke,wrap:ze,fullyVisible:!1}},he=[];let xe=[];const Te=s,Ye=r.reparseOverscaled?h:s,be=ze=>ze*ze,Be=be((X-this._centerAltitude)*W),Fe=ze=>{if(!this._elevation||!ze.tileID||!y)return;const Ke=this._elevation.getMinMaxForTile(ze.tileID),Oe=ze.aabb;Ke?(Oe.min[2]=Ke.min,Oe.max[2]=Ke.max,Oe.center[2]=(Oe.min[2]+Oe.max[2])/2):(ze.shouldSplit=it(ze),ze.shouldSplit||(Oe.min[2]=Oe.max[2]=Oe.center[2]=this._centerAltitude))},it=ze=>{if(ze.zoom<te)return!0;if(ze.zoom===Te)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const Ke=ze.aabb.distanceX(H),Oe=ze.aabb.distanceY(H);let at=Be,ot=1;if(D){at=be(ze.aabb.distanceZ(H));const Mt=Math.pow(2,ze.zoom),jt=o.latFromMercatorY((ze.y+1)/Mt),oi=o.latFromMercatorY(ze.y/Mt),wt=Math.min(Math.max(E,jt),oi),Zt=o.circumferenceAtLatitude(wt)/o.circumferenceAtLatitude(E);if(ot=wt===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Zt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&ze.zoom===Te-1&&Zt>=.9)return!0}else if(m&&(at=be(ze.aabb.distanceZ(H)*W)),this.projection.isReprojectedInTileSpace&&h<=5){const Mt=Math.pow(2,ze.zoom),jt=ae(new o.MercatorCoordinate((ze.x+.5)/Mt,(ze.y+.5)/Mt));ot=jt>.85?1:jt}const bt=Ke*Ke+Oe*Oe+at;return bt<be((1<<Te-ze.zoom)*q*ot*((Mt,jt)=>{if(jt*be(.707)<Mt)return 1;const oi=Math.sqrt(jt/Mt);return oi/(1.4144271570014144+(Math.pow(1.1,oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,Be),bt))};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)he.push(pe(-ze)),he.push(pe(ze));for(he.push(pe(0));he.length>0;){const ze=he.pop(),Ke=ze.x,Oe=ze.y;let at=ze.fullyVisible;if(!at){const ot=ze.aabb.intersects(G);if(ot===0)continue;at=ot===2}if(ze.zoom!==Te&&it(ze))for(let ot=0;ot<4;ot++){const bt=(Ke<<1)+ot%2,Mt=(Oe<<1)+(ot>>1),jt={aabb:y?ze.aabb.quadrant(ot):o.tileAABB(this,S,ze.zoom+1,bt,Mt,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:bt,y:Mt,wrap:ze.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};m&&!D&&(jt.tileID=new o.OverscaledTileID(ze.zoom+1===Te?Ye:ze.zoom+1,ze.wrap,ze.zoom+1,bt,Mt),Fe(jt)),he.push(jt)}else{const ot=ze.zoom===Te?Ye:ze.zoom;if(r.minzoom&&r.minzoom>ot)continue;const bt=k[0]-(.5+Ke+(ze.wrap<<ze.zoom))*(1<<s-ze.zoom),Mt=k[1]-.5-Oe,jt=ze.tileID?ze.tileID:new o.OverscaledTileID(ot,ze.wrap,ze.zoom,Ke,Oe);xe.push({tileID:jt,distanceSq:bt*bt+Mt*Mt})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,Ke=this.horizonLineFromTop();xe=xe.filter(Oe=>{const at=[0,0,0,1],ot=[o.EXTENT,o.EXTENT,0,1],bt=this.calculateFogTileMatrix(Oe.tileID.toUnwrapped());o.transformMat4$1(at,at,bt),o.transformMat4$1(ot,ot,bt);const Mt=o.getAABBPointSquareDist(at,ot);if(Mt===0)return!0;let jt=!1;const oi=this._elevation;if(oi&&Mt>ze&&Ke!==0){const wt=this.calculateProjMatrix(Oe.tileID.toUnwrapped());let Zt;r.isTerrainDEM||(Zt=oi.getMinMaxForTile(Oe.tileID)),Zt||(Zt={min:fe,max:Y});const _i=o.furthestTileCorner(this.rotation),Gi=[_i[0]*o.EXTENT,_i[1]*o.EXTENT,Zt.max];o.transformMat4(Gi,Gi,wt),jt=(1-Gi[1])*this.height*.5<Ke}return Mt<ze||jt})}return xe.sort((ze,Ke)=>ze.distanceSq-Ke.distanceSq).map(ze=>ze.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=this.projection.project(r.lng,s);return new o.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,s){let h,m;const y=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;h=(s.x-y.x)/E,m=(s.y-y.y)/E}else{const E=this.pointCoordinate(s),S=this.pointCoordinate(y);h=E.x-S.x,m=E.y-S.y}const b=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(b.x-h,b.y-m))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,s){const h=s?o.mercatorZfromAltitude(s,r.lat):void 0,m=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(m.x,m.y,h)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const h=s!=null?s:this._centerAltitude,m=[r.x,r.y,0,1],y=[r.x,r.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse);const b=y[3];o.scale$1(m,m,1/m[3]),o.scale$1(y,y,1/b);const E=m[2],S=y[2];return{p0:m,p1:y,t:E===S?0:(h-E)/(S-E)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],h=[r.x,r.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(h,h,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(h,h,1/h[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=o.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(h,h,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],h,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:h,t:m}=r,y=o.mercatorZfromAltitude(s[2],this._center.lat),b=o.mercatorZfromAltitude(h[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],h[0],m)/this.worldSize,o.number(s[1],h[1],m)/this.worldSize,o.number(y,b,m))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let s=this.projection.pointCoordinate3D(this,r.x,r.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let h=0,m=this.horizonLineFromTop();if(r.y>m)return this.pointCoordinate(r);const y=.02*m,b=r.clone();for(let E=0;E<10&&m-h>y;E++){b.y=o.number(h,m,.66);const S=this.projection.pointCoordinate3D(this,b.x,b.y);S?(m=b.y,s=S):h=b.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,m=[r.x*this.worldSize,r.y*this.worldSize,h+r.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,s){const h=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(h,r),S=this.pointCoordinate(m,r);const k=this.pointCoordinate(y,s),D=this.pointCoordinate(b,s),U=(G,Q)=>(Q.y-G.y)/(Q.x-G.x);return E.y>1&&S.y>=0?E=new o.MercatorCoordinate((1-D.y)/U(D,E)+D.x,1):E.y<0&&S.y<=1&&(E=new o.MercatorCoordinate(-D.y/U(D,E)+D.x,0)),S.y>1&&E.y>=0?S=new o.MercatorCoordinate((1-k.y)/U(k,S)+k.x,1):S.y<0&&E.y<=1&&(S=new o.MercatorCoordinate(-k.y/U(k,S)+k.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(k))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const s=r.visibleDemTiles.reduce((h,m)=>{if(m.dem){const y=m.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=r.canonical,y=1/this.height,b=this.cameraWorldSize/this.zoomScale(m.z),E=(m.x+Math.pow(2,m.z)*r.wrap)*b,S=m.y*b,k=this.point,D=this.angle,U=Math.sin(-D),G=-Math.cos(-D);return h[s]={bearing:[U,G],center:[(k.x-E)*y,(k.y-S)*y],scale:b/o.EXTENT*y},h[s]}calculateFogTileMatrix(r){const s=r.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return o.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(r,s=!1){const h=r.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const y=this.calculatePosMatrix(r,this.worldSize);return o.multiply(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,y),m[h]=new Float32Array(y),m[h]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=function(y,b){const{scale:E}=y.tileTransform,S=E*o.EXTENT/(y.tileSize*Math.pow(2,b.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return k=new Float32Array(4),G=(D=b.inverseAdjustmentMatrix)[1],Q=D[2],W=D[3],H=(U=[S,S])[1],k[0]=D[0]*(X=U[0]),k[1]=G*X,k[2]=Q*H,k[3]=W*H,k;var k,D,U,G,Q,W,X,H}(r,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),y=o.mercatorZfromAltitude(1,this._center.lat);h[2]/=y,m[2]/=y,o.normalize(m,m);const b=r.raycast(h,m,r.exaggeration());if(b){const E=o.scaleAndAdd([],h,m,b),S=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),k=(S.z+o.length([S.x-h[0],S.y-h[1],S.z-h[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=r.getAtPointOrZero(new o.MercatorCoordinate(...h)),y=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(b<y){const E=this.locationCoordinate(this._center,this._centerAltitude),S=[E.x-h[0],E.y-h[1],E.z-h[2]],k=o.length(S);S[2]-=(y-b)/this._pixelsPerMercatorPixel;const D=o.length(S);if(D===0)return;o.scale$2(S,S,k/D*this._pixelsPerMercatorPixel),this._camera.position=[E.x-S[0],E.y-S[1],E.z*this._pixelsPerMercatorPixel-S[2]],this._camera.orientation=ws(S,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const G=this.center;return G.lat=o.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(G.lng=o.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let y=0,b=h,E=m;const S=this.width/2,k=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(m-k<D&&(E=D+k),m+k>U&&(E=U-k),U-D<this.height&&(y=Math.max(y,this.height/(U-D)),E=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,W=this.worldSize/2-(G+Q)/2;b=(h+W+this.worldSize)%this.worldSize-W,b-S<G&&(b=G+S),b+S>Q&&(b=Q-S),Q-G<this.width&&(y=Math.max(y,this.width/(Q-G)),b=(Q+G)/2)}b===h&&E===m||(this.center=this.unproject(new o.pointGeometry(b,E))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const h=ba(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?s:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-r.x/this.width,y[9]=2*r.y/this.height;let b=o.mul([],y,m);if(this.projection.isReprojectedInTileSpace){const de=this.locationCoordinate(this.center),ae=o.identity([]);o.translate(ae,ae,[de.x*this.worldSize,de.y*this.worldSize,0]),o.multiply(ae,ae,au(this)),o.translate(ae,ae,[-de.x*this.worldSize,-de.y*this.worldSize,0]),o.multiply(b,b,ae),this.inverseAdjustmentMatrix=function(pe){const he=au(pe,!0);return Et([],[he[0],he[1],he[4],he[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],b,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=b,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=o.invert([],y);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const S=new Float32Array(16);o.identity(S),o.scale(S,S,[1,-1,1]),o.rotateX(S,S,this._pitch),o.rotateZ(S,S,this.angle);const k=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-r.x/this.width,k[9]=2*(r.y+D)/this.height,this.skyboxMatrix=o.multiply(S,k,S);const U=this.point,G=U.x,Q=U.y,W=this.width%2/2,X=this.height%2/2,H=Math.cos(this.angle),q=Math.sin(this.angle),te=G-Math.round(G)+H*W+q*X,Y=Q-Math.round(Q)+H*X+q*W,fe=new Float64Array(b);if(o.translate(fe,fe,[te>.5?te-1:te,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=fe,b=o.create(),o.scale(b,b,[this.width/2,-this.height/2,1]),o.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=o.create(),o.scale(b,b,[1,-1,1]),o.translate(b,b,[-1,-1,0]),o.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=o.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=b,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(de,de,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=b;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[r,r,s];o.scale$2(y,y,m),o.scale$2(h,h,-1),o.multiply$2(h,h,y);const b=o.create();o.translate(b,b,h),o.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,m)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*y,m.y/this.worldSize-h[1]*y,r/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=r[2];let m=1;h>0&&(m=Math.min((s-this._camera.position[2])/h,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),y=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((r[2]-y)/Math.cos(h),b),S=this._zoomFromMercatorZ(E);o.scaleAndAdd(r,r,s,E),this._pitch=o.clamp(h,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const h=Math.min(r.x,s.x),m=Math.max(r.x,s.x),y=Math.min(r.y,s.y),b=Math.max(r.y,s.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(h,y),new o.pointGeometry(m,b),new o.pointGeometry(h,b),new o.pointGeometry(m,y)],S=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const D of E){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const G=this.rayIntersectionCoordinate(U);if(G.x<S||G.y<0||G.x>k||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,s){const h=o.length(o.sub([],this._camera.position,r)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const r=function(s,h){const m=[s[0],s[1],s[2],1];o.transformMat4$1(m,m,h);const y=Math.max(m[3],1e-6);return[m[0]/y,m[1]/y,m[2]/y,y]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,r))}}getCameraToCenterDistance(r){const s=ba(r,this.zoom,this.width,this.height,1024),h=r.pixelSpaceConversion(this.center.lat,this.worldSize,s);return .5/Math.tan(.5*this._fov)*this.height*h}}function Ta(c,r){let s=!1,h=null;const m=()=>{h=null,s&&(c(),h=setTimeout(m,r),s=!1)};return()=>(s=!0,h||m(),h)}class qh{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ta(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=uu(r);if(this._hashName){const h=this._hashName;let m=!1;const y=o.window.location.hash.slice(1).split("&").map(b=>{const E=b.split("=")[0];return E===h?(m=!0,`${E}=${s}`):b}).filter(b=>b);return m||y.push(`${h}=${s}`),`#${y.join("&")}`}return`#${s}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function uu(c,r){const s=c.getCenter(),h=Math.round(100*c.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),b=Math.round(s.lng*y)/y,E=Math.round(s.lat*y)/y,S=c.getBearing(),k=c.getPitch();let D=r?`/${b}/${E}/${h}`:`${h}/${E}/${b}`;return(S||k)&&(D+="/"+Math.round(10*S)/10),k&&(D+=`/${Math.round(k)}`),D}const Yn={linearity:.3,easing:o.bezier(0,0,.3,1)},cf=o.extend({deceleration:2500,maxSpeed:1400},Yn),uf=o.extend({deceleration:20,maxSpeed:1400},Yn),Wh=o.extend({deceleration:1e3,maxSpeed:360},Yn),Cl=o.extend({deceleration:1e3,maxSpeed:90},Yn);class hu{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.exported.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const y=Ia(s.pan.mag(),h,o.extend({},cf,r||{}));m.offset=s.pan.mult(y.amount/s.pan.mag()),m.center=this._map.transform.center,Sa(m,y)}if(s.zoom){const y=Ia(s.zoom,h,uf);m.zoom=this._map.transform.zoom+y.amount,Sa(m,y)}if(s.bearing){const y=Ia(s.bearing,h,Wh);m.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),Sa(m,y)}if(s.pitch){const y=Ia(s.pitch,h,Cl);m.pitch=this._map.transform.pitch+y.amount,Sa(m,y)}if(m.zoom||m.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Sa(c,r){(!c.duration||c.duration<r.duration)&&(c.duration=r.duration,c.easing=r.easing)}function Ia(c,r,s){const{maxSpeed:h,linearity:m,deceleration:y}=s,b=o.clamp(c*m/(r/1e3),-h,h),E=Math.abs(b)/(y*m);return{easing:s.easing,duration:1e3*E,amount:b*(E/2)}}class Pr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h,m={}){const y=He(s.getCanvasContainer(),h),b=s.unproject(y);super(r,o.extend({point:y,lngLat:b,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class Es extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){const m=r==="touchend"?h.changedTouches:h.touches,y=yt(s.getCanvasContainer(),m),b=y.map(S=>s.unproject(S)),E=y.reduce((S,k,D,U)=>S.add(k.div(U.length)),new o.pointGeometry(0,0));super(r,{points:y,point:E,lngLats:b,lngLat:s.unproject(E),originalEvent:h}),this._defaultPrevented=!1}}class Xh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){super(r,{originalEvent:h}),this._defaultPrevented=!1}}class Hh{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Xh(r.type,this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new Pr(r.type,this._map,r))}mouseup(r){this._map.fire(new Pr(r.type,this._map,r))}preclick(r){const s=o.extend({},r);s.type="preclick",this._map.fire(new Pr(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Pr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Pr(r.type,this._map,r))}mouseover(r){this._map.fire(new Pr(r.type,this._map,r))}mouseout(r){this._map.fire(new Pr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Es(r.type,this._map,r))}touchmove(r){this._map.fire(new Es(r.type,this._map,r))}touchend(r){this._map.fire(new Es(r.type,this._map,r))}touchcancel(r){this._map.fire(new Es(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Pr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Pr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yh{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(Ge(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=$("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(m.x,h.x),b=Math.max(m.x,h.x),E=Math.min(m.y,h.y),S=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=b-y+"px",this._box.style.height=S-E+"px")})}mouseupWindow(r,s){if(!this._active||r.button!==0)return;const h=this._startPos,m=s;if(this.reset(),ft(),h.x!==m.x||h.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ze(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.Event(r,{originalEvent:s}))}}function Ml(c,r){const s={};for(let h=0;h<c.length;h++)s[c[h].identifier]=r[h];return s}class Ts{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const y=new o.pointGeometry(0,0);for(const b of m)y._add(b);return y.div(m.length)}(s),this.touches=Ml(h,s)))}touchmove(r,s,h){if(this.aborted||!this.centroid)return;const m=Ml(h,s);for(const y in this.touches){const b=this.touches[y],E=m[y];(!E||E.dist(b)>30)&&(this.aborted=!0)}}touchend(r,s,h){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class zl{constructor(r){this.singleTap=new Ts(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,h){this.singleTap.touchstart(r,s,h)}touchmove(r,s,h){this.singleTap.touchmove(r,s,h)}touchend(r,s,h){const m=this.singleTap.touchend(r,s,h);if(m){const y=r.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(y&&b||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Jh{constructor(){this._zoomIn=new zl({numTouches:1,numTaps:2}),this._zoomOut=new zl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,h){this._zoomIn.touchstart(r,s,h),this._zoomOut.touchstart(r,s,h)}touchmove(r,s,h){this._zoomIn.touchmove(r,s,h),this._zoomOut.touchmove(r,s,h)}touchend(r,s,h){const m=this._zoomIn.touchend(r,s,h),y=this._zoomOut.touchend(r,s,h);return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Kh={0:1,2:2};class kl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const h=We(r);this._correctButton(r,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(r,s){const h=this._lastPoint;if(h){if(r.preventDefault(),this._eventButton!=null&&function(m,y){const b=Kh[y];return m.buttons===void 0||(m.buttons&b)!==b}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(r){this._lastPoint&&We(r)===this._eventButton&&(this._moved&&ft(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ed extends kl{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class du extends kl{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=.8*(s.x-r.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(r){r.preventDefault()}}class Tr extends kl{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=-.5*(s.y-r.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(r){r.preventDefault()}}class hf{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(r,s,h){return this._calculateTransform(r,s,h)}touchmove(r,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,h)}}touchend(r,s,h){this._calculateTransform(r,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,h){h.length>0&&(this._active=!0);const m=Ml(h,s),y=new o.pointGeometry(0,0),b=new o.pointGeometry(0,0);let E=0;for(const k in m){const D=m[k],U=this._touches[k];U&&(y._add(D),b._add(D.sub(U)),E++,m[k]=D)}if(this._touches=m,E<this._minTouches||!b.mag())return;const S=b.div(E);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Pl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,h){return{}}touchstart(r,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,h){const m=this._firstTwoTouches;if(!m)return;r.preventDefault();const[y,b]=m,E=Dl(h,s,y),S=Dl(h,s,b);if(!E||!S)return;const k=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],k,r)}touchend(r,s,h){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,b=Dl(h,s,m),E=Dl(h,s,y);b&&E||(this._active&&ft(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dl(c,r,s){for(let h=0;h<c.length;h++)if(c[h].identifier===s)return r[h]}function td(c,r){return Math.log(c/r)/Math.LN2}class Jn extends Pl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const h=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(td(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:td(this._distance,h),pinchAround:s}}}function pu(c,r){return 180*c.angleWith(r)/Math.PI}class Ss extends Pl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const h=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pu(this._vector,h),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,h=pu(r,this._startVector);return Math.abs(h)<s}}function fn(c){return Math.abs(c.y)>Math.abs(c.x)}class Bl extends Pl{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,fn(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,h){const m=this._lastPoints;if(!m)return;const y=r[0].sub(m[0]),b=r[1].sub(m[1]);return this._map._cooperativeGestures&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,h.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(r,s,h){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,y=s.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const b=r.y>0==s.y>0;return fn(r)&&fn(s)&&b}}const _t={panStep:100,bearingStep:15,pitchStep:10};class id{constructor(){const r=_t;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,h=0,m=0,y=0,b=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?h=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?h=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),b=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:E=>{const S=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:rd,zoom:s?Math.round(S)+s*(r.shiftKey?2:1):S,bearing:E.getBearing()+h*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rd(c){return c*(2-c)}const Is=4.000244140625;class Ca{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const h=o.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Is==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=He(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Is?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const D=s(),U=Math.pow(2,D),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*k))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,y=this._easing;let b,E=!1;if(this._type==="wheel"&&m&&y){const S=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),k=y(S);b=o.number(m,h,k),S<1?this._frameId||(this._frameId=!0):E=!0}else b=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.ease;if(this._prevEase){const h=this._prevEase,m=(o.exported.now()-h.start)/h.duration,y=h.easing(m+.01)-h.easing(m),b=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-b*b);s=o.bezier(b,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class nd{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(r.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sd{constructor(){this._tap=new zl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,h){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(r,s,h))}touchmove(r,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,s,h)}touchend(r,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(r,s,h)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(r,s,h){this._el=r,this._mousePan=s,this._touchPan=h}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ld{constructor(r,s,h){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cd{constructor(r,s,h,m){this._el=r,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ma=c=>c.zoom||c.drag||c.pitch||c.rotate;class Ll extends o.Event{}class fu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const h=o.sub([],s,r);this.radius=o.length(h[2]<0?o.div([],h,this.constants):[h[0],h[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const s=o.scale$2([],r,this.radius);if(s[2]>0){const h=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),m=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),y=o.add([],s,o.scale$2([],o.sub([],o.add([],m,h),s),2));s[0]=y[0],s[1]=y[1]}return s}}function $o(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class ud{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hu(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,y,b]of this._listeners)m.addEventListener(y,m===o.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[r,s,h]of this._listeners)r.removeEventListener(s,r===o.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(r){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Hh(s,r));const m=s.boxZoom=new Yh(s,r);this._add("boxZoom",m);const y=new Jh,b=new od;s.doubleClickZoom=new nd(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const E=new sd;this._add("tapDragZoom",E);const S=s.touchPitch=new Bl(s);this._add("touchPitch",S);const k=new du(r),D=new Tr(r);s.dragRotate=new ld(r,k,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new ed(r),G=new hf(s,r);s.dragPan=new ad(h,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]);const Q=new Ss,W=new Jn;s.touchZoomRotate=new cd(h,W,Q,E),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qh(s));const X=s.scrollZoom=new Ca(s,this);this._add("scrollZoom",X,["mousePan"]);const H=s.keyboard=new id;this._add("keyboard",H);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[q]&&s[q].enable(r[q])}_add(r,s,h){this._handlers.push({handlerName:r,handler:s,allowed:h}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ma(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,s,h){for(const m in r)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const h of r)this._el.contains(h.target)&&s.push(h);return s}handleEvent(r,s){this._updatingCamera=!0;const h=r.type==="renderFrame",m=h?void 0:r,y={needsRenderFrame:!1},b={},E={},S=r.touches?this._getMapTouches(r.touches):void 0,k=S?yt(this._el,S):h?void 0:He(this._el,r);for(const{handlerName:G,handler:Q,allowed:W}of this._handlers){if(!Q.isEnabled())continue;let X;this._blockedByActive(E,W,G)?Q.reset():Q[s||r.type]&&(X=Q[s||r.type](r,k,S),this.mergeHandlerResult(y,b,X,G,m),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||Q.isActive())&&(E[G]=Q)}const D={};for(const G in this._previousActiveHandlers)E[G]||(D[G]=m);this._previousActiveHandlers=E,(Object.keys(D).length||$o(y))&&(this._changes.push([y,b,D]),this._triggerRenderFrame()),(Object.keys(E).length||$o(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=y;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,s,h,m,y){if(!h)return;o.extend(r,h);const b={handlerName:m,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(s.zoom=b),h.panDelta!==void 0&&(s.drag=b),h.pitchDelta!==void 0&&(s.pitch=b),h.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const r={},s={},h={};for(const[m,y,b]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.aroundCoord!==void 0&&(r.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),o.extend(s,y),o.extend(h,b);this._updateMapTransform(r,s,h),this._changes=[]}_updateMapTransform(r,s,h){const m=this._map,y=m.transform,b=te=>[te.x,te.y,te.z];if((te=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!$o(r)){const te=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",te!==y.zoom&&this._map._update(!0)}if(!$o(r))return void this._fireEvents(s,h,!0);let{panDelta:E,zoomDelta:S,bearingDelta:k,pitchDelta:D,around:U,aroundCoord:G,pinchAround:Q}=r;Q!==void 0&&(U=Q),(te=>s.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=b(y.pointCoordinate3D(U)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),U=U||m.transform.centerPoint,k&&(y.bearing+=k),D&&(y.pitch+=D),y._updateCameraState();const W=[0,0,0];if(E)if(y.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U).dir),Y=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U.sub(E)).dir);W[0]=Y[0]-te[0],W[1]=Y[1]-te[1]}else{const te=y.pointCoordinate(U);if(y.projection.name==="globe"){E=E.rotate(-y.angle);const Y=y._pixelsPerMercatorPixel/y.worldSize;W[0]=-E.x*o.mercatorScale(o.latFromMercatorY(te.y))*Y,W[1]=-E.y*o.mercatorScale(y.center.lat)*Y}else{const Y=y.pointCoordinate(U.sub(E));te&&Y&&(W[0]=Y.x-te.x,W[1]=Y.y-te.y)}}const X=y.zoom,H=[0,0,0];if(S){const te=b(G||y.pointCoordinate3D(U)),Y={dir:o.normalize([],o.sub([],te,y._camera.position))};if(Y.dir[2]<0){const fe=y.zoomDeltaToMovement(te,S);o.scale$2(H,Y.dir,fe)}}const q=o.add(W,W,H);y._translateCameraConstrained(q),S&&Math.abs(y.zoom-X)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,h,!0)}_fireEvents(r,s,h){const m=Ma(this._eventsInProgress),y=Ma(r),b={};for(const D in r){const{originalEvent:U}=r[D];this._eventsInProgress[D]||(b[`${D}start`]=U),this._eventsInProgress[D]=r[D]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in b)this._fireEvent(D,b[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in r){const{originalEvent:U}=r[D];this._fireEvent(D,U)}const E={};let S;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],S=s[U]||G,E[`${D}end`]=S)}for(const D in E)this._fireEvent(D,E[D]);const k=Ma(this._eventsInProgress);if(h&&(m||y)&&!k){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:S})):(this._map.fire(new o.Event("moveend",{originalEvent:S})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.Event(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Ll("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const mu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hd extends o.Evented{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,h){return r=o.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},s),h)}panTo(r,s,h){return this.easeTo(o.extend({center:r},s),h)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,h){return this.easeTo(o.extend({zoom:r},s),h)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,h){return this.easeTo(o.extend({bearing:r},s),h)}resetNorth(r,s){return this.rotateTo(0,o.extend({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=o.LngLatBounds.convert(r);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),h,s)}_extendCameraOptions(r){const s={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const h=r.padding;r.padding={top:h,bottom:h,right:h,left:h}}return r.padding=o.extend(s,r.padding),r}_cameraForBoxAndBearing(r,s,h,m){const y=this._extendCameraOptions(m),b=this.transform,E=b.padding,S=b.project(o.LngLat.convert(r)),k=b.project(o.LngLat.convert(s)),D=new o.pointGeometry(S.x,k.y),U=new o.pointGeometry(k.x,S.y),G=-o.degToRad(h),Q=S.rotate(G),W=k.rotate(G),X=D.rotate(G),H=U.rotate(G),q=new o.pointGeometry(Math.max(Q.x,W.x,X.x,H.x),Math.max(Q.y,W.y,X.y,H.y)),te=new o.pointGeometry(Math.min(Q.x,W.x,X.x,H.x),Math.min(Q.y,W.y,X.y,H.y)),Y=q.sub(te),fe=(b.width-((E.left||0)+(E.right||0)+y.padding.left+y.padding.right))/Y.x,de=(b.height-((E.top||0)+(E.bottom||0)+y.padding.top+y.padding.bottom))/Y.y;if(de<0||fe<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(b.scaleZoom(b.scale*Math.min(fe,de)),y.maxZoom),pe=typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new o.pointGeometry(y.offset.x,y.offset.y):o.pointGeometry.convert(y.offset),he=new o.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(h*Math.PI/180),xe=pe.add(he).mult(b.scale/b.zoomScale(ae));return{center:b.unproject(S.add(k).div(2).sub(xe)),zoom:ae,bearing:h}}_cameraForBox(r,s,h,m,y){const b=this._extendCameraOptions(y);h=h||0,m=m||0,r=o.LngLat.convert(r),s=o.LngLat.convert(s);const E=this.transform.clone();E.padding=b.padding;const S=this.getFreeCameraOptions(),k=new o.LngLat(.5*(r.lng+s.lng),.5*(r.lat+s.lat)),D=.5*(h+m);if(E._camera.position[2]<o.mercatorZfromAltitude(D,k.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");S.lookAtPoint(k),E.setFreeCameraOptions(S);const U=o.MercatorCoordinate.fromLngLat(r),G=o.MercatorCoordinate.fromLngLat(s),Q=E.pointRayIntersection(E.centerPoint,D),W=[(X=E.rayIntersectionCoordinate(Q)).x,X.y,X.z];var X;const H=E.screenPointToMercatorRay(E.centerPoint),q=E.projection.name!=="globe";let te,Y=0;do{const fe=Math.floor(E.zoom),de=1<<fe,ae=Math.min(de*U.x,de*G.x),pe=Math.min(de*U.y,de*G.y),he=Math.max(de*U.x,de*G.x),xe=Math.max(de*U.y,de*G.y),Te=new o.Aabb([ae,pe,h],[he,xe,m]),Ye=o.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,fe,q);if(Te.intersects(Ye)!==2){te&&(E._camera.position=o.scaleAndAdd([],E._camera.position,H.dir,-te),E._updateStateFromCamera());break}const be=o.sub([],E._camera.position,W);te=.5*o.length(be),E._camera.position=o.scaleAndAdd([],E._camera.position,H.dir,te);try{E._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Y<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(r,s,h){return this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,s),s,h)}_raycastElevationBox(r,s){const h=this.transform.elevation;if(!h)return;const m=new o.pointGeometry(r.x,s.y),y=new o.pointGeometry(s.x,r.y),b=h.pointCoordinate(r);if(!b)return;const E=h.pointCoordinate(s);if(!E)return;const S=h.pointCoordinate(m);if(!S)return;const k=h.pointCoordinate(y);if(!k)return;const D=new o.MercatorCoordinate(b[0],b[1]).toLngLat(),U=new o.MercatorCoordinate(E[0],E[1]).toLngLat(),G=new o.MercatorCoordinate(S[0],S[1]).toLngLat(),Q=new o.MercatorCoordinate(k[0],k[1]).toLngLat(),W=Math.min(D.lng,Math.min(U.lng,Math.min(G.lng,Q.lng))),X=Math.min(D.lat,Math.min(U.lat,Math.min(G.lat,Q.lat))),H=Math.max(D.lng,Math.max(U.lng,Math.max(G.lng,Q.lng))),q=Math.max(D.lat,Math.max(U.lat,Math.max(G.lat,Q.lat))),te=Math.min(b[3],Math.min(E[3],Math.min(S[3],k[3]))),Y=Math.max(b[3],Math.max(E[3],Math.max(S[3],k[3])));return{minLngLat:new o.LngLat(W,X),maxLngLat:new o.LngLat(H,q),minAltitude:te,maxAltitude:Y}}fitScreenCoordinates(r,s,h,m,y){let b,E,S,k;this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const D=o.pointGeometry.convert(r),U=o.pointGeometry.convert(s),G=this._raycastElevationBox(D,U);if(G)b=G.minLngLat,E=G.maxLngLat,S=G.minAltitude,k=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(D,U))return this;b=this.transform.pointLocation(D),E=this.transform.pointLocation(U)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(r)),this.transform.pointLocation(o.pointGeometry.convert(s)),h,m):this._cameraForBox(b,E,S,k,m),m,y)}_fitInternal(r,s,h){return r?(delete(s=o.extend(r,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(r,s){this.stop();const h=r.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,b=!1;return"zoom"in r&&h.zoom!==+r.zoom&&(m=!0,h.zoom=+r.zoom),r.center!==void 0&&(h.center=o.LngLat.convert(r.center)),"bearing"in r&&h.bearing!==+r.bearing&&(y=!0,h.bearing=+r.bearing),"pitch"in r&&h.pitch!==+r.pitch&&(b=!0,h.pitch=+r.pitch),r.padding==null||h.isPaddingEqual(r.padding)||(h.padding=r.padding),r.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),m&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),y&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),b&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(mu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.warnOnce(mu),this;this.stop();const m=h.zoom,y=h.pitch,b=h.bearing;h.setFreeCameraOptions(r);const E=m!==h.zoom,S=y!==h.pitch,k=b!==h.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),E&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),k&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),S&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||!r.essential&&o.exported.prefersReducedMotion)&&(r.duration=0);const h=this.transform,m=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),S="zoom"in r?+r.zoom:m,k="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:b,U="padding"in r?r.padding:h.padding,G=o.pointGeometry.convert(r.offset);let Q,W,X;if(h.projection.name==="globe"){const xe=o.MercatorCoordinate.fromLngLat(h.center),Te=G.rotate(-h.angle);xe.x+=Te.x/h.worldSize,xe.y+=Te.y/h.worldSize;const Ye=xe.toLngLat(),be=o.LngLat.convert(r.center||Ye);this._normalizeCenter(be),Q=h.centerPoint.add(Te),W=new o.pointGeometry(xe.x,xe.y).mult(h.worldSize),X=new o.pointGeometry(o.mercatorXfromLng(be.lng),o.mercatorYfromLat(be.lat)).mult(h.worldSize).sub(W)}else{Q=h.centerPoint.add(G);const xe=h.pointLocation(Q),Te=o.LngLat.convert(r.center||xe);this._normalizeCenter(Te),W=h.project(xe),X=h.project(Te).sub(W)}const H=h.zoomScale(S-m);let q,te;r.around&&(q=o.LngLat.convert(r.around),te=h.locationPoint(q));const Y=this._zooming||S!==m,fe=this._rotating||y!==k,de=this._pitching||D!==b,ae=!h.isPaddingEqual(U),pe=xe=>Te=>{if(Y&&(xe.zoom=o.number(m,S,Te)),fe&&(xe.bearing=o.number(y,k,Te)),de&&(xe.pitch=o.number(b,D,Te)),ae&&(xe.interpolatePadding(E,U,Te),Q=xe.centerPoint.add(G)),q)xe.setLocationAtPoint(q,te);else{const Ye=xe.zoomScale(xe.zoom-m),be=S>m?Math.min(2,H):Math.max(.5,H),Be=Math.pow(be,1-Te),Fe=xe.unproject(W.add(X.mult(Te*Be)).mult(Ye));xe.setLocationAtPoint(xe.renderWorldCopies?Fe.wrap():Fe,Q)}return r.preloadOnly||this._fireMoveEvents(s),xe};if(r.preloadOnly){const xe=this._emulate(pe,r.duration,h);return this._preloadTiles(xe),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=fe,this._pitching=de,this._padding=ae,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,he),this._ease(pe(h),xe=>{h.recenterOnTerrain(),this._afterEase(s,xe)},r),this}_prepareEase(r,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!h.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!h.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!h.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.Event("zoomend",r)),m&&this.fire(new o.Event("rotateend",r)),y&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,s){if(!r.essential&&o.exported.prefersReducedMotion){const at=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,s)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const h=this.transform,m=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),S="zoom"in r?o.clamp(+r.zoom,h.minZoom,h.maxZoom):m,k="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:b,U="padding"in r?r.padding:h.padding,G=h.zoomScale(S-m),Q=o.pointGeometry.convert(r.offset);let W=h.centerPoint.add(Q);const X=h.pointLocation(W),H=o.LngLat.convert(r.center||X);this._normalizeCenter(H);const q=h.project(X),te=h.project(H).sub(q);let Y=r.curve;const fe=Math.max(h.width,h.height),de=fe/G,ae=te.mag();if("minZoom"in r){const at=o.clamp(Math.min(r.minZoom,m,S),h.minZoom,h.maxZoom),ot=fe/h.zoomScale(at-m);Y=Math.sqrt(ot/ae*2)}const pe=Y*Y;function he(at){const ot=(de*de-fe*fe+(at?-1:1)*pe*pe*ae*ae)/(2*(at?de:fe)*pe*ae);return Math.log(Math.sqrt(ot*ot+1)-ot)}function xe(at){return(Math.exp(at)-Math.exp(-at))/2}function Te(at){return(Math.exp(at)+Math.exp(-at))/2}const Ye=he(0);let be=function(at){return Te(Ye)/Te(Ye+Y*at)},Be=function(at){return fe*((Te(Ye)*(xe(ot=Ye+Y*at)/Te(ot))-xe(Ye))/pe)/ae;var ot},Fe=(he(1)-Ye)/Y;if(Math.abs(ae)<1e-6||!isFinite(Fe)){if(Math.abs(fe-de)<1e-6)return this.easeTo(r,s);const at=de<fe?-1:1;Fe=Math.abs(Math.log(de/fe))/Y,Be=function(){return 0},be=function(ot){return Math.exp(at*Y*ot)}}r.duration="duration"in r?+r.duration:1e3*Fe/("screenSpeed"in r?+r.screenSpeed/Y:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const it=y!==k,ze=D!==b,Ke=!h.isPaddingEqual(U),Oe=at=>ot=>{const bt=ot*Fe,Mt=1/be(bt);at.zoom=ot===1?S:m+at.scaleZoom(Mt),it&&(at.bearing=o.number(y,k,ot)),ze&&(at.pitch=o.number(b,D,ot)),Ke&&(at.interpolatePadding(E,U,ot),W=at.centerPoint.add(Q));const jt=ot===1?H:at.unproject(q.add(te.mult(Be(bt))).mult(Mt));return at.setLocationAtPoint(at.renderWorldCopies?jt.wrap():jt,W),at._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),at};if(r.preloadOnly){const at=this._emulate(Oe,r.duration,h);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=it,this._pitching=ze,this._padding=Ke,this._prepareEase(s,!1),this._ease(Oe(h),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!r){const h=this.handlers;h&&h.stop(!1)}return this}_ease(r,s,h){h.animate===!1||h.duration===0?(r(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=h,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.wrap(r,-180,180);const h=Math.abs(r-s);return Math.abs(r-360-s)<h&&(r-=360),Math.abs(r+360-s)<h&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const h=r.lng-s.center.lng;r.lng+=h>180?-360:h<-180?360:0}_emulate(r,s,h){const m=Math.ceil(15*s/1e3),y=[],b=r(h.clone());for(let E=0;E<=m;E++){const S=b(E/m);y.push(S.clone())}return y}}class _u{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact;return this._map=r,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=$("button","mapboxgl-ctrl-attrib-button",this._container),$("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,s){const h=this._map._getUIString(`AttributionControl.${s}`);r.setAttribute("aria-label",h),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const h=s.reduce((m,y,b)=>(y.value&&(m+=`${y.key}=${y.value}${b<s.length-1?"&":""}`),m),"?");r.href=`${o.config.FEEDBACK_URL}/${h}#${uu(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const y=s[m];if(y.used){const b=y.getSource();b.attribution&&r.indexOf(b.attribution)<0&&r.push(b.attribution)}}r.sort((m,y)=>m.length-y.length),r=r.filter((m,y)=>{for(let b=y+1;b<r.length;b++)if(r[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const h=r.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,r.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class gu{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=$("div","mapboxgl-ctrl");const s=$("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const h=r[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class yu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===r)return void(m.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function xu(c,r,s){if(c=new o.LngLat(c.lng,c.lat),r){const h=new o.LngLat(c.lng-360,c.lat),m=new o.LngLat(c.lng+360,c.lat),y=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),b=s.locationPoint(c).distSqr(r),E=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint(h).distSqr(r)<b&&(E||Math.abs(h.lng-s.center.lng)<y)?c=h:s.locationPoint(m).distSqr(r)<b&&(E||Math.abs(m.lng-s.center.lng)<y)&&(c=m)}for(;Math.abs(c.lng-s.center.lng)>180;){const h=s.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const za={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Rl extends o.Evented{constructor(r,s){if(super(),(r instanceof o.window.HTMLElement||s)&&(r=o.extend({element:r},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=o.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=$("div");const m=41,y=27,b=ne("svg",{display:"block",height:m*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${m}`},this._element),E=ne("radialGradient",{id:"shadowGradient"},ne("defs",{},b));ne("stop",{offset:"10%","stop-opacity":.4},E),ne("stop",{offset:"100%","stop-opacity":.05},E),ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=o.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in za)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,h=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const s=r.unproject(this._pos),h=r.getFreeCameraOptions();if(!h.position)return!1;const m=h.position.toLngLat();return m.distanceTo(s)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const h=r.unproject(s);let m;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?m=0:(m=1-r._queryFogOpacity(h),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(m*=.2)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${za[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const r=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!r||h!=="map")return"";if(!s._showingGlobe()){const S=s.getPitch();return S?`rotateX(${S}deg)`:""}const m=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),y=r.sub(o.globeCenterToScreenPoint(s.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const E=m/b;return`rotateX(${-y.y*E}deg) rotateY(${y.x*E}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const y=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),b=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);h=o.radToDeg(Math.atan2(b.y,b.x))-90}else h=-s.getBearing();else if(m==="horizon"){const y=o.smoothstep(4,6,s.getZoom()),b=o.globeCenterToScreenPoint(s.transform);b.y+=y*s.transform.height;const E=r.sub(b),S=o.radToDeg(Math.atan2(E.y,E.x));h=(S>90?S-270:S+90)*(1-y)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=xu(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.pointGeometry.convert(r),this._update(),this}_onMove(r){const s=this._map;if(s){if(!this._isDragging){const h=this._clickTolerance||s._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map;s&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class dd{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,h){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+h}}const pd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ka(c){c.parentNode&&c.parentNode.removeChild(c)}const md={showCompass:!0,showZoom:!0,visualizePitch:!1};class vu{constructor(r,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new du({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,h&&(this.mousePitch=new Tr({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),Ge()}move(r,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(r,s),y=m&&m.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(r,s),E=b&&b.pitchDelta;E&&h.setPitch(h.getPitch()+E)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ze(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),He(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,He(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=yt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=yt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _d={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Au={maxWidth:100,unit:"metric"};function bu(c,r,s){const h=Ol(r),m=h/r,y={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=c*m+"px",this._container.innerHTML=`${h}&nbsp;${y}`})}function Ol(c){const r=Math.pow(10,`${Math.floor(c)}`.length-1);let s=c/r;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(h){const m=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*m)/m}(s),r*s}const df={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fl(c=new o.pointGeometry(0,0),r="bottom"){if(typeof c=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(r){case"top":return new o.pointGeometry(0,c);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-c);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(c,0);case"right":return new o.pointGeometry(-c,0)}return new o.pointGeometry(0,0)}return c instanceof o.pointGeometry||Array.isArray(c)?o.pointGeometry.convert(c):o.pointGeometry.convert(c[r]||[0,0])}const Pa={version:o.version,supported:V,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends hd{constructor(c){if((c=o.extend({},fd,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(c.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ea(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=c.language==="auto"?o.window.navigator.language:c.language,this._worldview=c.worldview,this._renderTaskQueue=new yu,this._domRenderTaskQueue=new yu,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},pd,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dd(0),this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=o.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ud(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new qh(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new _u({customAttribution:c.customAttribution})),this._logoControl=new gu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(c,r){if(r===void 0&&(r=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const h=this._controlPositions[r];return r.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(c);return r>-1&&this._controls.splice(r,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),this.fire(new o.Event("resize",c)),r&&this.fire(new o.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getLanguage(){return this._language}setLanguage(c){if(this._language=c==="auto"?o.window.navigator.language:c,this.style)for(const r in this.style._sourceCaches){const s=this.style._sourceCaches[r]._source;s._setLanguage&&s._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){if(this._worldview=c,this.style)for(const r in this.style._sourceCaches){const s=this.style._sourceCaches[r]._source;s._setWorldview&&s._setWorldview(c)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,r=c.projection.name;let s;r==="globe"&&c.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),s=!0):r==="mercator"&&c.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,r){return this._updateProjection(c||r||{name:"mercator"})}_updateProjection(c){let r;if(r=c.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0)}return this}project(c){return this.transform.locationPoint3D(o.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(o.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,r,s){if(c==="mouseenter"||c==="mouseover"){let h=!1;const m=b=>{const E=r.filter(k=>this.getLayer(k)),S=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];S.length?h||(h=!0,s.call(this,new Pr(c,this,b.originalEvent,{features:S}))):h=!1},y=()=>{h=!1};return{layers:new Set(r),listener:s,delegates:{mousemove:m,mouseout:y}}}if(c==="mouseleave"||c==="mouseout"){let h=!1;const m=b=>{const E=r.filter(S=>this.getLayer(S));(E.length?this.queryRenderedFeatures(b.point,{layers:E}):[]).length?h=!0:h&&(h=!1,s.call(this,new Pr(c,this,b.originalEvent)))},y=b=>{h&&(h=!1,s.call(this,new Pr(c,this,b.originalEvent)))};return{layers:new Set(r),listener:s,delegates:{mousemove:m,mouseout:y}}}{const h=m=>{const y=r.filter(E=>this.getLayer(E)),b=y.length?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length&&(m.features=b,s.call(this,m),delete m.features)};return{layers:new Set(r),listener:s,delegates:{[c]:h}}}}on(c,r,s){if(s===void 0)return super.on(c,r);Array.isArray(r)||(r=[r]);const h=this._createDelegatedListener(c,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(c,r,s){if(s===void 0)return super.once(c,r);Array.isArray(r)||(r=[r]);const h=this._createDelegatedListener(c,r,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(c,r,s){if(s===void 0)return super.off(c,r);r=new Set(Array.isArray(r)?r:[r]);const h=(y,b)=>{if(y.size!==b.size)return!1;for(const E of y)if(!b.has(E))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[c]:void 0;return m&&(y=>{for(let b=0;b<y.length;b++){const E=y[b];if(E.listener===s&&h(E.layers,r)){for(const S in E.delegates)this.off(S,E.delegates[S]);return y.splice(b,1),this}}})(m),this}queryRenderedFeatures(c,r){return this.style?(r!==void 0||c===void 0||c instanceof o.pointGeometry||Array.isArray(c)||(r=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(c,r){return this.style.querySourceFeatures(c,r)}queryTerrainElevation(c,r){const s=this.transform.elevation;return s?(r=o.extend({},{exaggerated:!0},r),s.getAtPoint(o.MercatorCoordinate.fromLngLat(c),null,r.exaggerated)):null}setStyle(c,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(c,r))}_getUIString(c){const r=this._locale[c];if(r==null)throw new Error(`Missing UI string '${c}'`);return r}_updateStyle(c,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new pn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,r){if(typeof c=="string"){const s=this._requestManager.normalizeStyleURL(c),h=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(h,(m,y)=>{m?this.fire(new o.ErrorEvent(m)):y&&this._updateDiff(y,r)})}else typeof c=="object"&&this._updateDiff(c,r)}_updateDiff(c,r){try{this.style.setState(c)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(c,r){return this._lazyInitEmptyStyle(),this.style.addSource(c,r),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const r in c){const s=c[r]._tiles;for(const h in s){const m=s[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(c,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,r,s)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,r,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:E,height:S,data:k}=o.exported.getImageData(r);this.style.addImage(c,{data:new o.RGBAImage({width:E,height:S},k),pixelRatio:s,stretchX:m,stretchY:y,content:b,sdf:h,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:S}=r,k=r;this.style.addImage(c,{data:new o.RGBAImage({width:E,height:S},new Uint8Array(k.data)),pixelRatio:s,stretchX:m,stretchY:y,content:b,sdf:h,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}updateImage(c,r){const s=this.style.getImage(c);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:m,height:y}=h;m!==void 0&&y!==void 0?m===s.data.width&&y===s.data.height?(s.data.replace(h.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(c,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${m}, ${y})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,r){o.getImage(this._requestManager.transformRequest(c,o.ResourceType.Image),(s,h)=>{r(s,h instanceof o.window.HTMLImageElement?o.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(c,r){return this._lazyInitEmptyStyle(),this.style.addLayer(c,r),this._update(!0)}moveLayer(c,r){return this.style.moveLayer(c,r),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,r,s){return this.style.setLayerZoomRange(c,r,s),this._update(!0)}setFilter(c,r,s={}){return this.style.setFilter(c,r,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,r,s,h={}){return this.style.setPaintProperty(c,r,s,h),this._update(!0)}getPaintProperty(c,r){return this.style.getPaintProperty(c,r)}setLayoutProperty(c,r,s,h={}){return this.style.setLayoutProperty(c,r,s,h),this._update(!0)}getLayoutProperty(c,r){return this.style.getLayoutProperty(c,r)}setLight(c,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(c),this.transform):0}setFeatureState(c,r){return this.style.setFeatureState(c,r),this._update()}removeFeatureState(c,r){return this.style.removeFeatureState(c,r),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,h,m,y=this._container;for(;y&&(!h||!m);){const b=o.window.getComputedStyle(y).transform;b&&b!=="none"&&(s=b.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),y=y.parentElement}this._containerWidth=h?Math.abs(c/h):c,this._containerHeight=m?Math.abs(r/m):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=$("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=$("div","mapboxgl-canvas-container",c);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=$("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=$("div","mapboxgl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=$("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,r){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${r}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const r=this._markers.indexOf(c);r!==-1&&this._markers.splice(r,1)}_setupPainter(){const c=o.extend({},V.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);r?(o.storeAuthState(r,!0),this.painter=new ou(r,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(r)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let r;const s=this.painter.context.extTimerQuery,h=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let m=!1;const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,k=this.transform.pitch,D=o.exported.now();this.style.zoomHistory.update(S,D);const U=new o.EvaluationParameters(S,{now:D,fadeDuration:y,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=U.crossFadingFactor();G===1&&G===this._crossFadingFactor||(m=!0,this._crossFadingFactor=G),this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerUpdate()):b=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const S=o.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,r),setTimeout(()=>{const k=s.getQueryObjectEXT(r,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:S,gpuTime:k})),o.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(S);this.fire(new o.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(S);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(E||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(b=this._updateAverageElevation(h,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,r=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((r||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const b=Math.abs(h-m);if(b>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,c,300)}else if(b>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===o.AUTH_ERR_MSG||c.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof gu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(y){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,y,0);const b=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,b),b}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(c),r.canvasCopies.map(m),r.timeStamps)}_canvasPixelComparison(c,r,s){let h=s[1]-s[0];const m=c.length/4;for(let y=0;y<r.length;y++){const b=r[y];let E=0;for(let S=0;S<b.length;S+=4)b[S]===c[S]&&b[S+1]===c[S+1]&&b[S+2]===c[S+2]&&b[S+3]===c[S+3]&&(E+=1);h+=(s[y+2]-s[y+1])*(1-E/m)}return h}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),ka(this._canvasContainer),ka(this._controlContainer),ka(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(c){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(s,h)=>s._preloadTiles(c,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,r){o.setCacheLimits(c,r)}get version(){return o.version}},NavigationControl:class{constructor(c){this.options=o.extend({},md,c),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),$("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),$("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=$("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const r=c.getZoom(),s=r===c.getMaxZoom(),h=r===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vu(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,r){const s=$("button",c,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(c,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(c){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},_d,c),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ta(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){this._supportsGeolocation!==void 0?c(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation=r.state!=="denied",c(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,c(this._supportsGeolocation))}_isOutOfMapMaxBounds(c){const r=this._map.getMaxBounds(),s=c.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",c)),this._finish()}}_updateCamera(c){const r=new o.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,h=this._map.getBearing(),m=o.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),m,{geolocateSource:!0})}_updateMarker(c){if(c){const r=new o.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,r=o.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=$("button","mapboxgl-ctrl-geolocate",this._container),$("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$("div","mapboxgl-user-location"),this._dotElement.appendChild($("div","mapboxgl-user-location-dot")),this._dotElement.appendChild($("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Rl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=$("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_u,ScaleControl:class{constructor(c){this.options=o.extend({},Au,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=bu.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,h=r._containerWidth/2-c/2,m=r.unproject([h,s]),y=r.unproject([h+c,s]),b=m.distanceTo(y);if(this.options.unit==="imperial"){const E=3.2808*b;E>5280?this._setScale(c,E/5280,"mile"):this._setScale(c,E,"foot")}else this.options.unit==="nautical"?this._setScale(c,b/1852,"nautical-mile"):b>=1e3?this._setScale(c,b/1e3,"kilometer"):this._setScale(c,b,"meter")}_setScale(c,r,s){const h=Ol(r),m=h/r;this._map._requestDomTask(()=>{this._container.style.width=c*m+"px",this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(h):`${h}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof o.window.HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=$("button","mapboxgl-ctrl-fullscreen",this._controlContainer);$("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(c){super(),this.options=o.extend(Object.create(df),c),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(o.window.document.createTextNode(c))}setHTML(c){const r=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let h;for(s.innerHTML=c;h=s.firstChild,h;)r.appendChild(h);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=$("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(c),this.options.closeButton){const s=this._closeButton=$("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let r;return this._classList.delete(c)?r=!1:(this._classList.add(c),r=!0),this._updateClassList(),r}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,h=this._pos;if(!r||!s||!h)return"bottom";const m=s.offsetWidth,y=s.offsetHeight,b=h.x<m/2,E=h.x>r.transform.width-m/2;if(h.y+c<y)return b?"top-left":E?"top-right":"top";if(h.y>r.transform.height-y){if(b)return"bottom-left";if(E)return"bottom-right"}return b?"left":E?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),c.className=r.join(" ")}_update(c){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=$("div","mapboxgl-popup",r.getContainer()),this._tip=$("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xu(this._lngLat,this._pos,r.transform)),!this._trackPointer||c){const m=this._pos=this._trackPointer&&c?c:r.project(this._lngLat),y=Fl(this.options.offset),b=this._anchor=this._getAnchor(y.y),E=Fl(this.options.offset,b),S=m.add(E).round();r._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${za[b]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&r._showingGlobe()){const m=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(pf);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Rl,Style:pn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:pt,Evented:o.Evented,config:o.config,prewarm:function(){Ii().acquire(It)},clearPrewarmedResources:function(){const c=Jt;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(It),Jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(c){o.config.ACCESS_TOKEN=c},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(c){o.config.API_URL=c},get workerCount(){return Ut.workerCount},set workerCount(c){Ut.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Pa});var z=w;return z})})(UA);var UM=UA.exports;function VM(a,d){return en(),un("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[Wi("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])}var Q_={exports:{}},jA=function(d,g){return function(){for(var w=new Array(arguments.length),I=0;I<w.length;I++)w[I]=arguments[I];return d.apply(g,w)}},fI=jA,ia=Object.prototype.toString;function Y_(a){return Array.isArray(a)}function f_(a){return typeof a=="undefined"}function mI(a){return a!==null&&!f_(a)&&a.constructor!==null&&!f_(a.constructor)&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function NA(a){return ia.call(a)==="[object ArrayBuffer]"}function _I(a){return ia.call(a)==="[object FormData]"}function gI(a){var d;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?d=ArrayBuffer.isView(a):d=a&&a.buffer&&NA(a.buffer),d}function yI(a){return typeof a=="string"}function xI(a){return typeof a=="number"}function $A(a){return a!==null&&typeof a=="object"}function yp(a){if(ia.call(a)!=="[object Object]")return!1;var d=Object.getPrototypeOf(a);return d===null||d===Object.prototype}function vI(a){return ia.call(a)==="[object Date]"}function AI(a){return ia.call(a)==="[object File]"}function bI(a){return ia.call(a)==="[object Blob]"}function GA(a){return ia.call(a)==="[object Function]"}function wI(a){return $A(a)&&GA(a.pipe)}function EI(a){return ia.call(a)==="[object URLSearchParams]"}function TI(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function SI(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function J_(a,d){if(!(a===null||typeof a=="undefined"))if(typeof a!="object"&&(a=[a]),Y_(a))for(var g=0,A=a.length;g<A;g++)d.call(null,a[g],g,a);else for(var w in a)Object.prototype.hasOwnProperty.call(a,w)&&d.call(null,a[w],w,a)}function m_(){var a={};function d(w,I){yp(a[I])&&yp(w)?a[I]=m_(a[I],w):yp(w)?a[I]=m_({},w):Y_(w)?a[I]=w.slice():a[I]=w}for(var g=0,A=arguments.length;g<A;g++)J_(arguments[g],d);return a}function II(a,d,g){return J_(d,function(w,I){g&&typeof w=="function"?a[I]=fI(w,g):a[I]=w}),a}function CI(a){return a.charCodeAt(0)===65279&&(a=a.slice(1)),a}var En={isArray:Y_,isArrayBuffer:NA,isBuffer:mI,isFormData:_I,isArrayBufferView:gI,isString:yI,isNumber:xI,isObject:$A,isPlainObject:yp,isUndefined:f_,isDate:vI,isFile:AI,isBlob:bI,isFunction:GA,isStream:wI,isURLSearchParams:EI,isStandardBrowserEnv:SI,forEach:J_,merge:m_,extend:II,trim:TI,stripBOM:CI},ac=En;function Uv(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var ZA=function(d,g,A){if(!g)return d;var w;if(A)w=A(g);else if(ac.isURLSearchParams(g))w=g.toString();else{var I=[];ac.forEach(g,function(P,V){P===null||typeof P=="undefined"||(ac.isArray(P)?V=V+"[]":P=[P],ac.forEach(P,function(R){ac.isDate(R)?R=R.toISOString():ac.isObject(R)&&(R=JSON.stringify(R)),I.push(Uv(V)+"="+Uv(R))}))}),w=I.join("&")}if(w){var z=d.indexOf("#");z!==-1&&(d=d.slice(0,z)),d+=(d.indexOf("?")===-1?"?":"&")+w}return d},MI=En;function $p(){this.handlers=[]}$p.prototype.use=function(d,g,A){return this.handlers.push({fulfilled:d,rejected:g,synchronous:A?A.synchronous:!1,runWhen:A?A.runWhen:null}),this.handlers.length-1};$p.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)};$p.prototype.forEach=function(d){MI.forEach(this.handlers,function(A){A!==null&&d(A)})};var zI=$p,kI=En,PI=function(d,g){kI.forEach(d,function(w,I){I!==g&&I.toUpperCase()===g.toUpperCase()&&(d[g]=w,delete d[I])})},qA=function(d,g,A,w,I){return d.config=g,A&&(d.code=A),d.request=w,d.response=I,d.isAxiosError=!0,d.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},d},WA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},DI=qA,XA=function(d,g,A,w,I){var z=new Error(d);return DI(z,g,A,w,I)},BI=XA,LI=function(d,g,A){var w=A.config.validateStatus;!A.status||!w||w(A.status)?d(A):g(BI("Request failed with status code "+A.status,A.config,null,A.request,A))},dp=En,RI=dp.isStandardBrowserEnv()?function(){return{write:function(g,A,w,I,z,o){var P=[];P.push(g+"="+encodeURIComponent(A)),dp.isNumber(w)&&P.push("expires="+new Date(w).toGMTString()),dp.isString(I)&&P.push("path="+I),dp.isString(z)&&P.push("domain="+z),o===!0&&P.push("secure"),document.cookie=P.join("; ")},read:function(g){var A=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return A?decodeURIComponent(A[3]):null},remove:function(g){this.write(g,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),OI=function(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)},FI=function(d,g){return g?d.replace(/\/+$/,"")+"/"+g.replace(/^\/+/,""):d},UI=OI,VI=FI,jI=function(d,g){return d&&!UI(g)?VI(d,g):g},Bm=En,NI=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],$I=function(d){var g={},A,w,I;return d&&Bm.forEach(d.split(`
`),function(o){if(I=o.indexOf(":"),A=Bm.trim(o.substr(0,I)).toLowerCase(),w=Bm.trim(o.substr(I+1)),A){if(g[A]&&NI.indexOf(A)>=0)return;A==="set-cookie"?g[A]=(g[A]?g[A]:[]).concat([w]):g[A]=g[A]?g[A]+", "+w:w}}),g},Vv=En,GI=Vv.isStandardBrowserEnv()?function(){var d=/(msie|trident)/i.test(navigator.userAgent),g=document.createElement("a"),A;function w(I){var z=I;return d&&(g.setAttribute("href",z),z=g.href),g.setAttribute("href",z),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:g.pathname.charAt(0)==="/"?g.pathname:"/"+g.pathname}}return A=w(window.location.href),function(z){var o=Vv.isString(z)?w(z):z;return o.protocol===A.protocol&&o.host===A.host}}():function(){return function(){return!0}}();function K_(a){this.message=a}K_.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};K_.prototype.__CANCEL__=!0;var Gp=K_,pp=En,ZI=LI,qI=RI,WI=ZA,XI=jI,HI=$I,QI=GI,Lm=XA,YI=WA,JI=Gp,jv=function(d){return new Promise(function(A,w){var I=d.data,z=d.headers,o=d.responseType,P;function V(){d.cancelToken&&d.cancelToken.unsubscribe(P),d.signal&&d.signal.removeEventListener("abort",P)}pp.isFormData(I)&&delete z["Content-Type"];var F=new XMLHttpRequest;if(d.auth){var R=d.auth.username||"",$=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";z.Authorization="Basic "+btoa(R+":"+$)}var ne=XI(d.baseURL,d.url);F.open(d.method.toUpperCase(),WI(ne,d.params,d.paramsSerializer),!0),F.timeout=d.timeout;function oe(){if(!!F){var Ie="getAllResponseHeaders"in F?HI(F.getAllResponseHeaders()):null,Ge=!o||o==="text"||o==="json"?F.responseText:F.response,Ze={data:Ge,status:F.status,statusText:F.statusText,headers:Ie,config:d,request:F};ZI(function(ft){A(ft),V()},function(ft){w(ft),V()},Ze),F=null}}if("onloadend"in F?F.onloadend=oe:F.onreadystatechange=function(){!F||F.readyState!==4||F.status===0&&!(F.responseURL&&F.responseURL.indexOf("file:")===0)||setTimeout(oe)},F.onabort=function(){!F||(w(Lm("Request aborted",d,"ECONNABORTED",F)),F=null)},F.onerror=function(){w(Lm("Network Error",d,null,F)),F=null},F.ontimeout=function(){var Ge=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",Ze=d.transitional||YI;d.timeoutErrorMessage&&(Ge=d.timeoutErrorMessage),w(Lm(Ge,d,Ze.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",F)),F=null},pp.isStandardBrowserEnv()){var ve=(d.withCredentials||QI(ne))&&d.xsrfCookieName?qI.read(d.xsrfCookieName):void 0;ve&&(z[d.xsrfHeaderName]=ve)}"setRequestHeader"in F&&pp.forEach(z,function(Ge,Ze){typeof I=="undefined"&&Ze.toLowerCase()==="content-type"?delete z[Ze]:F.setRequestHeader(Ze,Ge)}),pp.isUndefined(d.withCredentials)||(F.withCredentials=!!d.withCredentials),o&&o!=="json"&&(F.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&F.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&F.upload&&F.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(P=function(Ie){!F||(w(!Ie||Ie&&Ie.type?new JI("canceled"):Ie),F.abort(),F=null)},d.cancelToken&&d.cancelToken.subscribe(P),d.signal&&(d.signal.aborted?P():d.signal.addEventListener("abort",P))),I||(I=null),F.send(I)})},Gr=En,Nv=PI,KI=qA,eC=WA,tC={"Content-Type":"application/x-www-form-urlencoded"};function $v(a,d){!Gr.isUndefined(a)&&Gr.isUndefined(a["Content-Type"])&&(a["Content-Type"]=d)}function iC(){var a;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(a=jv),a}function rC(a,d,g){if(Gr.isString(a))try{return(d||JSON.parse)(a),Gr.trim(a)}catch(A){if(A.name!=="SyntaxError")throw A}return(g||JSON.stringify)(a)}var Zp={transitional:eC,adapter:iC(),transformRequest:[function(d,g){return Nv(g,"Accept"),Nv(g,"Content-Type"),Gr.isFormData(d)||Gr.isArrayBuffer(d)||Gr.isBuffer(d)||Gr.isStream(d)||Gr.isFile(d)||Gr.isBlob(d)?d:Gr.isArrayBufferView(d)?d.buffer:Gr.isURLSearchParams(d)?($v(g,"application/x-www-form-urlencoded;charset=utf-8"),d.toString()):Gr.isObject(d)||g&&g["Content-Type"]==="application/json"?($v(g,"application/json"),rC(d)):d}],transformResponse:[function(d){var g=this.transitional||Zp.transitional,A=g&&g.silentJSONParsing,w=g&&g.forcedJSONParsing,I=!A&&this.responseType==="json";if(I||w&&Gr.isString(d)&&d.length)try{return JSON.parse(d)}catch(z){if(I)throw z.name==="SyntaxError"?KI(z,this,"E_JSON_PARSE"):z}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Gr.forEach(["delete","get","head"],function(d){Zp.headers[d]={}});Gr.forEach(["post","put","patch"],function(d){Zp.headers[d]=Gr.merge(tC)});var eg=Zp,nC=En,oC=eg,sC=function(d,g,A){var w=this||oC;return nC.forEach(A,function(z){d=z.call(w,d,g)}),d},HA=function(d){return!!(d&&d.__CANCEL__)},Gv=En,Rm=sC,aC=HA,lC=eg,cC=Gp;function Om(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new cC("canceled")}var uC=function(d){Om(d),d.headers=d.headers||{},d.data=Rm.call(d,d.data,d.headers,d.transformRequest),d.headers=Gv.merge(d.headers.common||{},d.headers[d.method]||{},d.headers),Gv.forEach(["delete","get","head","post","put","patch","common"],function(w){delete d.headers[w]});var g=d.adapter||lC.adapter;return g(d).then(function(w){return Om(d),w.data=Rm.call(d,w.data,w.headers,d.transformResponse),w},function(w){return aC(w)||(Om(d),w&&w.response&&(w.response.data=Rm.call(d,w.response.data,w.response.headers,d.transformResponse))),Promise.reject(w)})},Pn=En,QA=function(d,g){g=g||{};var A={};function w(F,R){return Pn.isPlainObject(F)&&Pn.isPlainObject(R)?Pn.merge(F,R):Pn.isPlainObject(R)?Pn.merge({},R):Pn.isArray(R)?R.slice():R}function I(F){if(Pn.isUndefined(g[F])){if(!Pn.isUndefined(d[F]))return w(void 0,d[F])}else return w(d[F],g[F])}function z(F){if(!Pn.isUndefined(g[F]))return w(void 0,g[F])}function o(F){if(Pn.isUndefined(g[F])){if(!Pn.isUndefined(d[F]))return w(void 0,d[F])}else return w(void 0,g[F])}function P(F){if(F in g)return w(d[F],g[F]);if(F in d)return w(void 0,d[F])}var V={url:z,method:z,data:z,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:P};return Pn.forEach(Object.keys(d).concat(Object.keys(g)),function(R){var $=V[R]||I,ne=$(R);Pn.isUndefined(ne)&&$!==P||(A[R]=ne)}),A},YA={version:"0.26.1"},hC=YA.version,tg={};["object","boolean","number","function","string","symbol"].forEach(function(a,d){tg[a]=function(A){return typeof A===a||"a"+(d<1?"n ":" ")+a}});var Zv={};tg.transitional=function(d,g,A){function w(I,z){return"[Axios v"+hC+"] Transitional option '"+I+"'"+z+(A?". "+A:"")}return function(I,z,o){if(d===!1)throw new Error(w(z," has been removed"+(g?" in "+g:"")));return g&&!Zv[z]&&(Zv[z]=!0,console.warn(w(z," has been deprecated since v"+g+" and will be removed in the near future"))),d?d(I,z,o):!0}};function dC(a,d,g){if(typeof a!="object")throw new TypeError("options must be an object");for(var A=Object.keys(a),w=A.length;w-- >0;){var I=A[w],z=d[I];if(z){var o=a[I],P=o===void 0||z(o,I,a);if(P!==!0)throw new TypeError("option "+I+" must be "+P);continue}if(g!==!0)throw Error("Unknown option "+I)}}var pC={assertOptions:dC,validators:tg},JA=En,fC=ZA,qv=zI,Wv=uC,qp=QA,KA=pC,lc=KA.validators;function Ih(a){this.defaults=a,this.interceptors={request:new qv,response:new qv}}Ih.prototype.request=function(d,g){typeof d=="string"?(g=g||{},g.url=d):g=d||{},g=qp(this.defaults,g),g.method?g.method=g.method.toLowerCase():this.defaults.method?g.method=this.defaults.method.toLowerCase():g.method="get";var A=g.transitional;A!==void 0&&KA.assertOptions(A,{silentJSONParsing:lc.transitional(lc.boolean),forcedJSONParsing:lc.transitional(lc.boolean),clarifyTimeoutError:lc.transitional(lc.boolean)},!1);var w=[],I=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(g)===!1||(I=I&&ne.synchronous,w.unshift(ne.fulfilled,ne.rejected))});var z=[];this.interceptors.response.forEach(function(ne){z.push(ne.fulfilled,ne.rejected)});var o;if(!I){var P=[Wv,void 0];for(Array.prototype.unshift.apply(P,w),P=P.concat(z),o=Promise.resolve(g);P.length;)o=o.then(P.shift(),P.shift());return o}for(var V=g;w.length;){var F=w.shift(),R=w.shift();try{V=F(V)}catch($){R($);break}}try{o=Wv(V)}catch($){return Promise.reject($)}for(;z.length;)o=o.then(z.shift(),z.shift());return o};Ih.prototype.getUri=function(d){return d=qp(this.defaults,d),fC(d.url,d.params,d.paramsSerializer).replace(/^\?/,"")};JA.forEach(["delete","get","head","options"],function(d){Ih.prototype[d]=function(g,A){return this.request(qp(A||{},{method:d,url:g,data:(A||{}).data}))}});JA.forEach(["post","put","patch"],function(d){Ih.prototype[d]=function(g,A,w){return this.request(qp(w||{},{method:d,url:g,data:A}))}});var mC=Ih,_C=Gp;function vc(a){if(typeof a!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise(function(w){d=w});var g=this;this.promise.then(function(A){if(!!g._listeners){var w,I=g._listeners.length;for(w=0;w<I;w++)g._listeners[w](A);g._listeners=null}}),this.promise.then=function(A){var w,I=new Promise(function(z){g.subscribe(z),w=z}).then(A);return I.cancel=function(){g.unsubscribe(w)},I},a(function(w){g.reason||(g.reason=new _C(w),d(g.reason))})}vc.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};vc.prototype.subscribe=function(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]};vc.prototype.unsubscribe=function(d){if(!!this._listeners){var g=this._listeners.indexOf(d);g!==-1&&this._listeners.splice(g,1)}};vc.source=function(){var d,g=new vc(function(w){d=w});return{token:g,cancel:d}};var gC=vc,yC=function(d){return function(A){return d.apply(null,A)}},xC=En,vC=function(d){return xC.isObject(d)&&d.isAxiosError===!0},Xv=En,AC=jA,xp=mC,bC=QA,wC=eg;function e1(a){var d=new xp(a),g=AC(xp.prototype.request,d);return Xv.extend(g,xp.prototype,d),Xv.extend(g,d),g.create=function(w){return e1(bC(a,w))},g}var Uo=e1(wC);Uo.Axios=xp;Uo.Cancel=Gp;Uo.CancelToken=gC;Uo.isCancel=HA;Uo.VERSION=YA.version;Uo.all=function(d){return Promise.all(d)};Uo.spread=yC;Uo.isAxiosError=vC;Q_.exports=Uo;Q_.exports.default=Uo;var jM=Q_.exports;function Hv(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Object.keys(a).reduce((g,A)=>(d.includes(A)||(g[A]=hi(a[A])),g),{})}function Mp(a){return typeof a=="function"}function EC(a){return as(a)||_c(a)}function t1(a,d,g,A){return a.call(A,hi(d),hi(g),A)}function i1(a){return a.$valid!==void 0?!a.$valid:!a}function TC(a,d,g,A,w,I,z){let{$lazy:o,$rewardEarly:P}=w,V=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[],F=arguments.length>8?arguments[8]:void 0,R=arguments.length>9?arguments[9]:void 0,$=arguments.length>10?arguments[10]:void 0;const ne=$t(!!A.value),oe=$t(0);g.value=!1;const ve=An([d,A].concat(V,$),()=>{if(o&&!A.value||P&&!R.value&&!g.value)return;let Ie;try{Ie=t1(a,d,F,z)}catch(Ge){Ie=Promise.reject(Ge)}oe.value++,g.value=!!oe.value,ne.value=!1,Promise.resolve(Ie).then(Ge=>{oe.value--,g.value=!!oe.value,I.value=Ge,ne.value=i1(Ge)}).catch(Ge=>{oe.value--,g.value=!!oe.value,I.value=Ge,ne.value=!0})},{immediate:!0,deep:typeof d=="object"});return{$invalid:ne,$unwatch:ve}}function SC(a,d,g,A,w,I,z,o){let{$lazy:P,$rewardEarly:V}=A;const F=()=>({}),R=Dt(()=>{if(P&&!g.value||V&&!o.value)return!1;let $=!0;try{const ne=t1(a,d,z,I);w.value=ne,$=i1(ne)}catch(ne){w.value=ne}return $});return{$unwatch:F,$invalid:R}}function IC(a,d,g,A,w,I,z,o,P,V,F){const R=$t(!1),$=a.$params||{},ne=$t(null);let oe,ve;a.$async?{$invalid:oe,$unwatch:ve}=TC(a.$validator,d,R,g,A,ne,w,a.$watchTargets,P,V,F):{$invalid:oe,$unwatch:ve}=SC(a.$validator,d,g,A,ne,w,P,V);const Ie=a.$message;return{$message:Mp(Ie)?Dt(()=>Ie(Hv({$pending:R,$invalid:oe,$params:Hv($),$model:d,$response:ne,$validator:I,$propertyPath:o,$property:z}))):Ie||"",$params:$,$pending:R,$invalid:oe,$response:ne,$unwatch:ve}}function CC(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const d=hi(a),g=Object.keys(d),A={},w={},I={};return g.forEach(z=>{const o=d[z];switch(!0){case Mp(o.$validator):A[z]=o;break;case Mp(o):A[z]={$validator:o};break;case z.startsWith("$"):I[z]=o;break;default:w[z]=o}}),{rules:A,nestedValidators:w,config:I}}function MC(){}const zC="__root";function r1(a,d,g){if(g)return d?d(a()):a();try{var A=Promise.resolve(a());return d?A.then(d):A}catch(w){return Promise.reject(w)}}function kC(a,d){return r1(a,MC,d)}function PC(a,d){var g=a();return g&&g.then?g.then(d):d(g)}function DC(a){return function(){for(var d=[],g=0;g<arguments.length;g++)d[g]=arguments[g];try{return Promise.resolve(a.apply(this,d))}catch(A){return Promise.reject(A)}}}function BC(a,d,g,A,w,I,z,o,P){const V=Object.keys(a),F=A.get(w,a),R=$t(!1),$=$t(!1),ne=$t(0);if(F){if(!F.$partial)return F;F.$unwatch(),R.value=F.$dirty.value}const oe={$dirty:R,$path:w,$touch:()=>{R.value||(R.value=!0)},$reset:()=>{R.value&&(R.value=!1)},$commit:()=>{}};return V.length?(V.forEach(ve=>{oe[ve]=IC(a[ve],d,oe.$dirty,I,z,ve,g,w,P,$,ne)}),oe.$externalResults=Dt(()=>o.value?[].concat(o.value).map((ve,Ie)=>({$propertyPath:w,$property:g,$validator:"$externalResults",$uid:`${w}-externalResult-${Ie}`,$message:ve,$params:{},$response:null,$pending:!1})):[]),oe.$invalid=Dt(()=>{const ve=V.some(Ie=>hi(oe[Ie].$invalid));return $.value=ve,!!oe.$externalResults.value.length||ve}),oe.$pending=Dt(()=>V.some(ve=>hi(oe[ve].$pending))),oe.$error=Dt(()=>oe.$dirty.value?oe.$pending.value||oe.$invalid.value:!1),oe.$silentErrors=Dt(()=>V.filter(ve=>hi(oe[ve].$invalid)).map(ve=>{const Ie=oe[ve];return Fo({$propertyPath:w,$property:g,$validator:ve,$uid:`${w}-${ve}`,$message:Ie.$message,$params:Ie.$params,$response:Ie.$response,$pending:Ie.$pending})}).concat(oe.$externalResults.value)),oe.$errors=Dt(()=>oe.$dirty.value?oe.$silentErrors.value:[]),oe.$unwatch=()=>V.forEach(ve=>{oe[ve].$unwatch()}),oe.$commit=()=>{$.value=!0,ne.value=Date.now()},A.set(w,a,oe),oe):(F&&A.set(w,a,oe),oe)}function LC(a,d,g,A,w,I,z){const o=Object.keys(a);return o.length?o.reduce((P,V)=>(P[V]=__({validations:a[V],state:d,key:V,parentKey:g,resultsCache:A,globalConfig:w,instance:I,externalResults:z}),P),{}):{}}function RC(a,d,g){const A=Dt(()=>[d,g].filter(oe=>oe).reduce((oe,ve)=>oe.concat(Object.values(hi(ve))),[])),w=Dt({get(){return a.$dirty.value||(A.value.length?A.value.every(oe=>oe.$dirty):!1)},set(oe){a.$dirty.value=oe}}),I=Dt(()=>{const oe=hi(a.$silentErrors)||[],ve=A.value.filter(Ie=>(hi(Ie).$silentErrors||[]).length).reduce((Ie,Ge)=>Ie.concat(...Ge.$silentErrors),[]);return oe.concat(ve)}),z=Dt(()=>{const oe=hi(a.$errors)||[],ve=A.value.filter(Ie=>(hi(Ie).$errors||[]).length).reduce((Ie,Ge)=>Ie.concat(...Ge.$errors),[]);return oe.concat(ve)}),o=Dt(()=>A.value.some(oe=>oe.$invalid)||hi(a.$invalid)||!1),P=Dt(()=>A.value.some(oe=>hi(oe.$pending))||hi(a.$pending)||!1),V=Dt(()=>A.value.some(oe=>oe.$dirty)||A.value.some(oe=>oe.$anyDirty)||w.value),F=Dt(()=>w.value?P.value||o.value:!1),R=()=>{a.$touch(),A.value.forEach(oe=>{oe.$touch()})},$=()=>{a.$commit(),A.value.forEach(oe=>{oe.$commit()})},ne=()=>{a.$reset(),A.value.forEach(oe=>{oe.$reset()})};return A.value.length&&A.value.every(oe=>oe.$dirty)&&R(),{$dirty:w,$errors:z,$invalid:o,$anyDirty:V,$error:F,$pending:P,$touch:R,$reset:ne,$silentErrors:I,$commit:$}}function __(a){const d=DC(function(){return Ft(),PC(function(){if(ve.$rewardEarly)return ri(),kC(Ln)},function(){return r1(Ln,function(){return new Promise(Bt=>{if(!gt.value)return Bt(!We.value);const $i=An(gt,()=>{Bt(!We.value),$i()})})})})});let{validations:g,state:A,key:w,parentKey:I,childResults:z,resultsCache:o,globalConfig:P={},instance:V,externalResults:F}=a;const R=I?`${I}.${w}`:w,{rules:$,nestedValidators:ne,config:oe}=CC(g),ve=Object.assign({},P,oe),Ie=w?Dt(()=>{const Bt=hi(A);return Bt?hi(Bt[w]):void 0}):A,Ge=Object.assign({},hi(F)||{}),Ze=Dt(()=>{const Bt=hi(F);return w?Bt?hi(Bt[w]):void 0:Bt}),st=BC($,Ie,w,o,R,ve,V,Ze,A),ft=LC(ne,Ie,R,o,ve,V,Ze),{$dirty:He,$errors:yt,$invalid:We,$anyDirty:xt,$error:Et,$pending:gt,$touch:Ft,$reset:At,$silentErrors:ei,$commit:ri}=RC(st,ft,z),Er=w?Dt({get:()=>hi(Ie),set:Bt=>{He.value=!0;const $i=hi(A),lr=hi(F);lr&&(lr[w]=Ge[w]),ar($i[w])?$i[w].value=Bt:$i[w]=Bt}}):null;w&&ve.$autoDirty&&An(Ie,()=>{He.value||Ft();const Bt=hi(F);Bt&&(Bt[w]=Ge[w])},{flush:"sync"});function vi(Bt){return(z.value||{})[Bt]}function fi(){ar(F)?F.value=Ge:Object.keys(Ge).length===0?Object.keys(F).forEach(Bt=>{delete F[Bt]}):Object.assign(F,Ge)}return Fo(Object.assign({},st,{$model:Er,$dirty:He,$error:Et,$errors:yt,$invalid:We,$anyDirty:xt,$pending:gt,$touch:Ft,$reset:At,$path:R||zC,$silentErrors:ei,$validate:d,$commit:ri},z&&{$getResultsForChild:vi,$clearExternalResults:fi},ft))}class OC{constructor(){this.storage=new Map}set(d,g,A){this.storage.set(d,{rules:g,result:A})}checkRulesValidity(d,g,A){const w=Object.keys(A),I=Object.keys(g);return I.length!==w.length||!I.every(o=>w.includes(o))?!1:I.every(o=>g[o].$params?Object.keys(g[o].$params).every(P=>hi(A[o].$params[P])===hi(g[o].$params[P])):!0)}get(d,g){const A=this.storage.get(d);if(!A)return;const{rules:w,result:I}=A,z=this.checkRulesValidity(d,g,w),o=I.$unwatch?I.$unwatch:()=>({});return z?I:{$dirty:I.$dirty,$partial:!0,$unwatch:o}}}const vp={COLLECT_ALL:!0,COLLECT_NONE:!1},Qv=Symbol("vuelidate#injectChildResults"),Yv=Symbol("vuelidate#removeChildResults");function FC(a){let{$scope:d,instance:g}=a;const A={},w=$t([]),I=Dt(()=>w.value.reduce((F,R)=>(F[R]=hi(A[R]),F),{}));function z(F,R){let{$registerAs:$,$scope:ne,$stopPropagation:oe}=R;oe||d===vp.COLLECT_NONE||ne===vp.COLLECT_NONE||d!==vp.COLLECT_ALL&&d!==ne||(A[$]=F,w.value.push($))}g.__vuelidateInjectInstances=[].concat(g.__vuelidateInjectInstances||[],z);function o(F){w.value=w.value.filter(R=>R!==F),delete A[F]}g.__vuelidateRemoveInstances=[].concat(g.__vuelidateRemoveInstances||[],o);const P=ir(Qv,[]);Ar(Qv,g.__vuelidateInjectInstances);const V=ir(Yv,[]);return Ar(Yv,g.__vuelidateRemoveInstances),{childResults:I,sendValidationResultsToParent:P,removeValidationResultsFromParent:V}}function n1(a){return new Proxy(a,{get(d,g){return typeof d[g]=="object"?n1(d[g]):Dt(()=>d[g])}})}function NM(a,d){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};arguments.length===1&&(g=a,a=void 0,d=void 0);let{$registerAs:A,$scope:w=vp.COLLECT_ALL,$stopPropagation:I,$externalResults:z,currentVueInstance:o}=g;const P=o||Eh(),V=P?P.type:{};!A&&P&&(A=`_vuelidate_${P.uid||P._uid}`);const F=$t({}),R=new OC,{childResults:$,sendValidationResultsToParent:ne,removeValidationResultsFromParent:oe}=P?FC({$scope:w,instance:P}):{childResults:$t({})};if(!a&&V.validations){const ve=V.validations;d=$t({}),R0(()=>{d.value=P.proxy,An(()=>Mp(ve)?ve.call(d.value,new n1(d.value)):ve,Ie=>{F.value=__({validations:Ie,state:d,childResults:$,resultsCache:R,globalConfig:g,instance:P.proxy,externalResults:z||P.proxy.vuelidateExternalResults})},{immediate:!0})}),g=V.validationsConfig||g}else{const ve=ar(a)||EC(a)?a:Fo(a||{});An(ve,Ie=>{F.value=__({validations:Ie,state:d,childResults:$,resultsCache:R,globalConfig:g,instance:P?P.proxy:{},externalResults:z})},{immediate:!0})}return P&&(ne.forEach(ve=>ve(F,{$registerAs:A,$scope:w,$stopPropagation:I})),F_(()=>oe.forEach(ve=>ve(A)))),Dt(()=>Object.assign({},hi(F.value),$.value))}const ig=a=>{if(a=hi(a),Array.isArray(a))return!!a.length;if(a==null)return!1;if(a===!1)return!0;if(a instanceof Date)return!isNaN(a.getTime());if(typeof a=="object"){for(let d in a)return!0;return!1}return!!String(a).length},UC=a=>(a=hi(a),Array.isArray(a)?a.length:typeof a=="object"?Object.keys(a).length:String(a).length);function tl(){for(var a=arguments.length,d=new Array(a),g=0;g<a;g++)d[g]=arguments[g];return A=>(A=hi(A),!ig(A)||d.every(w=>w.test(A)))}tl(/^[a-zA-Z]*$/);tl(/^[a-zA-Z0-9]*$/);var VC=tl(/^\d*(\.\d+)?$/),$M={$validator:VC,$message:"Value must be numeric",$params:{type:"numeric"}};const jC=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;var NC=tl(jC),GM={$validator:NC,$message:"Value is not a valid email address",$params:{type:"email"}};function $C(a){return d=>!ig(d)||UC(d)>=hi(a)}function ZM(a){return{$validator:$C(a),$message:d=>{let{$params:g}=d;return`This field should be at least ${g.min} long`},$params:{min:a,type:"minLength"}}}function GC(a){return typeof a=="string"&&(a=a.trim()),ig(a)}var qM={$validator:GC,$message:"Value is required",$params:{type:"required"}};function ZC(a){return d=>hi(d)===hi(a)}function WM(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"other";return{$validator:ZC(a),$message:g=>`The value must be equal to the ${d} value`,$params:{equalTo:a,otherName:d,type:"sameAs"}}}const qC=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i;tl(qC);tl(/(^[0-9]*$)|(^-[0-9]+$)/);tl(/^[-]?\d*(\.\d+)?$/);export{WM as $,lM as A,UM as B,CM as C,XC as D,FM as E,ao as F,tM as G,QC as H,rM as I,y_ as J,zM as K,DM as L,oM as M,IM as N,Fo as O,Dt as P,NM as Q,JS as R,PM as S,eA as T,OM as U,VM as V,qM as W,GM as X,jM as Y,$M as Z,ZM as _,hi as a,KC as a0,gM as a1,yM as a2,_M as a3,mM as a4,uM as a5,SM as a6,cM as a7,MM as a8,YC as a9,RM as aa,kM as ab,LM as ac,iM as ad,HC as ae,vM as af,xM as ag,nM as ah,bM as ai,Q0 as b,un as c,wM as d,Wi as e,eM as f,hM as g,EM as h,Kr as i,JC as j,ar as k,HT as l,dM as m,x_ as n,en as o,pM as p,sM as q,$t as r,TM as s,BM as t,AM as u,fM as v,k2 as w,aM as x,YT as y,wE as z};
