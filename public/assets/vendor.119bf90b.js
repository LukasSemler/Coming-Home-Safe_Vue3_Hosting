var oy=Object.defineProperty,sy=Object.defineProperties;var ay=Object.getOwnPropertyDescriptors;var Mh=Object.getOwnPropertySymbols;var km=Object.prototype.hasOwnProperty,Rm=Object.prototype.propertyIsEnumerable;var Pm=(V,ee,ce)=>ee in V?oy(V,ee,{enumerable:!0,configurable:!0,writable:!0,value:ce}):V[ee]=ce,vr=(V,ee)=>{for(var ce in ee||(ee={}))km.call(ee,ce)&&Pm(V,ce,ee[ce]);if(Mh)for(var ce of Mh(ee))Rm.call(ee,ce)&&Pm(V,ce,ee[ce]);return V},Xi=(V,ee)=>sy(V,ay(ee));var Vo=(V,ee)=>{var ce={};for(var _e in V)km.call(V,_e)&&ee.indexOf(_e)<0&&(ce[_e]=V[_e]);if(V!=null&&Mh)for(var _e of Mh(V))ee.indexOf(_e)<0&&Rm.call(V,_e)&&(ce[_e]=V[_e]);return ce};function makeMap(V,ee){const ce=Object.create(null),_e=V.split(",");for(let de=0;de<_e.length;de++)ce[_e[de]]=!0;return ee?de=>!!ce[de.toLowerCase()]:de=>!!ce[de]}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(V){return!!V||V===""}function normalizeStyle(V){if(isArray$1(V)){const ee={};for(let ce=0;ce<V.length;ce++){const _e=V[ce],de=isString$1(_e)?parseStringStyle(_e):normalizeStyle(_e);if(de)for(const xe in de)ee[xe]=de[xe]}return ee}else{if(isString$1(V))return V;if(isObject$1(V))return V}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:(.+)/;function parseStringStyle(V){const ee={};return V.split(listDelimiterRE).forEach(ce=>{if(ce){const _e=ce.split(propertyDelimiterRE);_e.length>1&&(ee[_e[0].trim()]=_e[1].trim())}}),ee}function normalizeClass(V){let ee="";if(isString$1(V))ee=V;else if(isArray$1(V))for(let ce=0;ce<V.length;ce++){const _e=normalizeClass(V[ce]);_e&&(ee+=_e+" ")}else if(isObject$1(V))for(const ce in V)V[ce]&&(ee+=ce+" ");return ee.trim()}const toDisplayString=V=>isString$1(V)?V:V==null?"":isArray$1(V)||isObject$1(V)&&(V.toString===objectToString||!isFunction$2(V.toString))?JSON.stringify(V,replacer,2):String(V),replacer=(V,ee)=>ee&&ee.__v_isRef?replacer(V,ee.value):isMap(ee)?{[`Map(${ee.size})`]:[...ee.entries()].reduce((ce,[_e,de])=>(ce[`${_e} =>`]=de,ce),{})}:isSet(ee)?{[`Set(${ee.size})`]:[...ee.values()]}:isObject$1(ee)&&!isArray$1(ee)&&!isPlainObject$2(ee)?String(ee):ee,EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=V=>onRE.test(V),isModelListener=V=>V.startsWith("onUpdate:"),extend$1=Object.assign,remove=(V,ee)=>{const ce=V.indexOf(ee);ce>-1&&V.splice(ce,1)},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(V,ee)=>hasOwnProperty.call(V,ee),isArray$1=Array.isArray,isMap=V=>toTypeString(V)==="[object Map]",isSet=V=>toTypeString(V)==="[object Set]",isFunction$2=V=>typeof V=="function",isString$1=V=>typeof V=="string",isSymbol=V=>typeof V=="symbol",isObject$1=V=>V!==null&&typeof V=="object",isPromise=V=>isObject$1(V)&&isFunction$2(V.then)&&isFunction$2(V.catch),objectToString=Object.prototype.toString,toTypeString=V=>objectToString.call(V),toRawType=V=>toTypeString(V).slice(8,-1),isPlainObject$2=V=>toTypeString(V)==="[object Object]",isIntegerKey=V=>isString$1(V)&&V!=="NaN"&&V[0]!=="-"&&""+parseInt(V,10)===V,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=V=>{const ee=Object.create(null);return ce=>ee[ce]||(ee[ce]=V(ce))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(V=>V.replace(camelizeRE,(ee,ce)=>ce?ce.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(V=>V.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(V=>V.charAt(0).toUpperCase()+V.slice(1)),toHandlerKey=cacheStringFunction(V=>V?`on${capitalize(V)}`:""),hasChanged=(V,ee)=>!Object.is(V,ee),invokeArrayFns=(V,ee)=>{for(let ce=0;ce<V.length;ce++)V[ce](ee)},def=(V,ee,ce)=>{Object.defineProperty(V,ee,{configurable:!0,enumerable:!1,value:ce})},toNumber=V=>{const ee=parseFloat(V);return isNaN(ee)?V:ee};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let activeEffectScope;class EffectScope{constructor(ee=!1){this.active=!0,this.effects=[],this.cleanups=[],!ee&&activeEffectScope&&(this.parent=activeEffectScope,this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}run(ee){if(this.active)try{return activeEffectScope=this,ee()}finally{activeEffectScope=this.parent}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(ee){if(this.active){let ce,_e;for(ce=0,_e=this.effects.length;ce<_e;ce++)this.effects[ce].stop();for(ce=0,_e=this.cleanups.length;ce<_e;ce++)this.cleanups[ce]();if(this.scopes)for(ce=0,_e=this.scopes.length;ce<_e;ce++)this.scopes[ce].stop(!0);if(this.parent&&!ee){const de=this.parent.scopes.pop();de&&de!==this&&(this.parent.scopes[this.index]=de,de.index=this.index)}this.active=!1}}}function effectScope(V){return new EffectScope(V)}function recordEffectScope(V,ee=activeEffectScope){ee&&ee.active&&ee.effects.push(V)}const createDep=V=>{const ee=new Set(V);return ee.w=0,ee.n=0,ee},wasTracked=V=>(V.w&trackOpBit)>0,newTracked=V=>(V.n&trackOpBit)>0,initDepMarkers=({deps:V})=>{if(V.length)for(let ee=0;ee<V.length;ee++)V[ee].w|=trackOpBit},finalizeDepMarkers=V=>{const{deps:ee}=V;if(ee.length){let ce=0;for(let _e=0;_e<ee.length;_e++){const de=ee[_e];wasTracked(de)&&!newTracked(de)?de.delete(V):ee[ce++]=de,de.w&=~trackOpBit,de.n&=~trackOpBit}ee.length=ce}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(ee,ce=null,_e){this.fn=ee,this.scheduler=ce,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,_e)}run(){if(!this.active)return this.fn();let ee=activeEffect,ce=shouldTrack;for(;ee;){if(ee===this)return;ee=ee.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=ce,this.parent=void 0}}stop(){this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(V){const{deps:ee}=V;if(ee.length){for(let ce=0;ce<ee.length;ce++)ee[ce].delete(V);ee.length=0}}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const V=trackStack.pop();shouldTrack=V===void 0?!0:V}function track(V,ee,ce){if(shouldTrack&&activeEffect){let _e=targetMap.get(V);_e||targetMap.set(V,_e=new Map);let de=_e.get(ce);de||_e.set(ce,de=createDep()),trackEffects(de)}}function trackEffects(V,ee){let ce=!1;effectTrackDepth<=maxMarkerBits?newTracked(V)||(V.n|=trackOpBit,ce=!wasTracked(V)):ce=!V.has(activeEffect),ce&&(V.add(activeEffect),activeEffect.deps.push(V))}function trigger$1(V,ee,ce,_e,de,xe){const Te=targetMap.get(V);if(!Te)return;let j=[];if(ee==="clear")j=[...Te.values()];else if(ce==="length"&&isArray$1(V))Te.forEach((Ce,Pe)=>{(Pe==="length"||Pe>=_e)&&j.push(Ce)});else switch(ce!==void 0&&j.push(Te.get(ce)),ee){case"add":isArray$1(V)?isIntegerKey(ce)&&j.push(Te.get("length")):(j.push(Te.get(ITERATE_KEY)),isMap(V)&&j.push(Te.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray$1(V)||(j.push(Te.get(ITERATE_KEY)),isMap(V)&&j.push(Te.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(V)&&j.push(Te.get(ITERATE_KEY));break}if(j.length===1)j[0]&&triggerEffects(j[0]);else{const Ce=[];for(const Pe of j)Pe&&Ce.push(...Pe);triggerEffects(createDep(Ce))}}function triggerEffects(V,ee){for(const ce of isArray$1(V)?V:[...V])(ce!==activeEffect||ce.allowRecurse)&&(ce.scheduler?ce.scheduler():ce.run())}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).map(V=>Symbol[V]).filter(isSymbol)),get=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const V={};return["includes","indexOf","lastIndexOf"].forEach(ee=>{V[ee]=function(...ce){const _e=toRaw(this);for(let xe=0,Te=this.length;xe<Te;xe++)track(_e,"get",xe+"");const de=_e[ee](...ce);return de===-1||de===!1?_e[ee](...ce.map(toRaw)):de}}),["push","pop","shift","unshift","splice"].forEach(ee=>{V[ee]=function(...ce){pauseTracking();const _e=toRaw(this)[ee].apply(this,ce);return resetTracking(),_e}}),V}function createGetter(V=!1,ee=!1){return function(_e,de,xe){if(de==="__v_isReactive")return!V;if(de==="__v_isReadonly")return V;if(de==="__v_isShallow")return ee;if(de==="__v_raw"&&xe===(V?ee?shallowReadonlyMap:readonlyMap:ee?shallowReactiveMap:reactiveMap).get(_e))return _e;const Te=isArray$1(_e);if(!V&&Te&&hasOwn(arrayInstrumentations,de))return Reflect.get(arrayInstrumentations,de,xe);const j=Reflect.get(_e,de,xe);return(isSymbol(de)?builtInSymbols.has(de):isNonTrackableKeys(de))||(V||track(_e,"get",de),ee)?j:isRef(j)?!Te||!isIntegerKey(de)?j.value:j:isObject$1(j)?V?readonly(j):reactive(j):j}}const set=createSetter(),shallowSet=createSetter(!0);function createSetter(V=!1){return function(ce,_e,de,xe){let Te=ce[_e];if(isReadonly(Te)&&isRef(Te)&&!isRef(de))return!1;if(!V&&!isReadonly(de)&&(isShallow(de)||(de=toRaw(de),Te=toRaw(Te)),!isArray$1(ce)&&isRef(Te)&&!isRef(de)))return Te.value=de,!0;const j=isArray$1(ce)&&isIntegerKey(_e)?Number(_e)<ce.length:hasOwn(ce,_e),Ce=Reflect.set(ce,_e,de,xe);return ce===toRaw(xe)&&(j?hasChanged(de,Te)&&trigger$1(ce,"set",_e,de):trigger$1(ce,"add",_e,de)),Ce}}function deleteProperty(V,ee){const ce=hasOwn(V,ee);V[ee];const _e=Reflect.deleteProperty(V,ee);return _e&&ce&&trigger$1(V,"delete",ee,void 0),_e}function has(V,ee){const ce=Reflect.has(V,ee);return(!isSymbol(ee)||!builtInSymbols.has(ee))&&track(V,"has",ee),ce}function ownKeys$1(V){return track(V,"iterate",isArray$1(V)?"length":ITERATE_KEY),Reflect.ownKeys(V)}const mutableHandlers={get,set,deleteProperty,has,ownKeys:ownKeys$1},readonlyHandlers={get:readonlyGet,set(V,ee){return!0},deleteProperty(V,ee){return!0}},shallowReactiveHandlers=extend$1({},mutableHandlers,{get:shallowGet,set:shallowSet}),toShallow=V=>V,getProto=V=>Reflect.getPrototypeOf(V);function get$1(V,ee,ce=!1,_e=!1){V=V.__v_raw;const de=toRaw(V),xe=toRaw(ee);ee!==xe&&!ce&&track(de,"get",ee),!ce&&track(de,"get",xe);const{has:Te}=getProto(de),j=_e?toShallow:ce?toReadonly:toReactive;if(Te.call(de,ee))return j(V.get(ee));if(Te.call(de,xe))return j(V.get(xe));V!==de&&V.get(ee)}function has$1(V,ee=!1){const ce=this.__v_raw,_e=toRaw(ce),de=toRaw(V);return V!==de&&!ee&&track(_e,"has",V),!ee&&track(_e,"has",de),V===de?ce.has(V):ce.has(V)||ce.has(de)}function size(V,ee=!1){return V=V.__v_raw,!ee&&track(toRaw(V),"iterate",ITERATE_KEY),Reflect.get(V,"size",V)}function add(V){V=toRaw(V);const ee=toRaw(this);return getProto(ee).has.call(ee,V)||(ee.add(V),trigger$1(ee,"add",V,V)),this}function set$1(V,ee){ee=toRaw(ee);const ce=toRaw(this),{has:_e,get:de}=getProto(ce);let xe=_e.call(ce,V);xe||(V=toRaw(V),xe=_e.call(ce,V));const Te=de.call(ce,V);return ce.set(V,ee),xe?hasChanged(ee,Te)&&trigger$1(ce,"set",V,ee):trigger$1(ce,"add",V,ee),this}function deleteEntry(V){const ee=toRaw(this),{has:ce,get:_e}=getProto(ee);let de=ce.call(ee,V);de||(V=toRaw(V),de=ce.call(ee,V)),_e&&_e.call(ee,V);const xe=ee.delete(V);return de&&trigger$1(ee,"delete",V,void 0),xe}function clear(){const V=toRaw(this),ee=V.size!==0,ce=V.clear();return ee&&trigger$1(V,"clear",void 0,void 0),ce}function createForEach(V,ee){return function(_e,de){const xe=this,Te=xe.__v_raw,j=toRaw(Te),Ce=ee?toShallow:V?toReadonly:toReactive;return!V&&track(j,"iterate",ITERATE_KEY),Te.forEach((Pe,Le)=>_e.call(de,Ce(Pe),Ce(Le),xe))}}function createIterableMethod(V,ee,ce){return function(..._e){const de=this.__v_raw,xe=toRaw(de),Te=isMap(xe),j=V==="entries"||V===Symbol.iterator&&Te,Ce=V==="keys"&&Te,Pe=de[V](..._e),Le=ce?toShallow:ee?toReadonly:toReactive;return!ee&&track(xe,"iterate",Ce?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:ze,done:Be}=Pe.next();return Be?{value:ze,done:Be}:{value:j?[Le(ze[0]),Le(ze[1])]:Le(ze),done:Be}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(V){return function(...ee){return V==="delete"?!1:this}}function createInstrumentations(){const V={get(xe){return get$1(this,xe)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},ee={get(xe){return get$1(this,xe,!1,!0)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},ce={get(xe){return get$1(this,xe,!0)},get size(){return size(this,!0)},has(xe){return has$1.call(this,xe,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},_e={get(xe){return get$1(this,xe,!0,!0)},get size(){return size(this,!0)},has(xe){return has$1.call(this,xe,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(xe=>{V[xe]=createIterableMethod(xe,!1,!1),ce[xe]=createIterableMethod(xe,!0,!1),ee[xe]=createIterableMethod(xe,!1,!0),_e[xe]=createIterableMethod(xe,!0,!0)}),[V,ce,ee,_e]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(V,ee){const ce=ee?V?shallowReadonlyInstrumentations:shallowInstrumentations:V?readonlyInstrumentations:mutableInstrumentations;return(_e,de,xe)=>de==="__v_isReactive"?!V:de==="__v_isReadonly"?V:de==="__v_raw"?_e:Reflect.get(hasOwn(ce,de)&&de in _e?ce:_e,de,xe)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(V){switch(V){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(V){return V.__v_skip||!Object.isExtensible(V)?0:targetTypeMap(toRawType(V))}function reactive(V){return isReadonly(V)?V:createReactiveObject(V,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(V){return createReactiveObject(V,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(V){return createReactiveObject(V,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function createReactiveObject(V,ee,ce,_e,de){if(!isObject$1(V)||V.__v_raw&&!(ee&&V.__v_isReactive))return V;const xe=de.get(V);if(xe)return xe;const Te=getTargetType(V);if(Te===0)return V;const j=new Proxy(V,Te===2?_e:ce);return de.set(V,j),j}function isReactive(V){return isReadonly(V)?isReactive(V.__v_raw):!!(V&&V.__v_isReactive)}function isReadonly(V){return!!(V&&V.__v_isReadonly)}function isShallow(V){return!!(V&&V.__v_isShallow)}function isProxy$1(V){return isReactive(V)||isReadonly(V)}function toRaw(V){const ee=V&&V.__v_raw;return ee?toRaw(ee):V}function markRaw(V){return def(V,"__v_skip",!0),V}const toReactive=V=>isObject$1(V)?reactive(V):V,toReadonly=V=>isObject$1(V)?readonly(V):V;function trackRefValue(V){shouldTrack&&activeEffect&&(V=toRaw(V),trackEffects(V.dep||(V.dep=createDep())))}function triggerRefValue(V,ee){V=toRaw(V),V.dep&&triggerEffects(V.dep)}function isRef(V){return!!(V&&V.__v_isRef===!0)}function ref(V){return createRef(V,!1)}function shallowRef(V){return createRef(V,!0)}function createRef(V,ee){return isRef(V)?V:new RefImpl(V,ee)}class RefImpl{constructor(ee,ce){this.__v_isShallow=ce,this.dep=void 0,this.__v_isRef=!0,this._rawValue=ce?ee:toRaw(ee),this._value=ce?ee:toReactive(ee)}get value(){return trackRefValue(this),this._value}set value(ee){ee=this.__v_isShallow?ee:toRaw(ee),hasChanged(ee,this._rawValue)&&(this._rawValue=ee,this._value=this.__v_isShallow?ee:toReactive(ee),triggerRefValue(this))}}function unref(V){return isRef(V)?V.value:V}const shallowUnwrapHandlers={get:(V,ee,ce)=>unref(Reflect.get(V,ee,ce)),set:(V,ee,ce,_e)=>{const de=V[ee];return isRef(de)&&!isRef(ce)?(de.value=ce,!0):Reflect.set(V,ee,ce,_e)}};function proxyRefs(V){return isReactive(V)?V:new Proxy(V,shallowUnwrapHandlers)}function toRefs(V){const ee=isArray$1(V)?new Array(V.length):{};for(const ce in V)ee[ce]=toRef(V,ce);return ee}class ObjectRefImpl{constructor(ee,ce,_e){this._object=ee,this._key=ce,this._defaultValue=_e,this.__v_isRef=!0}get value(){const ee=this._object[this._key];return ee===void 0?this._defaultValue:ee}set value(ee){this._object[this._key]=ee}}function toRef(V,ee,ce){const _e=V[ee];return isRef(_e)?_e:new ObjectRefImpl(V,ee,ce)}class ComputedRefImpl{constructor(ee,ce,_e,de){this._setter=ce,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new ReactiveEffect(ee,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!de,this.__v_isReadonly=_e}get value(){const ee=toRaw(this);return trackRefValue(ee),(ee._dirty||!ee._cacheable)&&(ee._dirty=!1,ee._value=ee.effect.run()),ee._value}set value(ee){this._setter(ee)}}function computed$1(V,ee,ce=!1){let _e,de;const xe=isFunction$2(V);return xe?(_e=V,de=NOOP):(_e=V.get,de=V.set),new ComputedRefImpl(_e,de,xe||!de,ce)}Promise.resolve();function callWithErrorHandling(V,ee,ce,_e){let de;try{de=_e?V(..._e):V()}catch(xe){handleError(xe,ee,ce)}return de}function callWithAsyncErrorHandling(V,ee,ce,_e){if(isFunction$2(V)){const xe=callWithErrorHandling(V,ee,ce,_e);return xe&&isPromise(xe)&&xe.catch(Te=>{handleError(Te,ee,ce)}),xe}const de=[];for(let xe=0;xe<V.length;xe++)de.push(callWithAsyncErrorHandling(V[xe],ee,ce,_e));return de}function handleError(V,ee,ce,_e=!0){const de=ee?ee.vnode:null;if(ee){let xe=ee.parent;const Te=ee.proxy,j=ce;for(;xe;){const Pe=xe.ec;if(Pe){for(let Le=0;Le<Pe.length;Le++)if(Pe[Le](V,Te,j)===!1)return}xe=xe.parent}const Ce=ee.appContext.config.errorHandler;if(Ce){callWithErrorHandling(Ce,null,10,[V,Te,j]);return}}logError(V,ce,de,_e)}function logError(V,ee,ce,_e=!0){console.error(V)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPreFlushCbs=[];let activePreFlushCbs=null,preFlushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null,currentPreFlushParentJob=null;function nextTick(V){const ee=currentFlushPromise||resolvedPromise;return V?ee.then(this?V.bind(this):V):ee}function findInsertionIndex(V){let ee=flushIndex+1,ce=queue.length;for(;ee<ce;){const _e=ee+ce>>>1;getId(queue[_e])<V?ee=_e+1:ce=_e}return ee}function queueJob(V){(!queue.length||!queue.includes(V,isFlushing&&V.allowRecurse?flushIndex+1:flushIndex))&&V!==currentPreFlushParentJob&&(V.id==null?queue.push(V):queue.splice(findInsertionIndex(V.id),0,V),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(V){const ee=queue.indexOf(V);ee>flushIndex&&queue.splice(ee,1)}function queueCb(V,ee,ce,_e){isArray$1(V)?ce.push(...V):(!ee||!ee.includes(V,V.allowRecurse?_e+1:_e))&&ce.push(V),queueFlush()}function queuePreFlushCb(V){queueCb(V,activePreFlushCbs,pendingPreFlushCbs,preFlushIndex)}function queuePostFlushCb(V){queueCb(V,activePostFlushCbs,pendingPostFlushCbs,postFlushIndex)}function flushPreFlushCbs(V,ee=null){if(pendingPreFlushCbs.length){for(currentPreFlushParentJob=ee,activePreFlushCbs=[...new Set(pendingPreFlushCbs)],pendingPreFlushCbs.length=0,preFlushIndex=0;preFlushIndex<activePreFlushCbs.length;preFlushIndex++)activePreFlushCbs[preFlushIndex]();activePreFlushCbs=null,preFlushIndex=0,currentPreFlushParentJob=null,flushPreFlushCbs(V,ee)}}function flushPostFlushCbs(V){if(pendingPostFlushCbs.length){const ee=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...ee);return}for(activePostFlushCbs=ee,activePostFlushCbs.sort((ce,_e)=>getId(ce)-getId(_e)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=V=>V.id==null?1/0:V.id;function flushJobs(V){isFlushPending=!1,isFlushing=!0,flushPreFlushCbs(V),queue.sort((ce,_e)=>getId(ce)-getId(_e));const ee=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const ce=queue[flushIndex];ce&&ce.active!==!1&&callWithErrorHandling(ce,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPreFlushCbs.length||pendingPostFlushCbs.length)&&flushJobs(V)}}function emit$1(V,ee,...ce){const _e=V.vnode.props||EMPTY_OBJ;let de=ce;const xe=ee.startsWith("update:"),Te=xe&&ee.slice(7);if(Te&&Te in _e){const Le=`${Te==="modelValue"?"model":Te}Modifiers`,{number:ze,trim:Be}=_e[Le]||EMPTY_OBJ;Be?de=ce.map($e=>$e.trim()):ze&&(de=ce.map(toNumber))}let j,Ce=_e[j=toHandlerKey(ee)]||_e[j=toHandlerKey(camelize(ee))];!Ce&&xe&&(Ce=_e[j=toHandlerKey(hyphenate(ee))]),Ce&&callWithAsyncErrorHandling(Ce,V,6,de);const Pe=_e[j+"Once"];if(Pe){if(!V.emitted)V.emitted={};else if(V.emitted[j])return;V.emitted[j]=!0,callWithAsyncErrorHandling(Pe,V,6,de)}}function normalizeEmitsOptions(V,ee,ce=!1){const _e=ee.emitsCache,de=_e.get(V);if(de!==void 0)return de;const xe=V.emits;let Te={},j=!1;if(!isFunction$2(V)){const Ce=Pe=>{const Le=normalizeEmitsOptions(Pe,ee,!0);Le&&(j=!0,extend$1(Te,Le))};!ce&&ee.mixins.length&&ee.mixins.forEach(Ce),V.extends&&Ce(V.extends),V.mixins&&V.mixins.forEach(Ce)}return!xe&&!j?(_e.set(V,null),null):(isArray$1(xe)?xe.forEach(Ce=>Te[Ce]=null):extend$1(Te,xe),_e.set(V,Te),Te)}function isEmitListener(V,ee){return!V||!isOn(ee)?!1:(ee=ee.slice(2).replace(/Once$/,""),hasOwn(V,ee[0].toLowerCase()+ee.slice(1))||hasOwn(V,hyphenate(ee))||hasOwn(V,ee))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(V){const ee=currentRenderingInstance;return currentRenderingInstance=V,currentScopeId=V&&V.type.__scopeId||null,ee}function withCtx(V,ee=currentRenderingInstance,ce){if(!ee||V._n)return V;const _e=(...de)=>{_e._d&&setBlockTracking(-1);const xe=setCurrentRenderingInstance(ee),Te=V(...de);return setCurrentRenderingInstance(xe),_e._d&&setBlockTracking(1),Te};return _e._n=!0,_e._c=!0,_e._d=!0,_e}function markAttrsAccessed(){}function renderComponentRoot(V){const{type:ee,vnode:ce,proxy:_e,withProxy:de,props:xe,propsOptions:[Te],slots:j,attrs:Ce,emit:Pe,render:Le,renderCache:ze,data:Be,setupState:$e,ctx:Ve,inheritAttrs:Ke}=V;let Xe,It;const Ct=setCurrentRenderingInstance(V);try{if(ce.shapeFlag&4){const Ot=de||_e;Xe=normalizeVNode(Le.call(Ot,Ot,ze,xe,$e,Be,Ve)),It=Ce}else{const Ot=ee;Xe=normalizeVNode(Ot.length>1?Ot(xe,{attrs:Ce,slots:j,emit:Pe}):Ot(xe,null)),It=ee.props?Ce:getFunctionalFallthrough(Ce)}}catch(Ot){blockStack.length=0,handleError(Ot,V,1),Xe=createVNode(Comment$1)}let yt=Xe;if(It&&Ke!==!1){const Ot=Object.keys(It),{shapeFlag:Mt}=yt;Ot.length&&Mt&7&&(Te&&Ot.some(isModelListener)&&(It=filterModelListeners(It,Te)),yt=cloneVNode(yt,It))}return ce.dirs&&(yt.dirs=yt.dirs?yt.dirs.concat(ce.dirs):ce.dirs),ce.transition&&(yt.transition=ce.transition),Xe=yt,setCurrentRenderingInstance(Ct),Xe}function filterSingleRoot(V){let ee;for(let ce=0;ce<V.length;ce++){const _e=V[ce];if(isVNode(_e)){if(_e.type!==Comment$1||_e.children==="v-if"){if(ee)return;ee=_e}}else return}return ee}const getFunctionalFallthrough=V=>{let ee;for(const ce in V)(ce==="class"||ce==="style"||isOn(ce))&&((ee||(ee={}))[ce]=V[ce]);return ee},filterModelListeners=(V,ee)=>{const ce={};for(const _e in V)(!isModelListener(_e)||!(_e.slice(9)in ee))&&(ce[_e]=V[_e]);return ce};function shouldUpdateComponent(V,ee,ce){const{props:_e,children:de,component:xe}=V,{props:Te,children:j,patchFlag:Ce}=ee,Pe=xe.emitsOptions;if(ee.dirs||ee.transition)return!0;if(ce&&Ce>=0){if(Ce&1024)return!0;if(Ce&16)return _e?hasPropsChanged(_e,Te,Pe):!!Te;if(Ce&8){const Le=ee.dynamicProps;for(let ze=0;ze<Le.length;ze++){const Be=Le[ze];if(Te[Be]!==_e[Be]&&!isEmitListener(Pe,Be))return!0}}}else return(de||j)&&(!j||!j.$stable)?!0:_e===Te?!1:_e?Te?hasPropsChanged(_e,Te,Pe):!0:!!Te;return!1}function hasPropsChanged(V,ee,ce){const _e=Object.keys(ee);if(_e.length!==Object.keys(V).length)return!0;for(let de=0;de<_e.length;de++){const xe=_e[de];if(ee[xe]!==V[xe]&&!isEmitListener(ce,xe))return!0}return!1}function updateHOCHostEl({vnode:V,parent:ee},ce){for(;ee&&ee.subTree===V;)(V=ee.vnode).el=ce,ee=ee.parent}const isSuspense=V=>V.__isSuspense,SuspenseImpl={name:"Suspense",__isSuspense:!0,process(V,ee,ce,_e,de,xe,Te,j,Ce,Pe){V==null?mountSuspense(ee,ce,_e,de,xe,Te,j,Ce,Pe):patchSuspense(V,ee,ce,_e,de,Te,j,Ce,Pe)},hydrate:hydrateSuspense,create:createSuspenseBoundary,normalize:normalizeSuspenseChildren},Suspense=SuspenseImpl;function triggerEvent(V,ee){const ce=V.props&&V.props[ee];isFunction$2(ce)&&ce()}function mountSuspense(V,ee,ce,_e,de,xe,Te,j,Ce){const{p:Pe,o:{createElement:Le}}=Ce,ze=Le("div"),Be=V.suspense=createSuspenseBoundary(V,de,_e,ee,ze,ce,xe,Te,j,Ce);Pe(null,Be.pendingBranch=V.ssContent,ze,null,_e,Be,xe,Te),Be.deps>0?(triggerEvent(V,"onPending"),triggerEvent(V,"onFallback"),Pe(null,V.ssFallback,ee,ce,_e,null,xe,Te),setActiveBranch(Be,V.ssFallback)):Be.resolve()}function patchSuspense(V,ee,ce,_e,de,xe,Te,j,{p:Ce,um:Pe,o:{createElement:Le}}){const ze=ee.suspense=V.suspense;ze.vnode=ee,ee.el=V.el;const Be=ee.ssContent,$e=ee.ssFallback,{activeBranch:Ve,pendingBranch:Ke,isInFallback:Xe,isHydrating:It}=ze;if(Ke)ze.pendingBranch=Be,isSameVNodeType(Be,Ke)?(Ce(Ke,Be,ze.hiddenContainer,null,de,ze,xe,Te,j),ze.deps<=0?ze.resolve():Xe&&(Ce(Ve,$e,ce,_e,de,null,xe,Te,j),setActiveBranch(ze,$e))):(ze.pendingId++,It?(ze.isHydrating=!1,ze.activeBranch=Ke):Pe(Ke,de,ze),ze.deps=0,ze.effects.length=0,ze.hiddenContainer=Le("div"),Xe?(Ce(null,Be,ze.hiddenContainer,null,de,ze,xe,Te,j),ze.deps<=0?ze.resolve():(Ce(Ve,$e,ce,_e,de,null,xe,Te,j),setActiveBranch(ze,$e))):Ve&&isSameVNodeType(Be,Ve)?(Ce(Ve,Be,ce,_e,de,ze,xe,Te,j),ze.resolve(!0)):(Ce(null,Be,ze.hiddenContainer,null,de,ze,xe,Te,j),ze.deps<=0&&ze.resolve()));else if(Ve&&isSameVNodeType(Be,Ve))Ce(Ve,Be,ce,_e,de,ze,xe,Te,j),setActiveBranch(ze,Be);else if(triggerEvent(ee,"onPending"),ze.pendingBranch=Be,ze.pendingId++,Ce(null,Be,ze.hiddenContainer,null,de,ze,xe,Te,j),ze.deps<=0)ze.resolve();else{const{timeout:Ct,pendingId:yt}=ze;Ct>0?setTimeout(()=>{ze.pendingId===yt&&ze.fallback($e)},Ct):Ct===0&&ze.fallback($e)}}function createSuspenseBoundary(V,ee,ce,_e,de,xe,Te,j,Ce,Pe,Le=!1){const{p:ze,m:Be,um:$e,n:Ve,o:{parentNode:Ke,remove:Xe}}=Pe,It=toNumber(V.props&&V.props.timeout),Ct={vnode:V,parent:ee,parentComponent:ce,isSVG:Te,container:_e,hiddenContainer:de,anchor:xe,deps:0,pendingId:0,timeout:typeof It=="number"?It:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:Le,isUnmounted:!1,effects:[],resolve(yt=!1){const{vnode:Ot,activeBranch:Mt,pendingBranch:Pt,pendingId:At,effects:Dt,parentComponent:Gt,container:Ut}=Ct;if(Ct.isHydrating)Ct.isHydrating=!1;else if(!yt){const An=Mt&&Pt.transition&&Pt.transition.mode==="out-in";An&&(Mt.transition.afterLeave=()=>{At===Ct.pendingId&&Be(Pt,Ut,_n,0)});let{anchor:_n}=Ct;Mt&&(_n=Ve(Mt),$e(Mt,Gt,Ct,!0)),An||Be(Pt,Ut,_n,0)}setActiveBranch(Ct,Pt),Ct.pendingBranch=null,Ct.isInFallback=!1;let on=Ct.parent,Vt=!1;for(;on;){if(on.pendingBranch){on.effects.push(...Dt),Vt=!0;break}on=on.parent}Vt||queuePostFlushCb(Dt),Ct.effects=[],triggerEvent(Ot,"onResolve")},fallback(yt){if(!Ct.pendingBranch)return;const{vnode:Ot,activeBranch:Mt,parentComponent:Pt,container:At,isSVG:Dt}=Ct;triggerEvent(Ot,"onFallback");const Gt=Ve(Mt),Ut=()=>{!Ct.isInFallback||(ze(null,yt,At,Gt,Pt,null,Dt,j,Ce),setActiveBranch(Ct,yt))},on=yt.transition&&yt.transition.mode==="out-in";on&&(Mt.transition.afterLeave=Ut),Ct.isInFallback=!0,$e(Mt,Pt,null,!0),on||Ut()},move(yt,Ot,Mt){Ct.activeBranch&&Be(Ct.activeBranch,yt,Ot,Mt),Ct.container=yt},next(){return Ct.activeBranch&&Ve(Ct.activeBranch)},registerDep(yt,Ot){const Mt=!!Ct.pendingBranch;Mt&&Ct.deps++;const Pt=yt.vnode.el;yt.asyncDep.catch(At=>{handleError(At,yt,0)}).then(At=>{if(yt.isUnmounted||Ct.isUnmounted||Ct.pendingId!==yt.suspenseId)return;yt.asyncResolved=!0;const{vnode:Dt}=yt;handleSetupResult(yt,At,!1),Pt&&(Dt.el=Pt);const Gt=!Pt&&yt.subTree.el;Ot(yt,Dt,Ke(Pt||yt.subTree.el),Pt?null:Ve(yt.subTree),Ct,Te,Ce),Gt&&Xe(Gt),updateHOCHostEl(yt,Dt.el),Mt&&--Ct.deps===0&&Ct.resolve()})},unmount(yt,Ot){Ct.isUnmounted=!0,Ct.activeBranch&&$e(Ct.activeBranch,ce,yt,Ot),Ct.pendingBranch&&$e(Ct.pendingBranch,ce,yt,Ot)}};return Ct}function hydrateSuspense(V,ee,ce,_e,de,xe,Te,j,Ce){const Pe=ee.suspense=createSuspenseBoundary(ee,_e,ce,V.parentNode,document.createElement("div"),null,de,xe,Te,j,!0),Le=Ce(V,Pe.pendingBranch=ee.ssContent,ce,Pe,xe,Te);return Pe.deps===0&&Pe.resolve(),Le}function normalizeSuspenseChildren(V){const{shapeFlag:ee,children:ce}=V,_e=ee&32;V.ssContent=normalizeSuspenseSlot(_e?ce.default:ce),V.ssFallback=_e?normalizeSuspenseSlot(ce.fallback):createVNode(Comment$1)}function normalizeSuspenseSlot(V){let ee;if(isFunction$2(V)){const ce=isBlockTreeEnabled&&V._c;ce&&(V._d=!1,openBlock()),V=V(),ce&&(V._d=!0,ee=currentBlock,closeBlock())}return isArray$1(V)&&(V=filterSingleRoot(V)),V=normalizeVNode(V),ee&&!V.dynamicChildren&&(V.dynamicChildren=ee.filter(ce=>ce!==V)),V}function queueEffectWithSuspense(V,ee){ee&&ee.pendingBranch?isArray$1(V)?ee.effects.push(...V):ee.effects.push(V):queuePostFlushCb(V)}function setActiveBranch(V,ee){V.activeBranch=ee;const{vnode:ce,parentComponent:_e}=V,de=ce.el=ee.el;_e&&_e.subTree===ce&&(_e.vnode.el=de,updateHOCHostEl(_e,de))}function provide(V,ee){if(currentInstance){let ce=currentInstance.provides;const _e=currentInstance.parent&&currentInstance.parent.provides;_e===ce&&(ce=currentInstance.provides=Object.create(_e)),ce[V]=ee}}function inject(V,ee,ce=!1){const _e=currentInstance||currentRenderingInstance;if(_e){const de=_e.parent==null?_e.vnode.appContext&&_e.vnode.appContext.provides:_e.parent.provides;if(de&&V in de)return de[V];if(arguments.length>1)return ce&&isFunction$2(ee)?ee.call(_e.proxy):ee}}function watchEffect(V,ee){return doWatch(V,null,ee)}const INITIAL_WATCHER_VALUE={};function watch(V,ee,ce){return doWatch(V,ee,ce)}function doWatch(V,ee,{immediate:ce,deep:_e,flush:de,onTrack:xe,onTrigger:Te}=EMPTY_OBJ){const j=currentInstance;let Ce,Pe=!1,Le=!1;if(isRef(V)?(Ce=()=>V.value,Pe=isShallow(V)):isReactive(V)?(Ce=()=>V,_e=!0):isArray$1(V)?(Le=!0,Pe=V.some(isReactive),Ce=()=>V.map(It=>{if(isRef(It))return It.value;if(isReactive(It))return traverse(It);if(isFunction$2(It))return callWithErrorHandling(It,j,2)})):isFunction$2(V)?ee?Ce=()=>callWithErrorHandling(V,j,2):Ce=()=>{if(!(j&&j.isUnmounted))return ze&&ze(),callWithAsyncErrorHandling(V,j,3,[Be])}:Ce=NOOP,ee&&_e){const It=Ce;Ce=()=>traverse(It())}let ze,Be=It=>{ze=Xe.onStop=()=>{callWithErrorHandling(It,j,4)}};if(isInSSRComponentSetup)return Be=NOOP,ee?ce&&callWithAsyncErrorHandling(ee,j,3,[Ce(),Le?[]:void 0,Be]):Ce(),NOOP;let $e=Le?[]:INITIAL_WATCHER_VALUE;const Ve=()=>{if(!!Xe.active)if(ee){const It=Xe.run();(_e||Pe||(Le?It.some((Ct,yt)=>hasChanged(Ct,$e[yt])):hasChanged(It,$e)))&&(ze&&ze(),callWithAsyncErrorHandling(ee,j,3,[It,$e===INITIAL_WATCHER_VALUE?void 0:$e,Be]),$e=It)}else Xe.run()};Ve.allowRecurse=!!ee;let Ke;de==="sync"?Ke=Ve:de==="post"?Ke=()=>queuePostRenderEffect(Ve,j&&j.suspense):Ke=()=>{!j||j.isMounted?queuePreFlushCb(Ve):Ve()};const Xe=new ReactiveEffect(Ce,Ke);return ee?ce?Ve():$e=Xe.run():de==="post"?queuePostRenderEffect(Xe.run.bind(Xe),j&&j.suspense):Xe.run(),()=>{Xe.stop(),j&&j.scope&&remove(j.scope.effects,Xe)}}function instanceWatch(V,ee,ce){const _e=this.proxy,de=isString$1(V)?V.includes(".")?createPathGetter(_e,V):()=>_e[V]:V.bind(_e,_e);let xe;isFunction$2(ee)?xe=ee:(xe=ee.handler,ce=ee);const Te=currentInstance;setCurrentInstance(this);const j=doWatch(de,xe.bind(_e),ce);return Te?setCurrentInstance(Te):unsetCurrentInstance(),j}function createPathGetter(V,ee){const ce=ee.split(".");return()=>{let _e=V;for(let de=0;de<ce.length&&_e;de++)_e=_e[ce[de]];return _e}}function traverse(V,ee){if(!isObject$1(V)||V.__v_skip||(ee=ee||new Set,ee.has(V)))return V;if(ee.add(V),isRef(V))traverse(V.value,ee);else if(isArray$1(V))for(let ce=0;ce<V.length;ce++)traverse(V[ce],ee);else if(isSet(V)||isMap(V))V.forEach(ce=>{traverse(ce,ee)});else if(isPlainObject$2(V))for(const ce in V)traverse(V[ce],ee);return V}function useTransitionState(){const V={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{V.isMounted=!0}),onBeforeUnmount(()=>{V.isUnmounting=!0}),V}const TransitionHookValidator=[Function,Array],BaseTransitionImpl={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},setup(V,{slots:ee}){const ce=getCurrentInstance(),_e=useTransitionState();let de;return()=>{const xe=ee.default&&getTransitionRawChildren(ee.default(),!0);if(!xe||!xe.length)return;const Te=toRaw(V),{mode:j}=Te,Ce=xe[0];if(_e.isLeaving)return emptyPlaceholder(Ce);const Pe=getKeepAliveChild(Ce);if(!Pe)return emptyPlaceholder(Ce);const Le=resolveTransitionHooks(Pe,Te,_e,ce);setTransitionHooks(Pe,Le);const ze=ce.subTree,Be=ze&&getKeepAliveChild(ze);let $e=!1;const{getTransitionKey:Ve}=Pe.type;if(Ve){const Ke=Ve();de===void 0?de=Ke:Ke!==de&&(de=Ke,$e=!0)}if(Be&&Be.type!==Comment$1&&(!isSameVNodeType(Pe,Be)||$e)){const Ke=resolveTransitionHooks(Be,Te,_e,ce);if(setTransitionHooks(Be,Ke),j==="out-in")return _e.isLeaving=!0,Ke.afterLeave=()=>{_e.isLeaving=!1,ce.update()},emptyPlaceholder(Ce);j==="in-out"&&Pe.type!==Comment$1&&(Ke.delayLeave=(Xe,It,Ct)=>{const yt=getLeavingNodesForType(_e,Be);yt[String(Be.key)]=Be,Xe._leaveCb=()=>{It(),Xe._leaveCb=void 0,delete Le.delayedLeave},Le.delayedLeave=Ct})}return Ce}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(V,ee){const{leavingVNodes:ce}=V;let _e=ce.get(ee.type);return _e||(_e=Object.create(null),ce.set(ee.type,_e)),_e}function resolveTransitionHooks(V,ee,ce,_e){const{appear:de,mode:xe,persisted:Te=!1,onBeforeEnter:j,onEnter:Ce,onAfterEnter:Pe,onEnterCancelled:Le,onBeforeLeave:ze,onLeave:Be,onAfterLeave:$e,onLeaveCancelled:Ve,onBeforeAppear:Ke,onAppear:Xe,onAfterAppear:It,onAppearCancelled:Ct}=ee,yt=String(V.key),Ot=getLeavingNodesForType(ce,V),Mt=(At,Dt)=>{At&&callWithAsyncErrorHandling(At,_e,9,Dt)},Pt={mode:xe,persisted:Te,beforeEnter(At){let Dt=j;if(!ce.isMounted)if(de)Dt=Ke||j;else return;At._leaveCb&&At._leaveCb(!0);const Gt=Ot[yt];Gt&&isSameVNodeType(V,Gt)&&Gt.el._leaveCb&&Gt.el._leaveCb(),Mt(Dt,[At])},enter(At){let Dt=Ce,Gt=Pe,Ut=Le;if(!ce.isMounted)if(de)Dt=Xe||Ce,Gt=It||Pe,Ut=Ct||Le;else return;let on=!1;const Vt=At._enterCb=An=>{on||(on=!0,An?Mt(Ut,[At]):Mt(Gt,[At]),Pt.delayedLeave&&Pt.delayedLeave(),At._enterCb=void 0)};Dt?(Dt(At,Vt),Dt.length<=1&&Vt()):Vt()},leave(At,Dt){const Gt=String(V.key);if(At._enterCb&&At._enterCb(!0),ce.isUnmounting)return Dt();Mt(ze,[At]);let Ut=!1;const on=At._leaveCb=Vt=>{Ut||(Ut=!0,Dt(),Vt?Mt(Ve,[At]):Mt($e,[At]),At._leaveCb=void 0,Ot[Gt]===V&&delete Ot[Gt])};Ot[Gt]=V,Be?(Be(At,on),Be.length<=1&&on()):on()},clone(At){return resolveTransitionHooks(At,ee,ce,_e)}};return Pt}function emptyPlaceholder(V){if(isKeepAlive(V))return V=cloneVNode(V),V.children=null,V}function getKeepAliveChild(V){return isKeepAlive(V)?V.children?V.children[0]:void 0:V}function setTransitionHooks(V,ee){V.shapeFlag&6&&V.component?setTransitionHooks(V.component.subTree,ee):V.shapeFlag&128?(V.ssContent.transition=ee.clone(V.ssContent),V.ssFallback.transition=ee.clone(V.ssFallback)):V.transition=ee}function getTransitionRawChildren(V,ee=!1){let ce=[],_e=0;for(let de=0;de<V.length;de++){const xe=V[de];xe.type===Fragment?(xe.patchFlag&128&&_e++,ce=ce.concat(getTransitionRawChildren(xe.children,ee))):(ee||xe.type!==Comment$1)&&ce.push(xe)}if(_e>1)for(let de=0;de<ce.length;de++)ce[de].patchFlag=-2;return ce}function defineComponent(V){return isFunction$2(V)?{setup:V,name:V.name}:V}const isAsyncWrapper=V=>!!V.type.__asyncLoader,isKeepAlive=V=>V.type.__isKeepAlive;function onActivated(V,ee){registerKeepAliveHook(V,"a",ee)}function onDeactivated(V,ee){registerKeepAliveHook(V,"da",ee)}function registerKeepAliveHook(V,ee,ce=currentInstance){const _e=V.__wdc||(V.__wdc=()=>{let de=ce;for(;de;){if(de.isDeactivated)return;de=de.parent}return V()});if(injectHook(ee,_e,ce),ce){let de=ce.parent;for(;de&&de.parent;)isKeepAlive(de.parent.vnode)&&injectToKeepAliveRoot(_e,ee,ce,de),de=de.parent}}function injectToKeepAliveRoot(V,ee,ce,_e){const de=injectHook(ee,V,_e,!0);onUnmounted(()=>{remove(_e[ee],de)},ce)}function injectHook(V,ee,ce=currentInstance,_e=!1){if(ce){const de=ce[V]||(ce[V]=[]),xe=ee.__weh||(ee.__weh=(...Te)=>{if(ce.isUnmounted)return;pauseTracking(),setCurrentInstance(ce);const j=callWithAsyncErrorHandling(ee,ce,V,Te);return unsetCurrentInstance(),resetTracking(),j});return _e?de.unshift(xe):de.push(xe),xe}}const createHook=V=>(ee,ce=currentInstance)=>(!isInSSRComponentSetup||V==="sp")&&injectHook(V,ee,ce),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(V,ee=currentInstance){injectHook("ec",V,ee)}let shouldCacheAccess=!0;function applyOptions(V){const ee=resolveMergedOptions(V),ce=V.proxy,_e=V.ctx;shouldCacheAccess=!1,ee.beforeCreate&&callHook$1(ee.beforeCreate,V,"bc");const{data:de,computed:xe,methods:Te,watch:j,provide:Ce,inject:Pe,created:Le,beforeMount:ze,mounted:Be,beforeUpdate:$e,updated:Ve,activated:Ke,deactivated:Xe,beforeDestroy:It,beforeUnmount:Ct,destroyed:yt,unmounted:Ot,render:Mt,renderTracked:Pt,renderTriggered:At,errorCaptured:Dt,serverPrefetch:Gt,expose:Ut,inheritAttrs:on,components:Vt,directives:An,filters:_n}=ee;if(Pe&&resolveInjections(Pe,_e,null,V.appContext.config.unwrapInjectedRef),Te)for(const Ln in Te){const mn=Te[Ln];isFunction$2(mn)&&(_e[Ln]=mn.bind(ce))}if(de){const Ln=de.call(ce,ce);isObject$1(Ln)&&(V.data=reactive(Ln))}if(shouldCacheAccess=!0,xe)for(const Ln in xe){const mn=xe[Ln],Xn=isFunction$2(mn)?mn.bind(ce,ce):isFunction$2(mn.get)?mn.get.bind(ce,ce):NOOP,sr=!isFunction$2(mn)&&isFunction$2(mn.set)?mn.set.bind(ce):NOOP,Pr=computed({get:Xn,set:sr});Object.defineProperty(_e,Ln,{enumerable:!0,configurable:!0,get:()=>Pr.value,set:er=>Pr.value=er})}if(j)for(const Ln in j)createWatcher(j[Ln],_e,ce,Ln);if(Ce){const Ln=isFunction$2(Ce)?Ce.call(ce):Ce;Reflect.ownKeys(Ln).forEach(mn=>{provide(mn,Ln[mn])})}Le&&callHook$1(Le,V,"c");function bn(Ln,mn){isArray$1(mn)?mn.forEach(Xn=>Ln(Xn.bind(ce))):mn&&Ln(mn.bind(ce))}if(bn(onBeforeMount,ze),bn(onMounted,Be),bn(onBeforeUpdate,$e),bn(onUpdated,Ve),bn(onActivated,Ke),bn(onDeactivated,Xe),bn(onErrorCaptured,Dt),bn(onRenderTracked,Pt),bn(onRenderTriggered,At),bn(onBeforeUnmount,Ct),bn(onUnmounted,Ot),bn(onServerPrefetch,Gt),isArray$1(Ut))if(Ut.length){const Ln=V.exposed||(V.exposed={});Ut.forEach(mn=>{Object.defineProperty(Ln,mn,{get:()=>ce[mn],set:Xn=>ce[mn]=Xn})})}else V.exposed||(V.exposed={});Mt&&V.render===NOOP&&(V.render=Mt),on!=null&&(V.inheritAttrs=on),Vt&&(V.components=Vt),An&&(V.directives=An)}function resolveInjections(V,ee,ce=NOOP,_e=!1){isArray$1(V)&&(V=normalizeInject(V));for(const de in V){const xe=V[de];let Te;isObject$1(xe)?"default"in xe?Te=inject(xe.from||de,xe.default,!0):Te=inject(xe.from||de):Te=inject(xe),isRef(Te)&&_e?Object.defineProperty(ee,de,{enumerable:!0,configurable:!0,get:()=>Te.value,set:j=>Te.value=j}):ee[de]=Te}}function callHook$1(V,ee,ce){callWithAsyncErrorHandling(isArray$1(V)?V.map(_e=>_e.bind(ee.proxy)):V.bind(ee.proxy),ee,ce)}function createWatcher(V,ee,ce,_e){const de=_e.includes(".")?createPathGetter(ce,_e):()=>ce[_e];if(isString$1(V)){const xe=ee[V];isFunction$2(xe)&&watch(de,xe)}else if(isFunction$2(V))watch(de,V.bind(ce));else if(isObject$1(V))if(isArray$1(V))V.forEach(xe=>createWatcher(xe,ee,ce,_e));else{const xe=isFunction$2(V.handler)?V.handler.bind(ce):ee[V.handler];isFunction$2(xe)&&watch(de,xe,V)}}function resolveMergedOptions(V){const ee=V.type,{mixins:ce,extends:_e}=ee,{mixins:de,optionsCache:xe,config:{optionMergeStrategies:Te}}=V.appContext,j=xe.get(ee);let Ce;return j?Ce=j:!de.length&&!ce&&!_e?Ce=ee:(Ce={},de.length&&de.forEach(Pe=>mergeOptions$1(Ce,Pe,Te,!0)),mergeOptions$1(Ce,ee,Te)),xe.set(ee,Ce),Ce}function mergeOptions$1(V,ee,ce,_e=!1){const{mixins:de,extends:xe}=ee;xe&&mergeOptions$1(V,xe,ce,!0),de&&de.forEach(Te=>mergeOptions$1(V,Te,ce,!0));for(const Te in ee)if(!(_e&&Te==="expose")){const j=internalOptionMergeStrats[Te]||ce&&ce[Te];V[Te]=j?j(V[Te],ee[Te]):ee[Te]}return V}const internalOptionMergeStrats={data:mergeDataFn,props:mergeObjectOptions,emits:mergeObjectOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(V,ee){return ee?V?function(){return extend$1(isFunction$2(V)?V.call(this,this):V,isFunction$2(ee)?ee.call(this,this):ee)}:ee:V}function mergeInject(V,ee){return mergeObjectOptions(normalizeInject(V),normalizeInject(ee))}function normalizeInject(V){if(isArray$1(V)){const ee={};for(let ce=0;ce<V.length;ce++)ee[V[ce]]=V[ce];return ee}return V}function mergeAsArray(V,ee){return V?[...new Set([].concat(V,ee))]:ee}function mergeObjectOptions(V,ee){return V?extend$1(extend$1(Object.create(null),V),ee):ee}function mergeWatchOptions(V,ee){if(!V)return ee;if(!ee)return V;const ce=extend$1(Object.create(null),V);for(const _e in ee)ce[_e]=mergeAsArray(V[_e],ee[_e]);return ce}function initProps(V,ee,ce,_e=!1){const de={},xe={};def(xe,InternalObjectKey,1),V.propsDefaults=Object.create(null),setFullProps(V,ee,de,xe);for(const Te in V.propsOptions[0])Te in de||(de[Te]=void 0);ce?V.props=_e?de:shallowReactive(de):V.type.props?V.props=de:V.props=xe,V.attrs=xe}function updateProps(V,ee,ce,_e){const{props:de,attrs:xe,vnode:{patchFlag:Te}}=V,j=toRaw(de),[Ce]=V.propsOptions;let Pe=!1;if((_e||Te>0)&&!(Te&16)){if(Te&8){const Le=V.vnode.dynamicProps;for(let ze=0;ze<Le.length;ze++){let Be=Le[ze];const $e=ee[Be];if(Ce)if(hasOwn(xe,Be))$e!==xe[Be]&&(xe[Be]=$e,Pe=!0);else{const Ve=camelize(Be);de[Ve]=resolvePropValue(Ce,j,Ve,$e,V,!1)}else $e!==xe[Be]&&(xe[Be]=$e,Pe=!0)}}}else{setFullProps(V,ee,de,xe)&&(Pe=!0);let Le;for(const ze in j)(!ee||!hasOwn(ee,ze)&&((Le=hyphenate(ze))===ze||!hasOwn(ee,Le)))&&(Ce?ce&&(ce[ze]!==void 0||ce[Le]!==void 0)&&(de[ze]=resolvePropValue(Ce,j,ze,void 0,V,!0)):delete de[ze]);if(xe!==j)for(const ze in xe)(!ee||!hasOwn(ee,ze)&&!0)&&(delete xe[ze],Pe=!0)}Pe&&trigger$1(V,"set","$attrs")}function setFullProps(V,ee,ce,_e){const[de,xe]=V.propsOptions;let Te=!1,j;if(ee)for(let Ce in ee){if(isReservedProp(Ce))continue;const Pe=ee[Ce];let Le;de&&hasOwn(de,Le=camelize(Ce))?!xe||!xe.includes(Le)?ce[Le]=Pe:(j||(j={}))[Le]=Pe:isEmitListener(V.emitsOptions,Ce)||(!(Ce in _e)||Pe!==_e[Ce])&&(_e[Ce]=Pe,Te=!0)}if(xe){const Ce=toRaw(ce),Pe=j||EMPTY_OBJ;for(let Le=0;Le<xe.length;Le++){const ze=xe[Le];ce[ze]=resolvePropValue(de,Ce,ze,Pe[ze],V,!hasOwn(Pe,ze))}}return Te}function resolvePropValue(V,ee,ce,_e,de,xe){const Te=V[ce];if(Te!=null){const j=hasOwn(Te,"default");if(j&&_e===void 0){const Ce=Te.default;if(Te.type!==Function&&isFunction$2(Ce)){const{propsDefaults:Pe}=de;ce in Pe?_e=Pe[ce]:(setCurrentInstance(de),_e=Pe[ce]=Ce.call(null,ee),unsetCurrentInstance())}else _e=Ce}Te[0]&&(xe&&!j?_e=!1:Te[1]&&(_e===""||_e===hyphenate(ce))&&(_e=!0))}return _e}function normalizePropsOptions(V,ee,ce=!1){const _e=ee.propsCache,de=_e.get(V);if(de)return de;const xe=V.props,Te={},j=[];let Ce=!1;if(!isFunction$2(V)){const Le=ze=>{Ce=!0;const[Be,$e]=normalizePropsOptions(ze,ee,!0);extend$1(Te,Be),$e&&j.push(...$e)};!ce&&ee.mixins.length&&ee.mixins.forEach(Le),V.extends&&Le(V.extends),V.mixins&&V.mixins.forEach(Le)}if(!xe&&!Ce)return _e.set(V,EMPTY_ARR),EMPTY_ARR;if(isArray$1(xe))for(let Le=0;Le<xe.length;Le++){const ze=camelize(xe[Le]);validatePropName(ze)&&(Te[ze]=EMPTY_OBJ)}else if(xe)for(const Le in xe){const ze=camelize(Le);if(validatePropName(ze)){const Be=xe[Le],$e=Te[ze]=isArray$1(Be)||isFunction$2(Be)?{type:Be}:Be;if($e){const Ve=getTypeIndex(Boolean,$e.type),Ke=getTypeIndex(String,$e.type);$e[0]=Ve>-1,$e[1]=Ke<0||Ve<Ke,(Ve>-1||hasOwn($e,"default"))&&j.push(ze)}}}const Pe=[Te,j];return _e.set(V,Pe),Pe}function validatePropName(V){return V[0]!=="$"}function getType(V){const ee=V&&V.toString().match(/^\s*function (\w+)/);return ee?ee[1]:V===null?"null":""}function isSameType(V,ee){return getType(V)===getType(ee)}function getTypeIndex(V,ee){return isArray$1(ee)?ee.findIndex(ce=>isSameType(ce,V)):isFunction$2(ee)&&isSameType(ee,V)?0:-1}const isInternalKey=V=>V[0]==="_"||V==="$stable",normalizeSlotValue=V=>isArray$1(V)?V.map(normalizeVNode):[normalizeVNode(V)],normalizeSlot$1=(V,ee,ce)=>{const _e=withCtx((...de)=>normalizeSlotValue(ee(...de)),ce);return _e._c=!1,_e},normalizeObjectSlots=(V,ee,ce)=>{const _e=V._ctx;for(const de in V){if(isInternalKey(de))continue;const xe=V[de];if(isFunction$2(xe))ee[de]=normalizeSlot$1(de,xe,_e);else if(xe!=null){const Te=normalizeSlotValue(xe);ee[de]=()=>Te}}},normalizeVNodeSlots=(V,ee)=>{const ce=normalizeSlotValue(ee);V.slots.default=()=>ce},initSlots=(V,ee)=>{if(V.vnode.shapeFlag&32){const ce=ee._;ce?(V.slots=toRaw(ee),def(ee,"_",ce)):normalizeObjectSlots(ee,V.slots={})}else V.slots={},ee&&normalizeVNodeSlots(V,ee);def(V.slots,InternalObjectKey,1)},updateSlots=(V,ee,ce)=>{const{vnode:_e,slots:de}=V;let xe=!0,Te=EMPTY_OBJ;if(_e.shapeFlag&32){const j=ee._;j?ce&&j===1?xe=!1:(extend$1(de,ee),!ce&&j===1&&delete de._):(xe=!ee.$stable,normalizeObjectSlots(ee,de)),Te=ee}else ee&&(normalizeVNodeSlots(V,ee),Te={default:1});if(xe)for(const j in de)!isInternalKey(j)&&!(j in Te)&&delete de[j]};function withDirectives(V,ee){const ce=currentRenderingInstance;if(ce===null)return V;const _e=ce.proxy,de=V.dirs||(V.dirs=[]);for(let xe=0;xe<ee.length;xe++){let[Te,j,Ce,Pe=EMPTY_OBJ]=ee[xe];isFunction$2(Te)&&(Te={mounted:Te,updated:Te}),Te.deep&&traverse(j),de.push({dir:Te,instance:_e,value:j,oldValue:void 0,arg:Ce,modifiers:Pe})}return V}function invokeDirectiveHook(V,ee,ce,_e){const de=V.dirs,xe=ee&&ee.dirs;for(let Te=0;Te<de.length;Te++){const j=de[Te];xe&&(j.oldValue=xe[Te].value);let Ce=j.dir[_e];Ce&&(pauseTracking(),callWithAsyncErrorHandling(Ce,ce,8,[V.el,j,V,ee]),resetTracking())}}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid=0;function createAppAPI(V,ee){return function(_e,de=null){de!=null&&!isObject$1(de)&&(de=null);const xe=createAppContext(),Te=new Set;let j=!1;const Ce=xe.app={_uid:uid++,_component:_e,_props:de,_container:null,_context:xe,_instance:null,version,get config(){return xe.config},set config(Pe){},use(Pe,...Le){return Te.has(Pe)||(Pe&&isFunction$2(Pe.install)?(Te.add(Pe),Pe.install(Ce,...Le)):isFunction$2(Pe)&&(Te.add(Pe),Pe(Ce,...Le))),Ce},mixin(Pe){return xe.mixins.includes(Pe)||xe.mixins.push(Pe),Ce},component(Pe,Le){return Le?(xe.components[Pe]=Le,Ce):xe.components[Pe]},directive(Pe,Le){return Le?(xe.directives[Pe]=Le,Ce):xe.directives[Pe]},mount(Pe,Le,ze){if(!j){const Be=createVNode(_e,de);return Be.appContext=xe,Le&&ee?ee(Be,Pe):V(Be,Pe,ze),j=!0,Ce._container=Pe,Pe.__vue_app__=Ce,getExposeProxy(Be.component)||Be.component.proxy}},unmount(){j&&(V(null,Ce._container),delete Ce._container.__vue_app__)},provide(Pe,Le){return xe.provides[Pe]=Le,Ce}};return Ce}}function setRef(V,ee,ce,_e,de=!1){if(isArray$1(V)){V.forEach((Be,$e)=>setRef(Be,ee&&(isArray$1(ee)?ee[$e]:ee),ce,_e,de));return}if(isAsyncWrapper(_e)&&!de)return;const xe=_e.shapeFlag&4?getExposeProxy(_e.component)||_e.component.proxy:_e.el,Te=de?null:xe,{i:j,r:Ce}=V,Pe=ee&&ee.r,Le=j.refs===EMPTY_OBJ?j.refs={}:j.refs,ze=j.setupState;if(Pe!=null&&Pe!==Ce&&(isString$1(Pe)?(Le[Pe]=null,hasOwn(ze,Pe)&&(ze[Pe]=null)):isRef(Pe)&&(Pe.value=null)),isFunction$2(Ce))callWithErrorHandling(Ce,j,12,[Te,Le]);else{const Be=isString$1(Ce),$e=isRef(Ce);if(Be||$e){const Ve=()=>{if(V.f){const Ke=Be?Le[Ce]:Ce.value;de?isArray$1(Ke)&&remove(Ke,xe):isArray$1(Ke)?Ke.includes(xe)||Ke.push(xe):Be?Le[Ce]=[xe]:(Ce.value=[xe],V.k&&(Le[V.k]=Ce.value))}else Be?(Le[Ce]=Te,hasOwn(ze,Ce)&&(ze[Ce]=Te)):isRef(Ce)&&(Ce.value=Te,V.k&&(Le[V.k]=Te))};Te?(Ve.id=-1,queuePostRenderEffect(Ve,ce)):Ve()}}}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(V){return baseCreateRenderer(V)}function baseCreateRenderer(V,ee){const ce=getGlobalThis();ce.__VUE__=!0;const{insert:_e,remove:de,patchProp:xe,createElement:Te,createText:j,createComment:Ce,setText:Pe,setElementText:Le,parentNode:ze,nextSibling:Be,setScopeId:$e=NOOP,cloneNode:Ve,insertStaticContent:Ke}=V,Xe=(ft,wt,qt,cn=null,an=null,yn=null,kn=!1,en=null,Tn=!!wt.dynamicChildren)=>{if(ft===wt)return;ft&&!isSameVNodeType(ft,wt)&&(cn=Un(ft),rr(ft,an,yn,!0),ft=null),wt.patchFlag===-2&&(Tn=!1,wt.dynamicChildren=null);const{type:fn,ref:Nn,shapeFlag:Bn}=wt;switch(fn){case Text:It(ft,wt,qt,cn);break;case Comment$1:Ct(ft,wt,qt,cn);break;case Static:ft==null&&yt(wt,qt,cn,kn);break;case Fragment:An(ft,wt,qt,cn,an,yn,kn,en,Tn);break;default:Bn&1?Pt(ft,wt,qt,cn,an,yn,kn,en,Tn):Bn&6?_n(ft,wt,qt,cn,an,yn,kn,en,Tn):(Bn&64||Bn&128)&&fn.process(ft,wt,qt,cn,an,yn,kn,en,Tn,_r)}Nn!=null&&an&&setRef(Nn,ft&&ft.ref,yn,wt||ft,!wt)},It=(ft,wt,qt,cn)=>{if(ft==null)_e(wt.el=j(wt.children),qt,cn);else{const an=wt.el=ft.el;wt.children!==ft.children&&Pe(an,wt.children)}},Ct=(ft,wt,qt,cn)=>{ft==null?_e(wt.el=Ce(wt.children||""),qt,cn):wt.el=ft.el},yt=(ft,wt,qt,cn)=>{[ft.el,ft.anchor]=Ke(ft.children,wt,qt,cn,ft.el,ft.anchor)},Ot=({el:ft,anchor:wt},qt,cn)=>{let an;for(;ft&&ft!==wt;)an=Be(ft),_e(ft,qt,cn),ft=an;_e(wt,qt,cn)},Mt=({el:ft,anchor:wt})=>{let qt;for(;ft&&ft!==wt;)qt=Be(ft),de(ft),ft=qt;de(wt)},Pt=(ft,wt,qt,cn,an,yn,kn,en,Tn)=>{kn=kn||wt.type==="svg",ft==null?At(wt,qt,cn,an,yn,kn,en,Tn):Ut(ft,wt,an,yn,kn,en,Tn)},At=(ft,wt,qt,cn,an,yn,kn,en)=>{let Tn,fn;const{type:Nn,props:Bn,shapeFlag:Gn,transition:Jn,patchFlag:gr,dirs:xr}=ft;if(ft.el&&Ve!==void 0&&gr===-1)Tn=ft.el=Ve(ft.el);else{if(Tn=ft.el=Te(ft.type,yn,Bn&&Bn.is,Bn),Gn&8?Le(Tn,ft.children):Gn&16&&Gt(ft.children,Tn,null,cn,an,yn&&Nn!=="foreignObject",kn,en),xr&&invokeDirectiveHook(ft,null,cn,"created"),Bn){for(const Ir in Bn)Ir!=="value"&&!isReservedProp(Ir)&&xe(Tn,Ir,null,Bn[Ir],yn,ft.children,cn,an,ln);"value"in Bn&&xe(Tn,"value",null,Bn.value),(fn=Bn.onVnodeBeforeMount)&&invokeVNodeHook(fn,cn,ft)}Dt(Tn,ft,ft.scopeId,kn,cn)}xr&&invokeDirectiveHook(ft,null,cn,"beforeMount");const br=(!an||an&&!an.pendingBranch)&&Jn&&!Jn.persisted;br&&Jn.beforeEnter(Tn),_e(Tn,wt,qt),((fn=Bn&&Bn.onVnodeMounted)||br||xr)&&queuePostRenderEffect(()=>{fn&&invokeVNodeHook(fn,cn,ft),br&&Jn.enter(Tn),xr&&invokeDirectiveHook(ft,null,cn,"mounted")},an)},Dt=(ft,wt,qt,cn,an)=>{if(qt&&$e(ft,qt),cn)for(let yn=0;yn<cn.length;yn++)$e(ft,cn[yn]);if(an){let yn=an.subTree;if(wt===yn){const kn=an.vnode;Dt(ft,kn,kn.scopeId,kn.slotScopeIds,an.parent)}}},Gt=(ft,wt,qt,cn,an,yn,kn,en,Tn=0)=>{for(let fn=Tn;fn<ft.length;fn++){const Nn=ft[fn]=en?cloneIfMounted(ft[fn]):normalizeVNode(ft[fn]);Xe(null,Nn,wt,qt,cn,an,yn,kn,en)}},Ut=(ft,wt,qt,cn,an,yn,kn)=>{const en=wt.el=ft.el;let{patchFlag:Tn,dynamicChildren:fn,dirs:Nn}=wt;Tn|=ft.patchFlag&16;const Bn=ft.props||EMPTY_OBJ,Gn=wt.props||EMPTY_OBJ;let Jn;qt&&toggleRecurse(qt,!1),(Jn=Gn.onVnodeBeforeUpdate)&&invokeVNodeHook(Jn,qt,wt,ft),Nn&&invokeDirectiveHook(wt,ft,qt,"beforeUpdate"),qt&&toggleRecurse(qt,!0);const gr=an&&wt.type!=="foreignObject";if(fn?on(ft.dynamicChildren,fn,en,qt,cn,gr,yn):kn||Xn(ft,wt,en,null,qt,cn,gr,yn,!1),Tn>0){if(Tn&16)Vt(en,wt,Bn,Gn,qt,cn,an);else if(Tn&2&&Bn.class!==Gn.class&&xe(en,"class",null,Gn.class,an),Tn&4&&xe(en,"style",Bn.style,Gn.style,an),Tn&8){const xr=wt.dynamicProps;for(let br=0;br<xr.length;br++){const Ir=xr[br],gi=Bn[Ir],si=Gn[Ir];(si!==gi||Ir==="value")&&xe(en,Ir,gi,si,an,ft.children,qt,cn,ln)}}Tn&1&&ft.children!==wt.children&&Le(en,wt.children)}else!kn&&fn==null&&Vt(en,wt,Bn,Gn,qt,cn,an);((Jn=Gn.onVnodeUpdated)||Nn)&&queuePostRenderEffect(()=>{Jn&&invokeVNodeHook(Jn,qt,wt,ft),Nn&&invokeDirectiveHook(wt,ft,qt,"updated")},cn)},on=(ft,wt,qt,cn,an,yn,kn)=>{for(let en=0;en<wt.length;en++){const Tn=ft[en],fn=wt[en],Nn=Tn.el&&(Tn.type===Fragment||!isSameVNodeType(Tn,fn)||Tn.shapeFlag&70)?ze(Tn.el):qt;Xe(Tn,fn,Nn,null,cn,an,yn,kn,!0)}},Vt=(ft,wt,qt,cn,an,yn,kn)=>{if(qt!==cn){for(const en in cn){if(isReservedProp(en))continue;const Tn=cn[en],fn=qt[en];Tn!==fn&&en!=="value"&&xe(ft,en,fn,Tn,kn,wt.children,an,yn,ln)}if(qt!==EMPTY_OBJ)for(const en in qt)!isReservedProp(en)&&!(en in cn)&&xe(ft,en,qt[en],null,kn,wt.children,an,yn,ln);"value"in cn&&xe(ft,"value",qt.value,cn.value)}},An=(ft,wt,qt,cn,an,yn,kn,en,Tn)=>{const fn=wt.el=ft?ft.el:j(""),Nn=wt.anchor=ft?ft.anchor:j("");let{patchFlag:Bn,dynamicChildren:Gn,slotScopeIds:Jn}=wt;Jn&&(en=en?en.concat(Jn):Jn),ft==null?(_e(fn,qt,cn),_e(Nn,qt,cn),Gt(wt.children,qt,Nn,an,yn,kn,en,Tn)):Bn>0&&Bn&64&&Gn&&ft.dynamicChildren?(on(ft.dynamicChildren,Gn,qt,an,yn,kn,en),(wt.key!=null||an&&wt===an.subTree)&&traverseStaticChildren(ft,wt,!0)):Xn(ft,wt,qt,Nn,an,yn,kn,en,Tn)},_n=(ft,wt,qt,cn,an,yn,kn,en,Tn)=>{wt.slotScopeIds=en,ft==null?wt.shapeFlag&512?an.ctx.activate(wt,qt,cn,kn,Tn):Yn(wt,qt,cn,an,yn,kn,Tn):bn(ft,wt,Tn)},Yn=(ft,wt,qt,cn,an,yn,kn)=>{const en=ft.component=createComponentInstance(ft,cn,an);if(isKeepAlive(ft)&&(en.ctx.renderer=_r),setupComponent(en),en.asyncDep){if(an&&an.registerDep(en,Ln),!ft.el){const Tn=en.subTree=createVNode(Comment$1);Ct(null,Tn,wt,qt)}return}Ln(en,ft,wt,qt,an,yn,kn)},bn=(ft,wt,qt)=>{const cn=wt.component=ft.component;if(shouldUpdateComponent(ft,wt,qt))if(cn.asyncDep&&!cn.asyncResolved){mn(cn,wt,qt);return}else cn.next=wt,invalidateJob(cn.update),cn.update();else wt.component=ft.component,wt.el=ft.el,cn.vnode=wt},Ln=(ft,wt,qt,cn,an,yn,kn)=>{const en=()=>{if(ft.isMounted){let{next:Nn,bu:Bn,u:Gn,parent:Jn,vnode:gr}=ft,xr=Nn,br;toggleRecurse(ft,!1),Nn?(Nn.el=gr.el,mn(ft,Nn,kn)):Nn=gr,Bn&&invokeArrayFns(Bn),(br=Nn.props&&Nn.props.onVnodeBeforeUpdate)&&invokeVNodeHook(br,Jn,Nn,gr),toggleRecurse(ft,!0);const Ir=renderComponentRoot(ft),gi=ft.subTree;ft.subTree=Ir,Xe(gi,Ir,ze(gi.el),Un(gi),ft,an,yn),Nn.el=Ir.el,xr===null&&updateHOCHostEl(ft,Ir.el),Gn&&queuePostRenderEffect(Gn,an),(br=Nn.props&&Nn.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(br,Jn,Nn,gr),an)}else{let Nn;const{el:Bn,props:Gn}=wt,{bm:Jn,m:gr,parent:xr}=ft,br=isAsyncWrapper(wt);if(toggleRecurse(ft,!1),Jn&&invokeArrayFns(Jn),!br&&(Nn=Gn&&Gn.onVnodeBeforeMount)&&invokeVNodeHook(Nn,xr,wt),toggleRecurse(ft,!0),Bn&&tr){const Ir=()=>{ft.subTree=renderComponentRoot(ft),tr(Bn,ft.subTree,ft,an,null)};br?wt.type.__asyncLoader().then(()=>!ft.isUnmounted&&Ir()):Ir()}else{const Ir=ft.subTree=renderComponentRoot(ft);Xe(null,Ir,qt,cn,ft,an,yn),wt.el=Ir.el}if(gr&&queuePostRenderEffect(gr,an),!br&&(Nn=Gn&&Gn.onVnodeMounted)){const Ir=wt;queuePostRenderEffect(()=>invokeVNodeHook(Nn,xr,Ir),an)}wt.shapeFlag&256&&ft.a&&queuePostRenderEffect(ft.a,an),ft.isMounted=!0,wt=qt=cn=null}},Tn=ft.effect=new ReactiveEffect(en,()=>queueJob(ft.update),ft.scope),fn=ft.update=Tn.run.bind(Tn);fn.id=ft.uid,toggleRecurse(ft,!0),fn()},mn=(ft,wt,qt)=>{wt.component=ft;const cn=ft.vnode.props;ft.vnode=wt,ft.next=null,updateProps(ft,wt.props,cn,qt),updateSlots(ft,wt.children,qt),pauseTracking(),flushPreFlushCbs(void 0,ft.update),resetTracking()},Xn=(ft,wt,qt,cn,an,yn,kn,en,Tn=!1)=>{const fn=ft&&ft.children,Nn=ft?ft.shapeFlag:0,Bn=wt.children,{patchFlag:Gn,shapeFlag:Jn}=wt;if(Gn>0){if(Gn&128){Pr(fn,Bn,qt,cn,an,yn,kn,en,Tn);return}else if(Gn&256){sr(fn,Bn,qt,cn,an,yn,kn,en,Tn);return}}Jn&8?(Nn&16&&ln(fn,an,yn),Bn!==fn&&Le(qt,Bn)):Nn&16?Jn&16?Pr(fn,Bn,qt,cn,an,yn,kn,en,Tn):ln(fn,an,yn,!0):(Nn&8&&Le(qt,""),Jn&16&&Gt(Bn,qt,cn,an,yn,kn,en,Tn))},sr=(ft,wt,qt,cn,an,yn,kn,en,Tn)=>{ft=ft||EMPTY_ARR,wt=wt||EMPTY_ARR;const fn=ft.length,Nn=wt.length,Bn=Math.min(fn,Nn);let Gn;for(Gn=0;Gn<Bn;Gn++){const Jn=wt[Gn]=Tn?cloneIfMounted(wt[Gn]):normalizeVNode(wt[Gn]);Xe(ft[Gn],Jn,qt,null,an,yn,kn,en,Tn)}fn>Nn?ln(ft,an,yn,!0,!1,Bn):Gt(wt,qt,cn,an,yn,kn,en,Tn,Bn)},Pr=(ft,wt,qt,cn,an,yn,kn,en,Tn)=>{let fn=0;const Nn=wt.length;let Bn=ft.length-1,Gn=Nn-1;for(;fn<=Bn&&fn<=Gn;){const Jn=ft[fn],gr=wt[fn]=Tn?cloneIfMounted(wt[fn]):normalizeVNode(wt[fn]);if(isSameVNodeType(Jn,gr))Xe(Jn,gr,qt,null,an,yn,kn,en,Tn);else break;fn++}for(;fn<=Bn&&fn<=Gn;){const Jn=ft[Bn],gr=wt[Gn]=Tn?cloneIfMounted(wt[Gn]):normalizeVNode(wt[Gn]);if(isSameVNodeType(Jn,gr))Xe(Jn,gr,qt,null,an,yn,kn,en,Tn);else break;Bn--,Gn--}if(fn>Bn){if(fn<=Gn){const Jn=Gn+1,gr=Jn<Nn?wt[Jn].el:cn;for(;fn<=Gn;)Xe(null,wt[fn]=Tn?cloneIfMounted(wt[fn]):normalizeVNode(wt[fn]),qt,gr,an,yn,kn,en,Tn),fn++}}else if(fn>Gn)for(;fn<=Bn;)rr(ft[fn],an,yn,!0),fn++;else{const Jn=fn,gr=fn,xr=new Map;for(fn=gr;fn<=Gn;fn++){const li=wt[fn]=Tn?cloneIfMounted(wt[fn]):normalizeVNode(wt[fn]);li.key!=null&&xr.set(li.key,fn)}let br,Ir=0;const gi=Gn-gr+1;let si=!1,Ni=0;const ro=new Array(gi);for(fn=0;fn<gi;fn++)ro[fn]=0;for(fn=Jn;fn<=Bn;fn++){const li=ft[fn];if(Ir>=gi){rr(li,an,yn,!0);continue}let yi;if(li.key!=null)yi=xr.get(li.key);else for(br=gr;br<=Gn;br++)if(ro[br-gr]===0&&isSameVNodeType(li,wt[br])){yi=br;break}yi===void 0?rr(li,an,yn,!0):(ro[yi-gr]=fn+1,yi>=Ni?Ni=yi:si=!0,Xe(li,wt[yi],qt,null,an,yn,kn,en,Tn),Ir++)}const wo=si?getSequence(ro):EMPTY_ARR;for(br=wo.length-1,fn=gi-1;fn>=0;fn--){const li=gr+fn,yi=wt[li],To=li+1<Nn?wt[li+1].el:cn;ro[fn]===0?Xe(null,yi,qt,To,an,yn,kn,en,Tn):si&&(br<0||fn!==wo[br]?er(yi,qt,To,2):br--)}}},er=(ft,wt,qt,cn,an=null)=>{const{el:yn,type:kn,transition:en,children:Tn,shapeFlag:fn}=ft;if(fn&6){er(ft.component.subTree,wt,qt,cn);return}if(fn&128){ft.suspense.move(wt,qt,cn);return}if(fn&64){kn.move(ft,wt,qt,_r);return}if(kn===Fragment){_e(yn,wt,qt);for(let Bn=0;Bn<Tn.length;Bn++)er(Tn[Bn],wt,qt,cn);_e(ft.anchor,wt,qt);return}if(kn===Static){Ot(ft,wt,qt);return}if(cn!==2&&fn&1&&en)if(cn===0)en.beforeEnter(yn),_e(yn,wt,qt),queuePostRenderEffect(()=>en.enter(yn),an);else{const{leave:Bn,delayLeave:Gn,afterLeave:Jn}=en,gr=()=>_e(yn,wt,qt),xr=()=>{Bn(yn,()=>{gr(),Jn&&Jn()})};Gn?Gn(yn,gr,xr):xr()}else _e(yn,wt,qt)},rr=(ft,wt,qt,cn=!1,an=!1)=>{const{type:yn,props:kn,ref:en,children:Tn,dynamicChildren:fn,shapeFlag:Nn,patchFlag:Bn,dirs:Gn}=ft;if(en!=null&&setRef(en,null,qt,ft,!0),Nn&256){wt.ctx.deactivate(ft);return}const Jn=Nn&1&&Gn,gr=!isAsyncWrapper(ft);let xr;if(gr&&(xr=kn&&kn.onVnodeBeforeUnmount)&&invokeVNodeHook(xr,wt,ft),Nn&6)Rn(ft.component,qt,cn);else{if(Nn&128){ft.suspense.unmount(qt,cn);return}Jn&&invokeDirectiveHook(ft,null,wt,"beforeUnmount"),Nn&64?ft.type.remove(ft,wt,qt,an,_r,cn):fn&&(yn!==Fragment||Bn>0&&Bn&64)?ln(fn,wt,qt,!1,!0):(yn===Fragment&&Bn&384||!an&&Nn&16)&&ln(Tn,wt,qt),cn&&Vr(ft)}(gr&&(xr=kn&&kn.onVnodeUnmounted)||Jn)&&queuePostRenderEffect(()=>{xr&&invokeVNodeHook(xr,wt,ft),Jn&&invokeDirectiveHook(ft,null,wt,"unmounted")},qt)},Vr=ft=>{const{type:wt,el:qt,anchor:cn,transition:an}=ft;if(wt===Fragment){Wt(qt,cn);return}if(wt===Static){Mt(ft);return}const yn=()=>{de(qt),an&&!an.persisted&&an.afterLeave&&an.afterLeave()};if(ft.shapeFlag&1&&an&&!an.persisted){const{leave:kn,delayLeave:en}=an,Tn=()=>kn(qt,yn);en?en(ft.el,yn,Tn):Tn()}else yn()},Wt=(ft,wt)=>{let qt;for(;ft!==wt;)qt=Be(ft),de(ft),ft=qt;de(wt)},Rn=(ft,wt,qt)=>{const{bum:cn,scope:an,update:yn,subTree:kn,um:en}=ft;cn&&invokeArrayFns(cn),an.stop(),yn&&(yn.active=!1,rr(kn,ft,wt,qt)),en&&queuePostRenderEffect(en,wt),queuePostRenderEffect(()=>{ft.isUnmounted=!0},wt),wt&&wt.pendingBranch&&!wt.isUnmounted&&ft.asyncDep&&!ft.asyncResolved&&ft.suspenseId===wt.pendingId&&(wt.deps--,wt.deps===0&&wt.resolve())},ln=(ft,wt,qt,cn=!1,an=!1,yn=0)=>{for(let kn=yn;kn<ft.length;kn++)rr(ft[kn],wt,qt,cn,an)},Un=ft=>ft.shapeFlag&6?Un(ft.component.subTree):ft.shapeFlag&128?ft.suspense.next():Be(ft.anchor||ft.el),dr=(ft,wt,qt)=>{ft==null?wt._vnode&&rr(wt._vnode,null,null,!0):Xe(wt._vnode||null,ft,wt,null,null,null,qt),flushPostFlushCbs(),wt._vnode=ft},_r={p:Xe,um:rr,m:er,r:Vr,mt:Yn,mc:Gt,pc:Xn,pbc:on,n:Un,o:V};let pr,tr;return ee&&([pr,tr]=ee(_r)),{render:dr,hydrate:pr,createApp:createAppAPI(dr,pr)}}function toggleRecurse({effect:V,update:ee},ce){V.allowRecurse=ee.allowRecurse=ce}function traverseStaticChildren(V,ee,ce=!1){const _e=V.children,de=ee.children;if(isArray$1(_e)&&isArray$1(de))for(let xe=0;xe<_e.length;xe++){const Te=_e[xe];let j=de[xe];j.shapeFlag&1&&!j.dynamicChildren&&((j.patchFlag<=0||j.patchFlag===32)&&(j=de[xe]=cloneIfMounted(de[xe]),j.el=Te.el),ce||traverseStaticChildren(Te,j))}}function getSequence(V){const ee=V.slice(),ce=[0];let _e,de,xe,Te,j;const Ce=V.length;for(_e=0;_e<Ce;_e++){const Pe=V[_e];if(Pe!==0){if(de=ce[ce.length-1],V[de]<Pe){ee[_e]=de,ce.push(_e);continue}for(xe=0,Te=ce.length-1;xe<Te;)j=xe+Te>>1,V[ce[j]]<Pe?xe=j+1:Te=j;Pe<V[ce[xe]]&&(xe>0&&(ee[_e]=ce[xe-1]),ce[xe]=_e)}}for(xe=ce.length,Te=ce[xe-1];xe-- >0;)ce[xe]=Te,Te=ee[Te];return ce}const isTeleport=V=>V.__isTeleport,isTeleportDisabled=V=>V&&(V.disabled||V.disabled===""),isTargetSVG=V=>typeof SVGElement!="undefined"&&V instanceof SVGElement,resolveTarget=(V,ee)=>{const ce=V&&V.to;return isString$1(ce)?ee?ee(ce):null:ce},TeleportImpl={__isTeleport:!0,process(V,ee,ce,_e,de,xe,Te,j,Ce,Pe){const{mc:Le,pc:ze,pbc:Be,o:{insert:$e,querySelector:Ve,createText:Ke,createComment:Xe}}=Pe,It=isTeleportDisabled(ee.props);let{shapeFlag:Ct,children:yt,dynamicChildren:Ot}=ee;if(V==null){const Mt=ee.el=Ke(""),Pt=ee.anchor=Ke("");$e(Mt,ce,_e),$e(Pt,ce,_e);const At=ee.target=resolveTarget(ee.props,Ve),Dt=ee.targetAnchor=Ke("");At&&($e(Dt,At),Te=Te||isTargetSVG(At));const Gt=(Ut,on)=>{Ct&16&&Le(yt,Ut,on,de,xe,Te,j,Ce)};It?Gt(ce,Pt):At&&Gt(At,Dt)}else{ee.el=V.el;const Mt=ee.anchor=V.anchor,Pt=ee.target=V.target,At=ee.targetAnchor=V.targetAnchor,Dt=isTeleportDisabled(V.props),Gt=Dt?ce:Pt,Ut=Dt?Mt:At;if(Te=Te||isTargetSVG(Pt),Ot?(Be(V.dynamicChildren,Ot,Gt,de,xe,Te,j),traverseStaticChildren(V,ee,!0)):Ce||ze(V,ee,Gt,Ut,de,xe,Te,j,!1),It)Dt||moveTeleport(ee,ce,Mt,Pe,1);else if((ee.props&&ee.props.to)!==(V.props&&V.props.to)){const on=ee.target=resolveTarget(ee.props,Ve);on&&moveTeleport(ee,on,null,Pe,0)}else Dt&&moveTeleport(ee,Pt,At,Pe,1)}},remove(V,ee,ce,_e,{um:de,o:{remove:xe}},Te){const{shapeFlag:j,children:Ce,anchor:Pe,targetAnchor:Le,target:ze,props:Be}=V;if(ze&&xe(Le),(Te||!isTeleportDisabled(Be))&&(xe(Pe),j&16))for(let $e=0;$e<Ce.length;$e++){const Ve=Ce[$e];de(Ve,ee,ce,!0,!!Ve.dynamicChildren)}},move:moveTeleport,hydrate:hydrateTeleport};function moveTeleport(V,ee,ce,{o:{insert:_e},m:de},xe=2){xe===0&&_e(V.targetAnchor,ee,ce);const{el:Te,anchor:j,shapeFlag:Ce,children:Pe,props:Le}=V,ze=xe===2;if(ze&&_e(Te,ee,ce),(!ze||isTeleportDisabled(Le))&&Ce&16)for(let Be=0;Be<Pe.length;Be++)de(Pe[Be],ee,ce,2);ze&&_e(j,ee,ce)}function hydrateTeleport(V,ee,ce,_e,de,xe,{o:{nextSibling:Te,parentNode:j,querySelector:Ce}},Pe){const Le=ee.target=resolveTarget(ee.props,Ce);if(Le){const ze=Le._lpa||Le.firstChild;ee.shapeFlag&16&&(isTeleportDisabled(ee.props)?(ee.anchor=Pe(Te(V),ee,j(V),ce,_e,de,xe),ee.targetAnchor=ze):(ee.anchor=Te(V),ee.targetAnchor=Pe(ze,ee,Le,ce,_e,de,xe)),Le._lpa=ee.targetAnchor&&Te(ee.targetAnchor))}return ee.anchor&&Te(ee.anchor)}const Teleport=TeleportImpl,COMPONENTS="components",NULL_DYNAMIC_COMPONENT=Symbol();function resolveDynamicComponent(V){return isString$1(V)?resolveAsset(COMPONENTS,V,!1)||V:V||NULL_DYNAMIC_COMPONENT}function resolveAsset(V,ee,ce=!0,_e=!1){const de=currentRenderingInstance||currentInstance;if(de){const xe=de.type;if(V===COMPONENTS){const j=getComponentName(xe);if(j&&(j===ee||j===camelize(ee)||j===capitalize(camelize(ee))))return xe}const Te=resolve(de[V]||xe[V],ee)||resolve(de.appContext[V],ee);return!Te&&_e?xe:Te}}function resolve(V,ee){return V&&(V[ee]||V[camelize(ee)]||V[capitalize(camelize(ee))])}const Fragment=Symbol(void 0),Text=Symbol(void 0),Comment$1=Symbol(void 0),Static=Symbol(void 0),blockStack=[];let currentBlock=null;function openBlock(V=!1){blockStack.push(currentBlock=V?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(V){isBlockTreeEnabled+=V}function setupBlock(V){return V.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(V),V}function createElementBlock(V,ee,ce,_e,de,xe){return setupBlock(createBaseVNode(V,ee,ce,_e,de,xe,!0))}function createBlock(V,ee,ce,_e,de){return setupBlock(createVNode(V,ee,ce,_e,de,!0))}function isVNode(V){return V?V.__v_isVNode===!0:!1}function isSameVNodeType(V,ee){return V.type===ee.type&&V.key===ee.key}const InternalObjectKey="__vInternal",normalizeKey=({key:V})=>V!=null?V:null,normalizeRef=({ref:V,ref_key:ee,ref_for:ce})=>V!=null?isString$1(V)||isRef(V)||isFunction$2(V)?{i:currentRenderingInstance,r:V,k:ee,f:!!ce}:V:null;function createBaseVNode(V,ee=null,ce=null,_e=0,de=null,xe=V===Fragment?0:1,Te=!1,j=!1){const Ce={__v_isVNode:!0,__v_skip:!0,type:V,props:ee,key:ee&&normalizeKey(ee),ref:ee&&normalizeRef(ee),scopeId:currentScopeId,slotScopeIds:null,children:ce,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:xe,patchFlag:_e,dynamicProps:de,dynamicChildren:null,appContext:null};return j?(normalizeChildren(Ce,ce),xe&128&&V.normalize(Ce)):ce&&(Ce.shapeFlag|=isString$1(ce)?8:16),isBlockTreeEnabled>0&&!Te&&currentBlock&&(Ce.patchFlag>0||xe&6)&&Ce.patchFlag!==32&&currentBlock.push(Ce),Ce}const createVNode=_createVNode;function _createVNode(V,ee=null,ce=null,_e=0,de=null,xe=!1){if((!V||V===NULL_DYNAMIC_COMPONENT)&&(V=Comment$1),isVNode(V)){const j=cloneVNode(V,ee,!0);return ce&&normalizeChildren(j,ce),j}if(isClassComponent(V)&&(V=V.__vccOpts),ee){ee=guardReactiveProps(ee);let{class:j,style:Ce}=ee;j&&!isString$1(j)&&(ee.class=normalizeClass(j)),isObject$1(Ce)&&(isProxy$1(Ce)&&!isArray$1(Ce)&&(Ce=extend$1({},Ce)),ee.style=normalizeStyle(Ce))}const Te=isString$1(V)?1:isSuspense(V)?128:isTeleport(V)?64:isObject$1(V)?4:isFunction$2(V)?2:0;return createBaseVNode(V,ee,ce,_e,de,Te,xe,!0)}function guardReactiveProps(V){return V?isProxy$1(V)||InternalObjectKey in V?extend$1({},V):V:null}function cloneVNode(V,ee,ce=!1){const{props:_e,ref:de,patchFlag:xe,children:Te}=V,j=ee?mergeProps(_e||{},ee):_e;return{__v_isVNode:!0,__v_skip:!0,type:V.type,props:j,key:j&&normalizeKey(j),ref:ee&&ee.ref?ce&&de?isArray$1(de)?de.concat(normalizeRef(ee)):[de,normalizeRef(ee)]:normalizeRef(ee):de,scopeId:V.scopeId,slotScopeIds:V.slotScopeIds,children:Te,target:V.target,targetAnchor:V.targetAnchor,staticCount:V.staticCount,shapeFlag:V.shapeFlag,patchFlag:ee&&V.type!==Fragment?xe===-1?16:xe|16:xe,dynamicProps:V.dynamicProps,dynamicChildren:V.dynamicChildren,appContext:V.appContext,dirs:V.dirs,transition:V.transition,component:V.component,suspense:V.suspense,ssContent:V.ssContent&&cloneVNode(V.ssContent),ssFallback:V.ssFallback&&cloneVNode(V.ssFallback),el:V.el,anchor:V.anchor}}function createTextVNode(V=" ",ee=0){return createVNode(Text,null,V,ee)}function createStaticVNode(V,ee){const ce=createVNode(Static,null,V);return ce.staticCount=ee,ce}function createCommentVNode(V="",ee=!1){return ee?(openBlock(),createBlock(Comment$1,null,V)):createVNode(Comment$1,null,V)}function normalizeVNode(V){return V==null||typeof V=="boolean"?createVNode(Comment$1):isArray$1(V)?createVNode(Fragment,null,V.slice()):typeof V=="object"?cloneIfMounted(V):createVNode(Text,null,String(V))}function cloneIfMounted(V){return V.el===null||V.memo?V:cloneVNode(V)}function normalizeChildren(V,ee){let ce=0;const{shapeFlag:_e}=V;if(ee==null)ee=null;else if(isArray$1(ee))ce=16;else if(typeof ee=="object")if(_e&65){const de=ee.default;de&&(de._c&&(de._d=!1),normalizeChildren(V,de()),de._c&&(de._d=!0));return}else{ce=32;const de=ee._;!de&&!(InternalObjectKey in ee)?ee._ctx=currentRenderingInstance:de===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?ee._=1:(ee._=2,V.patchFlag|=1024))}else isFunction$2(ee)?(ee={default:ee,_ctx:currentRenderingInstance},ce=32):(ee=String(ee),_e&64?(ce=16,ee=[createTextVNode(ee)]):ce=8);V.children=ee,V.shapeFlag|=ce}function mergeProps(...V){const ee={};for(let ce=0;ce<V.length;ce++){const _e=V[ce];for(const de in _e)if(de==="class")ee.class!==_e.class&&(ee.class=normalizeClass([ee.class,_e.class]));else if(de==="style")ee.style=normalizeStyle([ee.style,_e.style]);else if(isOn(de)){const xe=ee[de],Te=_e[de];Te&&xe!==Te&&!(isArray$1(xe)&&xe.includes(Te))&&(ee[de]=xe?[].concat(xe,Te):Te)}else de!==""&&(ee[de]=_e[de])}return ee}function invokeVNodeHook(V,ee,ce,_e=null){callWithAsyncErrorHandling(V,ee,7,[ce,_e])}function renderList(V,ee,ce,_e){let de;const xe=ce&&ce[_e];if(isArray$1(V)||isString$1(V)){de=new Array(V.length);for(let Te=0,j=V.length;Te<j;Te++)de[Te]=ee(V[Te],Te,void 0,xe&&xe[Te])}else if(typeof V=="number"){de=new Array(V);for(let Te=0;Te<V;Te++)de[Te]=ee(Te+1,Te,void 0,xe&&xe[Te])}else if(isObject$1(V))if(V[Symbol.iterator])de=Array.from(V,(Te,j)=>ee(Te,j,void 0,xe&&xe[j]));else{const Te=Object.keys(V);de=new Array(Te.length);for(let j=0,Ce=Te.length;j<Ce;j++){const Pe=Te[j];de[j]=ee(V[Pe],Pe,j,xe&&xe[j])}}else de=[];return ce&&(ce[_e]=de),de}const getPublicInstance=V=>V?isStatefulComponent(V)?getExposeProxy(V)||V.proxy:getPublicInstance(V.parent):null,publicPropertiesMap=extend$1(Object.create(null),{$:V=>V,$el:V=>V.vnode.el,$data:V=>V.data,$props:V=>V.props,$attrs:V=>V.attrs,$slots:V=>V.slots,$refs:V=>V.refs,$parent:V=>getPublicInstance(V.parent),$root:V=>getPublicInstance(V.root),$emit:V=>V.emit,$options:V=>resolveMergedOptions(V),$forceUpdate:V=>()=>queueJob(V.update),$nextTick:V=>nextTick.bind(V.proxy),$watch:V=>instanceWatch.bind(V)}),PublicInstanceProxyHandlers={get({_:V},ee){const{ctx:ce,setupState:_e,data:de,props:xe,accessCache:Te,type:j,appContext:Ce}=V;let Pe;if(ee[0]!=="$"){const $e=Te[ee];if($e!==void 0)switch($e){case 1:return _e[ee];case 2:return de[ee];case 4:return ce[ee];case 3:return xe[ee]}else{if(_e!==EMPTY_OBJ&&hasOwn(_e,ee))return Te[ee]=1,_e[ee];if(de!==EMPTY_OBJ&&hasOwn(de,ee))return Te[ee]=2,de[ee];if((Pe=V.propsOptions[0])&&hasOwn(Pe,ee))return Te[ee]=3,xe[ee];if(ce!==EMPTY_OBJ&&hasOwn(ce,ee))return Te[ee]=4,ce[ee];shouldCacheAccess&&(Te[ee]=0)}}const Le=publicPropertiesMap[ee];let ze,Be;if(Le)return ee==="$attrs"&&track(V,"get",ee),Le(V);if((ze=j.__cssModules)&&(ze=ze[ee]))return ze;if(ce!==EMPTY_OBJ&&hasOwn(ce,ee))return Te[ee]=4,ce[ee];if(Be=Ce.config.globalProperties,hasOwn(Be,ee))return Be[ee]},set({_:V},ee,ce){const{data:_e,setupState:de,ctx:xe}=V;return de!==EMPTY_OBJ&&hasOwn(de,ee)?(de[ee]=ce,!0):_e!==EMPTY_OBJ&&hasOwn(_e,ee)?(_e[ee]=ce,!0):hasOwn(V.props,ee)||ee[0]==="$"&&ee.slice(1)in V?!1:(xe[ee]=ce,!0)},has({_:{data:V,setupState:ee,accessCache:ce,ctx:_e,appContext:de,propsOptions:xe}},Te){let j;return!!ce[Te]||V!==EMPTY_OBJ&&hasOwn(V,Te)||ee!==EMPTY_OBJ&&hasOwn(ee,Te)||(j=xe[0])&&hasOwn(j,Te)||hasOwn(_e,Te)||hasOwn(publicPropertiesMap,Te)||hasOwn(de.config.globalProperties,Te)},defineProperty(V,ee,ce){return ce.get!=null?this.set(V,ee,ce.get(),null):ce.value!=null&&this.set(V,ee,ce.value,null),Reflect.defineProperty(V,ee,ce)}},emptyAppContext=createAppContext();let uid$1=0;function createComponentInstance(V,ee,ce){const _e=V.type,de=(ee?ee.appContext:V.appContext)||emptyAppContext,xe={uid:uid$1++,vnode:V,type:_e,parent:ee,appContext:de,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:ee?ee.provides:Object.create(de.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(_e,de),emitsOptions:normalizeEmitsOptions(_e,de),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:_e.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:ce,suspenseId:ce?ce.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return xe.ctx={_:xe},xe.root=ee?ee.root:xe,xe.emit=emit$1.bind(null,xe),V.ce&&V.ce(xe),xe}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance,setCurrentInstance=V=>{currentInstance=V,V.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),currentInstance=null};function isStatefulComponent(V){return V.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(V,ee=!1){isInSSRComponentSetup=ee;const{props:ce,children:_e}=V.vnode,de=isStatefulComponent(V);initProps(V,ce,de,ee),initSlots(V,_e);const xe=de?setupStatefulComponent(V,ee):void 0;return isInSSRComponentSetup=!1,xe}function setupStatefulComponent(V,ee){const ce=V.type;V.accessCache=Object.create(null),V.proxy=markRaw(new Proxy(V.ctx,PublicInstanceProxyHandlers));const{setup:_e}=ce;if(_e){const de=V.setupContext=_e.length>1?createSetupContext(V):null;setCurrentInstance(V),pauseTracking();const xe=callWithErrorHandling(_e,V,0,[V.props,de]);if(resetTracking(),unsetCurrentInstance(),isPromise(xe)){if(xe.then(unsetCurrentInstance,unsetCurrentInstance),ee)return xe.then(Te=>{handleSetupResult(V,Te,ee)}).catch(Te=>{handleError(Te,V,0)});V.asyncDep=xe}else handleSetupResult(V,xe,ee)}else finishComponentSetup(V,ee)}function handleSetupResult(V,ee,ce){isFunction$2(ee)?V.type.__ssrInlineRender?V.ssrRender=ee:V.render=ee:isObject$1(ee)&&(V.setupState=proxyRefs(ee)),finishComponentSetup(V,ce)}let compile;function finishComponentSetup(V,ee,ce){const _e=V.type;if(!V.render){if(!ee&&compile&&!_e.render){const de=_e.template;if(de){const{isCustomElement:xe,compilerOptions:Te}=V.appContext.config,{delimiters:j,compilerOptions:Ce}=_e,Pe=extend$1(extend$1({isCustomElement:xe,delimiters:j},Te),Ce);_e.render=compile(de,Pe)}}V.render=_e.render||NOOP}setCurrentInstance(V),pauseTracking(),applyOptions(V),resetTracking(),unsetCurrentInstance()}function createAttrsProxy(V){return new Proxy(V.attrs,{get(ee,ce){return track(V,"get","$attrs"),ee[ce]}})}function createSetupContext(V){const ee=_e=>{V.exposed=_e||{}};let ce;return{get attrs(){return ce||(ce=createAttrsProxy(V))},slots:V.slots,emit:V.emit,expose:ee}}function getExposeProxy(V){if(V.exposed)return V.exposeProxy||(V.exposeProxy=new Proxy(proxyRefs(markRaw(V.exposed)),{get(ee,ce){if(ce in ee)return ee[ce];if(ce in publicPropertiesMap)return publicPropertiesMap[ce](V)}}))}function getComponentName(V){return isFunction$2(V)&&V.displayName||V.name}function isClassComponent(V){return isFunction$2(V)&&"__vccOpts"in V}const computed=(V,ee)=>computed$1(V,ee,isInSSRComponentSetup);function withAsyncContext(V){const ee=getCurrentInstance();let ce=V();return unsetCurrentInstance(),isPromise(ce)&&(ce=ce.catch(_e=>{throw setCurrentInstance(ee),_e})),[ce,()=>setCurrentInstance(ee)]}function h$3(V,ee,ce){const _e=arguments.length;return _e===2?isObject$1(ee)&&!isArray$1(ee)?isVNode(ee)?createVNode(V,null,[ee]):createVNode(V,ee):createVNode(V,null,ee):(_e>3?ce=Array.prototype.slice.call(arguments,2):_e===3&&isVNode(ce)&&(ce=[ce]),createVNode(V,ee,ce))}const version="3.2.31",svgNS="http://www.w3.org/2000/svg",doc=typeof document!="undefined"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(V,ee,ce)=>{ee.insertBefore(V,ce||null)},remove:V=>{const ee=V.parentNode;ee&&ee.removeChild(V)},createElement:(V,ee,ce,_e)=>{const de=ee?doc.createElementNS(svgNS,V):doc.createElement(V,ce?{is:ce}:void 0);return V==="select"&&_e&&_e.multiple!=null&&de.setAttribute("multiple",_e.multiple),de},createText:V=>doc.createTextNode(V),createComment:V=>doc.createComment(V),setText:(V,ee)=>{V.nodeValue=ee},setElementText:(V,ee)=>{V.textContent=ee},parentNode:V=>V.parentNode,nextSibling:V=>V.nextSibling,querySelector:V=>doc.querySelector(V),setScopeId(V,ee){V.setAttribute(ee,"")},cloneNode(V){const ee=V.cloneNode(!0);return"_value"in V&&(ee._value=V._value),ee},insertStaticContent(V,ee,ce,_e,de,xe){const Te=ce?ce.previousSibling:ee.lastChild;if(de&&(de===xe||de.nextSibling))for(;ee.insertBefore(de.cloneNode(!0),ce),!(de===xe||!(de=de.nextSibling)););else{templateContainer.innerHTML=_e?`<svg>${V}</svg>`:V;const j=templateContainer.content;if(_e){const Ce=j.firstChild;for(;Ce.firstChild;)j.appendChild(Ce.firstChild);j.removeChild(Ce)}ee.insertBefore(j,ce)}return[Te?Te.nextSibling:ee.firstChild,ce?ce.previousSibling:ee.lastChild]}};function patchClass(V,ee,ce){const _e=V._vtc;_e&&(ee=(ee?[ee,..._e]:[..._e]).join(" ")),ee==null?V.removeAttribute("class"):ce?V.setAttribute("class",ee):V.className=ee}function patchStyle(V,ee,ce){const _e=V.style,de=isString$1(ce);if(ce&&!de){for(const xe in ce)setStyle(_e,xe,ce[xe]);if(ee&&!isString$1(ee))for(const xe in ee)ce[xe]==null&&setStyle(_e,xe,"")}else{const xe=_e.display;de?ee!==ce&&(_e.cssText=ce):ee&&V.removeAttribute("style"),"_vod"in V&&(_e.display=xe)}}const importantRE=/\s*!important$/;function setStyle(V,ee,ce){if(isArray$1(ce))ce.forEach(_e=>setStyle(V,ee,_e));else if(ee.startsWith("--"))V.setProperty(ee,ce);else{const _e=autoPrefix(V,ee);importantRE.test(ce)?V.setProperty(hyphenate(_e),ce.replace(importantRE,""),"important"):V[_e]=ce}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(V,ee){const ce=prefixCache[ee];if(ce)return ce;let _e=camelize(ee);if(_e!=="filter"&&_e in V)return prefixCache[ee]=_e;_e=capitalize(_e);for(let de=0;de<prefixes.length;de++){const xe=prefixes[de]+_e;if(xe in V)return prefixCache[ee]=xe}return ee}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(V,ee,ce,_e,de){if(_e&&ee.startsWith("xlink:"))ce==null?V.removeAttributeNS(xlinkNS,ee.slice(6,ee.length)):V.setAttributeNS(xlinkNS,ee,ce);else{const xe=isSpecialBooleanAttr(ee);ce==null||xe&&!includeBooleanAttr(ce)?V.removeAttribute(ee):V.setAttribute(ee,xe?"":ce)}}function patchDOMProp(V,ee,ce,_e,de,xe,Te){if(ee==="innerHTML"||ee==="textContent"){_e&&Te(_e,de,xe),V[ee]=ce==null?"":ce;return}if(ee==="value"&&V.tagName!=="PROGRESS"&&!V.tagName.includes("-")){V._value=ce;const j=ce==null?"":ce;(V.value!==j||V.tagName==="OPTION")&&(V.value=j),ce==null&&V.removeAttribute(ee);return}if(ce===""||ce==null){const j=typeof V[ee];if(j==="boolean"){V[ee]=includeBooleanAttr(ce);return}else if(ce==null&&j==="string"){V[ee]="",V.removeAttribute(ee);return}else if(j==="number"){try{V[ee]=0}catch{}V.removeAttribute(ee);return}}try{V[ee]=ce}catch{}}let _getNow=Date.now,skipTimestampCheck=!1;if(typeof window!="undefined"){_getNow()>document.createEvent("Event").timeStamp&&(_getNow=()=>performance.now());const V=navigator.userAgent.match(/firefox\/(\d+)/i);skipTimestampCheck=!!(V&&Number(V[1])<=53)}let cachedNow=0;const p$5=Promise.resolve(),reset=()=>{cachedNow=0},getNow=()=>cachedNow||(p$5.then(reset),cachedNow=_getNow());function addEventListener(V,ee,ce,_e){V.addEventListener(ee,ce,_e)}function removeEventListener(V,ee,ce,_e){V.removeEventListener(ee,ce,_e)}function patchEvent(V,ee,ce,_e,de=null){const xe=V._vei||(V._vei={}),Te=xe[ee];if(_e&&Te)Te.value=_e;else{const[j,Ce]=parseName(ee);if(_e){const Pe=xe[ee]=createInvoker(_e,de);addEventListener(V,j,Pe,Ce)}else Te&&(removeEventListener(V,j,Te,Ce),xe[ee]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(V){let ee;if(optionsModifierRE.test(V)){ee={};let ce;for(;ce=V.match(optionsModifierRE);)V=V.slice(0,V.length-ce[0].length),ee[ce[0].toLowerCase()]=!0}return[hyphenate(V.slice(2)),ee]}function createInvoker(V,ee){const ce=_e=>{const de=_e.timeStamp||_getNow();(skipTimestampCheck||de>=ce.attached-1)&&callWithAsyncErrorHandling(patchStopImmediatePropagation(_e,ce.value),ee,5,[_e])};return ce.value=V,ce.attached=getNow(),ce}function patchStopImmediatePropagation(V,ee){if(isArray$1(ee)){const ce=V.stopImmediatePropagation;return V.stopImmediatePropagation=()=>{ce.call(V),V._stopped=!0},ee.map(_e=>de=>!de._stopped&&_e&&_e(de))}else return ee}const nativeOnRE=/^on[a-z]/,patchProp=(V,ee,ce,_e,de=!1,xe,Te,j,Ce)=>{ee==="class"?patchClass(V,_e,de):ee==="style"?patchStyle(V,ce,_e):isOn(ee)?isModelListener(ee)||patchEvent(V,ee,ce,_e,Te):(ee[0]==="."?(ee=ee.slice(1),!0):ee[0]==="^"?(ee=ee.slice(1),!1):shouldSetAsProp(V,ee,_e,de))?patchDOMProp(V,ee,_e,xe,Te,j,Ce):(ee==="true-value"?V._trueValue=_e:ee==="false-value"&&(V._falseValue=_e),patchAttr(V,ee,_e,de))};function shouldSetAsProp(V,ee,ce,_e){return _e?!!(ee==="innerHTML"||ee==="textContent"||ee in V&&nativeOnRE.test(ee)&&isFunction$2(ce)):ee==="spellcheck"||ee==="draggable"||ee==="form"||ee==="list"&&V.tagName==="INPUT"||ee==="type"&&V.tagName==="TEXTAREA"||nativeOnRE.test(ee)&&isString$1(ce)?!1:ee in V}const TRANSITION="transition",ANIMATION="animation",Transition=(V,{slots:ee})=>h$3(BaseTransition,resolveTransitionProps(V),ee);Transition.displayName="Transition";const DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Transition.props=extend$1({},BaseTransition.props,DOMTransitionPropsValidators);const callHook=(V,ee=[])=>{isArray$1(V)?V.forEach(ce=>ce(...ee)):V&&V(...ee)},hasExplicitCallback=V=>V?isArray$1(V)?V.some(ee=>ee.length>1):V.length>1:!1;function resolveTransitionProps(V){const ee={};for(const Vt in V)Vt in DOMTransitionPropsValidators||(ee[Vt]=V[Vt]);if(V.css===!1)return ee;const{name:ce="v",type:_e,duration:de,enterFromClass:xe=`${ce}-enter-from`,enterActiveClass:Te=`${ce}-enter-active`,enterToClass:j=`${ce}-enter-to`,appearFromClass:Ce=xe,appearActiveClass:Pe=Te,appearToClass:Le=j,leaveFromClass:ze=`${ce}-leave-from`,leaveActiveClass:Be=`${ce}-leave-active`,leaveToClass:$e=`${ce}-leave-to`}=V,Ve=normalizeDuration(de),Ke=Ve&&Ve[0],Xe=Ve&&Ve[1],{onBeforeEnter:It,onEnter:Ct,onEnterCancelled:yt,onLeave:Ot,onLeaveCancelled:Mt,onBeforeAppear:Pt=It,onAppear:At=Ct,onAppearCancelled:Dt=yt}=ee,Gt=(Vt,An,_n)=>{removeTransitionClass(Vt,An?Le:j),removeTransitionClass(Vt,An?Pe:Te),_n&&_n()},Ut=(Vt,An)=>{removeTransitionClass(Vt,$e),removeTransitionClass(Vt,Be),An&&An()},on=Vt=>(An,_n)=>{const Yn=Vt?At:Ct,bn=()=>Gt(An,Vt,_n);callHook(Yn,[An,bn]),nextFrame(()=>{removeTransitionClass(An,Vt?Ce:xe),addTransitionClass(An,Vt?Le:j),hasExplicitCallback(Yn)||whenTransitionEnds(An,_e,Ke,bn)})};return extend$1(ee,{onBeforeEnter(Vt){callHook(It,[Vt]),addTransitionClass(Vt,xe),addTransitionClass(Vt,Te)},onBeforeAppear(Vt){callHook(Pt,[Vt]),addTransitionClass(Vt,Ce),addTransitionClass(Vt,Pe)},onEnter:on(!1),onAppear:on(!0),onLeave(Vt,An){const _n=()=>Ut(Vt,An);addTransitionClass(Vt,ze),forceReflow(),addTransitionClass(Vt,Be),nextFrame(()=>{removeTransitionClass(Vt,ze),addTransitionClass(Vt,$e),hasExplicitCallback(Ot)||whenTransitionEnds(Vt,_e,Xe,_n)}),callHook(Ot,[Vt,_n])},onEnterCancelled(Vt){Gt(Vt,!1),callHook(yt,[Vt])},onAppearCancelled(Vt){Gt(Vt,!0),callHook(Dt,[Vt])},onLeaveCancelled(Vt){Ut(Vt),callHook(Mt,[Vt])}})}function normalizeDuration(V){if(V==null)return null;if(isObject$1(V))return[NumberOf(V.enter),NumberOf(V.leave)];{const ee=NumberOf(V);return[ee,ee]}}function NumberOf(V){return toNumber(V)}function addTransitionClass(V,ee){ee.split(/\s+/).forEach(ce=>ce&&V.classList.add(ce)),(V._vtc||(V._vtc=new Set)).add(ee)}function removeTransitionClass(V,ee){ee.split(/\s+/).forEach(_e=>_e&&V.classList.remove(_e));const{_vtc:ce}=V;ce&&(ce.delete(ee),ce.size||(V._vtc=void 0))}function nextFrame(V){requestAnimationFrame(()=>{requestAnimationFrame(V)})}let endId=0;function whenTransitionEnds(V,ee,ce,_e){const de=V._endId=++endId,xe=()=>{de===V._endId&&_e()};if(ce)return setTimeout(xe,ce);const{type:Te,timeout:j,propCount:Ce}=getTransitionInfo(V,ee);if(!Te)return _e();const Pe=Te+"end";let Le=0;const ze=()=>{V.removeEventListener(Pe,Be),xe()},Be=$e=>{$e.target===V&&++Le>=Ce&&ze()};setTimeout(()=>{Le<Ce&&ze()},j+1),V.addEventListener(Pe,Be)}function getTransitionInfo(V,ee){const ce=window.getComputedStyle(V),_e=Ve=>(ce[Ve]||"").split(", "),de=_e(TRANSITION+"Delay"),xe=_e(TRANSITION+"Duration"),Te=getTimeout(de,xe),j=_e(ANIMATION+"Delay"),Ce=_e(ANIMATION+"Duration"),Pe=getTimeout(j,Ce);let Le=null,ze=0,Be=0;ee===TRANSITION?Te>0&&(Le=TRANSITION,ze=Te,Be=xe.length):ee===ANIMATION?Pe>0&&(Le=ANIMATION,ze=Pe,Be=Ce.length):(ze=Math.max(Te,Pe),Le=ze>0?Te>Pe?TRANSITION:ANIMATION:null,Be=Le?Le===TRANSITION?xe.length:Ce.length:0);const $e=Le===TRANSITION&&/\b(transform|all)(,|$)/.test(ce[TRANSITION+"Property"]);return{type:Le,timeout:ze,propCount:Be,hasTransform:$e}}function getTimeout(V,ee){for(;V.length<ee.length;)V=V.concat(V);return Math.max(...ee.map((ce,_e)=>toMs(ce)+toMs(V[_e])))}function toMs(V){return Number(V.slice(0,-1).replace(",","."))*1e3}function forceReflow(){return document.body.offsetHeight}const getModelAssigner=V=>{const ee=V.props["onUpdate:modelValue"];return isArray$1(ee)?ce=>invokeArrayFns(ee,ce):ee};function onCompositionStart(V){V.target.composing=!0}function onCompositionEnd(V){const ee=V.target;ee.composing&&(ee.composing=!1,trigger(ee,"input"))}function trigger(V,ee){const ce=document.createEvent("HTMLEvents");ce.initEvent(ee,!0,!0),V.dispatchEvent(ce)}const vModelText={created(V,{modifiers:{lazy:ee,trim:ce,number:_e}},de){V._assign=getModelAssigner(de);const xe=_e||de.props&&de.props.type==="number";addEventListener(V,ee?"change":"input",Te=>{if(Te.target.composing)return;let j=V.value;ce?j=j.trim():xe&&(j=toNumber(j)),V._assign(j)}),ce&&addEventListener(V,"change",()=>{V.value=V.value.trim()}),ee||(addEventListener(V,"compositionstart",onCompositionStart),addEventListener(V,"compositionend",onCompositionEnd),addEventListener(V,"change",onCompositionEnd))},mounted(V,{value:ee}){V.value=ee==null?"":ee},beforeUpdate(V,{value:ee,modifiers:{lazy:ce,trim:_e,number:de}},xe){if(V._assign=getModelAssigner(xe),V.composing||document.activeElement===V&&(ce||_e&&V.value.trim()===ee||(de||V.type==="number")&&toNumber(V.value)===ee))return;const Te=ee==null?"":ee;V.value!==Te&&(V.value=Te)}},rendererOptions=extend$1({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...V)=>{const ee=ensureRenderer().createApp(...V),{mount:ce}=ee;return ee.mount=_e=>{const de=normalizeContainer(_e);if(!de)return;const xe=ee._component;!isFunction$2(xe)&&!xe.render&&!xe.template&&(xe.template=de.innerHTML),de.innerHTML="";const Te=ce(de,!1,de instanceof SVGElement);return de instanceof Element&&(de.removeAttribute("v-cloak"),de.setAttribute("data-v-app","")),Te},ee};function normalizeContainer(V){return isString$1(V)?document.querySelector(V):V}/*!
  * vue-router v4.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const hasSymbol=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",PolySymbol=V=>hasSymbol?Symbol(V):"_vr_"+V,matchedRouteKey=PolySymbol("rvlm"),viewDepthKey=PolySymbol("rvd"),routerKey=PolySymbol("r"),routeLocationKey=PolySymbol("rl"),routerViewLocationKey=PolySymbol("rvl"),isBrowser$1=typeof window!="undefined";function isESModule(V){return V.__esModule||hasSymbol&&V[Symbol.toStringTag]==="Module"}const assign$1=Object.assign;function applyToParams(V,ee){const ce={};for(const _e in ee){const de=ee[_e];ce[_e]=Array.isArray(de)?de.map(V):V(de)}return ce}const noop$1=()=>{},TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=V=>V.replace(TRAILING_SLASH_RE,"");function parseURL(V,ee,ce="/"){let _e,de={},xe="",Te="";const j=ee.indexOf("?"),Ce=ee.indexOf("#",j>-1?j:0);return j>-1&&(_e=ee.slice(0,j),xe=ee.slice(j+1,Ce>-1?Ce:ee.length),de=V(xe)),Ce>-1&&(_e=_e||ee.slice(0,Ce),Te=ee.slice(Ce,ee.length)),_e=resolveRelativePath(_e!=null?_e:ee,ce),{fullPath:_e+(xe&&"?")+xe+Te,path:_e,query:de,hash:Te}}function stringifyURL(V,ee){const ce=ee.query?V(ee.query):"";return ee.path+(ce&&"?")+ce+(ee.hash||"")}function stripBase(V,ee){return!ee||!V.toLowerCase().startsWith(ee.toLowerCase())?V:V.slice(ee.length)||"/"}function isSameRouteLocation(V,ee,ce){const _e=ee.matched.length-1,de=ce.matched.length-1;return _e>-1&&_e===de&&isSameRouteRecord(ee.matched[_e],ce.matched[de])&&isSameRouteLocationParams(ee.params,ce.params)&&V(ee.query)===V(ce.query)&&ee.hash===ce.hash}function isSameRouteRecord(V,ee){return(V.aliasOf||V)===(ee.aliasOf||ee)}function isSameRouteLocationParams(V,ee){if(Object.keys(V).length!==Object.keys(ee).length)return!1;for(const ce in V)if(!isSameRouteLocationParamsValue(V[ce],ee[ce]))return!1;return!0}function isSameRouteLocationParamsValue(V,ee){return Array.isArray(V)?isEquivalentArray(V,ee):Array.isArray(ee)?isEquivalentArray(ee,V):V===ee}function isEquivalentArray(V,ee){return Array.isArray(ee)?V.length===ee.length&&V.every((ce,_e)=>ce===ee[_e]):V.length===1&&V[0]===ee}function resolveRelativePath(V,ee){if(V.startsWith("/"))return V;if(!V)return ee;const ce=ee.split("/"),_e=V.split("/");let de=ce.length-1,xe,Te;for(xe=0;xe<_e.length;xe++)if(Te=_e[xe],!(de===1||Te==="."))if(Te==="..")de--;else break;return ce.slice(0,de).join("/")+"/"+_e.slice(xe-(xe===_e.length?1:0)).join("/")}var NavigationType;(function(V){V.pop="pop",V.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(V){V.back="back",V.forward="forward",V.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(V){if(!V)if(isBrowser$1){const ee=document.querySelector("base");V=ee&&ee.getAttribute("href")||"/",V=V.replace(/^\w+:\/\/[^\/]+/,"")}else V="/";return V[0]!=="/"&&V[0]!=="#"&&(V="/"+V),removeTrailingSlash(V)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(V,ee){return V.replace(BEFORE_HASH_RE,"#")+ee}function getElementPosition(V,ee){const ce=document.documentElement.getBoundingClientRect(),_e=V.getBoundingClientRect();return{behavior:ee.behavior,left:_e.left-ce.left-(ee.left||0),top:_e.top-ce.top-(ee.top||0)}}const computeScrollPosition=()=>({left:window.pageXOffset,top:window.pageYOffset});function scrollToPosition(V){let ee;if("el"in V){const ce=V.el,_e=typeof ce=="string"&&ce.startsWith("#"),de=typeof ce=="string"?_e?document.getElementById(ce.slice(1)):document.querySelector(ce):ce;if(!de)return;ee=getElementPosition(de,V)}else ee=V;"scrollBehavior"in document.documentElement.style?window.scrollTo(ee):window.scrollTo(ee.left!=null?ee.left:window.pageXOffset,ee.top!=null?ee.top:window.pageYOffset)}function getScrollKey(V,ee){return(history.state?history.state.position-ee:-1)+V}const scrollPositions=new Map;function saveScrollPosition(V,ee){scrollPositions.set(V,ee)}function getSavedScrollPosition(V){const ee=scrollPositions.get(V);return scrollPositions.delete(V),ee}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(V,ee){const{pathname:ce,search:_e,hash:de}=ee,xe=V.indexOf("#");if(xe>-1){let j=de.includes(V.slice(xe))?V.slice(xe).length:1,Ce=de.slice(j);return Ce[0]!=="/"&&(Ce="/"+Ce),stripBase(Ce,"")}return stripBase(ce,V)+_e+de}function useHistoryListeners(V,ee,ce,_e){let de=[],xe=[],Te=null;const j=({state:Be})=>{const $e=createCurrentLocation(V,location),Ve=ce.value,Ke=ee.value;let Xe=0;if(Be){if(ce.value=$e,ee.value=Be,Te&&Te===Ve){Te=null;return}Xe=Ke?Be.position-Ke.position:0}else _e($e);de.forEach(It=>{It(ce.value,Ve,{delta:Xe,type:NavigationType.pop,direction:Xe?Xe>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function Ce(){Te=ce.value}function Pe(Be){de.push(Be);const $e=()=>{const Ve=de.indexOf(Be);Ve>-1&&de.splice(Ve,1)};return xe.push($e),$e}function Le(){const{history:Be}=window;!Be.state||Be.replaceState(assign$1({},Be.state,{scroll:computeScrollPosition()}),"")}function ze(){for(const Be of xe)Be();xe=[],window.removeEventListener("popstate",j),window.removeEventListener("beforeunload",Le)}return window.addEventListener("popstate",j),window.addEventListener("beforeunload",Le),{pauseListeners:Ce,listen:Pe,destroy:ze}}function buildState(V,ee,ce,_e=!1,de=!1){return{back:V,current:ee,forward:ce,replaced:_e,position:window.history.length,scroll:de?computeScrollPosition():null}}function useHistoryStateNavigation(V){const{history:ee,location:ce}=window,_e={value:createCurrentLocation(V,ce)},de={value:ee.state};de.value||xe(_e.value,{back:null,current:_e.value,forward:null,position:ee.length-1,replaced:!0,scroll:null},!0);function xe(Ce,Pe,Le){const ze=V.indexOf("#"),Be=ze>-1?(ce.host&&document.querySelector("base")?V:V.slice(ze))+Ce:createBaseLocation()+V+Ce;try{ee[Le?"replaceState":"pushState"](Pe,"",Be),de.value=Pe}catch($e){console.error($e),ce[Le?"replace":"assign"](Be)}}function Te(Ce,Pe){const Le=assign$1({},ee.state,buildState(de.value.back,Ce,de.value.forward,!0),Pe,{position:de.value.position});xe(Ce,Le,!0),_e.value=Ce}function j(Ce,Pe){const Le=assign$1({},de.value,ee.state,{forward:Ce,scroll:computeScrollPosition()});xe(Le.current,Le,!0);const ze=assign$1({},buildState(_e.value,Ce,null),{position:Le.position+1},Pe);xe(Ce,ze,!1),_e.value=Ce}return{location:_e,state:de,push:j,replace:Te}}function createWebHistory(V){V=normalizeBase(V);const ee=useHistoryStateNavigation(V),ce=useHistoryListeners(V,ee.state,ee.location,ee.replace);function _e(xe,Te=!0){Te||ce.pauseListeners(),history.go(xe)}const de=assign$1({location:"",base:V,go:_e,createHref:createHref.bind(null,V)},ee,ce);return Object.defineProperty(de,"location",{enumerable:!0,get:()=>ee.location.value}),Object.defineProperty(de,"state",{enumerable:!0,get:()=>ee.state.value}),de}function isRouteLocation(V){return typeof V=="string"||V&&typeof V=="object"}function isRouteName(V){return typeof V=="string"||typeof V=="symbol"}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},NavigationFailureSymbol=PolySymbol("nf");var NavigationFailureType;(function(V){V[V.aborted=4]="aborted",V[V.cancelled=8]="cancelled",V[V.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(V,ee){return assign$1(new Error,{type:V,[NavigationFailureSymbol]:!0},ee)}function isNavigationFailure(V,ee){return V instanceof Error&&NavigationFailureSymbol in V&&(ee==null||!!(V.type&ee))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(V,ee){const ce=assign$1({},BASE_PATH_PARSER_OPTIONS,ee),_e=[];let de=ce.start?"^":"";const xe=[];for(const Pe of V){const Le=Pe.length?[]:[90];ce.strict&&!Pe.length&&(de+="/");for(let ze=0;ze<Pe.length;ze++){const Be=Pe[ze];let $e=40+(ce.sensitive?.25:0);if(Be.type===0)ze||(de+="/"),de+=Be.value.replace(REGEX_CHARS_RE,"\\$&"),$e+=40;else if(Be.type===1){const{value:Ve,repeatable:Ke,optional:Xe,regexp:It}=Be;xe.push({name:Ve,repeatable:Ke,optional:Xe});const Ct=It||BASE_PARAM_PATTERN;if(Ct!==BASE_PARAM_PATTERN){$e+=10;try{new RegExp(`(${Ct})`)}catch(Ot){throw new Error(`Invalid custom RegExp for param "${Ve}" (${Ct}): `+Ot.message)}}let yt=Ke?`((?:${Ct})(?:/(?:${Ct}))*)`:`(${Ct})`;ze||(yt=Xe&&Pe.length<2?`(?:/${yt})`:"/"+yt),Xe&&(yt+="?"),de+=yt,$e+=20,Xe&&($e+=-8),Ke&&($e+=-20),Ct===".*"&&($e+=-50)}Le.push($e)}_e.push(Le)}if(ce.strict&&ce.end){const Pe=_e.length-1;_e[Pe][_e[Pe].length-1]+=.7000000000000001}ce.strict||(de+="/?"),ce.end?de+="$":ce.strict&&(de+="(?:/|$)");const Te=new RegExp(de,ce.sensitive?"":"i");function j(Pe){const Le=Pe.match(Te),ze={};if(!Le)return null;for(let Be=1;Be<Le.length;Be++){const $e=Le[Be]||"",Ve=xe[Be-1];ze[Ve.name]=$e&&Ve.repeatable?$e.split("/"):$e}return ze}function Ce(Pe){let Le="",ze=!1;for(const Be of V){(!ze||!Le.endsWith("/"))&&(Le+="/"),ze=!1;for(const $e of Be)if($e.type===0)Le+=$e.value;else if($e.type===1){const{value:Ve,repeatable:Ke,optional:Xe}=$e,It=Ve in Pe?Pe[Ve]:"";if(Array.isArray(It)&&!Ke)throw new Error(`Provided param "${Ve}" is an array but it is not repeatable (* or + modifiers)`);const Ct=Array.isArray(It)?It.join("/"):It;if(!Ct)if(Xe)Be.length<2&&(Le.endsWith("/")?Le=Le.slice(0,-1):ze=!0);else throw new Error(`Missing required param "${Ve}"`);Le+=Ct}}return Le}return{re:Te,score:_e,keys:xe,parse:j,stringify:Ce}}function compareScoreArray(V,ee){let ce=0;for(;ce<V.length&&ce<ee.length;){const _e=ee[ce]-V[ce];if(_e)return _e;ce++}return V.length<ee.length?V.length===1&&V[0]===40+40?-1:1:V.length>ee.length?ee.length===1&&ee[0]===40+40?1:-1:0}function comparePathParserScore(V,ee){let ce=0;const _e=V.score,de=ee.score;for(;ce<_e.length&&ce<de.length;){const xe=compareScoreArray(_e[ce],de[ce]);if(xe)return xe;ce++}return de.length-_e.length}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(V){if(!V)return[[]];if(V==="/")return[[ROOT_TOKEN]];if(!V.startsWith("/"))throw new Error(`Invalid path "${V}"`);function ee($e){throw new Error(`ERR (${ce})/"${Pe}": ${$e}`)}let ce=0,_e=ce;const de=[];let xe;function Te(){xe&&de.push(xe),xe=[]}let j=0,Ce,Pe="",Le="";function ze(){!Pe||(ce===0?xe.push({type:0,value:Pe}):ce===1||ce===2||ce===3?(xe.length>1&&(Ce==="*"||Ce==="+")&&ee(`A repeatable param (${Pe}) must be alone in its segment. eg: '/:ids+.`),xe.push({type:1,value:Pe,regexp:Le,repeatable:Ce==="*"||Ce==="+",optional:Ce==="*"||Ce==="?"})):ee("Invalid state to consume buffer"),Pe="")}function Be(){Pe+=Ce}for(;j<V.length;){if(Ce=V[j++],Ce==="\\"&&ce!==2){_e=ce,ce=4;continue}switch(ce){case 0:Ce==="/"?(Pe&&ze(),Te()):Ce===":"?(ze(),ce=1):Be();break;case 4:Be(),ce=_e;break;case 1:Ce==="("?ce=2:VALID_PARAM_RE.test(Ce)?Be():(ze(),ce=0,Ce!=="*"&&Ce!=="?"&&Ce!=="+"&&j--);break;case 2:Ce===")"?Le[Le.length-1]=="\\"?Le=Le.slice(0,-1)+Ce:ce=3:Le+=Ce;break;case 3:ze(),ce=0,Ce!=="*"&&Ce!=="?"&&Ce!=="+"&&j--,Le="";break;default:ee("Unknown state");break}}return ce===2&&ee(`Unfinished custom RegExp for param "${Pe}"`),ze(),Te(),de}function createRouteRecordMatcher(V,ee,ce){const _e=tokensToParser(tokenizePath(V.path),ce),de=assign$1(_e,{record:V,parent:ee,children:[],alias:[]});return ee&&!de.record.aliasOf==!ee.record.aliasOf&&ee.children.push(de),de}function createRouterMatcher(V,ee){const ce=[],_e=new Map;ee=mergeOptions({strict:!1,end:!0,sensitive:!1},ee);function de(Le){return _e.get(Le)}function xe(Le,ze,Be){const $e=!Be,Ve=normalizeRouteRecord(Le);Ve.aliasOf=Be&&Be.record;const Ke=mergeOptions(ee,Le),Xe=[Ve];if("alias"in Le){const yt=typeof Le.alias=="string"?[Le.alias]:Le.alias;for(const Ot of yt)Xe.push(assign$1({},Ve,{components:Be?Be.record.components:Ve.components,path:Ot,aliasOf:Be?Be.record:Ve}))}let It,Ct;for(const yt of Xe){const{path:Ot}=yt;if(ze&&Ot[0]!=="/"){const Mt=ze.record.path,Pt=Mt[Mt.length-1]==="/"?"":"/";yt.path=ze.record.path+(Ot&&Pt+Ot)}if(It=createRouteRecordMatcher(yt,ze,Ke),Be?Be.alias.push(It):(Ct=Ct||It,Ct!==It&&Ct.alias.push(It),$e&&Le.name&&!isAliasRecord(It)&&Te(Le.name)),"children"in Ve){const Mt=Ve.children;for(let Pt=0;Pt<Mt.length;Pt++)xe(Mt[Pt],It,Be&&Be.children[Pt])}Be=Be||It,Ce(It)}return Ct?()=>{Te(Ct)}:noop$1}function Te(Le){if(isRouteName(Le)){const ze=_e.get(Le);ze&&(_e.delete(Le),ce.splice(ce.indexOf(ze),1),ze.children.forEach(Te),ze.alias.forEach(Te))}else{const ze=ce.indexOf(Le);ze>-1&&(ce.splice(ze,1),Le.record.name&&_e.delete(Le.record.name),Le.children.forEach(Te),Le.alias.forEach(Te))}}function j(){return ce}function Ce(Le){let ze=0;for(;ze<ce.length&&comparePathParserScore(Le,ce[ze])>=0&&(Le.record.path!==ce[ze].record.path||!isRecordChildOf(Le,ce[ze]));)ze++;ce.splice(ze,0,Le),Le.record.name&&!isAliasRecord(Le)&&_e.set(Le.record.name,Le)}function Pe(Le,ze){let Be,$e={},Ve,Ke;if("name"in Le&&Le.name){if(Be=_e.get(Le.name),!Be)throw createRouterError(1,{location:Le});Ke=Be.record.name,$e=assign$1(paramsFromLocation(ze.params,Be.keys.filter(Ct=>!Ct.optional).map(Ct=>Ct.name)),Le.params),Ve=Be.stringify($e)}else if("path"in Le)Ve=Le.path,Be=ce.find(Ct=>Ct.re.test(Ve)),Be&&($e=Be.parse(Ve),Ke=Be.record.name);else{if(Be=ze.name?_e.get(ze.name):ce.find(Ct=>Ct.re.test(ze.path)),!Be)throw createRouterError(1,{location:Le,currentLocation:ze});Ke=Be.record.name,$e=assign$1({},ze.params,Le.params),Ve=Be.stringify($e)}const Xe=[];let It=Be;for(;It;)Xe.unshift(It.record),It=It.parent;return{name:Ke,path:Ve,params:$e,matched:Xe,meta:mergeMetaFields(Xe)}}return V.forEach(Le=>xe(Le)),{addRoute:xe,resolve:Pe,removeRoute:Te,getRoutes:j,getRecordMatcher:de}}function paramsFromLocation(V,ee){const ce={};for(const _e of ee)_e in V&&(ce[_e]=V[_e]);return ce}function normalizeRouteRecord(V){return{path:V.path,redirect:V.redirect,name:V.name,meta:V.meta||{},aliasOf:void 0,beforeEnter:V.beforeEnter,props:normalizeRecordProps(V),children:V.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in V?V.components||{}:{default:V.component}}}function normalizeRecordProps(V){const ee={},ce=V.props||!1;if("component"in V)ee.default=ce;else for(const _e in V.components)ee[_e]=typeof ce=="boolean"?ce:ce[_e];return ee}function isAliasRecord(V){for(;V;){if(V.record.aliasOf)return!0;V=V.parent}return!1}function mergeMetaFields(V){return V.reduce((ee,ce)=>assign$1(ee,ce.meta),{})}function mergeOptions(V,ee){const ce={};for(const _e in V)ce[_e]=_e in ee?ee[_e]:V[_e];return ce}function isRecordChildOf(V,ee){return ee.children.some(ce=>ce===V||isRecordChildOf(V,ce))}const HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(V){return encodeURI(""+V).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(V){return commonEncode(V).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(V){return commonEncode(V).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(V){return encodeQueryValue(V).replace(EQUAL_RE,"%3D")}function encodePath(V){return commonEncode(V).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(V){return V==null?"":encodePath(V).replace(SLASH_RE,"%2F")}function decode(V){try{return decodeURIComponent(""+V)}catch{}return""+V}function parseQuery(V){const ee={};if(V===""||V==="?")return ee;const _e=(V[0]==="?"?V.slice(1):V).split("&");for(let de=0;de<_e.length;++de){const xe=_e[de].replace(PLUS_RE," "),Te=xe.indexOf("="),j=decode(Te<0?xe:xe.slice(0,Te)),Ce=Te<0?null:decode(xe.slice(Te+1));if(j in ee){let Pe=ee[j];Array.isArray(Pe)||(Pe=ee[j]=[Pe]),Pe.push(Ce)}else ee[j]=Ce}return ee}function stringifyQuery(V){let ee="";for(let ce in V){const _e=V[ce];if(ce=encodeQueryKey(ce),_e==null){_e!==void 0&&(ee+=(ee.length?"&":"")+ce);continue}(Array.isArray(_e)?_e.map(xe=>xe&&encodeQueryValue(xe)):[_e&&encodeQueryValue(_e)]).forEach(xe=>{xe!==void 0&&(ee+=(ee.length?"&":"")+ce,xe!=null&&(ee+="="+xe))})}return ee}function normalizeQuery(V){const ee={};for(const ce in V){const _e=V[ce];_e!==void 0&&(ee[ce]=Array.isArray(_e)?_e.map(de=>de==null?null:""+de):_e==null?_e:""+_e)}return ee}function useCallbacks(){let V=[];function ee(_e){return V.push(_e),()=>{const de=V.indexOf(_e);de>-1&&V.splice(de,1)}}function ce(){V=[]}return{add:ee,list:()=>V,reset:ce}}function guardToPromiseFn(V,ee,ce,_e,de){const xe=_e&&(_e.enterCallbacks[de]=_e.enterCallbacks[de]||[]);return()=>new Promise((Te,j)=>{const Ce=ze=>{ze===!1?j(createRouterError(4,{from:ce,to:ee})):ze instanceof Error?j(ze):isRouteLocation(ze)?j(createRouterError(2,{from:ee,to:ze})):(xe&&_e.enterCallbacks[de]===xe&&typeof ze=="function"&&xe.push(ze),Te())},Pe=V.call(_e&&_e.instances[de],ee,ce,Ce);let Le=Promise.resolve(Pe);V.length<3&&(Le=Le.then(Ce)),Le.catch(ze=>j(ze))})}function extractComponentsGuards(V,ee,ce,_e){const de=[];for(const xe of V)for(const Te in xe.components){let j=xe.components[Te];if(!(ee!=="beforeRouteEnter"&&!xe.instances[Te]))if(isRouteComponent(j)){const Pe=(j.__vccOpts||j)[ee];Pe&&de.push(guardToPromiseFn(Pe,ce,_e,xe,Te))}else{let Ce=j();de.push(()=>Ce.then(Pe=>{if(!Pe)return Promise.reject(new Error(`Couldn't resolve component "${Te}" at "${xe.path}"`));const Le=isESModule(Pe)?Pe.default:Pe;xe.components[Te]=Le;const Be=(Le.__vccOpts||Le)[ee];return Be&&guardToPromiseFn(Be,ce,_e,xe,Te)()}))}}return de}function isRouteComponent(V){return typeof V=="object"||"displayName"in V||"props"in V||"__vccOpts"in V}function useLink(V){const ee=inject(routerKey),ce=inject(routeLocationKey),_e=computed(()=>ee.resolve(unref(V.to))),de=computed(()=>{const{matched:Ce}=_e.value,{length:Pe}=Ce,Le=Ce[Pe-1],ze=ce.matched;if(!Le||!ze.length)return-1;const Be=ze.findIndex(isSameRouteRecord.bind(null,Le));if(Be>-1)return Be;const $e=getOriginalPath(Ce[Pe-2]);return Pe>1&&getOriginalPath(Le)===$e&&ze[ze.length-1].path!==$e?ze.findIndex(isSameRouteRecord.bind(null,Ce[Pe-2])):Be}),xe=computed(()=>de.value>-1&&includesParams(ce.params,_e.value.params)),Te=computed(()=>de.value>-1&&de.value===ce.matched.length-1&&isSameRouteLocationParams(ce.params,_e.value.params));function j(Ce={}){return guardEvent(Ce)?ee[unref(V.replace)?"replace":"push"](unref(V.to)).catch(noop$1):Promise.resolve()}return{route:_e,href:computed(()=>_e.value.href),isActive:xe,isExactActive:Te,navigate:j}}const RouterLinkImpl=defineComponent({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(V,{slots:ee}){const ce=reactive(useLink(V)),{options:_e}=inject(routerKey),de=computed(()=>({[getLinkClass(V.activeClass,_e.linkActiveClass,"router-link-active")]:ce.isActive,[getLinkClass(V.exactActiveClass,_e.linkExactActiveClass,"router-link-exact-active")]:ce.isExactActive}));return()=>{const xe=ee.default&&ee.default(ce);return V.custom?xe:h$3("a",{"aria-current":ce.isExactActive?V.ariaCurrentValue:null,href:ce.href,onClick:ce.navigate,class:de.value},xe)}}}),RouterLink=RouterLinkImpl;function guardEvent(V){if(!(V.metaKey||V.altKey||V.ctrlKey||V.shiftKey)&&!V.defaultPrevented&&!(V.button!==void 0&&V.button!==0)){if(V.currentTarget&&V.currentTarget.getAttribute){const ee=V.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(ee))return}return V.preventDefault&&V.preventDefault(),!0}}function includesParams(V,ee){for(const ce in ee){const _e=ee[ce],de=V[ce];if(typeof _e=="string"){if(_e!==de)return!1}else if(!Array.isArray(de)||de.length!==_e.length||_e.some((xe,Te)=>xe!==de[Te]))return!1}return!0}function getOriginalPath(V){return V?V.aliasOf?V.aliasOf.path:V.path:""}const getLinkClass=(V,ee,ce)=>V!=null?V:ee!=null?ee:ce,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(V,{attrs:ee,slots:ce}){const _e=inject(routerViewLocationKey),de=computed(()=>V.route||_e.value),xe=inject(viewDepthKey,0),Te=computed(()=>de.value.matched[xe]);provide(viewDepthKey,xe+1),provide(matchedRouteKey,Te),provide(routerViewLocationKey,de);const j=ref();return watch(()=>[j.value,Te.value,V.name],([Ce,Pe,Le],[ze,Be,$e])=>{Pe&&(Pe.instances[Le]=Ce,Be&&Be!==Pe&&Ce&&Ce===ze&&(Pe.leaveGuards.size||(Pe.leaveGuards=Be.leaveGuards),Pe.updateGuards.size||(Pe.updateGuards=Be.updateGuards))),Ce&&Pe&&(!Be||!isSameRouteRecord(Pe,Be)||!ze)&&(Pe.enterCallbacks[Le]||[]).forEach(Ve=>Ve(Ce))},{flush:"post"}),()=>{const Ce=de.value,Pe=Te.value,Le=Pe&&Pe.components[V.name],ze=V.name;if(!Le)return normalizeSlot(ce.default,{Component:Le,route:Ce});const Be=Pe.props[V.name],$e=Be?Be===!0?Ce.params:typeof Be=="function"?Be(Ce):Be:null,Ke=h$3(Le,assign$1({},$e,ee,{onVnodeUnmounted:Xe=>{Xe.component.isUnmounted&&(Pe.instances[ze]=null)},ref:j}));return normalizeSlot(ce.default,{Component:Ke,route:Ce})||Ke}}});function normalizeSlot(V,ee){if(!V)return null;const ce=V(ee);return ce.length===1?ce[0]:ce}const RouterView=RouterViewImpl;function createRouter(V){const ee=createRouterMatcher(V.routes,V),ce=V.parseQuery||parseQuery,_e=V.stringifyQuery||stringifyQuery,de=V.history,xe=useCallbacks(),Te=useCallbacks(),j=useCallbacks(),Ce=shallowRef(START_LOCATION_NORMALIZED);let Pe=START_LOCATION_NORMALIZED;isBrowser$1&&V.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const Le=applyToParams.bind(null,Wt=>""+Wt),ze=applyToParams.bind(null,encodeParam),Be=applyToParams.bind(null,decode);function $e(Wt,Rn){let ln,Un;return isRouteName(Wt)?(ln=ee.getRecordMatcher(Wt),Un=Rn):Un=Wt,ee.addRoute(Un,ln)}function Ve(Wt){const Rn=ee.getRecordMatcher(Wt);Rn&&ee.removeRoute(Rn)}function Ke(){return ee.getRoutes().map(Wt=>Wt.record)}function Xe(Wt){return!!ee.getRecordMatcher(Wt)}function It(Wt,Rn){if(Rn=assign$1({},Rn||Ce.value),typeof Wt=="string"){const tr=parseURL(ce,Wt,Rn.path),ft=ee.resolve({path:tr.path},Rn),wt=de.createHref(tr.fullPath);return assign$1(tr,ft,{params:Be(ft.params),hash:decode(tr.hash),redirectedFrom:void 0,href:wt})}let ln;if("path"in Wt)ln=assign$1({},Wt,{path:parseURL(ce,Wt.path,Rn.path).path});else{const tr=assign$1({},Wt.params);for(const ft in tr)tr[ft]==null&&delete tr[ft];ln=assign$1({},Wt,{params:ze(Wt.params)}),Rn.params=ze(Rn.params)}const Un=ee.resolve(ln,Rn),dr=Wt.hash||"";Un.params=Le(Be(Un.params));const _r=stringifyURL(_e,assign$1({},Wt,{hash:encodeHash(dr),path:Un.path})),pr=de.createHref(_r);return assign$1({fullPath:_r,hash:dr,query:_e===stringifyQuery?normalizeQuery(Wt.query):Wt.query||{}},Un,{redirectedFrom:void 0,href:pr})}function Ct(Wt){return typeof Wt=="string"?parseURL(ce,Wt,Ce.value.path):assign$1({},Wt)}function yt(Wt,Rn){if(Pe!==Wt)return createRouterError(8,{from:Rn,to:Wt})}function Ot(Wt){return At(Wt)}function Mt(Wt){return Ot(assign$1(Ct(Wt),{replace:!0}))}function Pt(Wt){const Rn=Wt.matched[Wt.matched.length-1];if(Rn&&Rn.redirect){const{redirect:ln}=Rn;let Un=typeof ln=="function"?ln(Wt):ln;return typeof Un=="string"&&(Un=Un.includes("?")||Un.includes("#")?Un=Ct(Un):{path:Un},Un.params={}),assign$1({query:Wt.query,hash:Wt.hash,params:Wt.params},Un)}}function At(Wt,Rn){const ln=Pe=It(Wt),Un=Ce.value,dr=Wt.state,_r=Wt.force,pr=Wt.replace===!0,tr=Pt(ln);if(tr)return At(assign$1(Ct(tr),{state:dr,force:_r,replace:pr}),Rn||ln);const ft=ln;ft.redirectedFrom=Rn;let wt;return!_r&&isSameRouteLocation(_e,Un,ln)&&(wt=createRouterError(16,{to:ft,from:Un}),sr(Un,Un,!0,!1)),(wt?Promise.resolve(wt):Gt(ft,Un)).catch(qt=>isNavigationFailure(qt)?isNavigationFailure(qt,2)?qt:Xn(qt):Ln(qt,ft,Un)).then(qt=>{if(qt){if(isNavigationFailure(qt,2))return At(assign$1(Ct(qt.to),{state:dr,force:_r,replace:pr}),Rn||ft)}else qt=on(ft,Un,!0,pr,dr);return Ut(ft,Un,qt),qt})}function Dt(Wt,Rn){const ln=yt(Wt,Rn);return ln?Promise.reject(ln):Promise.resolve()}function Gt(Wt,Rn){let ln;const[Un,dr,_r]=extractChangingRecords(Wt,Rn);ln=extractComponentsGuards(Un.reverse(),"beforeRouteLeave",Wt,Rn);for(const tr of Un)tr.leaveGuards.forEach(ft=>{ln.push(guardToPromiseFn(ft,Wt,Rn))});const pr=Dt.bind(null,Wt,Rn);return ln.push(pr),runGuardQueue(ln).then(()=>{ln=[];for(const tr of xe.list())ln.push(guardToPromiseFn(tr,Wt,Rn));return ln.push(pr),runGuardQueue(ln)}).then(()=>{ln=extractComponentsGuards(dr,"beforeRouteUpdate",Wt,Rn);for(const tr of dr)tr.updateGuards.forEach(ft=>{ln.push(guardToPromiseFn(ft,Wt,Rn))});return ln.push(pr),runGuardQueue(ln)}).then(()=>{ln=[];for(const tr of Wt.matched)if(tr.beforeEnter&&!Rn.matched.includes(tr))if(Array.isArray(tr.beforeEnter))for(const ft of tr.beforeEnter)ln.push(guardToPromiseFn(ft,Wt,Rn));else ln.push(guardToPromiseFn(tr.beforeEnter,Wt,Rn));return ln.push(pr),runGuardQueue(ln)}).then(()=>(Wt.matched.forEach(tr=>tr.enterCallbacks={}),ln=extractComponentsGuards(_r,"beforeRouteEnter",Wt,Rn),ln.push(pr),runGuardQueue(ln))).then(()=>{ln=[];for(const tr of Te.list())ln.push(guardToPromiseFn(tr,Wt,Rn));return ln.push(pr),runGuardQueue(ln)}).catch(tr=>isNavigationFailure(tr,8)?tr:Promise.reject(tr))}function Ut(Wt,Rn,ln){for(const Un of j.list())Un(Wt,Rn,ln)}function on(Wt,Rn,ln,Un,dr){const _r=yt(Wt,Rn);if(_r)return _r;const pr=Rn===START_LOCATION_NORMALIZED,tr=isBrowser$1?history.state:{};ln&&(Un||pr?de.replace(Wt.fullPath,assign$1({scroll:pr&&tr&&tr.scroll},dr)):de.push(Wt.fullPath,dr)),Ce.value=Wt,sr(Wt,Rn,ln,pr),Xn()}let Vt;function An(){Vt=de.listen((Wt,Rn,ln)=>{const Un=It(Wt),dr=Pt(Un);if(dr){At(assign$1(dr,{replace:!0}),Un).catch(noop$1);return}Pe=Un;const _r=Ce.value;isBrowser$1&&saveScrollPosition(getScrollKey(_r.fullPath,ln.delta),computeScrollPosition()),Gt(Un,_r).catch(pr=>isNavigationFailure(pr,12)?pr:isNavigationFailure(pr,2)?(At(pr.to,Un).then(tr=>{isNavigationFailure(tr,20)&&!ln.delta&&ln.type===NavigationType.pop&&de.go(-1,!1)}).catch(noop$1),Promise.reject()):(ln.delta&&de.go(-ln.delta,!1),Ln(pr,Un,_r))).then(pr=>{pr=pr||on(Un,_r,!1),pr&&(ln.delta?de.go(-ln.delta,!1):ln.type===NavigationType.pop&&isNavigationFailure(pr,20)&&de.go(-1,!1)),Ut(Un,_r,pr)}).catch(noop$1)})}let _n=useCallbacks(),Yn=useCallbacks(),bn;function Ln(Wt,Rn,ln){Xn(Wt);const Un=Yn.list();return Un.length?Un.forEach(dr=>dr(Wt,Rn,ln)):console.error(Wt),Promise.reject(Wt)}function mn(){return bn&&Ce.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((Wt,Rn)=>{_n.add([Wt,Rn])})}function Xn(Wt){return bn||(bn=!Wt,An(),_n.list().forEach(([Rn,ln])=>Wt?ln(Wt):Rn()),_n.reset()),Wt}function sr(Wt,Rn,ln,Un){const{scrollBehavior:dr}=V;if(!isBrowser$1||!dr)return Promise.resolve();const _r=!ln&&getSavedScrollPosition(getScrollKey(Wt.fullPath,0))||(Un||!ln)&&history.state&&history.state.scroll||null;return nextTick().then(()=>dr(Wt,Rn,_r)).then(pr=>pr&&scrollToPosition(pr)).catch(pr=>Ln(pr,Wt,Rn))}const Pr=Wt=>de.go(Wt);let er;const rr=new Set;return{currentRoute:Ce,addRoute:$e,removeRoute:Ve,hasRoute:Xe,getRoutes:Ke,resolve:It,options:V,push:Ot,replace:Mt,go:Pr,back:()=>Pr(-1),forward:()=>Pr(1),beforeEach:xe.add,beforeResolve:Te.add,afterEach:j.add,onError:Yn.add,isReady:mn,install(Wt){const Rn=this;Wt.component("RouterLink",RouterLink),Wt.component("RouterView",RouterView),Wt.config.globalProperties.$router=Rn,Object.defineProperty(Wt.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(Ce)}),isBrowser$1&&!er&&Ce.value===START_LOCATION_NORMALIZED&&(er=!0,Ot(de.location).catch(dr=>{}));const ln={};for(const dr in START_LOCATION_NORMALIZED)ln[dr]=computed(()=>Ce.value[dr]);Wt.provide(routerKey,Rn),Wt.provide(routeLocationKey,reactive(ln)),Wt.provide(routerViewLocationKey,Ce);const Un=Wt.unmount;rr.add(Wt),Wt.unmount=function(){rr.delete(Wt),rr.size<1&&(Pe=START_LOCATION_NORMALIZED,Vt&&Vt(),Ce.value=START_LOCATION_NORMALIZED,er=!1,bn=!1),Un()}}}}function runGuardQueue(V){return V.reduce((ee,ce)=>ee.then(()=>ce()),Promise.resolve())}function extractChangingRecords(V,ee){const ce=[],_e=[],de=[],xe=Math.max(ee.matched.length,V.matched.length);for(let Te=0;Te<xe;Te++){const j=ee.matched[Te];j&&(V.matched.find(Pe=>isSameRouteRecord(Pe,j))?_e.push(j):ce.push(j));const Ce=V.matched[Te];Ce&&(ee.matched.find(Pe=>isSameRouteRecord(Pe,Ce))||de.push(Ce))}return[ce,_e,de]}function useRouter(){return inject(routerKey)}function u$5(V,ee,...ce){if(V in ee){let de=ee[V];return typeof de=="function"?de(...ce):de}let _e=new Error(`Tried to handle "${V}" but there is no handler defined. Only defined handlers are: ${Object.keys(ee).map(de=>`"${de}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(_e,u$5),_e}var m$1=(V=>(V[V.None=0]="None",V[V.RenderStrategy=1]="RenderStrategy",V[V.Static=2]="Static",V))(m$1||{}),h$2=(V=>(V[V.Unmount=0]="Unmount",V[V.Hidden=1]="Hidden",V))(h$2||{});function k(_e){var de=_e,{visible:V=!0,features:ee=0}=de,ce=Vo(de,["visible","features"]);var xe;if(V||ee&2&&ce.props.static)return a$4(ce);if(ee&1){let Te=(xe=ce.props.unmount)==null||xe?0:1;return u$5(Te,{[0](){return null},[1](){return a$4(Xi(vr({},ce),{props:Xi(vr({},ce.props),{hidden:!0,style:{display:"none"}})}))}})}return a$4(ce)}function a$4({props:V,attrs:ee,slots:ce,slot:_e,name:de}){var xe;let Pe=R$2(V,["unmount","static"]),{as:Te}=Pe,j=Vo(Pe,["as"]),Ce=(xe=ce.default)==null?void 0:xe.call(ce,_e);if(Te==="template"){if(Object.keys(j).length>0||Object.keys(ee).length>0){let[Le,...ze]=Ce!=null?Ce:[];if(!b$3(Le)||ze.length>0)throw new Error(['Passing props on "template"!',"",`The current component <${de} /> is rendering a "template".`,"However we need to passthrough the following props:",Object.keys(j).concat(Object.keys(ee)).map(Be=>`  - ${Be}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "template".',"Render a single element as the child so that we can forward the props onto that element."].map(Be=>`  - ${Be}`).join(`
`)].join(`
`));return cloneVNode(Le,j)}return Array.isArray(Ce)&&Ce.length===1?Ce[0]:Ce}return h$3(Te,j,Ce)}function O(V){let ee=Object.assign({},V);for(let ce in ee)ee[ce]===void 0&&delete ee[ce];return ee}function R$2(V,ee=[]){let ce=Object.assign({},V);for(let _e of ee)_e in ce&&delete ce[_e];return ce}function b$3(V){return V==null?!1:typeof V.type=="string"||typeof V.type=="object"||typeof V.type=="function"}let e$3=0;function n$2(){return++e$3}function t$2(){return n$2()}var o$1=(V=>(V.Space=" ",V.Enter="Enter",V.Escape="Escape",V.Backspace="Backspace",V.Delete="Delete",V.ArrowLeft="ArrowLeft",V.ArrowUp="ArrowUp",V.ArrowRight="ArrowRight",V.ArrowDown="ArrowDown",V.Home="Home",V.End="End",V.PageUp="PageUp",V.PageDown="PageDown",V.Tab="Tab",V))(o$1||{});function f$2(V){throw new Error("Unexpected object: "+V)}var a$3=(V=>(V[V.First=0]="First",V[V.Previous=1]="Previous",V[V.Next=2]="Next",V[V.Last=3]="Last",V[V.Specific=4]="Specific",V[V.Nothing=5]="Nothing",V))(a$3||{});function x$4(V,ee){let ce=ee.resolveItems();if(ce.length<=0)return null;let _e=ee.resolveActiveIndex(),de=_e!=null?_e:-1,xe=(()=>{switch(V.focus){case 0:return ce.findIndex(Te=>!ee.resolveDisabled(Te));case 1:{let Te=ce.slice().reverse().findIndex((j,Ce,Pe)=>de!==-1&&Pe.length-Ce-1>=de?!1:!ee.resolveDisabled(j));return Te===-1?Te:ce.length-1-Te}case 2:return ce.findIndex((Te,j)=>j<=de?!1:!ee.resolveDisabled(Te));case 3:{let Te=ce.slice().reverse().findIndex(j=>!ee.resolveDisabled(j));return Te===-1?Te:ce.length-1-Te}case 4:return ce.findIndex(Te=>ee.resolveId(Te)===V.id);case 5:return null;default:f$2(V)}})();return xe===-1?_e:xe}function t$1(V){return V==null||V.value==null?null:"$el"in V.value?V.value.$el:V.value}let n$1=Symbol("Context");var l$3=(V=>(V[V.Open=0]="Open",V[V.Closed=1]="Closed",V))(l$3||{});function f$1(){return p$4()!==null}function p$4(){return inject(n$1,null)}function c$3(V){provide(n$1,V)}function r$4(V,ee){if(V)return V;let ce=ee!=null?ee:"button";if(typeof ce=="string"&&ce.toLowerCase()==="button")return"button"}function b$2(V,ee){let ce=ref(r$4(V.value.type,V.value.as));return onMounted(()=>{ce.value=r$4(V.value.type,V.value.as)}),watchEffect(()=>{var _e;ce.value||!t$1(ee)||t$1(ee)instanceof HTMLButtonElement&&!((_e=t$1(ee))!=null&&_e.hasAttribute("type"))&&(ce.value="button")}),ce}function e$2(V){if(typeof window=="undefined")return null;if(V instanceof Node)return V.ownerDocument;if(V!=null&&V.hasOwnProperty("value")){let ee=t$1(V);if(ee)return ee.ownerDocument}return document}function p$3({container:V,accept:ee,walk:ce,enabled:_e}){watchEffect(()=>{let de=V.value;if(!de||_e!==void 0&&!_e.value)return;let xe=e$2(V);if(!xe)return;let Te=Object.assign(Ce=>ee(Ce),{acceptNode:ee}),j=xe.createTreeWalker(de,NodeFilter.SHOW_ELEMENT,Te,!1);for(;j.nextNode();)ce(j.currentNode)})}let c$2=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(V=>`${V}:not([tabindex='-1'])`).join(",");var p$2=(V=>(V[V.First=1]="First",V[V.Previous=2]="Previous",V[V.Next=4]="Next",V[V.Last=8]="Last",V[V.WrapAround=16]="WrapAround",V[V.NoScroll=32]="NoScroll",V))(p$2||{}),L$2=(V=>(V[V.Error=0]="Error",V[V.Overflow=1]="Overflow",V[V.Success=2]="Success",V[V.Underflow=3]="Underflow",V))(L$2||{}),N$1=(V=>(V[V.Previous=-1]="Previous",V[V.Next=1]="Next",V))(N$1||{});function T$2(V=document.body){return V==null?[]:Array.from(V.querySelectorAll(c$2))}var b$1=(V=>(V[V.Strict=0]="Strict",V[V.Loose=1]="Loose",V))(b$1||{});function S$1(V,ee=0){var ce;return V===((ce=e$2(V))==null?void 0:ce.body)?!1:u$5(ee,{[0](){return V.matches(c$2)},[1](){let _e=V;for(;_e!==null;){if(_e.matches(c$2))return!0;_e=_e.parentElement}return!1}})}function F$2(V){V==null||V.focus({preventScroll:!0})}let M=["textarea","input"].join(",");function h$1(V){var ee,ce;return(ce=(ee=V==null?void 0:V.matches)==null?void 0:ee.call(V,M))!=null?ce:!1}function v$2(V,ee=ce=>ce){return V.slice().sort((ce,_e)=>{let de=ee(ce),xe=ee(_e);if(de===null||xe===null)return 0;let Te=de.compareDocumentPosition(xe);return Te&Node.DOCUMENT_POSITION_FOLLOWING?-1:Te&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function H$2(V,ee){var ce;let _e=(ce=Array.isArray(V)?V.length>0?V[0].ownerDocument:document:V==null?void 0:V.ownerDocument)!=null?ce:document,de=Array.isArray(V)?v$2(V):T$2(V),xe=_e.activeElement,Te=(()=>{if(ee&5)return 1;if(ee&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),j=(()=>{if(ee&1)return 0;if(ee&2)return Math.max(0,de.indexOf(xe))-1;if(ee&4)return Math.max(0,de.indexOf(xe))+1;if(ee&8)return de.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),Ce=ee&32?{preventScroll:!0}:{},Pe=0,Le=de.length,ze;do{if(Pe>=Le||Pe+Le<=0)return 0;let Be=j+Pe;if(ee&16)Be=(Be+Le)%Le;else{if(Be<0)return 3;if(Be>=Le)return 1}ze=de[Be],ze==null||ze.focus(Ce),Pe+=Te}while(ze!==_e.activeElement);return ze.hasAttribute("tabindex")||ze.setAttribute("tabindex","0"),ee&6&&h$1(ze)&&ze.select(),2}function w$1(V,ee,ce){typeof window!="undefined"&&watchEffect(_e=>{window.addEventListener(V,ee,ce),_e(()=>window.removeEventListener(V,ee,ce))})}function s$3(V){typeof queueMicrotask=="function"?queueMicrotask(V):Promise.resolve().then(V).catch(ee=>setTimeout(()=>{throw ee}))}var p$1=(V=>(V[V.None=1]="None",V[V.IgnoreScrollbars=2]="IgnoreScrollbars",V))(p$1||{});function g$4(V,ee,ce=1){let _e=!1;function de(xe){if(_e)return;_e=!0,s$3(()=>{_e=!1});let Te=xe.target;if(!Te.ownerDocument.documentElement.contains(Te))return;let j=function Ce(Pe){return typeof Pe=="function"?Ce(Pe()):Array.isArray(Pe)||Pe instanceof Set?Pe:[Pe]}(V);if((ce&2)===2){let Ce=20,Pe=Te.ownerDocument.documentElement;if(xe.clientX>Pe.clientWidth-Ce||xe.clientX<Ce||xe.clientY>Pe.clientHeight-Ce||xe.clientY<Ce)return}for(let Ce of j){if(Ce===null)continue;let Pe=Ce instanceof HTMLElement?Ce:t$1(Ce);if(Pe!=null&&Pe.contains(Te))return}ee(xe,Te)}w$1("pointerdown",de),w$1("mousedown",de)}let l$2=defineComponent({name:"VisuallyHidden",props:{as:{type:[Object,String],default:"div"}},setup(V,{slots:ee,attrs:ce}){return()=>k({props:Xi(vr({},V),{style:{position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",display:"none"}}),slot:{},attrs:ce,slots:ee,name:"VisuallyHidden"})}});function p(V){var ee;let ce=(ee=V==null?void 0:V.form)!=null?ee:V.closest("form");if(ce){for(let _e of ce.elements)if(_e.tagName==="INPUT"&&_e.type==="submit"||_e.tagName==="BUTTON"&&_e.type==="submit"||_e.nodeName==="INPUT"&&_e.type==="image"){_e.click();return}}}function r$3(V,ee,ce,_e){typeof window!="undefined"&&watchEffect(de=>{V=V!=null?V:window,V.addEventListener(ee,ce,_e),de(()=>V.removeEventListener(ee,ce,_e))})}var g$3=(V=>(V[V.None=1]="None",V[V.InitialFocus=2]="InitialFocus",V[V.TabLock=4]="TabLock",V[V.FocusLock=8]="FocusLock",V[V.RestoreFocus=16]="RestoreFocus",V[V.All=30]="All",V))(g$3||{});function W$3(V,ee=ref(30),ce=ref({})){var _e,de;let xe=ref(null),Te=ref(null),j={value:!1},Ce=computed(()=>Boolean(ee.value&16)),Pe=computed(()=>Boolean(ee.value&2)),Le=computed(()=>e$2(V));return onMounted(()=>{watch(Ce,(ze,Be)=>{var $e;ze!==Be&&(!Ce.value||(j.value=!0,xe.value||(xe.value=($e=Le.value)==null?void 0:$e.activeElement)))},{immediate:!0}),watch(Ce,(ze,Be,$e)=>{ze!==Be&&(!Ce.value||$e(()=>{j.value!==!1&&(j.value=!1,F$2(xe.value),xe.value=null)}))},{immediate:!0}),watch([V,ce,ce.value.initialFocus,Pe],(ze,Be)=>{var $e,Ve;if(ze.every((Ct,yt)=>(Be==null?void 0:Be[yt])===Ct)||!Pe.value)return;let Ke=V.value;if(!Ke)return;let Xe=t$1(ce.value.initialFocus),It=($e=Le.value)==null?void 0:$e.activeElement;if(Xe){if(Xe===It){Te.value=It;return}}else if(Ke.contains(It)){Te.value=It;return}Xe?F$2(Xe):H$2(Ke,p$2.First)===L$2.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),Te.value=(Ve=Le.value)==null?void 0:Ve.activeElement},{immediate:!0})}),r$3((_e=Le.value)==null?void 0:_e.defaultView,"keydown",ze=>{var Be;!(ee.value&4)||!V.value||ze.key===o$1.Tab&&(ze.preventDefault(),H$2(V.value,(ze.shiftKey?p$2.Previous:p$2.Next)|p$2.WrapAround)===L$2.Success&&(Te.value=(Be=Le.value)==null?void 0:Be.activeElement))}),r$3((de=Le.value)==null?void 0:de.defaultView,"focus",ze=>{var Be;if(!(ee.value&8))return;let $e=new Set((Be=ce.value.containers)==null?void 0:Be.value);if($e.add(V),!$e.size)return;let Ve=Te.value;if(!Ve||!j.value)return;let Ke=ze.target;Ke&&Ke instanceof HTMLElement?x$3($e,Ke)?(Te.value=Ke,F$2(Ke)):(ze.preventDefault(),ze.stopPropagation(),F$2(Ve)):F$2(Te.value)},!0),xe}function x$3(V,ee){var ce;for(let _e of V)if((ce=_e.value)!=null&&ce.contains(ee))return!0;return!1}let l$1="body > *",i$2=new Set,r$2=new Map;function u$4(V){V.setAttribute("aria-hidden","true"),V.inert=!0}function s$2(V){let ee=r$2.get(V);!ee||(ee["aria-hidden"]===null?V.removeAttribute("aria-hidden"):V.setAttribute("aria-hidden",ee["aria-hidden"]),V.inert=ee.inert)}function g$2(V,ee=ref(!0)){watchEffect(ce=>{if(!ee.value||!V.value)return;let _e=V.value,de=e$2(_e);if(de){i$2.add(_e);for(let xe of r$2.keys())xe.contains(_e)&&(s$2(xe),r$2.delete(xe));de.querySelectorAll(l$1).forEach(xe=>{if(xe instanceof HTMLElement){for(let Te of i$2)if(xe.contains(Te))return;i$2.size===1&&(r$2.set(xe,{"aria-hidden":xe.getAttribute("aria-hidden"),inert:xe.inert}),u$4(xe))}}),ce(()=>{if(i$2.delete(_e),i$2.size>0)de.querySelectorAll(l$1).forEach(xe=>{if(xe instanceof HTMLElement&&!r$2.has(xe)){for(let Te of i$2)if(xe.contains(Te))return;r$2.set(xe,{"aria-hidden":xe.getAttribute("aria-hidden"),inert:xe.inert}),u$4(xe)}});else for(let xe of r$2.keys())s$2(xe),r$2.delete(xe)})}})}let e$1=Symbol("ForcePortalRootContext");function u$3(){return inject(e$1,!1)}let P$2=defineComponent({name:"ForcePortalRoot",props:{as:{type:[Object,String],default:"template"},force:{type:Boolean,default:!1}},setup(V,{slots:ee,attrs:ce}){return provide(e$1,V.force),()=>{let xe=V,{force:_e}=xe,de=Vo(xe,["force"]);return k({props:de,slot:{},slots:ee,attrs:ce,name:"ForcePortalRoot"})}}});function v$1(V){let ee=e$2(V);if(!ee)throw new Error(`[Headless UI]: Cannot find ownerDocument for contextElement: ${V}`);let ce=ee.getElementById("headlessui-portal-root");if(ce)return ce;let _e=ee.createElement("div");return _e.setAttribute("id","headlessui-portal-root"),ee.body.appendChild(_e)}let R$1=defineComponent({name:"Portal",props:{as:{type:[Object,String],default:"div"}},setup(V,{slots:ee,attrs:ce}){let _e=ref(null),de=computed(()=>e$2(_e)),xe=u$3(),Te=inject(g$1,null),j=ref(xe===!0||Te==null?v$1(_e.value):Te.resolveTarget());return watchEffect(()=>{xe||Te!=null&&(j.value=Te.resolveTarget())}),onUnmounted(()=>{var Ce,Pe;let Le=(Ce=de.value)==null?void 0:Ce.getElementById("headlessui-portal-root");!Le||j.value===Le&&j.value.children.length<=0&&((Pe=j.value.parentElement)==null||Pe.removeChild(j.value))}),()=>{if(j.value===null)return null;let Ce={ref:_e};return h$3(Teleport,{to:j.value},k({props:vr(vr({},V),Ce),slot:{},attrs:ce,slots:ee,name:"Portal"}))}}}),g$1=Symbol("PortalGroupContext"),L$1=defineComponent({name:"PortalGroup",props:{as:{type:[Object,String],default:"template"},target:{type:Object,default:null}},setup(V,{attrs:ee,slots:ce}){let _e=reactive({resolveTarget(){return V.target}});return provide(g$1,_e),()=>{let Te=V,{target:de}=Te,xe=Vo(Te,["target"]);return k({props:xe,slot:{},attrs:ee,slots:ce,name:"PortalGroup"})}}}),i$1=Symbol("StackContext");var c$1=(V=>(V[V.Add=0]="Add",V[V.Remove=1]="Remove",V))(c$1||{});function a$2(){return inject(i$1,()=>{})}function s$1({type:V,element:ee,onUpdate:ce}){let _e=a$2();function de(...xe){ce==null||ce(...xe),_e(...xe)}onMounted(()=>{de(0,V,ee),onUnmounted(()=>{de(1,V,ee)})}),provide(i$1,de)}let u$2=Symbol("DescriptionContext");function h(){let V=inject(u$2,null);if(V===null)throw new Error("Missing parent");return V}function P$1({slot:V=ref({}),name:ee="Description",props:ce={}}={}){let _e=ref([]);function de(xe){return _e.value.push(xe),()=>{let Te=_e.value.indexOf(xe);Te!==-1&&_e.value.splice(Te,1)}}return provide(u$2,{register:de,slot:V,name:ee,props:ce}),computed(()=>_e.value.length>0?_e.value.join(" "):void 0)}let S=defineComponent({name:"Description",props:{as:{type:[Object,String],default:"p"}},setup(V,{attrs:ee,slots:ce}){let _e=h(),de=`headlessui-description-${t$2()}`;return onMounted(()=>onUnmounted(_e.register(de))),()=>{let{name:xe="Description",slot:Te=ref({}),props:j={}}=_e,Ce=V,Pe=Xi(vr({},Object.entries(j).reduce((Le,[ze,Be])=>Object.assign(Le,{[ze]:unref(Be)}),{})),{id:de});return k({props:vr(vr({},Ce),Pe),slot:Te.value,attrs:ee,slots:ce,name:xe})}}});var fe$2=(V=>(V[V.Open=0]="Open",V[V.Closed=1]="Closed",V))(fe$2||{});let x$2=Symbol("DialogContext");function P(V){let ee=inject(x$2,null);if(ee===null){let ce=new Error(`<${V} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(ce,P),ce}return ee}let T$1="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Me=defineComponent({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:T$1},initialFocus:{type:Object,default:null}},emits:{close:V=>!0},setup(V,{emit:ee,attrs:ce,slots:_e,expose:de}){var xe;let Te=ref(0),j=p$4(),Ce=computed(()=>V.open===T$1&&j!==null?u$5(j.value,{[l$3.Open]:!0,[l$3.Closed]:!1}):V.open),Pe=ref(new Set),Le=ref(null),ze=computed(()=>e$2(Le));if(de({el:Le,$el:Le}),!(V.open!==T$1||j!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof Ce.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${Ce.value===T$1?void 0:V.open}`);let Be=computed(()=>Ce.value?0:1),$e=computed(()=>Be.value===0),Ve=computed(()=>Te.value>1),Ke=inject(x$2,null)!==null,Xe=computed(()=>Ve.value?"parent":"leaf"),It=W$3(Le,computed(()=>$e.value?u$5(Xe.value,{parent:g$3.RestoreFocus,leaf:g$3.All&~g$3.FocusLock}):g$3.None),computed(()=>({initialFocus:ref(V.initialFocus),containers:Pe})));g$2(Le,computed(()=>Ve.value?$e.value:!1)),s$1({type:"Dialog",element:Le,onUpdate:(At,Dt,Gt)=>{if(Dt==="Dialog")return u$5(At,{[c$1.Add](){Pe.value.add(Gt),Te.value+=1},[c$1.Remove](){Pe.value.delete(Gt),Te.value-=1}})}});let Ct=P$1({name:"DialogDescription",slot:computed(()=>({open:Ce.value}))}),yt=`headlessui-dialog-${t$2()}`,Ot=ref(null),Mt={titleId:Ot,panelRef:ref(null),dialogState:Be,setTitleId(At){Ot.value!==At&&(Ot.value=At)},close(){ee("close",!1)}};provide(x$2,Mt),g$4(()=>{var At,Dt,Gt;return[...Array.from((Dt=(At=ze.value)==null?void 0:At.querySelectorAll("body > *"))!=null?Dt:[]).filter(Ut=>!(!(Ut instanceof HTMLElement)||Ut.contains(It.value)||Mt.panelRef.value&&Ut.contains(Mt.panelRef.value))),(Gt=Mt.panelRef.value)!=null?Gt:Le.value]},(At,Dt)=>{Be.value===0&&(Ve.value||(Mt.close(),nextTick(()=>Dt==null?void 0:Dt.focus())))},p$1.IgnoreScrollbars),r$3((xe=ze.value)==null?void 0:xe.defaultView,"keydown",At=>{At.key===o$1.Escape&&Be.value===0&&(Ve.value||(At.preventDefault(),At.stopPropagation(),Mt.close()))}),watchEffect(At=>{var Dt;if(Be.value!==0||Ke)return;let Gt=ze.value;if(!Gt)return;let Ut=Gt==null?void 0:Gt.documentElement,on=(Dt=Gt.defaultView)!=null?Dt:window,Vt=Ut.style.overflow,An=Ut.style.paddingRight,_n=on.innerWidth-Ut.clientWidth;Ut.style.overflow="hidden",Ut.style.paddingRight=`${_n}px`,At(()=>{Ut.style.overflow=Vt,Ut.style.paddingRight=An})}),watchEffect(At=>{if(Be.value!==0)return;let Dt=t$1(Le);if(!Dt)return;let Gt=new IntersectionObserver(Ut=>{for(let on of Ut)on.boundingClientRect.x===0&&on.boundingClientRect.y===0&&on.boundingClientRect.width===0&&on.boundingClientRect.height===0&&Mt.close()});Gt.observe(Dt),At(()=>Gt.disconnect())});function Pt(At){At.stopPropagation()}return()=>{let At=Xi(vr({},ce),{ref:Le,id:yt,role:"dialog","aria-modal":Be.value===0?!0:void 0,"aria-labelledby":Ot.value,"aria-describedby":Ct.value,onClick:Pt}),Vt=V,{open:Dt,initialFocus:Gt}=Vt,Ut=Vo(Vt,["open","initialFocus"]),on={open:Be.value===0};return h$3(P$2,{force:!0},()=>h$3(R$1,()=>h$3(L$1,{target:Le.value},()=>h$3(P$2,{force:!1},()=>k({props:vr(vr({},Ut),At),slot:on,attrs:ce,slots:_e,visible:Be.value===0,features:m$1.RenderStrategy|m$1.Static,name:"Dialog"})))))}}});defineComponent({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(V,{attrs:ee,slots:ce}){let _e=P("DialogOverlay"),de=`headlessui-dialog-overlay-${t$2()}`;function xe(Te){Te.target===Te.currentTarget&&(Te.preventDefault(),Te.stopPropagation(),_e.close())}return()=>k({props:Xi(vr({},V),{id:de,"aria-hidden":!0,onClick:xe}),slot:{open:_e.dialogState.value===0},attrs:ee,slots:ce,name:"DialogOverlay"})}});defineComponent({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(V,{attrs:ee,slots:ce,expose:_e}){let de=P("DialogBackdrop"),xe=`headlessui-dialog-backdrop-${t$2()}`,Te=ref(null);return _e({el:Te,$el:Te}),onMounted(()=>{if(de.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let j=V,Ce={id:xe,ref:Te,"aria-hidden":!0};return h$3(P$2,{force:!0},()=>h$3(R$1,()=>k({props:vr(vr(vr({},ee),j),Ce),slot:{open:de.dialogState.value===0},attrs:ee,slots:ce,name:"DialogBackdrop"})))}}});let je=defineComponent({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(V,{attrs:ee,slots:ce}){let _e=P("DialogPanel"),de=`headlessui-dialog-panel-${t$2()}`;return()=>{let xe={id:de,ref:_e.panelRef};return k({props:vr(vr({},V),xe),slot:{open:_e.dialogState.value===0},attrs:ee,slots:ce,name:"DialogPanel"})}}}),Ae=defineComponent({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(V,{attrs:ee,slots:ce}){let _e=P("DialogTitle"),de=`headlessui-dialog-title-${t$2()}`;return onMounted(()=>{_e.setTitleId(de),onUnmounted(()=>_e.setTitleId(null))}),()=>k({props:Xi(vr({},V),{id:de}),slot:{open:_e.dialogState.value===0},attrs:ee,slots:ce,name:"DialogTitle"})}});var w=(V=>(V[V.Open=0]="Open",V[V.Closed=1]="Closed",V))(w||{});let x$1=Symbol("DisclosureContext");function C(V){let ee=inject(x$1,null);if(ee===null){let ce=new Error(`<${V} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(ce,C),ce}return ee}let B=Symbol("DisclosurePanelContext");function H$1(){return inject(B,null)}let A=defineComponent({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(V,{slots:ee,attrs:ce}){let _e=`headlessui-disclosure-button-${t$2()}`,de=`headlessui-disclosure-panel-${t$2()}`,xe=ref(V.defaultOpen?0:1),Te=ref(null),j=ref(null),Ce={buttonId:_e,panelId:de,disclosureState:xe,panel:Te,button:j,toggleDisclosure(){xe.value=u$5(xe.value,{[0]:1,[1]:0})},closeDisclosure(){xe.value!==1&&(xe.value=1)},close(Pe){Ce.closeDisclosure();let Le=(()=>Pe?Pe instanceof HTMLElement?Pe:Pe.value instanceof HTMLElement?t$1(Pe):t$1(Ce.button):t$1(Ce.button))();Le==null||Le.focus()}};return provide(x$1,Ce),c$3(computed(()=>u$5(xe.value,{[0]:l$3.Open,[1]:l$3.Closed}))),()=>{let Be=V,{defaultOpen:Pe}=Be,Le=Vo(Be,["defaultOpen"]),ze={open:xe.value===0,close:Ce.close};return k({props:Le,slot:ze,slots:ee,attrs:ce,name:"Disclosure"})}}});defineComponent({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(V,{attrs:ee,slots:ce,expose:_e}){let de=C("DisclosureButton"),xe=H$1(),Te=xe===null?!1:xe===de.panelId,j=ref(null);_e({el:j,$el:j}),Te||watchEffect(()=>{de.button.value=j.value});let Ce=b$2(computed(()=>({as:V.as,type:ee.type})),j);function Pe(){var Be;V.disabled||(Te?(de.toggleDisclosure(),(Be=t$1(de.button))==null||Be.focus()):de.toggleDisclosure())}function Le(Be){var $e;if(!V.disabled)if(Te)switch(Be.key){case o$1.Space:case o$1.Enter:Be.preventDefault(),Be.stopPropagation(),de.toggleDisclosure(),($e=t$1(de.button))==null||$e.focus();break}else switch(Be.key){case o$1.Space:case o$1.Enter:Be.preventDefault(),Be.stopPropagation(),de.toggleDisclosure();break}}function ze(Be){switch(Be.key){case o$1.Space:Be.preventDefault();break}}return()=>{let Be={open:de.disclosureState.value===0},$e=Te?{ref:j,type:Ce.value,onClick:Pe,onKeydown:Le}:{id:de.buttonId,ref:j,type:Ce.value,"aria-expanded":V.disabled?void 0:de.disclosureState.value===0,"aria-controls":t$1(de.panel)?de.panelId:void 0,disabled:V.disabled?!0:void 0,onClick:Pe,onKeydown:Le,onKeyup:ze};return k({props:vr(vr({},V),$e),slot:Be,attrs:ee,slots:ce,name:"DisclosureButton"})}}});defineComponent({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(V,{attrs:ee,slots:ce,expose:_e}){let de=C("DisclosurePanel");_e({el:de.panel,$el:de.panel}),provide(B,de.panelId);let xe=p$4(),Te=computed(()=>xe!==null?xe.value===l$3.Open:de.disclosureState.value===0);return()=>{let j={open:de.disclosureState.value===0,close:de.close},Ce={id:de.panelId,ref:de.panel};return k({props:vr(vr({},V),Ce),slot:j,attrs:ee,slots:ce,features:m$1.RenderStrategy|m$1.Static,visible:Te.value,name:"DisclosurePanel"})}}});var W$2=(V=>(V[V.Open=0]="Open",V[V.Closed=1]="Closed",V))(W$2||{}),J=(V=>(V[V.Pointer=0]="Pointer",V[V.Other=1]="Other",V))(J||{});function z(V){requestAnimationFrame(()=>requestAnimationFrame(V))}let E=Symbol("MenuContext");function D(V){let ee=inject(E,null);if(ee===null){let ce=new Error(`<${V} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(ce,D),ce}return ee}let fe$1=defineComponent({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(V,{slots:ee,attrs:ce}){let _e=ref(1),de=ref(null),xe=ref(null),Te=ref([]),j=ref(""),Ce=ref(null),Pe=ref(1);function Le(Be=$e=>$e){let $e=Ce.value!==null?Te.value[Ce.value]:null,Ve=v$2(Be(Te.value.slice()),Xe=>t$1(Xe.dataRef.domRef)),Ke=$e?Ve.indexOf($e):null;return Ke===-1&&(Ke=null),{items:Ve,activeItemIndex:Ke}}let ze={menuState:_e,buttonRef:de,itemsRef:xe,items:Te,searchQuery:j,activeItemIndex:Ce,activationTrigger:Pe,closeMenu:()=>{_e.value=1,Ce.value=null},openMenu:()=>_e.value=0,goToItem(Be,$e,Ve){let Ke=Le(),Xe=x$4(Be===a$3.Specific?{focus:a$3.Specific,id:$e}:{focus:Be},{resolveItems:()=>Ke.items,resolveActiveIndex:()=>Ke.activeItemIndex,resolveId:It=>It.id,resolveDisabled:It=>It.dataRef.disabled});j.value="",Ce.value=Xe,Pe.value=Ve!=null?Ve:1,Te.value=Ke.items},search(Be){let $e=j.value!==""?0:1;j.value+=Be.toLowerCase();let Ve=(Ce.value!==null?Te.value.slice(Ce.value+$e).concat(Te.value.slice(0,Ce.value+$e)):Te.value).find(Xe=>Xe.dataRef.textValue.startsWith(j.value)&&!Xe.dataRef.disabled),Ke=Ve?Te.value.indexOf(Ve):-1;Ke===-1||Ke===Ce.value||(Ce.value=Ke,Pe.value=1)},clearSearch(){j.value=""},registerItem(Be,$e){let Ve=Le(Ke=>[...Ke,{id:Be,dataRef:$e}]);Te.value=Ve.items,Ce.value=Ve.activeItemIndex,Pe.value=1},unregisterItem(Be){let $e=Le(Ve=>{let Ke=Ve.findIndex(Xe=>Xe.id===Be);return Ke!==-1&&Ve.splice(Ke,1),Ve});Te.value=$e.items,Ce.value=$e.activeItemIndex,Pe.value=1}};return g$4([de,xe],(Be,$e)=>{var Ve;_e.value===0&&(ze.closeMenu(),S$1($e,b$1.Loose)||(Be.preventDefault(),(Ve=t$1(de))==null||Ve.focus()))}),provide(E,ze),c$3(computed(()=>u$5(_e.value,{[0]:l$3.Open,[1]:l$3.Closed}))),()=>{let Be={open:_e.value===0};return k({props:V,slot:Be,slots:ee,attrs:ce,name:"Menu"})}}}),me=defineComponent({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"}},setup(V,{attrs:ee,slots:ce,expose:_e}){let de=D("MenuButton"),xe=`headlessui-menu-button-${t$2()}`;_e({el:de.buttonRef,$el:de.buttonRef});function Te(Le){switch(Le.key){case o$1.Space:case o$1.Enter:case o$1.ArrowDown:Le.preventDefault(),Le.stopPropagation(),de.openMenu(),nextTick(()=>{var ze;(ze=t$1(de.itemsRef))==null||ze.focus({preventScroll:!0}),de.goToItem(a$3.First)});break;case o$1.ArrowUp:Le.preventDefault(),Le.stopPropagation(),de.openMenu(),nextTick(()=>{var ze;(ze=t$1(de.itemsRef))==null||ze.focus({preventScroll:!0}),de.goToItem(a$3.Last)});break}}function j(Le){switch(Le.key){case o$1.Space:Le.preventDefault();break}}function Ce(Le){V.disabled||(de.menuState.value===0?(de.closeMenu(),nextTick(()=>{var ze;return(ze=t$1(de.buttonRef))==null?void 0:ze.focus({preventScroll:!0})})):(Le.preventDefault(),Le.stopPropagation(),de.openMenu(),z(()=>{var ze;return(ze=t$1(de.itemsRef))==null?void 0:ze.focus({preventScroll:!0})})))}let Pe=b$2(computed(()=>({as:V.as,type:ee.type})),de.buttonRef);return()=>{var Le;let ze={open:de.menuState.value===0},Be={ref:de.buttonRef,id:xe,type:Pe.value,"aria-haspopup":!0,"aria-controls":(Le=t$1(de.itemsRef))==null?void 0:Le.id,"aria-expanded":V.disabled?void 0:de.menuState.value===0,onKeydown:Te,onKeyup:j,onClick:Ce};return k({props:vr(vr({},V),Be),slot:ze,attrs:ee,slots:ce,name:"MenuButton"})}}}),pe=defineComponent({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(V,{attrs:ee,slots:ce,expose:_e}){let de=D("MenuItems"),xe=`headlessui-menu-items-${t$2()}`,Te=ref(null);_e({el:de.itemsRef,$el:de.itemsRef}),p$3({container:computed(()=>t$1(de.itemsRef)),enabled:computed(()=>de.menuState.value===0),accept(ze){return ze.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:ze.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(ze){ze.setAttribute("role","none")}});function j(ze){var Be;switch(Te.value&&clearTimeout(Te.value),ze.key){case o$1.Space:if(de.searchQuery.value!=="")return ze.preventDefault(),ze.stopPropagation(),de.search(ze.key);case o$1.Enter:if(ze.preventDefault(),ze.stopPropagation(),de.activeItemIndex.value!==null){let $e=de.items.value[de.activeItemIndex.value];(Be=t$1($e.dataRef.domRef))==null||Be.click()}de.closeMenu(),nextTick(()=>{var $e;return($e=t$1(de.buttonRef))==null?void 0:$e.focus({preventScroll:!0})});break;case o$1.ArrowDown:return ze.preventDefault(),ze.stopPropagation(),de.goToItem(a$3.Next);case o$1.ArrowUp:return ze.preventDefault(),ze.stopPropagation(),de.goToItem(a$3.Previous);case o$1.Home:case o$1.PageUp:return ze.preventDefault(),ze.stopPropagation(),de.goToItem(a$3.First);case o$1.End:case o$1.PageDown:return ze.preventDefault(),ze.stopPropagation(),de.goToItem(a$3.Last);case o$1.Escape:ze.preventDefault(),ze.stopPropagation(),de.closeMenu(),nextTick(()=>{var $e;return($e=t$1(de.buttonRef))==null?void 0:$e.focus({preventScroll:!0})});break;case o$1.Tab:ze.preventDefault(),ze.stopPropagation();break;default:ze.key.length===1&&(de.search(ze.key),Te.value=setTimeout(()=>de.clearSearch(),350));break}}function Ce(ze){switch(ze.key){case o$1.Space:ze.preventDefault();break}}let Pe=p$4(),Le=computed(()=>Pe!==null?Pe.value===l$3.Open:de.menuState.value===0);return()=>{var ze,Be;let $e={open:de.menuState.value===0},Ve={"aria-activedescendant":de.activeItemIndex.value===null||(ze=de.items.value[de.activeItemIndex.value])==null?void 0:ze.id,"aria-labelledby":(Be=t$1(de.buttonRef))==null?void 0:Be.id,id:xe,onKeydown:j,onKeyup:Ce,role:"menu",tabIndex:0,ref:de.itemsRef};return k({props:vr(vr({},V),Ve),slot:$e,attrs:ee,slots:ce,features:m$1.RenderStrategy|m$1.Static,visible:Le.value,name:"MenuItems"})}}}),ve=defineComponent({name:"MenuItem",props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1}},setup(V,{slots:ee,attrs:ce,expose:_e}){let de=D("MenuItem"),xe=`headlessui-menu-item-${t$2()}`,Te=ref(null);_e({el:Te,$el:Te});let j=computed(()=>de.activeItemIndex.value!==null?de.items.value[de.activeItemIndex.value].id===xe:!1),Ce=computed(()=>({disabled:V.disabled,textValue:"",domRef:Te}));onMounted(()=>{var $e,Ve;let Ke=(Ve=($e=t$1(Te))==null?void 0:$e.textContent)==null?void 0:Ve.toLowerCase().trim();Ke!==void 0&&(Ce.value.textValue=Ke)}),onMounted(()=>de.registerItem(xe,Ce)),onUnmounted(()=>de.unregisterItem(xe)),watchEffect(()=>{de.menuState.value===0&&(!j.value||de.activationTrigger.value!==0&&nextTick(()=>{var $e,Ve;return(Ve=($e=t$1(Te))==null?void 0:$e.scrollIntoView)==null?void 0:Ve.call($e,{block:"nearest"})}))});function Pe($e){if(V.disabled)return $e.preventDefault();de.closeMenu(),nextTick(()=>{var Ve;return(Ve=t$1(de.buttonRef))==null?void 0:Ve.focus({preventScroll:!0})})}function Le(){if(V.disabled)return de.goToItem(a$3.Nothing);de.goToItem(a$3.Specific,xe)}function ze(){V.disabled||j.value||de.goToItem(a$3.Specific,xe,0)}function Be(){V.disabled||!j.value||de.goToItem(a$3.Nothing)}return()=>{let{disabled:$e}=V,Ve={active:j.value,disabled:$e};return k({props:Xi(vr({},V),{id:xe,ref:Te,role:"menuitem",tabIndex:$e===!0?void 0:-1,"aria-disabled":$e===!0?!0:void 0,onClick:Pe,onFocus:Le,onPointermove:ze,onMousemove:ze,onPointerleave:Be,onMouseleave:Be}),slot:Ve,attrs:ce,slots:ee,name:"MenuItem"})}}}),u$1=Symbol("LabelContext");function a$1(){let V=inject(u$1,null);if(V===null){let ee=new Error("You used a <Label /> component, but it is not inside a parent.");throw Error.captureStackTrace&&Error.captureStackTrace(ee,a$1),ee}return V}function K$1({slot:V={},name:ee="Label",props:ce={}}={}){let _e=ref([]);function de(xe){return _e.value.push(xe),()=>{let Te=_e.value.indexOf(xe);Te!==-1&&_e.value.splice(Te,1)}}return provide(u$1,{register:de,slot:V,name:ee,props:ce}),computed(()=>_e.value.length>0?_e.value.join(" "):void 0)}let T=defineComponent({name:"Label",props:{as:{type:[Object,String],default:"label"},passive:{type:[Boolean],default:!1}},setup(V,{slots:ee,attrs:ce}){let _e=a$1(),de=`headlessui-label-${t$2()}`;return onMounted(()=>onUnmounted(_e.register(de))),()=>{let{name:xe="Label",slot:Te={},props:j={}}=_e,Be=V,{passive:Ce}=Be,Pe=Vo(Be,["passive"]),Le=Xi(vr({},Object.entries(j).reduce(($e,[Ve,Ke])=>Object.assign($e,{[Ve]:unref(Ke)}),{})),{id:de}),ze=vr(vr({},Pe),Le);return Ce&&delete ze.onClick,k({props:ze,slot:Te,attrs:ce,slots:ee,name:xe})}}}),b=Symbol("GroupContext"),W$1=defineComponent({name:"SwitchGroup",props:{as:{type:[Object,String],default:"template"}},setup(V,{slots:ee,attrs:ce}){let _e=ref(null),de=K$1({name:"SwitchLabel",props:{onClick(){!_e.value||(_e.value.click(),_e.value.focus({preventScroll:!0}))}}}),xe=P$1({name:"SwitchDescription"});return provide(b,{switchRef:_e,labelledby:de,describedby:xe}),()=>k({props:V,slot:{},slots:ee,attrs:ce,name:"SwitchGroup"})}}),X=defineComponent({name:"Switch",emits:{"update:modelValue":V=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:!1},name:{type:String,optional:!0},value:{type:String,optional:!0}},inheritAttrs:!1,setup(V,{emit:ee,attrs:ce,slots:_e,expose:de}){let xe=inject(b,null),Te=`headlessui-switch-${t$2()}`;function j(){ee("update:modelValue",!V.modelValue)}let Ce=ref(null),Pe=xe===null?Ce:xe.switchRef,Le=b$2(computed(()=>({as:V.as,type:ce.type})),Pe);de({el:Pe,$el:Pe});function ze(Ve){Ve.preventDefault(),j()}function Be(Ve){Ve.key===o$1.Space?(Ve.preventDefault(),j()):Ve.key===o$1.Enter&&p(Ve.currentTarget)}function $e(Ve){Ve.preventDefault()}return()=>{let Ot=V,{name:Ve,value:Ke,modelValue:Xe}=Ot,It=Vo(Ot,["name","value","modelValue"]),Ct={checked:Xe},yt={id:Te,ref:Pe,role:"switch",type:Le.value,tabIndex:0,"aria-checked":Xe,"aria-labelledby":xe==null?void 0:xe.labelledby.value,"aria-describedby":xe==null?void 0:xe.describedby.value,onClick:ze,onKeyup:Be,onKeypress:$e};return h$3(Fragment,[Ve!=null&&Xe!=null?h$3(l$2,O({as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:Xe,name:Ve,value:Ke})):null,k({props:vr(vr(vr({},ce),It),yt),slot:Ct,attrs:ce,slots:_e,name:"Switch"})])}}}),Y=T,Z=S;function l(V){let ee={called:!1};return(...ce)=>{if(!ee.called)return ee.called=!0,V(...ce)}}function r$1(){let V=[],ee=[],ce={enqueue(_e){ee.push(_e)},requestAnimationFrame(..._e){let de=requestAnimationFrame(..._e);ce.add(()=>cancelAnimationFrame(de))},nextFrame(..._e){ce.requestAnimationFrame(()=>{ce.requestAnimationFrame(..._e)})},setTimeout(..._e){let de=setTimeout(..._e);ce.add(()=>clearTimeout(de))},add(_e){V.push(_e)},dispose(){for(let _e of V.splice(0))_e()},async workQueue(){for(let _e of ee.splice(0))await _e()}};return ce}function m(V,...ee){V&&ee.length>0&&V.classList.add(...ee)}function d$1(V,...ee){V&&ee.length>0&&V.classList.remove(...ee)}var g=(V=>(V.Finished="finished",V.Cancelled="cancelled",V))(g||{});function F$1(V,ee){let ce=r$1();if(!V)return ce.dispose;let{transitionDuration:_e,transitionDelay:de}=getComputedStyle(V),[xe,Te]=[_e,de].map(j=>{let[Ce=0]=j.split(",").filter(Boolean).map(Pe=>Pe.includes("ms")?parseFloat(Pe):parseFloat(Pe)*1e3).sort((Pe,Le)=>Le-Pe);return Ce});return xe!==0?ce.setTimeout(()=>ee("finished"),xe+Te):ee("finished"),ce.add(()=>ee("cancelled")),ce.dispose}function L(V,ee,ce,_e,de,xe){let Te=r$1(),j=xe!==void 0?l(xe):()=>{};return d$1(V,...de),m(V,...ee,...ce),Te.nextFrame(()=>{d$1(V,...ce),m(V,..._e),Te.add(F$1(V,Ce=>(d$1(V,..._e,...ee),m(V,...de),j(Ce))))}),Te.add(()=>d$1(V,...ee,...ce,..._e,...de)),Te.add(()=>j("cancelled")),Te.dispose}function d(V=""){return V.split(" ").filter(ee=>ee.trim().length>1)}let F=Symbol("TransitionContext");var ae=(V=>(V.Visible="visible",V.Hidden="hidden",V))(ae||{});function le(){return inject(F,null)!==null}function ie(){let V=inject(F,null);if(V===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return V}function se(){let V=inject(R,null);if(V===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return V}let R=Symbol("NestingContext");function x(V){return"children"in V?x(V.children):V.value.filter(({state:ee})=>ee==="visible").length>0}function K(V){let ee=ref([]),ce=ref(!1);onMounted(()=>ce.value=!0),onUnmounted(()=>ce.value=!1);function _e(xe,Te=h$2.Hidden){let j=ee.value.findIndex(({id:Ce})=>Ce===xe);j!==-1&&(u$5(Te,{[h$2.Unmount](){ee.value.splice(j,1)},[h$2.Hidden](){ee.value[j].state="hidden"}}),!x(ee)&&ce.value&&(V==null||V()))}function de(xe){let Te=ee.value.find(({id:j})=>j===xe);return Te?Te.state!=="visible"&&(Te.state="visible"):ee.value.push({id:xe,state:"visible"}),()=>_e(xe,h$2.Unmount)}return{children:ee,register:de,unregister:_e}}let _$1=m$1.RenderStrategy,oe=defineComponent({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(V,{emit:ee,attrs:ce,slots:_e,expose:de}){if(!le()&&f$1())return()=>h$3(fe,Xi(vr({},V),{onBeforeEnter:()=>ee("beforeEnter"),onAfterEnter:()=>ee("afterEnter"),onBeforeLeave:()=>ee("beforeLeave"),onAfterLeave:()=>ee("afterLeave")}),_e);let xe=ref(null),Te=ref("visible"),j=computed(()=>V.unmount?h$2.Unmount:h$2.Hidden);de({el:xe,$el:xe});let{show:Ce,appear:Pe}=ie(),{register:Le,unregister:ze}=se(),Be={value:!0},$e=t$2(),Ve={value:!1},Ke=K(()=>{Ve.value||(Te.value="hidden",ze($e),ee("afterLeave"))});onMounted(()=>{let Dt=Le($e);onUnmounted(Dt)}),watchEffect(()=>{if(j.value===h$2.Hidden&&!!$e){if(Ce&&Te.value!=="visible"){Te.value="visible";return}u$5(Te.value,{hidden:()=>ze($e),visible:()=>Le($e)})}});let Xe=d(V.enter),It=d(V.enterFrom),Ct=d(V.enterTo),yt=d(V.entered),Ot=d(V.leave),Mt=d(V.leaveFrom),Pt=d(V.leaveTo);onMounted(()=>{watchEffect(()=>{if(Te.value==="visible"){let Dt=t$1(xe);if(Dt instanceof Comment&&Dt.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function At(Dt){let Gt=Be.value&&!Pe.value,Ut=t$1(xe);!Ut||!(Ut instanceof HTMLElement)||Gt||(Ve.value=!0,Ce.value&&ee("beforeEnter"),Ce.value||ee("beforeLeave"),Dt(Ce.value?L(Ut,Xe,It,Ct,yt,on=>{Ve.value=!1,on===g.Finished&&ee("afterEnter")}):L(Ut,Ot,Mt,Pt,yt,on=>{Ve.value=!1,on===g.Finished&&(x(Ke)||(Te.value="hidden",ze($e),ee("afterLeave")))})))}return onMounted(()=>{watch([Ce,Pe],(Dt,Gt,Ut)=>{At(Ut),Be.value=!1},{immediate:!0})}),provide(R,Ke),c$3(computed(()=>u$5(Te.value,{visible:l$3.Open,hidden:l$3.Closed}))),()=>{let mn=V,{appear:Dt,show:Gt,enter:Ut,enterFrom:on,enterTo:Vt,entered:An,leave:_n,leaveFrom:Yn,leaveTo:bn}=mn,Ln=Vo(mn,["appear","show","enter","enterFrom","enterTo","entered","leave","leaveFrom","leaveTo"]);return k({props:Xi(vr({},Ln),{ref:xe}),slot:{},slots:_e,attrs:ce,features:_$1,visible:Te.value==="visible",name:"TransitionChild"})}}}),ue=oe,fe=defineComponent({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(V,{emit:ee,attrs:ce,slots:_e}){let de=p$4(),xe=computed(()=>V.show===null&&de!==null?u$5(de.value,{[l$3.Open]:!0,[l$3.Closed]:!1}):V.show);watchEffect(()=>{if(![!0,!1].includes(xe.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let Te=ref(xe.value?"visible":"hidden"),j=K(()=>{Te.value="hidden"}),Ce={value:!0},Pe={show:xe,appear:computed(()=>V.appear||!Ce.value)};return onMounted(()=>{watchEffect(()=>{Ce.value=!1,xe.value?Te.value="visible":x(j)||(Te.value="hidden")})}),provide(R,j),provide(F,Pe),()=>{let Le=R$2(V,["show","appear","unmount"]),ze={unmount:V.unmount};return k({props:Xi(vr({},ze),{as:"template"}),slot:{},slots:Xi(vr({},_e),{default:()=>[h$3(ue,vr(vr(vr({onBeforeEnter:()=>ee("beforeEnter"),onAfterEnter:()=>ee("afterEnter"),onBeforeLeave:()=>ee("beforeLeave"),onAfterLeave:()=>ee("afterLeave")},ce),ze),Le),_e.default)]}),attrs:{},features:_$1,visible:Te.value==="visible",name:"Transition"})}}});function render$h(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z"})])}function render$g(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})])}function render$f(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])}function render$e(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function render$d(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})])}function render$c(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function render$b(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])}function render$a(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})])}function render$9(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})])}function render$8(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})])}function render$7(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])}function render$6(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})])}function render$5(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"})])}function render$4(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}function render$3(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function render$2(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function render$1(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[createVNode("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])}try{self["workbox:window:6.5.2"]&&_()}catch{}function n(V,ee){return new Promise(function(ce){var _e=new MessageChannel;_e.port1.onmessage=function(de){ce(de.data)},V.postMessage(ee,[_e.port2])})}function t(V,ee){for(var ce=0;ce<ee.length;ce++){var _e=ee[ce];_e.enumerable=_e.enumerable||!1,_e.configurable=!0,"value"in _e&&(_e.writable=!0),Object.defineProperty(V,_e.key,_e)}}function r(V,ee){(ee==null||ee>V.length)&&(ee=V.length);for(var ce=0,_e=new Array(ee);ce<ee;ce++)_e[ce]=V[ce];return _e}function e(V,ee){var ce;if(typeof Symbol=="undefined"||V[Symbol.iterator]==null){if(Array.isArray(V)||(ce=function(de,xe){if(de){if(typeof de=="string")return r(de,xe);var Te=Object.prototype.toString.call(de).slice(8,-1);return Te==="Object"&&de.constructor&&(Te=de.constructor.name),Te==="Map"||Te==="Set"?Array.from(de):Te==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Te)?r(de,xe):void 0}}(V))||ee&&V&&typeof V.length=="number"){ce&&(V=ce);var _e=0;return function(){return _e>=V.length?{done:!0}:{done:!1,value:V[_e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(ce=V[Symbol.iterator]()).next.bind(ce)}try{self["workbox:core:6.5.2"]&&_()}catch{}var i=function(){var V=this;this.promise=new Promise(function(ee,ce){V.resolve=ee,V.reject=ce})};function o(V,ee){var ce=location.href;return new URL(V,ce).href===new URL(ee,ce).href}var u=function(V,ee){this.type=V,Object.assign(this,ee)};function a(V,ee,ce){return ce?ee?ee(V):V:(V&&V.then||(V=Promise.resolve(V)),ee?V.then(ee):V)}function c(){}var f={type:"SKIP_WAITING"};function s(V,ee){if(!ee)return V&&V.then?V.then(c):Promise.resolve()}var v=function(V){var ee,ce;function _e(j,Ce){var Pe,Le;return Ce===void 0&&(Ce={}),(Pe=V.call(this)||this).nn={},Pe.tn=0,Pe.rn=new i,Pe.en=new i,Pe.on=new i,Pe.un=0,Pe.an=new Set,Pe.cn=function(){var ze=Pe.fn,Be=ze.installing;Pe.tn>0||!o(Be.scriptURL,Pe.sn.toString())||performance.now()>Pe.un+6e4?(Pe.vn=Be,ze.removeEventListener("updatefound",Pe.cn)):(Pe.hn=Be,Pe.an.add(Be),Pe.rn.resolve(Be)),++Pe.tn,Be.addEventListener("statechange",Pe.ln)},Pe.ln=function(ze){var Be=Pe.fn,$e=ze.target,Ve=$e.state,Ke=$e===Pe.vn,Xe={sw:$e,isExternal:Ke,originalEvent:ze};!Ke&&Pe.mn&&(Xe.isUpdate=!0),Pe.dispatchEvent(new u(Ve,Xe)),Ve==="installed"?Pe.wn=self.setTimeout(function(){Ve==="installed"&&Be.waiting===$e&&Pe.dispatchEvent(new u("waiting",Xe))},200):Ve==="activating"&&(clearTimeout(Pe.wn),Ke||Pe.en.resolve($e))},Pe.dn=function(ze){var Be=Pe.hn,$e=Be!==navigator.serviceWorker.controller;Pe.dispatchEvent(new u("controlling",{isExternal:$e,originalEvent:ze,sw:Be,isUpdate:Pe.mn})),$e||Pe.on.resolve(Be)},Pe.gn=(Le=function(ze){var Be=ze.data,$e=ze.ports,Ve=ze.source;return a(Pe.getSW(),function(){Pe.an.has(Ve)&&Pe.dispatchEvent(new u("message",{data:Be,originalEvent:ze,ports:$e,sw:Ve}))})},function(){for(var ze=[],Be=0;Be<arguments.length;Be++)ze[Be]=arguments[Be];try{return Promise.resolve(Le.apply(this,ze))}catch($e){return Promise.reject($e)}}),Pe.sn=j,Pe.nn=Ce,navigator.serviceWorker.addEventListener("message",Pe.gn),Pe}ce=V,(ee=_e).prototype=Object.create(ce.prototype),ee.prototype.constructor=ee,ee.__proto__=ce;var de,xe,Te=_e.prototype;return Te.register=function(j){var Ce=(j===void 0?{}:j).immediate,Pe=Ce!==void 0&&Ce;try{var Le=this;return function(ze,Be){var $e=ze();return $e&&$e.then?$e.then(Be):Be($e)}(function(){if(!Pe&&document.readyState!=="complete")return s(new Promise(function(ze){return window.addEventListener("load",ze)}))},function(){return Le.mn=Boolean(navigator.serviceWorker.controller),Le.yn=Le.pn(),a(Le.bn(),function(ze){Le.fn=ze,Le.yn&&(Le.hn=Le.yn,Le.en.resolve(Le.yn),Le.on.resolve(Le.yn),Le.yn.addEventListener("statechange",Le.ln,{once:!0}));var Be=Le.fn.waiting;return Be&&o(Be.scriptURL,Le.sn.toString())&&(Le.hn=Be,Promise.resolve().then(function(){Le.dispatchEvent(new u("waiting",{sw:Be,wasWaitingBeforeRegister:!0}))}).then(function(){})),Le.hn&&(Le.rn.resolve(Le.hn),Le.an.add(Le.hn)),Le.fn.addEventListener("updatefound",Le.cn),navigator.serviceWorker.addEventListener("controllerchange",Le.dn),Le.fn})})}catch(ze){return Promise.reject(ze)}},Te.update=function(){try{return this.fn?s(this.fn.update()):void 0}catch(j){return Promise.reject(j)}},Te.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},Te.messageSW=function(j){try{return a(this.getSW(),function(Ce){return n(Ce,j)})}catch(Ce){return Promise.reject(Ce)}},Te.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,f)},Te.pn=function(){var j=navigator.serviceWorker.controller;return j&&o(j.scriptURL,this.sn.toString())?j:void 0},Te.bn=function(){try{var j=this;return function(Ce,Pe){try{var Le=Ce()}catch(ze){return Pe(ze)}return Le&&Le.then?Le.then(void 0,Pe):Le}(function(){return a(navigator.serviceWorker.register(j.sn,j.nn),function(Ce){return j.un=performance.now(),Ce})},function(Ce){throw Ce})}catch(Ce){return Promise.reject(Ce)}},de=_e,(xe=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&t(de.prototype,xe),_e}(function(){function V(){this.Pn=new Map}var ee=V.prototype;return ee.addEventListener=function(ce,_e){this.Sn(ce).add(_e)},ee.removeEventListener=function(ce,_e){this.Sn(ce).delete(_e)},ee.dispatchEvent=function(ce){ce.target=this;for(var _e,de=e(this.Sn(ce.type));!(_e=de()).done;)(0,_e.value)(ce)},ee.Sn=function(ce){return this.Pn.has(ce)||this.Pn.set(ce,new Set),this.Pn.get(ce)},V}()),isVue2=!1;/*!
  * pinia v2.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let activePinia;const setActivePinia=V=>activePinia=V,piniaSymbol=Symbol();function isPlainObject$1(V){return V&&typeof V=="object"&&Object.prototype.toString.call(V)==="[object Object]"&&typeof V.toJSON!="function"}var MutationType;(function(V){V.direct="direct",V.patchObject="patch object",V.patchFunction="patch function"})(MutationType||(MutationType={}));function createPinia(){const V=effectScope(!0),ee=V.run(()=>ref({}));let ce=[],_e=[];const de=markRaw({install(xe){setActivePinia(de),de._a=xe,xe.provide(piniaSymbol,de),xe.config.globalProperties.$pinia=de,_e.forEach(Te=>ce.push(Te)),_e=[]},use(xe){return!this._a&&!isVue2?_e.push(xe):ce.push(xe),this},_p:ce,_a:null,_e:V,_s:new Map,state:ee});return de}const noop=()=>{};function addSubscription(V,ee,ce,_e=noop){V.push(ee);const de=()=>{const xe=V.indexOf(ee);xe>-1&&(V.splice(xe,1),_e())};return!ce&&getCurrentInstance()&&onUnmounted(de),de}function triggerSubscriptions(V,...ee){V.slice().forEach(ce=>{ce(...ee)})}function mergeReactiveObjects(V,ee){for(const ce in ee){if(!ee.hasOwnProperty(ce))continue;const _e=ee[ce],de=V[ce];isPlainObject$1(de)&&isPlainObject$1(_e)&&V.hasOwnProperty(ce)&&!isRef(_e)&&!isReactive(_e)?V[ce]=mergeReactiveObjects(de,_e):V[ce]=_e}return V}const skipHydrateSymbol=Symbol();function shouldHydrate(V){return!isPlainObject$1(V)||!V.hasOwnProperty(skipHydrateSymbol)}const{assign}=Object;function isComputed(V){return!!(isRef(V)&&V.effect)}function createOptionsStore(V,ee,ce,_e){const{state:de,actions:xe,getters:Te}=ee,j=ce.state.value[V];let Ce;function Pe(){j||(ce.state.value[V]=de?de():{});const Le=toRefs(ce.state.value[V]);return assign(Le,xe,Object.keys(Te||{}).reduce((ze,Be)=>(ze[Be]=markRaw(computed(()=>{setActivePinia(ce);const $e=ce._s.get(V);return Te[Be].call($e,$e)})),ze),{}))}return Ce=createSetupStore(V,Pe,ee,ce),Ce.$reset=function(){const ze=de?de():{};this.$patch(Be=>{assign(Be,ze)})},Ce}function createSetupStore(V,ee,ce={},_e,de){let xe;const Te=ce.state,j=assign({actions:{}},ce),Ce={deep:!0};let Pe,Le,ze=markRaw([]),Be=markRaw([]),$e;const Ve=_e.state.value[V];!Te&&!Ve&&(_e.state.value[V]={}),ref({});function Ke(Pt){let At;Pe=Le=!1,typeof Pt=="function"?(Pt(_e.state.value[V]),At={type:MutationType.patchFunction,storeId:V,events:$e}):(mergeReactiveObjects(_e.state.value[V],Pt),At={type:MutationType.patchObject,payload:Pt,storeId:V,events:$e}),nextTick().then(()=>{Pe=!0}),Le=!0,triggerSubscriptions(ze,At,_e.state.value[V])}const Xe=noop;function It(){xe.stop(),ze=[],Be=[],_e._s.delete(V)}function Ct(Pt,At){return function(){setActivePinia(_e);const Dt=Array.from(arguments),Gt=[],Ut=[];function on(_n){Gt.push(_n)}function Vt(_n){Ut.push(_n)}triggerSubscriptions(Be,{args:Dt,name:Pt,store:Ot,after:on,onError:Vt});let An;try{An=At.apply(this&&this.$id===V?this:Ot,Dt)}catch(_n){throw triggerSubscriptions(Ut,_n),_n}return An instanceof Promise?An.then(_n=>(triggerSubscriptions(Gt,_n),_n)).catch(_n=>(triggerSubscriptions(Ut,_n),Promise.reject(_n))):(triggerSubscriptions(Gt,An),An)}}const yt={_p:_e,$id:V,$onAction:addSubscription.bind(null,Be),$patch:Ke,$reset:Xe,$subscribe(Pt,At={}){const Dt=addSubscription(ze,Pt,At.detached,()=>Gt()),Gt=xe.run(()=>watch(()=>_e.state.value[V],Ut=>{(At.flush==="sync"?Le:Pe)&&Pt({storeId:V,type:MutationType.direct,events:$e},Ut)},assign({},Ce,At)));return Dt},$dispose:It},Ot=reactive(assign({},yt));_e._s.set(V,Ot);const Mt=_e._e.run(()=>(xe=effectScope(),xe.run(()=>ee())));for(const Pt in Mt){const At=Mt[Pt];if(isRef(At)&&!isComputed(At)||isReactive(At))Te||(Ve&&shouldHydrate(At)&&(isRef(At)?At.value=Ve[Pt]:mergeReactiveObjects(At,Ve[Pt])),_e.state.value[V][Pt]=At);else if(typeof At=="function"){const Dt=Ct(Pt,At);Mt[Pt]=Dt,j.actions[Pt]=At}}return assign(Ot,Mt),assign(toRaw(Ot),Mt),Object.defineProperty(Ot,"$state",{get:()=>_e.state.value[V],set:Pt=>{Ke(At=>{assign(At,Pt)})}}),_e._p.forEach(Pt=>{assign(Ot,xe.run(()=>Pt({store:Ot,app:_e._a,pinia:_e,options:j})))}),Ve&&Te&&ce.hydrate&&ce.hydrate(Ot.$state,Ve),Pe=!0,Le=!0,Ot}function defineStore(V,ee,ce){let _e,de;const xe=typeof ee=="function";typeof V=="string"?(_e=V,de=xe?ce:ee):(de=V,_e=V.id);function Te(j,Ce){const Pe=getCurrentInstance();return j=j||Pe&&inject(piniaSymbol),j&&setActivePinia(j),j=activePinia,j._s.has(_e)||(xe?createSetupStore(_e,ee,de,j):createOptionsStore(_e,de,j)),j._s.get(_e)}return Te.$id=_e,Te}var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}var mapboxGl={exports:{}};(function(V,ee){(function(ce,_e){V.exports=_e()})(commonjsGlobal,function(){var ce,_e,de;function xe(j,Ce){if(!ce)ce=Ce;else if(!_e)_e=Ce;else{var Pe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+ce+")(sharedChunk); ("+_e+")(sharedChunk); self.onerror = null;",Le={};ce(Le),de=Ce(Le),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(de.workerUrl=window.URL.createObjectURL(new Blob([Pe],{type:"text/javascript"})))}}xe(["exports"],function(j){var Ce=typeof self!="undefined"?self:{},Pe=Le;function Le(U,y,I,G){this.cx=3*U,this.bx=3*(I-U)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*y,this.by=3*(G-y)-this.cy,this.ay=1-this.cy-this.by,this.p1x=U,this.p1y=G,this.p2x=I,this.p2y=G}Le.prototype.sampleCurveX=function(U){return((this.ax*U+this.bx)*U+this.cx)*U},Le.prototype.sampleCurveY=function(U){return((this.ay*U+this.by)*U+this.cy)*U},Le.prototype.sampleCurveDerivativeX=function(U){return(3*this.ax*U+2*this.bx)*U+this.cx},Le.prototype.solveCurveX=function(U,y){var I,G,Q,ne,he;for(y===void 0&&(y=1e-6),Q=U,he=0;he<8;he++){if(ne=this.sampleCurveX(Q)-U,Math.abs(ne)<y)return Q;var ge=this.sampleCurveDerivativeX(Q);if(Math.abs(ge)<1e-6)break;Q-=ne/ge}if((Q=U)<(I=0))return I;if(Q>(G=1))return G;for(;I<G;){if(ne=this.sampleCurveX(Q),Math.abs(ne-U)<y)return Q;U>ne?I=Q:G=Q,Q=.5*(G-I)+I}return Q},Le.prototype.solve=function(U,y){return this.sampleCurveY(this.solveCurveX(U,y))};var ze=Be;function Be(U,y){this.x=U,this.y=y}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(U){return this.clone()._add(U)},sub:function(U){return this.clone()._sub(U)},multByPoint:function(U){return this.clone()._multByPoint(U)},divByPoint:function(U){return this.clone()._divByPoint(U)},mult:function(U){return this.clone()._mult(U)},div:function(U){return this.clone()._div(U)},rotate:function(U){return this.clone()._rotate(U)},rotateAround:function(U,y){return this.clone()._rotateAround(U,y)},matMult:function(U){return this.clone()._matMult(U)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(U){return this.x===U.x&&this.y===U.y},dist:function(U){return Math.sqrt(this.distSqr(U))},distSqr:function(U){var y=U.x-this.x,I=U.y-this.y;return y*y+I*I},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(U){return Math.atan2(this.y-U.y,this.x-U.x)},angleWith:function(U){return this.angleWithSep(U.x,U.y)},angleWithSep:function(U,y){return Math.atan2(this.x*y-this.y*U,this.x*U+this.y*y)},_matMult:function(U){var y=U[2]*this.x+U[3]*this.y;return this.x=U[0]*this.x+U[1]*this.y,this.y=y,this},_add:function(U){return this.x+=U.x,this.y+=U.y,this},_sub:function(U){return this.x-=U.x,this.y-=U.y,this},_mult:function(U){return this.x*=U,this.y*=U,this},_div:function(U){return this.x/=U,this.y/=U,this},_multByPoint:function(U){return this.x*=U.x,this.y*=U.y,this},_divByPoint:function(U){return this.x/=U.x,this.y/=U.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var U=this.y;return this.y=this.x,this.x=-U,this},_rotate:function(U){var y=Math.cos(U),I=Math.sin(U),G=I*this.x+y*this.y;return this.x=y*this.x-I*this.y,this.y=G,this},_rotateAround:function(U,y){var I=Math.cos(U),G=Math.sin(U),Q=y.y+G*(this.x-y.x)+I*(this.y-y.y);return this.x=y.x+I*(this.x-y.x)-G*(this.y-y.y),this.y=Q,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(U){return U instanceof Be?U:Array.isArray(U)?new Be(U[0],U[1]):U};const $e=Math.PI/180,Ve=180/Math.PI;function Ke(U){return U*$e}function Xe(U){return U*Ve}const It=[[0,0],[1,0],[1,1],[0,1]];function Ct(U){if(U<=0)return 0;if(U>=1)return 1;const y=U*U,I=y*U;return 4*(U<.5?I:3*(U-y)+I-.75)}function yt(U,y,I,G){const Q=new Pe(U,y,I,G);return function(ne){return Q.solve(ne)}}const Ot=yt(.25,.1,.25,1);function Mt(U,y,I){return Math.min(I,Math.max(y,U))}function Pt(U,y,I){return(I=Mt((I-U)/(y-U),0,1))*I*(3-2*I)}function At(U,y,I){const G=I-y,Q=((U-y)%G+G)%G+y;return Q===y?I:Q}function Dt(U,y,I){if(!U.length)return I(null,[]);let G=U.length;const Q=new Array(U.length);let ne=null;U.forEach((he,ge)=>{y(he,(we,Ee)=>{we&&(ne=we),Q[ge]=Ee,--G==0&&I(ne,Q)})})}function Gt(U){const y=[];for(const I in U)y.push(U[I]);return y}function Ut(U,...y){for(const I of y)for(const G in I)U[G]=I[G];return U}let on=1;function Vt(){return on++}function An(){return function U(y){return y?(y^Math.random()*(16>>y/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,U)}()}function _n(U){return U<=1?1:Math.pow(2,Math.ceil(Math.log(U)/Math.LN2))}function Yn(U){return!!U&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(U)}function bn(U,y){U.forEach(I=>{y[I]&&(y[I]=y[I].bind(y))})}function Ln(U,y){return U.indexOf(y,U.length-y.length)!==-1}function mn(U,y,I){const G={};for(const Q in U)G[Q]=y.call(I||this,U[Q],Q,U);return G}function Xn(U,y,I){const G={};for(const Q in U)y.call(I||this,U[Q],Q,U)&&(G[Q]=U[Q]);return G}function sr(U){return Array.isArray(U)?U.map(sr):typeof U=="object"&&U?mn(U,sr):U}const Pr={};function er(U){Pr[U]||(typeof console!="undefined"&&console.warn(U),Pr[U]=!0)}function rr(U,y,I){return(I.y-U.y)*(y.x-U.x)>(y.y-U.y)*(I.x-U.x)}function Vr(U){let y=0;for(let I,G,Q=0,ne=U.length,he=ne-1;Q<ne;he=Q++)I=U[Q],G=U[he],y+=(G.x-I.x)*(I.y+G.y);return y}function Wt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Rn(U){const y={};if(U.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(I,G,Q,ne)=>{const he=Q||ne;return y[G]=!he||he.toLowerCase(),""}),y["max-age"]){const I=parseInt(y["max-age"],10);isNaN(I)?delete y["max-age"]:y["max-age"]=I}return y}let ln=null;function Un(U){if(ln==null){const y=U.navigator?U.navigator.userAgent:null;ln=!!U.safari||!(!y||!(/\b(iPad|iPhone|iPod)\b/.test(y)||y.match("Safari")&&!y.match("Chrome")))}return ln}function dr(U){try{const y=Ce[U];return y.setItem("_mapbox_test_",1),y.removeItem("_mapbox_test_"),!0}catch{return!1}}function _r(U,y){return[U[4*y],U[4*y+1],U[4*y+2],U[4*y+3]]}const pr=Ce.performance;function tr(U){const y=U?U.url.toString():void 0;return pr.getEntriesByName(y)}var ft="2.10.0";let wt,qt,cn,an;const yn={now:()=>cn!==void 0?cn:Ce.performance.now(),setNow(U){cn=U},restoreNow(){cn=void 0},frame(U){const y=Ce.requestAnimationFrame(U);return{cancel:()=>Ce.cancelAnimationFrame(y)}},getImageData(U,y=0){const{width:I,height:G}=U;an||(an=Ce.document.createElement("canvas"));const Q=an.getContext("2d");if(!Q)throw new Error("failed to create canvas 2d context");return(I>an.width||G>an.height)&&(an.width=I,an.height=G),Q.clearRect(-y,-y,I+2*y,G+2*y),Q.drawImage(U,0,0,I,G),Q.getImageData(-y,-y,I+2*y,G+2*y)},resolveURL:U=>(wt||(wt=Ce.document.createElement("a")),wt.href=U,wt.href),get devicePixelRatio(){return Ce.devicePixelRatio},get prefersReducedMotion(){return!!Ce.matchMedia&&(qt==null&&(qt=Ce.matchMedia("(prefers-reduced-motion: reduce)")),qt.matches)}};let kn;const en={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(kn==null){const U=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{kn={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):U}catch{kn=U}}return kn},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Tn={supported:!1,testSupport:function(U){!Bn&&Nn&&(Gn?Jn(U):fn=U)}};let fn,Nn,Bn=!1,Gn=!1;function Jn(U){const y=U.createTexture();U.bindTexture(U.TEXTURE_2D,y);try{if(U.texImage2D(U.TEXTURE_2D,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,Nn),U.isContextLost())return;Tn.supported=!0}catch{}U.deleteTexture(y),Bn=!0}Ce.document&&(Nn=Ce.document.createElement("img"),Nn.onload=function(){fn&&Jn(fn),fn=null,Gn=!0},Nn.onerror=function(){Bn=!0,fn=null},Nn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gr="01",xr="NO_ACCESS_TOKEN";function br(U){return U.indexOf("mapbox:")===0}function Ir(U){return en.API_URL_REGEX.test(U)}const gi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function si(U){const y=U.match(gi);if(!y)throw new Error("Unable to parse URL object");return{protocol:y[1],authority:y[2],path:y[3]||"/",params:y[4]?y[4].split("&"):[]}}function Ni(U){const y=U.params.length?`?${U.params.join("&")}`:"";return`${U.protocol}://${U.authority}${U.path}${y}`}function ro(U){if(!U)return null;const y=U.split(".");if(!y||y.length!==3)return null;try{return JSON.parse(decodeURIComponent(Ce.atob(y[1]).split("").map(I=>"%"+("00"+I.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class wo{constructor(y){this.type=y,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(y){const I=ro(en.ACCESS_TOKEN);let G="";return G=I&&I.u?Ce.btoa(encodeURIComponent(I.u).replace(/%([0-9A-F]{2})/g,(Q,ne)=>String.fromCharCode(Number("0x"+ne)))):en.ACCESS_TOKEN||"",y?`mapbox.eventData.${y}:${G}`:`mapbox.eventData:${G}`}fetchEventData(){const y=dr("localStorage"),I=this.getStorageKey(),G=this.getStorageKey("uuid");if(y)try{const Q=Ce.localStorage.getItem(I);Q&&(this.eventData=JSON.parse(Q));const ne=Ce.localStorage.getItem(G);ne&&(this.anonId=ne)}catch{er("Unable to read from LocalStorage")}}saveEventData(){const y=dr("localStorage"),I=this.getStorageKey(),G=this.getStorageKey("uuid");if(y)try{Ce.localStorage.setItem(G,this.anonId),Object.keys(this.eventData).length>=1&&Ce.localStorage.setItem(I,JSON.stringify(this.eventData))}catch{er("Unable to write to LocalStorage")}}processRequests(y){}postEvent(y,I,G,Q){if(!en.EVENTS_URL)return;const ne=si(en.EVENTS_URL);ne.params.push(`access_token=${Q||en.ACCESS_TOKEN||""}`);const he={event:this.type,created:new Date(y).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:ft,skuId:gr,userId:this.anonId},ge=I?Ut(he,I):he,we={url:Ni(ne),headers:{"Content-Type":"text/plain"},body:JSON.stringify([ge])};this.pendingRequest=tn(we,Ee=>{this.pendingRequest=null,G(Ee),this.saveEventData(),this.processRequests(Q)})}queueRequest(y,I){this.queue.push(y),this.processRequests(I)}}const li=new class extends wo{constructor(U){super("appUserTurnstile"),this._customAccessToken=U}postTurnstileEvent(U,y){en.EVENTS_URL&&en.ACCESS_TOKEN&&Array.isArray(U)&&U.some(I=>br(I)||Ir(I))&&this.queueRequest(Date.now(),y)}processRequests(U){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const y=ro(en.ACCESS_TOKEN),I=y?y.u:en.ACCESS_TOKEN;let G=I!==this.eventData.tokenU;Yn(this.anonId)||(this.anonId=An(),G=!0);const Q=this.queue.shift();if(this.eventData.lastSuccess){const ne=new Date(this.eventData.lastSuccess),he=new Date(Q),ge=(Q-this.eventData.lastSuccess)/864e5;G=G||ge>=1||ge<-1||ne.getDate()!==he.getDate()}else G=!0;G?this.postEvent(Q,{"enabled.telemetry":!1},ne=>{ne||(this.eventData.lastSuccess=Q,this.eventData.tokenU=I)},U):this.processRequests()}},yi=li.postTurnstileEvent.bind(li),To=new class extends wo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(U,y,I,G){this.skuToken=y,this.errorCb=G,en.EVENTS_URL&&(I||en.ACCESS_TOKEN?this.queueRequest({id:U,timestamp:Date.now()},I):this.errorCb(new Error(xr)))}processRequests(U){if(this.pendingRequest||this.queue.length===0)return;const{id:y,timestamp:I}=this.queue.shift();y&&this.success[y]||(this.anonId||this.fetchEventData(),Yn(this.anonId)||(this.anonId=An()),this.postEvent(I,{skuToken:this.skuToken},G=>{G?this.errorCb(G):y&&(this.success[y]=!0)},U))}},Aa=To.postMapLoadEvent.bind(To),Sa=new class extends wo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(U,y,I,G){if(!en.API_URL||!en.SESSION_PATH)return;const Q=si(en.API_URL+en.SESSION_PATH);Q.params.push(`sku=${y||""}`),Q.params.push(`access_token=${G||en.ACCESS_TOKEN||""}`);const ne={url:Ni(Q),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Sn(ne,he=>{this.pendingRequest=null,I(he),this.saveEventData(),this.processRequests(G)})}getSessionAPI(U,y,I,G){this.skuToken=y,this.errorCb=G,en.SESSION_PATH&&en.API_URL&&(I||en.ACCESS_TOKEN?this.queueRequest({id:U,timestamp:Date.now()},I):this.errorCb(new Error(xr)))}processRequests(U){if(this.pendingRequest||this.queue.length===0)return;const{id:y,timestamp:I}=this.queue.shift();y&&this.success[y]||this.getSession(I,this.skuToken,G=>{G?this.errorCb(G):y&&(this.success[y]=!0)},U)}},Sl=Sa.getSessionAPI.bind(Sa),Eo=new Set;let co,ls=500,Ca=50,Mi={};function Os(U){const y=He(U);let I,G;y&&y.forEach(ne=>{const he=ne.split("=");he[0]==="language"?I=he[1]:he[0]==="worldview"&&(G=he[1])});let Q="mapbox-tiles";return I&&(Q+=`-${I}`),G&&(Q+=`-${G}`),Q}function at(){try{return Ce.caches}catch{}}function qe(U){const y=at();y&&!Mi[U]&&(Mi[U]=y.open(U))}function He(U){const y=U.indexOf("?");return y>0?U.slice(y+1).split("&"):[]}function ot(U){const y=U.indexOf("?");if(y<0)return U;const I=He(U).filter(G=>{const Q=G.split("=");return Q[0]==="language"||Q[0]==="worldview"});return I.length?`${U.slice(0,y)}?${I.join("&")}`:U.slice(0,y)}let ut=1/0;const Tt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Tt);class zt extends Error{constructor(y,I,G){I===401&&Ir(G)&&(y+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(y),this.status=I,this.url=G}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const kt=Wt()?()=>self.worker&&self.worker.referrer:()=>(Ce.location.protocol==="blob:"?Ce.parent:Ce).location.href,Et=function(U,y){if(!(/^file:/.test(I=U.url)||/^file:/.test(kt())&&!/^\w+:/.test(I))){if(Ce.fetch&&Ce.Request&&Ce.AbortController&&Ce.Request.prototype.hasOwnProperty("signal"))return function(G,Q){const ne=new Ce.AbortController,he=new Ce.Request(G.url,{method:G.method||"GET",body:G.body,credentials:G.credentials,headers:G.headers,referrer:kt(),signal:ne.signal});let ge=!1,we=!1;const Ee=(ke=he.url).indexOf("sku=")>0&&Ir(ke);var ke;G.type==="json"&&he.headers.set("Accept","application/json");const De=(Ne,Ge,We)=>{if(we)return;if(Ne&&Ne.message!=="SecurityError"&&er(Ne),Ge&&We)return Oe(Ge);const Je=Date.now();Ce.fetch(he).then(st=>{if(st.ok){const pt=Ee?st.clone():null;return Oe(st,pt,Je)}return Q(new zt(st.statusText,st.status,G.url))}).catch(st=>{st.code!==20&&Q(new Error(st.message))})},Oe=(Ne,Ge,We)=>{(G.type==="arrayBuffer"?Ne.arrayBuffer():G.type==="json"?Ne.json():Ne.text()).then(Je=>{we||(Ge&&We&&function(st,pt,ct){const ht=Os(st.url);if(qe(ht),!Mi[ht])return;const bt={status:pt.status,statusText:pt.statusText,headers:new Ce.Headers};pt.headers.forEach((Ft,Ht)=>bt.headers.set(Ht,Ft));const mt=Rn(pt.headers.get("Cache-Control")||"");if(mt["no-store"])return;mt["max-age"]&&bt.headers.set("Expires",new Date(ct+1e3*mt["max-age"]).toUTCString());const $t=bt.headers.get("Expires");$t&&(new Date($t).getTime()-ct<42e4||function(Ft,Ht){if(co===void 0)try{new Response(new ReadableStream),co=!0}catch{co=!1}co?Ht(Ft.body):Ft.blob().then(Ht)}(pt,Ft=>{const Ht=new Ce.Response(Ft,bt);qe(ht),Mi[ht]&&Mi[ht].then(pn=>pn.put(ot(st.url),Ht)).catch(pn=>er(pn.message))}))}(he,Ge,We),ge=!0,Q(null,Je,Ne.headers.get("Cache-Control"),Ne.headers.get("Expires")))}).catch(Je=>{we||Q(new Error(Je.message))})};return Ee?function(Ne,Ge){const We=Os(Ne.url);if(qe(We),!Mi[We])return Ge(null);const Je=ot(Ne.url);Mi[We].then(st=>{st.match(Je).then(pt=>{const ct=function(ht){if(!ht)return!1;const bt=new Date(ht.headers.get("Expires")||0),mt=Rn(ht.headers.get("Cache-Control")||"");return bt>Date.now()&&!mt["no-cache"]}(pt);st.delete(Je),ct&&st.put(Je,pt.clone()),Ge(null,pt,ct)}).catch(Ge)}).catch(Ge)}(he,De):De(null,null),{cancel:()=>{we=!0,ge||ne.abort()}}}(U,y);if(Wt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",U,y,void 0,!0)}var I;return function(G,Q){const ne=new Ce.XMLHttpRequest;ne.open(G.method||"GET",G.url,!0),G.type==="arrayBuffer"&&(ne.responseType="arraybuffer");for(const he in G.headers)ne.setRequestHeader(he,G.headers[he]);return G.type==="json"&&(ne.responseType="text",ne.setRequestHeader("Accept","application/json")),ne.withCredentials=G.credentials==="include",ne.onerror=()=>{Q(new Error(ne.statusText))},ne.onload=()=>{if((ne.status>=200&&ne.status<300||ne.status===0)&&ne.response!==null){let he=ne.response;if(G.type==="json")try{he=JSON.parse(ne.response)}catch(ge){return Q(ge)}Q(null,he,ne.getResponseHeader("Cache-Control"),ne.getResponseHeader("Expires"))}else Q(new zt(ne.statusText,ne.status,G.url))},ne.send(G.body),{cancel:()=>ne.abort()}}(U,y)},Lt=function(U,y){return Et(Ut(U,{type:"arrayBuffer"}),y)},tn=function(U,y){return Et(Ut(U,{method:"POST"}),y)},Sn=function(U,y){return Et(Ut(U,{method:"GET"}),y)};function sn(U){const y=Ce.document.createElement("a");return y.href=U,y.protocol===Ce.document.location.protocol&&y.host===Ce.document.location.host}const Vn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let qn,On;qn=[],On=0;const Zn=function(U,y){if(Tn.supported&&(U.headers||(U.headers={}),U.headers.accept="image/webp,*/*"),On>=en.MAX_PARALLEL_IMAGE_REQUESTS){const ne={requestParameters:U,callback:y,cancelled:!1,cancel(){this.cancelled=!0}};return qn.push(ne),ne}On++;let I=!1;const G=()=>{if(!I)for(I=!0,On--;qn.length&&On<en.MAX_PARALLEL_IMAGE_REQUESTS;){const ne=qn.shift(),{requestParameters:he,callback:ge,cancelled:we}=ne;we||(ne.cancel=Zn(he,ge).cancel)}},Q=Lt(U,(ne,he,ge,we)=>{G(),ne?y(ne):he&&(Ce.createImageBitmap?function(Ee,ke){const De=new Ce.Blob([new Uint8Array(Ee)],{type:"image/png"});Ce.createImageBitmap(De).then(Oe=>{ke(null,Oe)}).catch(Oe=>{ke(new Error(`Could not load image because of ${Oe.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(he,(Ee,ke)=>y(Ee,ke,ge,we)):function(Ee,ke){const De=new Ce.Image,Oe=Ce.URL;De.onload=()=>{ke(null,De),Oe.revokeObjectURL(De.src),De.onload=null,Ce.requestAnimationFrame(()=>{De.src=Vn})},De.onerror=()=>ke(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Ne=new Ce.Blob([new Uint8Array(Ee)],{type:"image/png"});De.src=Ee.byteLength?Oe.createObjectURL(Ne):Vn}(he,(Ee,ke)=>y(Ee,ke,ge,we)))});return{cancel:()=>{Q.cancel(),G()}}};function lr(U,y,I){I[U]&&I[U].indexOf(y)!==-1||(I[U]=I[U]||[],I[U].push(y))}function kr(U,y,I){if(I&&I[U]){const G=I[U].indexOf(y);G!==-1&&I[U].splice(G,1)}}class Br{constructor(y,I={}){Ut(this,I),this.type=y}}class Rr extends Br{constructor(y,I={}){super("error",Ut({error:y},I))}}class jn{on(y,I){return this._listeners=this._listeners||{},lr(y,I,this._listeners),this}off(y,I){return kr(y,I,this._listeners),kr(y,I,this._oneTimeListeners),this}once(y,I){return I?(this._oneTimeListeners=this._oneTimeListeners||{},lr(y,I,this._oneTimeListeners),this):new Promise(G=>this.once(y,G))}fire(y,I){typeof y=="string"&&(y=new Br(y,I||{}));const G=y.type;if(this.listens(G)){y.target=this;const Q=this._listeners&&this._listeners[G]?this._listeners[G].slice():[];for(const ge of Q)ge.call(this,y);const ne=this._oneTimeListeners&&this._oneTimeListeners[G]?this._oneTimeListeners[G].slice():[];for(const ge of ne)kr(G,ge,this._oneTimeListeners),ge.call(this,y);const he=this._eventedParent;he&&(Ut(y,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),he.fire(y))}else y instanceof Rr&&console.error(y.error);return this}listens(y){return!!(this._listeners&&this._listeners[y]&&this._listeners[y].length>0||this._oneTimeListeners&&this._oneTimeListeners[y]&&this._oneTimeListeners[y].length>0||this._eventedParent&&this._eventedParent.listens(y))}setEventedParent(y,I){return this._eventedParent=y,this._eventedParentData=I,this}}var Zt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Bi(U,...y){for(const I of y)for(const G in I)U[G]=I[G];return U}function Qr(U){return U instanceof Number||U instanceof String||U instanceof Boolean?U.valueOf():U}function Ao(U){if(Array.isArray(U))return U.map(Ao);if(U instanceof Object&&!(U instanceof Number||U instanceof String||U instanceof Boolean)){const y={};for(const I in U)y[I]=Ao(U[I]);return y}return Qr(U)}class Ia extends Error{constructor(y,I){super(I),this.message=I,this.key=y}}var Ki=Ia;class Ma{constructor(y,I=[]){this.parent=y,this.bindings={};for(const[G,Q]of I)this.bindings[G]=Q}concat(y){return new Ma(this,y)}get(y){if(this.bindings[y])return this.bindings[y];if(this.parent)return this.parent.get(y);throw new Error(`${y} not found in scope.`)}has(y){return!!this.bindings[y]||!!this.parent&&this.parent.has(y)}}var Ph=Ma;const cs={kind:"null"},Cn={kind:"number"},ur={kind:"string"},hr={kind:"boolean"},Yi={kind:"color"},Ji={kind:"object"},ir={kind:"value"},Fs={kind:"collator"},Us={kind:"formatted"},$s={kind:"resolvedImage"};function Oi(U,y){return{kind:"array",itemType:U,N:y}}function Kr(U){if(U.kind==="array"){const y=Kr(U.itemType);return typeof U.N=="number"?`array<${y}, ${U.N}>`:U.itemType.kind==="value"?"array":`array<${y}>`}return U.kind}const tu=[cs,Cn,ur,hr,Yi,Us,Ji,Oi(ir),$s];function us(U,y){if(y.kind==="error")return null;if(U.kind==="array"){if(y.kind==="array"&&(y.N===0&&y.itemType.kind==="value"||!us(U.itemType,y.itemType))&&(typeof U.N!="number"||U.N===y.N))return null}else{if(U.kind===y.kind)return null;if(U.kind==="value"){for(const I of tu)if(!us(I,y))return null}}return`Expected ${Kr(U)} but found ${Kr(y)} instead.`}function Pa(U,y){return y.some(I=>I.kind===U.kind)}function So(U,y){return y.some(I=>I==="null"?U===null:I==="array"?Array.isArray(U):I==="object"?U&&!Array.isArray(U)&&typeof U=="object":I===typeof U)}function Cl(U){var y={exports:{}};return U(y,y.exports),y.exports}var Co=Cl(function(U,y){var I={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function G(ge){return(ge=Math.round(ge))<0?0:ge>255?255:ge}function Q(ge){return G(ge[ge.length-1]==="%"?parseFloat(ge)/100*255:parseInt(ge))}function ne(ge){return(we=ge[ge.length-1]==="%"?parseFloat(ge)/100:parseFloat(ge))<0?0:we>1?1:we;var we}function he(ge,we,Ee){return Ee<0?Ee+=1:Ee>1&&(Ee-=1),6*Ee<1?ge+(we-ge)*Ee*6:2*Ee<1?we:3*Ee<2?ge+(we-ge)*(2/3-Ee)*6:ge}try{y.parseCSSColor=function(ge){var we,Ee=ge.replace(/ /g,"").toLowerCase();if(Ee in I)return I[Ee].slice();if(Ee[0]==="#")return Ee.length===4?(we=parseInt(Ee.substr(1),16))>=0&&we<=4095?[(3840&we)>>4|(3840&we)>>8,240&we|(240&we)>>4,15&we|(15&we)<<4,1]:null:Ee.length===7&&(we=parseInt(Ee.substr(1),16))>=0&&we<=16777215?[(16711680&we)>>16,(65280&we)>>8,255&we,1]:null;var ke=Ee.indexOf("("),De=Ee.indexOf(")");if(ke!==-1&&De+1===Ee.length){var Oe=Ee.substr(0,ke),Ne=Ee.substr(ke+1,De-(ke+1)).split(","),Ge=1;switch(Oe){case"rgba":if(Ne.length!==4)return null;Ge=ne(Ne.pop());case"rgb":return Ne.length!==3?null:[Q(Ne[0]),Q(Ne[1]),Q(Ne[2]),Ge];case"hsla":if(Ne.length!==4)return null;Ge=ne(Ne.pop());case"hsl":if(Ne.length!==3)return null;var We=(parseFloat(Ne[0])%360+360)%360/360,Je=ne(Ne[1]),st=ne(Ne[2]),pt=st<=.5?st*(Je+1):st+Je-st*Je,ct=2*st-pt;return[G(255*he(ct,pt,We+1/3)),G(255*he(ct,pt,We)),G(255*he(ct,pt,We-1/3)),Ge];default:return null}}return null}}catch{}});class Ai{constructor(y,I,G,Q=1){this.r=y,this.g=I,this.b=G,this.a=Q}static parse(y){if(!y)return;if(y instanceof Ai)return y;if(typeof y!="string")return;const I=Co.parseCSSColor(y);return I?new Ai(I[0]/255*I[3],I[1]/255*I[3],I[2]/255*I[3],I[3]):void 0}toString(){const[y,I,G,Q]=this.toArray();return`rgba(${Math.round(y)},${Math.round(I)},${Math.round(G)},${Q})`}toArray(){const{r:y,g:I,b:G,a:Q}=this;return Q===0?[0,0,0,0]:[255*y/Q,255*I/Q,255*G/Q,Q]}toArray01(){const{r:y,g:I,b:G,a:Q}=this;return Q===0?[0,0,0,0]:[y/Q,I/Q,G/Q,Q]}toArray01PremultipliedAlpha(){const{r:y,g:I,b:G,a:Q}=this;return[y,I,G,Q]}}Ai.black=new Ai(0,0,0,1),Ai.white=new Ai(1,1,1,1),Ai.transparent=new Ai(0,0,0,0),Ai.red=new Ai(1,0,0,1),Ai.blue=new Ai(0,0,1,1);var zr=Ai;class Il{constructor(y,I,G){this.sensitivity=y?I?"variant":"case":I?"accent":"base",this.locale=G,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(y,I){return this.collator.compare(y,I)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ns{constructor(y,I,G,Q,ne){this.text=y.normalize?y.normalize():y,this.image=I,this.scale=G,this.fontStack=Q,this.textColor=ne}}class Pi{constructor(y){this.sections=y}static fromString(y){return new Pi([new Ns(y,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(y=>y.text.length!==0||y.image&&y.image.name.length!==0)}static factory(y){return y instanceof Pi?y:Pi.fromString(y)}toString(){return this.sections.length===0?"":this.sections.map(y=>y.text).join("")}serialize(){const y=["format"];for(const I of this.sections){if(I.image){y.push(["image",I.image.name]);continue}y.push(I.text);const G={};I.fontStack&&(G["text-font"]=["literal",I.fontStack.split(",")]),I.scale&&(G["font-scale"]=I.scale),I.textColor&&(G["text-color"]=["rgba"].concat(I.textColor.toArray())),y.push(G)}return y}}class ki{constructor(y){this.name=y.name,this.available=y.available}toString(){return this.name}static fromString(y){return y?new ki({name:y,available:!1}):null}serialize(){return["image",this.name]}}function Ml(U,y,I,G){return typeof U=="number"&&U>=0&&U<=255&&typeof y=="number"&&y>=0&&y<=255&&typeof I=="number"&&I>=0&&I<=255?G===void 0||typeof G=="number"&&G>=0&&G<=1?null:`Invalid rgba value [${[U,y,I,G].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof G=="number"?[U,y,I,G]:[U,y,I]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Io(U){if(U===null||typeof U=="string"||typeof U=="boolean"||typeof U=="number"||U instanceof zr||U instanceof Il||U instanceof Pi||U instanceof ki)return!0;if(Array.isArray(U)){for(const y of U)if(!Io(y))return!1;return!0}if(typeof U=="object"){for(const y in U)if(!Io(U[y]))return!1;return!0}return!1}function ni(U){if(U===null)return cs;if(typeof U=="string")return ur;if(typeof U=="boolean")return hr;if(typeof U=="number")return Cn;if(U instanceof zr)return Yi;if(U instanceof Il)return Fs;if(U instanceof Pi)return Us;if(U instanceof ki)return $s;if(Array.isArray(U)){const y=U.length;let I;for(const G of U){const Q=ni(G);if(I){if(I===Q)continue;I=ir;break}I=Q}return Oi(I||ir,y)}return Ji}function js(U){const y=typeof U;return U===null?"":y==="string"||y==="number"||y==="boolean"?String(U):U instanceof zr||U instanceof Pi||U instanceof ki?U.toString():JSON.stringify(U)}class Pl{constructor(y,I){this.type=y,this.value=I}static parse(y,I){if(y.length!==2)return I.error(`'literal' expression requires exactly one argument, but found ${y.length-1} instead.`);if(!Io(y[1]))return I.error("invalid value");const G=y[1];let Q=ni(G);const ne=I.expectedType;return Q.kind!=="array"||Q.N!==0||!ne||ne.kind!=="array"||typeof ne.N=="number"&&ne.N!==0||(Q=ne),new Pl(Q,G)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof zr?["rgba"].concat(this.value.toArray()):this.value instanceof Pi?this.value.serialize():this.value}}var Vs=Pl,ui=class{constructor(U){this.name="ExpressionEvaluationError",this.message=U}toJSON(){return this.message}};const Gs={string:ur,number:Cn,boolean:hr,object:Ji};class kl{constructor(y,I){this.type=y,this.args=I}static parse(y,I){if(y.length<2)return I.error("Expected at least one argument.");let G,Q=1;const ne=y[0];if(ne==="array"){let ge,we;if(y.length>2){const Ee=y[1];if(typeof Ee!="string"||!(Ee in Gs)||Ee==="object")return I.error('The item type argument of "array" must be one of string, number, boolean',1);ge=Gs[Ee],Q++}else ge=ir;if(y.length>3){if(y[2]!==null&&(typeof y[2]!="number"||y[2]<0||y[2]!==Math.floor(y[2])))return I.error('The length argument to "array" must be a positive integer literal',2);we=y[2],Q++}G=Oi(ge,we)}else G=Gs[ne];const he=[];for(;Q<y.length;Q++){const ge=I.parse(y[Q],Q,ir);if(!ge)return null;he.push(ge)}return new kl(G,he)}evaluate(y){for(let I=0;I<this.args.length;I++){const G=this.args[I].evaluate(y);if(!us(this.type,ni(G)))return G;if(I===this.args.length-1)throw new ui(`Expected value to be of type ${Kr(this.type)}, but found ${Kr(ni(G))} instead.`)}return null}eachChild(y){this.args.forEach(y)}outputDefined(){return this.args.every(y=>y.outputDefined())}serialize(){const y=this.type,I=[y.kind];if(y.kind==="array"){const G=y.itemType;if(G.kind==="string"||G.kind==="number"||G.kind==="boolean"){I.push(G.kind);const Q=y.N;(typeof Q=="number"||this.args.length>1)&&I.push(Q)}}return I.concat(this.args.map(G=>G.serialize()))}}var ji=kl;class qs{constructor(y){this.type=Us,this.sections=y}static parse(y,I){if(y.length<2)return I.error("Expected at least one argument.");const G=y[1];if(!Array.isArray(G)&&typeof G=="object")return I.error("First argument must be an image or text section.");const Q=[];let ne=!1;for(let he=1;he<=y.length-1;++he){const ge=y[he];if(ne&&typeof ge=="object"&&!Array.isArray(ge)){ne=!1;let we=null;if(ge["font-scale"]&&(we=I.parse(ge["font-scale"],1,Cn),!we))return null;let Ee=null;if(ge["text-font"]&&(Ee=I.parse(ge["text-font"],1,Oi(ur)),!Ee))return null;let ke=null;if(ge["text-color"]&&(ke=I.parse(ge["text-color"],1,Yi),!ke))return null;const De=Q[Q.length-1];De.scale=we,De.font=Ee,De.textColor=ke}else{const we=I.parse(y[he],1,ir);if(!we)return null;const Ee=we.type.kind;if(Ee!=="string"&&Ee!=="value"&&Ee!=="null"&&Ee!=="resolvedImage")return I.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ne=!0,Q.push({content:we,scale:null,font:null,textColor:null})}}return new qs(Q)}evaluate(y){return new Pi(this.sections.map(I=>{const G=I.content.evaluate(y);return ni(G)===$s?new Ns("",G,null,null,null):new Ns(js(G),null,I.scale?I.scale.evaluate(y):null,I.font?I.font.evaluate(y).join(","):null,I.textColor?I.textColor.evaluate(y):null)}))}eachChild(y){for(const I of this.sections)y(I.content),I.scale&&y(I.scale),I.font&&y(I.font),I.textColor&&y(I.textColor)}outputDefined(){return!1}serialize(){const y=["format"];for(const I of this.sections){y.push(I.content.serialize());const G={};I.scale&&(G["font-scale"]=I.scale.serialize()),I.font&&(G["text-font"]=I.font.serialize()),I.textColor&&(G["text-color"]=I.textColor.serialize()),y.push(G)}return y}}class ka{constructor(y){this.type=$s,this.input=y}static parse(y,I){if(y.length!==2)return I.error("Expected two arguments.");const G=I.parse(y[1],1,ur);return G?new ka(G):I.error("No image name provided.")}evaluate(y){const I=this.input.evaluate(y),G=ki.fromString(I);return G&&y.availableImages&&(G.available=y.availableImages.indexOf(I)>-1),G}eachChild(y){y(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const kh={"to-boolean":hr,"to-color":Yi,"to-number":Cn,"to-string":ur};class Rl{constructor(y,I){this.type=y,this.args=I}static parse(y,I){if(y.length<2)return I.error("Expected at least one argument.");const G=y[0];if((G==="to-boolean"||G==="to-string")&&y.length!==2)return I.error("Expected one argument.");const Q=kh[G],ne=[];for(let he=1;he<y.length;he++){const ge=I.parse(y[he],he,ir);if(!ge)return null;ne.push(ge)}return new Rl(Q,ne)}evaluate(y){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(y));if(this.type.kind==="color"){let I,G;for(const Q of this.args){if(I=Q.evaluate(y),G=null,I instanceof zr)return I;if(typeof I=="string"){const ne=y.parseColor(I);if(ne)return ne}else if(Array.isArray(I)&&(G=I.length<3||I.length>4?`Invalid rbga value ${JSON.stringify(I)}: expected an array containing either three or four numeric values.`:Ml(I[0],I[1],I[2],I[3]),!G))return new zr(I[0]/255,I[1]/255,I[2]/255,I[3])}throw new ui(G||`Could not parse color from value '${typeof I=="string"?I:String(JSON.stringify(I))}'`)}if(this.type.kind==="number"){let I=null;for(const G of this.args){if(I=G.evaluate(y),I===null)return 0;const Q=Number(I);if(!isNaN(Q))return Q}throw new ui(`Could not convert ${JSON.stringify(I)} to number.`)}return this.type.kind==="formatted"?Pi.fromString(js(this.args[0].evaluate(y))):this.type.kind==="resolvedImage"?ki.fromString(js(this.args[0].evaluate(y))):js(this.args[0].evaluate(y))}eachChild(y){this.args.forEach(y)}outputDefined(){return this.args.every(y=>y.outputDefined())}serialize(){if(this.type.kind==="formatted")return new qs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ka(this.args[0]).serialize();const y=[`to-${this.type.kind}`];return this.eachChild(I=>{y.push(I.serialize())}),y}}var hs=Rl;const Rh=["Unknown","Point","LineString","Polygon"];var nu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Rh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const U=this.featureDistanceData.center,y=this.featureDistanceData.scale,{x:I,y:G}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(I*y-U[0])+this.featureDistanceData.bearing[1]*(G*y-U[1])}return 0}parseColor(U){let y=this._parseColorCache[U];return y||(y=this._parseColorCache[U]=zr.parse(U)),y}};class Go{constructor(y,I,G,Q){this.name=y,this.type=I,this._evaluate=G,this.args=Q}evaluate(y){return this._evaluate(y,this.args)}eachChild(y){this.args.forEach(y)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(y=>y.serialize()))}static parse(y,I){const G=y[0],Q=Go.definitions[G];if(!Q)return I.error(`Unknown expression "${G}". If you wanted a literal array, use ["literal", [...]].`,0);const ne=Array.isArray(Q)?Q[0]:Q.type,he=Array.isArray(Q)?[[Q[1],Q[2]]]:Q.overloads,ge=he.filter(([Ee])=>!Array.isArray(Ee)||Ee.length===y.length-1);let we=null;for(const[Ee,ke]of ge){we=new Zo(I.registry,I.path,null,I.scope);const De=[];let Oe=!1;for(let Ne=1;Ne<y.length;Ne++){const Ge=y[Ne],We=Array.isArray(Ee)?Ee[Ne-1]:Ee.type,Je=we.parse(Ge,1+De.length,We);if(!Je){Oe=!0;break}De.push(Je)}if(!Oe)if(Array.isArray(Ee)&&Ee.length!==De.length)we.error(`Expected ${Ee.length} arguments, but found ${De.length} instead.`);else{for(let Ne=0;Ne<De.length;Ne++){const Ge=Array.isArray(Ee)?Ee[Ne]:Ee.type,We=De[Ne];we.concat(Ne+1).checkSubtype(Ge,We.type)}if(we.errors.length===0)return new Go(G,ne,ke,De)}}if(ge.length===1)I.errors.push(...we.errors);else{const Ee=(ge.length?ge:he).map(([De])=>{return Oe=De,Array.isArray(Oe)?`(${Oe.map(Kr).join(", ")})`:`(${Kr(Oe.type)}...)`;var Oe}).join(" | "),ke=[];for(let De=1;De<y.length;De++){const Oe=I.parse(y[De],1+ke.length);if(!Oe)return null;ke.push(Kr(Oe.type))}I.error(`Expected arguments of type ${Ee}, but found (${ke.join(", ")}) instead.`)}return null}static register(y,I){Go.definitions=I;for(const G in I)y[G]=Go}}var Qi=Go;class Ra{constructor(y,I,G){this.type=Fs,this.locale=G,this.caseSensitive=y,this.diacriticSensitive=I}static parse(y,I){if(y.length!==2)return I.error("Expected one argument.");const G=y[1];if(typeof G!="object"||Array.isArray(G))return I.error("Collator options argument must be an object.");const Q=I.parse(G["case-sensitive"]!==void 0&&G["case-sensitive"],1,hr);if(!Q)return null;const ne=I.parse(G["diacritic-sensitive"]!==void 0&&G["diacritic-sensitive"],1,hr);if(!ne)return null;let he=null;return G.locale&&(he=I.parse(G.locale,1,ur),!he)?null:new Ra(Q,ne,he)}evaluate(y){return new Il(this.caseSensitive.evaluate(y),this.diacriticSensitive.evaluate(y),this.locale?this.locale.evaluate(y):null)}eachChild(y){y(this.caseSensitive),y(this.diacriticSensitive),this.locale&&y(this.locale)}outputDefined(){return!1}serialize(){const y={};return y["case-sensitive"]=this.caseSensitive.serialize(),y["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(y.locale=this.locale.serialize()),["collator",y]}}const Mo=8192;function zl(U,y){U[0]=Math.min(U[0],y[0]),U[1]=Math.min(U[1],y[1]),U[2]=Math.max(U[2],y[0]),U[3]=Math.max(U[3],y[1])}function za(U,y){return!(U[0]<=y[0]||U[2]>=y[2]||U[1]<=y[1]||U[3]>=y[3])}function zh(U,y){const I=(180+U[0])/360,G=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+U[1]*Math.PI/360)))/360,Q=Math.pow(2,y.z);return[Math.round(I*Q*Mo),Math.round(G*Q*Mo)]}function Dh(U,y,I){const G=U[0]-y[0],Q=U[1]-y[1],ne=U[0]-I[0],he=U[1]-I[1];return G*he-ne*Q==0&&G*ne<=0&&Q*he<=0}function Da(U,y){let I=!1;for(let he=0,ge=y.length;he<ge;he++){const we=y[he];for(let Ee=0,ke=we.length;Ee<ke-1;Ee++){if(Dh(U,we[Ee],we[Ee+1]))return!1;(Q=we[Ee])[1]>(G=U)[1]!=(ne=we[Ee+1])[1]>G[1]&&G[0]<(ne[0]-Q[0])*(G[1]-Q[1])/(ne[1]-Q[1])+Q[0]&&(I=!I)}}var G,Q,ne;return I}function La(U,y){for(let I=0;I<y.length;I++)if(Da(U,y[I]))return!0;return!1}function ru(U,y,I,G){const Q=G[0]-I[0],ne=G[1]-I[1],he=(U[0]-I[0])*ne-Q*(U[1]-I[1]),ge=(y[0]-I[0])*ne-Q*(y[1]-I[1]);return he>0&&ge<0||he<0&&ge>0}function Lh(U,y,I){for(const Ee of I)for(let ke=0;ke<Ee.length-1;++ke)if((ge=[(he=Ee[ke+1])[0]-(ne=Ee[ke])[0],he[1]-ne[1]])[0]*(we=[(Q=y)[0]-(G=U)[0],Q[1]-G[1]])[1]-ge[1]*we[0]!=0&&ru(G,Q,ne,he)&&ru(ne,he,G,Q))return!0;var G,Q,ne,he,ge,we;return!1}function iu(U,y){for(let I=0;I<U.length;++I)if(!Da(U[I],y))return!1;for(let I=0;I<U.length-1;++I)if(Lh(U[I],U[I+1],y))return!1;return!0}function Bh(U,y){for(let I=0;I<y.length;I++)if(iu(U,y[I]))return!0;return!1}function Vi(U,y,I){const G=[];for(let Q=0;Q<U.length;Q++){const ne=[];for(let he=0;he<U[Q].length;he++){const ge=zh(U[Q][he],I);zl(y,ge),ne.push(ge)}G.push(ne)}return G}function Dl(U,y,I){const G=[];for(let Q=0;Q<U.length;Q++){const ne=Vi(U[Q],y,I);G.push(ne)}return G}function Ll(U,y,I,G){if(U[0]<I[0]||U[0]>I[2]){const Q=.5*G;let ne=U[0]-I[0]>Q?-G:I[0]-U[0]>Q?G:0;ne===0&&(ne=U[0]-I[2]>Q?-G:I[2]-U[0]>Q?G:0),U[0]+=ne}zl(y,U)}function Bl(U,y,I,G){const Q=Math.pow(2,G.z)*Mo,ne=[G.x*Mo,G.y*Mo],he=[];if(!U)return he;for(const ge of U)for(const we of ge){const Ee=[we.x+ne[0],we.y+ne[1]];Ll(Ee,y,I,Q),he.push(Ee)}return he}function Ol(U,y,I,G){const Q=Math.pow(2,G.z)*Mo,ne=[G.x*Mo,G.y*Mo],he=[];if(!U)return he;for(const we of U){const Ee=[];for(const ke of we){const De=[ke.x+ne[0],ke.y+ne[1]];zl(y,De),Ee.push(De)}he.push(Ee)}if(y[2]-y[0]<=Q/2){(ge=y)[0]=ge[1]=1/0,ge[2]=ge[3]=-1/0;for(const we of he)for(const Ee of we)Ll(Ee,y,I,Q)}var ge;return he}class ds{constructor(y,I){this.type=hr,this.geojson=y,this.geometries=I}static parse(y,I){if(y.length!==2)return I.error(`'within' expression requires exactly one argument, but found ${y.length-1} instead.`);if(Io(y[1])){const G=y[1];if(G.type==="FeatureCollection")for(let Q=0;Q<G.features.length;++Q){const ne=G.features[Q].geometry.type;if(ne==="Polygon"||ne==="MultiPolygon")return new ds(G,G.features[Q].geometry)}else if(G.type==="Feature"){const Q=G.geometry.type;if(Q==="Polygon"||Q==="MultiPolygon")return new ds(G,G.geometry)}else if(G.type==="Polygon"||G.type==="MultiPolygon")return new ds(G,G)}return I.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(y){if(y.geometry()!=null&&y.canonicalID()!=null){if(y.geometryType()==="Point")return function(I,G){const Q=[1/0,1/0,-1/0,-1/0],ne=[1/0,1/0,-1/0,-1/0],he=I.canonicalID();if(!he)return!1;if(G.type==="Polygon"){const ge=Vi(G.coordinates,ne,he),we=Bl(I.geometry(),Q,ne,he);if(!za(Q,ne))return!1;for(const Ee of we)if(!Da(Ee,ge))return!1}if(G.type==="MultiPolygon"){const ge=Dl(G.coordinates,ne,he),we=Bl(I.geometry(),Q,ne,he);if(!za(Q,ne))return!1;for(const Ee of we)if(!La(Ee,ge))return!1}return!0}(y,this.geometries);if(y.geometryType()==="LineString")return function(I,G){const Q=[1/0,1/0,-1/0,-1/0],ne=[1/0,1/0,-1/0,-1/0],he=I.canonicalID();if(!he)return!1;if(G.type==="Polygon"){const ge=Vi(G.coordinates,ne,he),we=Ol(I.geometry(),Q,ne,he);if(!za(Q,ne))return!1;for(const Ee of we)if(!iu(Ee,ge))return!1}if(G.type==="MultiPolygon"){const ge=Dl(G.coordinates,ne,he),we=Ol(I.geometry(),Q,ne,he);if(!za(Q,ne))return!1;for(const Ee of we)if(!Bh(Ee,ge))return!1}return!0}(y,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ba=ds;function qo(U){if(U instanceof Qi&&(U.name==="get"&&U.args.length===1||U.name==="feature-state"||U.name==="has"&&U.args.length===1||U.name==="properties"||U.name==="geometry-type"||U.name==="id"||/^filter-/.test(U.name))||U instanceof Ba)return!1;let y=!0;return U.eachChild(I=>{y&&!qo(I)&&(y=!1)}),y}function Po(U){if(U instanceof Qi&&U.name==="feature-state")return!1;let y=!0;return U.eachChild(I=>{y&&!Po(I)&&(y=!1)}),y}function Zs(U,y){if(U instanceof Qi&&y.indexOf(U.name)>=0)return!1;let I=!0;return U.eachChild(G=>{I&&!Zs(G,y)&&(I=!1)}),I}class Oa{constructor(y,I){this.type=I.type,this.name=y,this.boundExpression=I}static parse(y,I){if(y.length!==2||typeof y[1]!="string")return I.error("'var' expression requires exactly one string literal argument.");const G=y[1];return I.scope.has(G)?new Oa(G,I.scope.get(G)):I.error(`Unknown variable "${G}". Make sure "${G}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(y){return this.boundExpression.evaluate(y)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Fa=Oa;class Ua{constructor(y,I=[],G,Q=new Ph,ne=[]){this.registry=y,this.path=I,this.key=I.map(he=>`[${he}]`).join(""),this.scope=Q,this.errors=ne,this.expectedType=G}parse(y,I,G,Q,ne={}){return I?this.concat(I,G,Q)._parse(y,ne):this._parse(y,ne)}_parse(y,I){function G(Q,ne,he){return he==="assert"?new ji(ne,[Q]):he==="coerce"?new hs(ne,[Q]):Q}if(y!==null&&typeof y!="string"&&typeof y!="boolean"&&typeof y!="number"||(y=["literal",y]),Array.isArray(y)){if(y.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const Q=y[0];if(typeof Q!="string")return this.error(`Expression name must be a string, but found ${typeof Q} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const ne=this.registry[Q];if(ne){let he=ne.parse(y,this);if(!he)return null;if(this.expectedType){const ge=this.expectedType,we=he.type;if(ge.kind!=="string"&&ge.kind!=="number"&&ge.kind!=="boolean"&&ge.kind!=="object"&&ge.kind!=="array"||we.kind!=="value")if(ge.kind!=="color"&&ge.kind!=="formatted"&&ge.kind!=="resolvedImage"||we.kind!=="value"&&we.kind!=="string"){if(this.checkSubtype(ge,we))return null}else he=G(he,ge,I.typeAnnotation||"coerce");else he=G(he,ge,I.typeAnnotation||"assert")}if(!(he instanceof Vs)&&he.type.kind!=="resolvedImage"&&Ar(he)){const ge=new nu;try{he=new Vs(he.type,he.evaluate(ge))}catch(we){return this.error(we.message),null}}return he}return this.error(`Unknown expression "${Q}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(y===void 0?"'undefined' value invalid. Use null instead.":typeof y=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof y} instead.`)}concat(y,I,G){const Q=typeof y=="number"?this.path.concat(y):this.path,ne=G?this.scope.concat(G):this.scope;return new Ua(this.registry,Q,I||null,ne,this.errors)}error(y,...I){const G=`${this.key}${I.map(Q=>`[${Q}]`).join("")}`;this.errors.push(new Ki(G,y))}checkSubtype(y,I){const G=us(y,I);return G&&this.error(G),G}}var Zo=Ua;function Ar(U){if(U instanceof Fa)return Ar(U.boundExpression);if(U instanceof Qi&&U.name==="error"||U instanceof Ra||U instanceof Ba)return!1;const y=U instanceof hs||U instanceof ji;let I=!0;return U.eachChild(G=>{I=y?I&&Ar(G):I&&G instanceof Vs}),!!I&&qo(U)&&Zs(U,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $a(U,y){const I=U.length-1;let G,Q,ne=0,he=I,ge=0;for(;ne<=he;)if(ge=Math.floor((ne+he)/2),G=U[ge],Q=U[ge+1],G<=y){if(ge===I||y<Q)return ge;ne=ge+1}else{if(!(G>y))throw new ui("Input is not a number.");he=ge-1}return 0}class Fl{constructor(y,I,G){this.type=y,this.input=I,this.labels=[],this.outputs=[];for(const[Q,ne]of G)this.labels.push(Q),this.outputs.push(ne)}static parse(y,I){if(y.length-1<4)return I.error(`Expected at least 4 arguments, but found only ${y.length-1}.`);if((y.length-1)%2!=0)return I.error("Expected an even number of arguments.");const G=I.parse(y[1],1,Cn);if(!G)return null;const Q=[];let ne=null;I.expectedType&&I.expectedType.kind!=="value"&&(ne=I.expectedType);for(let he=1;he<y.length;he+=2){const ge=he===1?-1/0:y[he],we=y[he+1],Ee=he,ke=he+1;if(typeof ge!="number")return I.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ee);if(Q.length&&Q[Q.length-1][0]>=ge)return I.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ee);const De=I.parse(we,ke,ne);if(!De)return null;ne=ne||De.type,Q.push([ge,De])}return new Fl(ne,G,Q)}evaluate(y){const I=this.labels,G=this.outputs;if(I.length===1)return G[0].evaluate(y);const Q=this.input.evaluate(y);if(Q<=I[0])return G[0].evaluate(y);const ne=I.length;return Q>=I[ne-1]?G[ne-1].evaluate(y):G[$a(I,Q)].evaluate(y)}eachChild(y){y(this.input);for(const I of this.outputs)y(I)}outputDefined(){return this.outputs.every(y=>y.outputDefined())}serialize(){const y=["step",this.input.serialize()];for(let I=0;I<this.labels.length;I++)I>0&&y.push(this.labels[I]),y.push(this.outputs[I].serialize());return y}}var Ul=Fl;function wr(U,y,I){return U*(1-I)+y*I}function ps(U,y,I){return U.map((G,Q)=>wr(G,y[Q],I))}var Hs=Object.freeze({__proto__:null,number:wr,color:function(U,y,I){return new zr(wr(U.r,y.r,I),wr(U.g,y.g,I),wr(U.b,y.b,I),wr(U.a,y.a,I))},array:ps});const $l=.95047,Nl=1.08883,jl=4/29,ko=6/29,Ws=3*ko*ko,Oh=Math.PI/180,Vl=180/Math.PI;function Na(U){return U>.008856451679035631?Math.pow(U,1/3):U/Ws+jl}function Gl(U){return U>ko?U*U*U:Ws*(U-jl)}function ql(U){return 255*(U<=.0031308?12.92*U:1.055*Math.pow(U,1/2.4)-.055)}function ja(U){return(U/=255)<=.04045?U/12.92:Math.pow((U+.055)/1.055,2.4)}function ou(U){const y=ja(U.r),I=ja(U.g),G=ja(U.b),Q=Na((.4124564*y+.3575761*I+.1804375*G)/$l),ne=Na((.2126729*y+.7151522*I+.072175*G)/1);return{l:116*ne-16,a:500*(Q-ne),b:200*(ne-Na((.0193339*y+.119192*I+.9503041*G)/Nl)),alpha:U.a}}function Zl(U){let y=(U.l+16)/116,I=isNaN(U.a)?y:y+U.a/500,G=isNaN(U.b)?y:y-U.b/200;return y=1*Gl(y),I=$l*Gl(I),G=Nl*Gl(G),new zr(ql(3.2404542*I-1.5371385*y-.4985314*G),ql(-.969266*I+1.8760108*y+.041556*G),ql(.0556434*I-.2040259*y+1.0572252*G),U.alpha)}function su(U,y,I){const G=y-U;return U+I*(G>180||G<-180?G-360*Math.round(G/360):G)}const Xs={forward:ou,reverse:Zl,interpolate:function(U,y,I){return{l:wr(U.l,y.l,I),a:wr(U.a,y.a,I),b:wr(U.b,y.b,I),alpha:wr(U.alpha,y.alpha,I)}}},fs={forward:function(U){const{l:y,a:I,b:G}=ou(U),Q=Math.atan2(G,I)*Vl;return{h:Q<0?Q+360:Q,c:Math.sqrt(I*I+G*G),l:y,alpha:U.a}},reverse:function(U){const y=U.h*Oh,I=U.c;return Zl({l:U.l,a:Math.cos(y)*I,b:Math.sin(y)*I,alpha:U.alpha})},interpolate:function(U,y,I){return{h:su(U.h,y.h,I),c:wr(U.c,y.c,I),l:wr(U.l,y.l,I),alpha:wr(U.alpha,y.alpha,I)}}};var au=Object.freeze({__proto__:null,lab:Xs,hcl:fs});class Ks{constructor(y,I,G,Q,ne){this.type=y,this.operator=I,this.interpolation=G,this.input=Q,this.labels=[],this.outputs=[];for(const[he,ge]of ne)this.labels.push(he),this.outputs.push(ge)}static interpolationFactor(y,I,G,Q){let ne=0;if(y.name==="exponential")ne=Va(I,y.base,G,Q);else if(y.name==="linear")ne=Va(I,1,G,Q);else if(y.name==="cubic-bezier"){const he=y.controlPoints;ne=new Pe(he[0],he[1],he[2],he[3]).solve(Va(I,1,G,Q))}return ne}static parse(y,I){let[G,Q,ne,...he]=y;if(!Array.isArray(Q)||Q.length===0)return I.error("Expected an interpolation type expression.",1);if(Q[0]==="linear")Q={name:"linear"};else if(Q[0]==="exponential"){const Ee=Q[1];if(typeof Ee!="number")return I.error("Exponential interpolation requires a numeric base.",1,1);Q={name:"exponential",base:Ee}}else{if(Q[0]!=="cubic-bezier")return I.error(`Unknown interpolation type ${String(Q[0])}`,1,0);{const Ee=Q.slice(1);if(Ee.length!==4||Ee.some(ke=>typeof ke!="number"||ke<0||ke>1))return I.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);Q={name:"cubic-bezier",controlPoints:Ee}}}if(y.length-1<4)return I.error(`Expected at least 4 arguments, but found only ${y.length-1}.`);if((y.length-1)%2!=0)return I.error("Expected an even number of arguments.");if(ne=I.parse(ne,2,Cn),!ne)return null;const ge=[];let we=null;G==="interpolate-hcl"||G==="interpolate-lab"?we=Yi:I.expectedType&&I.expectedType.kind!=="value"&&(we=I.expectedType);for(let Ee=0;Ee<he.length;Ee+=2){const ke=he[Ee],De=he[Ee+1],Oe=Ee+3,Ne=Ee+4;if(typeof ke!="number")return I.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Oe);if(ge.length&&ge[ge.length-1][0]>=ke)return I.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Oe);const Ge=I.parse(De,Ne,we);if(!Ge)return null;we=we||Ge.type,ge.push([ke,Ge])}return we.kind==="number"||we.kind==="color"||we.kind==="array"&&we.itemType.kind==="number"&&typeof we.N=="number"?new Ks(we,G,Q,ne,ge):I.error(`Type ${Kr(we)} is not interpolatable.`)}evaluate(y){const I=this.labels,G=this.outputs;if(I.length===1)return G[0].evaluate(y);const Q=this.input.evaluate(y);if(Q<=I[0])return G[0].evaluate(y);const ne=I.length;if(Q>=I[ne-1])return G[ne-1].evaluate(y);const he=$a(I,Q),ge=Ks.interpolationFactor(this.interpolation,Q,I[he],I[he+1]),we=G[he].evaluate(y),Ee=G[he+1].evaluate(y);return this.operator==="interpolate"?Hs[this.type.kind.toLowerCase()](we,Ee,ge):this.operator==="interpolate-hcl"?fs.reverse(fs.interpolate(fs.forward(we),fs.forward(Ee),ge)):Xs.reverse(Xs.interpolate(Xs.forward(we),Xs.forward(Ee),ge))}eachChild(y){y(this.input);for(const I of this.outputs)y(I)}outputDefined(){return this.outputs.every(y=>y.outputDefined())}serialize(){let y;y=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const I=[this.operator,y,this.input.serialize()];for(let G=0;G<this.labels.length;G++)I.push(this.labels[G],this.outputs[G].serialize());return I}}function Va(U,y,I,G){const Q=G-I,ne=U-I;return Q===0?0:y===1?ne/Q:(Math.pow(y,ne)-1)/(Math.pow(y,Q)-1)}var io=Ks;class Hl{constructor(y,I){this.type=y,this.args=I}static parse(y,I){if(y.length<2)return I.error("Expectected at least one argument.");let G=null;const Q=I.expectedType;Q&&Q.kind!=="value"&&(G=Q);const ne=[];for(const ge of y.slice(1)){const we=I.parse(ge,1+ne.length,G,void 0,{typeAnnotation:"omit"});if(!we)return null;G=G||we.type,ne.push(we)}const he=Q&&ne.some(ge=>us(Q,ge.type));return new Hl(he?ir:G,ne)}evaluate(y){let I,G=null,Q=0;for(const ne of this.args){if(Q++,G=ne.evaluate(y),G&&G instanceof ki&&!G.available&&(I||(I=G),G=null,Q===this.args.length))return I;if(G!==null)break}return G}eachChild(y){this.args.forEach(y)}outputDefined(){return this.args.every(y=>y.outputDefined())}serialize(){const y=["coalesce"];return this.eachChild(I=>{y.push(I.serialize())}),y}}var lu=Hl;class Wl{constructor(y,I){this.type=I.type,this.bindings=[].concat(y),this.result=I}evaluate(y){return this.result.evaluate(y)}eachChild(y){for(const I of this.bindings)y(I[1]);y(this.result)}static parse(y,I){if(y.length<4)return I.error(`Expected at least 3 arguments, but found ${y.length-1} instead.`);const G=[];for(let ne=1;ne<y.length-1;ne+=2){const he=y[ne];if(typeof he!="string")return I.error(`Expected string, but found ${typeof he} instead.`,ne);if(/[^a-zA-Z0-9_]/.test(he))return I.error("Variable names must contain only alphanumeric characters or '_'.",ne);const ge=I.parse(y[ne+1],ne+1);if(!ge)return null;G.push([he,ge])}const Q=I.parse(y[y.length-1],y.length-1,I.expectedType,G);return Q?new Wl(G,Q):null}outputDefined(){return this.result.outputDefined()}serialize(){const y=["let"];for(const[I,G]of this.bindings)y.push(I,G.serialize());return y.push(this.result.serialize()),y}}var cu=Wl;class Xl{constructor(y,I,G){this.type=y,this.index=I,this.input=G}static parse(y,I){if(y.length!==3)return I.error(`Expected 2 arguments, but found ${y.length-1} instead.`);const G=I.parse(y[1],1,Cn),Q=I.parse(y[2],2,Oi(I.expectedType||ir));return G&&Q?new Xl(Q.type.itemType,G,Q):null}evaluate(y){const I=this.index.evaluate(y),G=this.input.evaluate(y);if(I<0)throw new ui(`Array index out of bounds: ${I} < 0.`);if(I>=G.length)throw new ui(`Array index out of bounds: ${I} > ${G.length-1}.`);if(I!==Math.floor(I))throw new ui(`Array index must be an integer, but found ${I} instead.`);return G[I]}eachChild(y){y(this.index),y(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var uu=Xl;class Kl{constructor(y,I){this.type=hr,this.needle=y,this.haystack=I}static parse(y,I){if(y.length!==3)return I.error(`Expected 2 arguments, but found ${y.length-1} instead.`);const G=I.parse(y[1],1,ir),Q=I.parse(y[2],2,ir);return G&&Q?Pa(G.type,[hr,ur,Cn,cs,ir])?new Kl(G,Q):I.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(G.type)} instead`):null}evaluate(y){const I=this.needle.evaluate(y),G=this.haystack.evaluate(y);if(G==null)return!1;if(!So(I,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(ni(I))} instead.`);if(!So(G,["string","array"]))throw new ui(`Expected second argument to be of type array or string, but found ${Kr(ni(G))} instead.`);return G.indexOf(I)>=0}eachChild(y){y(this.needle),y(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Fh=Kl;class Ga{constructor(y,I,G){this.type=Cn,this.needle=y,this.haystack=I,this.fromIndex=G}static parse(y,I){if(y.length<=2||y.length>=5)return I.error(`Expected 3 or 4 arguments, but found ${y.length-1} instead.`);const G=I.parse(y[1],1,ir),Q=I.parse(y[2],2,ir);if(!G||!Q)return null;if(!Pa(G.type,[hr,ur,Cn,cs,ir]))return I.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(G.type)} instead`);if(y.length===4){const ne=I.parse(y[3],3,Cn);return ne?new Ga(G,Q,ne):null}return new Ga(G,Q)}evaluate(y){const I=this.needle.evaluate(y),G=this.haystack.evaluate(y);if(!So(I,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${Kr(ni(I))} instead.`);if(!So(G,["string","array"]))throw new ui(`Expected second argument to be of type array or string, but found ${Kr(ni(G))} instead.`);if(this.fromIndex){const Q=this.fromIndex.evaluate(y);return G.indexOf(I,Q)}return G.indexOf(I)}eachChild(y){y(this.needle),y(this.haystack),this.fromIndex&&y(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const y=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),y]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Uh=Ga;class qa{constructor(y,I,G,Q,ne,he){this.inputType=y,this.type=I,this.input=G,this.cases=Q,this.outputs=ne,this.otherwise=he}static parse(y,I){if(y.length<5)return I.error(`Expected at least 4 arguments, but found only ${y.length-1}.`);if(y.length%2!=1)return I.error("Expected an even number of arguments.");let G,Q;I.expectedType&&I.expectedType.kind!=="value"&&(Q=I.expectedType);const ne={},he=[];for(let Ee=2;Ee<y.length-1;Ee+=2){let ke=y[Ee];const De=y[Ee+1];Array.isArray(ke)||(ke=[ke]);const Oe=I.concat(Ee);if(ke.length===0)return Oe.error("Expected at least one branch label.");for(const Ge of ke){if(typeof Ge!="number"&&typeof Ge!="string")return Oe.error("Branch labels must be numbers or strings.");if(typeof Ge=="number"&&Math.abs(Ge)>Number.MAX_SAFE_INTEGER)return Oe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ge=="number"&&Math.floor(Ge)!==Ge)return Oe.error("Numeric branch labels must be integer values.");if(G){if(Oe.checkSubtype(G,ni(Ge)))return null}else G=ni(Ge);if(ne[String(Ge)]!==void 0)return Oe.error("Branch labels must be unique.");ne[String(Ge)]=he.length}const Ne=I.parse(De,Ee,Q);if(!Ne)return null;Q=Q||Ne.type,he.push(Ne)}const ge=I.parse(y[1],1,ir);if(!ge)return null;const we=I.parse(y[y.length-1],y.length-1,Q);return we?ge.type.kind!=="value"&&I.concat(1).checkSubtype(G,ge.type)?null:new qa(G,Q,ge,ne,he,we):null}evaluate(y){const I=this.input.evaluate(y);return(ni(I)===this.inputType&&this.outputs[this.cases[I]]||this.otherwise).evaluate(y)}eachChild(y){y(this.input),this.outputs.forEach(y),y(this.otherwise)}outputDefined(){return this.outputs.every(y=>y.outputDefined())&&this.otherwise.outputDefined()}serialize(){const y=["match",this.input.serialize()],I=Object.keys(this.cases).sort(),G=[],Q={};for(const he of I){const ge=Q[this.cases[he]];ge===void 0?(Q[this.cases[he]]=G.length,G.push([this.cases[he],[he]])):G[ge][1].push(he)}const ne=he=>this.inputType.kind==="number"?Number(he):he;for(const[he,ge]of G)y.push(ge.length===1?ne(ge[0]):ge.map(ne)),y.push(this.outputs[he].serialize());return y.push(this.otherwise.serialize()),y}}var hu=qa;class Za{constructor(y,I,G){this.type=y,this.branches=I,this.otherwise=G}static parse(y,I){if(y.length<4)return I.error(`Expected at least 3 arguments, but found only ${y.length-1}.`);if(y.length%2!=0)return I.error("Expected an odd number of arguments.");let G;I.expectedType&&I.expectedType.kind!=="value"&&(G=I.expectedType);const Q=[];for(let he=1;he<y.length-1;he+=2){const ge=I.parse(y[he],he,hr);if(!ge)return null;const we=I.parse(y[he+1],he+1,G);if(!we)return null;Q.push([ge,we]),G=G||we.type}const ne=I.parse(y[y.length-1],y.length-1,G);return ne?new Za(G,Q,ne):null}evaluate(y){for(const[I,G]of this.branches)if(I.evaluate(y))return G.evaluate(y);return this.otherwise.evaluate(y)}eachChild(y){for(const[I,G]of this.branches)y(I),y(G);y(this.otherwise)}outputDefined(){return this.branches.every(([y,I])=>I.outputDefined())&&this.otherwise.outputDefined()}serialize(){const y=["case"];return this.eachChild(I=>{y.push(I.serialize())}),y}}var $h=Za;class Ha{constructor(y,I,G,Q){this.type=y,this.input=I,this.beginIndex=G,this.endIndex=Q}static parse(y,I){if(y.length<=2||y.length>=5)return I.error(`Expected 3 or 4 arguments, but found ${y.length-1} instead.`);const G=I.parse(y[1],1,ir),Q=I.parse(y[2],2,Cn);if(!G||!Q)return null;if(!Pa(G.type,[Oi(ir),ur,ir]))return I.error(`Expected first argument to be of type array or string, but found ${Kr(G.type)} instead`);if(y.length===4){const ne=I.parse(y[3],3,Cn);return ne?new Ha(G.type,G,Q,ne):null}return new Ha(G.type,G,Q)}evaluate(y){const I=this.input.evaluate(y),G=this.beginIndex.evaluate(y);if(!So(I,["string","array"]))throw new ui(`Expected first argument to be of type array or string, but found ${Kr(ni(I))} instead.`);if(this.endIndex){const Q=this.endIndex.evaluate(y);return I.slice(G,Q)}return I.slice(G)}eachChild(y){y(this.input),y(this.beginIndex),this.endIndex&&y(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const y=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),y]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var du=Ha;function Yl(U,y){return U==="=="||U==="!="?y.kind==="boolean"||y.kind==="string"||y.kind==="number"||y.kind==="null"||y.kind==="value":y.kind==="string"||y.kind==="number"||y.kind==="value"}function Jl(U,y,I,G){return G.compare(y,I)===0}function ms(U,y,I){const G=U!=="=="&&U!=="!=";return class zm{constructor(ne,he,ge){this.type=hr,this.lhs=ne,this.rhs=he,this.collator=ge,this.hasUntypedArgument=ne.type.kind==="value"||he.type.kind==="value"}static parse(ne,he){if(ne.length!==3&&ne.length!==4)return he.error("Expected two or three arguments.");const ge=ne[0];let we=he.parse(ne[1],1,ir);if(!we)return null;if(!Yl(ge,we.type))return he.concat(1).error(`"${ge}" comparisons are not supported for type '${Kr(we.type)}'.`);let Ee=he.parse(ne[2],2,ir);if(!Ee)return null;if(!Yl(ge,Ee.type))return he.concat(2).error(`"${ge}" comparisons are not supported for type '${Kr(Ee.type)}'.`);if(we.type.kind!==Ee.type.kind&&we.type.kind!=="value"&&Ee.type.kind!=="value")return he.error(`Cannot compare types '${Kr(we.type)}' and '${Kr(Ee.type)}'.`);G&&(we.type.kind==="value"&&Ee.type.kind!=="value"?we=new ji(Ee.type,[we]):we.type.kind!=="value"&&Ee.type.kind==="value"&&(Ee=new ji(we.type,[Ee])));let ke=null;if(ne.length===4){if(we.type.kind!=="string"&&Ee.type.kind!=="string"&&we.type.kind!=="value"&&Ee.type.kind!=="value")return he.error("Cannot use collator to compare non-string types.");if(ke=he.parse(ne[3],3,Fs),!ke)return null}return new zm(we,Ee,ke)}evaluate(ne){const he=this.lhs.evaluate(ne),ge=this.rhs.evaluate(ne);if(G&&this.hasUntypedArgument){const we=ni(he),Ee=ni(ge);if(we.kind!==Ee.kind||we.kind!=="string"&&we.kind!=="number")throw new ui(`Expected arguments for "${U}" to be (string, string) or (number, number), but found (${we.kind}, ${Ee.kind}) instead.`)}if(this.collator&&!G&&this.hasUntypedArgument){const we=ni(he),Ee=ni(ge);if(we.kind!=="string"||Ee.kind!=="string")return y(ne,he,ge)}return this.collator?I(ne,he,ge,this.collator.evaluate(ne)):y(ne,he,ge)}eachChild(ne){ne(this.lhs),ne(this.rhs),this.collator&&ne(this.collator)}outputDefined(){return!0}serialize(){const ne=[U];return this.eachChild(he=>{ne.push(he.serialize())}),ne}}}const Nh=ms("==",function(U,y,I){return y===I},Jl),jh=ms("!=",function(U,y,I){return y!==I},function(U,y,I,G){return!Jl(0,y,I,G)}),Vh=ms("<",function(U,y,I){return y<I},function(U,y,I,G){return G.compare(y,I)<0}),Wa=ms(">",function(U,y,I){return y>I},function(U,y,I,G){return G.compare(y,I)>0}),pu=ms("<=",function(U,y,I){return y<=I},function(U,y,I,G){return G.compare(y,I)<=0}),fu=ms(">=",function(U,y,I){return y>=I},function(U,y,I,G){return G.compare(y,I)>=0});class Ql{constructor(y,I,G,Q,ne,he){this.type=ur,this.number=y,this.locale=I,this.currency=G,this.unit=Q,this.minFractionDigits=ne,this.maxFractionDigits=he}static parse(y,I){if(y.length!==3)return I.error("Expected two arguments.");const G=I.parse(y[1],1,Cn);if(!G)return null;const Q=y[2];if(typeof Q!="object"||Array.isArray(Q))return I.error("NumberFormat options argument must be an object.");let ne=null;if(Q.locale&&(ne=I.parse(Q.locale,1,ur),!ne))return null;let he=null;if(Q.currency&&(he=I.parse(Q.currency,1,ur),!he))return null;let ge=null;if(Q.unit&&(ge=I.parse(Q.unit,1,ur),!ge))return null;let we=null;if(Q["min-fraction-digits"]&&(we=I.parse(Q["min-fraction-digits"],1,Cn),!we))return null;let Ee=null;return Q["max-fraction-digits"]&&(Ee=I.parse(Q["max-fraction-digits"],1,Cn),!Ee)?null:new Ql(G,ne,he,ge,we,Ee)}evaluate(y){return new Intl.NumberFormat(this.locale?this.locale.evaluate(y):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(y):void 0,unit:this.unit?this.unit.evaluate(y):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(y):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(y):void 0}).format(this.number.evaluate(y))}eachChild(y){y(this.number),this.locale&&y(this.locale),this.currency&&y(this.currency),this.unit&&y(this.unit),this.minFractionDigits&&y(this.minFractionDigits),this.maxFractionDigits&&y(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const y={};return this.locale&&(y.locale=this.locale.serialize()),this.currency&&(y.currency=this.currency.serialize()),this.unit&&(y.unit=this.unit.serialize()),this.minFractionDigits&&(y["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(y["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),y]}}class ec{constructor(y){this.type=Cn,this.input=y}static parse(y,I){if(y.length!==2)return I.error(`Expected 1 argument, but found ${y.length-1} instead.`);const G=I.parse(y[1],1);return G?G.type.kind!=="array"&&G.type.kind!=="string"&&G.type.kind!=="value"?I.error(`Expected argument of type string or array, but found ${Kr(G.type)} instead.`):new ec(G):null}evaluate(y){const I=this.input.evaluate(y);if(typeof I=="string"||Array.isArray(I))return I.length;throw new ui(`Expected value to be of type string or array, but found ${Kr(ni(I))} instead.`)}eachChild(y){y(this.input)}outputDefined(){return!1}serialize(){const y=["length"];return this.eachChild(I=>{y.push(I.serialize())}),y}}const mu={"==":Nh,"!=":jh,">":Wa,"<":Vh,">=":fu,"<=":pu,array:ji,at:uu,boolean:ji,case:$h,coalesce:lu,collator:Ra,format:qs,image:ka,in:Fh,"index-of":Uh,interpolate:io,"interpolate-hcl":io,"interpolate-lab":io,length:ec,let:cu,literal:Vs,match:hu,number:ji,"number-format":Ql,object:ji,slice:du,step:Ul,string:ji,"to-boolean":hs,"to-color":hs,"to-number":hs,"to-string":hs,var:Fa,within:Ba};function tc(U,[y,I,G,Q]){y=y.evaluate(U),I=I.evaluate(U),G=G.evaluate(U);const ne=Q?Q.evaluate(U):1,he=Ml(y,I,G,ne);if(he)throw new ui(he);return new zr(y/255*ne,I/255*ne,G/255*ne,ne)}function nc(U,y){return U in y}function Xa(U,y){const I=y[U];return I===void 0?null:I}function uo(U){return{type:U}}Qi.register(mu,{error:[{kind:"error"},[ur],(U,[y])=>{throw new ui(y.evaluate(U))}],typeof:[ur,[ir],(U,[y])=>Kr(ni(y.evaluate(U)))],"to-rgba":[Oi(Cn,4),[Yi],(U,[y])=>y.evaluate(U).toArray()],rgb:[Yi,[Cn,Cn,Cn],tc],rgba:[Yi,[Cn,Cn,Cn,Cn],tc],has:{type:hr,overloads:[[[ur],(U,[y])=>nc(y.evaluate(U),U.properties())],[[ur,Ji],(U,[y,I])=>nc(y.evaluate(U),I.evaluate(U))]]},get:{type:ir,overloads:[[[ur],(U,[y])=>Xa(y.evaluate(U),U.properties())],[[ur,Ji],(U,[y,I])=>Xa(y.evaluate(U),I.evaluate(U))]]},"feature-state":[ir,[ur],(U,[y])=>Xa(y.evaluate(U),U.featureState||{})],properties:[Ji,[],U=>U.properties()],"geometry-type":[ur,[],U=>U.geometryType()],id:[ir,[],U=>U.id()],zoom:[Cn,[],U=>U.globals.zoom],pitch:[Cn,[],U=>U.globals.pitch||0],"distance-from-center":[Cn,[],U=>U.distanceFromCenter()],"heatmap-density":[Cn,[],U=>U.globals.heatmapDensity||0],"line-progress":[Cn,[],U=>U.globals.lineProgress||0],"sky-radial-progress":[Cn,[],U=>U.globals.skyRadialProgress||0],accumulated:[ir,[],U=>U.globals.accumulated===void 0?null:U.globals.accumulated],"+":[Cn,uo(Cn),(U,y)=>{let I=0;for(const G of y)I+=G.evaluate(U);return I}],"*":[Cn,uo(Cn),(U,y)=>{let I=1;for(const G of y)I*=G.evaluate(U);return I}],"-":{type:Cn,overloads:[[[Cn,Cn],(U,[y,I])=>y.evaluate(U)-I.evaluate(U)],[[Cn],(U,[y])=>-y.evaluate(U)]]},"/":[Cn,[Cn,Cn],(U,[y,I])=>y.evaluate(U)/I.evaluate(U)],"%":[Cn,[Cn,Cn],(U,[y,I])=>y.evaluate(U)%I.evaluate(U)],ln2:[Cn,[],()=>Math.LN2],pi:[Cn,[],()=>Math.PI],e:[Cn,[],()=>Math.E],"^":[Cn,[Cn,Cn],(U,[y,I])=>Math.pow(y.evaluate(U),I.evaluate(U))],sqrt:[Cn,[Cn],(U,[y])=>Math.sqrt(y.evaluate(U))],log10:[Cn,[Cn],(U,[y])=>Math.log(y.evaluate(U))/Math.LN10],ln:[Cn,[Cn],(U,[y])=>Math.log(y.evaluate(U))],log2:[Cn,[Cn],(U,[y])=>Math.log(y.evaluate(U))/Math.LN2],sin:[Cn,[Cn],(U,[y])=>Math.sin(y.evaluate(U))],cos:[Cn,[Cn],(U,[y])=>Math.cos(y.evaluate(U))],tan:[Cn,[Cn],(U,[y])=>Math.tan(y.evaluate(U))],asin:[Cn,[Cn],(U,[y])=>Math.asin(y.evaluate(U))],acos:[Cn,[Cn],(U,[y])=>Math.acos(y.evaluate(U))],atan:[Cn,[Cn],(U,[y])=>Math.atan(y.evaluate(U))],min:[Cn,uo(Cn),(U,y)=>Math.min(...y.map(I=>I.evaluate(U)))],max:[Cn,uo(Cn),(U,y)=>Math.max(...y.map(I=>I.evaluate(U)))],abs:[Cn,[Cn],(U,[y])=>Math.abs(y.evaluate(U))],round:[Cn,[Cn],(U,[y])=>{const I=y.evaluate(U);return I<0?-Math.round(-I):Math.round(I)}],floor:[Cn,[Cn],(U,[y])=>Math.floor(y.evaluate(U))],ceil:[Cn,[Cn],(U,[y])=>Math.ceil(y.evaluate(U))],"filter-==":[hr,[ur,ir],(U,[y,I])=>U.properties()[y.value]===I.value],"filter-id-==":[hr,[ir],(U,[y])=>U.id()===y.value],"filter-type-==":[hr,[ur],(U,[y])=>U.geometryType()===y.value],"filter-<":[hr,[ur,ir],(U,[y,I])=>{const G=U.properties()[y.value],Q=I.value;return typeof G==typeof Q&&G<Q}],"filter-id-<":[hr,[ir],(U,[y])=>{const I=U.id(),G=y.value;return typeof I==typeof G&&I<G}],"filter->":[hr,[ur,ir],(U,[y,I])=>{const G=U.properties()[y.value],Q=I.value;return typeof G==typeof Q&&G>Q}],"filter-id->":[hr,[ir],(U,[y])=>{const I=U.id(),G=y.value;return typeof I==typeof G&&I>G}],"filter-<=":[hr,[ur,ir],(U,[y,I])=>{const G=U.properties()[y.value],Q=I.value;return typeof G==typeof Q&&G<=Q}],"filter-id-<=":[hr,[ir],(U,[y])=>{const I=U.id(),G=y.value;return typeof I==typeof G&&I<=G}],"filter->=":[hr,[ur,ir],(U,[y,I])=>{const G=U.properties()[y.value],Q=I.value;return typeof G==typeof Q&&G>=Q}],"filter-id->=":[hr,[ir],(U,[y])=>{const I=U.id(),G=y.value;return typeof I==typeof G&&I>=G}],"filter-has":[hr,[ir],(U,[y])=>y.value in U.properties()],"filter-has-id":[hr,[],U=>U.id()!==null&&U.id()!==void 0],"filter-type-in":[hr,[Oi(ur)],(U,[y])=>y.value.indexOf(U.geometryType())>=0],"filter-id-in":[hr,[Oi(ir)],(U,[y])=>y.value.indexOf(U.id())>=0],"filter-in-small":[hr,[ur,Oi(ir)],(U,[y,I])=>I.value.indexOf(U.properties()[y.value])>=0],"filter-in-large":[hr,[ur,Oi(ir)],(U,[y,I])=>function(G,Q,ne,he){for(;ne<=he;){const ge=ne+he>>1;if(Q[ge]===G)return!0;Q[ge]>G?he=ge-1:ne=ge+1}return!1}(U.properties()[y.value],I.value,0,I.value.length-1)],all:{type:hr,overloads:[[[hr,hr],(U,[y,I])=>y.evaluate(U)&&I.evaluate(U)],[uo(hr),(U,y)=>{for(const I of y)if(!I.evaluate(U))return!1;return!0}]]},any:{type:hr,overloads:[[[hr,hr],(U,[y,I])=>y.evaluate(U)||I.evaluate(U)],[uo(hr),(U,y)=>{for(const I of y)if(I.evaluate(U))return!0;return!1}]]},"!":[hr,[hr],(U,[y])=>!y.evaluate(U)],"is-supported-script":[hr,[ur],(U,[y])=>{const I=U.globals&&U.globals.isSupportedScript;return!I||I(y.evaluate(U))}],upcase:[ur,[ur],(U,[y])=>y.evaluate(U).toUpperCase()],downcase:[ur,[ur],(U,[y])=>y.evaluate(U).toLowerCase()],concat:[ur,uo(ir),(U,y)=>y.map(I=>js(I.evaluate(U))).join("")],"resolved-locale":[ur,[Fs],(U,[y])=>y.evaluate(U).resolvedLocale()]});var Ys=mu;function _u(U){return{result:"success",value:U}}function _s(U){return{result:"error",value:U}}function gs(U){return U["property-type"]==="data-driven"||U["property-type"]==="cross-faded-data-driven"}function gu(U){return!!U.expression&&U.expression.parameters.indexOf("zoom")>-1}function rc(U){return!!U.expression&&U.expression.interpolated}function Sr(U){return U instanceof Number?"number":U instanceof String?"string":U instanceof Boolean?"boolean":Array.isArray(U)?"array":U===null?"null":typeof U}function Js(U){return typeof U=="object"&&U!==null&&!Array.isArray(U)}function yu(U){return U}function Qs(U,y){const I=y.type==="color",G=U.stops&&typeof U.stops[0][0]=="object",Q=G||!(G||U.property!==void 0),ne=U.type||(rc(y)?"exponential":"interval");if(I&&((U=Bi({},U)).stops&&(U.stops=U.stops.map(Ee=>[Ee[0],zr.parse(Ee[1])])),U.default=zr.parse(U.default?U.default:y.default)),U.colorSpace&&U.colorSpace!=="rgb"&&!au[U.colorSpace])throw new Error(`Unknown color space: ${U.colorSpace}`);let he,ge,we;if(ne==="exponential")he=ic;else if(ne==="interval")he=Ro;else if(ne==="categorical"){he=Gh,ge=Object.create(null);for(const Ee of U.stops)ge[Ee[0]]=Ee[1];we=typeof U.stops[0][0]}else{if(ne!=="identity")throw new Error(`Unknown function type "${ne}"`);he=ys}if(G){const Ee={},ke=[];for(let Ne=0;Ne<U.stops.length;Ne++){const Ge=U.stops[Ne],We=Ge[0].zoom;Ee[We]===void 0&&(Ee[We]={zoom:We,type:U.type,property:U.property,default:U.default,stops:[]},ke.push(We)),Ee[We].stops.push([Ge[0].value,Ge[1]])}const De=[];for(const Ne of ke)De.push([Ee[Ne].zoom,Qs(Ee[Ne],y)]);const Oe={name:"linear"};return{kind:"composite",interpolationType:Oe,interpolationFactor:io.interpolationFactor.bind(void 0,Oe),zoomStops:De.map(Ne=>Ne[0]),evaluate:({zoom:Ne},Ge)=>ic({stops:De,base:U.base},y,Ne).evaluate(Ne,Ge)}}if(Q){const Ee=ne==="exponential"?{name:"exponential",base:U.base!==void 0?U.base:1}:null;return{kind:"camera",interpolationType:Ee,interpolationFactor:io.interpolationFactor.bind(void 0,Ee),zoomStops:U.stops.map(ke=>ke[0]),evaluate:({zoom:ke})=>he(U,y,ke,ge,we)}}return{kind:"source",evaluate(Ee,ke){const De=ke&&ke.properties?ke.properties[U.property]:void 0;return De===void 0?ea(U.default,y.default):he(U,y,De,ge,we)}}}function ea(U,y,I){return U!==void 0?U:y!==void 0?y:I!==void 0?I:void 0}function Gh(U,y,I,G,Q){return ea(typeof I===Q?G[I]:void 0,U.default,y.default)}function Ro(U,y,I){if(Sr(I)!=="number")return ea(U.default,y.default);const G=U.stops.length;if(G===1||I<=U.stops[0][0])return U.stops[0][1];if(I>=U.stops[G-1][0])return U.stops[G-1][1];const Q=$a(U.stops.map(ne=>ne[0]),I);return U.stops[Q][1]}function ic(U,y,I){const G=U.base!==void 0?U.base:1;if(Sr(I)!=="number")return ea(U.default,y.default);const Q=U.stops.length;if(Q===1||I<=U.stops[0][0])return U.stops[0][1];if(I>=U.stops[Q-1][0])return U.stops[Q-1][1];const ne=$a(U.stops.map(ke=>ke[0]),I),he=function(ke,De,Oe,Ne){const Ge=Ne-Oe,We=ke-Oe;return Ge===0?0:De===1?We/Ge:(Math.pow(De,We)-1)/(Math.pow(De,Ge)-1)}(I,G,U.stops[ne][0],U.stops[ne+1][0]),ge=U.stops[ne][1],we=U.stops[ne+1][1];let Ee=Hs[y.type]||yu;if(U.colorSpace&&U.colorSpace!=="rgb"){const ke=au[U.colorSpace];Ee=(De,Oe)=>ke.reverse(ke.interpolate(ke.forward(De),ke.forward(Oe),he))}return typeof ge.evaluate=="function"?{evaluate(...ke){const De=ge.evaluate.apply(void 0,ke),Oe=we.evaluate.apply(void 0,ke);if(De!==void 0&&Oe!==void 0)return Ee(De,Oe,he)}}:Ee(ge,we,he)}function ys(U,y,I){return y.type==="color"?I=zr.parse(I):y.type==="formatted"?I=Pi.fromString(I.toString()):y.type==="resolvedImage"?I=ki.fromString(I.toString()):Sr(I)===y.type||y.type==="enum"&&y.values[I]||(I=void 0),ea(I,U.default,y.default)}class oc{constructor(y,I){this.expression=y,this._warningHistory={},this._evaluator=new nu,this._defaultValue=I?function(G){return G.type==="color"&&(Js(G.default)||Array.isArray(G.default))?new zr(0,0,0,0):G.type==="color"?zr.parse(G.default)||null:G.default===void 0?null:G.default}(I):null,this._enumValues=I&&I.type==="enum"?I.values:null}evaluateWithoutErrorHandling(y,I,G,Q,ne,he,ge,we){return this._evaluator.globals=y,this._evaluator.feature=I,this._evaluator.featureState=G,this._evaluator.canonical=Q||null,this._evaluator.availableImages=ne||null,this._evaluator.formattedSection=he,this._evaluator.featureTileCoord=ge||null,this._evaluator.featureDistanceData=we||null,this.expression.evaluate(this._evaluator)}evaluate(y,I,G,Q,ne,he,ge,we){this._evaluator.globals=y,this._evaluator.feature=I||null,this._evaluator.featureState=G||null,this._evaluator.canonical=Q||null,this._evaluator.availableImages=ne||null,this._evaluator.formattedSection=he||null,this._evaluator.featureTileCoord=ge||null,this._evaluator.featureDistanceData=we||null;try{const Ee=this.expression.evaluate(this._evaluator);if(Ee==null||typeof Ee=="number"&&Ee!=Ee)return this._defaultValue;if(this._enumValues&&!(Ee in this._enumValues))throw new ui(`Expected value to be one of ${Object.keys(this._enumValues).map(ke=>JSON.stringify(ke)).join(", ")}, but found ${JSON.stringify(Ee)} instead.`);return Ee}catch(Ee){return this._warningHistory[Ee.message]||(this._warningHistory[Ee.message]=!0,typeof console!="undefined"&&console.warn(Ee.message)),this._defaultValue}}}function Ka(U){return Array.isArray(U)&&U.length>0&&typeof U[0]=="string"&&U[0]in Ys}function vs(U,y){const I=new Zo(Ys,[],y?function(Q){const ne={color:Yi,string:ur,number:Cn,enum:ur,boolean:hr,formatted:Us,resolvedImage:$s};return Q.type==="array"?Oi(ne[Q.value]||ir,Q.length):ne[Q.type]}(y):void 0),G=I.parse(U,void 0,void 0,void 0,y&&y.type==="string"?{typeAnnotation:"coerce"}:void 0);return G?_u(new oc(G,y)):_s(I.errors)}class sc{constructor(y,I){this.kind=y,this._styleExpression=I,this.isStateDependent=y!=="constant"&&!Po(I.expression)}evaluateWithoutErrorHandling(y,I,G,Q,ne,he){return this._styleExpression.evaluateWithoutErrorHandling(y,I,G,Q,ne,he)}evaluate(y,I,G,Q,ne,he){return this._styleExpression.evaluate(y,I,G,Q,ne,he)}}class ta{constructor(y,I,G,Q){this.kind=y,this.zoomStops=G,this._styleExpression=I,this.isStateDependent=y!=="camera"&&!Po(I.expression),this.interpolationType=Q}evaluateWithoutErrorHandling(y,I,G,Q,ne,he){return this._styleExpression.evaluateWithoutErrorHandling(y,I,G,Q,ne,he)}evaluate(y,I,G,Q,ne,he){return this._styleExpression.evaluate(y,I,G,Q,ne,he)}interpolationFactor(y,I,G){return this.interpolationType?io.interpolationFactor(this.interpolationType,y,I,G):0}}function ac(U,y){if((U=vs(U,y)).result==="error")return U;const I=U.value.expression,G=qo(I);if(!G&&!gs(y))return _s([new Ki("","data expressions not supported")]);const Q=Zs(I,["zoom","pitch","distance-from-center"]);if(!Q&&!gu(y))return _s([new Ki("","zoom expressions not supported")]);const ne=bs(I);return ne||Q?ne instanceof Ki?_s([ne]):ne instanceof io&&!rc(y)?_s([new Ki("",'"interpolate" expressions cannot be used with this property')]):_u(ne?new ta(G?"camera":"composite",U.value,ne.labels,ne instanceof io?ne.interpolation:void 0):new sc(G?"constant":"source",U.value)):_s([new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xs{constructor(y,I){this._parameters=y,this._specification=I,Bi(this,Qs(this._parameters,this._specification))}static deserialize(y){return new xs(y._parameters,y._specification)}static serialize(y){return{_parameters:y._parameters,_specification:y._specification}}}function bs(U){let y=null;if(U instanceof cu)y=bs(U.result);else if(U instanceof lu){for(const I of U.args)if(y=bs(I),y)break}else(U instanceof Ul||U instanceof io)&&U.input instanceof Qi&&U.input.name==="zoom"&&(y=U);return y instanceof Ki||U.eachChild(I=>{const G=bs(I);G instanceof Ki?y=G:!y&&G?y=new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):y&&G&&y!==G&&(y=new Ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),y}class In{constructor(y,I,G,Q){this.message=(y?`${y}: `:"")+G,Q&&(this.identifier=Q),I!=null&&I.__line__&&(this.line=I.__line__)}}function Fi(U){const y=U.key,I=U.value,G=U.valueSpec||{},Q=U.objectElementValidators||{},ne=U.style,he=U.styleSpec;let ge=[];const we=Sr(I);if(we!=="object")return[new In(y,I,`object expected, ${we} found`)];for(const Ee in I){const ke=Ee.split(".")[0],De=G[ke]||G["*"];let Oe;Q[ke]?Oe=Q[ke]:G[ke]?Oe=di:Q["*"]?Oe=Q["*"]:G["*"]&&(Oe=di),Oe?ge=ge.concat(Oe({key:(y&&`${y}.`)+Ee,value:I[Ee],valueSpec:De,style:ne,styleSpec:he,object:I,objectKey:Ee},I)):ge.push(new In(y,I[Ee],`unknown property "${Ee}"`))}for(const Ee in G)Q[Ee]||G[Ee].required&&G[Ee].default===void 0&&I[Ee]===void 0&&ge.push(new In(y,I,`missing required property "${Ee}"`));return ge}function lc(U){const y=U.value,I=U.valueSpec,G=U.style,Q=U.styleSpec,ne=U.key,he=U.arrayElementValidator||di;if(Sr(y)!=="array")return[new In(ne,y,`array expected, ${Sr(y)} found`)];if(I.length&&y.length!==I.length)return[new In(ne,y,`array length ${I.length} expected, length ${y.length} found`)];if(I["min-length"]&&y.length<I["min-length"])return[new In(ne,y,`array length at least ${I["min-length"]} expected, length ${y.length} found`)];let ge={type:I.value,values:I.values,minimum:I.minimum,maximum:I.maximum,function:void 0};Q.$version<7&&(ge.function=I.function),Sr(I.value)==="object"&&(ge=I.value);let we=[];for(let Ee=0;Ee<y.length;Ee++)we=we.concat(he({array:y,arrayIndex:Ee,value:y[Ee],valueSpec:ge,style:G,styleSpec:Q,key:`${ne}[${Ee}]`}));return we}function cc(U){const y=U.key,I=U.value,G=U.valueSpec;let Q=Sr(I);if(Q==="number"&&I!=I&&(Q="NaN"),Q!=="number")return[new In(y,I,`number expected, ${Q} found`)];if("minimum"in G){let ne=G.minimum;if(Sr(G.minimum)==="array"&&(ne=G.minimum[U.arrayIndex]),I<ne)return[new In(y,I,`${I} is less than the minimum value ${ne}`)]}if("maximum"in G){let ne=G.maximum;if(Sr(G.maximum)==="array"&&(ne=G.maximum[U.arrayIndex]),I>ne)return[new In(y,I,`${I} is greater than the maximum value ${ne}`)]}return[]}function na(U){const y=U.valueSpec,I=Qr(U.value.type);let G,Q,ne,he={};const ge=I!=="categorical"&&U.value.property===void 0,we=!ge,Ee=Sr(U.value.stops)==="array"&&Sr(U.value.stops[0])==="array"&&Sr(U.value.stops[0][0])==="object",ke=Fi({key:U.key,value:U.value,valueSpec:U.styleSpec.function,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{stops:function(Ne){if(I==="identity")return[new In(Ne.key,Ne.value,'identity function may not have a "stops" property')];let Ge=[];const We=Ne.value;return Ge=Ge.concat(lc({key:Ne.key,value:We,valueSpec:Ne.valueSpec,style:Ne.style,styleSpec:Ne.styleSpec,arrayElementValidator:De})),Sr(We)==="array"&&We.length===0&&Ge.push(new In(Ne.key,We,"array must have at least one stop")),Ge},default:function(Ne){return di({key:Ne.key,value:Ne.value,valueSpec:y,style:Ne.style,styleSpec:Ne.styleSpec})}}});return I==="identity"&&ge&&ke.push(new In(U.key,U.value,'missing required property "property"')),I==="identity"||U.value.stops||ke.push(new In(U.key,U.value,'missing required property "stops"')),I==="exponential"&&U.valueSpec.expression&&!rc(U.valueSpec)&&ke.push(new In(U.key,U.value,"exponential functions not supported")),U.styleSpec.$version>=8&&(we&&!gs(U.valueSpec)?ke.push(new In(U.key,U.value,"property functions not supported")):ge&&!gu(U.valueSpec)&&ke.push(new In(U.key,U.value,"zoom functions not supported"))),I!=="categorical"&&!Ee||U.value.property!==void 0||ke.push(new In(U.key,U.value,'"property" property is required')),ke;function De(Ne){let Ge=[];const We=Ne.value,Je=Ne.key;if(Sr(We)!=="array")return[new In(Je,We,`array expected, ${Sr(We)} found`)];if(We.length!==2)return[new In(Je,We,`array length 2 expected, length ${We.length} found`)];if(Ee){if(Sr(We[0])!=="object")return[new In(Je,We,`object expected, ${Sr(We[0])} found`)];if(We[0].zoom===void 0)return[new In(Je,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new In(Je,We,"object stop key must have value")];const st=Qr(We[0].zoom);if(typeof st!="number")return[new In(Je,We[0].zoom,"stop zoom values must be numbers")];if(ne&&ne>st)return[new In(Je,We[0].zoom,"stop zoom values must appear in ascending order")];st!==ne&&(ne=st,Q=void 0,he={}),Ge=Ge.concat(Fi({key:`${Je}[0]`,value:We[0],valueSpec:{zoom:{}},style:Ne.style,styleSpec:Ne.styleSpec,objectElementValidators:{zoom:cc,value:Oe}}))}else Ge=Ge.concat(Oe({key:`${Je}[0]`,value:We[0],valueSpec:{},style:Ne.style,styleSpec:Ne.styleSpec},We));return Ka(Ao(We[1]))?Ge.concat([new In(`${Je}[1]`,We[1],"expressions are not allowed in function stops.")]):Ge.concat(di({key:`${Je}[1]`,value:We[1],valueSpec:y,style:Ne.style,styleSpec:Ne.styleSpec}))}function Oe(Ne,Ge){const We=Sr(Ne.value),Je=Qr(Ne.value),st=Ne.value!==null?Ne.value:Ge;if(G){if(We!==G)return[new In(Ne.key,st,`${We} stop domain type must match previous stop domain type ${G}`)]}else G=We;if(We!=="number"&&We!=="string"&&We!=="boolean"&&typeof Je!="number"&&typeof Je!="string"&&typeof Je!="boolean")return[new In(Ne.key,st,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&I!=="categorical"){let pt=`number expected, ${We} found`;return gs(y)&&I===void 0&&(pt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new In(Ne.key,st,pt)]}return I!=="categorical"||We!=="number"||typeof Je=="number"&&isFinite(Je)&&Math.floor(Je)===Je?I!=="categorical"&&We==="number"&&typeof Je=="number"&&typeof Q=="number"&&Q!==void 0&&Je<Q?[new In(Ne.key,st,"stop domain values must appear in ascending order")]:(Q=Je,I==="categorical"&&Je in he?[new In(Ne.key,st,"stop domain values must be unique")]:(he[Je]=!0,[])):[new In(Ne.key,st,`integer expected, found ${String(Je)}`)]}}function eo(U){const y=(U.expressionContext==="property"?ac:vs)(Ao(U.value),U.valueSpec);if(y.result==="error")return y.value.map(G=>new In(`${U.key}${G.key}`,U.value,G.message));const I=y.value.expression||y.value._styleExpression.expression;if(U.expressionContext==="property"&&U.propertyKey==="text-font"&&!I.outputDefined())return[new In(U.key,U.value,`Invalid data expression for "${U.propertyKey}". Output values must be contained as literals within the expression.`)];if(U.expressionContext==="property"&&U.propertyType==="layout"&&!Po(I))return[new In(U.key,U.value,'"feature-state" data expressions are not supported with layout properties.')];if(U.expressionContext==="filter")return uc(I,U);if(U.expressionContext&&U.expressionContext.indexOf("cluster")===0){if(!Zs(I,["zoom","feature-state"]))return[new In(U.key,U.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(U.expressionContext==="cluster-initial"&&!qo(I))return[new In(U.key,U.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uc(U,y){const I=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(y.valueSpec&&y.valueSpec.expression)for(const Q of y.valueSpec.expression.parameters)I.delete(Q);if(I.size===0)return[];const G=[];return U instanceof Qi&&I.has(U.name)?[new In(y.key,y.value,`["${U.name}"] expression is not supported in a filter for a ${y.object.type} layer with id: ${y.object.id}`)]:(U.eachChild(Q=>{G.push(...uc(Q,y))}),G)}function ra(U){const y=U.key,I=U.value,G=U.valueSpec,Q=[];return Array.isArray(G.values)?G.values.indexOf(Qr(I))===-1&&Q.push(new In(y,I,`expected one of [${G.values.join(", ")}], ${JSON.stringify(I)} found`)):Object.keys(G.values).indexOf(Qr(I))===-1&&Q.push(new In(y,I,`expected one of [${Object.keys(G.values).join(", ")}], ${JSON.stringify(I)} found`)),Q}function ia(U){if(U===!0||U===!1)return!0;if(!Array.isArray(U)||U.length===0)return!1;switch(U[0]){case"has":return U.length>=2&&U[1]!=="$id"&&U[1]!=="$type";case"in":return U.length>=3&&(typeof U[1]!="string"||Array.isArray(U[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return U.length!==3||Array.isArray(U[1])||Array.isArray(U[2]);case"any":case"all":for(const y of U.slice(1))if(!ia(y)&&typeof y!="boolean")return!1;return!0;default:return!0}}function oa(U,y="fill"){if(U==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ia(U)||(U=Ya(U));const I=U;let G=!0;try{G=function(Ee){if(!ho(Ee))return Ee;let ke=Ao(Ee);return hc(ke),ke=vu(ke),ke}(I)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(I,null,2)}
        `)}const Q=Zt[`filter_${y}`],ne=vs(G,Q);let he=null;if(ne.result==="error")throw new Error(ne.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));he=(Ee,ke,De)=>ne.value.evaluate(Ee,ke,{},De);let ge=null,we=null;if(G!==I){const Ee=vs(I,Q);if(Ee.result==="error")throw new Error(Ee.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));ge=(ke,De,Oe,Ne,Ge)=>Ee.value.evaluate(ke,De,{},Oe,void 0,void 0,Ne,Ge),we=!qo(Ee.value.expression)}return he=he,{filter:he,dynamicFilter:ge||void 0,needGeometry:xu(G),needFeature:!!we}}function vu(U){if(!Array.isArray(U))return U;const y=function(I){if(qh.has(I[0])){for(let G=1;G<I.length;G++)if(ho(I[G]))return!0}return I}(U);return y===!0?y:y.map(I=>vu(I))}function hc(U){let y=!1;const I=[];if(U[0]==="case"){for(let G=1;G<U.length-1;G+=2)y=y||ho(U[G]),I.push(U[G+1]);I.push(U[U.length-1])}else if(U[0]==="match"){y=y||ho(U[1]);for(let G=2;G<U.length-1;G+=2)I.push(U[G+1]);I.push(U[U.length-1])}else if(U[0]==="step"){y=y||ho(U[1]);for(let G=1;G<U.length-1;G+=2)I.push(U[G+1])}y&&(U.length=0,U.push("any",...I));for(let G=1;G<U.length;G++)hc(U[G])}function ho(U){if(!Array.isArray(U))return!1;if((y=U[0])==="pitch"||y==="distance-from-center")return!0;var y;for(let I=1;I<U.length;I++)if(ho(U[I]))return!0;return!1}const qh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Zh(U,y){return U<y?-1:U>y?1:0}function xu(U){if(!Array.isArray(U))return!1;if(U[0]==="within")return!0;for(let y=1;y<U.length;y++)if(xu(U[y]))return!0;return!1}function Ya(U){if(!U)return!0;const y=U[0];return U.length<=1?y!=="any":y==="=="?dc(U[1],U[2],"=="):y==="!="?vi(dc(U[1],U[2],"==")):y==="<"||y===">"||y==="<="||y===">="?dc(U[1],U[2],y):y==="any"?(I=U.slice(1),["any"].concat(I.map(Ya))):y==="all"?["all"].concat(U.slice(1).map(Ya)):y==="none"?["all"].concat(U.slice(1).map(Ya).map(vi)):y==="in"?sa(U[1],U.slice(2)):y==="!in"?vi(sa(U[1],U.slice(2))):y==="has"?aa(U[1]):y==="!has"?vi(aa(U[1])):y!=="within"||U;var I}function dc(U,y,I){switch(U){case"$type":return[`filter-type-${I}`,y];case"$id":return[`filter-id-${I}`,y];default:return[`filter-${I}`,U,y]}}function sa(U,y){if(y.length===0)return!1;switch(U){case"$type":return["filter-type-in",["literal",y]];case"$id":return["filter-id-in",["literal",y]];default:return y.length>200&&!y.some(I=>typeof I!=typeof y[0])?["filter-in-large",U,["literal",y.sort(Zh)]]:["filter-in-small",U,["literal",y]]}}function aa(U){switch(U){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",U]}}function vi(U){return["!",U]}function ws(U){return ia(Ao(U.value))?eo(Bi({},U,{expressionContext:"filter",valueSpec:U.styleSpec[`filter_${U.layerType||"fill"}`]})):bu(U)}function bu(U){const y=U.value,I=U.key;if(Sr(y)!=="array")return[new In(I,y,`array expected, ${Sr(y)} found`)];const G=U.styleSpec;let Q,ne=[];if(y.length<1)return[new In(I,y,"filter array must have at least 1 element")];switch(ne=ne.concat(ra({key:`${I}[0]`,value:y[0],valueSpec:G.filter_operator,style:U.style,styleSpec:U.styleSpec})),Qr(y[0])){case"<":case"<=":case">":case">=":y.length>=2&&Qr(y[1])==="$type"&&ne.push(new In(I,y,`"$type" cannot be use with operator "${y[0]}"`));case"==":case"!=":y.length!==3&&ne.push(new In(I,y,`filter array for operator "${y[0]}" must have 3 elements`));case"in":case"!in":y.length>=2&&(Q=Sr(y[1]),Q!=="string"&&ne.push(new In(`${I}[1]`,y[1],`string expected, ${Q} found`)));for(let he=2;he<y.length;he++)Q=Sr(y[he]),Qr(y[1])==="$type"?ne=ne.concat(ra({key:`${I}[${he}]`,value:y[he],valueSpec:G.geometry_type,style:U.style,styleSpec:U.styleSpec})):Q!=="string"&&Q!=="number"&&Q!=="boolean"&&ne.push(new In(`${I}[${he}]`,y[he],`string, number, or boolean expected, ${Q} found`));break;case"any":case"all":case"none":for(let he=1;he<y.length;he++)ne=ne.concat(bu({key:`${I}[${he}]`,value:y[he],style:U.style,styleSpec:U.styleSpec}));break;case"has":case"!has":Q=Sr(y[1]),y.length!==2?ne.push(new In(I,y,`filter array for "${y[0]}" operator must have 2 elements`)):Q!=="string"&&ne.push(new In(`${I}[1]`,y[1],`string expected, ${Q} found`));break;case"within":Q=Sr(y[1]),y.length!==2?ne.push(new In(I,y,`filter array for "${y[0]}" operator must have 2 elements`)):Q!=="object"&&ne.push(new In(`${I}[1]`,y[1],`object expected, ${Q} found`))}return ne}function wu(U,y){const I=U.key,G=U.style,Q=U.styleSpec,ne=U.value,he=U.objectKey,ge=Q[`${y}_${U.layerType}`];if(!ge)return[];const we=he.match(/^(.*)-transition$/);if(y==="paint"&&we&&ge[we[1]]&&ge[we[1]].transition)return di({key:I,value:ne,valueSpec:Q.transition,style:G,styleSpec:Q});const Ee=U.valueSpec||ge[he];if(!Ee)return[new In(I,ne,`unknown property "${he}"`)];let ke;if(Sr(ne)==="string"&&gs(Ee)&&!Ee.tokens&&(ke=/^{([^}]+)}$/.exec(ne)))return[new In(I,ne,`"${he}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ke[1])} }\`.`)];const De=[];return U.layerType==="symbol"&&(he==="text-field"&&G&&!G.glyphs&&De.push(new In(I,ne,'use of "text-field" requires a style "glyphs" property')),he==="text-font"&&Js(Ao(ne))&&Qr(ne.type)==="identity"&&De.push(new In(I,ne,'"text-font" does not support identity functions'))),De.concat(di({key:U.key,value:ne,valueSpec:Ee,style:G,styleSpec:Q,expressionContext:"property",propertyType:y,propertyKey:he}))}function Tu(U){return wu(U,"paint")}function Eu(U){return wu(U,"layout")}function Ja(U){let y=[];const I=U.value,G=U.key,Q=U.style,ne=U.styleSpec;I.type||I.ref||y.push(new In(G,I,'either "type" or "ref" is required'));let he=Qr(I.type);const ge=Qr(I.ref);if(I.id){const we=Qr(I.id);for(let Ee=0;Ee<U.arrayIndex;Ee++){const ke=Q.layers[Ee];Qr(ke.id)===we&&y.push(new In(G,I.id,`duplicate layer id "${I.id}", previously used at line ${ke.id.__line__}`))}}if("ref"in I){let we;["type","source","source-layer","filter","layout"].forEach(Ee=>{Ee in I&&y.push(new In(G,I[Ee],`"${Ee}" is prohibited for ref layers`))}),Q.layers.forEach(Ee=>{Qr(Ee.id)===ge&&(we=Ee)}),we?we.ref?y.push(new In(G,I.ref,"ref cannot reference another ref layer")):he=Qr(we.type):typeof ge=="string"&&y.push(new In(G,I.ref,`ref layer "${ge}" not found`))}else if(he!=="background"&&he!=="sky")if(I.source){const we=Q.sources&&Q.sources[I.source],Ee=we&&Qr(we.type);we?Ee==="vector"&&he==="raster"?y.push(new In(G,I.source,`layer "${I.id}" requires a raster source`)):Ee==="raster"&&he!=="raster"?y.push(new In(G,I.source,`layer "${I.id}" requires a vector source`)):Ee!=="vector"||I["source-layer"]?Ee==="raster-dem"&&he!=="hillshade"?y.push(new In(G,I.source,"raster-dem source can only be used with layer type 'hillshade'.")):he!=="line"||!I.paint||!I.paint["line-gradient"]&&!I.paint["line-trim-offset"]||Ee==="geojson"&&we.lineMetrics||y.push(new In(G,I,`layer "${I.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):y.push(new In(G,I,`layer "${I.id}" must specify a "source-layer"`)):y.push(new In(G,I.source,`source "${I.source}" not found`))}else y.push(new In(G,I,'missing required property "source"'));return y=y.concat(Fi({key:G,value:I,valueSpec:ne.layer,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{"*":()=>[],type:()=>di({key:`${G}.type`,value:I.type,valueSpec:ne.layer.type,style:U.style,styleSpec:U.styleSpec,object:I,objectKey:"type"}),filter:we=>ws(Bi({layerType:he},we)),layout:we=>Fi({layer:I,key:we.key,value:we.value,valueSpec:{},style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":Ee=>Eu(Bi({layerType:he},Ee))}}),paint:we=>Fi({layer:I,key:we.key,value:we.value,valueSpec:{},style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":Ee=>Tu(Bi({layerType:he},Ee))}})}})),y}function Ts(U){const y=U.value,I=U.key,G=Sr(y);return G!=="string"?[new In(I,y,`string expected, ${G} found`)]:[]}const Qa={promoteId:function({key:U,value:y}){if(Sr(y)==="string")return Ts({key:U,value:y});{const I=[];for(const G in y)I.push(...Ts({key:`${U}.${G}`,value:y[G]}));return I}}};function Au(U){const y=U.value,I=U.key,G=U.styleSpec,Q=U.style;if(!y.type)return[new In(I,y,'"type" is required')];const ne=Qr(y.type);let he;switch(ne){case"vector":case"raster":case"raster-dem":return he=Fi({key:I,value:y,valueSpec:G[`source_${ne.replace("-","_")}`],style:U.style,styleSpec:G,objectElementValidators:Qa}),he;case"geojson":if(he=Fi({key:I,value:y,valueSpec:G.source_geojson,style:Q,styleSpec:G,objectElementValidators:Qa}),y.cluster)for(const ge in y.clusterProperties){const[we,Ee]=y.clusterProperties[ge],ke=typeof we=="string"?[we,["accumulated"],["get",ge]]:we;he.push(...eo({key:`${I}.${ge}.map`,value:Ee,expressionContext:"cluster-map"})),he.push(...eo({key:`${I}.${ge}.reduce`,value:ke,expressionContext:"cluster-reduce"}))}return he;case"video":return Fi({key:I,value:y,valueSpec:G.source_video,style:Q,styleSpec:G});case"image":return Fi({key:I,value:y,valueSpec:G.source_image,style:Q,styleSpec:G});case"canvas":return[new In(I,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ra({key:`${I}.type`,value:y.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:Q,styleSpec:G})}}function Su(U){const y=U.value,I=U.styleSpec,G=I.light,Q=U.style;let ne=[];const he=Sr(y);if(y===void 0)return ne;if(he!=="object")return ne=ne.concat([new In("light",y,`object expected, ${he} found`)]),ne;for(const ge in y){const we=ge.match(/^(.*)-transition$/);ne=ne.concat(we&&G[we[1]]&&G[we[1]].transition?di({key:ge,value:y[ge],valueSpec:I.transition,style:Q,styleSpec:I}):G[ge]?di({key:ge,value:y[ge],valueSpec:G[ge],style:Q,styleSpec:I}):[new In(ge,y[ge],`unknown property "${ge}"`)])}return ne}function el(U){const y=U.value,I=U.key,G=U.style,Q=U.styleSpec,ne=Q.terrain;let he=[];const ge=Sr(y);if(y===void 0)return he;if(ge!=="object")return he=he.concat([new In("terrain",y,`object expected, ${ge} found`)]),he;for(const we in y){const Ee=we.match(/^(.*)-transition$/);he=he.concat(Ee&&ne[Ee[1]]&&ne[Ee[1]].transition?di({key:we,value:y[we],valueSpec:Q.transition,style:G,styleSpec:Q}):ne[we]?di({key:we,value:y[we],valueSpec:ne[we],style:G,styleSpec:Q}):[new In(we,y[we],`unknown property "${we}"`)])}if(y.source){const we=G.sources&&G.sources[y.source],Ee=we&&Qr(we.type);we?Ee!=="raster-dem"&&he.push(new In(I,y.source,`terrain cannot be used with a source of type ${String(Ee)}, it only be used with a "raster-dem" source type`)):he.push(new In(I,y.source,`source "${y.source}" not found`))}else he.push(new In(I,y,'terrain is missing required property "source"'));return he}function Cu(U){const y=U.value,I=U.style,G=U.styleSpec,Q=G.fog;let ne=[];const he=Sr(y);if(y===void 0)return ne;if(he!=="object")return ne=ne.concat([new In("fog",y,`object expected, ${he} found`)]),ne;for(const ge in y){const we=ge.match(/^(.*)-transition$/);ne=ne.concat(we&&Q[we[1]]&&Q[we[1]].transition?di({key:ge,value:y[ge],valueSpec:G.transition,style:I,styleSpec:G}):Q[ge]?di({key:ge,value:y[ge],valueSpec:Q[ge],style:I,styleSpec:G}):[new In(ge,y[ge],`unknown property "${ge}"`)])}return ne}const pc={"*":()=>[],array:lc,boolean:function(U){const y=U.value,I=U.key,G=Sr(y);return G!=="boolean"?[new In(I,y,`boolean expected, ${G} found`)]:[]},number:cc,color:function(U){const y=U.key,I=U.value,G=Sr(I);return G!=="string"?[new In(y,I,`color expected, ${G} found`)]:Co.parseCSSColor(I)===null?[new In(y,I,`color expected, "${I}" found`)]:[]},enum:ra,filter:ws,function:na,layer:Ja,object:Fi,source:Au,light:Su,terrain:el,fog:Cu,string:Ts,formatted:function(U){return Ts(U).length===0?[]:eo(U)},resolvedImage:function(U){return Ts(U).length===0?[]:eo(U)},projection:function(U){const y=U.value,I=U.styleSpec,G=I.projection,Q=U.style;let ne=[];const he=Sr(y);if(he==="object")for(const ge in y)ne=ne.concat(di({key:ge,value:y[ge],valueSpec:G[ge],style:Q,styleSpec:I}));else he!=="string"&&(ne=ne.concat([new In("projection",y,`object or string expected, ${he} found`)]));return ne}};function di(U){const y=U.value,I=U.valueSpec,G=U.styleSpec;return I.expression&&Js(Qr(y))?na(U):I.expression&&Ka(Ao(y))?eo(U):I.type&&pc[I.type]?pc[I.type](U):Fi(Bi({},U,{valueSpec:I.type?G[I.type]:I}))}function Hh(U){const y=U.value,I=U.key,G=Ts(U);return G.length||(y.indexOf("{fontstack}")===-1&&G.push(new In(I,y,'"glyphs" url must include a "{fontstack}" token')),y.indexOf("{range}")===-1&&G.push(new In(I,y,'"glyphs" url must include a "{range}" token'))),G}function tl(U,y=Zt){return po(di({key:"",value:U,valueSpec:y.$root,styleSpec:y,style:U,objectElementValidators:{glyphs:Hh,"*":()=>[]}}))}const nl=U=>po(Tu(U)),Iu=U=>po(Eu(U));function po(U){return U.slice().sort((y,I)=>y.line&&I.line?y.line-I.line:0)}function fc(U,y){let I=!1;if(y&&y.length)for(const G of y)U.fire(new Rr(new Error(G.message))),I=!0;return I}var Es=Gi;function Gi(U,y,I){var G=this.cells=[];if(U instanceof ArrayBuffer){this.arrayBuffer=U;var Q=new Int32Array(this.arrayBuffer);U=Q[0],this.d=(y=Q[1])+2*(I=Q[2]);for(var ne=0;ne<this.d*this.d;ne++){var he=Q[3+ne],ge=Q[3+ne+1];G.push(he===ge?null:Q.subarray(he,ge))}var we=Q[3+G.length+1];this.keys=Q.subarray(Q[3+G.length],we),this.bboxes=Q.subarray(we),this.insert=this._insertReadonly}else{this.d=y+2*I;for(var Ee=0;Ee<this.d*this.d;Ee++)G.push([]);this.keys=[],this.bboxes=[]}this.n=y,this.extent=U,this.padding=I,this.scale=y/U,this.uid=0;var ke=I/y*U;this.min=-ke,this.max=U+ke}Gi.prototype.insert=function(U,y,I,G,Q){this._forEachCell(y,I,G,Q,this._insertCell,this.uid++),this.keys.push(U),this.bboxes.push(y),this.bboxes.push(I),this.bboxes.push(G),this.bboxes.push(Q)},Gi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Gi.prototype._insertCell=function(U,y,I,G,Q,ne){this.cells[Q].push(ne)},Gi.prototype.query=function(U,y,I,G,Q){var ne=this.min,he=this.max;if(U<=ne&&y<=ne&&he<=I&&he<=G&&!Q)return Array.prototype.slice.call(this.keys);var ge=[];return this._forEachCell(U,y,I,G,this._queryCell,ge,{},Q),ge},Gi.prototype._queryCell=function(U,y,I,G,Q,ne,he,ge){var we=this.cells[Q];if(we!==null)for(var Ee=this.keys,ke=this.bboxes,De=0;De<we.length;De++){var Oe=we[De];if(he[Oe]===void 0){var Ne=4*Oe;(ge?ge(ke[Ne+0],ke[Ne+1],ke[Ne+2],ke[Ne+3]):U<=ke[Ne+2]&&y<=ke[Ne+3]&&I>=ke[Ne+0]&&G>=ke[Ne+1])?(he[Oe]=!0,ne.push(Ee[Oe])):he[Oe]=!1}}},Gi.prototype._forEachCell=function(U,y,I,G,Q,ne,he,ge){for(var we=this._convertToCellCoord(U),Ee=this._convertToCellCoord(y),ke=this._convertToCellCoord(I),De=this._convertToCellCoord(G),Oe=we;Oe<=ke;Oe++)for(var Ne=Ee;Ne<=De;Ne++){var Ge=this.d*Ne+Oe;if((!ge||ge(this._convertFromCellCoord(Oe),this._convertFromCellCoord(Ne),this._convertFromCellCoord(Oe+1),this._convertFromCellCoord(Ne+1)))&&Q.call(this,U,y,I,G,Ge,ne,he,ge))return}},Gi.prototype._convertFromCellCoord=function(U){return(U-this.padding)/this.scale},Gi.prototype._convertToCellCoord=function(U){return Math.max(0,Math.min(this.d-1,Math.floor(U*this.scale)+this.padding))},Gi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var U=this.cells,y=3+this.cells.length+1+1,I=0,G=0;G<this.cells.length;G++)I+=this.cells[G].length;var Q=new Int32Array(y+I+this.keys.length+this.bboxes.length);Q[0]=this.extent,Q[1]=this.n,Q[2]=this.padding;for(var ne=y,he=0;he<U.length;he++){var ge=U[he];Q[3+he]=ne,Q.set(ge,ne),ne+=ge.length}return Q[3+U.length]=ne,Q.set(this.keys,ne),Q[3+U.length+1]=ne+=this.keys.length,Q.set(this.bboxes,ne),ne+=this.bboxes.length,Q.buffer};const rl={};function Pn(U,y,I={}){Object.defineProperty(U,"_classRegistryKey",{value:y,writeable:!1}),rl[y]={klass:U,omit:I.omit||[]}}Pn(Object,"Object"),Es.serialize=function(U,y){const I=U.toArrayBuffer();return y&&y.push(I),{buffer:I}},Es.deserialize=function(U){return new Es(U.buffer)},Object.defineProperty(Es,"name",{value:"Grid"}),Pn(Es,"Grid"),Pn(zr,"Color"),Pn(Error,"Error"),Pn(zt,"AJAXError"),Pn(ki,"ResolvedImage"),Pn(xs,"StylePropertyFunction"),Pn(oc,"StyleExpression",{omit:["_evaluator"]}),Pn(ta,"ZoomDependentExpression"),Pn(sc,"ZoomConstantExpression"),Pn(Qi,"CompoundExpression",{omit:["_evaluate"]});for(const U in Ys)rl[Ys[U]._classRegistryKey]||Pn(Ys[U],`Expression${U}`);function Mu(U){return U&&typeof ArrayBuffer!="undefined"&&(U instanceof ArrayBuffer||U.constructor&&U.constructor.name==="ArrayBuffer")}function Pu(U){return Ce.ImageBitmap&&U instanceof Ce.ImageBitmap}function As(U,y){if(U==null||typeof U=="boolean"||typeof U=="number"||typeof U=="string"||U instanceof Boolean||U instanceof Number||U instanceof String||U instanceof Date||U instanceof RegExp)return U;if(Mu(U)||Pu(U))return y&&y.push(U),U;if(ArrayBuffer.isView(U)){const I=U;return y&&y.push(I.buffer),I}if(U instanceof Ce.ImageData)return y&&y.push(U.data.buffer),U;if(Array.isArray(U)){const I=[];for(const G of U)I.push(As(G,y));return I}if(typeof U=="object"){const I=U.constructor,G=I._classRegistryKey;if(!G)throw new Error(`can't serialize object of unregistered class ${G}`);const Q=I.serialize?I.serialize(U,y):{};if(!I.serialize){for(const ne in U)U.hasOwnProperty(ne)&&(rl[G].omit.indexOf(ne)>=0||(Q[ne]=As(U[ne],y)));U instanceof Error&&(Q.message=U.message)}if(Q.$name)throw new Error("$name property is reserved for worker serialization logic.");return G!=="Object"&&(Q.$name=G),Q}throw new Error("can't serialize object of type "+typeof U)}function la(U){if(U==null||typeof U=="boolean"||typeof U=="number"||typeof U=="string"||U instanceof Boolean||U instanceof Number||U instanceof String||U instanceof Date||U instanceof RegExp||Mu(U)||Pu(U)||ArrayBuffer.isView(U)||U instanceof Ce.ImageData)return U;if(Array.isArray(U))return U.map(la);if(typeof U=="object"){const y=U.$name||"Object",{klass:I}=rl[y];if(!I)throw new Error(`can't deserialize unregistered class ${y}`);if(I.deserialize)return I.deserialize(U);const G=Object.create(I.prototype);for(const Q of Object.keys(U))Q!=="$name"&&(G[Q]=la(U[Q]));return G}throw new Error("can't deserialize object of type "+typeof U)}class ku{constructor(){this.first=!0}update(y,I){const G=Math.floor(y);return this.first?(this.first=!1,this.lastIntegerZoom=G,this.lastIntegerZoomTime=0,this.lastZoom=y,this.lastFloorZoom=G,!0):(this.lastFloorZoom>G?(this.lastIntegerZoom=G+1,this.lastIntegerZoomTime=I):this.lastFloorZoom<G&&(this.lastIntegerZoom=G,this.lastIntegerZoomTime=I),y!==this.lastZoom&&(this.lastZoom=y,this.lastFloorZoom=G,!0))}}const Ru=U=>U>=1536&&U<=1791,zu=U=>U>=1872&&U<=1919,Du=U=>U>=2208&&U<=2303,Lu=U=>U>=11904&&U<=12031,Bu=U=>U>=12032&&U<=12255,ca=U=>U>=12272&&U<=12287,il=U=>U>=12288&&U<=12351,mc=U=>U>=12352&&U<=12447,Ho=U=>U>=12448&&U<=12543,Ou=U=>U>=12544&&U<=12591,_c=U=>U>=12704&&U<=12735,Fu=U=>U>=12736&&U<=12783,gc=U=>U>=12784&&U<=12799,yc=U=>U>=12800&&U<=13055,vc=U=>U>=13056&&U<=13311,xc=U=>U>=13312&&U<=19903,ua=U=>U>=19968&&U<=40959,ol=U=>U>=40960&&U<=42127,Uu=U=>U>=42128&&U<=42191,$u=U=>U>=44032&&U<=55215,Nu=U=>U>=63744&&U<=64255,ha=U=>U>=64336&&U<=65023,ju=U=>U>=65040&&U<=65055,bc=U=>U>=65072&&U<=65103,Vu=U=>U>=65104&&U<=65135,wc=U=>U>=65136&&U<=65279,Tc=U=>U>=65280&&U<=65519;function sl(U){for(const y of U)if(al(y.charCodeAt(0)))return!0;return!1}function Wh(U){for(const y of U)if(!Xh(y.charCodeAt(0)))return!1;return!0}function Xh(U){return!(Ru(U)||zu(U)||Du(U)||ha(U)||wc(U))}function al(U){return!(U!==746&&U!==747&&(U<4352||!(_c(U)||Ou(U)||bc(U)&&!(U>=65097&&U<=65103)||Nu(U)||vc(U)||Lu(U)||Fu(U)||!(!il(U)||U>=12296&&U<=12305||U>=12308&&U<=12319||U===12336)||xc(U)||ua(U)||yc(U)||(y=>y>=12592&&y<=12687)(U)||(y=>y>=43360&&y<=43391)(U)||(y=>y>=55216&&y<=55295)(U)||(y=>y>=4352&&y<=4607)(U)||$u(U)||mc(U)||ca(U)||(y=>y>=12688&&y<=12703)(U)||Bu(U)||gc(U)||Ho(U)&&U!==12540||!(!Tc(U)||U===65288||U===65289||U===65293||U>=65306&&U<=65310||U===65339||U===65341||U===65343||U>=65371&&U<=65503||U===65507||U>=65512&&U<=65519)||!(!Vu(U)||U>=65112&&U<=65118||U>=65123&&U<=65126)||(y=>y>=5120&&y<=5759)(U)||(y=>y>=6320&&y<=6399)(U)||ju(U)||(y=>y>=19904&&y<=19967)(U)||ol(U)||Uu(U))))}function da(U){return!(al(U)||function(y){return!!((I=>I>=128&&I<=255)(y)&&(y===167||y===169||y===174||y===177||y===188||y===189||y===190||y===215||y===247)||(I=>I>=8192&&I<=8303)(y)&&(y===8214||y===8224||y===8225||y===8240||y===8241||y===8251||y===8252||y===8258||y===8263||y===8264||y===8265||y===8273)||(I=>I>=8448&&I<=8527)(y)||(I=>I>=8528&&I<=8591)(y)||(I=>I>=8960&&I<=9215)(y)&&(y>=8960&&y<=8967||y>=8972&&y<=8991||y>=8996&&y<=9e3||y===9003||y>=9085&&y<=9114||y>=9150&&y<=9165||y===9167||y>=9169&&y<=9179||y>=9186&&y<=9215)||(I=>I>=9216&&I<=9279)(y)&&y!==9251||(I=>I>=9280&&I<=9311)(y)||(I=>I>=9312&&I<=9471)(y)||(I=>I>=9632&&I<=9727)(y)||(I=>I>=9728&&I<=9983)(y)&&!(y>=9754&&y<=9759)||(I=>I>=11008&&I<=11263)(y)&&(y>=11026&&y<=11055||y>=11088&&y<=11097||y>=11192&&y<=11243)||il(y)||Ho(y)||(I=>I>=57344&&I<=63743)(y)||bc(y)||Vu(y)||Tc(y)||y===8734||y===8756||y===8757||y>=9984&&y<=10087||y>=10102&&y<=10131||y===65532||y===65533)}(U))}function te(U){return U>=1424&&U<=2303||ha(U)||wc(U)}function $(U,y){return!(!y&&te(U)||U>=2304&&U<=3583||U>=3840&&U<=4255||(I=>I>=6016&&I<=6143)(U))}function q(U){for(const y of U)if(te(y.charCodeAt(0)))return!0;return!1}const re="deferred",ye="loading",be="loaded";let Se=null,Ie="unavailable",Re=null;const Fe=function(U){U&&typeof U=="string"&&U.indexOf("NetworkError")>-1&&(Ie="error"),Se&&Se(U)};function Ue(){Ze.fire(new Br("pluginStateChange",{pluginStatus:Ie,pluginURL:Re}))}const Ze=new jn,Ye=function(){return Ie},rt=function(){if(Ie!==re||!Re)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ie=ye,Ue(),Re&&Lt({url:Re},U=>{U?Fe(U):(Ie=be,Ue())})},et={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ie===be||et.applyArabicShaping!=null,isLoading:()=>Ie===ye,setState(U){Ie=U.pluginStatus,Re=U.pluginURL},isParsed:()=>et.applyArabicShaping!=null&&et.processBidirectionalText!=null&&et.processStyledBidirectionalText!=null,getPluginURL:()=>Re};class tt{constructor(y,I){this.zoom=y,I?(this.now=I.now,this.fadeDuration=I.fadeDuration,this.zoomHistory=I.zoomHistory,this.transition=I.transition,this.pitch=I.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ku,this.transition={},this.pitch=0)}isSupportedScript(y){return function(I,G){for(const Q of I)if(!$(Q.charCodeAt(0),G))return!1;return!0}(y,et.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const y=this.zoom,I=y-Math.floor(y),G=this.crossFadingFactor();return y>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:I+(1-I)*G}:{fromScale:.5,toScale:1,t:1-(1-G)*I}}}class nt{constructor(y,I){this.property=y,this.value=I,this.expression=function(G,Q){if(Js(G))return new xs(G,Q);if(Ka(G)){const ne=ac(G,Q);if(ne.result==="error")throw new Error(ne.value.map(he=>`${he.key}: ${he.message}`).join(", "));return ne.value}{let ne=G;return typeof G=="string"&&Q.type==="color"&&(ne=zr.parse(G)),{kind:"constant",evaluate:()=>ne}}}(I===void 0?y.specification.default:I,y.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(y,I,G){return this.property.possiblyEvaluate(this,y,I,G)}}class Qe{constructor(y){this.property=y,this.value=new nt(y,void 0)}transitioned(y,I){return new it(this.property,this.value,I,Ut({},y.transition,this.transition),y.now)}untransitioned(){return new it(this.property,this.value,null,{},0)}}class lt{constructor(y){this._properties=y,this._values=Object.create(y.defaultTransitionablePropertyValues)}getValue(y){return sr(this._values[y].value.value)}setValue(y,I){this._values.hasOwnProperty(y)||(this._values[y]=new Qe(this._values[y].property)),this._values[y].value=new nt(this._values[y].property,I===null?void 0:sr(I))}getTransition(y){return sr(this._values[y].transition)}setTransition(y,I){this._values.hasOwnProperty(y)||(this._values[y]=new Qe(this._values[y].property)),this._values[y].transition=sr(I)||void 0}serialize(){const y={};for(const I of Object.keys(this._values)){const G=this.getValue(I);G!==void 0&&(y[I]=G);const Q=this.getTransition(I);Q!==void 0&&(y[`${I}-transition`]=Q)}return y}transitioned(y,I){const G=new xt(this._properties);for(const Q of Object.keys(this._values))G._values[Q]=this._values[Q].transitioned(y,I._values[Q]);return G}untransitioned(){const y=new xt(this._properties);for(const I of Object.keys(this._values))y._values[I]=this._values[I].untransitioned();return y}}class it{constructor(y,I,G,Q,ne){const he=Q.delay||0,ge=Q.duration||0;ne=ne||0,this.property=y,this.value=I,this.begin=ne+he,this.end=this.begin+ge,y.specification.transition&&(Q.delay||Q.duration)&&(this.prior=G)}possiblyEvaluate(y,I,G){const Q=y.now||0,ne=this.value.possiblyEvaluate(y,I,G),he=this.prior;if(he){if(Q>this.end)return this.prior=null,ne;if(this.value.isDataDriven())return this.prior=null,ne;if(Q<this.begin)return he.possiblyEvaluate(y,I,G);{const ge=(Q-this.begin)/(this.end-this.begin);return this.property.interpolate(he.possiblyEvaluate(y,I,G),ne,Ct(ge))}}return ne}}class xt{constructor(y){this._properties=y,this._values=Object.create(y.defaultTransitioningPropertyValues)}possiblyEvaluate(y,I,G){const Q=new vt(this._properties);for(const ne of Object.keys(this._values))Q._values[ne]=this._values[ne].possiblyEvaluate(y,I,G);return Q}hasTransition(){for(const y of Object.keys(this._values))if(this._values[y].prior)return!0;return!1}}class gt{constructor(y){this._properties=y,this._values=Object.create(y.defaultPropertyValues)}getValue(y){return sr(this._values[y].value)}setValue(y,I){this._values[y]=new nt(this._values[y].property,I===null?void 0:sr(I))}serialize(){const y={};for(const I of Object.keys(this._values)){const G=this.getValue(I);G!==void 0&&(y[I]=G)}return y}possiblyEvaluate(y,I,G){const Q=new vt(this._properties);for(const ne of Object.keys(this._values))Q._values[ne]=this._values[ne].possiblyEvaluate(y,I,G);return Q}}class dt{constructor(y,I,G){this.property=y,this.value=I,this.parameters=G}isConstant(){return this.value.kind==="constant"}constantOr(y){return this.value.kind==="constant"?this.value.value:y}evaluate(y,I,G,Q){return this.property.evaluate(this.value,this.parameters,y,I,G,Q)}}class vt{constructor(y){this._properties=y,this._values=Object.create(y.defaultPossiblyEvaluatedValues)}get(y){return this._values[y]}}class _t{constructor(y){this.specification=y}possiblyEvaluate(y,I){return y.expression.evaluate(I)}interpolate(y,I,G){const Q=Hs[this.specification.type];return Q?Q(y,I,G):y}}class St{constructor(y,I){this.specification=y,this.overrides=I}possiblyEvaluate(y,I,G,Q){return new dt(this,y.expression.kind==="constant"||y.expression.kind==="camera"?{kind:"constant",value:y.expression.evaluate(I,null,{},G,Q)}:y.expression,I)}interpolate(y,I,G){if(y.value.kind!=="constant"||I.value.kind!=="constant")return y;if(y.value.value===void 0||I.value.value===void 0)return new dt(this,{kind:"constant",value:void 0},y.parameters);const Q=Hs[this.specification.type];return Q?new dt(this,{kind:"constant",value:Q(y.value.value,I.value.value,G)},y.parameters):y}evaluate(y,I,G,Q,ne,he){return y.kind==="constant"?y.value:y.evaluate(I,G,Q,ne,he)}}class Bt extends St{possiblyEvaluate(y,I,G,Q){if(y.value===void 0)return new dt(this,{kind:"constant",value:void 0},I);if(y.expression.kind==="constant"){const ne=y.expression.evaluate(I,null,{},G,Q),he=y.property.specification.type==="resolvedImage"&&typeof ne!="string"?ne.name:ne,ge=this._calculate(he,he,he,I);return new dt(this,{kind:"constant",value:ge},I)}if(y.expression.kind==="camera"){const ne=this._calculate(y.expression.evaluate({zoom:I.zoom-1}),y.expression.evaluate({zoom:I.zoom}),y.expression.evaluate({zoom:I.zoom+1}),I);return new dt(this,{kind:"constant",value:ne},I)}return new dt(this,y.expression,I)}evaluate(y,I,G,Q,ne,he){if(y.kind==="source"){const ge=y.evaluate(I,G,Q,ne,he);return this._calculate(ge,ge,ge,I)}return y.kind==="composite"?this._calculate(y.evaluate({zoom:Math.floor(I.zoom)-1},G,Q),y.evaluate({zoom:Math.floor(I.zoom)},G,Q),y.evaluate({zoom:Math.floor(I.zoom)+1},G,Q),I):y.value}_calculate(y,I,G,Q){return Q.zoom>Q.zoomHistory.lastIntegerZoom?{from:y,to:I,other:G}:{from:G,to:I,other:y}}interpolate(y){return y}}class un{constructor(y){this.specification=y}possiblyEvaluate(y,I,G,Q){if(y.value!==void 0){if(y.expression.kind==="constant"){const ne=y.expression.evaluate(I,null,{},G,Q);return this._calculate(ne,ne,ne,I)}return this._calculate(y.expression.evaluate(new tt(Math.floor(I.zoom-1),I)),y.expression.evaluate(new tt(Math.floor(I.zoom),I)),y.expression.evaluate(new tt(Math.floor(I.zoom+1),I)),I)}}_calculate(y,I,G,Q){return Q.zoom>Q.zoomHistory.lastIntegerZoom?{from:y,to:I}:{from:G,to:I}}interpolate(y){return y}}class Rt{constructor(y){this.specification=y}possiblyEvaluate(y,I,G,Q){return!!y.expression.evaluate(I,null,{},G,Q)}interpolate(){return!1}}class Xt{constructor(y){this.properties=y,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const I=new tt(0,{});for(const G in y){const Q=y[G];Q.specification.overridable&&this.overridableProperties.push(G);const ne=this.defaultPropertyValues[G]=new nt(Q,void 0),he=this.defaultTransitionablePropertyValues[G]=new Qe(Q);this.defaultTransitioningPropertyValues[G]=he.untransitioned(),this.defaultPossiblyEvaluatedValues[G]=ne.possiblyEvaluate(I)}}}function Qt(U,y){return 256*(U=Mt(Math.floor(U),0,255))+Mt(Math.floor(y),0,255)}Pn(St,"DataDrivenProperty"),Pn(_t,"DataConstantProperty"),Pn(Bt,"CrossFadedDataDrivenProperty"),Pn(un,"CrossFadedProperty"),Pn(Rt,"ColorRampProperty");const gn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jt{constructor(y,I){this._structArray=y,this._pos1=I*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(y,I){return y._trim(),I&&(y.isTransferred=!0,I.push(y.arrayBuffer)),{length:y.length,arrayBuffer:y.arrayBuffer}}static deserialize(y){const I=Object.create(this.prototype);return I.arrayBuffer=y.arrayBuffer,I.length=y.length,I.capacity=y.arrayBuffer.byteLength/I.bytesPerElement,I._refreshViews(),I}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(y){this.reserve(y),this.length=y}reserve(y){if(y>this.capacity){this.capacity=Math.max(y,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const I=this.uint8;this._refreshViews(),I&&this.uint8.set(I)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Jt(U,y=1){let I=0,G=0;return{members:U.map(Q=>{const ne=gn[Q.type].BYTES_PER_ELEMENT,he=I=wn(I,Math.max(y,ne)),ge=Q.components||1;return G=Math.max(G,ne),I+=ne*ge,{name:Q.name,type:Q.type,components:ge,offset:he}}),size:wn(I,Math.max(G,y)),alignment:y}}function wn(U,y){return Math.ceil(U/y)*y}class xn extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(y,I){const G=this.length;return this.resize(G+1),this.emplace(G,y,I)}emplace(y,I,G){const Q=2*y;return this.int16[Q+0]=I,this.int16[Q+1]=G,y}}xn.prototype.bytesPerElement=4,Pn(xn,"StructArrayLayout2i4");class zn extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(y,I,G){const Q=this.length;return this.resize(Q+1),this.emplace(Q,y,I,G)}emplace(y,I,G,Q){const ne=3*y;return this.int16[ne+0]=I,this.int16[ne+1]=G,this.int16[ne+2]=Q,y}}zn.prototype.bytesPerElement=6,Pn(zn,"StructArrayLayout3i6");class $n extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,y,I,G,Q)}emplace(y,I,G,Q,ne){const he=4*y;return this.int16[he+0]=I,this.int16[he+1]=G,this.int16[he+2]=Q,this.int16[he+3]=ne,y}}$n.prototype.bytesPerElement=8,Pn($n,"StructArrayLayout4i8");class Wn extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge){const we=this.length;return this.resize(we+1),this.emplace(we,y,I,G,Q,ne,he,ge)}emplace(y,I,G,Q,ne,he,ge,we){const Ee=6*y,ke=12*y,De=3*y;return this.int16[Ee+0]=I,this.int16[Ee+1]=G,this.uint8[ke+4]=Q,this.uint8[ke+5]=ne,this.uint8[ke+6]=he,this.uint8[ke+7]=ge,this.float32[De+2]=we,y}}Wn.prototype.bytesPerElement=12,Pn(Wn,"StructArrayLayout2i4ub1f12");class fr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,y,I,G,Q)}emplace(y,I,G,Q,ne){const he=4*y;return this.float32[he+0]=I,this.float32[he+1]=G,this.float32[he+2]=Q,this.float32[he+3]=ne,y}}fr.prototype.bytesPerElement=16,Pn(fr,"StructArrayLayout4f16");class Dn extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge,we,Ee,ke){const De=this.length;return this.resize(De+1),this.emplace(De,y,I,G,Q,ne,he,ge,we,Ee,ke)}emplace(y,I,G,Q,ne,he,ge,we,Ee,ke,De){const Oe=10*y;return this.uint16[Oe+0]=I,this.uint16[Oe+1]=G,this.uint16[Oe+2]=Q,this.uint16[Oe+3]=ne,this.uint16[Oe+4]=he,this.uint16[Oe+5]=ge,this.uint16[Oe+6]=we,this.uint16[Oe+7]=Ee,this.uint16[Oe+8]=ke,this.uint16[Oe+9]=De,y}}Dn.prototype.bytesPerElement=20,Pn(Dn,"StructArrayLayout10ui20");class Qn extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge,we){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,y,I,G,Q,ne,he,ge,we)}emplace(y,I,G,Q,ne,he,ge,we,Ee){const ke=8*y;return this.uint16[ke+0]=I,this.uint16[ke+1]=G,this.uint16[ke+2]=Q,this.uint16[ke+3]=ne,this.uint16[ke+4]=he,this.uint16[ke+5]=ge,this.uint16[ke+6]=we,this.uint16[ke+7]=Ee,y}}Qn.prototype.bytesPerElement=16,Pn(Qn,"StructArrayLayout8ui16");class Tr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he){const ge=this.length;return this.resize(ge+1),this.emplace(ge,y,I,G,Q,ne,he)}emplace(y,I,G,Q,ne,he,ge){const we=6*y;return this.int16[we+0]=I,this.int16[we+1]=G,this.int16[we+2]=Q,this.int16[we+3]=ne,this.int16[we+4]=he,this.int16[we+5]=ge,y}}Tr.prototype.bytesPerElement=12,Pn(Tr,"StructArrayLayout6i12");class Gr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe)}emplace(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne){const Ge=12*y;return this.int16[Ge+0]=I,this.int16[Ge+1]=G,this.int16[Ge+2]=Q,this.int16[Ge+3]=ne,this.uint16[Ge+4]=he,this.uint16[Ge+5]=ge,this.uint16[Ge+6]=we,this.uint16[Ge+7]=Ee,this.int16[Ge+8]=ke,this.int16[Ge+9]=De,this.int16[Ge+10]=Oe,this.int16[Ge+11]=Ne,y}}Gr.prototype.bytesPerElement=24,Pn(Gr,"StructArrayLayout4i4ui4i24");class ei extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he){const ge=this.length;return this.resize(ge+1),this.emplace(ge,y,I,G,Q,ne,he)}emplace(y,I,G,Q,ne,he,ge){const we=10*y,Ee=5*y;return this.int16[we+0]=I,this.int16[we+1]=G,this.int16[we+2]=Q,this.float32[Ee+2]=ne,this.float32[Ee+3]=he,this.float32[Ee+4]=ge,y}}ei.prototype.bytesPerElement=20,Pn(ei,"StructArrayLayout3i3f20");class Dr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(y){const I=this.length;return this.resize(I+1),this.emplace(I,y)}emplace(y,I){return this.uint32[1*y+0]=I,y}}Dr.prototype.bytesPerElement=4,Pn(Dr,"StructArrayLayout1ul4");class pi extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne)}emplace(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge){const We=20*y,Je=10*y;return this.int16[We+0]=I,this.int16[We+1]=G,this.int16[We+2]=Q,this.int16[We+3]=ne,this.int16[We+4]=he,this.float32[Je+3]=ge,this.float32[Je+4]=we,this.float32[Je+5]=Ee,this.float32[Je+6]=ke,this.int16[We+14]=De,this.uint32[Je+8]=Oe,this.uint16[We+18]=Ne,this.uint16[We+19]=Ge,y}}pi.prototype.bytesPerElement=40,Pn(pi,"StructArrayLayout5i4f1i1ul2ui40");class to extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge){const we=this.length;return this.resize(we+1),this.emplace(we,y,I,G,Q,ne,he,ge)}emplace(y,I,G,Q,ne,he,ge,we){const Ee=8*y;return this.int16[Ee+0]=I,this.int16[Ee+1]=G,this.int16[Ee+2]=Q,this.int16[Ee+4]=ne,this.int16[Ee+5]=he,this.int16[Ee+6]=ge,this.int16[Ee+7]=we,y}}to.prototype.bytesPerElement=16,Pn(to,"StructArrayLayout3i2i2i16");class fo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne){const he=this.length;return this.resize(he+1),this.emplace(he,y,I,G,Q,ne)}emplace(y,I,G,Q,ne,he){const ge=4*y,we=8*y;return this.float32[ge+0]=I,this.float32[ge+1]=G,this.float32[ge+2]=Q,this.int16[we+6]=ne,this.int16[we+7]=he,y}}fo.prototype.bytesPerElement=16,Pn(fo,"StructArrayLayout2f1f2i16");class qr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,y,I,G,Q)}emplace(y,I,G,Q,ne){const he=12*y,ge=3*y;return this.uint8[he+0]=I,this.uint8[he+1]=G,this.float32[ge+1]=Q,this.float32[ge+2]=ne,y}}qr.prototype.bytesPerElement=12,Pn(qr,"StructArrayLayout2ub2f12");class Hr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I,G){const Q=this.length;return this.resize(Q+1),this.emplace(Q,y,I,G)}emplace(y,I,G,Q){const ne=3*y;return this.float32[ne+0]=I,this.float32[ne+1]=G,this.float32[ne+2]=Q,y}}Hr.prototype.bytesPerElement=12,Pn(Hr,"StructArrayLayout3f12");class cr extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I,G){const Q=this.length;return this.resize(Q+1),this.emplace(Q,y,I,G)}emplace(y,I,G,Q){const ne=3*y;return this.uint16[ne+0]=I,this.uint16[ne+1]=G,this.uint16[ne+2]=Q,y}}cr.prototype.bytesPerElement=6,Pn(cr,"StructArrayLayout3ui6");class ii extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je,st,pt,ct,ht,bt){const mt=this.length;return this.resize(mt+1),this.emplace(mt,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je,st,pt,ct,ht,bt)}emplace(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je,st,pt,ct,ht,bt,mt){const $t=30*y,Ft=15*y,Ht=60*y;return this.int16[$t+0]=I,this.int16[$t+1]=G,this.int16[$t+2]=Q,this.float32[Ft+2]=ne,this.float32[Ft+3]=he,this.uint16[$t+8]=ge,this.uint16[$t+9]=we,this.uint32[Ft+5]=Ee,this.uint32[Ft+6]=ke,this.uint32[Ft+7]=De,this.uint16[$t+16]=Oe,this.uint16[$t+17]=Ne,this.uint16[$t+18]=Ge,this.float32[Ft+10]=We,this.float32[Ft+11]=Je,this.uint8[Ht+48]=st,this.uint8[Ht+49]=pt,this.uint8[Ht+50]=ct,this.uint32[Ft+13]=ht,this.int16[$t+28]=bt,this.uint8[Ht+58]=mt,y}}ii.prototype.bytesPerElement=60,Pn(ii,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class xi extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je,st,pt,ct,ht,bt,mt,$t,Ft,Ht,pn,Nt,Kt,nn,Yt){const hn=this.length;return this.resize(hn+1),this.emplace(hn,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je,st,pt,ct,ht,bt,mt,$t,Ft,Ht,pn,Nt,Kt,nn,Yt)}emplace(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je,st,pt,ct,ht,bt,mt,$t,Ft,Ht,pn,Nt,Kt,nn,Yt,hn){const rn=38*y,En=19*y;return this.int16[rn+0]=I,this.int16[rn+1]=G,this.int16[rn+2]=Q,this.float32[En+2]=ne,this.float32[En+3]=he,this.int16[rn+8]=ge,this.int16[rn+9]=we,this.int16[rn+10]=Ee,this.int16[rn+11]=ke,this.int16[rn+12]=De,this.int16[rn+13]=Oe,this.uint16[rn+14]=Ne,this.uint16[rn+15]=Ge,this.uint16[rn+16]=We,this.uint16[rn+17]=Je,this.uint16[rn+18]=st,this.uint16[rn+19]=pt,this.uint16[rn+20]=ct,this.uint16[rn+21]=ht,this.uint16[rn+22]=bt,this.uint16[rn+23]=mt,this.uint16[rn+24]=$t,this.uint16[rn+25]=Ft,this.uint16[rn+26]=Ht,this.uint16[rn+27]=pn,this.uint16[rn+28]=Nt,this.uint32[En+15]=Kt,this.float32[En+16]=nn,this.float32[En+17]=Yt,this.float32[En+18]=hn,y}}xi.prototype.bytesPerElement=76,Pn(xi,"StructArrayLayout3i2f6i15ui1ul3f76");class Ur extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y){const I=this.length;return this.resize(I+1),this.emplace(I,y)}emplace(y,I){return this.float32[1*y+0]=I,y}}Ur.prototype.bytesPerElement=4,Pn(Ur,"StructArrayLayout1f4");class bi extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I,G,Q,ne){const he=this.length;return this.resize(he+1),this.emplace(he,y,I,G,Q,ne)}emplace(y,I,G,Q,ne,he){const ge=5*y;return this.float32[ge+0]=I,this.float32[ge+1]=G,this.float32[ge+2]=Q,this.float32[ge+3]=ne,this.float32[ge+4]=he,y}}bi.prototype.bytesPerElement=20,Pn(bi,"StructArrayLayout5f20");class Wo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I,G,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,y,I,G,Q)}emplace(y,I,G,Q,ne){const he=6*y;return this.uint32[3*y+0]=I,this.uint16[he+2]=G,this.uint16[he+3]=Q,this.uint16[he+4]=ne,y}}Wo.prototype.bytesPerElement=12,Pn(Wo,"StructArrayLayout1ul3ui12");class Si extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y,I){const G=this.length;return this.resize(G+1),this.emplace(G,y,I)}emplace(y,I,G){const Q=2*y;return this.uint16[Q+0]=I,this.uint16[Q+1]=G,y}}Si.prototype.bytesPerElement=4,Pn(Si,"StructArrayLayout2ui4");class Xo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(y){const I=this.length;return this.resize(I+1),this.emplace(I,y)}emplace(y,I){return this.uint16[1*y+0]=I,y}}Xo.prototype.bytesPerElement=2,Pn(Xo,"StructArrayLayout1ui2");class Ko extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(y,I){const G=this.length;return this.resize(G+1),this.emplace(G,y,I)}emplace(y,I,G){const Q=2*y;return this.float32[Q+0]=I,this.float32[Q+1]=G,y}}Ko.prototype.bytesPerElement=8,Pn(Ko,"StructArrayLayout2f8");class Yo extends jt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Yo.prototype.size=12;class Ci extends Tr{get(y){return new Yo(this,y)}}Pn(Ci,"FillExtrusionExtArray");class Jo extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Jo.prototype.size=40;class zo extends pi{get(y){return new Jo(this,y)}}Pn(zo,"CollisionBoxArray");class pa extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(y){this._structArray.uint8[this._pos1+49]=y}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(y){this._structArray.uint8[this._pos1+50]=y}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(y){this._structArray.uint32[this._pos4+13]=y}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(y){this._structArray.uint8[this._pos1+58]=y}}pa.prototype.size=60;class np extends ii{get(y){return new pa(this,y)}}Pn(np,"PlacedSymbolArray");class rp extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(y){this._structArray.uint32[this._pos4+15]=y}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}rp.prototype.size=76;class ip extends xi{get(y){return new rp(this,y)}}Pn(ip,"SymbolInstanceArray");class op extends Ur{getoffsetX(y){return this.float32[1*y+0]}}Pn(op,"GlyphOffsetArray");class sp extends zn{getx(y){return this.int16[3*y+0]}gety(y){return this.int16[3*y+1]}gettileUnitDistanceFromAnchor(y){return this.int16[3*y+2]}}Pn(sp,"SymbolLineVertexArray");class ap extends jt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ap.prototype.size=12;class lp extends Wo{get(y){return new ap(this,y)}}Pn(lp,"FeatureIndexArray");class cp extends jt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}cp.prototype.size=4;class up extends Si{get(y){return new cp(this,y)}}Pn(up,"FillExtrusionCentroidArray");class hp extends jt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}hp.prototype.size=12;class dp extends Tr{get(y){return new hp(this,y)}}Pn(dp,"CircleGlobeExtArray");const Dm=Jt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Lm=Jt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var pp=Cl(function(U){U.exports=function(y,I){var G,Q,ne,he,ge,we,Ee,ke;for(Q=y.length-(G=3&y.length),ne=I,ge=3432918353,we=461845907,ke=0;ke<Q;)Ee=255&y.charCodeAt(ke)|(255&y.charCodeAt(++ke))<<8|(255&y.charCodeAt(++ke))<<16|(255&y.charCodeAt(++ke))<<24,++ke,ne=27492+(65535&(he=5*(65535&(ne=(ne^=Ee=(65535&(Ee=(Ee=(65535&Ee)*ge+(((Ee>>>16)*ge&65535)<<16)&4294967295)<<15|Ee>>>17))*we+(((Ee>>>16)*we&65535)<<16)&4294967295)<<13|ne>>>19))+((5*(ne>>>16)&65535)<<16)&4294967295))+((58964+(he>>>16)&65535)<<16);switch(Ee=0,G){case 3:Ee^=(255&y.charCodeAt(ke+2))<<16;case 2:Ee^=(255&y.charCodeAt(ke+1))<<8;case 1:ne^=Ee=(65535&(Ee=(Ee=(65535&(Ee^=255&y.charCodeAt(ke)))*ge+(((Ee>>>16)*ge&65535)<<16)&4294967295)<<15|Ee>>>17))*we+(((Ee>>>16)*we&65535)<<16)&4294967295}return ne^=y.length,ne=2246822507*(65535&(ne^=ne>>>16))+((2246822507*(ne>>>16)&65535)<<16)&4294967295,ne=3266489909*(65535&(ne^=ne>>>13))+((3266489909*(ne>>>16)&65535)<<16)&4294967295,(ne^=ne>>>16)>>>0}}),Bm=Cl(function(U){U.exports=function(y,I){for(var G,Q=y.length,ne=I^Q,he=0;Q>=4;)G=1540483477*(65535&(G=255&y.charCodeAt(he)|(255&y.charCodeAt(++he))<<8|(255&y.charCodeAt(++he))<<16|(255&y.charCodeAt(++he))<<24))+((1540483477*(G>>>16)&65535)<<16),ne=1540483477*(65535&ne)+((1540483477*(ne>>>16)&65535)<<16)^(G=1540483477*(65535&(G^=G>>>24))+((1540483477*(G>>>16)&65535)<<16)),Q-=4,++he;switch(Q){case 3:ne^=(255&y.charCodeAt(he+2))<<16;case 2:ne^=(255&y.charCodeAt(he+1))<<8;case 1:ne=1540483477*(65535&(ne^=255&y.charCodeAt(he)))+((1540483477*(ne>>>16)&65535)<<16)}return ne=1540483477*(65535&(ne^=ne>>>13))+((1540483477*(ne>>>16)&65535)<<16),(ne^=ne>>>15)>>>0}}),Ec=pp,Om=Bm;Ec.murmur3=pp,Ec.murmur2=Om;class Gu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(y,I,G,Q){this.ids.push(fp(y)),this.positions.push(I,G,Q)}getPositions(y){const I=fp(y);let G=0,Q=this.ids.length-1;for(;G<Q;){const he=G+Q>>1;this.ids[he]>=I?Q=he:G=he+1}const ne=[];for(;this.ids[G]===I;)ne.push({index:this.positions[3*G],start:this.positions[3*G+1],end:this.positions[3*G+2]}),G++;return ne}static serialize(y,I){const G=new Float64Array(y.ids),Q=new Uint32Array(y.positions);return Kh(G,Q,0,G.length-1),I&&I.push(G.buffer,Q.buffer),{ids:G,positions:Q}}static deserialize(y){const I=new Gu;return I.ids=y.ids,I.positions=y.positions,I.indexed=!0,I}}function fp(U){const y=+U;return!isNaN(y)&&Number.MIN_SAFE_INTEGER<=y&&y<=Number.MAX_SAFE_INTEGER?y:Ec(String(U))}function Kh(U,y,I,G){for(;I<G;){const Q=U[I+G>>1];let ne=I-1,he=G+1;for(;;){do ne++;while(U[ne]<Q);do he--;while(U[he]>Q);if(ne>=he)break;qu(U,ne,he),qu(y,3*ne,3*he),qu(y,3*ne+1,3*he+1),qu(y,3*ne+2,3*he+2)}he-I<G-he?(Kh(U,y,I,he),I=he+1):(Kh(U,y,he+1,G),G=he)}}function qu(U,y,I){const G=U[y];U[y]=U[I],U[I]=G}Pn(Gu,"FeaturePositionMap");class Qo{constructor(y){this.gl=y.gl,this.initialized=!1}fetchUniformLocation(y,I){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(y,I),this.initialized=!0),!!this.location}}class Zu extends Qo{constructor(y){super(y),this.current=0}set(y,I,G){this.fetchUniformLocation(y,I)&&this.current!==G&&(this.current=G,this.gl.uniform1f(this.location,G))}}class mp extends Qo{constructor(y){super(y),this.current=[0,0,0,0]}set(y,I,G){this.fetchUniformLocation(y,I)&&(G[0]===this.current[0]&&G[1]===this.current[1]&&G[2]===this.current[2]&&G[3]===this.current[3]||(this.current=G,this.gl.uniform4f(this.location,G[0],G[1],G[2],G[3])))}}class _p extends Qo{constructor(y){super(y),this.current=zr.transparent}set(y,I,G){this.fetchUniformLocation(y,I)&&(G.r===this.current.r&&G.g===this.current.g&&G.b===this.current.b&&G.a===this.current.a||(this.current=G,this.gl.uniform4f(this.location,G.r,G.g,G.b,G.a)))}}const Fm=new Float32Array(16),Um=new Float32Array(9),$m=new Float32Array(4);function Yh(U){return[Qt(255*U.r,255*U.g),Qt(255*U.b,255*U.a)]}class Ac{constructor(y,I,G){this.value=y,this.uniformNames=I.map(Q=>`u_${Q}`),this.type=G}setUniform(y,I,G,Q,ne){I.set(y,ne,Q.constantOr(this.value))}getBinding(y,I){return this.type==="color"?new _p(y):new Zu(y)}}class ll{constructor(y,I){this.uniformNames=I.map(G=>`u_${G}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(y,I){this.pixelRatioFrom=I.pixelRatio||1,this.pixelRatioTo=y.pixelRatio||1,this.patternFrom=I.tl.concat(I.br),this.patternTo=y.tl.concat(y.br)}setUniform(y,I,G,Q,ne){const he=ne==="u_pattern_to"||ne==="u_dash_to"?this.patternTo:ne==="u_pattern_from"||ne==="u_dash_from"?this.patternFrom:ne==="u_pixel_ratio_to"?this.pixelRatioTo:ne==="u_pixel_ratio_from"?this.pixelRatioFrom:null;he&&I.set(y,ne,he)}getBinding(y,I){return I==="u_pattern_from"||I==="u_pattern_to"||I==="u_dash_from"||I==="u_dash_to"?new mp(y):new Zu(y)}}class es{constructor(y,I,G,Q){this.expression=y,this.type=G,this.maxValue=0,this.paintVertexAttributes=I.map(ne=>({name:`a_${ne}`,type:"Float32",components:G==="color"?2:1,offset:0})),this.paintVertexArray=new Q}populatePaintArray(y,I,G,Q,ne,he){const ge=this.paintVertexArray.length,we=this.expression.evaluate(new tt(0),I,{},ne,Q,he);this.paintVertexArray.resize(y),this._setPaintValue(ge,y,we)}updatePaintArray(y,I,G,Q,ne){const he=this.expression.evaluate({zoom:0},G,Q,void 0,ne);this._setPaintValue(y,I,he)}_setPaintValue(y,I,G){if(this.type==="color"){const Q=Yh(G);for(let ne=y;ne<I;ne++)this.paintVertexArray.emplace(ne,Q[0],Q[1])}else{for(let Q=y;Q<I;Q++)this.paintVertexArray.emplace(Q,G);this.maxValue=Math.max(this.maxValue,Math.abs(G))}}upload(y){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=y.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mo{constructor(y,I,G,Q,ne,he){this.expression=y,this.uniformNames=I.map(ge=>`u_${ge}_t`),this.type=G,this.useIntegerZoom=Q,this.zoom=ne,this.maxValue=0,this.paintVertexAttributes=I.map(ge=>({name:`a_${ge}`,type:"Float32",components:G==="color"?4:2,offset:0})),this.paintVertexArray=new he}populatePaintArray(y,I,G,Q,ne,he){const ge=this.expression.evaluate(new tt(this.zoom),I,{},ne,Q,he),we=this.expression.evaluate(new tt(this.zoom+1),I,{},ne,Q,he),Ee=this.paintVertexArray.length;this.paintVertexArray.resize(y),this._setPaintValue(Ee,y,ge,we)}updatePaintArray(y,I,G,Q,ne){const he=this.expression.evaluate({zoom:this.zoom},G,Q,void 0,ne),ge=this.expression.evaluate({zoom:this.zoom+1},G,Q,void 0,ne);this._setPaintValue(y,I,he,ge)}_setPaintValue(y,I,G,Q){if(this.type==="color"){const ne=Yh(G),he=Yh(Q);for(let ge=y;ge<I;ge++)this.paintVertexArray.emplace(ge,ne[0],ne[1],he[0],he[1])}else{for(let ne=y;ne<I;ne++)this.paintVertexArray.emplace(ne,G,Q);this.maxValue=Math.max(this.maxValue,Math.abs(G),Math.abs(Q))}}upload(y){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=y.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(y,I,G,Q,ne){const he=this.useIntegerZoom?Math.floor(G.zoom):G.zoom,ge=Mt(this.expression.interpolationFactor(he,this.zoom,this.zoom+1),0,1);I.set(y,ne,ge)}getBinding(y,I){return new Zu(y)}}class Ss{constructor(y,I,G,Q,ne,he,ge){this.expression=y,this.type=G,this.useIntegerZoom=Q,this.zoom=ne,this.layerId=ge,this.paintVertexAttributes=(G==="array"?Lm:Dm).members;for(let we=0;we<I.length;++we);this.zoomInPaintVertexArray=new he,this.zoomOutPaintVertexArray=new he}populatePaintArray(y,I,G){const Q=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(y),this.zoomOutPaintVertexArray.resize(y),this._setPaintValues(Q,y,I.patterns&&I.patterns[this.layerId],G)}updatePaintArray(y,I,G,Q,ne,he){this._setPaintValues(y,I,G.patterns&&G.patterns[this.layerId],he)}_setPaintValues(y,I,G,Q){if(!Q||!G)return;const{min:ne,mid:he,max:ge}=G,we=Q[ne],Ee=Q[he],ke=Q[ge];if(we&&Ee&&ke)for(let De=y;De<I;De++)this._setPaintValue(this.zoomInPaintVertexArray,De,Ee,we),this._setPaintValue(this.zoomOutPaintVertexArray,De,Ee,ke)}_setPaintValue(y,I,G,Q){y.emplace(I,G.tl[0],G.tl[1],G.br[0],G.br[1],Q.tl[0],Q.tl[1],Q.br[0],Q.br[1],G.pixelRatio,Q.pixelRatio)}upload(y){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=y.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=y.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Cs{constructor(y,I,G=()=>!0){this.binders={},this._buffers=[];const Q=[];for(const ne in y.paint._values){if(!G(ne))continue;const he=y.paint.get(ne);if(!(he instanceof dt&&gs(he.property.specification)))continue;const ge=jm(ne,y.type),we=he.value,Ee=he.property.specification.type,ke=he.property.useIntegerZoom,De=he.property.specification["property-type"],Oe=De==="cross-faded"||De==="cross-faded-data-driven",Ne=String(ne)==="line-dasharray"&&y.layout.get("line-cap").value.kind!=="constant";if(we.kind!=="constant"||Ne)if(we.kind==="source"||Ne||Oe){const Ge=gp(ne,Ee,"source");this.binders[ne]=Oe?new Ss(we,ge,Ee,ke,I,Ge,y.id):new es(we,ge,Ee,Ge),Q.push(`/a_${ne}`)}else{const Ge=gp(ne,Ee,"composite");this.binders[ne]=new mo(we,ge,Ee,ke,I,Ge),Q.push(`/z_${ne}`)}else this.binders[ne]=Oe?new ll(we.value,ge):new Ac(we.value,ge,Ee),Q.push(`/u_${ne}`)}this.cacheKey=Q.sort().join("")}getMaxValue(y){const I=this.binders[y];return I instanceof es||I instanceof mo?I.maxValue:0}populatePaintArrays(y,I,G,Q,ne,he){for(const ge in this.binders){const we=this.binders[ge];(we instanceof es||we instanceof mo||we instanceof Ss)&&we.populatePaintArray(y,I,G,Q,ne,he)}}setConstantPatternPositions(y,I){for(const G in this.binders){const Q=this.binders[G];Q instanceof ll&&Q.setConstantPatternPositions(y,I)}}updatePaintArrays(y,I,G,Q,ne,he){let ge=!1;for(const we in y){const Ee=I.getPositions(we);for(const ke of Ee){const De=G.feature(ke.index);for(const Oe in this.binders){const Ne=this.binders[Oe];if((Ne instanceof es||Ne instanceof mo||Ne instanceof Ss)&&Ne.expression.isStateDependent===!0){const Ge=Q.paint.get(Oe);Ne.expression=Ge.value,Ne.updatePaintArray(ke.start,ke.end,De,y[we],ne,he),ge=!0}}}}return ge}defines(){const y=[];for(const I in this.binders){const G=this.binders[I];(G instanceof Ac||G instanceof ll)&&y.push(...G.uniformNames.map(Q=>`#define HAS_UNIFORM_${Q}`))}return y}getBinderAttributes(){const y=[];for(const I in this.binders){const G=this.binders[I];if(G instanceof es||G instanceof mo||G instanceof Ss)for(let Q=0;Q<G.paintVertexAttributes.length;Q++)y.push(G.paintVertexAttributes[Q].name)}return y}getBinderUniforms(){const y=[];for(const I in this.binders){const G=this.binders[I];if(G instanceof Ac||G instanceof ll||G instanceof mo)for(const Q of G.uniformNames)y.push(Q)}return y}getPaintVertexBuffers(){return this._buffers}getUniforms(y){const I=[];for(const G in this.binders){const Q=this.binders[G];if(Q instanceof Ac||Q instanceof ll||Q instanceof mo)for(const ne of Q.uniformNames)I.push({name:ne,property:G,binding:Q.getBinding(y,ne)})}return I}setUniforms(y,I,G,Q,ne){for(const{name:he,property:ge,binding:we}of G)this.binders[ge].setUniform(y,we,ne,Q.get(ge),he)}updatePaintBuffers(y){this._buffers=[];for(const I in this.binders){const G=this.binders[I];if(y&&G instanceof Ss){const Q=y.fromScale===2?G.zoomInPaintVertexBuffer:G.zoomOutPaintVertexBuffer;Q&&this._buffers.push(Q)}else(G instanceof es||G instanceof mo)&&G.paintVertexBuffer&&this._buffers.push(G.paintVertexBuffer)}}upload(y){for(const I in this.binders){const G=this.binders[I];(G instanceof es||G instanceof mo||G instanceof Ss)&&G.upload(y)}this.updatePaintBuffers()}destroy(){for(const y in this.binders){const I=this.binders[y];(I instanceof es||I instanceof mo||I instanceof Ss)&&I.destroy()}}}class fa{constructor(y,I,G=()=>!0){this.programConfigurations={};for(const Q of y)this.programConfigurations[Q.id]=new Cs(Q,I,G);this.needsUpload=!1,this._featureMap=new Gu,this._bufferOffset=0}populatePaintArrays(y,I,G,Q,ne,he,ge){for(const we in this.programConfigurations)this.programConfigurations[we].populatePaintArrays(y,I,Q,ne,he,ge);I.id!==void 0&&this._featureMap.add(I.id,G,this._bufferOffset,y),this._bufferOffset=y,this.needsUpload=!0}updatePaintArrays(y,I,G,Q,ne){for(const he of G)this.needsUpload=this.programConfigurations[he.id].updatePaintArrays(y,this._featureMap,I,he,Q,ne)||this.needsUpload}get(y){return this.programConfigurations[y]}upload(y){if(this.needsUpload){for(const I in this.programConfigurations)this.programConfigurations[I].upload(y);this.needsUpload=!1}}destroy(){for(const y in this.programConfigurations)this.programConfigurations[y].destroy()}}const Nm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jm(U,y){return Nm[U]||[U.replace(`${y}-`,"").replace(/-/g,"_")]}const Vm={"line-pattern":{source:Dn,composite:Dn},"fill-pattern":{source:Dn,composite:Dn},"fill-extrusion-pattern":{source:Dn,composite:Dn},"line-dasharray":{source:Qn,composite:Qn}},Gm={color:{source:Ko,composite:fr},number:{source:Ur,composite:Ko}};function gp(U,y,I){const G=Vm[U];return G&&G[I]||Gm[y][I]}Pn(Ac,"ConstantBinder"),Pn(ll,"CrossFadedConstantBinder"),Pn(es,"SourceExpressionBinder"),Pn(Ss,"CrossFadedCompositeBinder"),Pn(mo,"CompositeExpressionBinder"),Pn(Cs,"ProgramConfiguration",{omit:["_buffers"]}),Pn(fa,"ProgramConfigurationSet");const Hu="-transition";class _o extends jn{constructor(y,I){if(super(),this.id=y.id,this.type=y.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,y.type!=="custom"&&(this.metadata=(y=y).metadata,this.minzoom=y.minzoom,this.maxzoom=y.maxzoom,y.type!=="background"&&y.type!=="sky"&&(this.source=y.source,this.sourceLayer=y["source-layer"],this.filter=y.filter),I.layout&&(this._unevaluatedLayout=new gt(I.layout)),I.paint)){this._transitionablePaint=new lt(I.paint);for(const G in y.paint)this.setPaintProperty(G,y.paint[G],{validate:!1});for(const G in y.layout)this.setLayoutProperty(G,y.layout[G],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vt(I.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(y){return y==="visibility"?this.visibility:this._unevaluatedLayout.getValue(y)}setLayoutProperty(y,I,G={}){I!=null&&this._validate(Iu,`layers.${this.id}.layout.${y}`,y,I,G)||(y!=="visibility"?this._unevaluatedLayout.setValue(y,I):this.visibility=I)}getPaintProperty(y){return Ln(y,Hu)?this._transitionablePaint.getTransition(y.slice(0,-Hu.length)):this._transitionablePaint.getValue(y)}setPaintProperty(y,I,G={}){if(I!=null&&this._validate(nl,`layers.${this.id}.paint.${y}`,y,I,G))return!1;if(Ln(y,Hu))return this._transitionablePaint.setTransition(y.slice(0,-Hu.length),I||void 0),!1;{const Q=this._transitionablePaint._values[y],ne=Q.property.specification["property-type"]==="cross-faded-data-driven",he=Q.value.isDataDriven(),ge=Q.value;this._transitionablePaint.setValue(y,I),this._handleSpecialPaintPropertyUpdate(y);const we=this._transitionablePaint._values[y].value;return we.isDataDriven()||he||ne||this._handleOverridablePaintPropertyUpdate(y,ge,we)}}_handleSpecialPaintPropertyUpdate(y){}getProgramIds(){return null}getProgramConfiguration(y){return null}_handleOverridablePaintPropertyUpdate(y,I,G){return!1}isHidden(y){return!!(this.minzoom&&y<this.minzoom)||!!(this.maxzoom&&y>=this.maxzoom)||this.visibility==="none"}updateTransitions(y){this._transitioningPaint=this._transitionablePaint.transitioned(y,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(y,I){y.getCrossfadeParameters&&(this._crossfadeParameters=y.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(y,void 0,I)),this.paint=this._transitioningPaint.possiblyEvaluate(y,void 0,I)}serialize(){const y={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(y.layout=y.layout||{},y.layout.visibility=this.visibility),Xn(y,(I,G)=>!(I===void 0||G==="layout"&&!Object.keys(I).length||G==="paint"&&!Object.keys(I).length))}_validate(y,I,G,Q,ne={}){return(!ne||ne.validate!==!1)&&fc(this,y.call(tl,{key:I,layerType:this.type,objectKey:G,value:Q,styleSpec:Zt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const y in this.paint._values){const I=this.paint.get(y);if(I instanceof dt&&gs(I.property.specification)&&(I.value.kind==="source"||I.value.kind==="composite")&&I.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=oa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const qm=Jt([{name:"a_pos",components:2,type:"Int16"}],4),Zm=Jt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ai{constructor(y=[]){this.segments=y}prepareSegment(y,I,G,Q){let ne=this.segments[this.segments.length-1];return y>ai.MAX_VERTEX_ARRAY_LENGTH&&er(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${y}`),(!ne||ne.vertexLength+y>ai.MAX_VERTEX_ARRAY_LENGTH||ne.sortKey!==Q)&&(ne={vertexOffset:I.length,primitiveOffset:G.length,vertexLength:0,primitiveLength:0},Q!==void 0&&(ne.sortKey=Q),this.segments.push(ne)),ne}get(){return this.segments}destroy(){for(const y of this.segments)for(const I in y.vaos)y.vaos[I].destroy()}static simpleSegment(y,I,G,Q){return new ai([{vertexOffset:y,primitiveOffset:I,vertexLength:G,primitiveLength:Q,vaos:{},sortKey:0}])}}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pn(ai,"SegmentVector");var Hn=8192;class Is{constructor(y,I){y&&(I?this.setSouthWest(y).setNorthEast(I):y.length===4?this.setSouthWest([y[0],y[1]]).setNorthEast([y[2],y[3]]):this.setSouthWest(y[0]).setNorthEast(y[1]))}setNorthEast(y){return this._ne=y instanceof Mr?new Mr(y.lng,y.lat):Mr.convert(y),this}setSouthWest(y){return this._sw=y instanceof Mr?new Mr(y.lng,y.lat):Mr.convert(y),this}extend(y){const I=this._sw,G=this._ne;let Q,ne;if(y instanceof Mr)Q=y,ne=y;else{if(!(y instanceof Is))return Array.isArray(y)?y.length===4||y.every(Array.isArray)?this.extend(Is.convert(y)):this.extend(Mr.convert(y)):this;if(Q=y._sw,ne=y._ne,!Q||!ne)return this}return I||G?(I.lng=Math.min(Q.lng,I.lng),I.lat=Math.min(Q.lat,I.lat),G.lng=Math.max(ne.lng,G.lng),G.lat=Math.max(ne.lat,G.lat)):(this._sw=new Mr(Q.lng,Q.lat),this._ne=new Mr(ne.lng,ne.lat)),this}getCenter(){return new Mr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Mr(this.getWest(),this.getNorth())}getSouthEast(){return new Mr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(y){const{lng:I,lat:G}=Mr.convert(y);let Q=this._sw.lng<=I&&I<=this._ne.lng;return this._sw.lng>this._ne.lng&&(Q=this._sw.lng>=I&&I>=this._ne.lng),this._sw.lat<=G&&G<=this._ne.lat&&Q}static convert(y){return!y||y instanceof Is?y:new Is(y)}}const Jh=63710088e-1;class Mr{constructor(y,I){if(isNaN(y)||isNaN(I))throw new Error(`Invalid LngLat object: (${y}, ${I})`);if(this.lng=+y,this.lat=+I,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mr(At(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(y){const I=Math.PI/180,G=this.lat*I,Q=y.lat*I,ne=Math.sin(G)*Math.sin(Q)+Math.cos(G)*Math.cos(Q)*Math.cos((y.lng-this.lng)*I);return Jh*Math.acos(Math.min(ne,1))}toBounds(y=0){const I=360*y/40075017,G=I/Math.cos(Math.PI/180*this.lat);return new Is(new Mr(this.lng-G,this.lat-I),new Mr(this.lng+G,this.lat+I))}static convert(y){if(y instanceof Mr)return y;if(Array.isArray(y)&&(y.length===2||y.length===3))return new Mr(Number(y[0]),Number(y[1]));if(!Array.isArray(y)&&typeof y=="object"&&y!==null)return new Mr(Number("lng"in y?y.lng:y.lon),Number(y.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const yp=2*Math.PI*Jh;function Qh(U){return yp*Math.cos(U*Math.PI/180)}function Do(U){return(180+U)/360}function ts(U){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+U*Math.PI/360)))/360}function oo(U,y){return U/Qh(y)}function so(U){return 360*U-180}function wi(U){return 360/Math.PI*Math.atan(Math.exp((180-360*U)*Math.PI/180))-90}function vp(U,y){return U*Qh(wi(y))}const Lo=85.051129;function xp(U){return 1/Math.cos(U*Math.PI/180)}class cl{constructor(y,I,G=0){this.x=+y,this.y=+I,this.z=+G}static fromLngLat(y,I=0){const G=Mr.convert(y);return new cl(Do(G.lng),ts(G.lat),oo(I,G.lat))}toLngLat(){return new Mr(so(this.x),wi(this.y))}toAltitude(){return vp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/yp*xp(wi(this.y))}}function ed(U,y,I,G,Q,ne,he,ge,we){const Ee=(y+G)/2,ke=(I+Q)/2,De=new ze(Ee,ke);ge(De),function(Oe,Ne,Ge,We,Je,st){const pt=Ge-Je,ct=We-st;return Math.abs((We-Ne)*pt-(Ge-Oe)*ct)/Math.hypot(pt,ct)}(De.x,De.y,ne.x,ne.y,he.x,he.y)>=we?(ed(U,y,I,Ee,ke,ne,De,ge,we),ed(U,Ee,ke,G,Q,De,he,ge,we)):U.push(he)}function bp(U,y,I){let G=U[0],Q=G.x,ne=G.y;y(G);const he=[G];for(let ge=1;ge<U.length;ge++){const we=U[ge],{x:Ee,y:ke}=we;y(we),ed(he,Q,ne,Ee,ke,G,we,y,I),Q=Ee,ne=ke,G=we}return he}function td(U,y,I,G,Q){if(Q(y,I)){const ne=y.add(I).mult(.5);G(ne),td(U,y,ne,G,Q),td(U,ne,I,G,Q)}else U.push(I)}function Hm(U,y,I){let G=U[0];y(G);const Q=[G];for(let ne=1;ne<U.length;ne++){const he=U[ne];y(he),td(Q,G,he,y,I),G=he}return Q}const nd=Math.pow(2,14)-1,wp=-nd-1;function Wm(U,y){const I=Math.round(U.x*y),G=Math.round(U.y*y);return U.x=Mt(I,wp,nd),U.y=Mt(G,wp,nd),(I<U.x||I>U.x+1||G<U.y||G>U.y+1)&&er("Geometry exceeds allowed extent, reduce your vector tile buffer size"),U}function ns(U,y,I){const G=U.loadGeometry(),Q=U.extent,ne=Hn/Q;if(y&&I&&I.projection.isReprojectedInTileSpace){const he=1<<y.z,{scale:ge,x:we,y:Ee,projection:ke}=I,De=Oe=>{const Ne=so((y.x+Oe.x/Q)/he),Ge=wi((y.y+Oe.y/Q)/he),We=ke.project(Ne,Ge);Oe.x=(We.x*ge-we)*Q,Oe.y=(We.y*ge-Ee)*Q};for(let Oe=0;Oe<G.length;Oe++)if(U.type!==1)G[Oe]=bp(G[Oe],De,1);else{const Ne=[];for(const Ge of G[Oe])Ge.x<0||Ge.x>=Q||Ge.y<0||Ge.y>=Q||(De(Ge),Ne.push(Ge));G[Oe]=Ne}}for(const he of G)for(const ge of he)Wm(ge,ne);return G}function ma(U,y){return{type:U.type,id:U.id,properties:U.properties,geometry:y?ns(U):[]}}function Wu(U,y,I,G,Q){U.emplaceBack(2*y+(G+1)/2,2*I+(Q+1)/2)}function Xu(U,y,I){U.emplaceBack(y.x,y.y,y.z,I[0]*16384,I[1]*16384,I[2]*16384)}class rd{constructor(y){this.zoom=y.zoom,this.overscaling=y.overscaling,this.layers=y.layers,this.layerIds=this.layers.map(I=>I.id),this.index=y.index,this.hasPattern=!1,this.projection=y.projection,this.layoutVertexArray=new xn,this.indexArray=new cr,this.segments=new ai,this.programConfigurations=new fa(y.layers,y.zoom),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id)}populate(y,I,G,Q){const ne=this.layers[0],he=[];let ge=null;ne.type==="circle"&&(ge=ne.layout.get("circle-sort-key"));for(const{feature:Ee,id:ke,index:De,sourceLayerIndex:Oe}of y){const Ne=this.layers[0]._featureFilter.needGeometry,Ge=ma(Ee,Ne);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom),Ge,G))continue;const We=ge?ge.evaluate(Ge,{},G):void 0,Je={id:ke,properties:Ee.properties,type:Ee.type,sourceLayerIndex:Oe,index:De,geometry:Ne?Ge.geometry:ns(Ee,G,Q),patterns:{},sortKey:We};he.push(Je)}ge&&he.sort((Ee,ke)=>Ee.sortKey-ke.sortKey);let we=null;Q.projection.name==="globe"&&(this.globeExtVertexArray=new dp,we=Q.projection);for(const Ee of he){const{geometry:ke,index:De,sourceLayerIndex:Oe}=Ee,Ne=y[De].feature;this.addFeature(Ee,ke,De,I.availableImages,G,we),I.featureIndex.insert(Ne,ke,De,Oe,this.index)}}update(y,I,G,Q){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(y,I,this.stateDependentLayers,G,Q)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(y){this.uploaded||(this.layoutVertexBuffer=y.createVertexBuffer(this.layoutVertexArray,qm.members),this.indexBuffer=y.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=y.createVertexBuffer(this.globeExtVertexArray,Zm.members))),this.programConfigurations.upload(y),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(y,I,G,Q,ne,he){for(const ge of I)for(const we of ge){const Ee=we.x,ke=we.y;if(Ee<0||Ee>=Hn||ke<0||ke>=Hn)continue;if(he){const Ne=he.projectTilePoint(Ee,ke,ne),Ge=he.upVector(ne,Ee,ke),We=this.globeExtVertexArray;Xu(We,Ne,Ge),Xu(We,Ne,Ge),Xu(We,Ne,Ge),Xu(We,Ne,Ge)}const De=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,y.sortKey),Oe=De.vertexLength;Wu(this.layoutVertexArray,Ee,ke,-1,-1),Wu(this.layoutVertexArray,Ee,ke,1,-1),Wu(this.layoutVertexArray,Ee,ke,1,1),Wu(this.layoutVertexArray,Ee,ke,-1,1),this.indexArray.emplaceBack(Oe,Oe+1,Oe+2),this.indexArray.emplaceBack(Oe,Oe+2,Oe+3),De.vertexLength+=4,De.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,y,G,{},Q,ne)}}function Tp(U,y){for(let I=0;I<U.length;I++)if(_a(y,U[I]))return!0;for(let I=0;I<y.length;I++)if(_a(U,y[I]))return!0;return!!id(U,y)}function Xm(U,y,I){return!!_a(U,y)||!!od(y,U,I)}function Ep(U,y){if(U.length===1)return Sp(y,U[0]);for(let I=0;I<y.length;I++){const G=y[I];for(let Q=0;Q<G.length;Q++)if(_a(U,G[Q]))return!0}for(let I=0;I<U.length;I++)if(Sp(y,U[I]))return!0;for(let I=0;I<y.length;I++)if(id(U,y[I]))return!0;return!1}function Km(U,y,I){if(U.length>1){if(id(U,y))return!0;for(let G=0;G<y.length;G++)if(od(y[G],U,I))return!0}for(let G=0;G<U.length;G++)if(od(U[G],y,I))return!0;return!1}function id(U,y){if(U.length===0||y.length===0)return!1;for(let I=0;I<U.length-1;I++){const G=U[I],Q=U[I+1];for(let ne=0;ne<y.length-1;ne++)if(Ym(G,Q,y[ne],y[ne+1]))return!0}return!1}function Ym(U,y,I,G){return rr(U,I,G)!==rr(y,I,G)&&rr(U,y,I)!==rr(U,y,G)}function od(U,y,I){const G=I*I;if(y.length===1)return U.distSqr(y[0])<G;for(let Q=1;Q<y.length;Q++)if(Ap(U,y[Q-1],y[Q])<G)return!0;return!1}function Ap(U,y,I){const G=y.distSqr(I);if(G===0)return U.distSqr(y);const Q=((U.x-y.x)*(I.x-y.x)+(U.y-y.y)*(I.y-y.y))/G;return U.distSqr(Q<0?y:Q>1?I:I.sub(y)._mult(Q)._add(y))}function Sp(U,y){let I,G,Q,ne=!1;for(let he=0;he<U.length;he++){I=U[he];for(let ge=0,we=I.length-1;ge<I.length;we=ge++)G=I[ge],Q=I[we],G.y>y.y!=Q.y>y.y&&y.x<(Q.x-G.x)*(y.y-G.y)/(Q.y-G.y)+G.x&&(ne=!ne)}return ne}function _a(U,y){let I=!1;for(let G=0,Q=U.length-1;G<U.length;Q=G++){const ne=U[G],he=U[Q];ne.y>y.y!=he.y>y.y&&y.x<(he.x-ne.x)*(y.y-ne.y)/(he.y-ne.y)+ne.x&&(I=!I)}return I}function Cp(U,y,I,G,Q){for(const he of U)if(y<=he.x&&I<=he.y&&G>=he.x&&Q>=he.y)return!0;const ne=[new ze(y,I),new ze(y,Q),new ze(G,Q),new ze(G,I)];if(U.length>2){for(const he of ne)if(_a(U,he))return!0}for(let he=0;he<U.length-1;he++)if(Jm(U[he],U[he+1],ne))return!0;return!1}function Jm(U,y,I){const G=I[0],Q=I[2];if(U.x<G.x&&y.x<G.x||U.x>Q.x&&y.x>Q.x||U.y<G.y&&y.y<G.y||U.y>Q.y&&y.y>Q.y)return!1;const ne=rr(U,y,I[0]);return ne!==rr(U,y,I[1])||ne!==rr(U,y,I[2])||ne!==rr(U,y,I[3])}function ul(U,y,I){const G=y.paint.get(U).value;return G.kind==="constant"?G.value:I.programConfigurations.get(y.id).getMaxValue(U)}function Ku(U){return Math.sqrt(U[0]*U[0]+U[1]*U[1])}function Ip(U,y,I,G,Q){if(!y[0]&&!y[1])return U;const ne=ze.convert(y)._mult(Q);I==="viewport"&&ne._rotate(-G);const he=[];for(let ge=0;ge<U.length;ge++)he.push(U[ge].sub(ne));return he}function Mp(U,y,I,G){const Q=ze.convert(U)._mult(G);return y==="viewport"&&Q._rotate(-I),Q}Pn(rd,"CircleBucket",{omit:["layers"]});const Qm=new Xt({"circle-sort-key":new St(Zt.layout_circle["circle-sort-key"])});var e_={paint:new Xt({"circle-radius":new St(Zt.paint_circle["circle-radius"]),"circle-color":new St(Zt.paint_circle["circle-color"]),"circle-blur":new St(Zt.paint_circle["circle-blur"]),"circle-opacity":new St(Zt.paint_circle["circle-opacity"]),"circle-translate":new _t(Zt.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(Zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(Zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(Zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Zt.paint_circle["circle-stroke-opacity"])}),layout:Qm},Yu=1e-6,qi=typeof Float32Array!="undefined"?Float32Array:Array;function Pp(){var U=new qi(9);return qi!=Float32Array&&(U[1]=0,U[2]=0,U[3]=0,U[5]=0,U[6]=0,U[7]=0),U[0]=1,U[4]=1,U[8]=1,U}function Bo(U){return U[0]=1,U[1]=0,U[2]=0,U[3]=0,U[4]=0,U[5]=1,U[6]=0,U[7]=0,U[8]=0,U[9]=0,U[10]=1,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,U}function sd(U,y){var I=y[0],G=y[1],Q=y[2],ne=y[3],he=y[4],ge=y[5],we=y[6],Ee=y[7],ke=y[8],De=y[9],Oe=y[10],Ne=y[11],Ge=y[12],We=y[13],Je=y[14],st=y[15],pt=I*ge-G*he,ct=I*we-Q*he,ht=I*Ee-ne*he,bt=G*we-Q*ge,mt=G*Ee-ne*ge,$t=Q*Ee-ne*we,Ft=ke*We-De*Ge,Ht=ke*Je-Oe*Ge,pn=ke*st-Ne*Ge,Nt=De*Je-Oe*We,Kt=De*st-Ne*We,nn=Oe*st-Ne*Je,Yt=pt*nn-ct*Kt+ht*Nt+bt*pn-mt*Ht+$t*Ft;return Yt?(U[0]=(ge*nn-we*Kt+Ee*Nt)*(Yt=1/Yt),U[1]=(Q*Kt-G*nn-ne*Nt)*Yt,U[2]=(We*$t-Je*mt+st*bt)*Yt,U[3]=(Oe*mt-De*$t-Ne*bt)*Yt,U[4]=(we*pn-he*nn-Ee*Ht)*Yt,U[5]=(I*nn-Q*pn+ne*Ht)*Yt,U[6]=(Je*ht-Ge*$t-st*ct)*Yt,U[7]=(ke*$t-Oe*ht+Ne*ct)*Yt,U[8]=(he*Kt-ge*pn+Ee*Ft)*Yt,U[9]=(G*pn-I*Kt-ne*Ft)*Yt,U[10]=(Ge*mt-We*ht+st*pt)*Yt,U[11]=(De*ht-ke*mt-Ne*pt)*Yt,U[12]=(ge*Ht-he*Nt-we*Ft)*Yt,U[13]=(I*Nt-G*Ht+Q*Ft)*Yt,U[14]=(We*ct-Ge*bt-Je*pt)*Yt,U[15]=(ke*bt-De*ct+Oe*pt)*Yt,U):null}function hl(U,y,I){var G=y[0],Q=y[1],ne=y[2],he=y[3],ge=y[4],we=y[5],Ee=y[6],ke=y[7],De=y[8],Oe=y[9],Ne=y[10],Ge=y[11],We=y[12],Je=y[13],st=y[14],pt=y[15],ct=I[0],ht=I[1],bt=I[2],mt=I[3];return U[0]=ct*G+ht*ge+bt*De+mt*We,U[1]=ct*Q+ht*we+bt*Oe+mt*Je,U[2]=ct*ne+ht*Ee+bt*Ne+mt*st,U[3]=ct*he+ht*ke+bt*Ge+mt*pt,U[4]=(ct=I[4])*G+(ht=I[5])*ge+(bt=I[6])*De+(mt=I[7])*We,U[5]=ct*Q+ht*we+bt*Oe+mt*Je,U[6]=ct*ne+ht*Ee+bt*Ne+mt*st,U[7]=ct*he+ht*ke+bt*Ge+mt*pt,U[8]=(ct=I[8])*G+(ht=I[9])*ge+(bt=I[10])*De+(mt=I[11])*We,U[9]=ct*Q+ht*we+bt*Oe+mt*Je,U[10]=ct*ne+ht*Ee+bt*Ne+mt*st,U[11]=ct*he+ht*ke+bt*Ge+mt*pt,U[12]=(ct=I[12])*G+(ht=I[13])*ge+(bt=I[14])*De+(mt=I[15])*We,U[13]=ct*Q+ht*we+bt*Oe+mt*Je,U[14]=ct*ne+ht*Ee+bt*Ne+mt*st,U[15]=ct*he+ht*ke+bt*Ge+mt*pt,U}function Sc(U,y,I){var G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We=I[0],Je=I[1],st=I[2];return y===U?(U[12]=y[0]*We+y[4]*Je+y[8]*st+y[12],U[13]=y[1]*We+y[5]*Je+y[9]*st+y[13],U[14]=y[2]*We+y[6]*Je+y[10]*st+y[14],U[15]=y[3]*We+y[7]*Je+y[11]*st+y[15]):(Q=y[1],ne=y[2],he=y[3],ge=y[4],we=y[5],Ee=y[6],ke=y[7],De=y[8],Oe=y[9],Ne=y[10],Ge=y[11],U[0]=G=y[0],U[1]=Q,U[2]=ne,U[3]=he,U[4]=ge,U[5]=we,U[6]=Ee,U[7]=ke,U[8]=De,U[9]=Oe,U[10]=Ne,U[11]=Ge,U[12]=G*We+ge*Je+De*st+y[12],U[13]=Q*We+we*Je+Oe*st+y[13],U[14]=ne*We+Ee*Je+Ne*st+y[14],U[15]=he*We+ke*Je+Ge*st+y[15]),U}function ga(U,y,I){var G=I[0],Q=I[1],ne=I[2];return U[0]=y[0]*G,U[1]=y[1]*G,U[2]=y[2]*G,U[3]=y[3]*G,U[4]=y[4]*Q,U[5]=y[5]*Q,U[6]=y[6]*Q,U[7]=y[7]*Q,U[8]=y[8]*ne,U[9]=y[9]*ne,U[10]=y[10]*ne,U[11]=y[11]*ne,U[12]=y[12],U[13]=y[13],U[14]=y[14],U[15]=y[15],U}function ad(U,y,I){var G=Math.sin(I),Q=Math.cos(I),ne=y[4],he=y[5],ge=y[6],we=y[7],Ee=y[8],ke=y[9],De=y[10],Oe=y[11];return y!==U&&(U[0]=y[0],U[1]=y[1],U[2]=y[2],U[3]=y[3],U[12]=y[12],U[13]=y[13],U[14]=y[14],U[15]=y[15]),U[4]=ne*Q+Ee*G,U[5]=he*Q+ke*G,U[6]=ge*Q+De*G,U[7]=we*Q+Oe*G,U[8]=Ee*Q-ne*G,U[9]=ke*Q-he*G,U[10]=De*Q-ge*G,U[11]=Oe*Q-we*G,U}function Ju(U,y,I){var G=Math.sin(I),Q=Math.cos(I),ne=y[0],he=y[1],ge=y[2],we=y[3],Ee=y[8],ke=y[9],De=y[10],Oe=y[11];return y!==U&&(U[4]=y[4],U[5]=y[5],U[6]=y[6],U[7]=y[7],U[12]=y[12],U[13]=y[13],U[14]=y[14],U[15]=y[15]),U[0]=ne*Q-Ee*G,U[1]=he*Q-ke*G,U[2]=ge*Q-De*G,U[3]=we*Q-Oe*G,U[8]=ne*G+Ee*Q,U[9]=he*G+ke*Q,U[10]=ge*G+De*Q,U[11]=we*G+Oe*Q,U}function kp(U,y){return U[0]=y[0],U[1]=0,U[2]=0,U[3]=0,U[4]=0,U[5]=y[1],U[6]=0,U[7]=0,U[8]=0,U[9]=0,U[10]=y[2],U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,U}function Rp(U,y,I){var G,Q,ne,he=I[0],ge=I[1],we=I[2],Ee=Math.hypot(he,ge,we);return Ee<Yu?null:(he*=Ee=1/Ee,ge*=Ee,we*=Ee,G=Math.sin(y),Q=Math.cos(y),U[0]=he*he*(ne=1-Q)+Q,U[1]=ge*he*ne+we*G,U[2]=we*he*ne-ge*G,U[3]=0,U[4]=he*ge*ne-we*G,U[5]=ge*ge*ne+Q,U[6]=we*ge*ne+he*G,U[7]=0,U[8]=he*we*ne+ge*G,U[9]=ge*we*ne-he*G,U[10]=we*we*ne+Q,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,U)}Math.hypot||(Math.hypot=function(){for(var U=0,y=arguments.length;y--;)U+=arguments[y]*arguments[y];return Math.sqrt(U)});var t_=hl;function ld(){var U=new qi(3);return qi!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0),U}function zp(U){var y=new qi(3);return y[0]=U[0],y[1]=U[1],y[2]=U[2],y}function Cc(U){return Math.hypot(U[0],U[1],U[2])}function dl(U,y,I){var G=new qi(3);return G[0]=U,G[1]=y,G[2]=I,G}function Ms(U,y,I){return U[0]=y[0]+I[0],U[1]=y[1]+I[1],U[2]=y[2]+I[2],U}function cd(U,y,I){return U[0]=y[0]-I[0],U[1]=y[1]-I[1],U[2]=y[2]-I[2],U}function Dp(U,y,I){return U[0]=y[0]*I[0],U[1]=y[1]*I[1],U[2]=y[2]*I[2],U}function ud(U,y,I){return U[0]=Math.min(y[0],I[0]),U[1]=Math.min(y[1],I[1]),U[2]=Math.min(y[2],I[2]),U}function hd(U,y,I){return U[0]=Math.max(y[0],I[0]),U[1]=Math.max(y[1],I[1]),U[2]=Math.max(y[2],I[2]),U}function go(U,y,I){return U[0]=y[0]*I,U[1]=y[1]*I,U[2]=y[2]*I,U}function Qu(U,y,I,G){return U[0]=y[0]+I[0]*G,U[1]=y[1]+I[1]*G,U[2]=y[2]+I[2]*G,U}function Ri(U,y){var I=y[0],G=y[1],Q=y[2],ne=I*I+G*G+Q*Q;return ne>0&&(ne=1/Math.sqrt(ne)),U[0]=y[0]*ne,U[1]=y[1]*ne,U[2]=y[2]*ne,U}function ao(U,y){return U[0]*y[0]+U[1]*y[1]+U[2]*y[2]}function dd(U,y,I){var G=y[0],Q=y[1],ne=y[2],he=I[0],ge=I[1],we=I[2];return U[0]=Q*we-ne*ge,U[1]=ne*he-G*we,U[2]=G*ge-Q*he,U}function ci(U,y,I){var G=y[0],Q=y[1],ne=y[2],he=I[3]*G+I[7]*Q+I[11]*ne+I[15];return U[0]=(I[0]*G+I[4]*Q+I[8]*ne+I[12])/(he=he||1),U[1]=(I[1]*G+I[5]*Q+I[9]*ne+I[13])/he,U[2]=(I[2]*G+I[6]*Q+I[10]*ne+I[14])/he,U}function Lp(U,y,I){var G=I[0],Q=I[1],ne=I[2],he=y[0],ge=y[1],we=y[2],Ee=Q*we-ne*ge,ke=ne*he-G*we,De=G*ge-Q*he,Oe=Q*De-ne*ke,Ne=ne*Ee-G*De,Ge=G*ke-Q*Ee,We=2*I[3];return ke*=We,De*=We,Ne*=2,Ge*=2,U[0]=he+(Ee*=We)+(Oe*=2),U[1]=ge+ke+Ne,U[2]=we+De+Ge,U}var Ic,yo=cd,n_=Dp,r_=Cc;function Bp(U,y,I){return U[0]=y[0]*I,U[1]=y[1]*I,U[2]=y[2]*I,U[3]=y[3]*I,U}function ya(U,y,I){var G=y[0],Q=y[1],ne=y[2],he=y[3];return U[0]=I[0]*G+I[4]*Q+I[8]*ne+I[12]*he,U[1]=I[1]*G+I[5]*Q+I[9]*ne+I[13]*he,U[2]=I[2]*G+I[6]*Q+I[10]*ne+I[14]*he,U[3]=I[3]*G+I[7]*Q+I[11]*ne+I[15]*he,U}function Op(){var U=new qi(4);return qi!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0),U[3]=1,U}function Fp(U){return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U}function Up(U,y,I){I*=.5;var G=y[0],Q=y[1],ne=y[2],he=y[3],ge=Math.sin(I),we=Math.cos(I);return U[0]=G*we+he*ge,U[1]=Q*we+ne*ge,U[2]=ne*we-Q*ge,U[3]=he*we-G*ge,U}function $p(U,y,I){I*=.5;var G=y[0],Q=y[1],ne=y[2],he=y[3],ge=Math.sin(I),we=Math.cos(I);return U[0]=G*we-ne*ge,U[1]=Q*we+he*ge,U[2]=ne*we+G*ge,U[3]=he*we-Q*ge,U}ld(),Ic=new qi(4),qi!=Float32Array&&(Ic[0]=0,Ic[1]=0,Ic[2]=0,Ic[3]=0),ld(),dl(1,0,0),dl(0,1,0),Op(),Op(),Pp();class pd{constructor(y,I){this.pos=y,this.dir=I}intersectsPlane(y,I,G){const Q=ao(I,this.dir);if(Math.abs(Q)<1e-6)return!1;const ne=((y[0]-this.pos[0])*I[0]+(y[1]-this.pos[1])*I[1]+(y[2]-this.pos[2])*I[2])/Q;return G[0]=this.pos[0]+this.dir[0]*ne,G[1]=this.pos[1]+this.dir[1]*ne,G[2]=this.pos[2]+this.dir[2]*ne,!0}closestPointOnSphere(y,I,G){if(function(Ne,Ge){var We=Ne[0],Je=Ne[1],st=Ne[2],pt=Ge[0],ct=Ge[1],ht=Ge[2];return Math.abs(We-pt)<=Yu*Math.max(1,Math.abs(We),Math.abs(pt))&&Math.abs(Je-ct)<=Yu*Math.max(1,Math.abs(Je),Math.abs(ct))&&Math.abs(st-ht)<=Yu*Math.max(1,Math.abs(st),Math.abs(ht))}(this.pos,y)||I===0)return G[0]=G[1]=G[2]=0,!1;const[Q,ne,he]=this.dir,ge=this.pos[0]-y[0],we=this.pos[1]-y[1],Ee=this.pos[2]-y[2],ke=Q*Q+ne*ne+he*he,De=2*(ge*Q+we*ne+Ee*he),Oe=De*De-4*ke*(ge*ge+we*we+Ee*Ee-I*I);if(Oe<0){const Ne=Math.max(-De/2,0),Ge=ge+Q*Ne,We=we+ne*Ne,Je=Ee+he*Ne,st=Math.hypot(Ge,We,Je);return G[0]=Ge*I/st,G[1]=We*I/st,G[2]=Je*I/st,!1}{const Ne=(-De-Math.sqrt(Oe))/(2*ke);if(Ne<0){const Ge=Math.hypot(ge,we,Ee);return G[0]=ge*I/Ge,G[1]=we*I/Ge,G[2]=Ee*I/Ge,!1}return G[0]=ge+Q*Ne,G[1]=we+ne*Ne,G[2]=Ee+he*Ne,!0}}}class fd{constructor(y,I,G,Q,ne){this.TL=y,this.TR=I,this.BR=G,this.BL=Q,this.horizon=ne}static fromInvProjectionMatrix(y,I,G){const Q=[-1,1,1],ne=[1,1,1],he=[1,-1,1],ge=[-1,-1,1],we=ci(Q,Q,y),Ee=ci(ne,ne,y),ke=ci(he,he,y),De=ci(ge,ge,y);return new fd(we,Ee,ke,De,I/G)}}class md{constructor(y,I){this.points=y,this.planes=I}static fromInvProjectionMatrix(y,I,G,Q){const ne=Math.pow(2,G),he=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(we=>{const Ee=ya([],we,y),ke=1/Ee[3]/I*ne;return function(De,Oe,Ne){return De[0]=Oe[0]*Ne[0],De[1]=Oe[1]*Ne[1],De[2]=Oe[2]*Ne[2],De[3]=Oe[3]*Ne[3],De}(Ee,Ee,[ke,ke,Q?1/Ee[3]:ke,ke])}),ge=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(we=>{const Ee=Ri([],dd([],yo([],he[we[0]],he[we[1]]),yo([],he[we[2]],he[we[1]]))),ke=-ao(Ee,he[we[1]]);return Ee.concat(ke)});return new md(he,ge)}}class Ui{static fromPoints(y){const I=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],G=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const Q of y)I[0]=Math.min(I[0],Q[0]),I[1]=Math.min(I[1],Q[1]),I[2]=Math.min(I[2],Q[2]),G[0]=Math.max(G[0],Q[0]),G[1]=Math.max(G[1],Q[1]),G[2]=Math.max(G[2],Q[2]);return new Ui(I,G)}constructor(y,I){this.min=y,this.max=I,this.center=go([],Ms([],this.min,this.max),.5)}quadrant(y){const I=[y%2==0,y<2],G=zp(this.min),Q=zp(this.max);for(let ne=0;ne<I.length;ne++)G[ne]=I[ne]?this.min[ne]:this.center[ne],Q[ne]=I[ne]?this.center[ne]:this.max[ne];return Q[2]=this.max[2],new Ui(G,Q)}distanceX(y){return Math.max(Math.min(this.max[0],y[0]),this.min[0])-y[0]}distanceY(y){return Math.max(Math.min(this.max[1],y[1]),this.min[1])-y[1]}distanceZ(y){return Math.max(Math.min(this.max[2],y[2]),this.min[2])-y[2]}getCorners(){const y=this.min,I=this.max;return[[y[0],y[1],y[2]],[I[0],y[1],y[2]],[I[0],I[1],y[2]],[y[0],I[1],y[2]],[y[0],y[1],I[2]],[I[0],y[1],I[2]],[I[0],I[1],I[2]],[y[0],I[1],I[2]]]}intersects(y){const I=this.getCorners();let G=!0;for(let Q=0;Q<y.planes.length;Q++){const ne=y.planes[Q];let he=0;for(let ge=0;ge<I.length;ge++)he+=ao(ne,I[ge])+ne[3]>=0;if(he===0)return 0;he!==I.length&&(G=!1)}if(G)return 2;for(let Q=0;Q<3;Q++){let ne=Number.MAX_VALUE,he=-Number.MAX_VALUE;for(let ge=0;ge<y.points.length;ge++){const we=y.points[ge][Q]-this.min[Q];ne=Math.min(ne,we),he=Math.max(he,we)}if(he<0||ne>this.max[Q]-this.min[Q])return 0}return 1}}function Np(U,y,I,G,Q,ne,he,ge,we){if(ne&&U.queryGeometry.isAboveHorizon)return!1;ne&&(we*=U.pixelToTileUnitsFactor);const Ee=U.tileID.canonical,ke=I.projection.upVectorScale(Ee,I.center.lat,I.worldSize).metersToTile;for(const De of y)for(const Oe of De){const Ne=Oe.add(ge),Ge=Q&&I.elevation?I.elevation.exaggeration()*Q.getElevationAt(Ne.x,Ne.y,!0):0,We=I.projection.projectTilePoint(Ne.x,Ne.y,Ee);if(Ge>0){const ct=I.projection.upVector(Ee,Ne.x,Ne.y);We.x+=ct[0]*ke*Ge,We.y+=ct[1]*ke*Ge,We.z+=ct[2]*ke*Ge}const Je=ne?Ne:i_(We.x,We.y,We.z,G),st=ne?U.tilespaceRays.map(ct=>s_(ct,Ge)):U.queryGeometry.screenGeometry,pt=ya([],[We.x,We.y,We.z,1],G);if(!he&&ne?we*=pt[3]/I.cameraToCenterDistance:he&&!ne&&(we*=I.cameraToCenterDistance/pt[3]),ne){const ct=wi((Oe.y/Hn+Ee.y)/(1<<Ee.z));we/=I.projection.pixelsPerMeter(ct,1)/oo(1,ct)}if(Xm(st,Je,we))return!0}return!1}function i_(U,y,I,G){const Q=ya([],[U,y,I,1],G);return new ze(Q[0]/Q[3],Q[1]/Q[3])}const jp=dl(0,0,0),o_=dl(0,0,1);function s_(U,y){const I=ld();return jp[2]=y,U.intersectsPlane(jp,o_,I),new ze(I[0],I[1])}class Vp extends rd{}function Gp(U,{width:y,height:I},G,Q){if(Q){if(Q instanceof Uint8ClampedArray)Q=new Uint8Array(Q.buffer);else if(Q.length!==y*I*G)throw new RangeError("mismatched image size")}else Q=new Uint8Array(y*I*G);return U.width=y,U.height=I,U.data=Q,U}function qp(U,y,I){const{width:G,height:Q}=y;G===U.width&&Q===U.height||(_d(U,y,{x:0,y:0},{x:0,y:0},{width:Math.min(U.width,G),height:Math.min(U.height,Q)},I),U.width=G,U.height=Q,U.data=y.data)}function _d(U,y,I,G,Q,ne){if(Q.width===0||Q.height===0)return y;if(Q.width>U.width||Q.height>U.height||I.x>U.width-Q.width||I.y>U.height-Q.height)throw new RangeError("out of range source coordinates for image copy");if(Q.width>y.width||Q.height>y.height||G.x>y.width-Q.width||G.y>y.height-Q.height)throw new RangeError("out of range destination coordinates for image copy");const he=U.data,ge=y.data;for(let we=0;we<Q.height;we++){const Ee=((I.y+we)*U.width+I.x)*ne,ke=((G.y+we)*y.width+G.x)*ne;for(let De=0;De<Q.width*ne;De++)ge[ke+De]=he[Ee+De]}return y}Pn(Vp,"HeatmapBucket",{omit:["layers"]});class rs{constructor(y,I){Gp(this,y,1,I)}resize(y){qp(this,new rs(y),1)}clone(){return new rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(y,I,G,Q,ne){_d(y,I,G,Q,ne,1)}}class Zi{constructor(y,I){Gp(this,y,4,I)}resize(y){qp(this,new Zi(y),4)}replace(y,I){I?this.data.set(y):this.data=y instanceof Uint8ClampedArray?new Uint8Array(y.buffer):y}clone(){return new Zi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(y,I,G,Q,ne){_d(y,I,G,Q,ne,4)}}Pn(rs,"AlphaImage"),Pn(Zi,"RGBAImage");var a_={paint:new Xt({"heatmap-radius":new St(Zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(Zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rt(Zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(Zt.paint_heatmap["heatmap-opacity"])})};function gd(U){const y={},I=U.resolution||256,G=U.clips?U.clips.length:1,Q=U.image||new Zi({width:I,height:G}),ne=(he,ge,we)=>{y[U.evaluationKey]=we;const Ee=U.expression.evaluate(y);Q.data[he+ge+0]=Math.floor(255*Ee.r/Ee.a),Q.data[he+ge+1]=Math.floor(255*Ee.g/Ee.a),Q.data[he+ge+2]=Math.floor(255*Ee.b/Ee.a),Q.data[he+ge+3]=Math.floor(255*Ee.a)};if(U.clips)for(let he=0,ge=0;he<G;++he,ge+=4*I)for(let we=0,Ee=0;we<I;we++,Ee+=4){const ke=we/(I-1),{start:De,end:Oe}=U.clips[he];ne(ge,Ee,De*(1-ke)+Oe*ke)}else for(let he=0,ge=0;he<I;he++,ge+=4)ne(0,ge,he/(I-1));return Q}var l_={paint:new Xt({"hillshade-illumination-direction":new _t(Zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _t(Zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(Zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(Zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(Zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(Zt.paint_hillshade["hillshade-accent-color"])})};const c_=Jt([{name:"a_pos",components:2,type:"Int16"}],4),{members:u_}=c_;var eh=th,h_=th;function th(U,y,I){I=I||2;var G,Q,ne,he,ge,we,Ee,ke=y&&y.length,De=ke?y[0]*I:U.length,Oe=Zp(U,0,De,I,!0),Ne=[];if(!Oe||Oe.next===Oe.prev)return Ne;if(ke&&(Oe=function(We,Je,st,pt){var ct,ht,bt,mt=[];for(ct=0,ht=Je.length;ct<ht;ct++)(bt=Zp(We,Je[ct]*pt,ct<ht-1?Je[ct+1]*pt:We.length,pt,!1))===bt.next&&(bt.steiner=!0),mt.push(v_(bt));for(mt.sort(__),ct=0;ct<mt.length;ct++)st=g_(mt[ct],st);return st}(U,y,Oe,I)),U.length>80*I){G=ne=U[0],Q=he=U[1];for(var Ge=I;Ge<De;Ge+=I)(ge=U[Ge])<G&&(G=ge),(we=U[Ge+1])<Q&&(Q=we),ge>ne&&(ne=ge),we>he&&(he=we);Ee=(Ee=Math.max(ne-G,he-Q))!==0?32767/Ee:0}return Mc(Oe,Ne,I,G,Q,Ee,0),Ne}function Zp(U,y,I,G,Q){var ne,he;if(Q===xd(U,y,I,G)>0)for(ne=y;ne<I;ne+=G)he=Xp(ne,U[ne],U[ne+1],he);else for(ne=I-G;ne>=y;ne-=G)he=Xp(ne,U[ne],U[ne+1],he);return he&&nh(he,he.next)&&(kc(he),he=he.next),he}function va(U,y){if(!U)return U;y||(y=U);var I,G=U;do if(I=!1,G.steiner||!nh(G,G.next)&&oi(G.prev,G,G.next)!==0)G=G.next;else{if(kc(G),(G=y=G.prev)===G.next)break;I=!0}while(I||G!==y);return y}function Mc(U,y,I,G,Q,ne,he){if(U){!he&&ne&&function(ke,De,Oe,Ne){var Ge=ke;do Ge.z===0&&(Ge.z=yd(Ge.x,Ge.y,De,Oe,Ne)),Ge.prevZ=Ge.prev,Ge.nextZ=Ge.next,Ge=Ge.next;while(Ge!==ke);Ge.prevZ.nextZ=null,Ge.prevZ=null,function(We){var Je,st,pt,ct,ht,bt,mt,$t,Ft=1;do{for(st=We,We=null,ht=null,bt=0;st;){for(bt++,pt=st,mt=0,Je=0;Je<Ft&&(mt++,pt=pt.nextZ);Je++);for($t=Ft;mt>0||$t>0&&pt;)mt!==0&&($t===0||!pt||st.z<=pt.z)?(ct=st,st=st.nextZ,mt--):(ct=pt,pt=pt.nextZ,$t--),ht?ht.nextZ=ct:We=ct,ct.prevZ=ht,ht=ct;st=pt}ht.nextZ=null,Ft*=2}while(bt>1)}(Ge)}(U,G,Q,ne);for(var ge,we,Ee=U;U.prev!==U.next;)if(ge=U.prev,we=U.next,ne?p_(U,G,Q,ne):d_(U))y.push(ge.i/I|0),y.push(U.i/I|0),y.push(we.i/I|0),kc(U),U=we.next,Ee=we.next;else if((U=we)===Ee){he?he===1?Mc(U=f_(va(U),y,I),y,I,G,Q,ne,2):he===2&&m_(U,y,I,G,Q,ne):Mc(va(U),y,I,G,Q,ne,1);break}}}function d_(U){var y=U.prev,I=U,G=U.next;if(oi(y,I,G)>=0)return!1;for(var Q=y.x,ne=I.x,he=G.x,ge=y.y,we=I.y,Ee=G.y,ke=Q<ne?Q<he?Q:he:ne<he?ne:he,De=ge<we?ge<Ee?ge:Ee:we<Ee?we:Ee,Oe=Q>ne?Q>he?Q:he:ne>he?ne:he,Ne=ge>we?ge>Ee?ge:Ee:we>Ee?we:Ee,Ge=G.next;Ge!==y;){if(Ge.x>=ke&&Ge.x<=Oe&&Ge.y>=De&&Ge.y<=Ne&&pl(Q,ge,ne,we,he,Ee,Ge.x,Ge.y)&&oi(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.next}return!0}function p_(U,y,I,G){var Q=U.prev,ne=U,he=U.next;if(oi(Q,ne,he)>=0)return!1;for(var ge=Q.x,we=ne.x,Ee=he.x,ke=Q.y,De=ne.y,Oe=he.y,Ne=ge<we?ge<Ee?ge:Ee:we<Ee?we:Ee,Ge=ke<De?ke<Oe?ke:Oe:De<Oe?De:Oe,We=ge>we?ge>Ee?ge:Ee:we>Ee?we:Ee,Je=ke>De?ke>Oe?ke:Oe:De>Oe?De:Oe,st=yd(Ne,Ge,y,I,G),pt=yd(We,Je,y,I,G),ct=U.prevZ,ht=U.nextZ;ct&&ct.z>=st&&ht&&ht.z<=pt;){if(ct.x>=Ne&&ct.x<=We&&ct.y>=Ge&&ct.y<=Je&&ct!==Q&&ct!==he&&pl(ge,ke,we,De,Ee,Oe,ct.x,ct.y)&&oi(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,ht.x>=Ne&&ht.x<=We&&ht.y>=Ge&&ht.y<=Je&&ht!==Q&&ht!==he&&pl(ge,ke,we,De,Ee,Oe,ht.x,ht.y)&&oi(ht.prev,ht,ht.next)>=0))return!1;ht=ht.nextZ}for(;ct&&ct.z>=st;){if(ct.x>=Ne&&ct.x<=We&&ct.y>=Ge&&ct.y<=Je&&ct!==Q&&ct!==he&&pl(ge,ke,we,De,Ee,Oe,ct.x,ct.y)&&oi(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;ht&&ht.z<=pt;){if(ht.x>=Ne&&ht.x<=We&&ht.y>=Ge&&ht.y<=Je&&ht!==Q&&ht!==he&&pl(ge,ke,we,De,Ee,Oe,ht.x,ht.y)&&oi(ht.prev,ht,ht.next)>=0)return!1;ht=ht.nextZ}return!0}function f_(U,y,I){var G=U;do{var Q=G.prev,ne=G.next.next;!nh(Q,ne)&&Hp(Q,G,G.next,ne)&&Pc(Q,ne)&&Pc(ne,Q)&&(y.push(Q.i/I|0),y.push(G.i/I|0),y.push(ne.i/I|0),kc(G),kc(G.next),G=U=ne),G=G.next}while(G!==U);return va(G)}function m_(U,y,I,G,Q,ne){var he=U;do{for(var ge=he.next.next;ge!==he.prev;){if(he.i!==ge.i&&x_(he,ge)){var we=Wp(he,ge);return he=va(he,he.next),we=va(we,we.next),Mc(he,y,I,G,Q,ne,0),void Mc(we,y,I,G,Q,ne,0)}ge=ge.next}he=he.next}while(he!==U)}function __(U,y){return U.x-y.x}function g_(U,y){var I=function(Q,ne){var he,ge=ne,we=Q.x,Ee=Q.y,ke=-1/0;do{if(Ee<=ge.y&&Ee>=ge.next.y&&ge.next.y!==ge.y){var De=ge.x+(Ee-ge.y)*(ge.next.x-ge.x)/(ge.next.y-ge.y);if(De<=we&&De>ke&&(ke=De,he=ge.x<ge.next.x?ge:ge.next,De===we))return he}ge=ge.next}while(ge!==ne);if(!he)return null;var Oe,Ne=he,Ge=he.x,We=he.y,Je=1/0;ge=he;do we>=ge.x&&ge.x>=Ge&&we!==ge.x&&pl(Ee<We?we:ke,Ee,Ge,We,Ee<We?ke:we,Ee,ge.x,ge.y)&&(Oe=Math.abs(Ee-ge.y)/(we-ge.x),Pc(ge,Q)&&(Oe<Je||Oe===Je&&(ge.x>he.x||ge.x===he.x&&y_(he,ge)))&&(he=ge,Je=Oe)),ge=ge.next;while(ge!==Ne);return he}(U,y);if(!I)return y;var G=Wp(I,U);return va(G,G.next),va(I,I.next)}function y_(U,y){return oi(U.prev,U,y.prev)<0&&oi(y.next,U,U.next)<0}function yd(U,y,I,G,Q){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U=(U-I)*Q|0)|U<<8))|U<<4))|U<<2))|U<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-G)*Q|0)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function v_(U){var y=U,I=U;do(y.x<I.x||y.x===I.x&&y.y<I.y)&&(I=y),y=y.next;while(y!==U);return I}function pl(U,y,I,G,Q,ne,he,ge){return(Q-he)*(y-ge)>=(U-he)*(ne-ge)&&(U-he)*(G-ge)>=(I-he)*(y-ge)&&(I-he)*(ne-ge)>=(Q-he)*(G-ge)}function x_(U,y){return U.next.i!==y.i&&U.prev.i!==y.i&&!function(I,G){var Q=I;do{if(Q.i!==I.i&&Q.next.i!==I.i&&Q.i!==G.i&&Q.next.i!==G.i&&Hp(Q,Q.next,I,G))return!0;Q=Q.next}while(Q!==I);return!1}(U,y)&&(Pc(U,y)&&Pc(y,U)&&function(I,G){var Q=I,ne=!1,he=(I.x+G.x)/2,ge=(I.y+G.y)/2;do Q.y>ge!=Q.next.y>ge&&Q.next.y!==Q.y&&he<(Q.next.x-Q.x)*(ge-Q.y)/(Q.next.y-Q.y)+Q.x&&(ne=!ne),Q=Q.next;while(Q!==I);return ne}(U,y)&&(oi(U.prev,U,y.prev)||oi(U,y.prev,y))||nh(U,y)&&oi(U.prev,U,U.next)>0&&oi(y.prev,y,y.next)>0)}function oi(U,y,I){return(y.y-U.y)*(I.x-y.x)-(y.x-U.x)*(I.y-y.y)}function nh(U,y){return U.x===y.x&&U.y===y.y}function Hp(U,y,I,G){var Q=ih(oi(U,y,I)),ne=ih(oi(U,y,G)),he=ih(oi(I,G,U)),ge=ih(oi(I,G,y));return Q!==ne&&he!==ge||!(Q!==0||!rh(U,I,y))||!(ne!==0||!rh(U,G,y))||!(he!==0||!rh(I,U,G))||!(ge!==0||!rh(I,y,G))}function rh(U,y,I){return y.x<=Math.max(U.x,I.x)&&y.x>=Math.min(U.x,I.x)&&y.y<=Math.max(U.y,I.y)&&y.y>=Math.min(U.y,I.y)}function ih(U){return U>0?1:U<0?-1:0}function Pc(U,y){return oi(U.prev,U,U.next)<0?oi(U,y,U.next)>=0&&oi(U,U.prev,y)>=0:oi(U,y,U.prev)<0||oi(U,U.next,y)<0}function Wp(U,y){var I=new vd(U.i,U.x,U.y),G=new vd(y.i,y.x,y.y),Q=U.next,ne=y.prev;return U.next=y,y.prev=U,I.next=Q,Q.prev=I,G.next=I,I.prev=G,ne.next=G,G.prev=ne,G}function Xp(U,y,I,G){var Q=new vd(U,y,I);return G?(Q.next=G.next,Q.prev=G,G.next.prev=Q,G.next=Q):(Q.prev=Q,Q.next=Q),Q}function kc(U){U.next.prev=U.prev,U.prev.next=U.next,U.prevZ&&(U.prevZ.nextZ=U.nextZ),U.nextZ&&(U.nextZ.prevZ=U.prevZ)}function vd(U,y,I){this.i=U,this.x=y,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xd(U,y,I,G){for(var Q=0,ne=y,he=I-G;ne<I;ne+=G)Q+=(U[he]-U[ne])*(U[ne+1]+U[he+1]),he=ne;return Q}function b_(U,y,I,G,Q){Kp(U,y,I||0,G||U.length-1,Q||w_)}function Kp(U,y,I,G,Q){for(;G>I;){if(G-I>600){var ne=G-I+1,he=y-I+1,ge=Math.log(ne),we=.5*Math.exp(2*ge/3),Ee=.5*Math.sqrt(ge*we*(ne-we)/ne)*(he-ne/2<0?-1:1);Kp(U,y,Math.max(I,Math.floor(y-he*we/ne+Ee)),Math.min(G,Math.floor(y+(ne-he)*we/ne+Ee)),Q)}var ke=U[y],De=I,Oe=G;for(Rc(U,I,y),Q(U[G],ke)>0&&Rc(U,I,G);De<Oe;){for(Rc(U,De,Oe),De++,Oe--;Q(U[De],ke)<0;)De++;for(;Q(U[Oe],ke)>0;)Oe--}Q(U[I],ke)===0?Rc(U,I,Oe):Rc(U,++Oe,G),Oe<=y&&(I=Oe+1),y<=Oe&&(G=Oe-1)}}function Rc(U,y,I){var G=U[y];U[y]=U[I],U[I]=G}function w_(U,y){return U<y?-1:U>y?1:0}function bd(U,y){const I=U.length;if(I<=1)return[U];const G=[];let Q,ne;for(let he=0;he<I;he++){const ge=Vr(U[he]);ge!==0&&(U[he].area=Math.abs(ge),ne===void 0&&(ne=ge<0),ne===ge<0?(Q&&G.push(Q),Q=[U[he]]):Q.push(U[he]))}if(Q&&G.push(Q),y>1)for(let he=0;he<G.length;he++)G[he].length<=y||(b_(G[he],y,1,G[he].length-1,T_),G[he]=G[he].slice(0,y));return G}function T_(U,y){return y.area-U.area}function wd(U,y,I){const G=I.patternDependencies;let Q=!1;for(const ne of y){const he=ne.paint.get(`${U}-pattern`);he.isConstant()||(Q=!0);const ge=he.constantOr(null);ge&&(Q=!0,G[ge.to]=!0,G[ge.from]=!0)}return Q}function Td(U,y,I,G,Q){const ne=Q.patternDependencies;for(const he of y){const ge=he.paint.get(`${U}-pattern`).value;if(ge.kind!=="constant"){let we=ge.evaluate({zoom:G-1},I,{},Q.availableImages),Ee=ge.evaluate({zoom:G},I,{},Q.availableImages),ke=ge.evaluate({zoom:G+1},I,{},Q.availableImages);we=we&&we.name?we.name:we,Ee=Ee&&Ee.name?Ee.name:Ee,ke=ke&&ke.name?ke.name:ke,ne[we]=!0,ne[Ee]=!0,ne[ke]=!0,I.patterns[he.id]={min:we,mid:Ee,max:ke}}}return I}th.deviation=function(U,y,I,G){var Q=y&&y.length,ne=Math.abs(xd(U,0,Q?y[0]*I:U.length,I));if(Q)for(var he=0,ge=y.length;he<ge;he++)ne-=Math.abs(xd(U,y[he]*I,he<ge-1?y[he+1]*I:U.length,I));var we=0;for(he=0;he<G.length;he+=3){var Ee=G[he]*I,ke=G[he+1]*I,De=G[he+2]*I;we+=Math.abs((U[Ee]-U[De])*(U[ke+1]-U[Ee+1])-(U[Ee]-U[ke])*(U[De+1]-U[Ee+1]))}return ne===0&&we===0?0:Math.abs((we-ne)/ne)},th.flatten=function(U){for(var y=U[0][0].length,I={vertices:[],holes:[],dimensions:y},G=0,Q=0;Q<U.length;Q++){for(var ne=0;ne<U[Q].length;ne++)for(var he=0;he<y;he++)I.vertices.push(U[Q][ne][he]);Q>0&&I.holes.push(G+=U[Q-1].length)}return I},eh.default=h_;class oh{constructor(y){this.zoom=y.zoom,this.overscaling=y.overscaling,this.layers=y.layers,this.layerIds=this.layers.map(I=>I.id),this.index=y.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xn,this.indexArray=new cr,this.indexArray2=new Si,this.programConfigurations=new fa(y.layers,y.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.projection=y.projection}populate(y,I,G,Q){this.hasPattern=wd("fill",this.layers,I);const ne=this.layers[0].layout.get("fill-sort-key"),he=[];for(const{feature:ge,id:we,index:Ee,sourceLayerIndex:ke}of y){const De=this.layers[0]._featureFilter.needGeometry,Oe=ma(ge,De);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom),Oe,G))continue;const Ne=ne?ne.evaluate(Oe,{},G,I.availableImages):void 0,Ge={id:we,properties:ge.properties,type:ge.type,sourceLayerIndex:ke,index:Ee,geometry:De?Oe.geometry:ns(ge,G,Q),patterns:{},sortKey:Ne};he.push(Ge)}ne&&he.sort((ge,we)=>ge.sortKey-we.sortKey);for(const ge of he){const{geometry:we,index:Ee,sourceLayerIndex:ke}=ge;if(this.hasPattern){const De=Td("fill",this.layers,ge,this.zoom,I);this.patternFeatures.push(De)}else this.addFeature(ge,we,Ee,G,{},I.availableImages);I.featureIndex.insert(y[Ee].feature,we,Ee,ke,this.index)}}update(y,I,G,Q){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(y,I,this.stateDependentLayers,G,Q)}addFeatures(y,I,G,Q,ne){for(const he of this.patternFeatures)this.addFeature(he,he.geometry,he.index,I,G,Q)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(y){this.uploaded||(this.layoutVertexBuffer=y.createVertexBuffer(this.layoutVertexArray,u_),this.indexBuffer=y.createIndexBuffer(this.indexArray),this.indexBuffer2=y.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(y),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(y,I,G,Q,ne,he=[]){for(const ge of bd(I,500)){let we=0;for(const Ge of ge)we+=Ge.length;const Ee=this.segments.prepareSegment(we,this.layoutVertexArray,this.indexArray),ke=Ee.vertexLength,De=[],Oe=[];for(const Ge of ge){if(Ge.length===0)continue;Ge!==ge[0]&&Oe.push(De.length/2);const We=this.segments2.prepareSegment(Ge.length,this.layoutVertexArray,this.indexArray2),Je=We.vertexLength;this.layoutVertexArray.emplaceBack(Ge[0].x,Ge[0].y),this.indexArray2.emplaceBack(Je+Ge.length-1,Je),De.push(Ge[0].x),De.push(Ge[0].y);for(let st=1;st<Ge.length;st++)this.layoutVertexArray.emplaceBack(Ge[st].x,Ge[st].y),this.indexArray2.emplaceBack(Je+st-1,Je+st),De.push(Ge[st].x),De.push(Ge[st].y);We.vertexLength+=Ge.length,We.primitiveLength+=Ge.length}const Ne=eh(De,Oe);for(let Ge=0;Ge<Ne.length;Ge+=3)this.indexArray.emplaceBack(ke+Ne[Ge],ke+Ne[Ge+1],ke+Ne[Ge+2]);Ee.vertexLength+=we,Ee.primitiveLength+=Ne.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,y,G,ne,he,Q)}}Pn(oh,"FillBucket",{omit:["layers","patternFeatures"]});const E_=new Xt({"fill-sort-key":new St(Zt.layout_fill["fill-sort-key"])});var A_={paint:new Xt({"fill-antialias":new _t(Zt.paint_fill["fill-antialias"]),"fill-opacity":new St(Zt.paint_fill["fill-opacity"]),"fill-color":new St(Zt.paint_fill["fill-color"]),"fill-outline-color":new St(Zt.paint_fill["fill-outline-color"]),"fill-translate":new _t(Zt.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(Zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bt(Zt.paint_fill["fill-pattern"])}),layout:E_};const S_=Jt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),C_=Jt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),I_=Jt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:M_}=S_;var Yp=fl;function fl(U,y,I,G,Q){this.properties={},this.extent=I,this.type=0,this._pbf=U,this._geometry=-1,this._keys=G,this._values=Q,U.readFields(P_,this,y)}function P_(U,y,I){U==1?y.id=I.readVarint():U==2?function(G,Q){for(var ne=G.readVarint()+G.pos;G.pos<ne;){var he=Q._keys[G.readVarint()],ge=Q._values[G.readVarint()];Q.properties[he]=ge}}(I,y):U==3?y.type=I.readVarint():U==4&&(y._geometry=I.pos)}function k_(U){for(var y,I,G=0,Q=0,ne=U.length,he=ne-1;Q<ne;he=Q++)G+=((I=U[he]).x-(y=U[Q]).x)*(y.y+I.y);return G}fl.types=["Unknown","Point","LineString","Polygon"],fl.prototype.loadGeometry=function(){var U=this._pbf;U.pos=this._geometry;for(var y,I=U.readVarint()+U.pos,G=1,Q=0,ne=0,he=0,ge=[];U.pos<I;){if(Q<=0){var we=U.readVarint();G=7&we,Q=we>>3}if(Q--,G===1||G===2)ne+=U.readSVarint(),he+=U.readSVarint(),G===1&&(y&&ge.push(y),y=[]),y.push(new ze(ne,he));else{if(G!==7)throw new Error("unknown command "+G);y&&y.push(y[0].clone())}}return y&&ge.push(y),ge},fl.prototype.bbox=function(){var U=this._pbf;U.pos=this._geometry;for(var y=U.readVarint()+U.pos,I=1,G=0,Q=0,ne=0,he=1/0,ge=-1/0,we=1/0,Ee=-1/0;U.pos<y;){if(G<=0){var ke=U.readVarint();I=7&ke,G=ke>>3}if(G--,I===1||I===2)(Q+=U.readSVarint())<he&&(he=Q),Q>ge&&(ge=Q),(ne+=U.readSVarint())<we&&(we=ne),ne>Ee&&(Ee=ne);else if(I!==7)throw new Error("unknown command "+I)}return[he,we,ge,Ee]},fl.prototype.toGeoJSON=function(U,y,I){var G,Q,ne=this.extent*Math.pow(2,I),he=this.extent*U,ge=this.extent*y,we=this.loadGeometry(),Ee=fl.types[this.type];function ke(Ne){for(var Ge=0;Ge<Ne.length;Ge++){var We=Ne[Ge];Ne[Ge]=[360*(We.x+he)/ne-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+ge)/ne)*Math.PI/180))-90]}}switch(this.type){case 1:var De=[];for(G=0;G<we.length;G++)De[G]=we[G][0];ke(we=De);break;case 2:for(G=0;G<we.length;G++)ke(we[G]);break;case 3:for(we=function(Ne){var Ge=Ne.length;if(Ge<=1)return[Ne];for(var We,Je,st=[],pt=0;pt<Ge;pt++){var ct=k_(Ne[pt]);ct!==0&&(Je===void 0&&(Je=ct<0),Je===ct<0?(We&&st.push(We),We=[Ne[pt]]):We.push(Ne[pt]))}return We&&st.push(We),st}(we),G=0;G<we.length;G++)for(Q=0;Q<we[G].length;Q++)ke(we[G][Q])}we.length===1?we=we[0]:Ee="Multi"+Ee;var Oe={type:"Feature",geometry:{type:Ee,coordinates:we},properties:this.properties};return"id"in this&&(Oe.id=this.id),Oe};var Jp=Qp;function Qp(U,y){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=U,this._keys=[],this._values=[],this._features=[],U.readFields(R_,this,y),this.length=this._features.length}function R_(U,y,I){U===15?y.version=I.readVarint():U===1?y.name=I.readString():U===5?y.extent=I.readVarint():U===2?y._features.push(I.pos):U===3?y._keys.push(I.readString()):U===4&&y._values.push(function(G){for(var Q=null,ne=G.readVarint()+G.pos;G.pos<ne;){var he=G.readVarint()>>3;Q=he===1?G.readString():he===2?G.readFloat():he===3?G.readDouble():he===4?G.readVarint64():he===5?G.readVarint():he===6?G.readSVarint():he===7?G.readBoolean():null}return Q}(I))}function z_(U,y,I){if(U===3){var G=new Jp(I,I.readVarint()+I.pos);G.length&&(y[G.name]=G)}}Qp.prototype.feature=function(U){if(U<0||U>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[U];var y=this._pbf.readVarint()+this._pbf.pos;return new Yp(this._pbf,y,this.extent,this._keys,this._values)};var xa={VectorTile:function(U,y){this.layers=U.readFields(z_,{},y)},VectorTileFeature:Yp,VectorTileLayer:Jp};function sh(U,y,I,G){const Q=[],ne=G===0?(he,ge,we,Ee,ke,De)=>{he.push(new ze(De,we+(De-ge)/(Ee-ge)*(ke-we)))}:(he,ge,we,Ee,ke,De)=>{he.push(new ze(ge+(De-we)/(ke-we)*(Ee-ge),De))};for(const he of U){const ge=[];for(const we of he){if(we.length<=2)continue;const Ee=[];for(let Oe=0;Oe<we.length-1;Oe++){const Ne=we[Oe].x,Ge=we[Oe].y,We=we[Oe+1].x,Je=we[Oe+1].y,st=G===0?Ne:Ge,pt=G===0?We:Je;st<y?pt>y&&ne(Ee,Ne,Ge,We,Je,y):st>I?pt<I&&ne(Ee,Ne,Ge,We,Je,I):Ee.push(we[Oe]),pt<y&&st>=y&&ne(Ee,Ne,Ge,We,Je,y),pt>I&&st<=I&&ne(Ee,Ne,Ge,We,Je,I)}let ke=we[we.length-1];const De=G===0?ke.x:ke.y;De>=y&&De<=I&&Ee.push(ke),Ee.length&&(ke=Ee[Ee.length-1],Ee[0].x===ke.x&&Ee[0].y===ke.y||Ee.push(Ee[0]),ge.push(Ee))}ge.length&&Q.push(ge)}return Q}const D_=xa.VectorTileFeature.types,L_=Math.pow(2,13);function zc(U,y,I,G,Q,ne,he,ge){U.emplaceBack((y<<1)+he,(I<<1)+ne,(Math.floor(G*L_)<<1)+Q,Math.round(ge))}function Dc(U,y,I){U.emplaceBack(y.x,y.y,y.z,I[0]*16384,I[1]*16384,I[2]*16384)}class ef{constructor(){this.acc=new ze(0,0),this.polyCount=[]}startRing(y){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ze(y.x,y.y),this.max=new ze(y.x,y.y))}append(y,I){this.currentPolyCount.edges++,this.acc._add(y);const G=this.min,Q=this.max;y.x<G.x?G.x=y.x:y.x>Q.x&&(Q.x=y.x),y.y<G.y?G.y=y.y:y.y>Q.y&&(Q.y=y.y),((y.x===0||y.x===Hn)&&y.x===I.x)!=((y.y===0||y.y===Hn)&&y.y===I.y)&&this.processBorderOverlap(y,I),I.x<0!=y.x<0&&this.addBorderIntersection(0,wr(I.y,y.y,(0-I.x)/(y.x-I.x))),I.x>Hn!=y.x>Hn&&this.addBorderIntersection(1,wr(I.y,y.y,(Hn-I.x)/(y.x-I.x))),I.y<0!=y.y<0&&this.addBorderIntersection(2,wr(I.x,y.x,(0-I.y)/(y.y-I.y))),I.y>Hn!=y.y>Hn&&this.addBorderIntersection(3,wr(I.x,y.x,(Hn-I.y)/(y.y-I.y)))}addBorderIntersection(y,I){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const G=this.borders[y];I<G[0]&&(G[0]=I),I>G[1]&&(G[1]=I)}processBorderOverlap(y,I){if(y.x===I.x){if(y.y===I.y)return;const G=y.x===0?0:1;this.addBorderIntersection(G,I.y),this.addBorderIntersection(G,y.y)}else{const G=y.y===0?2:3;this.addBorderIntersection(G,I.x),this.addBorderIntersection(G,y.x)}}centroid(){const y=this.polyCount.reduce((I,G)=>I+G.edges,0);return y!==0?this.acc.div(y)._round():new ze(0,0)}span(){return new ze(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((y,I)=>y+ +(I[0]!==Number.MAX_VALUE),0)}}class Lc{constructor(y){this.zoom=y.zoom,this.canonical=y.canonical,this.overscaling=y.overscaling,this.layers=y.layers,this.layerIds=this.layers.map(I=>I.id),this.index=y.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=y.projection,this.layoutVertexArray=new $n,this.centroidVertexArray=new up,this.indexArray=new cr,this.programConfigurations=new fa(y.layers,y.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.enableTerrain=y.enableTerrain}populate(y,I,G,Q){this.features=[],this.hasPattern=wd("fill-extrusion",this.layers,I),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(ne){const he=Math.exp(Math.PI*(1-ne.y/(1<<ne.z)*2));return 80150034*he/(he*he+1)/Hn/(1<<ne.z)}(G),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:ne,id:he,index:ge,sourceLayerIndex:we}of y){const Ee=this.layers[0]._featureFilter.needGeometry,ke=ma(ne,Ee);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom),ke,G))continue;const De={id:he,sourceLayerIndex:we,index:ge,geometry:Ee?ke.geometry:ns(ne,G,Q),properties:ne.properties,type:ne.type,patterns:{}},Oe=this.layoutVertexArray.length;this.hasPattern?this.features.push(Td("fill-extrusion",this.layers,De,this.zoom,I)):this.addFeature(De,De.geometry,ge,G,{},I.availableImages,Q),I.featureIndex.insert(ne,De.geometry,ge,we,this.index,Oe)}this.sortBorders()}addFeatures(y,I,G,Q,ne){for(const he of this.features){const{geometry:ge}=he;this.addFeature(he,ge,he.index,I,G,Q,ne)}this.sortBorders()}update(y,I,G,Q){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(y,I,this.stateDependentLayers,G,Q)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(y){this.uploaded||(this.layoutVertexBuffer=y.createVertexBuffer(this.layoutVertexArray,M_),this.indexBuffer=y.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=y.createVertexBuffer(this.layoutVertexExtArray,I_.members,!0))),this.programConfigurations.upload(y),this.uploaded=!0}uploadCentroid(y){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=y.createVertexBuffer(this.centroidVertexArray,C_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(y,I,G,Q,ne,he,ge){const we=[new ze(0,0),new ze(Hn,Hn)],Ee=ge.projection,ke=Ee.name==="globe",De=this.enableTerrain&&!ke?new ef:null,Oe=D_[y.type]==="Polygon";ke&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ci);const Ne=bd(I,500);for(let st=Ne.length-1;st>=0;st--){const pt=Ne[st];(pt.length===0||(Ge=pt[0]).every(ct=>ct.x<=0)||Ge.every(ct=>ct.x>=Hn)||Ge.every(ct=>ct.y<=0)||Ge.every(ct=>ct.y>=Hn))&&Ne.splice(st,1)}var Ge;let We;if(ke)We=lf(Ne,we,Q);else{We=[];for(const st of Ne)We.push({polygon:st,bounds:we})}const Je=Oe?this.edgeRadius:0;for(const{polygon:st,bounds:pt}of We){let ct=0,ht=0;for(const mt of st)Oe&&!mt[0].equals(mt[mt.length-1])&&mt.push(mt[0]),ht+=Oe?mt.length-1:mt.length;const bt=this.segments.prepareSegment((Oe?5:4)*ht,this.layoutVertexArray,this.indexArray);if(Oe){const mt=[],$t=[];ct=bt.vertexLength;for(const Ht of st){let pn,Nt;Ht.length&&Ht!==st[0]&&$t.push(mt.length/2),pn=Ht[1].sub(Ht[0])._perp()._unit();for(let Kt=1;Kt<Ht.length;Kt++){const nn=Ht[Kt],Yt=Ht[Kt===Ht.length-1?1:Kt+1];let{x:hn,y:rn}=nn;if(Je){Nt=Yt.sub(nn)._perp()._unit();const En=pn.add(Nt)._unit(),nr=Je*Math.min(4,1/(pn.x*En.x+pn.y*En.y));hn+=nr*En.x,rn+=nr*En.y,pn=Nt}zc(this.layoutVertexArray,hn,rn,0,0,1,1,0),bt.vertexLength++,mt.push(nn.x,nn.y),ke&&Dc(this.layoutVertexExtArray,Ee.projectTilePoint(hn,rn,Q),Ee.upVector(Q,hn,rn))}}const Ft=eh(mt,$t);for(let Ht=0;Ht<Ft.length;Ht+=3)this.indexArray.emplaceBack(ct+Ft[Ht],ct+Ft[Ht+2],ct+Ft[Ht+1]),bt.primitiveLength++}for(const mt of st){De&&mt.length&&De.startRing(mt[0]);let $t,Ft,Ht,pn=mt.length>4&&of(mt[mt.length-2],mt[0],mt[1]),Nt=Je?B_(mt[mt.length-2],mt[0],mt[1],Je):0;Ft=mt[1].sub(mt[0])._perp()._unit();for(let Kt=1,nn=0;Kt<mt.length;Kt++){let Yt=mt[Kt-1],hn=mt[Kt];const rn=mt[Kt===mt.length-1?1:Kt+1];if(De&&Oe&&De.currentPolyCount.top++,rf(hn,Yt,pt)){Je&&(Ft=rn.sub(hn)._perp()._unit());continue}De&&De.append(hn,Yt);const En=hn.sub(Yt)._perp(),nr=En.x/(Math.abs(En.x)+Math.abs(En.y)),or=En.y>0?1:0,Fn=Yt.dist(hn);if(nn+Fn>32768&&(nn=0),Je){Ht=rn.sub(hn)._perp()._unit();let Mn=nf(Yt,hn,rn,tf(Ft,Ht),Je);isNaN(Mn)&&(Mn=0);const Nr=hn.sub(Yt)._unit();Yt=Yt.add(Nr.mult(Nt))._round(),hn=hn.add(Nr.mult(-Mn))._round(),Nt=Mn,Ft=Ht}const vn=bt.vertexLength,mr=mt.length>4&&of(Yt,hn,rn);let Kn=sf(nn,pn,!0);if(zc(this.layoutVertexArray,Yt.x,Yt.y,nr,or,0,0,Kn),zc(this.layoutVertexArray,Yt.x,Yt.y,nr,or,0,1,Kn),nn+=Fn,Kn=sf(nn,mr,!1),pn=mr,zc(this.layoutVertexArray,hn.x,hn.y,nr,or,0,0,Kn),zc(this.layoutVertexArray,hn.x,hn.y,nr,or,0,1,Kn),bt.vertexLength+=4,this.indexArray.emplaceBack(vn+0,vn+1,vn+2),this.indexArray.emplaceBack(vn+1,vn+3,vn+2),bt.primitiveLength+=2,Je){const Mn=ct+(Kt===1?mt.length-2:Kt-2),Nr=Kt===1?ct:Mn+1;if(this.indexArray.emplaceBack(vn+1,Mn,vn+3),this.indexArray.emplaceBack(Mn,Nr,vn+3),bt.primitiveLength+=2,$t===void 0&&($t=vn),!rf(rn,mt[Kt],pt)){const Or=Kt===mt.length-1?$t:bt.vertexLength;this.indexArray.emplaceBack(vn+2,vn+3,Or),this.indexArray.emplaceBack(vn+3,Or+1,Or),this.indexArray.emplaceBack(vn+3,Nr,Or+1),bt.primitiveLength+=3}}if(ke){const Mn=this.layoutVertexExtArray,Nr=Ee.projectTilePoint(Yt.x,Yt.y,Q),Or=Ee.projectTilePoint(hn.x,hn.y,Q),Wr=Ee.upVector(Q,Yt.x,Yt.y),ar=Ee.upVector(Q,hn.x,hn.y);Dc(Mn,Nr,Wr),Dc(Mn,Nr,Wr),Dc(Mn,Or,ar),Dc(Mn,Or,ar)}}Oe&&(ct+=mt.length-1)}}if(De&&De.polyCount.length>0){if(De.borders){De.vertexArrayOffset=this.centroidVertexArray.length;const st=De.borders,pt=this.featuresOnBorder.push(De)-1;for(let ct=0;ct<4;ct++)st[ct][0]!==Number.MAX_VALUE&&this.borders[ct].push(pt)}this.encodeCentroid(De.borders?void 0:De.centroid(),De)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,y,G,ne,he,Q)}sortBorders(){for(let y=0;y<4;y++)this.borders[y].sort((I,G)=>this.featuresOnBorder[I].borders[y][0]-this.featuresOnBorder[G].borders[y][0])}encodeCentroid(y,I,G=!0){let Q,ne;if(y)if(y.y!==0){const ge=I.span()._mult(this.tileToMeter);Q=(Math.max(y.x,1)<<3)+Math.min(7,Math.round(ge.x/10)),ne=(Math.max(y.y,1)<<3)+Math.min(7,Math.round(ge.y/10))}else Q=Math.ceil(7*(y.x+450)),ne=0;else Q=0,ne=+G;let he=G?this.centroidVertexArray.length:I.vertexArrayOffset;for(const ge of I.polyCount){G&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*ge.edges+ge.top);for(let we=0;we<ge.top;we++)this.centroidVertexArray.emplace(he++,Q,ne);for(let we=0;we<2*ge.edges;we++)this.centroidVertexArray.emplace(he++,0,ne),this.centroidVertexArray.emplace(he++,Q,ne)}}}function tf(U,y){const I=U.add(y)._unit();return U.x*I.x+U.y*I.y}function B_(U,y,I,G){const Q=y.sub(U)._perp()._unit(),ne=I.sub(y)._perp()._unit();return nf(U,y,I,tf(Q,ne),G)}function nf(U,y,I,G,Q){const ne=Math.sqrt(1-G*G);return Math.min(U.dist(y)/3,y.dist(I)/3,Q*ne/G)}function rf(U,y,I){return U.x<I[0].x&&y.x<I[0].x||U.x>I[1].x&&y.x>I[1].x||U.y<I[0].y&&y.y<I[0].y||U.y>I[1].y&&y.y>I[1].y}function of(U,y,I){if(U.x<0||U.x>=Hn||y.x<0||y.x>=Hn||I.x<0||I.x>=Hn)return!1;const G=I.sub(y),Q=G.perp(),ne=U.sub(y);return(G.x*ne.x+G.y*ne.y)/Math.sqrt((G.x*G.x+G.y*G.y)*(ne.x*ne.x+ne.y*ne.y))>-.866&&Q.x*ne.x+Q.y*ne.y<0}function sf(U,y,I){const G=y?2|U:-3&U;return I?1|G:-2&G}function af(){const U=Math.PI/32,y=Math.tan(U),I=Jh;return I*Math.sqrt(1+2*y*y)-I}function lf(U,y,I){const G=1<<I.z,Q=so(I.x/G),ne=so((I.x+1)/G),he=wi(I.y/G),ge=wi((I.y+1)/G);return function(we,Ee,ke,De,Oe=0,Ne){const Ge=[];if(!we.length||!ke||!De)return Ge;const We=(mt,$t)=>{for(const Ft of mt)Ge.push({polygon:Ft,bounds:$t})},Je=Math.ceil(Math.log2(ke)),st=Math.ceil(Math.log2(De)),pt=Je-st,ct=[];for(let mt=0;mt<Math.abs(pt);mt++)ct.push(pt>0?0:1);for(let mt=0;mt<Math.min(Je,st);mt++)ct.push(0),ct.push(1);let ht=we;if(ht=sh(ht,Ee[0].y-Oe,Ee[1].y+Oe,1),ht=sh(ht,Ee[0].x-Oe,Ee[1].x+Oe,0),!ht.length)return Ge;const bt=[];for(ct.length?bt.push({polygons:ht,bounds:Ee,depth:0}):We(ht,Ee);bt.length;){const mt=bt.pop(),$t=mt.depth,Ft=ct[$t],Ht=mt.bounds[0],pn=mt.bounds[1],Nt=Ft===0?Ht.x:Ht.y,Kt=Ft===0?pn.x:pn.y,nn=Ne?Ne(Ft,Nt,Kt):.5*(Nt+Kt),Yt=sh(mt.polygons,Nt-Oe,nn+Oe,Ft),hn=sh(mt.polygons,nn-Oe,Kt+Oe,Ft);if(Yt.length){const rn=[Ht,new ze(Ft===0?nn:pn.x,Ft===1?nn:pn.y)];ct.length>$t+1?bt.push({polygons:Yt,bounds:rn,depth:$t+1}):We(Yt,rn)}if(hn.length){const rn=[new ze(Ft===0?nn:Ht.x,Ft===1?nn:Ht.y),pn];ct.length>$t+1?bt.push({polygons:hn,bounds:rn,depth:$t+1}):We(hn,rn)}}return Ge}(U,y,Math.ceil((ne-Q)/11.25),Math.ceil((he-ge)/11.25),1,(we,Ee,ke)=>{if(we===0)return .5*(Ee+ke);{const De=wi((I.y+Ee/Hn)/G);return(ts(.5*(wi((I.y+ke/Hn)/G)+De))*G-I.y)*Hn}})}Pn(Lc,"FillExtrusionBucket",{omit:["layers","features"]}),Pn(ef,"PartMetadata");const O_=new Xt({"fill-extrusion-edge-radius":new _t(Zt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var F_={paint:new Xt({"fill-extrusion-opacity":new _t(Zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(Zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(Zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bt(Zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(Zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new _t(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new _t(Zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:O_};function cf(U,y,I){var G=2*Math.PI*6378137/256/Math.pow(2,I);return[U*G-2*Math.PI*6378137/2,y*G-2*Math.PI*6378137/2]}class ah{constructor(y,I,G){this.z=y,this.x=I,this.y=G,this.key=Bc(0,y,y,I,G)}equals(y){return this.z===y.z&&this.x===y.x&&this.y===y.y}url(y,I){const G=function(ne,he,ge){var we=cf(256*ne,256*(he=Math.pow(2,ge)-he-1),ge),Ee=cf(256*(ne+1),256*(he+1),ge);return we[0]+","+we[1]+","+Ee[0]+","+Ee[1]}(this.x,this.y,this.z),Q=function(ne,he,ge){let we,Ee="";for(let ke=ne;ke>0;ke--)we=1<<ke-1,Ee+=(he&we?1:0)+(ge&we?2:0);return Ee}(this.z,this.x,this.y);return y[(this.x+this.y)%y.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(I==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",Q).replace("{bbox-epsg-3857}",G)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uf{constructor(y,I){this.wrap=y,this.canonical=I,this.key=Bc(y,I.z,I.z,I.x,I.y)}}class zi{constructor(y,I,G,Q,ne){this.overscaledZ=y,this.wrap=I,this.canonical=new ah(G,+Q,+ne),this.key=I===0&&y===G?this.canonical.key:Bc(I,y,G,Q,ne)}equals(y){return this.overscaledZ===y.overscaledZ&&this.wrap===y.wrap&&this.canonical.equals(y.canonical)}scaledTo(y){const I=this.canonical.z-y;return y>this.canonical.z?new zi(y,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zi(y,this.wrap,y,this.canonical.x>>I,this.canonical.y>>I)}calculateScaledKey(y,I=!0){if(this.overscaledZ===y&&I)return this.key;if(y>this.canonical.z)return Bc(this.wrap*+I,y,this.canonical.z,this.canonical.x,this.canonical.y);{const G=this.canonical.z-y;return Bc(this.wrap*+I,y,y,this.canonical.x>>G,this.canonical.y>>G)}}isChildOf(y){if(y.wrap!==this.wrap)return!1;const I=this.canonical.z-y.canonical.z;return y.overscaledZ===0||y.overscaledZ<this.overscaledZ&&y.canonical.x===this.canonical.x>>I&&y.canonical.y===this.canonical.y>>I}children(y){if(this.overscaledZ>=y)return[new zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const I=this.canonical.z+1,G=2*this.canonical.x,Q=2*this.canonical.y;return[new zi(I,this.wrap,I,G,Q),new zi(I,this.wrap,I,G+1,Q),new zi(I,this.wrap,I,G,Q+1),new zi(I,this.wrap,I,G+1,Q+1)]}isLessThan(y){return this.wrap<y.wrap||!(this.wrap>y.wrap)&&(this.overscaledZ<y.overscaledZ||!(this.overscaledZ>y.overscaledZ)&&(this.canonical.x<y.canonical.x||!(this.canonical.x>y.canonical.x)&&this.canonical.y<y.canonical.y))}wrapped(){return new zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(y){return new zi(this.overscaledZ,y,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Bc(U,y,I,G,Q){const ne=1<<Math.min(I,22);let he=ne*(Q%ne)+G%ne;return U&&I<22&&(he+=ne*ne*((U<0?-2*U-1:2*U)%(1<<2*(22-I)))),16*(32*he+I)+(y-I)}function Oc(U,y){return U.x*y.x+U.y*y.y}function hf(U,y){if(U.length===1){let I=0;const G=y[I++];let Q;for(;!Q||G.equals(Q);)if(Q=y[I++],!Q)return 1/0;for(;I<y.length;I++){const ne=y[I],he=U[0],ge=Q.sub(G),we=ne.sub(G),Ee=he.sub(G),ke=Oc(ge,ge),De=Oc(ge,we),Oe=Oc(we,we),Ne=Oc(Ee,ge),Ge=Oc(Ee,we),We=ke*Oe-De*De,Je=(Oe*Ne-De*Ge)/We,st=(ke*Ge-De*Ne)/We,pt=G.z*(1-Je-st)+Q.z*Je+ne.z*st;if(isFinite(pt))return pt}return 1/0}{let I=1/0;for(const G of y)I=Math.min(I,G.z);return I}}function lh(U){const y=new ze(U[0],U[1]);return y.z=U[2],y}function df(U,y,I,G,Q,ne,he,ge){const we=he*Q.getElevationAt(U,y,!0,!0),Ee=ne[0]!==0,ke=Ee?ne[1]===0?he*(ne[0]/7-450):he*function(De,Oe,Ne){const Ge=Math.floor(Oe[0]/8),We=Math.floor(Oe[1]/8),Je=10*(Oe[0]-8*Ge),st=10*(Oe[1]-8*We),pt=De.getElevationAt(Ge,We,!0,!0),ct=De.getMeterToDEM(Ne),ht=Math.floor(.5*(Je*ct-1)),bt=Math.floor(.5*(st*ct-1)),mt=De.tileCoordToPixel(Ge,We),$t=2*ht+1,Ft=2*bt+1,Ht=function(hn,rn,En,nr,or){return[hn.getElevationAtPixel(rn,En,!0),hn.getElevationAtPixel(rn+or,En,!0),hn.getElevationAtPixel(rn,En+or,!0),hn.getElevationAtPixel(rn+nr,En+or,!0)]}(De,mt.x-ht,mt.y-bt,$t,Ft),pn=Math.abs(Ht[0]-Ht[1]),Nt=Math.abs(Ht[2]-Ht[3]),Kt=Math.abs(Ht[0]-Ht[2])+Math.abs(Ht[1]-Ht[3]),nn=Math.min(.25,.5*ct*(pn+Nt)/$t),Yt=Math.min(.25,.5*ct*Kt/Ft);return pt+Math.max(nn*Je,Yt*st)}(Q,ne,ge):we;return{base:we+(I===0)?-1:I,top:Ee?Math.max(ke+G,we+I+2):we+G}}Pn(ah,"CanonicalTileID"),Pn(zi,"OverscaledTileID",{omit:["projMatrix"]});const U_=Jt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$_}=U_,N_=Jt([{name:"a_packed",components:4,type:"Float32"}]),{members:j_}=N_,V_=xa.VectorTileFeature.types,G_=Math.cos(Math.PI/180*37.5);class ch{constructor(y){this.zoom=y.zoom,this.overscaling=y.overscaling,this.layers=y.layers,this.layerIds=this.layers.map(I=>I.id),this.index=y.index,this.projection=y.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(I=>{this.gradients[I.id]={}}),this.layoutVertexArray=new Wn,this.layoutVertexArray2=new fr,this.indexArray=new cr,this.programConfigurations=new fa(y.layers,y.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id)}populate(y,I,G,Q){this.hasPattern=wd("line",this.layers,I);const ne=this.layers[0].layout.get("line-sort-key"),he=[];for(const{feature:ke,id:De,index:Oe,sourceLayerIndex:Ne}of y){const Ge=this.layers[0]._featureFilter.needGeometry,We=ma(ke,Ge);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom),We,G))continue;const Je=ne?ne.evaluate(We,{},G):void 0,st={id:De,properties:ke.properties,type:ke.type,sourceLayerIndex:Ne,index:Oe,geometry:Ge?We.geometry:ns(ke,G,Q),patterns:{},sortKey:Je};he.push(st)}ne&&he.sort((ke,De)=>ke.sortKey-De.sortKey);const{lineAtlas:ge,featureIndex:we}=I,Ee=this.addConstantDashes(ge);for(const ke of he){const{geometry:De,index:Oe,sourceLayerIndex:Ne}=ke;if(Ee&&this.addFeatureDashes(ke,ge),this.hasPattern){const Ge=Td("line",this.layers,ke,this.zoom,I);this.patternFeatures.push(Ge)}else this.addFeature(ke,De,Oe,G,ge.positions,I.availableImages);we.insert(y[Oe].feature,De,Oe,Ne,this.index)}}addConstantDashes(y){let I=!1;for(const G of this.layers){const Q=G.paint.get("line-dasharray").value,ne=G.layout.get("line-cap").value;if(Q.kind!=="constant"||ne.kind!=="constant")I=!0;else{const he=ne.value,ge=Q.value;if(!ge)continue;y.addDash(ge.from,he),y.addDash(ge.to,he),ge.other&&y.addDash(ge.other,he)}}return I}addFeatureDashes(y,I){const G=this.zoom;for(const Q of this.layers){const ne=Q.paint.get("line-dasharray").value,he=Q.layout.get("line-cap").value;if(ne.kind==="constant"&&he.kind==="constant")continue;let ge,we,Ee,ke,De,Oe;if(ne.kind==="constant"){const Je=ne.value;if(!Je)continue;ge=Je.other||Je.to,we=Je.to,Ee=Je.from}else ge=ne.evaluate({zoom:G-1},y),we=ne.evaluate({zoom:G},y),Ee=ne.evaluate({zoom:G+1},y);he.kind==="constant"?ke=De=Oe=he.value:(ke=he.evaluate({zoom:G-1},y),De=he.evaluate({zoom:G},y),Oe=he.evaluate({zoom:G+1},y)),I.addDash(ge,ke),I.addDash(we,De),I.addDash(Ee,Oe);const Ne=I.getKey(ge,ke),Ge=I.getKey(we,De),We=I.getKey(Ee,Oe);y.patterns[Q.id]={min:Ne,mid:Ge,max:We}}}update(y,I,G,Q){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(y,I,this.stateDependentLayers,G,Q)}addFeatures(y,I,G,Q,ne){for(const he of this.patternFeatures)this.addFeature(he,he.geometry,he.index,I,G,Q)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(y){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=y.createVertexBuffer(this.layoutVertexArray2,j_)),this.layoutVertexBuffer=y.createVertexBuffer(this.layoutVertexArray,$_),this.indexBuffer=y.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(y),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(y){if(y.properties&&y.properties.hasOwnProperty("mapbox_clip_start")&&y.properties.hasOwnProperty("mapbox_clip_end"))return{start:+y.properties.mapbox_clip_start,end:+y.properties.mapbox_clip_end}}addFeature(y,I,G,Q,ne,he){const ge=this.layers[0].layout,we=ge.get("line-join").evaluate(y,{}),Ee=ge.get("line-cap").evaluate(y,{}),ke=ge.get("line-miter-limit"),De=ge.get("line-round-limit");this.lineClips=this.lineFeatureClips(y);for(const Oe of I)this.addLine(Oe,y,we,Ee,ke,De);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,y,G,ne,he,Q)}addLine(y,I,G,Q,ne,he){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let st=0;st<y.length-1;st++)this.totalDistance+=y[st].dist(y[st+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const ge=V_[I.type]==="Polygon";let we=y.length;for(;we>=2&&y[we-1].equals(y[we-2]);)we--;let Ee=0;for(;Ee<we-1&&y[Ee].equals(y[Ee+1]);)Ee++;if(we<(ge?3:2))return;G==="bevel"&&(ne=1.05);const ke=this.overscaling<=16?122880/(512*this.overscaling):0,De=this.segments.prepareSegment(10*we,this.layoutVertexArray,this.indexArray);let Oe,Ne,Ge,We,Je;this.e1=this.e2=-1,ge&&(Oe=y[we-2],Je=y[Ee].sub(Oe)._unit()._perp());for(let st=Ee;st<we;st++){if(Ge=st===we-1?ge?y[Ee+1]:void 0:y[st+1],Ge&&y[st].equals(Ge))continue;Je&&(We=Je),Oe&&(Ne=Oe),Oe=y[st],Je=Ge?Ge.sub(Oe)._unit()._perp():We,We=We||Je;let pt=We.add(Je);pt.x===0&&pt.y===0||pt._unit();const ct=We.x*Je.x+We.y*Je.y,ht=pt.x*Je.x+pt.y*Je.y,bt=ht!==0?1/ht:1/0,mt=2*Math.sqrt(2-2*ht),$t=ht<G_&&Ne&&Ge,Ft=We.x*Je.y-We.y*Je.x>0;if($t&&st>Ee){const Nt=Oe.dist(Ne);if(Nt>2*ke){const Kt=Oe.sub(Oe.sub(Ne)._mult(ke/Nt)._round());this.updateDistance(Ne,Kt),this.addCurrentVertex(Kt,We,0,0,De),Ne=Kt}}const Ht=Ne&&Ge;let pn=Ht?G:ge?"butt":Q;if(Ht&&pn==="round"&&(bt<he?pn="miter":bt<=2&&(pn="fakeround")),pn==="miter"&&bt>ne&&(pn="bevel"),pn==="bevel"&&(bt>2&&(pn="flipbevel"),bt<ne&&(pn="miter")),Ne&&this.updateDistance(Ne,Oe),pn==="miter")pt._mult(bt),this.addCurrentVertex(Oe,pt,0,0,De);else if(pn==="flipbevel"){if(bt>100)pt=Je.mult(-1);else{const Nt=bt*We.add(Je).mag()/We.sub(Je).mag();pt._perp()._mult(Nt*(Ft?-1:1))}this.addCurrentVertex(Oe,pt,0,0,De),this.addCurrentVertex(Oe,pt.mult(-1),0,0,De)}else if(pn==="bevel"||pn==="fakeround"){const Nt=-Math.sqrt(bt*bt-1),Kt=Ft?Nt:0,nn=Ft?0:Nt;if(Ne&&this.addCurrentVertex(Oe,We,Kt,nn,De),pn==="fakeround"){const Yt=Math.round(180*mt/Math.PI/20);for(let hn=1;hn<Yt;hn++){let rn=hn/Yt;if(rn!==.5){const nr=rn-.5;rn+=rn*nr*(rn-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*nr*nr+(.848013+ct*(.215638*ct-1.06021)))}const En=Je.sub(We)._mult(rn)._add(We)._unit()._mult(Ft?-1:1);this.addHalfVertex(Oe,En.x,En.y,!1,Ft,0,De)}}Ge&&this.addCurrentVertex(Oe,Je,-Kt,-nn,De)}else if(pn==="butt")this.addCurrentVertex(Oe,pt,0,0,De);else if(pn==="square"){const Nt=Ne?1:-1;Ne||this.addCurrentVertex(Oe,pt,Nt,Nt,De),this.addCurrentVertex(Oe,pt,0,0,De),Ne&&this.addCurrentVertex(Oe,pt,Nt,Nt,De)}else pn==="round"&&(Ne&&(this.addCurrentVertex(Oe,We,0,0,De),this.addCurrentVertex(Oe,We,1,1,De,!0)),Ge&&(this.addCurrentVertex(Oe,Je,-1,-1,De,!0),this.addCurrentVertex(Oe,Je,0,0,De)));if($t&&st<we-1){const Nt=Oe.dist(Ge);if(Nt>2*ke){const Kt=Oe.add(Ge.sub(Oe)._mult(ke/Nt)._round());this.updateDistance(Oe,Kt),this.addCurrentVertex(Kt,Je,0,0,De),Oe=Kt}}}}addCurrentVertex(y,I,G,Q,ne,he=!1){const ge=I.y*Q-I.x,we=-I.y-I.x*Q;this.addHalfVertex(y,I.x+I.y*G,I.y-I.x*G,he,!1,G,ne),this.addHalfVertex(y,ge,we,he,!0,-Q,ne)}addHalfVertex({x:y,y:I},G,Q,ne,he,ge,we){this.layoutVertexArray.emplaceBack((y<<1)+(ne?1:0),(I<<1)+(he?1:0),Math.round(63*G)+128,Math.round(63*Q)+128,1+(ge===0?0:ge<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const Ee=we.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ee),we.primitiveLength++),he?this.e2=Ee:this.e1=Ee}updateScaledDistance(){if(this.lineClips){const y=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=y*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(y,I){this.distance+=y.dist(I),this.updateScaledDistance()}}Pn(ch,"LineBucket",{omit:["layers","patternFeatures"]});const q_=new Xt({"line-cap":new St(Zt.layout_line["line-cap"]),"line-join":new St(Zt.layout_line["line-join"]),"line-miter-limit":new _t(Zt.layout_line["line-miter-limit"]),"line-round-limit":new _t(Zt.layout_line["line-round-limit"]),"line-sort-key":new St(Zt.layout_line["line-sort-key"])});var pf={paint:new Xt({"line-opacity":new St(Zt.paint_line["line-opacity"]),"line-color":new St(Zt.paint_line["line-color"]),"line-translate":new _t(Zt.paint_line["line-translate"]),"line-translate-anchor":new _t(Zt.paint_line["line-translate-anchor"]),"line-width":new St(Zt.paint_line["line-width"]),"line-gap-width":new St(Zt.paint_line["line-gap-width"]),"line-offset":new St(Zt.paint_line["line-offset"]),"line-blur":new St(Zt.paint_line["line-blur"]),"line-dasharray":new Bt(Zt.paint_line["line-dasharray"]),"line-pattern":new Bt(Zt.paint_line["line-pattern"]),"line-gradient":new Rt(Zt.paint_line["line-gradient"]),"line-trim-offset":new _t(Zt.paint_line["line-trim-offset"])}),layout:q_};const ff=new class extends St{possiblyEvaluate(U,y){return y=new tt(Math.floor(y.zoom),{now:y.now,fadeDuration:y.fadeDuration,zoomHistory:y.zoomHistory,transition:y.transition}),super.possiblyEvaluate(U,y)}evaluate(U,y,I,G){return y=Ut({},y,{zoom:Math.floor(y.zoom)}),super.evaluate(U,y,I,G)}}(pf.paint.properties["line-width"].specification);function mf(U,y){return y>0?y+2*U:U}ff.useIntegerZoom=!0;const Z_=Jt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),H_=Jt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),W_=Jt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Jt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const X_=Jt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),K_=Jt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Jt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _f=Jt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Y_=Jt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Jt([{name:"triangle",components:3,type:"Uint16"}]),Jt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Jt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Jt([{type:"Float32",name:"offsetX"}]),Jt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ti=24;const Oo=128;function Ed(U,y){const{expression:I}=y;if(I.kind==="constant")return{kind:"constant",layoutSize:I.evaluate(new tt(U+1))};if(I.kind==="source")return{kind:"source"};{const{zoomStops:G,interpolationType:Q}=I;let ne=0;for(;ne<G.length&&G[ne]<=U;)ne++;ne=Math.max(0,ne-1);let he=ne;for(;he<G.length&&G[he]<U+1;)he++;he=Math.min(G.length-1,he);const ge=G[ne],we=G[he];return I.kind==="composite"?{kind:"composite",minZoom:ge,maxZoom:we,interpolationType:Q}:{kind:"camera",minZoom:ge,maxZoom:we,minSize:I.evaluate(new tt(ge)),maxSize:I.evaluate(new tt(we)),interpolationType:Q}}}function uh(U,{uSize:y,uSizeT:I},{lowerSize:G,upperSize:Q}){return U.kind==="source"?G/Oo:U.kind==="composite"?wr(G/Oo,Q/Oo,I):y}function ml(U,y){let I=0,G=0;if(U.kind==="constant")G=U.layoutSize;else if(U.kind!=="source"){const{interpolationType:Q,minZoom:ne,maxZoom:he}=U,ge=Q?Mt(io.interpolationFactor(Q,y,ne,he),0,1):0;U.kind==="camera"?G=wr(U.minSize,U.maxSize,ge):I=ge}return{uSizeT:I,uSize:G}}var J_=Object.freeze({__proto__:null,getSizeData:Ed,evaluateSizeForFeature:uh,evaluateSizeForZoom:ml,SIZE_PACK_FACTOR:Oo});function Q_(U,y,I){return U.sections.forEach(G=>{G.text=function(Q,ne,he){const ge=ne.layout.get("text-transform").evaluate(he,{});return ge==="uppercase"?Q=Q.toLocaleUpperCase():ge==="lowercase"&&(Q=Q.toLocaleLowerCase()),et.applyArabicShaping&&(Q=et.applyArabicShaping(Q)),Q}(G.text,y,I)}),U}const Fc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function eg(U){return U==="\uFE36"||U==="\uFE48"||U==="\uFE38"||U==="\uFE44"||U==="\uFE42"||U==="\uFE3E"||U==="\uFE3C"||U==="\uFE3A"||U==="\uFE18"||U==="\uFE40"||U==="\uFE10"||U==="\uFE13"||U==="\uFE14"||U==="\uFF40"||U==="\uFFE3"||U==="\uFE11"||U==="\uFE12"}function tg(U){return U==="\uFE35"||U==="\uFE47"||U==="\uFE37"||U==="\uFE43"||U==="\uFE41"||U==="\uFE3D"||U==="\uFE3B"||U==="\uFE39"||U==="\uFE17"||U==="\uFE3F"}var gf=function(U,y,I,G,Q){var ne,he,ge=8*Q-G-1,we=(1<<ge)-1,Ee=we>>1,ke=-7,De=I?Q-1:0,Oe=I?-1:1,Ne=U[y+De];for(De+=Oe,ne=Ne&(1<<-ke)-1,Ne>>=-ke,ke+=ge;ke>0;ne=256*ne+U[y+De],De+=Oe,ke-=8);for(he=ne&(1<<-ke)-1,ne>>=-ke,ke+=G;ke>0;he=256*he+U[y+De],De+=Oe,ke-=8);if(ne===0)ne=1-Ee;else{if(ne===we)return he?NaN:1/0*(Ne?-1:1);he+=Math.pow(2,G),ne-=Ee}return(Ne?-1:1)*he*Math.pow(2,ne-G)},yf=function(U,y,I,G,Q,ne){var he,ge,we,Ee=8*ne-Q-1,ke=(1<<Ee)-1,De=ke>>1,Oe=Q===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ne=G?0:ne-1,Ge=G?1:-1,We=y<0||y===0&&1/y<0?1:0;for(y=Math.abs(y),isNaN(y)||y===1/0?(ge=isNaN(y)?1:0,he=ke):(he=Math.floor(Math.log(y)/Math.LN2),y*(we=Math.pow(2,-he))<1&&(he--,we*=2),(y+=he+De>=1?Oe/we:Oe*Math.pow(2,1-De))*we>=2&&(he++,we/=2),he+De>=ke?(ge=0,he=ke):he+De>=1?(ge=(y*we-1)*Math.pow(2,Q),he+=De):(ge=y*Math.pow(2,De-1)*Math.pow(2,Q),he=0));Q>=8;U[I+Ne]=255&ge,Ne+=Ge,ge/=256,Q-=8);for(he=he<<Q|ge,Ee+=Q;Ee>0;U[I+Ne]=255&he,Ne+=Ge,he/=256,Ee-=8);U[I+Ne-Ge]|=128*We},Uc=$r;function $r(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}$r.Varint=0,$r.Fixed64=1,$r.Bytes=2,$r.Fixed32=5;var Ad=4294967296,vf=1/Ad,xf=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function is(U){return U.type===$r.Bytes?U.readVarint()+U.pos:U.pos+1}function _l(U,y,I){return I?4294967296*y+(U>>>0):4294967296*(y>>>0)+(U>>>0)}function bf(U,y,I){var G=y<=16383?1:y<=2097151?2:y<=268435455?3:Math.floor(Math.log(y)/(7*Math.LN2));I.realloc(G);for(var Q=I.pos-1;Q>=U;Q--)I.buf[Q+G]=I.buf[Q]}function ng(U,y){for(var I=0;I<U.length;I++)y.writeVarint(U[I])}function rg(U,y){for(var I=0;I<U.length;I++)y.writeSVarint(U[I])}function ig(U,y){for(var I=0;I<U.length;I++)y.writeFloat(U[I])}function og(U,y){for(var I=0;I<U.length;I++)y.writeDouble(U[I])}function sg(U,y){for(var I=0;I<U.length;I++)y.writeBoolean(U[I])}function ag(U,y){for(var I=0;I<U.length;I++)y.writeFixed32(U[I])}function lg(U,y){for(var I=0;I<U.length;I++)y.writeSFixed32(U[I])}function cg(U,y){for(var I=0;I<U.length;I++)y.writeFixed64(U[I])}function ug(U,y){for(var I=0;I<U.length;I++)y.writeSFixed64(U[I])}function hh(U,y){return(U[y]|U[y+1]<<8|U[y+2]<<16)+16777216*U[y+3]}function gl(U,y,I){U[I]=y,U[I+1]=y>>>8,U[I+2]=y>>>16,U[I+3]=y>>>24}function wf(U,y){return(U[y]|U[y+1]<<8|U[y+2]<<16)+(U[y+3]<<24)}function hg(U,y,I){y.glyphs=[],U===1&&I.readMessage(dg,y)}function dg(U,y,I){if(U===3){const{id:G,bitmap:Q,width:ne,height:he,left:ge,top:we,advance:Ee}=I.readMessage(pg,{});y.glyphs.push({id:G,bitmap:new rs({width:ne+6,height:he+6},Q),metrics:{width:ne,height:he,left:ge,top:we,advance:Ee}})}else U===4?y.ascender=I.readSVarint():U===5&&(y.descender=I.readSVarint())}function pg(U,y,I){U===1?y.id=I.readVarint():U===2?y.bitmap=I.readBytes():U===3?y.width=I.readVarint():U===4?y.height=I.readVarint():U===5?y.left=I.readSVarint():U===6?y.top=I.readSVarint():U===7&&(y.advance=I.readVarint())}function Sd(U){let y=0,I=0;for(const he of U)y+=he.w*he.h,I=Math.max(I,he.w);U.sort((he,ge)=>ge.h-he.h);const G=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(y/.95)),I),h:1/0}];let Q=0,ne=0;for(const he of U)for(let ge=G.length-1;ge>=0;ge--){const we=G[ge];if(!(he.w>we.w||he.h>we.h)){if(he.x=we.x,he.y=we.y,ne=Math.max(ne,he.y+he.h),Q=Math.max(Q,he.x+he.w),he.w===we.w&&he.h===we.h){const Ee=G.pop();ge<G.length&&(G[ge]=Ee)}else he.h===we.h?(we.x+=he.w,we.w-=he.w):he.w===we.w?(we.y+=he.h,we.h-=he.h):(G.push({x:we.x+he.w,y:we.y,w:we.w-he.w,h:he.h}),we.y+=he.h,we.h-=he.h);break}}return{w:Q,h:ne,fill:y/(Q*ne)||0}}$r.prototype={destroy:function(){this.buf=null},readFields:function(U,y,I){for(I=I||this.length;this.pos<I;){var G=this.readVarint(),Q=G>>3,ne=this.pos;this.type=7&G,U(Q,y,this),this.pos===ne&&this.skip(G)}return y},readMessage:function(U,y){return this.readFields(U,y,this.readVarint()+this.pos)},readFixed32:function(){var U=hh(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=wf(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=hh(this.buf,this.pos)+hh(this.buf,this.pos+4)*Ad;return this.pos+=8,U},readSFixed64:function(){var U=hh(this.buf,this.pos)+wf(this.buf,this.pos+4)*Ad;return this.pos+=8,U},readFloat:function(){var U=gf(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=gf(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var y,I,G=this.buf;return y=127&(I=G[this.pos++]),I<128?y:(y|=(127&(I=G[this.pos++]))<<7,I<128?y:(y|=(127&(I=G[this.pos++]))<<14,I<128?y:(y|=(127&(I=G[this.pos++]))<<21,I<128?y:function(Q,ne,he){var ge,we,Ee=he.buf;if(ge=(112&(we=Ee[he.pos++]))>>4,we<128||(ge|=(127&(we=Ee[he.pos++]))<<3,we<128)||(ge|=(127&(we=Ee[he.pos++]))<<10,we<128)||(ge|=(127&(we=Ee[he.pos++]))<<17,we<128)||(ge|=(127&(we=Ee[he.pos++]))<<24,we<128)||(ge|=(1&(we=Ee[he.pos++]))<<31,we<128))return _l(Q,ge,ne);throw new Error("Expected varint not more than 10 bytes")}(y|=(15&(I=G[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var U=this.readVarint()+this.pos,y=this.pos;return this.pos=U,U-y>=12&&xf?function(I,G,Q){return xf.decode(I.subarray(G,Q))}(this.buf,y,U):function(I,G,Q){for(var ne="",he=G;he<Q;){var ge,we,Ee,ke=I[he],De=null,Oe=ke>239?4:ke>223?3:ke>191?2:1;if(he+Oe>Q)break;Oe===1?ke<128&&(De=ke):Oe===2?(192&(ge=I[he+1]))==128&&(De=(31&ke)<<6|63&ge)<=127&&(De=null):Oe===3?(we=I[he+2],(192&(ge=I[he+1]))==128&&(192&we)==128&&((De=(15&ke)<<12|(63&ge)<<6|63&we)<=2047||De>=55296&&De<=57343)&&(De=null)):Oe===4&&(we=I[he+2],Ee=I[he+3],(192&(ge=I[he+1]))==128&&(192&we)==128&&(192&Ee)==128&&((De=(15&ke)<<18|(63&ge)<<12|(63&we)<<6|63&Ee)<=65535||De>=1114112)&&(De=null)),De===null?(De=65533,Oe=1):De>65535&&(De-=65536,ne+=String.fromCharCode(De>>>10&1023|55296),De=56320|1023&De),ne+=String.fromCharCode(De),he+=Oe}return ne}(this.buf,y,U)},readBytes:function(){var U=this.readVarint()+this.pos,y=this.buf.subarray(this.pos,U);return this.pos=U,y},readPackedVarint:function(U,y){if(this.type!==$r.Bytes)return U.push(this.readVarint(y));var I=is(this);for(U=U||[];this.pos<I;)U.push(this.readVarint(y));return U},readPackedSVarint:function(U){if(this.type!==$r.Bytes)return U.push(this.readSVarint());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==$r.Bytes)return U.push(this.readBoolean());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==$r.Bytes)return U.push(this.readFloat());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==$r.Bytes)return U.push(this.readDouble());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==$r.Bytes)return U.push(this.readFixed32());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==$r.Bytes)return U.push(this.readSFixed32());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==$r.Bytes)return U.push(this.readFixed64());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==$r.Bytes)return U.push(this.readSFixed64());var y=is(this);for(U=U||[];this.pos<y;)U.push(this.readSFixed64());return U},skip:function(U){var y=7&U;if(y===$r.Varint)for(;this.buf[this.pos++]>127;);else if(y===$r.Bytes)this.pos=this.readVarint()+this.pos;else if(y===$r.Fixed32)this.pos+=4;else{if(y!==$r.Fixed64)throw new Error("Unimplemented type: "+y);this.pos+=8}},writeTag:function(U,y){this.writeVarint(U<<3|y)},realloc:function(U){for(var y=this.length||16;y<this.pos+U;)y*=2;if(y!==this.length){var I=new Uint8Array(y);I.set(this.buf),this.buf=I,this.length=y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),gl(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),gl(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),gl(this.buf,-1&U,this.pos),gl(this.buf,Math.floor(U*vf),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),gl(this.buf,-1&U,this.pos),gl(this.buf,Math.floor(U*vf),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(y,I){var G,Q;if(y>=0?(G=y%4294967296|0,Q=y/4294967296|0):(Q=~(-y/4294967296),4294967295^(G=~(-y%4294967296))?G=G+1|0:(G=0,Q=Q+1|0)),y>=18446744073709552e3||y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");I.realloc(10),function(ne,he,ge){ge.buf[ge.pos++]=127&ne|128,ne>>>=7,ge.buf[ge.pos++]=127&ne|128,ne>>>=7,ge.buf[ge.pos++]=127&ne|128,ne>>>=7,ge.buf[ge.pos++]=127&ne|128,ge.buf[ge.pos]=127&(ne>>>=7)}(G,0,I),function(ne,he){var ge=(7&ne)<<4;he.buf[he.pos++]|=ge|((ne>>>=3)?128:0),ne&&(he.buf[he.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(he.buf[he.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(he.buf[he.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(he.buf[he.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(he.buf[he.pos++]=127&ne)))))}(Q,I)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(Boolean(U))},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var y=this.pos;this.pos=function(G,Q,ne){for(var he,ge,we=0;we<Q.length;we++){if((he=Q.charCodeAt(we))>55295&&he<57344){if(!ge){he>56319||we+1===Q.length?(G[ne++]=239,G[ne++]=191,G[ne++]=189):ge=he;continue}if(he<56320){G[ne++]=239,G[ne++]=191,G[ne++]=189,ge=he;continue}he=ge-55296<<10|he-56320|65536,ge=null}else ge&&(G[ne++]=239,G[ne++]=191,G[ne++]=189,ge=null);he<128?G[ne++]=he:(he<2048?G[ne++]=he>>6|192:(he<65536?G[ne++]=he>>12|224:(G[ne++]=he>>18|240,G[ne++]=he>>12&63|128),G[ne++]=he>>6&63|128),G[ne++]=63&he|128)}return ne}(this.buf,U,this.pos);var I=this.pos-y;I>=128&&bf(y,I,this),this.pos=y-1,this.writeVarint(I),this.pos+=I},writeFloat:function(U){this.realloc(4),yf(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),yf(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var y=U.length;this.writeVarint(y),this.realloc(y);for(var I=0;I<y;I++)this.buf[this.pos++]=U[I]},writeRawMessage:function(U,y){this.pos++;var I=this.pos;U(y,this);var G=this.pos-I;G>=128&&bf(I,G,this),this.pos=I-1,this.writeVarint(G),this.pos+=G},writeMessage:function(U,y,I){this.writeTag(U,$r.Bytes),this.writeRawMessage(y,I)},writePackedVarint:function(U,y){y.length&&this.writeMessage(U,ng,y)},writePackedSVarint:function(U,y){y.length&&this.writeMessage(U,rg,y)},writePackedBoolean:function(U,y){y.length&&this.writeMessage(U,sg,y)},writePackedFloat:function(U,y){y.length&&this.writeMessage(U,ig,y)},writePackedDouble:function(U,y){y.length&&this.writeMessage(U,og,y)},writePackedFixed32:function(U,y){y.length&&this.writeMessage(U,ag,y)},writePackedSFixed32:function(U,y){y.length&&this.writeMessage(U,lg,y)},writePackedFixed64:function(U,y){y.length&&this.writeMessage(U,cg,y)},writePackedSFixed64:function(U,y){y.length&&this.writeMessage(U,ug,y)},writeBytesField:function(U,y){this.writeTag(U,$r.Bytes),this.writeBytes(y)},writeFixed32Field:function(U,y){this.writeTag(U,$r.Fixed32),this.writeFixed32(y)},writeSFixed32Field:function(U,y){this.writeTag(U,$r.Fixed32),this.writeSFixed32(y)},writeFixed64Field:function(U,y){this.writeTag(U,$r.Fixed64),this.writeFixed64(y)},writeSFixed64Field:function(U,y){this.writeTag(U,$r.Fixed64),this.writeSFixed64(y)},writeVarintField:function(U,y){this.writeTag(U,$r.Varint),this.writeVarint(y)},writeSVarintField:function(U,y){this.writeTag(U,$r.Varint),this.writeSVarint(y)},writeStringField:function(U,y){this.writeTag(U,$r.Bytes),this.writeString(y)},writeFloatField:function(U,y){this.writeTag(U,$r.Fixed32),this.writeFloat(y)},writeDoubleField:function(U,y){this.writeTag(U,$r.Fixed64),this.writeDouble(y)},writeBooleanField:function(U,y){this.writeVarintField(U,Boolean(y))}};class Cd{constructor(y,{pixelRatio:I,version:G,stretchX:Q,stretchY:ne,content:he}){this.paddedRect=y,this.pixelRatio=I,this.stretchX=Q,this.stretchY=ne,this.content=he,this.version=G}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Tf{constructor(y,I){const G={},Q={};this.haveRenderCallbacks=[];const ne=[];this.addImages(y,G,ne),this.addImages(I,Q,ne);const{w:he,h:ge}=Sd(ne),we=new Zi({width:he||1,height:ge||1});for(const Ee in y){const ke=y[Ee],De=G[Ee].paddedRect;Zi.copy(ke.data,we,{x:0,y:0},{x:De.x+1,y:De.y+1},ke.data)}for(const Ee in I){const ke=I[Ee],De=Q[Ee].paddedRect,Oe=De.x+1,Ne=De.y+1,Ge=ke.data.width,We=ke.data.height;Zi.copy(ke.data,we,{x:0,y:0},{x:Oe,y:Ne},ke.data),Zi.copy(ke.data,we,{x:0,y:We-1},{x:Oe,y:Ne-1},{width:Ge,height:1}),Zi.copy(ke.data,we,{x:0,y:0},{x:Oe,y:Ne+We},{width:Ge,height:1}),Zi.copy(ke.data,we,{x:Ge-1,y:0},{x:Oe-1,y:Ne},{width:1,height:We}),Zi.copy(ke.data,we,{x:0,y:0},{x:Oe+Ge,y:Ne},{width:1,height:We})}this.image=we,this.iconPositions=G,this.patternPositions=Q}addImages(y,I,G){for(const Q in y){const ne=y[Q],he={x:0,y:0,w:ne.data.width+2,h:ne.data.height+2};G.push(he),I[Q]=new Cd(he,ne),ne.hasRenderCallback&&this.haveRenderCallbacks.push(Q)}}patchUpdatedImages(y,I){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(G=>y.hasImage(G)),y.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const G in y.updatedImages)this.patchUpdatedImage(this.iconPositions[G],y.getImage(G),I),this.patchUpdatedImage(this.patternPositions[G],y.getImage(G),I)}patchUpdatedImage(y,I,G){if(!y||!I||y.version===I.version)return;y.version=I.version;const[Q,ne]=y.tl;G.update(I.data,void 0,{x:Q,y:ne})}}Pn(Cd,"ImagePosition"),Pn(Tf,"ImageAtlas");const no={horizontal:1,vertical:2,horizontalOnly:3};class $c{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(y,I){const G=new $c;return G.scale=y||1,G.fontStack=I,G}static forImage(y){const I=new $c;return I.imageName=y,I}}class yl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(y,I){const G=new yl;for(let Q=0;Q<y.sections.length;Q++){const ne=y.sections[Q];ne.image?G.addImageSection(ne):G.addTextSection(ne,I)}return G}length(){return this.text.length}getSection(y){return this.sections[this.sectionIndex[y]]}getSections(){return this.sections}getSectionIndex(y){return this.sectionIndex[y]}getCharCode(y){return this.text.charCodeAt(y)}verticalizePunctuation(y){this.text=function(I,G){let Q="";for(let ne=0;ne<I.length;ne++){const he=I.charCodeAt(ne+1)||null,ge=I.charCodeAt(ne-1)||null;Q+=!G&&(he&&da(he)&&!Fc[I[ne+1]]||ge&&da(ge)&&!Fc[I[ne-1]])||!Fc[I[ne]]?I[ne]:Fc[I[ne]]}return Q}(this.text,y)}trim(){let y=0;for(let G=0;G<this.text.length&&dh[this.text.charCodeAt(G)];G++)y++;let I=this.text.length;for(let G=this.text.length-1;G>=0&&G>=y&&dh[this.text.charCodeAt(G)];G--)I--;this.text=this.text.substring(y,I),this.sectionIndex=this.sectionIndex.slice(y,I)}substring(y,I){const G=new yl;return G.text=this.text.substring(y,I),G.sectionIndex=this.sectionIndex.slice(y,I),G.sections=this.sections,G}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((y,I)=>Math.max(y,this.sections[I].scale),0)}addTextSection(y,I){this.text+=y.text,this.sections.push($c.forText(y.scale,y.fontStack||I));const G=this.sections.length-1;for(let Q=0;Q<y.text.length;++Q)this.sectionIndex.push(G)}addImageSection(y){const I=y.image?y.image.name:"";if(I.length===0)return void er("Can't add FormattedSection with an empty image.");const G=this.getNextImageSectionCharCode();G?(this.text+=String.fromCharCode(G),this.sections.push($c.forImage(I)),this.sectionIndex.push(this.sections.length-1)):er("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Id(U,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We){const Je=yl.fromFeature(U,Q);let st;De===no.vertical&&Je.verticalizePunctuation(Oe);const{processBidirectionalText:pt,processStyledBidirectionalText:ct}=et;if(pt&&Je.sections.length===1){st=[];const mt=pt(Je.toString(),Md(Je,Ee,ne,y,G,Ne,Ge));for(const $t of mt){const Ft=new yl;Ft.text=$t,Ft.sections=Je.sections;for(let Ht=0;Ht<$t.length;Ht++)Ft.sectionIndex.push(0);st.push(Ft)}}else if(ct){st=[];const mt=ct(Je.text,Je.sectionIndex,Md(Je,Ee,ne,y,G,Ne,Ge));for(const $t of mt){const Ft=new yl;Ft.text=$t[0],Ft.sectionIndex=$t[1],Ft.sections=Je.sections,st.push(Ft)}}else st=function(mt,$t){const Ft=[],Ht=mt.text;let pn=0;for(const Nt of $t)Ft.push(mt.substring(pn,Nt)),pn=Nt;return pn<Ht.length&&Ft.push(mt.substring(pn,Ht.length)),Ft}(Je,Md(Je,Ee,ne,y,G,Ne,Ge));const ht=[],bt={positionedLines:ht,text:Je.toString(),top:ke[1],bottom:ke[1],left:ke[0],right:ke[0],writingMode:De,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(mt,$t,Ft,Ht,pn,Nt,Kt,nn,Yt,hn,rn,En){let nr=0,or=0,Fn=0;const vn=nn==="right"?1:nn==="left"?0:.5;let mr=!1;for(const ar of pn){const Er=ar.getSections();for(const jr of Er){if(jr.imageName)continue;const Fr=$t[jr.fontStack];if(Fr&&(mr=Fr.ascender!==void 0&&Fr.descender!==void 0,!mr))break}if(!mr)break}let Kn=0;for(const ar of pn){ar.trim();const Er=ar.getMaxScale(),jr=(Er-1)*Ti,Fr={positionedGlyphs:[],lineOffset:0};mt.positionedLines[Kn]=Fr;const Lr=Fr.positionedGlyphs;let Zr=0;if(!ar.length()){or+=Nt,++Kn;continue}let Yr=0,fi=0;for(let yr=0;yr<ar.length();yr++){const ti=ar.getSection(yr),Ii=ar.getSectionIndex(yr),Cr=ar.getCharCode(yr);let Jr=ti.scale,Di=null,Xr=null,ri=null,mi=Ti,hi=0;const Ei=!(Yt===no.horizontal||!rn&&!al(Cr)||rn&&(dh[Cr]||(Mn=Cr,Ru(Mn)||zu(Mn)||Du(Mn)||ha(Mn)||wc(Mn))));if(ti.imageName){const Li=Ht[ti.imageName];if(!Li)continue;ri=ti.imageName,mt.iconsInText=mt.iconsInText||!0,Xr=Li.paddedRect;const _i=Li.displaySize;Jr=Jr*Ti/En,Di={width:_i[0],height:_i[1],left:1,top:-3,advance:Ei?_i[1]:_i[0],localGlyph:!1},hi=mr?-Di.height*Jr:Er*Ti-17-_i[1]*Jr,mi=Di.advance;const as=(Ei?_i[0]:_i[1])*Jr-Ti*Er;as>0&&as>Zr&&(Zr=as)}else{const Li=Ft[ti.fontStack];if(!Li)continue;Li[Cr]&&(Xr=Li[Cr]);const _i=$t[ti.fontStack];if(!_i)continue;const as=_i.glyphs[Cr];if(!as)continue;if(Di=as.metrics,mi=Cr!==8203?Ti:0,mr){const Al=_i.ascender!==void 0?Math.abs(_i.ascender):0,Jc=_i.descender!==void 0?Math.abs(_i.descender):0,Qc=(Al+Jc)*Jr;Yr<Qc&&(Yr=Qc,fi=(Al-Jc)/2*Jr),hi=-Al*Jr}else hi=(Er-Jr)*Ti-17}Ei?(mt.verticalizable=!0,Lr.push({glyph:Cr,imageName:ri,x:nr,y:or+hi,vertical:Ei,scale:Jr,localGlyph:Di.localGlyph,fontStack:ti.fontStack,sectionIndex:Ii,metrics:Di,rect:Xr}),nr+=mi*Jr+hn):(Lr.push({glyph:Cr,imageName:ri,x:nr,y:or+hi,vertical:Ei,scale:Jr,localGlyph:Di.localGlyph,fontStack:ti.fontStack,sectionIndex:Ii,metrics:Di,rect:Xr}),nr+=Di.advance*Jr+hn)}Lr.length!==0&&(Fn=Math.max(nr-hn,Fn),mr?If(Lr,vn,Zr,fi,Nt*Er/2):If(Lr,vn,Zr,0,Nt/2)),nr=0;const $i=Nt*Er+Zr;Fr.lineOffset=Math.max(Zr,jr),or+=$i,++Kn}var Mn;const Nr=or,{horizontalAlign:Or,verticalAlign:Wr}=Pd(Kt);(function(ar,Er,jr,Fr,Lr,Zr){const Yr=(Er-jr)*Lr,fi=-Zr*Fr;for(const $i of ar)for(const yr of $i.positionedGlyphs)yr.x+=Yr,yr.y+=fi})(mt.positionedLines,vn,Or,Wr,Fn,Nr),mt.top+=-Wr*Nr,mt.bottom=mt.top+Nr,mt.left+=-Or*Fn,mt.right=mt.left+Fn,mt.hasBaseline=mr}(bt,y,I,G,st,he,ge,we,De,Ee,Oe,We),!function(mt){for(const $t of mt)if($t.positionedGlyphs.length!==0)return!1;return!0}(ht)&&bt}const dh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ef(U,y,I,G,Q,ne){if(y.imageName){const he=G[y.imageName];return he?he.displaySize[0]*y.scale*Ti/ne+Q:0}{const he=I[y.fontStack],ge=he&&he.glyphs[U];return ge?ge.metrics.advance*y.scale+Q:0}}function Af(U,y,I,G){const Q=Math.pow(U-y,2);return G?U<y?Q/2:2*Q:Q+Math.abs(I)*I}function mg(U,y,I){let G=0;return U===10&&(G-=1e4),I&&(G+=150),U!==40&&U!==65288||(G+=50),y!==41&&y!==65289||(G+=50),G}function Sf(U,y,I,G,Q,ne){let he=null,ge=Af(y,I,Q,ne);for(const we of G){const Ee=Af(y-we.x,I,Q,ne)+we.badness;Ee<=ge&&(he=we,ge=Ee)}return{index:U,x:y,priorBreak:he,badness:ge}}function Cf(U){return U?Cf(U.priorBreak).concat(U.index):[]}function Md(U,y,I,G,Q,ne,he){if(ne!=="point")return[];if(!U)return[];const ge=[],we=function(Oe,Ne,Ge,We,Je,st){let pt=0;for(let ct=0;ct<Oe.length();ct++){const ht=Oe.getSection(ct);pt+=Ef(Oe.getCharCode(ct),ht,We,Je,Ne,st)}return pt/Math.max(1,Math.ceil(pt/Ge))}(U,y,I,G,Q,he),Ee=U.text.indexOf("\u200B")>=0;let ke=0;for(let Oe=0;Oe<U.length();Oe++){const Ne=U.getSection(Oe),Ge=U.getCharCode(Oe);if(dh[Ge]||(ke+=Ef(Ge,Ne,G,Q,y,he)),Oe<U.length()-1){const We=!((De=Ge)<11904||!(_c(De)||Ou(De)||bc(De)||Nu(De)||vc(De)||Lu(De)||Fu(De)||il(De)||xc(De)||ua(De)||yc(De)||Tc(De)||mc(De)||ca(De)||Bu(De)||gc(De)||Ho(De)||ju(De)||Uu(De)||ol(De)));(fg[Ge]||We||Ne.imageName)&&ge.push(Sf(Oe+1,ke,we,ge,mg(Ge,U.getCharCode(Oe+1),We&&Ee),!1))}}var De;return Cf(Sf(U.length(),ke,we,ge,0,!0))}function Pd(U){let y=.5,I=.5;switch(U){case"right":case"top-right":case"bottom-right":y=1;break;case"left":case"top-left":case"bottom-left":y=0}switch(U){case"bottom":case"bottom-right":case"bottom-left":I=1;break;case"top":case"top-right":case"top-left":I=0}return{horizontalAlign:y,verticalAlign:I}}function If(U,y,I,G,Q){if(!(y||I||G||Q))return;const ne=U.length-1,he=U[ne],ge=(he.x+he.metrics.advance*he.scale)*y;for(let we=0;we<=ne;we++)U[we].x-=ge,U[we].y+=I+G+Q}function _g(U,y,I){const{horizontalAlign:G,verticalAlign:Q}=Pd(I),ne=y[0]-U.displaySize[0]*G,he=y[1]-U.displaySize[1]*Q;return{image:U,top:he,bottom:he+U.displaySize[1],left:ne,right:ne+U.displaySize[0]}}function Mf(U,y,I,G,Q,ne){const he=U.image;let ge;if(he.content){const Je=he.content,st=he.pixelRatio||1;ge=[Je[0]/st,Je[1]/st,he.displaySize[0]-Je[2]/st,he.displaySize[1]-Je[3]/st]}const we=y.left*ne,Ee=y.right*ne;let ke,De,Oe,Ne;I==="width"||I==="both"?(Ne=Q[0]+we-G[3],De=Q[0]+Ee+G[1]):(Ne=Q[0]+(we+Ee-he.displaySize[0])/2,De=Ne+he.displaySize[0]);const Ge=y.top*ne,We=y.bottom*ne;return I==="height"||I==="both"?(ke=Q[1]+Ge-G[0],Oe=Q[1]+We+G[2]):(ke=Q[1]+(Ge+We-he.displaySize[1])/2,Oe=ke+he.displaySize[1]),{image:he,top:ke,right:De,bottom:Oe,left:Ne,collisionPadding:ge}}class os extends ze{constructor(y,I,G,Q,ne){super(y,I),this.angle=Q,this.z=G,ne!==void 0&&(this.segment=ne)}clone(){return new os(this.x,this.y,this.z,this.angle,this.segment)}}function Pf(U,y,I,G,Q){if(y.segment===void 0)return!0;let ne=y,he=y.segment+1,ge=0;for(;ge>-I/2;){if(he--,he<0)return!1;ge-=U[he].dist(ne),ne=U[he]}ge+=U[he].dist(U[he+1]),he++;const we=[];let Ee=0;for(;ge<I/2;){const ke=U[he],De=U[he+1];if(!De)return!1;let Oe=U[he-1].angleTo(ke)-ke.angleTo(De);for(Oe=Math.abs((Oe+3*Math.PI)%(2*Math.PI)-Math.PI),we.push({distance:ge,angleDelta:Oe}),Ee+=Oe;ge-we[0].distance>G;)Ee-=we.shift().angleDelta;if(Ee>Q)return!1;he++,ge+=ke.dist(De)}return!0}function kf(U){let y=0;for(let I=0;I<U.length-1;I++)y+=U[I].dist(U[I+1]);return y}function Rf(U,y,I){return U?.6*y*I:0}function zf(U,y){return Math.max(U?U.right-U.left:0,y?y.right-y.left:0)}function gg(U,y,I,G,Q,ne){const he=Rf(I,Q,ne),ge=zf(I,G)*ne;let we=0;const Ee=kf(U)/2;for(let ke=0;ke<U.length-1;ke++){const De=U[ke],Oe=U[ke+1],Ne=De.dist(Oe);if(we+Ne>Ee){const Ge=(Ee-we)/Ne,We=wr(De.x,Oe.x,Ge),Je=wr(De.y,Oe.y,Ge),st=new os(We,Je,0,Oe.angleTo(De),ke);return!he||Pf(U,st,ge,he,y)?st:void 0}we+=Ne}}function yg(U,y,I,G,Q,ne,he,ge,we){const Ee=Rf(G,ne,he),ke=zf(G,Q),De=ke*he,Oe=U[0].x===0||U[0].x===we||U[0].y===0||U[0].y===we;return y-De<y/4&&(y=De+y/4),Df(U,Oe?y/2*ge%y:(ke/2+2*ne)*he*ge%y,y,Ee,I,De,Oe,!1,we)}function Df(U,y,I,G,Q,ne,he,ge,we){const Ee=ne/2,ke=kf(U);let De=0,Oe=y-I,Ne=[];for(let Ge=0;Ge<U.length-1;Ge++){const We=U[Ge],Je=U[Ge+1],st=We.dist(Je),pt=Je.angleTo(We);for(;Oe+I<De+st;){Oe+=I;const ct=(Oe-De)/st,ht=wr(We.x,Je.x,ct),bt=wr(We.y,Je.y,ct);if(ht>=0&&ht<we&&bt>=0&&bt<we&&Oe-Ee>=0&&Oe+Ee<=ke){const mt=new os(ht,bt,0,pt,Ge);mt._round(),G&&!Pf(U,mt,ne,G,Q)||Ne.push(mt)}}De+=st}return ge||Ne.length||he||(Ne=Df(U,De/2,I,G,Q,ne,he,!0,we)),Ne}function Lf(U,y,I,G,Q){const ne=[];for(let he=0;he<U.length;he++){const ge=U[he];let we;for(let Ee=0;Ee<ge.length-1;Ee++){let ke=ge[Ee],De=ge[Ee+1];ke.x<y&&De.x<y||(ke.x<y?ke=new ze(y,ke.y+(y-ke.x)/(De.x-ke.x)*(De.y-ke.y))._round():De.x<y&&(De=new ze(y,ke.y+(y-ke.x)/(De.x-ke.x)*(De.y-ke.y))._round()),ke.y<I&&De.y<I||(ke.y<I?ke=new ze(ke.x+(I-ke.y)/(De.y-ke.y)*(De.x-ke.x),I)._round():De.y<I&&(De=new ze(ke.x+(I-ke.y)/(De.y-ke.y)*(De.x-ke.x),I)._round()),ke.x>=G&&De.x>=G||(ke.x>=G?ke=new ze(G,ke.y+(G-ke.x)/(De.x-ke.x)*(De.y-ke.y))._round():De.x>=G&&(De=new ze(G,ke.y+(G-ke.x)/(De.x-ke.x)*(De.y-ke.y))._round()),ke.y>=Q&&De.y>=Q||(ke.y>=Q?ke=new ze(ke.x+(Q-ke.y)/(De.y-ke.y)*(De.x-ke.x),Q)._round():De.y>=Q&&(De=new ze(ke.x+(Q-ke.y)/(De.y-ke.y)*(De.x-ke.x),Q)._round()),we&&ke.equals(we[we.length-1])||(we=[ke],ne.push(we)),we.push(De)))))}}return ne}Pn(os,"Anchor");const Nc=1e20;function Bf(U,y,I,G,Q,ne,he,ge,we){for(let Ee=y;Ee<y+G;Ee++)Of(U,I*ne+Ee,ne,Q,he,ge,we);for(let Ee=I;Ee<I+Q;Ee++)Of(U,Ee*ne+y,1,G,he,ge,we)}function Of(U,y,I,G,Q,ne,he){ne[0]=0,he[0]=-Nc,he[1]=Nc,Q[0]=U[y];for(let ge=1,we=0,Ee=0;ge<G;ge++){Q[ge]=U[y+ge*I];const ke=ge*ge;do{const De=ne[we];Ee=(Q[ge]-Q[De]+ke-De*De)/(ge-De)/2}while(Ee<=he[we]&&--we>-1);we++,ne[we]=ge,he[we]=Ee,he[we+1]=Nc}for(let ge=0,we=0;ge<G;ge++){for(;he[we+1]<ge;)we++;const Ee=ne[we],ke=ge-Ee;U[y+ge*I]=Q[Ee]+ke*ke}}const kd={none:0,ideographs:1,all:2};class vl{constructor(y,I,G){this.requestManager=y,this.localGlyphMode=I,this.localFontFamily=G,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(y){this.url=y}getGlyphs(y,I){const G=[];for(const Q in y)for(const ne of y[Q])G.push({stack:Q,id:ne});Dt(G,({stack:Q,id:ne},he)=>{let ge=this.entries[Q];ge||(ge=this.entries[Q]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let we=ge.glyphs[ne];if(we!==void 0)return void he(null,{stack:Q,id:ne,glyph:we});if(we=this._tinySDF(ge,Q,ne),we)return ge.glyphs[ne]=we,void he(null,{stack:Q,id:ne,glyph:we});const Ee=Math.floor(ne/256);if(256*Ee>65535)return void he(new Error("glyphs > 65535 not supported"));if(ge.ranges[Ee])return void he(null,{stack:Q,id:ne,glyph:we});let ke=ge.requests[Ee];ke||(ke=ge.requests[Ee]=[],vl.loadGlyphRange(Q,Ee,this.url,this.requestManager,(De,Oe)=>{if(Oe){ge.ascender=Oe.ascender,ge.descender=Oe.descender;for(const Ne in Oe.glyphs)this._doesCharSupportLocalGlyph(+Ne)||(ge.glyphs[+Ne]=Oe.glyphs[+Ne]);ge.ranges[Ee]=!0}for(const Ne of ke)Ne(De,Oe);delete ge.requests[Ee]})),ke.push((De,Oe)=>{De?he(De):Oe&&he(null,{stack:Q,id:ne,glyph:Oe.glyphs[ne]||null})})},(Q,ne)=>{if(Q)I(Q);else if(ne){const he={};for(const{stack:ge,id:we,glyph:Ee}of ne)he[ge]===void 0&&(he[ge]={}),he[ge].glyphs===void 0&&(he[ge].glyphs={}),he[ge].glyphs[we]=Ee&&{id:Ee.id,bitmap:Ee.bitmap.clone(),metrics:Ee.metrics},he[ge].ascender=this.entries[ge].ascender,he[ge].descender=this.entries[ge].descender;I(null,he)}})}_doesCharSupportLocalGlyph(y){return this.localGlyphMode!==kd.none&&(this.localGlyphMode===kd.all?!!this.localFontFamily:!!this.localFontFamily&&(ua(y)||$u(y)||mc(y)||Ho(y)||il(y)))}_tinySDF(y,I,G){const Q=this.localFontFamily;if(!Q||!this._doesCharSupportLocalGlyph(G))return;let ne=y.tinySDF;if(!ne){let We="400";/bold/i.test(I)?We="900":/medium/i.test(I)?We="500":/light/i.test(I)&&(We="200"),ne=y.tinySDF=new vl.TinySDF({fontFamily:Q,fontWeight:We,fontSize:48,buffer:6,radius:16}),ne.fontWeight=We}if(this.localGlyphs[ne.fontWeight][G])return this.localGlyphs[ne.fontWeight][G];const he=String.fromCharCode(G),{data:ge,width:we,height:Ee,glyphWidth:ke,glyphHeight:De,glyphLeft:Oe,glyphTop:Ne,glyphAdvance:Ge}=ne.draw(he);return this.localGlyphs[ne.fontWeight][G]={id:G,bitmap:new rs({width:we,height:Ee},ge),metrics:{width:ke/2,height:De/2,left:Oe/2,top:Ne/2-27,advance:Ge/2,localGlyph:!0}}}}function Ff(U,y,I,G){const Q=[],ne=U.image,he=ne.pixelRatio,ge=ne.paddedRect.w-2,we=ne.paddedRect.h-2,Ee=U.right-U.left,ke=U.bottom-U.top,De=ne.stretchX||[[0,ge]],Oe=ne.stretchY||[[0,we]],Ne=(Nt,Kt)=>Nt+Kt[1]-Kt[0],Ge=De.reduce(Ne,0),We=Oe.reduce(Ne,0),Je=ge-Ge,st=we-We;let pt=0,ct=Ge,ht=0,bt=We,mt=0,$t=Je,Ft=0,Ht=st;if(ne.content&&G){const Nt=ne.content;pt=ph(De,0,Nt[0]),ht=ph(Oe,0,Nt[1]),ct=ph(De,Nt[0],Nt[2]),bt=ph(Oe,Nt[1],Nt[3]),mt=Nt[0]-pt,Ft=Nt[1]-ht,$t=Nt[2]-Nt[0]-ct,Ht=Nt[3]-Nt[1]-bt}const pn=(Nt,Kt,nn,Yt)=>{const hn=fh(Nt.stretch-pt,ct,Ee,U.left),rn=mh(Nt.fixed-mt,$t,Nt.stretch,Ge),En=fh(Kt.stretch-ht,bt,ke,U.top),nr=mh(Kt.fixed-Ft,Ht,Kt.stretch,We),or=fh(nn.stretch-pt,ct,Ee,U.left),Fn=mh(nn.fixed-mt,$t,nn.stretch,Ge),vn=fh(Yt.stretch-ht,bt,ke,U.top),mr=mh(Yt.fixed-Ft,Ht,Yt.stretch,We),Kn=new ze(hn,En),Mn=new ze(or,En),Nr=new ze(or,vn),Or=new ze(hn,vn),Wr=new ze(rn/he,nr/he),ar=new ze(Fn/he,mr/he),Er=y*Math.PI/180;if(Er){const Lr=Math.sin(Er),Zr=Math.cos(Er),Yr=[Zr,-Lr,Lr,Zr];Kn._matMult(Yr),Mn._matMult(Yr),Or._matMult(Yr),Nr._matMult(Yr)}const jr=Nt.stretch+Nt.fixed,Fr=Kt.stretch+Kt.fixed;return{tl:Kn,tr:Mn,bl:Or,br:Nr,tex:{x:ne.paddedRect.x+1+jr,y:ne.paddedRect.y+1+Fr,w:nn.stretch+nn.fixed-jr,h:Yt.stretch+Yt.fixed-Fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wr,pixelOffsetBR:ar,minFontScaleX:$t/he/Ee,minFontScaleY:Ht/he/ke,isSDF:I}};if(G&&(ne.stretchX||ne.stretchY)){const Nt=Uf(De,Je,Ge),Kt=Uf(Oe,st,We);for(let nn=0;nn<Nt.length-1;nn++){const Yt=Nt[nn],hn=Nt[nn+1];for(let rn=0;rn<Kt.length-1;rn++)Q.push(pn(Yt,Kt[rn],hn,Kt[rn+1]))}}else Q.push(pn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ge+1},{fixed:0,stretch:we+1}));return Q}function ph(U,y,I){let G=0;for(const Q of U)G+=Math.max(y,Math.min(I,Q[1]))-Math.max(y,Math.min(I,Q[0]));return G}function Uf(U,y,I){const G=[{fixed:-1,stretch:0}];for(const[Q,ne]of U){const he=G[G.length-1];G.push({fixed:Q-he.stretch,stretch:he.stretch}),G.push({fixed:Q-he.stretch,stretch:he.stretch+(ne-Q)})}return G.push({fixed:y+1,stretch:I}),G}function fh(U,y,I,G){return U/y*I+G}function mh(U,y,I,G){return U-y*I/G}function vg(U,y,I,G){const Q=y+U.positionedLines[G].lineOffset;return G===0?I+Q/2:I+(Q+(y+U.positionedLines[G-1].lineOffset))/2}vl.loadGlyphRange=function(U,y,I,G,Q){const ne=256*y,he=ne+255,ge=G.transformRequest(G.normalizeGlyphsURL(I).replace("{fontstack}",U).replace("{range}",`${ne}-${he}`),Tt.Glyphs);Lt(ge,(we,Ee)=>{if(we)Q(we);else if(Ee){const ke={},De=function(Oe){return new Uc(Oe).readFields(hg,{})}(Ee);for(const Oe of De.glyphs)ke[Oe.id]=Oe;Q(null,{glyphs:ke,ascender:De.ascender,descender:De.descender})}})},vl.TinySDF=class{constructor({fontSize:U=24,buffer:y=3,radius:I=8,cutoff:G=.25,fontFamily:Q="sans-serif",fontWeight:ne="normal",fontStyle:he="normal"}={}){this.buffer=y,this.cutoff=G,this.radius=I;const ge=this.size=U+4*y,we=this._createCanvas(ge),Ee=this.ctx=we.getContext("2d",{willReadFrequently:!0});Ee.font=`${he} ${ne} ${U}px ${Q}`,Ee.textBaseline="alphabetic",Ee.textAlign="left",Ee.fillStyle="black",this.gridOuter=new Float64Array(ge*ge),this.gridInner=new Float64Array(ge*ge),this.f=new Float64Array(ge),this.z=new Float64Array(ge+1),this.v=new Uint16Array(ge)}_createCanvas(U){const y=document.createElement("canvas");return y.width=y.height=U,y}draw(U){const{width:y,actualBoundingBoxAscent:I,actualBoundingBoxDescent:G,actualBoundingBoxLeft:Q,actualBoundingBoxRight:ne}=this.ctx.measureText(U),he=Math.ceil(I),ge=Math.min(this.size-this.buffer,Math.ceil(ne-Q)),we=Math.min(this.size-this.buffer,he+Math.ceil(G)),Ee=ge+2*this.buffer,ke=we+2*this.buffer,De=Math.max(Ee*ke,0),Oe=new Uint8ClampedArray(De),Ne={data:Oe,width:Ee,height:ke,glyphWidth:ge,glyphHeight:we,glyphTop:he,glyphLeft:0,glyphAdvance:y};if(ge===0||we===0)return Ne;const{ctx:Ge,buffer:We,gridInner:Je,gridOuter:st}=this;Ge.clearRect(We,We,ge,we),Ge.fillText(U,We,We+he);const pt=Ge.getImageData(We,We,ge,we);st.fill(Nc,0,De),Je.fill(0,0,De);for(let ct=0;ct<we;ct++)for(let ht=0;ht<ge;ht++){const bt=pt.data[4*(ct*ge+ht)+3]/255;if(bt===0)continue;const mt=(ct+We)*Ee+ht+We;if(bt===1)st[mt]=0,Je[mt]=Nc;else{const $t=.5-bt;st[mt]=$t>0?$t*$t:0,Je[mt]=$t<0?$t*$t:0}}Bf(st,0,0,Ee,ke,Ee,this.f,this.v,this.z),Bf(Je,We,We,ge,we,Ee,this.f,this.v,this.z);for(let ct=0;ct<De;ct++){const ht=Math.sqrt(st[ct])-Math.sqrt(Je[ct]);Oe[ct]=Math.round(255-255*(ht/this.radius+this.cutoff))}return Ne}};class xg{constructor(y=[],I=bg){if(this.data=y,this.length=this.data.length,this.compare=I,this.length>0)for(let G=(this.length>>1)-1;G>=0;G--)this._down(G)}push(y){this.data.push(y),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const y=this.data[0],I=this.data.pop();return this.length--,this.length>0&&(this.data[0]=I,this._down(0)),y}peek(){return this.data[0]}_up(y){const{data:I,compare:G}=this,Q=I[y];for(;y>0;){const ne=y-1>>1,he=I[ne];if(G(Q,he)>=0)break;I[y]=he,y=ne}I[y]=Q}_down(y){const{data:I,compare:G}=this,Q=this.length>>1,ne=I[y];for(;y<Q;){let he=1+(y<<1),ge=I[he];const we=he+1;if(we<this.length&&G(I[we],ge)<0&&(he=we,ge=I[we]),G(ge,ne)>=0)break;I[y]=ge,y=he}I[y]=ne}}function bg(U,y){return U<y?-1:U>y?1:0}function wg(U,y=1,I=!1){let G=1/0,Q=1/0,ne=-1/0,he=-1/0;const ge=U[0];for(let Ne=0;Ne<ge.length;Ne++){const Ge=ge[Ne];(!Ne||Ge.x<G)&&(G=Ge.x),(!Ne||Ge.y<Q)&&(Q=Ge.y),(!Ne||Ge.x>ne)&&(ne=Ge.x),(!Ne||Ge.y>he)&&(he=Ge.y)}const we=Math.min(ne-G,he-Q);let Ee=we/2;const ke=new xg([],Tg);if(we===0)return new ze(G,Q);for(let Ne=G;Ne<ne;Ne+=we)for(let Ge=Q;Ge<he;Ge+=we)ke.push(new xl(Ne+Ee,Ge+Ee,Ee,U));let De=function(Ne){let Ge=0,We=0,Je=0;const st=Ne[0];for(let pt=0,ct=st.length,ht=ct-1;pt<ct;ht=pt++){const bt=st[pt],mt=st[ht],$t=bt.x*mt.y-mt.x*bt.y;We+=(bt.x+mt.x)*$t,Je+=(bt.y+mt.y)*$t,Ge+=3*$t}return new xl(We/Ge,Je/Ge,0,Ne)}(U),Oe=ke.length;for(;ke.length;){const Ne=ke.pop();(Ne.d>De.d||!De.d)&&(De=Ne,I&&console.log("found best %d after %d probes",Math.round(1e4*Ne.d)/1e4,Oe)),Ne.max-De.d<=y||(Ee=Ne.h/2,ke.push(new xl(Ne.p.x-Ee,Ne.p.y-Ee,Ee,U)),ke.push(new xl(Ne.p.x+Ee,Ne.p.y-Ee,Ee,U)),ke.push(new xl(Ne.p.x-Ee,Ne.p.y+Ee,Ee,U)),ke.push(new xl(Ne.p.x+Ee,Ne.p.y+Ee,Ee,U)),Oe+=4)}return I&&(console.log(`num probes: ${Oe}`),console.log(`best distance: ${De.d}`)),De.p}function Tg(U,y){return y.max-U.max}function xl(U,y,I,G){this.p=new ze(U,y),this.h=I,this.d=function(Q,ne){let he=!1,ge=1/0;for(let we=0;we<ne.length;we++){const Ee=ne[we];for(let ke=0,De=Ee.length,Oe=De-1;ke<De;Oe=ke++){const Ne=Ee[ke],Ge=Ee[Oe];Ne.y>Q.y!=Ge.y>Q.y&&Q.x<(Ge.x-Ne.x)*(Q.y-Ne.y)/(Ge.y-Ne.y)+Ne.x&&(he=!he),ge=Math.min(ge,Ap(Q,Ne,Ge))}}return(he?1:-1)*Math.sqrt(ge)}(this.p,G),this.max=this.d+this.h*Math.SQRT2}const Rd=Number.POSITIVE_INFINITY,Eg=Math.sqrt(2);function $f(U,y){return y[1]!==Rd?function(I,G,Q){let ne=0,he=0;switch(G=Math.abs(G),Q=Math.abs(Q),I){case"top-right":case"top-left":case"top":he=Q-7;break;case"bottom-right":case"bottom-left":case"bottom":he=7-Q}switch(I){case"top-right":case"bottom-right":case"right":ne=-G;break;case"top-left":case"bottom-left":case"left":ne=G}return[ne,he]}(U,y[0],y[1]):function(I,G){let Q=0,ne=0;G<0&&(G=0);const he=G/Eg;switch(I){case"top-right":case"top-left":ne=he-7;break;case"bottom-right":case"bottom-left":ne=7-he;break;case"bottom":ne=7-G;break;case"top":ne=G-7}switch(I){case"top-right":case"bottom-right":Q=-he;break;case"top-left":case"bottom-left":Q=he;break;case"left":Q=G;break;case"right":Q=-G}return[Q,ne]}(U,y[0])}function Ag(U,y,I,G,Q,ne,he,ge,we,Ee){U.createArrays(),U.tilePixelRatio=Hn/(512*U.overscaling),U.compareText={},U.iconsNeedLinear=!1;const ke=U.layers[0].layout,De=U.layers[0]._unevaluatedLayout._values,Oe={};if(U.textSizeData.kind==="composite"){const{minZoom:We,maxZoom:Je}=U.textSizeData;Oe.compositeTextSizes=[De["text-size"].possiblyEvaluate(new tt(We),ge),De["text-size"].possiblyEvaluate(new tt(Je),ge)]}if(U.iconSizeData.kind==="composite"){const{minZoom:We,maxZoom:Je}=U.iconSizeData;Oe.compositeIconSizes=[De["icon-size"].possiblyEvaluate(new tt(We),ge),De["icon-size"].possiblyEvaluate(new tt(Je),ge)]}Oe.layoutTextSize=De["text-size"].possiblyEvaluate(new tt(we+1),ge),Oe.layoutIconSize=De["icon-size"].possiblyEvaluate(new tt(we+1),ge),Oe.textMaxSize=De["text-size"].possiblyEvaluate(new tt(18),ge);const Ne=ke.get("text-rotation-alignment")==="map"&&ke.get("symbol-placement")!=="point",Ge=ke.get("text-size");for(const We of U.features){const Je=ke.get("text-font").evaluate(We,{},ge).join(","),st=Ge.evaluate(We,{},ge),pt=Oe.layoutTextSize.evaluate(We,{},ge),ct=(Oe.layoutIconSize.evaluate(We,{},ge),{horizontal:{},vertical:void 0}),ht=We.text;let bt,mt=[0,0];if(ht){const Ht=ht.toString(),pn=ke.get("text-letter-spacing").evaluate(We,{},ge)*Ti,Nt=ke.get("text-line-height").evaluate(We,{},ge)*Ti,Kt=Wh(Ht)?pn:0,nn=ke.get("text-anchor").evaluate(We,{},ge),Yt=ke.get("text-variable-anchor");if(!Yt){const Fn=ke.get("text-radial-offset").evaluate(We,{},ge);mt=Fn?$f(nn,[Fn*Ti,Rd]):ke.get("text-offset").evaluate(We,{},ge).map(vn=>vn*Ti)}let hn=Ne?"center":ke.get("text-justify").evaluate(We,{},ge);const rn=ke.get("symbol-placement"),En=rn==="point",nr=rn==="point"?ke.get("text-max-width").evaluate(We,{},ge)*Ti:0,or=Fn=>{U.allowVerticalPlacement&&sl(Ht)&&(ct.vertical=Id(ht,y,I,Q,Je,nr,Nt,nn,Fn,Kt,mt,no.vertical,!0,rn,pt,st))};if(!Ne&&Yt){const Fn=hn==="auto"?Yt.map(mr=>zd(mr)):[hn];let vn=!1;for(let mr=0;mr<Fn.length;mr++){const Kn=Fn[mr];if(!ct.horizontal[Kn])if(vn)ct.horizontal[Kn]=ct.horizontal[0];else{const Mn=Id(ht,y,I,Q,Je,nr,Nt,"center",Kn,Kt,mt,no.horizontal,!1,rn,pt,st);Mn&&(ct.horizontal[Kn]=Mn,vn=Mn.positionedLines.length===1)}}or("left")}else{if(hn==="auto"&&(hn=zd(nn)),En||ke.get("text-writing-mode").indexOf("horizontal")>=0||!sl(Ht)){const Fn=Id(ht,y,I,Q,Je,nr,Nt,nn,hn,Kt,mt,no.horizontal,!1,rn,pt,st);Fn&&(ct.horizontal[hn]=Fn)}or(rn==="point"?"left":hn)}}let $t=!1;if(We.icon&&We.icon.name){const Ht=G[We.icon.name];Ht&&(bt=_g(Q[We.icon.name],ke.get("icon-offset").evaluate(We,{},ge),ke.get("icon-anchor").evaluate(We,{},ge)),$t=Ht.sdf,U.sdfIcons===void 0?U.sdfIcons=Ht.sdf:U.sdfIcons!==Ht.sdf&&er("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ht.pixelRatio!==U.pixelRatio||ke.get("icon-rotate").constantOr(1)!==0)&&(U.iconsNeedLinear=!0))}const Ft=jf(ct.horizontal)||ct.vertical;U.iconsInText||(U.iconsInText=!!Ft&&Ft.iconsInText),(Ft||bt)&&Sg(U,We,ct,bt,G,Oe,pt,0,mt,$t,he,ge,Ee)}ne&&U.generateCollisionDebugBuffers(we,U.collisionBoxArray)}function zd(U){switch(U){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sg(U,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe){let Ne=ne.textMaxSize.evaluate(y,{},De);Ne===void 0&&(Ne=he);const Ge=U.layers[0].layout,We=Ge.get("icon-offset").evaluate(y,{},De),Je=jf(I.horizontal)||I.vertical,st=Oe.name==="globe",pt=he/24,ct=U.tilePixelRatio*Ne/24,ht=(Kt=U.overscaling,U.zoom>18&&Kt>2&&(Kt>>=1),Math.max(Hn/(512*Kt),1)*Ge.get("symbol-spacing")),bt=Ge.get("text-padding")*U.tilePixelRatio,mt=Ge.get("icon-padding")*U.tilePixelRatio,$t=Ke(Ge.get("text-max-angle")),Ft=Ge.get("text-rotation-alignment")==="map"&&Ge.get("symbol-placement")!=="point",Ht=Ge.get("icon-rotation-alignment")==="map"&&Ge.get("symbol-placement")!=="point",pn=Ge.get("symbol-placement"),Nt=ht/2;var Kt;const nn=Ge.get("icon-text-fit");let Yt;G&&nn!=="none"&&(U.allowVerticalPlacement&&I.vertical&&(Yt=Mf(G,I.vertical,nn,Ge.get("icon-text-fit-padding"),We,pt)),Je&&(G=Mf(G,Je,nn,Ge.get("icon-text-fit-padding"),We,pt)));const hn=(rn,En,nr)=>{if(En.x<0||En.x>=Hn||En.y<0||En.y>=Hn)return;let or=null;if(st){const{x:Fn,y:vn,z:mr}=Oe.projectTilePoint(En.x,En.y,nr);or={anchor:new os(Fn,vn,mr,0,void 0),up:Oe.upVector(nr,En.x,En.y)}}(function(Fn,vn,mr,Kn,Mn,Nr,Or,Wr,ar,Er,jr,Fr,Lr,Zr,Yr,fi,$i,yr,ti,Ii,Cr,Jr,Di,Xr,ri){const mi=Fn.addToLineVertexArray(vn,Kn);let hi,Ei,Li,_i,as,Al,Jc,Qc=0,Am=0,Sm=0,Cm=0,Kd=-1,Yd=-1;const jo={};let Im=Ec("");const Ta=mr?mr.anchor:vn;let Jd=0,Qd=0;if(ar._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Jd,Qd]=ar.layout.get("text-offset").evaluate(Cr,{},ri).map(Hi=>Hi*Ti):(Jd=ar.layout.get("text-radial-offset").evaluate(Cr,{},ri)*Ti,Qd=Rd),Fn.allowVerticalPlacement&&Mn.vertical){const Hi=Mn.vertical;if(Yr)Al=Dd(Hi),Wr&&(Jc=Dd(Wr));else{const Wi=ar.layout.get("text-rotate").evaluate(Cr,{},ri)+90;Li=_h(Er,Ta,vn,jr,Fr,Lr,Hi,Zr,Wi,fi),Wr&&(_i=_h(Er,Ta,vn,jr,Fr,Lr,Wr,yr,Wi))}}if(Nr){const Hi=ar.layout.get("icon-rotate").evaluate(Cr,{},ri),Wi=ar.layout.get("icon-text-fit")!=="none",eu=Ff(Nr,Hi,Di,Wi),tp=Wr?Ff(Wr,Hi,Di,Wi):void 0;Ei=_h(Er,Ta,vn,jr,Fr,Lr,Nr,yr,Hi),Qc=4*eu.length;const Mm=Fn.iconSizeData;let Ea=null;Mm.kind==="source"?(Ea=[Oo*ar.layout.get("icon-size").evaluate(Cr,{},ri)],Ea[0]>Ps&&er(`${Fn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Mm.kind==="composite"&&(Ea=[Oo*Jr.compositeIconSizes[0].evaluate(Cr,{},ri),Oo*Jr.compositeIconSizes[1].evaluate(Cr,{},ri)],(Ea[0]>Ps||Ea[1]>Ps)&&er(`${Fn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Fn.addSymbols(Fn.icon,eu,Ea,Ii,ti,Cr,!1,mr,vn,mi.lineStartIndex,mi.lineLength,-1,Xr,ri),Kd=Fn.icon.placedSymbolArray.length-1,tp&&(Am=4*tp.length,Fn.addSymbols(Fn.icon,tp,Ea,Ii,ti,Cr,no.vertical,mr,vn,mi.lineStartIndex,mi.lineLength,-1,Xr,ri),Yd=Fn.icon.placedSymbolArray.length-1)}for(const Hi in Mn.horizontal){const Wi=Mn.horizontal[Hi];hi||(Im=Ec(Wi.text),Yr?as=Dd(Wi):hi=_h(Er,Ta,vn,jr,Fr,Lr,Wi,Zr,ar.layout.get("text-rotate").evaluate(Cr,{},ri),fi));const eu=Wi.positionedLines.length===1;if(Sm+=Nf(Fn,mr,vn,Wi,Or,ar,Yr,Cr,fi,mi,Mn.vertical?no.horizontal:no.horizontalOnly,eu?Object.keys(Mn.horizontal):[Hi],jo,Kd,Jr,Xr,ri),eu)break}Mn.vertical&&(Cm+=Nf(Fn,mr,vn,Mn.vertical,Or,ar,Yr,Cr,fi,mi,no.vertical,["vertical"],jo,Yd,Jr,Xr,ri));let Bs=-1;const ep=(Hi,Wi)=>Hi?Math.max(Hi,Wi):Wi;Bs=ep(as,Bs),Bs=ep(Al,Bs),Bs=ep(Jc,Bs);const iy=Bs>-1?1:0;Fn.glyphOffsetArray.length>=Rs.MAX_GLYPHS&&er("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Cr.sortKey!==void 0&&Fn.addToSortKeyRanges(Fn.symbolInstances.length,Cr.sortKey),Fn.symbolInstances.emplaceBack(Ta.x,Ta.y,Ta.z,vn.x,vn.y,jo.right>=0?jo.right:-1,jo.center>=0?jo.center:-1,jo.left>=0?jo.left:-1,jo.vertical>=0?jo.vertical:-1,Kd,Yd,Im,hi!==void 0?hi:Fn.collisionBoxArray.length,hi!==void 0?hi+1:Fn.collisionBoxArray.length,Li!==void 0?Li:Fn.collisionBoxArray.length,Li!==void 0?Li+1:Fn.collisionBoxArray.length,Ei!==void 0?Ei:Fn.collisionBoxArray.length,Ei!==void 0?Ei+1:Fn.collisionBoxArray.length,_i||Fn.collisionBoxArray.length,_i?_i+1:Fn.collisionBoxArray.length,jr,Sm,Cm,Qc,Am,iy,0,Jd,Qd,Bs)})(U,En,or,rn,I,G,Q,Yt,U.layers[0],U.collisionBoxArray,y.index,y.sourceLayerIndex,U.index,bt,Ft,we,0,mt,Ht,We,y,ne,Ee,ke,De)};if(pn==="line")for(const rn of Lf(y.geometry,0,0,Hn,Hn)){const En=yg(rn,ht,$t,I.vertical||Je,G,24,ct,U.overscaling,Hn);for(const nr of En){const or=Je;or&&Cg(U,or.text,Nt,nr)||hn(rn,nr,De)}}else if(pn==="line-center"){for(const rn of y.geometry)if(rn.length>1){const En=gg(rn,$t,I.vertical||Je,G,24,ct);En&&hn(rn,En,De)}}else if(y.type==="Polygon")for(const rn of bd(y.geometry,0)){const En=wg(rn,16);hn(rn[0],new os(En.x,En.y,0,0,void 0),De)}else if(y.type==="LineString")for(const rn of y.geometry)hn(rn,new os(rn[0].x,rn[0].y,0,0,void 0),De);else if(y.type==="Point")for(const rn of y.geometry)for(const En of rn)hn([En],new os(En.x,En.y,0,0,void 0),De)}const Ps=32640;function Nf(U,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge,We,Je){const st=function(ht,bt,mt,$t,Ft,Ht,pn,Nt){const Kt=[];if(bt.positionedLines.length===0)return Kt;const nn=$t.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Yt=function(or){const Fn=or[0],vn=or[1],mr=Fn*vn;return mr>0?[Fn,-vn]:mr<0?[-Fn,vn]:Fn===0?[vn,Fn]:[vn,-Fn]}(mt);let hn=Math.abs(bt.top-bt.bottom);for(const or of bt.positionedLines)hn-=or.lineOffset;const rn=bt.positionedLines.length,En=hn/rn;let nr=bt.top-mt[1];for(let or=0;or<rn;++or){const Fn=bt.positionedLines[or];nr=vg(bt,En,nr,or);for(const vn of Fn.positionedGlyphs){if(!vn.rect)continue;const mr=vn.rect||{};let Kn=4,Mn=!0,Nr=1,Or=0;if(vn.imageName){const Xr=pn[vn.imageName];if(!Xr)continue;if(Xr.sdf){er("SDF images are not supported in formatted text and will be ignored.");continue}Mn=!1,Nr=Xr.pixelRatio,Kn=1/Nr}const Wr=(Ft||Nt)&&vn.vertical,ar=vn.metrics.advance*vn.scale/2,Er=vn.metrics,jr=vn.rect;if(jr===null)continue;Nt&&bt.verticalizable&&(Or=vn.imageName?ar-vn.metrics.width*vn.scale/2:0);const Fr=Ft?[vn.x+ar,vn.y]:[0,0];let Lr=[0,0],Zr=[0,0],Yr=!1;Ft||(Wr?(Zr=[vn.x+ar+Yt[0],vn.y+Yt[1]-Or],Yr=!0):Lr=[vn.x+ar+mt[0],vn.y+mt[1]-Or]);const fi=jr.w*vn.scale/(Nr*(vn.localGlyph?2:1)),$i=jr.h*vn.scale/(Nr*(vn.localGlyph?2:1));let yr,ti,Ii,Cr;if(Wr){const Xr=vn.y-nr,ri=new ze(-ar,ar-Xr),mi=-Math.PI/2,hi=new ze(...Zr);yr=new ze(-ar+Lr[0],Lr[1]),yr._rotateAround(mi,ri)._add(hi),yr.x+=-Xr+ar,yr.y-=(Er.left-Kn)*vn.scale;const Ei=vn.imageName?Er.advance*vn.scale:Ti*vn.scale,Li=String.fromCharCode(vn.glyph);eg(Li)?yr.x+=(1-Kn)*vn.scale:tg(Li)?yr.x+=Ei-Er.height*vn.scale+(-Kn-1)*vn.scale:yr.x+=vn.imageName||Er.width+2*Kn===jr.w&&Er.height+2*Kn===jr.h?(Ei-$i)/2:(Ei-(Er.height+2*Kn)*vn.scale)/2,ti=new ze(yr.x,yr.y-fi),Ii=new ze(yr.x+$i,yr.y),Cr=new ze(yr.x+$i,yr.y-fi)}else{const Xr=(Er.left-Kn)*vn.scale-ar+Lr[0],ri=(-Er.top-Kn)*vn.scale+Lr[1],mi=Xr+fi,hi=ri+$i;yr=new ze(Xr,ri),ti=new ze(mi,ri),Ii=new ze(Xr,hi),Cr=new ze(mi,hi)}if(nn){let Xr;Xr=Ft?new ze(0,0):Yr?new ze(Yt[0],Yt[1]):new ze(mt[0],mt[1]),yr._rotateAround(nn,Xr),ti._rotateAround(nn,Xr),Ii._rotateAround(nn,Xr),Cr._rotateAround(nn,Xr)}const Jr=new ze(0,0),Di=new ze(0,0);Kt.push({tl:yr,tr:ti,bl:Ii,br:Cr,tex:mr,writingMode:bt.writingMode,glyphOffset:Fr,sectionIndex:vn.sectionIndex,isSDF:Mn,pixelOffsetTL:Jr,pixelOffsetBR:Di,minFontScaleX:0,minFontScaleY:0})}}return Kt}(0,G,we,ne,he,ge,Q,U.allowVerticalPlacement),pt=U.textSizeData;let ct=null;pt.kind==="source"?(ct=[Oo*ne.layout.get("text-size").evaluate(ge,{},Je)],ct[0]>Ps&&er(`${U.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pt.kind==="composite"&&(ct=[Oo*Ge.compositeTextSizes[0].evaluate(ge,{},Je),Oo*Ge.compositeTextSizes[1].evaluate(ge,{},Je)],(ct[0]>Ps||ct[1]>Ps)&&er(`${U.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),U.addSymbols(U.text,st,ct,we,he,ge,ke,y,I,Ee.lineStartIndex,Ee.lineLength,Ne,We,Je);for(const ht of De)Oe[ht]=U.text.placedSymbolArray.length-1;return 4*st.length}function jf(U){for(const y in U)return U[y];return null}function _h(U,y,I,G,Q,ne,he,ge,we,Ee){let ke=he.top,De=he.bottom,Oe=he.left,Ne=he.right;const Ge=he.collisionPadding;if(Ge&&(Oe-=Ge[0],ke-=Ge[1],Ne+=Ge[2],De+=Ge[3]),we){const We=new ze(Oe,ke),Je=new ze(Ne,ke),st=new ze(Oe,De),pt=new ze(Ne,De),ct=Ke(we);let ht=new ze(0,0);Ee&&(ht=new ze(Ee[0],Ee[1])),We._rotateAround(ct,ht),Je._rotateAround(ct,ht),st._rotateAround(ct,ht),pt._rotateAround(ct,ht),Oe=Math.min(We.x,Je.x,st.x,pt.x),Ne=Math.max(We.x,Je.x,st.x,pt.x),ke=Math.min(We.y,Je.y,st.y,pt.y),De=Math.max(We.y,Je.y,st.y,pt.y)}return U.emplaceBack(y.x,y.y,y.z,I.x,I.y,Oe,ke,Ne,De,ge,G,Q,ne),U.length-1}function Dd(U){U.collisionPadding&&(U.top-=U.collisionPadding[1],U.bottom+=U.collisionPadding[3]);const y=U.bottom-U.top;return y>0?Math.max(10,y):null}function Cg(U,y,I,G){const Q=U.compareText;if(y in Q){const ne=Q[y];for(let he=ne.length-1;he>=0;he--)if(G.dist(ne[he])<I)return!0}else Q[y]=[];return Q[y].push(G),!1}const Ig=Jt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vf}=Ig,Gf=Jt([{name:"a_pos_3",components:3,type:"Int16"}]);var jc=Jt([{name:"a_pos",type:"Int16",components:2}]);const ss=Hn/Math.PI/2,Ld=2*oo(1,0)*ss*Math.PI,bl=[64,32,16],vo=-ss,xo=ss,Mg=[new Ui([vo,vo,vo],[xo,xo,xo]),new Ui([vo,vo,vo],[0,0,xo]),new Ui([0,vo,vo],[xo,0,xo]),new Ui([vo,0,vo],[0,xo,xo]),new Ui([0,0,vo],[xo,xo,xo])];function qf(U,y,I,G=!0){const Q=go([],U._camera.position,U.worldSize),ne=[y,I,1,1];ya(ne,ne,U.pixelMatrixInverse),Bp(ne,ne,1/ne[3]);const he=Ri([],yo([],ne,Q)),ge=U.globeMatrix,we=[ge[12],ge[13],ge[14]],Ee=yo([],we,Q),ke=Cc(Ee),De=Ri([],Ee),Oe=U.worldSize/(2*Math.PI),Ne=ao(De,he),Ge=Math.asin(Oe/ke);if(Ge<Math.acos(Ne)){if(!G)return null;const pn=[],Nt=[];go(pn,he,ke/Ne),Ri(Nt,yo(Nt,pn,Ee)),Ri(he,Ms(he,Ee,go(he,Nt,Math.tan(Ge)*ke)))}const We=[];new pd(Q,he).closestPointOnSphere(we,Oe,We);const Je=Ri([],_r(ge,0)),st=Ri([],_r(ge,1)),pt=Ri([],_r(ge,2)),ct=ao(Je,We),ht=ao(st,We),bt=ao(pt,We),mt=Xe(Math.asin(-ht/Oe));let $t=Xe(Math.atan2(ct,bt));$t=U.center.lng+function(pn,Nt){const Kt=(Nt-pn+180)%360-180;return Kt<-180?Kt+360:Kt}(U.center.lng,$t);const Ft=Do($t),Ht=Mt(ts(mt),0,1);return new cl(Ft,Ht)}class Pg{constructor(y,I,G){this.a=yo([],y,G),this.b=yo([],I,G),this.center=G;const Q=Ri([],this.a),ne=Ri([],this.b);this.angle=Math.acos(ao(Q,ne))}}function Bd(U,y){if(U.angle===0)return null;let I;return I=U.a[y]===0?1/U.angle*.5*Math.PI:1/U.angle*Math.atan(U.b[y]/U.a[y]/Math.sin(U.angle)-1/Math.tan(U.angle)),I<0||I>1?null:function(G,Q,ne,he){const ge=Math.sin(ne);return G*(Math.sin((1-he)*ne)/ge)+Q*(Math.sin(he*ne)/ge)}(U.a[y],U.b[y],U.angle,Mt(I,0,1))+U.center[y]}function Fo(U){if(U.z<=1)return Mg[U.z+2*U.y+U.x];const y=Od(gh(U));return Ui.fromPoints(y)}function Zf(U,y){const I=qc(y.zoom);if(I===0)return Fo(U);const G=gh(U),Q=Od(G),ne=Do(G.getWest())*y.worldSize,he=Do(G.getEast())*y.worldSize,ge=ts(G.getNorth())*y.worldSize,we=ts(G.getSouth())*y.worldSize,Ee=[ne,ge,0],ke=[he,ge,0],De=[ne,we,0],Oe=[he,we,0],Ne=sd([],y.globeMatrix);return ci(Ee,Ee,Ne),ci(ke,ke,Ne),ci(De,De,Ne),ci(Oe,Oe,Ne),Q[0]=ps(Q[0],De,I),Q[1]=ps(Q[1],Oe,I),Q[2]=ps(Q[2],ke,I),Q[3]=ps(Q[3],Ee,I),Ui.fromPoints(Q)}function Hf(U,y,I,G,Q){for(const ne of I)ci(ne,ne,G),go(ne,ne,Q),ud(U,U,ne),hd(y,y,ne)}function kg(U,y,I){const G=y/U.worldSize,Q=Number.MAX_VALUE,ne=[-Q,-Q,-Q],he=[Q,Q,Q],ge=U.globeMatrix;if(I.z<=1)return Hf(he,ne,Fo(I).getCorners(),ge,G),new Ui(he,ne);const we=gh(I),Ee=Od(we);if(Hf(he,ne,Ee,ge,G),we.contains(U.center)){ne[2]=0;const $t=U.point,Ft=[$t.x*G,$t.y*G,0];return ud(he,he,Ft),hd(ne,ne,Ft),new Ui(he,ne)}const ke=[ge[12]*G,ge[13]*G,ge[14]*G],De=we.getCenter(),Oe=Mt(U.center.lat,-85.051129,Lo),Ne=Mt(De.lat,-85.051129,Lo),Ge=Do(U.center.lng),We=ts(Oe);let Je=Ge-Do(De.lng);const st=We-ts(Ne);Je>.5?Je-=1:Je<-.5&&(Je+=1);let pt=0;Math.abs(Je)>Math.abs(st)?pt=Je>=0?1:3:(pt=st>=0?0:2,Qu(ke,ke,[ge[4]*G,ge[5]*G,ge[6]*G],-Math.sin(Ke(st>=0?we.getSouth():we.getNorth()))*ss));const ct=Ee[pt],ht=Ee[(pt+1)%4],bt=new Pg(ct,ht,ke),mt=[Bd(bt,0)||ct[0],Bd(bt,1)||ct[1],Bd(bt,2)||ct[2]];return he[2]=Math.min(ct[2],ht[2]),ud(he,he,mt),hd(ne,ne,mt),new Ui(he,ne)}function gh({x:U,y,z:I}){const G=1/(1<<I),Q=new Mr(so(U*G),wi((y+1)*G)),ne=new Mr(so((U+1)*G),wi(y*G));return new Is(Q,ne)}function Od(U){const y=Ke(U.getNorth()),I=Ke(U.getSouth()),G=Math.cos(y),Q=Math.cos(I),ne=Math.sin(y),he=Math.sin(I),ge=U.getWest(),we=U.getEast();return[wl(Q,he,ge),wl(Q,he,we),wl(G,ne,we),wl(G,ne,ge)]}function wl(U,y,I,G=ss){return I=Ke(I),[U*Math.sin(I)*G,-y*G,U*Math.cos(I)*G]}function yh(U,y,I){return wl(Math.cos(Ke(U)),Math.sin(Ke(U)),y,I)}function Vc(U,y,I,G){const Q=1<<I.z,ne=(U/Hn+I.x)/Q;return yh(wi((y/Hn+I.y)/Q),so(ne),G)}function vh({min:U,max:y}){return 16383/Math.max(y[0]-U[0],y[1]-U[1],y[2]-U[2])}const Wf=new Float64Array(16);function Gc(U){const y=vh(U),I=kp(Wf,[y,y,y]);return Sc(I,I,((G=[])[0]=-(Q=U.min)[0],G[1]=-Q[1],G[2]=-Q[2],G));var G,Q}function Fd(U){const y=(G=U.min,(I=Wf)[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=G[0],I[13]=G[1],I[14]=G[2],I[15]=1,I);var I,G;const Q=1/vh(U);return ga(y,y,[Q,Q,Q])}function Xf(U,y,I,G,Q){const ne=function(we){const Ee=Hn/(2*Math.PI);return we/(2*Math.PI)/Ee}(I),he=[U,y,-I/(2*Math.PI)],ge=Bo(new Float64Array(16));return Sc(ge,ge,he),ga(ge,ge,[ne,ne,ne]),ad(ge,ge,Ke(-Q)),Ju(ge,ge,Ke(-G)),ge}function qc(U){return Pt(5,6,U)}function Kf(U,y){const I=yh(y.lat,y.lng);return ne=(G=cd([],function(Ne){const Ge=yh(Ne._center.lat,Ne._center.lng);let We=dd([],dl(0,1,0),Ge);const Je=Rp([],-Ne.angle,Ge);We=ci(We,We,Je),Rp(Je,-Ne._pitch,We);const st=Ri([],Ge);return go(st,st,Ne.cameraToCenterDistance/Ne.pixelsPerMeter*Ld),ci(st,st,Je),Ms([],Ge,st)}(U),I))[0],he=G[1],ge=G[2],we=(Q=I)[0],Ee=Q[1],ke=Q[2],Oe=(De=Math.sqrt(ne*ne+he*he+ge*ge)*Math.sqrt(we*we+Ee*Ee+ke*ke))&&ao(G,Q)/De,Math.acos(Math.min(Math.max(Oe,-1),1));var G,Q,ne,he,ge,we,Ee,ke,De,Oe}const Yf=Ke(85),Rg=Math.cos(Yf),zg=Math.sin(Yf);function Jf(U,y){const I=U.fovAboveCenter,G=U.elevation?U.elevation.getMinElevationBelowMSL()*y:0,Q=(U._camera.position[2]*U.worldSize-G)/Math.cos(U._pitch),ne=Math.sin(I)*Q/Math.sin(Math.max(Math.PI/2-U._pitch-I,.01)),he=Math.sin(U._pitch)*ne+Q;return Math.min(1.01*he,Q*(1/U._horizonShift))}function ba(U,y){if(!y.isReprojectedInTileSpace)return{scale:1<<U.z,x:U.x,y:U.y,x2:U.x+1,y2:U.y+1,projection:y};const I=Math.pow(2,-U.z),G=U.x*I,Q=(U.x+1)*I,ne=U.y*I,he=(U.y+1)*I,ge=so(G),we=so(Q),Ee=wi(ne),ke=wi(he),De=y.project(ge,Ee),Oe=y.project(we,Ee),Ne=y.project(we,ke),Ge=y.project(ge,ke);let We=Math.min(De.x,Oe.x,Ne.x,Ge.x),Je=Math.min(De.y,Oe.y,Ne.y,Ge.y),st=Math.max(De.x,Oe.x,Ne.x,Ge.x),pt=Math.max(De.y,Oe.y,Ne.y,Ge.y);const ct=I/16;function ht(mt,$t,Ft,Ht,pn,Nt){const Kt=(Ft+pn)/2,nn=(Ht+Nt)/2,Yt=y.project(so(Kt),wi(nn)),hn=Math.max(0,We-Yt.x,Je-Yt.y,Yt.x-st,Yt.y-pt);We=Math.min(We,Yt.x),st=Math.max(st,Yt.x),Je=Math.min(Je,Yt.y),pt=Math.max(pt,Yt.y),hn>ct&&(ht(mt,Yt,Ft,Ht,Kt,nn),ht(Yt,$t,Kt,nn,pn,Nt))}ht(De,Oe,G,ne,Q,ne),ht(Oe,Ne,Q,ne,Q,he),ht(Ne,Ge,Q,he,G,he),ht(Ge,De,G,he,G,ne),We-=ct,Je-=ct,st+=ct,pt+=ct;const bt=1/Math.max(st-We,pt-Je);return{scale:bt,x:We*bt,y:Je*bt,x2:st*bt,y2:pt*bt,projection:y}}const Dg=Bo(new Float32Array(16));class ks{constructor(y){this.spec=y,this.name=y.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(y,I){return{x:0,y:0,z:0}}unproject(y,I){return new Mr(0,0)}projectTilePoint(y,I,G){return{x:y,y:I,z:0}}locationPoint(y,I,G=!0){return y._coordinatePoint(y.locationCoordinate(I),G)}pixelsPerMeter(y,I){return oo(1,y)*I}pixelSpaceConversion(y,I,G){return 1}farthestPixelDistance(y){return Jf(y,y.pixelsPerMeter)}pointCoordinate(y,I,G,Q){const ne=y.horizonLineFromTop(!1),he=new ze(I,Math.max(ne,G));return y.rayIntersectionCoordinate(y.pointRayIntersection(he,Q))}pointCoordinate3D(y,I,G){const Q=new ze(I,G);if(y.elevation)return y.elevation.pointCoordinate(Q);{const ne=this.pointCoordinate(y,Q.x,Q.y,0);return[ne.x,ne.y,ne.z]}}isPointAboveHorizon(y,I){if(y.elevation)return!this.pointCoordinate3D(y,I.x,I.y);const G=y.horizonLineFromTop();return I.y<G}createInversionMatrix(y,I){return Dg}createTileMatrix(y,I,G){let Q,ne,he;const ge=G.canonical,we=Bo(new Float64Array(16));if(this.isReprojectedInTileSpace){const Ee=ba(ge,this);Q=1,ne=Ee.x+G.wrap*Ee.scale,he=Ee.y,ga(we,we,[Q/Ee.scale,Q/Ee.scale,y.pixelsPerMeter/I])}else Q=I/y.zoomScale(ge.z),ne=(ge.x+Math.pow(2,ge.z)*G.wrap)*Q,he=ge.y*Q;return Sc(we,we,[ne,he,0]),ga(we,we,[Q/Hn,Q/Hn,1]),we}upVector(y,I,G){return[0,0,1]}upVectorScale(y,I,G){return{metersToTile:1}}}class Lg extends ks{constructor(y){super(y),this.range=[4,7],this.center=y.center||[-96,37.5];const[I,G]=this.parallels=y.parallels||[29.5,45.5],Q=Math.sin(Ke(I));this.n=(Q+Math.sin(Ke(G)))/2,this.c=1+Q*(2*this.n-Q),this.r0=Math.sqrt(this.c)/this.n}project(y,I){const{n:G,c:Q,r0:ne}=this,he=Ke(y-this.center[0]),ge=Ke(I),we=Math.sqrt(Q-2*G*Math.sin(ge))/G;return{x:we*Math.sin(he*G),y:we*Math.cos(he*G)-ne,z:0}}unproject(y,I){const{n:G,c:Q,r0:ne}=this,he=ne+I;let ge=Math.atan2(y,Math.abs(he))*Math.sign(he);he*G<0&&(ge-=Math.PI*Math.sign(y)*Math.sign(he));const we=Ke(this.center[0])*G;ge=At(ge,-Math.PI-we,Math.PI-we);const Ee=Xe(ge/G)+this.center[0],ke=Math.asin(Mt((Q-(y*y+he*he)*G*G)/(2*G),-1,1)),De=Mt(Xe(ke),-85.051129,Lo);return new Mr(Ee,De)}}const Zc=1.340264,Hc=-.081106,Wc=893e-6,Xc=.003796,xh=Math.sqrt(3)/2;class Bg extends ks{project(y,I){I=I/180*Math.PI,y=y/180*Math.PI;const G=Math.asin(xh*Math.sin(I)),Q=G*G,ne=Q*Q*Q;return{x:.5*(y*Math.cos(G)/(xh*(Zc+3*Hc*Q+ne*(7*Wc+9*Xc*Q)))/Math.PI+.5),y:1-.5*(G*(Zc+Hc*Q+ne*(Wc+Xc*Q))/Math.PI+1),z:0}}unproject(y,I){y=(2*y-.5)*Math.PI;let G=I=(2*(1-I)-1)*Math.PI,Q=G*G,ne=Q*Q*Q;for(let ke,De,Oe,Ne=0;Ne<12&&(De=G*(Zc+Hc*Q+ne*(Wc+Xc*Q))-I,Oe=Zc+3*Hc*Q+ne*(7*Wc+9*Xc*Q),ke=De/Oe,G=Mt(G-ke,-Math.PI/3,Math.PI/3),Q=G*G,ne=Q*Q*Q,!(Math.abs(ke)<1e-12));++Ne);const he=xh*y*(Zc+3*Hc*Q+ne*(7*Wc+9*Xc*Q))/Math.cos(G),ge=Math.asin(Math.sin(G)/xh),we=Mt(180*he/Math.PI,-180,180),Ee=Mt(180*ge/Math.PI,-85.051129,Lo);return new Mr(we,Ee)}}class Og extends ks{constructor(y){super(y),this.wrap=!0,this.supportsWorldCopies=!0}project(y,I){return{x:.5+y/360,y:.5-I/360,z:0}}unproject(y,I){const G=360*(y-.5),Q=Mt(360*(.5-I),-85.051129,Lo);return new Mr(G,Q)}}const Tl=Math.PI/2;function bh(U){return Math.tan((Tl+U)/2)}class Fg extends ks{constructor(y){super(y),this.center=y.center||[0,30];const[I,G]=this.parallels=y.parallels||[30,30],Q=Ke(I),ne=Ke(G),he=Math.cos(Q);this.n=Q===ne?Math.sin(Q):Math.log(he/Math.cos(ne))/Math.log(bh(ne)/bh(Q)),this.f=he*Math.pow(bh(Q),this.n)/this.n}project(y,I){I=Ke(I),y=Ke(y-this.center[0]);const G=1e-6,{n:Q,f:ne}=this;ne>0?I<-Tl+G&&(I=-Tl+G):I>Tl-G&&(I=Tl-G);const he=ne/Math.pow(bh(I),Q),ge=he*Math.sin(Q*y),we=ne-he*Math.cos(Q*y);return{x:.5*(ge/Math.PI+.5),y:1-.5*(we/Math.PI+.5),z:0}}unproject(y,I){y=(2*y-.5)*Math.PI,I=(2*(1-I)-.5)*Math.PI;const{n:G,f:Q}=this,ne=Q-I,he=Math.sign(ne),ge=Math.sign(G)*Math.sqrt(y*y+ne*ne);let we=Math.atan2(y,Math.abs(ne))*he;ne*G<0&&(we-=Math.PI*Math.sign(y)*he);const Ee=Mt(Xe(we/G)+this.center[0],-180,180),ke=Mt(Xe(2*Math.atan(Math.pow(Q/ge,1/G))-Tl),-85.051129,Lo);return new Mr(Ee,ke)}}class Qf extends ks{constructor(y){super(y),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(y,I){return{x:Do(y),y:ts(I),z:0}}unproject(y,I){const G=so(y),Q=wi(I);return new Mr(G,Q)}}const em=Ke(Lo);class Ug extends ks{project(y,I){const G=(I=Ke(I))*I,Q=G*G;return{x:.5*((y=Ke(y))*(.8707-.131979*G+Q*(Q*(.003971*G-.001529*Q)-.013791))/Math.PI+.5),y:1-.5*(I*(1.007226+G*(.015085+Q*(.028874*G-.044475-.005916*Q)))/Math.PI+1),z:0}}unproject(y,I){y=(2*y-.5)*Math.PI;let G=I=(2*(1-I)-1)*Math.PI,Q=25,ne=0,he=G*G;do{he=G*G;const Ee=he*he;ne=(G*(1.007226+he*(.015085+Ee*(.028874*he-.044475-.005916*Ee)))-I)/(1.007226+he*(.045255+Ee*(.259866*he-.311325-.005916*11*Ee))),G=Mt(G-ne,-em,em)}while(Math.abs(ne)>1e-6&&--Q>0);he=G*G;const ge=Mt(Xe(y/(.8707+he*(he*(he*he*he*(.003971-.001529*he)-.013791)-.131979))),-180,180),we=Xe(G);return new Mr(ge,we)}}const tm=Ke(Lo);class $g extends ks{project(y,I){I=Ke(I),y=Ke(y);const G=Math.cos(I),Q=2/Math.PI,ne=Math.acos(G*Math.cos(y/2)),he=Math.sin(ne)/ne,ge=.5*(y*Q+2*G*Math.sin(y/2)/he)||0,we=.5*(I+Math.sin(I)/he)||0;return{x:.5*(ge/Math.PI+.5),y:1-.5*(we/Math.PI+1),z:0}}unproject(y,I){let G=y=(2*y-.5)*Math.PI,Q=I=(2*(1-I)-1)*Math.PI,ne=25;const he=1e-6;let ge=0,we=0;do{const Ee=Math.cos(Q),ke=Math.sin(Q),De=2*ke*Ee,Oe=ke*ke,Ne=Ee*Ee,Ge=Math.cos(G/2),We=Math.sin(G/2),Je=2*Ge*We,st=We*We,pt=1-Ne*Ge*Ge,ct=pt?1/pt:0,ht=pt?Math.acos(Ee*Ge)*Math.sqrt(1/pt):0,bt=.5*(2*ht*Ee*We+2*G/Math.PI)-y,mt=.5*(ht*ke+Q)-I,$t=.5*ct*(Ne*st+ht*Ee*Ge*Oe)+1/Math.PI,Ft=ct*(Je*De/4-ht*ke*We),Ht=.125*ct*(De*We-ht*ke*Ne*Je),pn=.5*ct*(Oe*Ge+ht*st*Ee)+.5,Nt=Ft*Ht-pn*$t;ge=(mt*Ft-bt*pn)/Nt,we=(bt*Ht-mt*$t)/Nt,G=Mt(G-ge,-Math.PI,Math.PI),Q=Mt(Q-we,-tm,tm)}while((Math.abs(ge)>he||Math.abs(we)>he)&&--ne>0);return new Mr(Xe(G),Xe(Q))}}class nm extends ks{constructor(y){super(y),this.center=y.center||[0,0],this.parallels=y.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ke(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(y,I){const{scale:G,cosPhi:Q}=this;return{x:Ke(y)*Q*G+.5,y:-Math.sin(Ke(I))/Q*G+.5,z:0}}unproject(y,I){const{scale:G,cosPhi:Q}=this,ne=-(I-.5)/G,he=Mt(Xe((y-.5)/G)/Q,-180,180),ge=Math.asin(Mt(ne*Q,-1,1)),we=Mt(Xe(ge),-85.051129,Lo);return new Mr(he,we)}}class Ng extends Qf{constructor(y){super(y),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(y,I,G){const Q=Vc(y,I,G);return ci(Q,Q,Gc(Fo(G))),{x:Q[0],y:Q[1],z:Q[2]}}locationPoint(y,I){const G=yh(I.lat,I.lng),Q=Ri([],G),ne=y.elevation?y.elevation.getAtPointOrZero(y.locationCoordinate(I),y._centerAltitude):y._centerAltitude;Qu(G,G,Q,oo(1,0)*Hn*ne);const he=Bo(new Float64Array(16));return hl(he,y.pixelMatrix,y.globeMatrix),ci(G,G,he),new ze(G[0],G[1])}pixelsPerMeter(y,I){return oo(1,0)*I}pixelSpaceConversion(y,I,G){const Q=wr(oo(1,45)*I,oo(1,y)*I,G);return this.pixelsPerMeter(y,I)/Q}createTileMatrix(y,I,G){const Q=Fd(Fo(G.canonical));return hl(new Float64Array(16),y.globeMatrix,Q)}createInversionMatrix(y,I){const{center:G}=y,Q=Gc(Fo(I));return Ju(Q,Q,Ke(G.lng)),ad(Q,Q,Ke(G.lat)),ga(Q,Q,[y._pixelsPerMercatorPixel,y._pixelsPerMercatorPixel,1]),Float32Array.from(Q)}pointCoordinate(y,I,G,Q){return qf(y,I,G,!0)||new cl(0,0)}pointCoordinate3D(y,I,G){const Q=this.pointCoordinate(y,I,G,0);return[Q.x,Q.y,Q.z]}isPointAboveHorizon(y,I){return!qf(y,I.x,I.y,!1)}farthestPixelDistance(y){const I=function(Q,ne){const he=Q.cameraToCenterDistance,ge=Q._centerAltitude*ne,we=Q._camera,Ee=Q._camera.forward(),ke=Ms([],go([],Ee,-he),[0,0,ge]),De=Q.worldSize/(2*Math.PI),Oe=[0,0,-De],Ne=Q.width/Q.height,Ge=Math.tan(Q.fovAboveCenter),We=go([],we.up(),Ge),Je=go([],we.right(),Ge*Ne),st=Ri([],Ms([],Ms([],Ee,We),Je)),pt=[];let ct;if(new pd(ke,st).closestPointOnSphere(Oe,De,pt)){const ht=Ms([],pt,Oe),bt=yo([],ht,ke);ct=Math.cos(Q.fovAboveCenter)*Cc(bt)}else{const ht=yo([],ke,Oe),bt=yo([],Oe,ke);Ri(bt,bt);const mt=Cc(ht)-De;ct=Math.sqrt(mt*(mt+2*De));const $t=Math.acos(ct/(De+mt))-Math.acos(ao(Ee,bt));ct*=Math.cos($t)}return 1.01*ct}(y,this.pixelsPerMeter(y.center.lat,y.worldSize)),G=qc(y.zoom);if(G>0){const Q=Jf(y,oo(1,y.center.lat)*y.worldSize),ne=y.worldSize/(2*Math.PI),he=Math.max(y.width,y.height)/y.worldSize*Math.PI;return wr(I,Q+ne*(1-Math.cos(he)),Math.pow(G,10))}return I}upVector(y,I,G){return Vc(I,G,y,1)}upVectorScale(y){return{metersToTile:Ld*vh(Fo(y))}}}function rm(U){const y=U.parallels,I=!!y&&Math.abs(y[0]+y[1])<.01;switch(U.name){case"mercator":return new Qf(U);case"equirectangular":return new Og(U);case"naturalEarth":return new Ug(U);case"equalEarth":return new Bg(U);case"winkelTripel":return new $g(U);case"albers":return I?new nm(U):new Lg(U);case"lambertConformalConic":return I?new nm(U):new Fg(U);case"globe":return new Ng(U)}throw new Error(`Invalid projection name: ${U.name}`)}const jg=xa.VectorTileFeature.types,Vg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wh(U,y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe){const Ne=ge?Math.min(Ps,Math.round(ge[0])):0,Ge=ge?Math.min(Ps,Math.round(ge[1])):0;U.emplaceBack(y,I,Math.round(32*G),Math.round(32*Q),ne,he,(Ne<<1)+(we?1:0),Ge,16*Ee,16*ke,256*De,256*Oe)}function Th(U,y,I,G,Q,ne,he){U.emplaceBack(y,I,G,Q,ne,he)}function Eh(U,y,I,G,Q){U.emplaceBack(y,I,G,Q),U.emplaceBack(y,I,G,Q),U.emplaceBack(y,I,G,Q),U.emplaceBack(y,I,G,Q)}function Gg(U){for(const y of U.sections)if(q(y.text))return!0;return!1}class Ud{constructor(y){this.layoutVertexArray=new Gr,this.indexArray=new cr,this.programConfigurations=y,this.segments=new ai,this.dynamicLayoutVertexArray=new fr,this.opacityVertexArray=new Dr,this.placedSymbolArray=new np,this.globeExtVertexArray=new ei}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(y,I,G,Q){this.isEmpty()||(G&&(this.layoutVertexBuffer=y.createVertexBuffer(this.layoutVertexArray,Z_.members),this.indexBuffer=y.createIndexBuffer(this.indexArray,I),this.dynamicLayoutVertexBuffer=y.createVertexBuffer(this.dynamicLayoutVertexArray,W_.members,!0),this.opacityVertexBuffer=y.createVertexBuffer(this.opacityVertexArray,Vg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=y.createVertexBuffer(this.globeExtVertexArray,H_.members,!0)),this.opacityVertexBuffer.itemSize=1),(G||Q)&&this.programConfigurations.upload(y))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Pn(Ud,"SymbolBuffers");class $d{constructor(y,I,G){this.layoutVertexArray=new y,this.layoutAttributes=I,this.indexArray=new G,this.segments=new ai,this.collisionVertexArray=new qr,this.collisionVertexArrayExt=new Hr}upload(y){this.layoutVertexBuffer=y.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=y.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=y.createVertexBuffer(this.collisionVertexArray,X_.members,!0),this.collisionVertexBufferExt=y.createVertexBuffer(this.collisionVertexArrayExt,K_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pn($d,"CollisionBuffers");class Rs{constructor(y){this.collisionBoxArray=y.collisionBoxArray,this.zoom=y.zoom,this.overscaling=y.overscaling,this.layers=y.layers,this.layerIds=this.layers.map(he=>he.id),this.index=y.index,this.pixelRatio=y.pixelRatio,this.sourceLayerIndex=y.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bo([]),this.placementViewportMatrix=Bo([]);const I=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ed(this.zoom,I["text-size"]),this.iconSizeData=Ed(this.zoom,I["icon-size"]);const G=this.layers[0].layout,Q=G.get("symbol-sort-key"),ne=G.get("symbol-z-order");this.canOverlap=G.get("text-allow-overlap")||G.get("icon-allow-overlap")||G.get("text-ignore-placement")||G.get("icon-ignore-placement"),this.sortFeaturesByKey=ne!=="viewport-y"&&Q.constantOr(1)!==void 0,this.sortFeaturesByY=(ne==="viewport-y"||ne==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=G.get("text-writing-mode").map(he=>no[he]),this.stateDependentLayerIds=this.layers.filter(he=>he.isStateDependent()).map(he=>he.id),this.sourceID=y.sourceID,this.projection=y.projection}createArrays(){this.text=new Ud(new fa(this.layers,this.zoom,y=>/^text/.test(y))),this.icon=new Ud(new fa(this.layers,this.zoom,y=>/^icon/.test(y))),this.glyphOffsetArray=new op,this.lineVertexArray=new sp,this.symbolInstances=new ip}calculateGlyphDependencies(y,I,G,Q,ne){for(let he=0;he<y.length;he++)if(I[y.charCodeAt(he)]=!0,Q&&ne){const ge=Fc[y.charAt(he)];ge&&(I[ge.charCodeAt(0)]=!0)}}populate(y,I,G,Q){const ne=this.layers[0],he=ne.layout,ge=this.projection.name==="globe",we=he.get("text-font"),Ee=he.get("text-field"),ke=he.get("icon-image"),De=(Ee.value.kind!=="constant"||Ee.value.value instanceof Pi&&!Ee.value.value.isEmpty()||Ee.value.value.toString().length>0)&&(we.value.kind!=="constant"||we.value.value.length>0),Oe=ke.value.kind!=="constant"||!!ke.value.value||Object.keys(ke.parameters).length>0,Ne=he.get("symbol-sort-key");if(this.features=[],!De&&!Oe)return;const Ge=I.iconDependencies,We=I.glyphDependencies,Je=I.availableImages,st=new tt(this.zoom);for(const{feature:pt,id:ct,index:ht,sourceLayerIndex:bt}of y){const mt=ne._featureFilter.needGeometry,$t=ma(pt,mt);if(!ne._featureFilter.filter(st,$t,G))continue;if(mt||($t.geometry=ns(pt,G,Q)),ge&&pt.type!==1&&G.z<=5){const Nt=$t.geometry,Kt=.98078528056;for(let nn=0;nn<Nt.length;nn++)Nt[nn]=Hm(Nt[nn],Yt=>Yt,(Yt,hn)=>ao(Vc(Yt.x,Yt.y,G,1),Vc(hn.x,hn.y,G,1))<Kt)}let Ft,Ht;if(De){const Nt=ne.getValueAndResolveTokens("text-field",$t,G,Je),Kt=Pi.factory(Nt);Gg(Kt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ye()==="unavailable"||this.hasRTLText&&et.isParsed())&&(Ft=Q_(Kt,ne,$t))}if(Oe){const Nt=ne.getValueAndResolveTokens("icon-image",$t,G,Je);Ht=Nt instanceof ki?Nt:ki.fromString(Nt)}if(!Ft&&!Ht)continue;const pn=this.sortFeaturesByKey?Ne.evaluate($t,{},G):void 0;if(this.features.push({id:ct,text:Ft,icon:Ht,index:ht,sourceLayerIndex:bt,geometry:$t.geometry,properties:pt.properties,type:jg[pt.type],sortKey:pn}),Ht&&(Ge[Ht.name]=!0),Ft){const Nt=we.evaluate($t,{},G).join(","),Kt=he.get("text-rotation-alignment")==="map"&&he.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(no.vertical)>=0;for(const nn of Ft.sections)if(nn.image)Ge[nn.image.name]=!0;else{const Yt=sl(Ft.toString()),hn=nn.fontStack||Nt,rn=We[hn]=We[hn]||{};this.calculateGlyphDependencies(nn.text,rn,Kt,this.allowVerticalPlacement,Yt)}}}he.get("symbol-placement")==="line"&&(this.features=function(pt){const ct={},ht={},bt=[];let mt=0;function $t(Nt){bt.push(pt[Nt]),mt++}function Ft(Nt,Kt,nn){const Yt=ht[Nt];return delete ht[Nt],ht[Kt]=Yt,bt[Yt].geometry[0].pop(),bt[Yt].geometry[0]=bt[Yt].geometry[0].concat(nn[0]),Yt}function Ht(Nt,Kt,nn){const Yt=ct[Kt];return delete ct[Kt],ct[Nt]=Yt,bt[Yt].geometry[0].shift(),bt[Yt].geometry[0]=nn[0].concat(bt[Yt].geometry[0]),Yt}function pn(Nt,Kt,nn){const Yt=nn?Kt[0][Kt[0].length-1]:Kt[0][0];return`${Nt}:${Yt.x}:${Yt.y}`}for(let Nt=0;Nt<pt.length;Nt++){const Kt=pt[Nt],nn=Kt.geometry,Yt=Kt.text?Kt.text.toString():null;if(!Yt){$t(Nt);continue}const hn=pn(Yt,nn),rn=pn(Yt,nn,!0);if(hn in ht&&rn in ct&&ht[hn]!==ct[rn]){const En=Ht(hn,rn,nn),nr=Ft(hn,rn,bt[En].geometry);delete ct[hn],delete ht[rn],ht[pn(Yt,bt[nr].geometry,!0)]=nr,bt[En].geometry=null}else hn in ht?Ft(hn,rn,nn):rn in ct?Ht(hn,rn,nn):($t(Nt),ct[hn]=mt-1,ht[rn]=mt-1)}return bt.filter(Nt=>Nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pt,ct)=>pt.sortKey-ct.sortKey)}update(y,I,G,Q){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(y,I,this.layers,G,Q),this.icon.programConfigurations.updatePaintArrays(y,I,this.layers,G,Q))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(y){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(y),this.iconCollisionBox.upload(y)),this.text.upload(y,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(y,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(y,I){const G=this.lineVertexArray.length,Q=y.segment;if(Q!==void 0){let ne=y.dist(I[Q+1]),he=y.dist(I[Q]);const ge={};for(let we=Q+1;we<I.length;we++)ge[we]={x:I[we].x,y:I[we].y,tileUnitDistanceFromAnchor:ne},we<I.length-1&&(ne+=I[we+1].dist(I[we]));for(let we=Q||0;we>=0;we--)ge[we]={x:I[we].x,y:I[we].y,tileUnitDistanceFromAnchor:he},we>0&&(he+=I[we-1].dist(I[we]));for(let we=0;we<I.length;we++){const Ee=ge[we];this.lineVertexArray.emplaceBack(Ee.x,Ee.y,Ee.tileUnitDistanceFromAnchor)}}return{lineStartIndex:G,lineLength:this.lineVertexArray.length-G}}addSymbols(y,I,G,Q,ne,he,ge,we,Ee,ke,De,Oe,Ne,Ge){const We=y.indexArray,Je=y.layoutVertexArray,st=y.globeExtVertexArray,pt=y.segments.prepareSegment(4*I.length,Je,We,this.canOverlap?he.sortKey:void 0),ct=this.glyphOffsetArray.length,ht=pt.vertexLength,bt=this.allowVerticalPlacement&&ge===no.vertical?Math.PI/2:0,mt=he.text&&he.text.sections;for(let Ft=0;Ft<I.length;Ft++){const{tl:Ht,tr:pn,bl:Nt,br:Kt,tex:nn,pixelOffsetTL:Yt,pixelOffsetBR:hn,minFontScaleX:rn,minFontScaleY:En,glyphOffset:nr,isSDF:or,sectionIndex:Fn}=I[Ft],vn=pt.vertexLength,mr=nr[1];if(wh(Je,Ee.x,Ee.y,Ht.x,mr+Ht.y,nn.x,nn.y,G,or,Yt.x,Yt.y,rn,En),wh(Je,Ee.x,Ee.y,pn.x,mr+pn.y,nn.x+nn.w,nn.y,G,or,hn.x,Yt.y,rn,En),wh(Je,Ee.x,Ee.y,Nt.x,mr+Nt.y,nn.x,nn.y+nn.h,G,or,Yt.x,hn.y,rn,En),wh(Je,Ee.x,Ee.y,Kt.x,mr+Kt.y,nn.x+nn.w,nn.y+nn.h,G,or,hn.x,hn.y,rn,En),we){const Kn=we.anchor,Mn=we.up;Th(st,Kn.x,Kn.y,Kn.z,Mn[0],Mn[1],Mn[2]),Th(st,Kn.x,Kn.y,Kn.z,Mn[0],Mn[1],Mn[2]),Th(st,Kn.x,Kn.y,Kn.z,Mn[0],Mn[1],Mn[2]),Th(st,Kn.x,Kn.y,Kn.z,Mn[0],Mn[1],Mn[2]),Eh(y.dynamicLayoutVertexArray,Kn.x,Kn.y,Kn.z,bt)}else Eh(y.dynamicLayoutVertexArray,Ee.x,Ee.y,Ee.z,bt);We.emplaceBack(vn,vn+1,vn+2),We.emplaceBack(vn+1,vn+2,vn+3),pt.vertexLength+=4,pt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nr[0]),Ft!==I.length-1&&Fn===I[Ft+1].sectionIndex||y.programConfigurations.populatePaintArrays(Je.length,he,he.index,{},Ne,Ge,mt&&mt[Fn])}const $t=we?we.anchor:Ee;y.placedSymbolArray.emplaceBack($t.x,$t.y,$t.z,Ee.x,Ee.y,ct,this.glyphOffsetArray.length-ct,ht,ke,De,Ee.segment,G?G[0]:0,G?G[1]:0,Q[0],Q[1],ge,0,!1,0,Oe,0)}_commitLayoutVertex(y,I,G,Q,ne,he,ge){y.emplaceBack(I,G,Q,ne,he,Math.round(ge.x),Math.round(ge.y))}_addCollisionDebugVertices(y,I,G,Q,ne,he,ge){const we=G.segments.prepareSegment(4,G.layoutVertexArray,G.indexArray),Ee=we.vertexLength,ke=ge.tileAnchorX,De=ge.tileAnchorY;for(let Ne=0;Ne<4;Ne++)G.collisionVertexArray.emplaceBack(0,0,0,0);G.collisionVertexArrayExt.emplaceBack(I,-y.padding,-y.padding),G.collisionVertexArrayExt.emplaceBack(I,y.padding,-y.padding),G.collisionVertexArrayExt.emplaceBack(I,y.padding,y.padding),G.collisionVertexArrayExt.emplaceBack(I,-y.padding,y.padding),this._commitLayoutVertex(G.layoutVertexArray,Q,ne,he,ke,De,new ze(y.x1,y.y1)),this._commitLayoutVertex(G.layoutVertexArray,Q,ne,he,ke,De,new ze(y.x2,y.y1)),this._commitLayoutVertex(G.layoutVertexArray,Q,ne,he,ke,De,new ze(y.x2,y.y2)),this._commitLayoutVertex(G.layoutVertexArray,Q,ne,he,ke,De,new ze(y.x1,y.y2)),we.vertexLength+=4;const Oe=G.indexArray;Oe.emplaceBack(Ee,Ee+1),Oe.emplaceBack(Ee+1,Ee+2),Oe.emplaceBack(Ee+2,Ee+3),Oe.emplaceBack(Ee+3,Ee),we.primitiveLength+=4}_addTextDebugCollisionBoxes(y,I,G,Q,ne,he){for(let ge=Q;ge<ne;ge++){const we=G.get(ge),Ee=this.getSymbolInstanceTextSize(y,he,I,ge);this._addCollisionDebugVertices(we,Ee,this.textCollisionBox,we.projectedAnchorX,we.projectedAnchorY,we.projectedAnchorZ,he)}}_addIconDebugCollisionBoxes(y,I,G,Q,ne,he){for(let ge=Q;ge<ne;ge++){const we=G.get(ge),Ee=this.getSymbolInstanceIconSize(y,I,ge);this._addCollisionDebugVertices(we,Ee,this.iconCollisionBox,we.projectedAnchorX,we.projectedAnchorY,we.projectedAnchorZ,he)}}generateCollisionDebugBuffers(y,I){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $d(to,_f.members,Si),this.iconCollisionBox=new $d(to,_f.members,Si);const G=ml(this.iconSizeData,y),Q=ml(this.textSizeData,y);for(let ne=0;ne<this.symbolInstances.length;ne++){const he=this.symbolInstances.get(ne);this._addTextDebugCollisionBoxes(Q,y,I,he.textBoxStartIndex,he.textBoxEndIndex,he),this._addTextDebugCollisionBoxes(Q,y,I,he.verticalTextBoxStartIndex,he.verticalTextBoxEndIndex,he),this._addIconDebugCollisionBoxes(G,y,I,he.iconBoxStartIndex,he.iconBoxEndIndex,he),this._addIconDebugCollisionBoxes(G,y,I,he.verticalIconBoxStartIndex,he.verticalIconBoxEndIndex,he)}}getSymbolInstanceTextSize(y,I,G,Q){const ne=this.text.placedSymbolArray.get(I.rightJustifiedTextSymbolIndex>=0?I.rightJustifiedTextSymbolIndex:I.centerJustifiedTextSymbolIndex>=0?I.centerJustifiedTextSymbolIndex:I.leftJustifiedTextSymbolIndex>=0?I.leftJustifiedTextSymbolIndex:I.verticalPlacedTextSymbolIndex>=0?I.verticalPlacedTextSymbolIndex:Q),he=uh(this.textSizeData,y,ne)/Ti;return this.tilePixelRatio*he}getSymbolInstanceIconSize(y,I,G){const Q=this.icon.placedSymbolArray.get(G),ne=uh(this.iconSizeData,y,Q);return this.tilePixelRatio*ne}_commitDebugCollisionVertexUpdate(y,I,G){y.emplaceBack(I,-G,-G),y.emplaceBack(I,G,-G),y.emplaceBack(I,G,G),y.emplaceBack(I,-G,G)}_updateTextDebugCollisionBoxes(y,I,G,Q,ne,he){for(let ge=Q;ge<ne;ge++){const we=G.get(ge),Ee=this.getSymbolInstanceTextSize(y,he,I,ge);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,Ee,we.padding)}}_updateIconDebugCollisionBoxes(y,I,G,Q,ne){for(let he=Q;he<ne;he++){const ge=G.get(he),we=this.getSymbolInstanceIconSize(y,I,he);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,we,ge.padding)}}updateCollisionDebugBuffers(y,I){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const G=ml(this.iconSizeData,y),Q=ml(this.textSizeData,y);for(let ne=0;ne<this.symbolInstances.length;ne++){const he=this.symbolInstances.get(ne);this._updateTextDebugCollisionBoxes(Q,y,I,he.textBoxStartIndex,he.textBoxEndIndex,he),this._updateTextDebugCollisionBoxes(Q,y,I,he.verticalTextBoxStartIndex,he.verticalTextBoxEndIndex,he),this._updateIconDebugCollisionBoxes(G,y,I,he.iconBoxStartIndex,he.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(G,y,I,he.verticalIconBoxStartIndex,he.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(y,I,G,Q,ne,he,ge,we,Ee){const ke={};for(let De=I;De<G;De++){const Oe=y.get(De);ke.textBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,padding:Oe.padding,projectedAnchorX:Oe.projectedAnchorX,projectedAnchorY:Oe.projectedAnchorY,projectedAnchorZ:Oe.projectedAnchorZ,tileAnchorX:Oe.tileAnchorX,tileAnchorY:Oe.tileAnchorY},ke.textFeatureIndex=Oe.featureIndex;break}for(let De=Q;De<ne;De++){const Oe=y.get(De);ke.verticalTextBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,padding:Oe.padding,projectedAnchorX:Oe.projectedAnchorX,projectedAnchorY:Oe.projectedAnchorY,projectedAnchorZ:Oe.projectedAnchorZ,tileAnchorX:Oe.tileAnchorX,tileAnchorY:Oe.tileAnchorY},ke.verticalTextFeatureIndex=Oe.featureIndex;break}for(let De=he;De<ge;De++){const Oe=y.get(De);ke.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,padding:Oe.padding,projectedAnchorX:Oe.projectedAnchorX,projectedAnchorY:Oe.projectedAnchorY,projectedAnchorZ:Oe.projectedAnchorZ,tileAnchorX:Oe.tileAnchorX,tileAnchorY:Oe.tileAnchorY},ke.iconFeatureIndex=Oe.featureIndex;break}for(let De=we;De<Ee;De++){const Oe=y.get(De);ke.verticalIconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,padding:Oe.padding,projectedAnchorX:Oe.projectedAnchorX,projectedAnchorY:Oe.projectedAnchorY,projectedAnchorZ:Oe.projectedAnchorZ,tileAnchorX:Oe.tileAnchorX,tileAnchorY:Oe.tileAnchorY},ke.verticalIconFeatureIndex=Oe.featureIndex;break}return ke}deserializeCollisionBoxes(y){this.collisionArrays=[];for(let I=0;I<this.symbolInstances.length;I++){const G=this.symbolInstances.get(I);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(y,G.textBoxStartIndex,G.textBoxEndIndex,G.verticalTextBoxStartIndex,G.verticalTextBoxEndIndex,G.iconBoxStartIndex,G.iconBoxEndIndex,G.verticalIconBoxStartIndex,G.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(y,I){const G=y.placedSymbolArray.get(I),Q=G.vertexStartIndex+4*G.numGlyphs;for(let ne=G.vertexStartIndex;ne<Q;ne+=4)y.indexArray.emplaceBack(ne,ne+1,ne+2),y.indexArray.emplaceBack(ne+1,ne+2,ne+3)}getSortedSymbolIndexes(y){if(this.sortedAngle===y&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const I=Math.sin(y),G=Math.cos(y),Q=[],ne=[],he=[];for(let ge=0;ge<this.symbolInstances.length;++ge){he.push(ge);const we=this.symbolInstances.get(ge);Q.push(0|Math.round(I*we.tileAnchorX+G*we.tileAnchorY)),ne.push(we.featureIndex)}return he.sort((ge,we)=>Q[ge]-Q[we]||ne[we]-ne[ge]),he}addToSortKeyRanges(y,I){const G=this.sortKeyRanges[this.sortKeyRanges.length-1];G&&G.sortKey===I?G.symbolInstanceEnd=y+1:this.sortKeyRanges.push({sortKey:I,symbolInstanceStart:y,symbolInstanceEnd:y+1})}sortFeatures(y){if(this.sortFeaturesByY&&this.sortedAngle!==y&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(y),this.sortedAngle=y,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const I of this.symbolInstanceIndexes){const G=this.symbolInstances.get(I);this.featureSortOrder.push(G.featureIndex),[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach((Q,ne,he)=>{Q>=0&&he.indexOf(Q)===ne&&this.addIndicesForPlacedSymbol(this.text,Q)}),G.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,G.verticalPlacedTextSymbolIndex),G.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,G.placedIconSymbolIndex),G.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,G.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pn(Rs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Rs.MAX_GLYPHS=65535,Rs.addDynamicAttributes=Eh;const qg=new Xt({"symbol-placement":new _t(Zt.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(Zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(Zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(Zt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(Zt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _t(Zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(Zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(Zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Zt.layout_symbol["icon-size"]),"icon-text-fit":new _t(Zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(Zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Zt.layout_symbol["icon-image"]),"icon-rotate":new St(Zt.layout_symbol["icon-rotate"]),"icon-padding":new _t(Zt.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(Zt.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Zt.layout_symbol["icon-offset"]),"icon-anchor":new St(Zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(Zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(Zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(Zt.layout_symbol["text-rotation-alignment"]),"text-field":new St(Zt.layout_symbol["text-field"]),"text-font":new St(Zt.layout_symbol["text-font"]),"text-size":new St(Zt.layout_symbol["text-size"]),"text-max-width":new St(Zt.layout_symbol["text-max-width"]),"text-line-height":new St(Zt.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Zt.layout_symbol["text-letter-spacing"]),"text-justify":new St(Zt.layout_symbol["text-justify"]),"text-radial-offset":new St(Zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(Zt.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Zt.layout_symbol["text-anchor"]),"text-max-angle":new _t(Zt.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(Zt.layout_symbol["text-writing-mode"]),"text-rotate":new St(Zt.layout_symbol["text-rotate"]),"text-padding":new _t(Zt.layout_symbol["text-padding"]),"text-keep-upright":new _t(Zt.layout_symbol["text-keep-upright"]),"text-transform":new St(Zt.layout_symbol["text-transform"]),"text-offset":new St(Zt.layout_symbol["text-offset"]),"text-allow-overlap":new _t(Zt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _t(Zt.layout_symbol["text-ignore-placement"]),"text-optional":new _t(Zt.layout_symbol["text-optional"])});var Nd={paint:new Xt({"icon-opacity":new St(Zt.paint_symbol["icon-opacity"]),"icon-color":new St(Zt.paint_symbol["icon-color"]),"icon-halo-color":new St(Zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Zt.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(Zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(Zt.paint_symbol["icon-translate-anchor"]),"text-opacity":new St(Zt.paint_symbol["text-opacity"]),"text-color":new St(Zt.paint_symbol["text-color"],{runtimeType:Yi,getOverride:U=>U.textColor,hasOverride:U=>!!U.textColor}),"text-halo-color":new St(Zt.paint_symbol["text-halo-color"]),"text-halo-width":new St(Zt.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Zt.paint_symbol["text-halo-blur"]),"text-translate":new _t(Zt.paint_symbol["text-translate"]),"text-translate-anchor":new _t(Zt.paint_symbol["text-translate-anchor"])}),layout:qg};class im{constructor(y){this.type=y.property.overrides?y.property.overrides.runtimeType:cs,this.defaultValue=y}evaluate(y){if(y.formattedSection){const I=this.defaultValue.property.overrides;if(I&&I.hasOverride(y.formattedSection))return I.getOverride(y.formattedSection)}return y.feature&&y.featureState?this.defaultValue.evaluate(y.feature,y.featureState):this.defaultValue.property.specification.default}eachChild(y){this.defaultValue.isConstant()||y(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pn(im,"FormatSectionOverride",{omit:["defaultValue"]});class Ah extends _o{constructor(y){super(y,Nd)}recalculate(y,I){super.recalculate(y,I),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const G=this.layout.get("text-writing-mode");if(G){const Q=[];for(const ne of G)Q.indexOf(ne)<0&&Q.push(ne);this.layout._values["text-writing-mode"]=Q}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(y,I,G,Q){const ne=this.layout.get(y).evaluate(I,{},G,Q),he=this._unevaluatedLayout._values[y];return he.isDataDriven()||Ka(he.value)||!ne?ne:function(ge,we){return we.replace(/{([^{}]+)}/g,(Ee,ke)=>ke in ge?String(ge[ke]):"")}(I.properties,ne)}createBucket(y){return new Rs(y)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const y of Nd.paint.overridableProperties){if(!Ah.hasPaintOverride(this.layout,y))continue;const I=this.paint.get(y),G=new im(I),Q=new oc(G,I.property.specification);let ne=null;ne=I.value.kind==="constant"||I.value.kind==="source"?new sc("source",Q):new ta("composite",Q,I.value.zoomStops,I.value._interpolationType),this.paint._values[y]=new dt(I.property,ne,I.parameters)}}_handleOverridablePaintPropertyUpdate(y,I,G){return!(!this.layout||I.isDataDriven()||G.isDataDriven())&&Ah.hasPaintOverride(this.layout,y)}static hasPaintOverride(y,I){const G=y.get("text-field"),Q=Nd.paint.properties[I];let ne=!1;const he=ge=>{for(const we of ge)if(Q.overrides&&Q.overrides.hasOverride(we))return void(ne=!0)};if(G.value.kind==="constant"&&G.value.value instanceof Pi)he(G.value.value.sections);else if(G.value.kind==="source"){const ge=Ee=>{ne||(Ee instanceof Vs&&ni(Ee.value)===Us?he(Ee.value.sections):Ee instanceof qs?he(Ee.sections):Ee.eachChild(ge))},we=G.value;we._styleExpression&&ge(we._styleExpression.expression)}return ne}getProgramConfiguration(y){return new Cs(this,y)}}var Zg={paint:new Xt({"background-color":new _t(Zt.paint_background["background-color"]),"background-pattern":new un(Zt.paint_background["background-pattern"]),"background-opacity":new _t(Zt.paint_background["background-opacity"])})},Hg={paint:new Xt({"raster-opacity":new _t(Zt.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(Zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(Zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(Zt.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(Zt.paint_raster["raster-saturation"]),"raster-contrast":new _t(Zt.paint_raster["raster-contrast"]),"raster-resampling":new _t(Zt.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(Zt.paint_raster["raster-fade-duration"])})};class Wg extends _o{constructor(y){super(y,{}),this.implementation=y}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(y){this.implementation.onAdd&&this.implementation.onAdd(y,y.painter.context.gl)}onRemove(y){this.implementation.onRemove&&this.implementation.onRemove(y,y.painter.context.gl)}}var Xg={paint:new Xt({"sky-type":new _t(Zt.paint_sky["sky-type"]),"sky-atmosphere-sun":new _t(Zt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _t(Zt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _t(Zt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _t(Zt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Rt(Zt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _t(Zt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _t(Zt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _t(Zt.paint_sky["sky-opacity"])})};function jd(U,y,I){const G=[0,0,1],Q=Fp([]);return $p(Q,Q,I?-Ke(U)+Math.PI:Ke(U)),Up(Q,Q,-Ke(y)),Lp(G,G,Q),Ri(G,G)}const Kg={circle:class extends _o{constructor(U){super(U,e_)}createBucket(U){return new rd(U)}queryRadius(U){const y=U;return ul("circle-radius",this,y)+ul("circle-stroke-width",this,y)+Ku(this.paint.get("circle-translate"))}queryIntersectsFeature(U,y,I,G,Q,ne,he,ge){const we=Mp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),ne.angle,U.pixelToTileUnitsFactor),Ee=this.paint.get("circle-radius").evaluate(y,I)+this.paint.get("circle-stroke-width").evaluate(y,I);return Np(U,G,ne,he,ge,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",we,Ee)}getProgramIds(){return["circle"]}getProgramConfiguration(U){return new Cs(this,U)}},heatmap:class extends _o{createBucket(U){return new Vp(U)}constructor(U){super(U,a_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(U){U==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(U){return ul("heatmap-radius",this,U)}queryIntersectsFeature(U,y,I,G,Q,ne,he,ge){const we=this.paint.get("heatmap-radius").evaluate(y,I);return Np(U,G,ne,he,ge,!0,!0,new ze(0,0),we)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(U){return new Cs(this,U)}},hillshade:class extends _o{constructor(U){super(U,l_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends _o{constructor(U){super(U,A_)}getProgramIds(){const U=this.paint.get("fill-pattern"),y=U&&U.constantOr(1),I=[y?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&I.push(y&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),I}getProgramConfiguration(U){return new Cs(this,U)}recalculate(U,y){super.recalculate(U,y);const I=this.paint._values["fill-outline-color"];I.value.kind==="constant"&&I.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(U){return new oh(U)}queryRadius(){return Ku(this.paint.get("fill-translate"))}queryIntersectsFeature(U,y,I,G,Q,ne){return!U.queryGeometry.isAboveHorizon&&Ep(Ip(U.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),ne.angle,U.pixelToTileUnitsFactor),G)}isTileClipped(){return!0}},"fill-extrusion":class extends _o{constructor(U){super(U,F_)}createBucket(U){return new Lc(U)}queryRadius(){return Ku(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(U){return new Cs(this,U)}queryIntersectsFeature(U,y,I,G,Q,ne,he,ge,we){const Ee=Mp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),ne.angle,U.pixelToTileUnitsFactor),ke=this.paint.get("fill-extrusion-height").evaluate(y,I),De=this.paint.get("fill-extrusion-base").evaluate(y,I),Oe=[0,0],Ne=ge&&ne.elevation,Ge=ne.elevation?ne.elevation.exaggeration():1,We=U.tile.getBucket(this);if(Ne&&We instanceof Lc){const pt=We.centroidVertexArray,ct=we+1;if(ct<pt.length){const ht=pt.get(ct);Oe[0]=ht.a_centroid_pos0,Oe[1]=ht.a_centroid_pos1}}if(Oe[0]===0&&Oe[1]===1)return!1;ne.projection.name==="globe"&&(G=lf([G],[new ze(0,0),new ze(Hn,Hn)],U.tileID.canonical).map(pt=>pt.polygon).flat());const Je=function(pt,ct,ht,bt,mt,$t,Ft,Ht,pn,Nt,Kt){return pt.projection.name==="globe"?function(nn,Yt,hn,rn,En,nr,or,Fn,vn,mr,Kn){const Mn=[],Nr=[],Or=nn.projection.upVectorScale(Kn,nn.center.lat,nn.worldSize).metersToTile,Wr=[0,0,0,1],ar=[0,0,0,1],Er=(Fr,Lr,Zr,Yr)=>{Fr[0]=Lr,Fr[1]=Zr,Fr[2]=Yr,Fr[3]=1},jr=af();hn>0&&(hn+=jr),rn+=jr;for(const Fr of Yt){const Lr=[],Zr=[];for(const Yr of Fr){const fi=Yr.x+En.x,$i=Yr.y+En.y,yr=nn.projection.projectTilePoint(fi,$i,Kn),ti=nn.projection.upVector(Kn,Yr.x,Yr.y);let Ii=hn,Cr=rn;if(or){const Jr=df(fi,$i,hn,rn,or,Fn,vn,mr);Ii+=Jr.base,Cr+=Jr.top}hn!==0?Er(Wr,yr.x+ti[0]*Or*Ii,yr.y+ti[1]*Or*Ii,yr.z+ti[2]*Or*Ii):Er(Wr,yr.x,yr.y,yr.z),Er(ar,yr.x+ti[0]*Or*Cr,yr.y+ti[1]*Or*Cr,yr.z+ti[2]*Or*Cr),ci(Wr,Wr,nr),ci(ar,ar,nr),Lr.push(lh(Wr)),Zr.push(lh(ar))}Mn.push(Lr),Nr.push(Zr)}return[Mn,Nr]}(pt,ct,ht,bt,mt,$t,Ft,Ht,pn,Nt,Kt):Ft?function(nn,Yt,hn,rn,En,nr,or,Fn,vn){const mr=[],Kn=[],Mn=[0,0,0,1];for(const Nr of nn){const Or=[],Wr=[];for(const ar of Nr){const Er=ar.x+rn.x,jr=ar.y+rn.y,Fr=df(Er,jr,Yt,hn,nr,or,Fn,vn);Mn[0]=Er,Mn[1]=jr,Mn[2]=Fr.base,Mn[3]=1,ya(Mn,Mn,En),Mn[3]=Math.max(Mn[3],1e-5);const Lr=lh([Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]]);Mn[0]=Er,Mn[1]=jr,Mn[2]=Fr.top,Mn[3]=1,ya(Mn,Mn,En),Mn[3]=Math.max(Mn[3],1e-5);const Zr=lh([Mn[0]/Mn[3],Mn[1]/Mn[3],Mn[2]/Mn[3]]);Or.push(Lr),Wr.push(Zr)}mr.push(Or),Kn.push(Wr)}return[mr,Kn]}(ct,ht,bt,mt,$t,Ft,Ht,pn,Nt):function(nn,Yt,hn,rn,En){const nr=[],or=[],Fn=En[8]*Yt,vn=En[9]*Yt,mr=En[10]*Yt,Kn=En[11]*Yt,Mn=En[8]*hn,Nr=En[9]*hn,Or=En[10]*hn,Wr=En[11]*hn;for(const ar of nn){const Er=[],jr=[];for(const Fr of ar){const Lr=Fr.x+rn.x,Zr=Fr.y+rn.y,Yr=En[0]*Lr+En[4]*Zr+En[12],fi=En[1]*Lr+En[5]*Zr+En[13],$i=En[2]*Lr+En[6]*Zr+En[14],yr=En[3]*Lr+En[7]*Zr+En[15],ti=Yr+Fn,Ii=fi+vn,Cr=$i+mr,Jr=Math.max(yr+Kn,1e-5),Di=Yr+Mn,Xr=fi+Nr,ri=$i+Or,mi=Math.max(yr+Wr,1e-5),hi=new ze(ti/Jr,Ii/Jr);hi.z=Cr/Jr,Er.push(hi);const Ei=new ze(Di/mi,Xr/mi);Ei.z=ri/mi,jr.push(Ei)}nr.push(Er),or.push(jr)}return[nr,or]}(ct,ht,bt,mt,$t)}(ne,G,De,ke,Ee,he,Ne?ge:null,Oe,Ge,ne.center.lat,U.tileID.canonical),st=U.queryGeometry;return function(pt,ct,ht){let bt=1/0;Ep(ht,ct)&&(bt=hf(ht,ct[0]));for(let mt=0;mt<ct.length;mt++){const $t=ct[mt],Ft=pt[mt];for(let Ht=0;Ht<$t.length-1;Ht++){const pn=$t[Ht],Nt=[pn,$t[Ht+1],Ft[Ht+1],Ft[Ht],pn];Tp(ht,Nt)&&(bt=Math.min(bt,hf(ht,Nt)))}}return bt!==1/0&&bt}(Je[0],Je[1],st.isPointQuery()?st.screenBounds:st.screenGeometry)}},line:class extends _o{constructor(U){super(U,pf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(U){if(U==="line-gradient"){const y=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=y._styleExpression&&y._styleExpression.expression instanceof Ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(U,y){super.recalculate(U,y),this.paint._values["line-floorwidth"]=ff.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,U)}createBucket(U){return new ch(U)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(U){return new Cs(this,U)}queryRadius(U){const y=U,I=mf(ul("line-width",this,y),ul("line-gap-width",this,y)),G=ul("line-offset",this,y);return I/2+Math.abs(G)+Ku(this.paint.get("line-translate"))}queryIntersectsFeature(U,y,I,G,Q,ne){if(U.queryGeometry.isAboveHorizon)return!1;const he=Ip(U.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),ne.angle,U.pixelToTileUnitsFactor),ge=U.pixelToTileUnitsFactor/2*mf(this.paint.get("line-width").evaluate(y,I),this.paint.get("line-gap-width").evaluate(y,I)),we=this.paint.get("line-offset").evaluate(y,I);return we&&(G=function(Ee,ke){const De=[],Oe=new ze(0,0);for(let Ne=0;Ne<Ee.length;Ne++){const Ge=Ee[Ne],We=[];for(let Je=0;Je<Ge.length;Je++){const st=Ge[Je-1],pt=Ge[Je],ct=Ge[Je+1],ht=Je===0?Oe:pt.sub(st)._unit()._perp(),bt=Je===Ge.length-1?Oe:ct.sub(pt)._unit()._perp(),mt=ht._add(bt)._unit();mt._mult(1/(mt.x*bt.x+mt.y*bt.y)),We.push(mt._mult(ke)._add(pt))}De.push(We)}return De}(G,we*U.pixelToTileUnitsFactor)),function(Ee,ke,De){for(let Oe=0;Oe<ke.length;Oe++){const Ne=ke[Oe];if(Ee.length>=3){for(let Ge=0;Ge<Ne.length;Ge++)if(_a(Ee,Ne[Ge]))return!0}if(Km(Ee,Ne,De))return!0}return!1}(he,G,ge)}isTileClipped(){return!0}},symbol:Ah,background:class extends _o{constructor(U){super(U,Zg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends _o{constructor(U){super(U,Hg)}getProgramIds(){return["raster"]}},sky:class extends _o{constructor(U){super(U,Xg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(U){U==="sky-gradient"?this._updateColorRamp():U!=="sky-atmosphere-sun"&&U!=="sky-atmosphere-halo-color"&&U!=="sky-atmosphere-color"&&U!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(U){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const y=U.style.light.properties.get("position");return this._lightPosition.azimuthal!==y.azimuthal||this._lightPosition.polar!==y.polar}return!1}getCenter(U,y){if(this.paint.get("sky-type")==="atmosphere"){const G=this.paint.get("sky-atmosphere-sun"),Q=!G,ne=U.style.light,he=ne.properties.get("position");return Q&&ne.properties.get("anchor")==="viewport"&&er("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),Q?jd(he.azimuthal,90-he.polar,y):jd(G[0],90-G[1],y)}const I=this.paint.get("sky-gradient-center");return jd(I[0],90-I[1],y)}is3D(){return!1}isSky(){return!0}markSkyboxValid(U){this._skyboxInvalidated=!1,this._lightPosition=U.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const U=this.paint.get("sky-type");return U==="atmosphere"?["skyboxCapture","skybox"]:U==="gradient"?["skyboxGradient"]:null}}};class Kc{constructor(y,I,G,Q){this.context=y,this.format=G,this.texture=y.gl.createTexture(),this.update(I,Q)}update(y,I,G){const{width:Q,height:ne}=y,{context:he}=this,{gl:ge}=he,{HTMLImageElement:we,HTMLCanvasElement:Ee,HTMLVideoElement:ke,ImageData:De,ImageBitmap:Oe}=Ce;if(ge.bindTexture(ge.TEXTURE_2D,this.texture),he.pixelStoreUnpackFlipY.set(!1),he.pixelStoreUnpack.set(1),he.pixelStoreUnpackPremultiplyAlpha.set(this.format===ge.RGBA&&(!I||I.premultiply!==!1)),G||this.size&&this.size[0]===Q&&this.size[1]===ne){const{x:Ne,y:Ge}=G||{x:0,y:0};y instanceof we||y instanceof Ee||y instanceof ke||y instanceof De||Oe&&y instanceof Oe?ge.texSubImage2D(ge.TEXTURE_2D,0,Ne,Ge,ge.RGBA,ge.UNSIGNED_BYTE,y):ge.texSubImage2D(ge.TEXTURE_2D,0,Ne,Ge,Q,ne,ge.RGBA,ge.UNSIGNED_BYTE,y.data)}else this.size=[Q,ne],y instanceof we||y instanceof Ee||y instanceof ke||y instanceof De||Oe&&y instanceof Oe?ge.texImage2D(ge.TEXTURE_2D,0,this.format,this.format,ge.UNSIGNED_BYTE,y):ge.texImage2D(ge.TEXTURE_2D,0,this.format,Q,ne,0,this.format,ge.UNSIGNED_BYTE,y.data);this.useMipmap=Boolean(I&&I.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&ge.generateMipmap(ge.TEXTURE_2D)}bind(y,I){const{context:G}=this,{gl:Q}=G;Q.bindTexture(Q.TEXTURE_2D,this.texture),y!==this.filter&&(Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,y),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,this.useMipmap?y===Q.NEAREST?Q.NEAREST_MIPMAP_NEAREST:Q.LINEAR_MIPMAP_NEAREST:y),this.filter=y),I!==this.wrap&&(Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,I),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,I),this.wrap=I)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:y}=this.context;y.deleteTexture(this.texture),this.texture=null}}class Vd{constructor(y,I){this.width=y,this.height=I,this.nextRow=0,this.image=new rs({width:y,height:I}),this.positions={},this.uploaded=!1}getDash(y,I){const G=this.getKey(y,I);return this.positions[G]}trim(){const y=this.width,I=this.height=_n(this.nextRow);this.image.resize({width:y,height:I})}getKey(y,I){return y.join(",")+I}getDashRanges(y,I,G){const Q=[];let ne=y.length%2==1?-y[y.length-1]*G:0,he=y[0]*G,ge=!0;Q.push({left:ne,right:he,isDash:ge,zeroLength:y[0]===0});let we=y[0];for(let Ee=1;Ee<y.length;Ee++){ge=!ge;const ke=y[Ee];ne=we*G,we+=ke,he=we*G,Q.push({left:ne,right:he,isDash:ge,zeroLength:ke===0})}return Q}addRoundDash(y,I,G){const Q=I/2;for(let ne=-G;ne<=G;ne++){const he=this.width*(this.nextRow+G+ne);let ge=0,we=y[ge];for(let Ee=0;Ee<this.width;Ee++){Ee/we.right>1&&(we=y[++ge]);const ke=Math.abs(Ee-we.left),De=Math.abs(Ee-we.right),Oe=Math.min(ke,De);let Ne;const Ge=ne/G*(Q+1);if(we.isDash){const We=Q-Math.abs(Ge);Ne=Math.sqrt(Oe*Oe+We*We)}else Ne=Q-Math.sqrt(Oe*Oe+Ge*Ge);this.image.data[he+Ee]=Math.max(0,Math.min(255,Ne+128))}}}addRegularDash(y,I){for(let we=y.length-1;we>=0;--we){const Ee=y[we],ke=y[we+1];Ee.zeroLength?y.splice(we,1):ke&&ke.isDash===Ee.isDash&&(ke.left=Ee.left,y.splice(we,1))}const G=y[0],Q=y[y.length-1];G.isDash===Q.isDash&&(G.left=Q.left-this.width,Q.right=G.right+this.width);const ne=this.width*this.nextRow;let he=0,ge=y[he];for(let we=0;we<this.width;we++){we/ge.right>1&&(ge=y[++he]);const Ee=Math.abs(we-ge.left),ke=Math.abs(we-ge.right),De=Math.min(Ee,ke);this.image.data[ne+we]=Math.max(0,Math.min(255,(ge.isDash?De:-De)+I+128))}}addDash(y,I){const G=this.getKey(y,I);if(this.positions[G])return this.positions[G];const Q=I==="round",ne=Q?7:0,he=2*ne+1;if(this.nextRow+he>this.height)return er("LineAtlas out of space"),null;y.length===0&&y.push(1);let ge=0;for(let ke=0;ke<y.length;ke++)y[ke]<0&&(er("Negative value is found in line dasharray, replacing values with 0"),y[ke]=0),ge+=y[ke];if(ge!==0){const ke=this.width/ge,De=this.getDashRanges(y,this.width,ke);Q?this.addRoundDash(De,ke,ne):this.addRegularDash(De,I==="square"?.5*ke:0)}const we=this.nextRow+ne;this.nextRow+=he;const Ee={tl:[we,ne],br:[ge,0]};return this.positions[G]=Ee,Ee}}Pn(Vd,"LineAtlas");class Yg{constructor(y){this._callback=y,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Jg{constructor(){this.tasks={},this.taskQueue=[],bn(["process"],this),this.invoker=new Yg(this.process),this.nextId=0}add(y,I){const G=this.nextId++,Q=function({type:ne,isSymbolTile:he,zoom:ge}){return ge=ge||0,ne==="message"?0:ne!=="maybePrepare"||he?ne!=="parseTile"||he?ne==="parseTile"&&he?300-ge:ne==="maybePrepare"&&he?400-ge:500:200-ge:100-ge}(I);if(Q===0){Wt();try{y()}finally{}return{cancel:()=>{}}}return this.tasks[G]={fn:y,metadata:I,priority:Q,id:G},this.taskQueue.push(G),this.invoker.trigger(),{cancel:()=>{delete this.tasks[G]}}}process(){Wt();try{if(this.taskQueue=this.taskQueue.filter(G=>!!this.tasks[G]),!this.taskQueue.length)return;const y=this.pick();if(y===null)return;const I=this.tasks[y];if(delete this.tasks[y],this.taskQueue.length&&this.invoker.trigger(),!I)return;I.fn()}finally{}}pick(){let y=null,I=1/0;for(let Q=0;Q<this.taskQueue.length;Q++){const ne=this.tasks[this.taskQueue[Q]];ne.priority<I&&(I=ne.priority,y=Q)}if(y===null)return null;const G=this.taskQueue[y];return this.taskQueue.splice(y,1),G}remove(){this.invoker.remove()}}class om{constructor(y){this._stringToNumber={},this._numberToString=[];for(let I=0;I<y.length;I++){const G=y[I];this._stringToNumber[G]=I,this._numberToString[I]=G}}encode(y){return this._stringToNumber[y]}decode(y){return this._numberToString[y]}}const Qg=["tile","layer","source","sourceLayer","state"];class sm{constructor(y,I,G,Q,ne){this.type="Feature",this._vectorTileFeature=y,this._z=I,this._x=G,this._y=Q,this.properties=y.properties,this.id=ne}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(y){this._geometry=y}toJSON(){const y={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(y.id=this.id);for(const I of Qg)this[I]!==void 0&&(y[I]=this[I]);return y}}const lo=32,Uo=33,zs=new Uint16Array(8184);for(let U=0;U<2046;U++){let y=U+2,I=0,G=0,Q=0,ne=0,he=0,ge=0;for(1&y?Q=ne=he=lo:I=G=ge=lo;(y>>=1)>1;){const Ee=I+Q>>1,ke=G+ne>>1;1&y?(Q=I,ne=G,I=he,G=ge):(I=Q,G=ne,Q=he,ne=ge),he=Ee,ge=ke}const we=4*U;zs[we+0]=I,zs[we+1]=G,zs[we+2]=Q,zs[we+3]=ne}const $o=new Uint16Array(2178),Ds=new Uint8Array(1089),Sh=new Uint16Array(1089);function am(U){return U===0?-.03125:U===32?.03125:0}var lm=Jt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const cm={type:2,extent:Hn,loadGeometry:()=>[[new ze(0,0),new ze(8193,0),new ze(8193,8193),new ze(0,8193),new ze(0,0)]]};class Gd{constructor(y,I,G,Q,ne){this.tileID=y,this.uid=Vt(),this.uses=0,this.tileSize=I,this.tileZoom=G,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=ne,this.expiredRequestCount=0,this.state="loading",Q&&Q.transform&&(this.projection=Q.transform.projection)}registerFadeDuration(y){const I=y+this.timeAdded;I<yn.now()||this.fadeEndTime&&I<this.fadeEndTime||(this.fadeEndTime=I)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ba(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(y,I,G){if(this.unloadVectorData(),this.state="loaded",y){y.featureIndex&&(this.latestFeatureIndex=y.featureIndex,y.rawTileData?(this.latestRawTileData=y.rawTileData,this.latestFeatureIndex.rawTileData=y.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=y.collisionBoxArray,this.buckets=function(Q,ne){const he={};if(!ne)return he;for(const ge of Q){const we=ge.layerIds.map(Ee=>ne.getLayer(Ee)).filter(Boolean);if(we.length!==0){ge.layers=we,ge.stateDependentLayerIds&&(ge.stateDependentLayers=ge.stateDependentLayerIds.map(Ee=>we.filter(ke=>ke.id===Ee)[0]));for(const Ee of we)he[Ee.id]=ge}}return he}(y.buckets,I.style),this.hasSymbolBuckets=!1;for(const Q in this.buckets){const ne=this.buckets[Q];if(ne instanceof Rs){if(this.hasSymbolBuckets=!0,!G)break;ne.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const Q in this.buckets){const ne=this.buckets[Q];if(ne instanceof Rs&&ne.hasRTLText){this.hasRTLText=!0,et.isLoading()||et.isLoaded()||Ye()!=="deferred"||rt();break}}this.queryPadding=0;for(const Q in this.buckets){const ne=this.buckets[Q];this.queryPadding=Math.max(this.queryPadding,I.style.getLayer(Q).queryRadius(ne))}y.imageAtlas&&(this.imageAtlas=y.imageAtlas),y.glyphAtlasImage&&(this.glyphAtlasImage=y.glyphAtlasImage),y.lineAtlas&&(this.lineAtlas=y.lineAtlas)}else this.collisionBoxArray=new zo}unloadVectorData(){if(this.hasData()){for(const y in this.buckets)this.buckets[y].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(y){return this.buckets[y.id]}upload(y){for(const G in this.buckets){const Q=this.buckets[G];Q.uploadPending()&&Q.upload(y)}const I=y.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Kc(y,this.imageAtlas.image,I.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Kc(y,this.glyphAtlasImage,I.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Kc(y,this.lineAtlas.image,I.ALPHA),this.lineAtlas.uploaded=!0)}prepare(y){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(y,this.imageAtlasTexture)}queryRenderedFeatures(y,I,G,Q,ne,he,ge,we){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:Q,pixelPosMatrix:ge,transform:he,params:ne,tileTransform:this.tileTransform},y,I,G):{}}querySourceFeatures(y,I){const G=this.latestFeatureIndex;if(!G||!G.rawTileData)return;const Q=G.loadVTLayers(),ne=I?I.sourceLayer:"",he=Q._geojsonTileLayer||Q[ne];if(!he)return;const ge=oa(I&&I.filter),{z:we,x:Ee,y:ke}=this.tileID.canonical,De={z:we,x:Ee,y:ke};for(let Oe=0;Oe<he.length;Oe++){const Ne=he.feature(Oe);if(ge.needGeometry){const Je=ma(Ne,!0);if(!ge.filter(new tt(this.tileID.overscaledZ),Je,this.tileID.canonical))continue}else if(!ge.filter(new tt(this.tileID.overscaledZ),Ne))continue;const Ge=G.getId(Ne,ne),We=new sm(Ne,we,Ee,ke,Ge);We.tile=De,y.push(We)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(y){const I=this.expirationTime;if(y.cacheControl){const G=Rn(y.cacheControl);G["max-age"]&&(this.expirationTime=Date.now()+1e3*G["max-age"])}else y.expires&&(this.expirationTime=new Date(y.expires).getTime());if(this.expirationTime){const G=Date.now();let Q=!1;if(this.expirationTime>G)Q=!1;else if(I)if(this.expirationTime<I)Q=!0;else{const ne=this.expirationTime-I;ne?this.expirationTime=G+Math.max(ne,3e4):Q=!0}else Q=!0;Q?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(y,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(y).length===0||!I)return;const G=this.latestFeatureIndex.loadVTLayers(),Q=I.style.listImages();for(const ne in this.buckets){if(!I.style.hasLayer(ne))continue;const he=this.buckets[ne],ge=he.layers[0].sourceLayer||"_geojsonTileLayer",we=G[ge],Ee=y[ge];if(!we||!Ee||Object.keys(Ee).length===0)continue;if(he.update(Ee,we,Q,this.imageAtlas&&this.imageAtlas.patternPositions||{}),he instanceof ch||he instanceof oh){const De=I.style._getSourceCache(he.layers[0].source);I._terrain&&I._terrain.enabled&&De&&he.programConfigurations.needsUpload&&I._terrain._clearRenderCacheForTile(De.id,this.tileID)}const ke=I&&I.style&&I.style.getLayer(ne);ke&&(this.queryPadding=Math.max(this.queryPadding,ke.queryRadius(he)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<yn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(y){this.symbolFadeHoldUntil=yn.now()+y}setTexture(y,I){const G=I.context,Q=G.gl;this.texture=I.getTileTexture(y.width),this.texture?this.texture.update(y,{useMipmap:!0}):(this.texture=new Kc(G,y,Q.RGBA,{useMipmap:!0}),this.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),G.extTextureFilterAnisotropic&&Q.texParameterf(Q.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax))}setDependencies(y,I){const G={};for(const Q of I)G[Q]=!0;this.dependencies[y]=G}hasDependency(y,I){for(const G of y){const Q=this.dependencies[G];if(Q){for(const ne of I)if(Q[ne])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(y,I){if(!I||I.name==="mercator"||this._tileDebugBuffer)return;const G=ns(cm,this.tileID.canonical,this.tileTransform)[0],Q=new xn,ne=new Xo;for(let he=0;he<G.length;he++){const{x:ge,y:we}=G[he];Q.emplaceBack(ge,we),ne.emplaceBack(he)}ne.emplaceBack(0),this._tileDebugIndexBuffer=y.createIndexBuffer(ne),this._tileDebugBuffer=y.createVertexBuffer(Q,jc.members),this._tileDebugSegments=ai.simpleSegment(0,0,Q.length,ne.length)}_makeTileBoundsBuffers(y,I){if(this._tileBoundsBuffer||!I||I.name==="mercator")return;const G=ns(cm,this.tileID.canonical,this.tileTransform)[0];let Q,ne;if(this.isRaster){const he=function(ge,we){const Ee=ba(ge,we),ke=Math.pow(2,ge.z);for(let Je=0;Je<Uo;Je++)for(let st=0;st<Uo;st++){const pt=so((ge.x+(st+am(st))/lo)/ke),ct=wi((ge.y+(Je+am(Je))/lo)/ke),ht=we.project(pt,ct),bt=Je*Uo+st;$o[2*bt+0]=Math.round((ht.x*Ee.scale-Ee.x)*Hn),$o[2*bt+1]=Math.round((ht.y*Ee.scale-Ee.y)*Hn)}Ds.fill(0),Sh.fill(0);for(let Je=2045;Je>=0;Je--){const st=4*Je,pt=zs[st+0],ct=zs[st+1],ht=zs[st+2],bt=zs[st+3],mt=pt+ht>>1,$t=ct+bt>>1,Ft=mt+$t-ct,Ht=$t+pt-mt,pn=ct*Uo+pt,Nt=bt*Uo+ht,Kt=$t*Uo+mt,nn=Math.hypot(($o[2*pn+0]+$o[2*Nt+0])/2-$o[2*Kt+0],($o[2*pn+1]+$o[2*Nt+1])/2-$o[2*Kt+1])>=16;if(Ds[Kt]=Ds[Kt]||(nn?1:0),Je<1022){const Yt=(ct+Ht>>1)*Uo+(pt+Ft>>1),hn=(bt+Ht>>1)*Uo+(ht+Ft>>1);Ds[Kt]=Ds[Kt]||Ds[Yt]||Ds[hn]}}const De=new $n,Oe=new cr;let Ne=0;function Ge(Je,st){const pt=st*Uo+Je;return Sh[pt]===0&&(De.emplaceBack($o[2*pt+0],$o[2*pt+1],Je*Hn/lo,st*Hn/lo),Sh[pt]=++Ne),Sh[pt]-1}function We(Je,st,pt,ct,ht,bt){const mt=Je+pt>>1,$t=st+ct>>1;if(Math.abs(Je-ht)+Math.abs(st-bt)>1&&Ds[$t*Uo+mt])We(ht,bt,Je,st,mt,$t),We(pt,ct,ht,bt,mt,$t);else{const Ft=Ge(Je,st),Ht=Ge(pt,ct),pn=Ge(ht,bt);Oe.emplaceBack(Ft,Ht,pn)}}return We(0,0,lo,lo,lo,0),We(lo,lo,0,0,0,lo),{vertices:De,indices:Oe}}(this.tileID.canonical,I);Q=he.vertices,ne=he.indices}else{Q=new $n,ne=new cr;for(const{x:ge,y:we}of G)Q.emplaceBack(ge,we,0,0);const he=eh(Q.int16,void 0,4);for(let ge=0;ge<he.length;ge+=3)ne.emplaceBack(he[ge],he[ge+1],he[ge+2])}this._tileBoundsBuffer=y.createVertexBuffer(Q,lm.members),this._tileBoundsIndexBuffer=y.createIndexBuffer(ne),this._tileBoundsSegments=ai.simpleSegment(0,0,Q.length,ne.length)}_makeGlobeTileDebugBuffers(y,I){const G=I.projection;if(!G||G.name!=="globe"||I.freezeTileCoverage)return;const Q=this.tileID.canonical,ne=Gc(Zf(Q,I)),he=qc(I.zoom);let ge;he>0&&(ge=sd(new Float64Array(16),I.globeMatrix));const we=(Q.x+.5)/(1<<Q.z)-Do(I.center.lng);let Ee=0;we>.5?Ee=-1:we<-.5&&(Ee=1),this._makeGlobeTileDebugBorderBuffer(y,Q,I,ne,ge,he,Ee),this._makeGlobeTileDebugTextBuffer(y,Q,I,ne,ge,he,Ee)}_globePoint(y,I,G,Q,ne,he,ge,we){let Ee=Vc(y,I,G);if(he){const ke=1<<G.z,De=[((y/Hn+G.x)/ke+we)*Q,(I/Hn+G.y)/ke*Q,0];ci(De,De,he),Ee=ps(Ee,De,ge)}return ci(Ee,Ee,ne)}_makeGlobeTileDebugBorderBuffer(y,I,G,Q,ne,he,ge){const we=new xn,Ee=new Xo,ke=new zn,De=(Ne,Ge,We,Je,st)=>{const pt=(We-Ne)/(st-1),ct=(Je-Ge)/(st-1),ht=we.length;for(let bt=0;bt<st;bt++){const mt=Ne+bt*pt,$t=Ge+bt*ct;we.emplaceBack(mt,$t);const Ft=this._globePoint(mt,$t,I,G.worldSize,Q,ne,he,ge);ke.emplaceBack(Ft[0],Ft[1],Ft[2]),Ee.emplaceBack(ht+bt)}},Oe=Hn;De(0,0,Oe,0,16),De(Oe,0,Oe,Oe,16),De(Oe,Oe,0,Oe,16),De(0,Oe,0,0,16),this._tileDebugIndexBuffer=y.createIndexBuffer(Ee),this._tileDebugBuffer=y.createVertexBuffer(we,jc.members),this._globeTileDebugBorderBuffer=y.createVertexBuffer(ke,Gf.members),this._tileDebugSegments=ai.simpleSegment(0,0,we.length,Ee.length)}_makeGlobeTileDebugTextBuffer(y,I,G,Q,ne,he,ge){const we=new xn,Ee=new cr,ke=new zn,De=25;Ee.reserve(32),we.reserve(De),ke.reserve(De);const Oe=(Ne,Ge)=>De*Ne+Ge;for(let Ne=0;Ne<De;Ne++){const Ge=2048*Ne;for(let We=0;We<De;We++){const Je=2048*We;we.emplaceBack(Je,Ge);const st=this._globePoint(Je,Ge,I,G.worldSize,Q,ne,he,ge);ke.emplaceBack(st[0],st[1],st[2])}}for(let Ne=0;Ne<4;Ne++)for(let Ge=0;Ge<4;Ge++){const We=Oe(Ne,Ge),Je=Oe(Ne,Ge+1),st=Oe(Ne+1,Ge),pt=Oe(Ne+1,Ge+1);Ee.emplaceBack(We,Je,st),Ee.emplaceBack(st,Je,pt)}this._tileDebugTextIndexBuffer=y.createIndexBuffer(Ee),this._tileDebugTextBuffer=y.createVertexBuffer(we,jc.members),this._globeTileDebugTextBuffer=y.createVertexBuffer(ke,Gf.members),this._tileDebugTextSegments=ai.simpleSegment(0,0,De,32)}}class ey{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(y,I,G){const Q=String(I);if(this.stateChanges[y]=this.stateChanges[y]||{},this.stateChanges[y][Q]=this.stateChanges[y][Q]||{},Ut(this.stateChanges[y][Q],G),this.deletedStates[y]===null){this.deletedStates[y]={};for(const ne in this.state[y])ne!==Q&&(this.deletedStates[y][ne]=null)}else if(this.deletedStates[y]&&this.deletedStates[y][Q]===null){this.deletedStates[y][Q]={};for(const ne in this.state[y][Q])G[ne]||(this.deletedStates[y][Q][ne]=null)}else for(const ne in G)this.deletedStates[y]&&this.deletedStates[y][Q]&&this.deletedStates[y][Q][ne]===null&&delete this.deletedStates[y][Q][ne]}removeFeatureState(y,I,G){if(this.deletedStates[y]===null)return;const Q=String(I);if(this.deletedStates[y]=this.deletedStates[y]||{},G&&I!==void 0)this.deletedStates[y][Q]!==null&&(this.deletedStates[y][Q]=this.deletedStates[y][Q]||{},this.deletedStates[y][Q][G]=null);else if(I!==void 0)if(this.stateChanges[y]&&this.stateChanges[y][Q])for(G in this.deletedStates[y][Q]={},this.stateChanges[y][Q])this.deletedStates[y][Q][G]=null;else this.deletedStates[y][Q]=null;else this.deletedStates[y]=null}getState(y,I){const G=String(I),Q=Ut({},(this.state[y]||{})[G],(this.stateChanges[y]||{})[G]);if(this.deletedStates[y]===null)return{};if(this.deletedStates[y]){const ne=this.deletedStates[y][I];if(ne===null)return{};for(const he in ne)delete Q[he]}return Q}initializeTileState(y,I){y.setFeatureState(this.state,I)}coalesceChanges(y,I){const G={};for(const Q in this.stateChanges){this.state[Q]=this.state[Q]||{};const ne={};for(const he in this.stateChanges[Q])this.state[Q][he]||(this.state[Q][he]={}),Ut(this.state[Q][he],this.stateChanges[Q][he]),ne[he]=this.state[Q][he];G[Q]=ne}for(const Q in this.deletedStates){this.state[Q]=this.state[Q]||{};const ne={};if(this.deletedStates[Q]===null)for(const he in this.state[Q])ne[he]={},this.state[Q][he]={};else for(const he in this.deletedStates[Q]){if(this.deletedStates[Q][he]===null)this.state[Q][he]={};else for(const ge of Object.keys(this.deletedStates[Q][he]))delete this.state[Q][he][ge];ne[he]=this.state[Q][he]}G[Q]=G[Q]||{},Ut(G[Q],ne)}if(this.stateChanges={},this.deletedStates={},Object.keys(G).length!==0)for(const Q in y)y[Q].setFeatureState(G,I)}}class um{constructor(y){this.size=y,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(y,I){const G=this.toIdx(y,I);return{min:this.minimums[G],max:this.maximums[G]}}isLeaf(y,I){return this.leaves[this.toIdx(y,I)]}toIdx(y,I){return I*this.size+y}}function hm(U,y,I,G){let Q=0,ne=Number.MAX_VALUE;for(let he=0;he<3;he++)if(Math.abs(G[he])<1e-15){if(I[he]<U[he]||I[he]>y[he])return null}else{const ge=1/G[he];let we=(U[he]-I[he])*ge,Ee=(y[he]-I[he])*ge;if(we>Ee){const ke=we;we=Ee,Ee=ke}if(we>Q&&(Q=we),Ee<ne&&(ne=Ee),Q>ne)return null}return Q}function dm(U,y,I,G,Q,ne,he,ge,we,Ee,ke){const De=G-U,Oe=Q-y,Ne=ne-I,Ge=he-U,We=ge-y,Je=we-I,st=ke[1]*Je-ke[2]*We,pt=ke[2]*Ge-ke[0]*Je,ct=ke[0]*We-ke[1]*Ge,ht=De*st+Oe*pt+Ne*ct;if(Math.abs(ht)<1e-15)return null;const bt=1/ht,mt=Ee[0]-U,$t=Ee[1]-y,Ft=Ee[2]-I,Ht=(mt*st+$t*pt+Ft*ct)*bt;if(Ht<0||Ht>1)return null;const pn=$t*Ne-Ft*Oe,Nt=Ft*De-mt*Ne,Kt=mt*Oe-$t*De,nn=(ke[0]*pn+ke[1]*Nt+ke[2]*Kt)*bt;return nn<0||Ht+nn>1?null:(Ge*pn+We*Nt+Je*Kt)*bt}function pm(U,y,I){return(U-y)/(I-y)}function fm(U,y,I,G,Q,ne,he,ge,we){const Ee=1<<I,ke=ne-G,De=he-Q,Oe=(U+1)/Ee*ke+G,Ne=(y+0)/Ee*De+Q,Ge=(y+1)/Ee*De+Q;ge[0]=(U+0)/Ee*ke+G,ge[1]=Ne,we[0]=Oe,we[1]=Ge}class mm{constructor(y){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=y,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const I=function(ne){const he=Math.ceil(Math.log2(ne.dim/8)),ge=[];let we=Math.ceil(Math.pow(2,he));const Ee=1/we,ke=(Ne,Ge,We,Je,st)=>{const pt=Je?1:0,ct=(Ne+1)*We-pt,ht=Ge*We,bt=(Ge+1)*We-pt;st[0]=Ne*We,st[1]=ht,st[2]=ct,st[3]=bt};let De=new um(we);const Oe=[];for(let Ne=0;Ne<we*we;Ne++){ke(Ne%we,Math.floor(Ne/we),Ee,!1,Oe);const Ge=Ls(Oe[0],Oe[1],ne),We=Ls(Oe[2],Oe[1],ne),Je=Ls(Oe[2],Oe[3],ne),st=Ls(Oe[0],Oe[3],ne);De.minimums.push(Math.min(Ge,We,Je,st)),De.maximums.push(Math.max(Ge,We,Je,st)),De.leaves.push(1)}for(ge.push(De),we/=2;we>=1;we/=2){const Ne=ge[ge.length-1];De=new um(we);for(let Ge=0;Ge<we*we;Ge++){ke(Ge%we,Math.floor(Ge/we),2,!0,Oe);const We=Ne.getElevation(Oe[0],Oe[1]),Je=Ne.getElevation(Oe[2],Oe[1]),st=Ne.getElevation(Oe[2],Oe[3]),pt=Ne.getElevation(Oe[0],Oe[3]),ct=Ne.isLeaf(Oe[0],Oe[1]),ht=Ne.isLeaf(Oe[2],Oe[1]),bt=Ne.isLeaf(Oe[2],Oe[3]),mt=Ne.isLeaf(Oe[0],Oe[3]),$t=Math.min(We.min,Je.min,st.min,pt.min),Ft=Math.max(We.max,Je.max,st.max,pt.max),Ht=ct&&ht&&bt&&mt;De.maximums.push(Ft),De.minimums.push($t),De.leaves.push(Ft-$t<=5&&Ht?1:0)}ge.push(De)}return ge}(this.dem),G=I.length-1,Q=I[G];this._addNode(Q.minimums[0],Q.maximums[0],Q.leaves[0]),this._construct(I,0,0,G,0)}raycastRoot(y,I,G,Q,ne,he,ge=1){return hm([y,I,-100],[G,Q,this.maximums[0]*ge],ne,he)}raycast(y,I,G,Q,ne,he,ge=1){if(!this.nodeCount)return null;const we=this.raycastRoot(y,I,G,Q,ne,he,ge);if(we==null)return null;const Ee=[],ke=[],De=[],Oe=[],Ne=[{idx:0,t:we,nodex:0,nodey:0,depth:0}];for(;Ne.length>0;){const{idx:Ge,t:We,nodex:Je,nodey:st,depth:pt}=Ne.pop();if(this.leaves[Ge]){fm(Je,st,pt,y,I,G,Q,De,Oe);const ht=1<<pt,bt=(Je+0)/ht,mt=(Je+1)/ht,$t=(st+0)/ht,Ft=(st+1)/ht,Ht=Ls(bt,$t,this.dem)*ge,pn=Ls(mt,$t,this.dem)*ge,Nt=Ls(mt,Ft,this.dem)*ge,Kt=Ls(bt,Ft,this.dem)*ge,nn=dm(De[0],De[1],Ht,Oe[0],De[1],pn,Oe[0],Oe[1],Nt,ne,he),Yt=dm(Oe[0],Oe[1],Nt,De[0],Oe[1],Kt,De[0],De[1],Ht,ne,he),hn=Math.min(nn!==null?nn:Number.MAX_VALUE,Yt!==null?Yt:Number.MAX_VALUE);if(hn!==Number.MAX_VALUE)return hn;{const rn=Qu([],ne,he,We);if(_m(Ht,pn,Kt,Nt,pm(rn[0],De[0],Oe[0]),pm(rn[1],De[1],Oe[1]))>=rn[2])return We}continue}let ct=0;for(let ht=0;ht<this._siblingOffset.length;ht++){fm((Je<<1)+this._siblingOffset[ht][0],(st<<1)+this._siblingOffset[ht][1],pt+1,y,I,G,Q,De,Oe),De[2]=-100,Oe[2]=this.maximums[this.childOffsets[Ge]+ht]*ge;const bt=hm(De,Oe,ne,he);if(bt!=null){const mt=bt;Ee[ht]=mt;let $t=!1;for(let Ft=0;Ft<ct&&!$t;Ft++)mt>=Ee[ke[Ft]]&&(ke.splice(Ft,0,ht),$t=!0);$t||(ke[ct]=ht),ct++}}for(let ht=0;ht<ct;ht++){const bt=ke[ht];Ne.push({idx:this.childOffsets[Ge]+bt,t:Ee[bt],nodex:(Je<<1)+this._siblingOffset[bt][0],nodey:(st<<1)+this._siblingOffset[bt][1],depth:pt+1})}}return null}_addNode(y,I,G){return this.minimums.push(y),this.maximums.push(I),this.leaves.push(G),this.childOffsets.push(0),this.nodeCount++}_construct(y,I,G,Q,ne){if(y[Q].isLeaf(I,G)===1)return;this.childOffsets[ne]||(this.childOffsets[ne]=this.nodeCount);const he=Q-1,ge=y[he];let we=0,Ee=0;for(let ke=0;ke<this._siblingOffset.length;ke++){const De=2*I+this._siblingOffset[ke][0],Oe=2*G+this._siblingOffset[ke][1],Ne=ge.getElevation(De,Oe),Ge=ge.isLeaf(De,Oe),We=this._addNode(Ne.min,Ne.max,Ge);Ge&&(we|=1<<ke),Ee||(Ee=We)}for(let ke=0;ke<this._siblingOffset.length;ke++)we&1<<ke||this._construct(y,2*I+this._siblingOffset[ke][0],2*G+this._siblingOffset[ke][1],he,Ee+ke)}}function _m(U,y,I,G,Q,ne){return wr(wr(U,I,ne),wr(y,G,ne),Q)}function Ls(U,y,I){const G=I.dim,Q=Mt(U*G-.5,0,G-1),ne=Mt(y*G-.5,0,G-1),he=Math.floor(Q),ge=Math.floor(ne),we=Math.min(he+1,G-1),Ee=Math.min(ge+1,G-1);return _m(I.get(he,ge),I.get(we,ge),I.get(he,Ee),I.get(we,Ee),Q-he,ne-ge)}const gm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ch{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(y,I,G,Q=!1,ne=!1){if(this.uid=y,I.height!==I.width)throw new RangeError("DEM tiles must be square");if(G&&G!=="mapbox"&&G!=="terrarium")return er(`"${G}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=I.height;const he=this.dim=I.height-2,ge=new Uint32Array(I.data.buffer);if(this.pixels=new Uint8Array(I.data.buffer),this.encoding=G||"mapbox",this.borderReady=Q,!Q){for(let we=0;we<he;we++)ge[this._idx(-1,we)]=ge[this._idx(0,we)],ge[this._idx(he,we)]=ge[this._idx(he-1,we)],ge[this._idx(we,-1)]=ge[this._idx(we,0)],ge[this._idx(we,he)]=ge[this._idx(we,he-1)];ge[this._idx(-1,-1)]=ge[this._idx(0,0)],ge[this._idx(he,-1)]=ge[this._idx(he-1,0)],ge[this._idx(-1,he)]=ge[this._idx(0,he-1)],ge[this._idx(he,he)]=ge[this._idx(he-1,he-1)],ne&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mm(this)}get(y,I,G=!1){G&&(y=Mt(y,-1,this.dim),I=Mt(I,-1,this.dim));const Q=4*this._idx(y,I);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[Q],this.pixels[Q+1],this.pixels[Q+2])}static getUnpackVector(y){return gm[y]}get unpackVector(){return gm[this.encoding]}_idx(y,I){if(y<-1||y>=this.dim+1||I<-1||I>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(I+1)*this.stride+(y+1)}_unpackMapbox(y,I,G){return(256*y*256+256*I+G)/10-1e4}_unpackTerrarium(y,I,G){return 256*y+I+G/256-32768}static pack(y,I){const G=[0,0,0,0],Q=Ch.getUnpackVector(I);let ne=Math.floor((y+Q[3])/Q[2]);return G[2]=ne%256,ne=Math.floor(ne/256),G[1]=ne%256,ne=Math.floor(ne/256),G[0]=ne,G}getPixels(){return new Zi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(y,I,G){if(this.dim!==y.dim)throw new Error("dem dimension mismatch");let Q=I*this.dim,ne=I*this.dim+this.dim,he=G*this.dim,ge=G*this.dim+this.dim;switch(I){case-1:Q=ne-1;break;case 1:ne=Q+1}switch(G){case-1:he=ge-1;break;case 1:ge=he+1}const we=-I*this.dim,Ee=-G*this.dim;for(let ke=he;ke<ge;ke++)for(let De=Q;De<ne;De++){const Oe=4*this._idx(De,ke),Ne=4*this._idx(De+we,ke+Ee);this.pixels[Oe+0]=y.pixels[Ne+0],this.pixels[Oe+1]=y.pixels[Ne+1],this.pixels[Oe+2]=y.pixels[Ne+2],this.pixels[Oe+3]=y.pixels[Ne+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Pn(Ch,"DEMData"),Pn(mm,"DemMinMaxQuadTree",{omit:["dem"]});class ty{constructor(y,I){this.max=y,this.onRemove=I,this.reset()}reset(){for(const y in this.data)for(const I of this.data[y])I.timeout&&clearTimeout(I.timeout),this.onRemove(I.value);return this.data={},this.order=[],this}add(y,I,G){const Q=y.wrapped().key;this.data[Q]===void 0&&(this.data[Q]=[]);const ne={value:I,timeout:void 0};if(G!==void 0&&(ne.timeout=setTimeout(()=>{this.remove(y,ne)},G)),this.data[Q].push(ne),this.order.push(Q),this.order.length>this.max){const he=this._getAndRemoveByKey(this.order[0]);he&&this.onRemove(he)}return this}has(y){return y.wrapped().key in this.data}getAndRemove(y){return this.has(y)?this._getAndRemoveByKey(y.wrapped().key):null}_getAndRemoveByKey(y){const I=this.data[y].shift();return I.timeout&&clearTimeout(I.timeout),this.data[y].length===0&&delete this.data[y],this.order.splice(this.order.indexOf(y),1),I.value}getByKey(y){const I=this.data[y];return I?I[0].value:null}get(y){return this.has(y)?this.data[y.wrapped().key][0].value:null}remove(y,I){if(!this.has(y))return this;const G=y.wrapped().key,Q=I===void 0?0:this.data[G].indexOf(I),ne=this.data[G][Q];return this.data[G].splice(Q,1),ne.timeout&&clearTimeout(ne.timeout),this.data[G].length===0&&delete this.data[G],this.onRemove(ne.value),this.order.splice(this.order.indexOf(G),1),this}setMaxSize(y){for(this.max=y;this.order.length>this.max;){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}filter(y){const I=[];for(const G in this.data)for(const Q of this.data[G])y(Q.value)||I.push(Q);for(const G of I)this.remove(G.value.tileID,G)}}class El{constructor(y,I,G){this.func=y,this.mask=I,this.range=G}}El.ReadOnly=!1,El.ReadWrite=!0,El.disabled=new El(519,El.ReadOnly,[0,1]);const qd=7680;class Zd{constructor(y,I,G,Q,ne,he){this.test=y,this.ref=I,this.mask=G,this.fail=Q,this.depthFail=ne,this.pass=he}}Zd.disabled=new Zd({func:519,mask:0},0,0,qd,qd,qd);class No{constructor(y,I,G){this.blendFunction=y,this.blendColor=I,this.mask=G}}No.Replace=[1,0],No.disabled=new No(No.Replace,zr.transparent,[!1,!1,!1,!1]),No.unblended=new No(No.Replace,zr.transparent,[!0,!0,!0,!0]),No.alphaBlended=new No([1,771],zr.transparent,[!0,!0,!0,!0]);const Hd=1029,Wd=2305;class bo{constructor(y,I,G){this.enable=y,this.mode=I,this.frontFace=G}}bo.disabled=new bo(!1,Hd,Wd),bo.backCCW=new bo(!0,Hd,Wd),bo.backCW=new bo(!0,Hd,2304),bo.frontCW=new bo(!0,1028,2304),bo.frontCCW=new bo(!0,1028,Wd);class wa extends jn{constructor(y,I,G){super(),this.id=y,this._onlySymbols=G,I.on("data",Q=>{Q.dataType==="source"&&Q.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&Q.dataType==="source"&&Q.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),I.on("error",()=>{this._sourceErrored=!0}),this._source=I,this._tiles={},this._cache=new ty(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=I.minTileCacheSize,this._maxTileCacheSize=I.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ey,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(y){this.map=y,this._minTileCacheSize=this._minTileCacheSize===void 0&&y?y._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&y?y._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const y in this._tiles){const I=this._tiles[y];if(I.state!=="loaded"&&I.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const y=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,y&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(y,I){return y.isSymbolTile=this._onlySymbols,this._source.loadTile(y,I)}_unloadTile(y){if(this._source.unloadTile)return this._source.unloadTile(y,()=>{})}_abortTile(y){if(this._source.abortTile)return this._source.abortTile(y,()=>{})}serialize(){return this._source.serialize()}prepare(y){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const I in this._tiles){const G=this._tiles[I];this._source.prepareTile(G)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,G.tileID),G.upload(y),G.prepare(this.map.style.imageManager)}else for(const I in this._tiles){const G=this._tiles[I];G.upload(y),G.prepare(this.map.style.imageManager)}}getIds(){return Gt(this._tiles).map(y=>y.tileID).sort(ym).map(y=>y.key)}getRenderableIds(y){const I=[];for(const G in this._tiles)this._isIdRenderable(+G,y)&&I.push(this._tiles[G]);return y?I.sort((G,Q)=>{const ne=G.tileID,he=Q.tileID,ge=new ze(ne.canonical.x,ne.canonical.y)._rotate(this.transform.angle),we=new ze(he.canonical.x,he.canonical.y)._rotate(this.transform.angle);return ne.overscaledZ-he.overscaledZ||we.y-ge.y||we.x-ge.x}).map(G=>G.tileID.key):I.map(G=>G.tileID).sort(ym).map(G=>G.key)}hasRenderableParent(y){const I=this.findLoadedParent(y,0);return!!I&&this._isIdRenderable(I.tileID.key)}_isIdRenderable(y,I){return this._tiles[y]&&this._tiles[y].hasData()&&!this._coveredTiles[y]&&(I||!this._tiles[y].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const y in this._tiles)this._tiles[y].state!=="errored"&&this._reloadTile(+y,"reloading")}}_reloadTile(y,I){const G=this._tiles[y];G&&(G.state!=="loading"&&(G.state=I),this._loadTile(G,this._tileLoaded.bind(this,G,y,I)))}_tileLoaded(y,I,G,Q){if(Q)if(y.state="errored",Q.status!==404)this._source.fire(new Rr(Q,{tile:y}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const ne=this.map.painter.terrain;this.update(this.transform,ne.getScaledDemTileSize(),!0),ne.resetTileLookupCache(this.id)}else this.update(this.transform);else y.timeAdded=yn.now(),G==="expired"&&(y.refreshedUponExpiration=!0),this._setTileReloadTimer(I,y),this._source.type==="raster-dem"&&y.dem&&this._backfillDEM(y),this._state.initializeTileState(y,this.map?this.map.painter:null),this._source.fire(new Br("data",{dataType:"source",tile:y,coord:y.tileID,sourceCacheId:this.id}))}_backfillDEM(y){const I=this.getRenderableIds();for(let Q=0;Q<I.length;Q++){const ne=I[Q];if(y.neighboringTiles&&y.neighboringTiles[ne]){const he=this.getTileByID(ne);G(y,he),G(he,y)}}function G(Q,ne){if(!Q.dem||Q.dem.borderReady)return;Q.needsHillshadePrepare=!0,Q.needsDEMTextureUpload=!0;let he=ne.tileID.canonical.x-Q.tileID.canonical.x;const ge=ne.tileID.canonical.y-Q.tileID.canonical.y,we=Math.pow(2,Q.tileID.canonical.z),Ee=ne.tileID.key;he===0&&ge===0||Math.abs(ge)>1||(Math.abs(he)>1&&(Math.abs(he+we)===1?he+=we:Math.abs(he-we)===1&&(he-=we)),ne.dem&&Q.dem&&(Q.dem.backfillBorder(ne.dem,he,ge),Q.neighboringTiles&&Q.neighboringTiles[Ee]&&(Q.neighboringTiles[Ee].backfilled=!0)))}}getTile(y){return this.getTileByID(y.key)}getTileByID(y){return this._tiles[y]}_retainLoadedChildren(y,I,G,Q){for(const ne in this._tiles){let he=this._tiles[ne];if(Q[ne]||!he.hasData()||he.tileID.overscaledZ<=I||he.tileID.overscaledZ>G)continue;let ge=he.tileID;for(;he&&he.tileID.overscaledZ>I+1;){const Ee=he.tileID.scaledTo(he.tileID.overscaledZ-1);he=this._tiles[Ee.key],he&&he.hasData()&&(ge=Ee)}let we=ge;for(;we.overscaledZ>I;)if(we=we.scaledTo(we.overscaledZ-1),y[we.key]){Q[ge.key]=ge;break}}}findLoadedParent(y,I){if(y.key in this._loadedParentTiles){const G=this._loadedParentTiles[y.key];return G&&G.tileID.overscaledZ>=I?G:null}for(let G=y.overscaledZ-1;G>=I;G--){const Q=y.scaledTo(G),ne=this._getLoadedTile(Q);if(ne)return ne}}_getLoadedTile(y){const I=this._tiles[y.key];return I&&I.hasData()?I:this._cache.getByKey(this._source.reparseOverscaled?y.wrapped().key:y.canonical.key)}updateCacheSize(y,I){I=I||this._source.tileSize;const G=Math.ceil(y.width/I)+1,Q=Math.ceil(y.height/I)+1,ne=Math.floor(G*Q*5),he=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,ne):ne,ge=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,he):he;this._cache.setMaxSize(ge)}handleWrapJump(y){const I=Math.round((y-(this._prevLng===void 0?y:this._prevLng))/360);if(this._prevLng=y,I){const G={};for(const Q in this._tiles){const ne=this._tiles[Q];ne.tileID=ne.tileID.unwrapTo(ne.tileID.wrap+I),G[ne.tileID.key]=ne}this._tiles=G;for(const Q in this._timers)clearTimeout(this._timers[Q]),delete this._timers[Q];for(const Q in this._tiles)this._setTileReloadTimer(+Q,this._tiles[Q])}}update(y,I,G){if(this.transform=y,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!G)return;let Q;this.updateCacheSize(y,I),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?Q=y.getVisibleUnwrappedCoordinates(this._source.tileID).map(ge=>new zi(ge.canonical.z,ge.wrap,ge.canonical.z,ge.canonical.x,ge.canonical.y)):(Q=y.coveringTiles({tileSize:I||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!G,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(Q=Q.filter(ge=>this._source.hasTile(ge)))):Q=[];const ne=this._updateRetainedTiles(Q);if(vm(this._source.type)&&Q.length!==0){const ge={},we={},Ee=Object.keys(ne);for(const De of Ee){const Oe=ne[De],Ne=this._tiles[De];if(!Ne||Ne.fadeEndTime&&Ne.fadeEndTime<=yn.now())continue;const Ge=this.findLoadedParent(Oe,Math.max(Oe.overscaledZ-wa.maxOverzooming,this._source.minzoom));Ge&&(this._addTile(Ge.tileID),ge[Ge.tileID.key]=Ge.tileID),we[De]=Oe}const ke=Q[Q.length-1].overscaledZ;for(const De in this._tiles){const Oe=this._tiles[De];if(ne[De]||!Oe.hasData())continue;let Ne=Oe.tileID;for(;Ne.overscaledZ>ke;){Ne=Ne.scaledTo(Ne.overscaledZ-1);const Ge=this._tiles[Ne.key];if(Ge&&Ge.hasData()&&we[Ne.key]){ne[De]=Oe.tileID;break}}}for(const De in ge)ne[De]||(this._coveredTiles[De]=!0,ne[De]=ge[De])}for(const ge in ne)this._tiles[ge].clearFadeHold();const he=function(ge,we){const Ee=[];for(const ke in ge)ke in we||Ee.push(ke);return Ee}(this._tiles,ne);for(const ge of he){const we=this._tiles[ge];we.hasSymbolBuckets&&!we.holdingForFade()?we.setHoldDuration(this.map._fadeDuration):we.hasSymbolBuckets&&!we.symbolFadeFinished()||this._removeTile(+ge)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const y in this._tiles)this._tiles[y].holdingForFade()&&this._removeTile(+y)}_updateRetainedTiles(y){const I={};if(y.length===0)return I;const G={},Q=y.reduce((Ee,ke)=>Math.min(Ee,ke.overscaledZ),1/0),ne=y[0].overscaledZ,he=Math.max(ne-wa.maxOverzooming,this._source.minzoom),ge=Math.max(ne+wa.maxUnderzooming,this._source.minzoom),we={};for(const Ee of y){const ke=this._addTile(Ee);I[Ee.key]=Ee,ke.hasData()||Q<this._source.maxzoom&&(we[Ee.key]=Ee)}this._retainLoadedChildren(we,Q,ge,I);for(const Ee of y){let ke=this._tiles[Ee.key];if(ke.hasData())continue;if(Ee.canonical.z>=this._source.maxzoom){const Oe=Ee.children(this._source.maxzoom)[0],Ne=this.getTile(Oe);if(Ne&&Ne.hasData()){I[Oe.key]=Oe;continue}}else{const Oe=Ee.children(this._source.maxzoom);if(I[Oe[0].key]&&I[Oe[1].key]&&I[Oe[2].key]&&I[Oe[3].key])continue}let De=ke.wasRequested();for(let Oe=Ee.overscaledZ-1;Oe>=he;--Oe){const Ne=Ee.scaledTo(Oe);if(G[Ne.key]||(G[Ne.key]=!0,ke=this.getTile(Ne),!ke&&De&&(ke=this._addTile(Ne)),ke&&(I[Ne.key]=Ne,De=ke.wasRequested(),ke.hasData())))break}}return I}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const y in this._tiles){const I=[];let G,Q=this._tiles[y].tileID;for(;Q.overscaledZ>0;){if(Q.key in this._loadedParentTiles){G=this._loadedParentTiles[Q.key];break}I.push(Q.key);const ne=Q.scaledTo(Q.overscaledZ-1);if(G=this._getLoadedTile(ne),G)break;Q=ne}for(const ne of I)this._loadedParentTiles[ne]=G}}_addTile(y){let I=this._tiles[y.key];if(I)return this._source.prepareTile&&this._source.prepareTile(I),I;I=this._cache.getAndRemove(y),I&&(this._setTileReloadTimer(y.key,I),I.tileID=y,this._state.initializeTileState(I,this.map?this.map.painter:null),this._cacheTimers[y.key]&&(clearTimeout(this._cacheTimers[y.key]),delete this._cacheTimers[y.key],this._setTileReloadTimer(y.key,I)));const G=Boolean(I);if(!G){const Q=this.map?this.map.painter:null;I=new Gd(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,Q,this._isRaster),this._source.prepareTile&&this._source.prepareTile(I)||this._loadTile(I,this._tileLoaded.bind(this,I,y.key,I.state))}return I?(I.uses++,this._tiles[y.key]=I,G||this._source.fire(new Br("dataloading",{tile:I,coord:I.tileID,dataType:"source"})),I):null}_setTileReloadTimer(y,I){y in this._timers&&(clearTimeout(this._timers[y]),delete this._timers[y]);const G=I.getExpiryTimeout();G&&(this._timers[y]=setTimeout(()=>{this._reloadTile(y,"expired"),delete this._timers[y]},G))}_removeTile(y){const I=this._tiles[y];I&&(I.uses--,delete this._tiles[y],this._timers[y]&&(clearTimeout(this._timers[y]),delete this._timers[y]),I.uses>0||(I.hasData()&&I.state!=="reloading"?this._cache.add(I.tileID,I,I.getExpiryTimeout()):(I.aborted=!0,this._abortTile(I),this._unloadTile(I))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const y in this._tiles)this._removeTile(+y);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(y,I,G){const Q=[],ne=this.transform;if(!ne)return Q;const he=ne.projection.name==="globe",ge=Do(ne.center.lng);for(const we in this._tiles){const Ee=this._tiles[we];if(G&&Ee.clearQueryDebugViz(),Ee.holdingForFade())continue;let ke;if(he){const De=Ee.tileID.canonical;if(De.z===0){const Oe=[Math.abs(Mt(ge,...Yc(De,-1))-ge),Math.abs(Mt(ge,...Yc(De,1))-ge)];ke=[0,2*Oe.indexOf(Math.min(...Oe))-1]}else{const Oe=[Math.abs(Mt(ge,...Yc(De,-1))-ge),Math.abs(Mt(ge,...Yc(De,0))-ge),Math.abs(Mt(ge,...Yc(De,1))-ge)];ke=[Oe.indexOf(Math.min(...Oe))-1]}}else ke=[0];for(const De of ke){const Oe=y.containsTile(Ee,ne,I,De);Oe&&Q.push(Oe)}}return Q}getVisibleCoordinates(y){const I=this.getRenderableIds(y).map(G=>this._tiles[G].tileID);for(const G of I)G.projMatrix=this.transform.calculateProjMatrix(G.toUnwrapped());return I}hasTransition(){if(this._source.hasTransition())return!0;if(vm(this._source.type))for(const y in this._tiles){const I=this._tiles[y];if(I.fadeEndTime!==void 0&&I.fadeEndTime>=yn.now())return!0}return!1}setFeatureState(y,I,G){this._state.updateState(y=y||"_geojsonTileLayer",I,G)}removeFeatureState(y,I,G){this._state.removeFeatureState(y=y||"_geojsonTileLayer",I,G)}getFeatureState(y,I){return this._state.getState(y=y||"_geojsonTileLayer",I)}setDependencies(y,I,G){const Q=this._tiles[y];Q&&Q.setDependencies(I,G)}reloadTilesForDependencies(y,I){for(const G in this._tiles)this._tiles[G].hasDependency(y,I)&&this._reloadTile(+G,"reloading");this._cache.filter(G=>!G.hasDependency(y,I))}_preloadTiles(y,I){const G=new Map,Q=Array.isArray(y)?y:[y],ne=this.map.painter.terrain,he=this.usedForTerrain&&ne?ne.getScaledDemTileSize():this._source.tileSize;for(const ge of Q){const we=ge.coveringTiles({tileSize:he,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Ee of we)G.set(Ee.key,Ee);this.usedForTerrain&&ge.updateElevation(!1)}Dt(Array.from(G.values()),(ge,we)=>{const Ee=new Gd(ge,this._source.tileSize*ge.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Ee,ke=>{this._source.type==="raster-dem"&&Ee.dem&&this._backfillDEM(Ee),we(ke,Ee)})},I)}}function ym(U,y){const I=Math.abs(2*U.wrap)-+(U.wrap<0),G=Math.abs(2*y.wrap)-+(y.wrap<0);return U.overscaledZ-y.overscaledZ||G-I||y.canonical.y-U.canonical.y||y.canonical.x-U.canonical.x}function vm(U){return U==="raster"||U==="image"||U==="video"}function Yc(U,y){const I=1<<U.z;return[U.x/I+y,(U.x+1)/I+y]}wa.maxOverzooming=10,wa.maxUnderzooming=3;class Ih{constructor(y,I,G){this._demTile=y,this._dem=this._demTile.dem,this._scale=I,this._offset=G}static create(y,I,G){const Q=G||y.findDEMTileFor(I);if(!Q||!Q.dem)return;const ne=Q.dem,he=Q.tileID,ge=1<<I.canonical.z-he.canonical.z;return new Ih(Q,Q.tileSize/Hn/ge,[(I.canonical.x/ge-he.canonical.x)*ne.dim,(I.canonical.y/ge-he.canonical.y)*ne.dim])}tileCoordToPixel(y,I){const G=I*this._scale+this._offset[1],Q=Math.floor(y*this._scale+this._offset[0]),ne=Math.floor(G);return new ze(Q,ne)}getElevationAt(y,I,G,Q){const ne=y*this._scale+this._offset[0],he=I*this._scale+this._offset[1],ge=Math.floor(ne),we=Math.floor(he),Ee=this._dem;return Q=!!Q,G?wr(wr(Ee.get(ge,we,Q),Ee.get(ge,we+1,Q),he-we),wr(Ee.get(ge+1,we,Q),Ee.get(ge+1,we+1,Q),he-we),ne-ge):Ee.get(ge,we,Q)}getElevationAtPixel(y,I,G){return this._dem.get(y,I,!!G)}getMeterToDEM(y){return(1<<this._demTile.tileID.canonical.z)*oo(1,y)*this._dem.stride}}class xm{constructor(y,I){this.tileID=y,this.x=y.canonical.x,this.y=y.canonical.y,this.z=y.canonical.z,this.grid=new Es(Hn,16,0),this.featureIndexArray=new lp,this.promoteId=I}insert(y,I,G,Q,ne,he=0){const ge=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(G,Q,ne,he);const we=this.grid;for(let Ee=0;Ee<I.length;Ee++){const ke=I[Ee],De=[1/0,1/0,-1/0,-1/0];for(let Oe=0;Oe<ke.length;Oe++){const Ne=ke[Oe];De[0]=Math.min(De[0],Ne.x),De[1]=Math.min(De[1],Ne.y),De[2]=Math.max(De[2],Ne.x),De[3]=Math.max(De[3],Ne.y)}De[0]<Hn&&De[1]<Hn&&De[2]>=0&&De[3]>=0&&we.insert(ge,De[0],De[1],De[2],De[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xa.VectorTile(new Uc(this.rawTileData)).layers,this.sourceLayerCoder=new om(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const y in this.vtLayers)this.vtFeatures[y]=[]}return this.vtLayers}query(y,I,G,Q){this.loadVTLayers();const ne=y.params||{},he=oa(ne.filter),ge=y.tileResult,we=y.transform,Ee=ge.bufferedTilespaceBounds,ke=this.grid.query(Ee.min.x,Ee.min.y,Ee.max.x,Ee.max.y,(Ge,We,Je,st)=>Cp(ge.bufferedTilespaceGeometry,Ge,We,Je,st));ke.sort(ny);let De=null;we.elevation&&ke.length>0&&(De=Ih.create(we.elevation,this.tileID));const Oe={};let Ne;for(let Ge=0;Ge<ke.length;Ge++){const We=ke[Ge];if(We===Ne)continue;Ne=We;const Je=this.featureIndexArray.get(We);let st=null;this.loadMatchingFeature(Oe,Je,he,ne.layers,ne.availableImages,I,G,Q,(pt,ct,ht,bt=0)=>(st||(st=ns(pt,this.tileID.canonical,y.tileTransform)),ct.queryIntersectsFeature(ge,pt,ht,st,this.z,y.transform,y.pixelPosMatrix,De,bt)))}return Oe}loadMatchingFeature(y,I,G,Q,ne,he,ge,we,Ee){const{featureIndex:ke,bucketIndex:De,sourceLayerIndex:Oe,layoutVertexArrayOffset:Ne}=I,Ge=this.bucketLayerIDs[De];if(Q&&!function(pt,ct){for(let ht=0;ht<pt.length;ht++)if(ct.indexOf(pt[ht])>=0)return!0;return!1}(Q,Ge))return;const We=this.sourceLayerCoder.decode(Oe),Je=this.vtLayers[We].feature(ke);if(G.needGeometry){const pt=ma(Je,!0);if(!G.filter(new tt(this.tileID.overscaledZ),pt,this.tileID.canonical))return}else if(!G.filter(new tt(this.tileID.overscaledZ),Je))return;const st=this.getId(Je,We);for(let pt=0;pt<Ge.length;pt++){const ct=Ge[pt];if(Q&&Q.indexOf(ct)<0)continue;const ht=he[ct];if(!ht)continue;let bt={};st!==void 0&&we&&(bt=we.getState(ht.sourceLayer||"_geojsonTileLayer",st));const mt=Ut({},ge[ct]);mt.paint=bm(mt.paint,ht.paint,Je,bt,ne),mt.layout=bm(mt.layout,ht.layout,Je,bt,ne);const $t=!Ee||Ee(Je,ht,bt,Ne);if(!$t)continue;const Ft=new sm(Je,this.z,this.x,this.y,st);Ft.layer=mt;let Ht=y[ct];Ht===void 0&&(Ht=y[ct]=[]),Ht.push({featureIndex:ke,feature:Ft,intersectionZ:$t})}}lookupSymbolFeatures(y,I,G,Q,ne,he,ge,we){const Ee={};this.loadVTLayers();const ke=oa(ne);for(const De of y)this.loadMatchingFeature(Ee,{bucketIndex:G,sourceLayerIndex:Q,featureIndex:De,layoutVertexArrayOffset:0},ke,he,ge,we,I);return Ee}loadFeature(y){const{featureIndex:I,sourceLayerIndex:G}=y;this.loadVTLayers();const Q=this.sourceLayerCoder.decode(G),ne=this.vtFeatures[Q];if(ne[I])return ne[I];const he=this.vtLayers[Q].feature(I);return ne[I]=he,he}hasLayer(y){for(const I of this.bucketLayerIDs)for(const G of I)if(y===G)return!0;return!1}getId(y,I){let G=y.id;return this.promoteId&&(G=y.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[I]],typeof G=="boolean"&&(G=Number(G))),G}}function bm(U,y,I,G,Q){return mn(U,(ne,he)=>{const ge=y instanceof vt?y.get(he):null;return ge&&ge.evaluate?ge.evaluate(I,G,Q):ge})}function ny(U,y){return y-U}Pn(xm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class wm{constructor(y){const I={},G=[];for(const ge in y){const we=y[ge],Ee=I[ge]={};for(const ke in we.glyphs){const De=we.glyphs[+ke];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;const Oe=De.metrics.localGlyph?2:1,Ne={x:0,y:0,w:De.bitmap.width+2*Oe,h:De.bitmap.height+2*Oe};G.push(Ne),Ee[ke]=Ne}}const{w:Q,h:ne}=Sd(G),he=new rs({width:Q||1,height:ne||1});for(const ge in y){const we=y[ge];for(const Ee in we.glyphs){const ke=we.glyphs[+Ee];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const De=I[ge][Ee],Oe=ke.metrics.localGlyph?2:1;rs.copy(ke.bitmap,he,{x:0,y:0},{x:De.x+Oe,y:De.y+Oe},ke.bitmap)}}this.image=he,this.positions=I}}Pn(wm,"GlyphAtlas");class ry{constructor(y){this.tileID=new zi(y.tileID.overscaledZ,y.tileID.wrap,y.tileID.canonical.z,y.tileID.canonical.x,y.tileID.canonical.y),this.tileZoom=y.tileZoom,this.uid=y.uid,this.zoom=y.zoom,this.canonical=y.tileID.canonical,this.pixelRatio=y.pixelRatio,this.tileSize=y.tileSize,this.source=y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=y.showCollisionBoxes,this.collectResourceTiming=!!y.collectResourceTiming,this.returnDependencies=!!y.returnDependencies,this.promoteId=y.promoteId,this.enableTerrain=!!y.enableTerrain,this.isSymbolTile=y.isSymbolTile,this.tileTransform=ba(y.tileID.canonical,y.projection),this.projection=y.projection}parse(y,I,G,Q,ne){this.status="parsing",this.data=y,this.collisionBoxArray=new zo;const he=new om(Object.keys(y.layers).sort()),ge=new xm(this.tileID,this.promoteId);ge.bucketLayerIDs=[];const we={},Ee=new Vd(256,256),ke={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ee,availableImages:G},De=I.familiesBySource[this.source];for(const bt in De){const mt=y.layers[bt];if(!mt)continue;let $t=!1,Ft=!1;for(const Nt of De[bt])Nt[0].type==="symbol"?$t=!0:Ft=!0;if(this.isSymbolTile===!0&&!$t||this.isSymbolTile===!1&&!Ft)continue;mt.version===1&&er(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=he.encode(bt),pn=[];for(let Nt=0;Nt<mt.length;Nt++){const Kt=mt.feature(Nt),nn=ge.getId(Kt,bt);pn.push({feature:Kt,id:nn,index:Nt,sourceLayerIndex:Ht})}for(const Nt of De[bt]){const Kt=Nt[0];this.isSymbolTile!==void 0&&Kt.type==="symbol"!==this.isSymbolTile||Kt.minzoom&&this.zoom<Math.floor(Kt.minzoom)||Kt.maxzoom&&this.zoom>=Kt.maxzoom||Kt.visibility!=="none"&&(Xd(Nt,this.zoom,G),(we[Kt.id]=Kt.createBucket({index:ge.bucketLayerIDs.length,layers:Nt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:G})).populate(pn,ke,this.tileID.canonical,this.tileTransform),ge.bucketLayerIDs.push(Nt.map(nn=>nn.id)))}}let Oe,Ne,Ge,We;Ee.trim();const Je={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},st=mn(ke.glyphDependencies,bt=>Object.keys(bt).map(Number));Object.keys(st).length?Q.send("getGlyphs",{uid:this.uid,stacks:st},(bt,mt)=>{Oe||(Oe=bt,Ne=mt,ht.call(this))},void 0,!1,Je):Ne={};const pt=Object.keys(ke.iconDependencies);pt.length?Q.send("getImages",{icons:pt,source:this.source,tileID:this.tileID,type:"icons"},(bt,mt)=>{Oe||(Oe=bt,Ge=mt,ht.call(this))},void 0,!1,Je):Ge={};const ct=Object.keys(ke.patternDependencies);function ht(){if(Oe)return ne(Oe);if(Ne&&Ge&&We){const bt=new wm(Ne),mt=new Tf(Ge,We);for(const $t in we){const Ft=we[$t];Ft instanceof Rs?(Xd(Ft.layers,this.zoom,G),Ag(Ft,Ne,bt.positions,Ge,mt.iconPositions,this.showCollisionBoxes,G,this.tileID.canonical,this.tileZoom,this.projection)):Ft.hasPattern&&(Ft instanceof ch||Ft instanceof oh||Ft instanceof Lc)&&(Xd(Ft.layers,this.zoom,G),Ft.addFeatures(ke,this.tileID.canonical,mt.patternPositions,G,this.tileTransform))}this.status="done",ne(null,{buckets:Gt(we).filter($t=>!$t.isEmpty()),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bt.image,lineAtlas:Ee,imageAtlas:mt,glyphMap:this.returnDependencies?Ne:null,iconMap:this.returnDependencies?Ge:null,glyphPositions:this.returnDependencies?bt.positions:null})}}ct.length?Q.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"patterns"},(bt,mt)=>{Oe||(Oe=bt,We=mt,ht.call(this))},void 0,!1,Je):We={},ht.call(this)}}function Xd(U,y,I){const G=new tt(y);for(const Q of U)Q.recalculate(G,I)}class Tm{constructor(y){this.entries={},this.scheduler=y}request(y,I,G,Q){const ne=this.entries[y]=this.entries[y]||{callbacks:[]};if(ne.result){const[he,ge]=ne.result;return this.scheduler?this.scheduler.add(()=>{Q(he,ge)},I):Q(he,ge),()=>{}}return ne.callbacks.push(Q),ne.cancel||(ne.cancel=G((he,ge)=>{ne.result=[he,ge];for(const we of ne.callbacks)this.scheduler?this.scheduler.add(()=>{we(he,ge)},I):we(he,ge);setTimeout(()=>delete this.entries[y],3e3)})),()=>{ne.result||(ne.callbacks=ne.callbacks.filter(he=>he!==Q),ne.callbacks.length||(ne.cancel(),delete this.entries[y]))}}}function Em(U,y,I){const G=JSON.stringify(U.request);return U.data&&(this.deduped.entries[G]={result:[null,U.data]}),this.deduped.request(G,{type:"parseTile",isSymbolTile:U.isSymbolTile,zoom:U.tileZoom},Q=>{const ne=Lt(U.request,(he,ge,we,Ee)=>{he?Q(he):ge&&Q(null,{vectorTile:I?void 0:new xa.VectorTile(new Uc(ge)),rawData:ge,cacheControl:we,expires:Ee})});return()=>{ne.cancel(),Q()}},y)}j.ARRAY_TYPE=qi,j.AUTH_ERR_MSG=xr,j.Aabb=Ui,j.Actor=class{constructor(U,y,I){this.target=U,this.parent=y,this.mapId=I,this.callbacks={},this.cancelCallbacks={},bn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wt()?U:Ce,this.scheduler=new Jg}send(U,y,I,G,Q=!1,ne){const he=Math.round(1e18*Math.random()).toString(36).substring(0,10);I&&(I.metadata=ne,this.callbacks[he]=I);const ge=Un(this.globalScope)?void 0:[];return this.target.postMessage({id:he,type:U,hasCallback:!!I,targetMapId:G,mustQueue:Q,sourceMapId:this.mapId,data:As(y,ge)},ge),{cancel:()=>{I&&delete this.callbacks[he],this.target.postMessage({id:he,type:"<cancel>",targetMapId:G,sourceMapId:this.mapId})}}}receive(U){const y=U.data,I=y.id;if(I&&(!y.targetMapId||this.mapId===y.targetMapId))if(y.type==="<cancel>"){const G=this.cancelCallbacks[I];delete this.cancelCallbacks[I],G&&G.cancel()}else if(y.mustQueue||Wt()){const G=this.callbacks[I];this.cancelCallbacks[I]=this.scheduler.add(()=>this.processTask(I,y),G&&G.metadata||{type:"message"})}else this.processTask(I,y)}processTask(U,y){if(y.type==="<response>"){const I=this.callbacks[U];delete this.callbacks[U],I&&(y.error?I(la(y.error)):I(null,la(y.data)))}else{const I=Un(this.globalScope)?void 0:[],G=y.hasCallback?(ne,he)=>{delete this.cancelCallbacks[U],this.target.postMessage({id:U,type:"<response>",sourceMapId:this.mapId,error:ne?As(ne):null,data:As(he,I)},I)}:ne=>{},Q=la(y.data);if(this.parent[y.type])this.parent[y.type](y.sourceMapId,Q,G);else if(this.parent.getWorkerSource){const ne=y.type.split(".");this.parent.getWorkerSource(y.sourceMapId,ne[0],Q.source)[ne[1]](Q,G)}else G(new Error(`Could not find function ${y.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},j.CanonicalTileID=ah,j.Color=zr,j.ColorMode=No,j.CullFaceMode=bo,j.DEMData=Ch,j.DataConstantProperty=_t,j.DedupedRequest=Tm,j.DepthMode=El,j.EXTENT=Hn,j.Elevation=class{isDataAvailableAtPoint(U){const y=this._source();if(!y||U.y<0||U.y>1)return!1;const I=y.getSource().maxzoom,G=1<<I,Q=Math.floor(U.x),ne=Math.floor((U.x-Q)*G),he=Math.floor(U.y*G),ge=this.findDEMTileFor(new zi(I,Q,I,ne,he));return!(!ge||!ge.dem)}getAtPointOrZero(U,y=0){return this.getAtPoint(U,y)||0}getAtPoint(U,y,I=!0){y==null&&(y=null);const G=this._source();if(!G||U.y<0||U.y>1)return y;const Q=G.getSource().maxzoom,ne=1<<Q,he=Math.floor(U.x),ge=U.x-he,we=new zi(Q,he,Q,Math.floor(ge*ne),Math.floor(U.y*ne)),Ee=this.findDEMTileFor(we);if(!Ee||!Ee.dem)return y;const ke=Ee.dem,De=1<<Ee.tileID.canonical.z,Oe=(ge*De-Ee.tileID.canonical.x)*ke.dim,Ne=(U.y*De-Ee.tileID.canonical.y)*ke.dim,Ge=Math.floor(Oe),We=Math.floor(Ne);return(I?this.exaggeration():1)*wr(wr(ke.get(Ge,We),ke.get(Ge,We+1),Ne-We),wr(ke.get(Ge+1,We),ke.get(Ge+1,We+1),Ne-We),Oe-Ge)}getAtTileOffset(U,y,I){const G=1<<U.canonical.z;return this.getAtPointOrZero(new cl(U.wrap+(U.canonical.x+y/Hn)/G,(U.canonical.y+I/Hn)/G))}getAtTileOffsetFunc(U,y,I,G){return Q=>{const ne=this.getAtTileOffset(U,Q.x,Q.y),he=G.upVector(U.canonical,Q.x,Q.y);return go(he,he,ne*G.upVectorScale(U.canonical,y,I).metersToTile),he}}getForTilePoints(U,y,I,G){const Q=Ih.create(this,U,G);return!!Q&&(y.forEach(ne=>{ne[2]=this.exaggeration()*Q.getElevationAt(ne[0],ne[1],I)}),!0)}getMinMaxForTile(U){const y=this.findDEMTileFor(U);if(!y||!y.dem)return null;const I=y.dem.tree,G=y.tileID,Q=1<<U.canonical.z-G.canonical.z;let ne=U.canonical.x/Q-G.canonical.x,he=U.canonical.y/Q-G.canonical.y,ge=0;for(let we=0;we<U.canonical.z-G.canonical.z&&!I.leaves[ge];we++){ne*=2,he*=2;const Ee=2*Math.floor(he)+Math.floor(ne);ge=I.childOffsets[ge]+Ee,ne%=1,he%=1}return{min:this.exaggeration()*I.minimums[ge],max:this.exaggeration()*I.maximums[ge]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(U,y,I){throw new Error("Pure virtual method called.")}pointCoordinate(U){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(U){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},j.ErrorEvent=Rr,j.EvaluationParameters=tt,j.Event=Br,j.Evented=jn,j.FillExtrusionBucket=Lc,j.Frustum=md,j.FrustumCorners=fd,j.GLOBE_METERS_TO_ECEF=Ld,j.GLOBE_RADIUS=ss,j.GLOBE_SCALE_MATCH_LATITUDE=45,j.GLOBE_ZOOM_THRESHOLD_MAX=6,j.GLOBE_ZOOM_THRESHOLD_MIN=5,j.GlobeSharedBuffers=class{constructor(U){this._createGrid(U),this._createPoles(U)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const U of this._poleSegments)U.destroy();for(const U of this._gridSegments)U.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const U of this._wireframeSegments)U.destroy()}}_createGrid(U){const y=new xn,I=new cr,G=65;for(let Q=0;Q<G;Q++)for(let ne=0;ne<G;ne++)y.emplaceBack(ne,Q);this._gridSegments=[];for(let Q=0,ne=0;Q<bl.length;Q++){const he=bl[Q];for(let we=0;we<he;we++)for(let Ee=0;Ee<64;Ee++){const ke=we*G+Ee;I.emplaceBack(ke+1,ke,ke+G),I.emplaceBack(ke+G,ke+G+1,ke+1)}const ge=64*he*2;this._gridSegments.push(ai.simpleSegment(0,ne,(he+1)*G,ge)),ne+=ge}this._gridBuffer=U.createVertexBuffer(y,jc.members),this._gridIndexBuffer=U.createIndexBuffer(I,!0)}_createPoles(U){const y=new cr;for(let Q=0;Q<=64;Q++)y.emplaceBack(0,Q+1,Q+2);this._poleIndexBuffer=U.createIndexBuffer(y,!0);const I=new bi,G=new bi;this._poleSegments=[];for(let Q=0,ne=0;Q<5;Q++){const he=360/(1<<Q);I.emplaceBack(0,-ss,0,.5,0),G.emplaceBack(0,-ss,0,.5,1);for(let ge=0;ge<=64;ge++){const we=ge/64,Ee=wr(0,he,we),[ke,De,Oe]=wl(Rg,zg,Ee,ss);I.emplaceBack(ke,De,Oe,we,0),G.emplaceBack(ke,De,Oe,we,1)}this._poleSegments.push(ai.simpleSegment(ne,0,66,64)),ne+=66}this._poleNorthVertexBuffer=U.createVertexBuffer(I,Vf,!1),this._poleSouthVertexBuffer=U.createVertexBuffer(G,Vf,!1)}getGridBuffers(U){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[U]]}getPoleBuffers(U){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[U]]}getWirefameBuffers(U,y){if(!this._wireframeSegments){const I=new Si,G=64,Q=G+1;this._wireframeSegments=[];for(let ne=0,he=0;ne<bl.length;ne++){const ge=bl[ne];for(let Ee=0;Ee<ge;Ee++)for(let ke=0;ke<G;ke++){const De=Ee*Q+ke;I.emplaceBack(De,De+1),I.emplaceBack(De,De+Q),I.emplaceBack(De,De+Q+1)}const we=ge*G*3;this._wireframeSegments.push(ai.simpleSegment(0,he,(ge+1)*Q,we)),he+=we}this._wireframeIndexBuffer=U.createIndexBuffer(I)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[y]]}},j.GlyphManager=vl,j.ImagePosition=Cd,j.LineAtlas=Vd,j.LngLat=Mr,j.LngLatBounds=Is,j.LocalGlyphMode=kd,j.MAX_MERCATOR_LATITUDE=Lo,j.MercatorCoordinate=cl,j.ONE_EM=Ti,j.OverscaledTileID=zi,j.Properties=Xt,j.RGBAImage=Zi,j.Ray=pd,j.RequestManager=class{constructor(U,y,I){this._transformRequestFn=U,this._customAccessToken=y,this._silenceAuthErrors=!!I,this._createSkuToken()}_createSkuToken(){const U=function(){let y="";for(let I=0;I<10;I++)y+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",gr,y].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=U.token,this._skuTokenExpiresAt=U.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(U,y){return this._transformRequestFn&&this._transformRequestFn(U,y)||{url:U}}normalizeStyleURL(U,y){if(!br(U))return U;const I=si(U);return I.path=`/styles/v1${I.path}`,this._makeAPIURL(I,this._customAccessToken||y)}normalizeGlyphsURL(U,y){if(!br(U))return U;const I=si(U);return I.path=`/fonts/v1${I.path}`,this._makeAPIURL(I,this._customAccessToken||y)}normalizeSourceURL(U,y,I,G){if(!br(U))return U;const Q=si(U);return Q.path=`/v4/${Q.authority}.json`,Q.params.push("secure"),I&&Q.params.push(`language=${I}`),G&&Q.params.push(`worldview=${G}`),this._makeAPIURL(Q,this._customAccessToken||y)}normalizeSpriteURL(U,y,I,G){const Q=si(U);return br(U)?(Q.path=`/styles/v1${Q.path}/sprite${y}${I}`,this._makeAPIURL(Q,this._customAccessToken||G)):(Q.path+=`${y}${I}`,Ni(Q))}normalizeTileURL(U,y,I){if(this._isSkuTokenExpired()&&this._createSkuToken(),U&&!br(U))return U;const G=si(U);G.path=G.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${y||I&&G.authority!=="raster"&&I===512?"@2x":""}${Tn.supported?".webp":"$1"}`),G.authority==="raster"?G.path=`/${en.RASTER_URL_PREFIX}${G.path}`:(G.path=G.path.replace(/^.+\/v4\//,"/"),G.path=`/${en.TILE_URL_VERSION}${G.path}`);const Q=this._customAccessToken||function(ne){for(const he of ne){const ge=he.match(/^access_token=(.*)$/);if(ge)return ge[1]}return null}(G.params)||en.ACCESS_TOKEN;return en.REQUIRE_ACCESS_TOKEN&&Q&&this._skuToken&&G.params.push(`sku=${this._skuToken}`),this._makeAPIURL(G,Q)}canonicalizeTileURL(U,y){const I=si(U);if(!I.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!I.path.match(/\.[\w]+$/))return U;let G="mapbox://";I.path.match(/^\/raster\/v1\//)?G+=`raster/${I.path.replace(`/${en.RASTER_URL_PREFIX}/`,"")}`:G+=`tiles/${I.path.replace(`/${en.TILE_URL_VERSION}/`,"")}`;let Q=I.params;return y&&(Q=Q.filter(ne=>!ne.match(/^access_token=/))),Q.length&&(G+=`?${Q.join("&")}`),G}canonicalizeTileset(U,y){const I=!!y&&br(y),G=[];for(const Q of U.tiles||[])Ir(Q)?G.push(this.canonicalizeTileURL(Q,I)):G.push(Q);return G}_makeAPIURL(U,y){const I="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",G=si(en.API_URL);if(U.protocol=G.protocol,U.authority=G.authority,U.protocol==="http"){const Q=U.params.indexOf("secure");Q>=0&&U.params.splice(Q,1)}if(G.path!=="/"&&(U.path=`${G.path}${U.path}`),!en.REQUIRE_ACCESS_TOKEN)return Ni(U);if(y=y||en.ACCESS_TOKEN,!this._silenceAuthErrors){if(!y)throw new Error(`An API access token is required to use Mapbox GL. ${I}`);if(y[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${I}`)}return U.params=U.params.filter(Q=>Q.indexOf("access_token")===-1),U.params.push(`access_token=${y||""}`),Ni(U)}},j.ResourceType=Tt,j.SegmentVector=ai,j.SourceCache=wa,j.StencilMode=Zd,j.StructArrayLayout1ui2=Xo,j.StructArrayLayout2f1f2i16=fo,j.StructArrayLayout2i4=xn,j.StructArrayLayout2ui4=Si,j.StructArrayLayout3f12=Hr,j.StructArrayLayout3ui6=cr,j.StructArrayLayout4i8=$n,j.StructArrayLayout5f20=bi,j.Texture=Kc,j.Tile=Gd,j.Transitionable=lt,j.Uniform1f=Zu,j.Uniform1i=class extends Qo{constructor(U){super(U),this.current=0}set(U,y,I){this.fetchUniformLocation(U,y)&&this.current!==I&&(this.current=I,this.gl.uniform1i(this.location,I))}},j.Uniform2f=class extends Qo{constructor(U){super(U),this.current=[0,0]}set(U,y,I){this.fetchUniformLocation(U,y)&&(I[0]===this.current[0]&&I[1]===this.current[1]||(this.current=I,this.gl.uniform2f(this.location,I[0],I[1])))}},j.Uniform3f=class extends Qo{constructor(U){super(U),this.current=[0,0,0]}set(U,y,I){this.fetchUniformLocation(U,y)&&(I[0]===this.current[0]&&I[1]===this.current[1]&&I[2]===this.current[2]||(this.current=I,this.gl.uniform3f(this.location,I[0],I[1],I[2])))}},j.Uniform4f=mp,j.UniformColor=_p,j.UniformMatrix2f=class extends Qo{constructor(U){super(U),this.current=$m}set(U,y,I){if(this.fetchUniformLocation(U,y)){for(let G=0;G<4;G++)if(I[G]!==this.current[G]){this.current=I,this.gl.uniformMatrix2fv(this.location,!1,I);break}}}},j.UniformMatrix3f=class extends Qo{constructor(U){super(U),this.current=Um}set(U,y,I){if(this.fetchUniformLocation(U,y)){for(let G=0;G<9;G++)if(I[G]!==this.current[G]){this.current=I,this.gl.uniformMatrix3fv(this.location,!1,I);break}}}},j.UniformMatrix4f=class extends Qo{constructor(U){super(U),this.current=Fm}set(U,y,I){if(this.fetchUniformLocation(U,y)){if(I[12]!==this.current[12]||I[0]!==this.current[0])return this.current=I,void this.gl.uniformMatrix4fv(this.location,!1,I);for(let G=1;G<16;G++)if(I[G]!==this.current[G]){this.current=I,this.gl.uniformMatrix4fv(this.location,!1,I);break}}}},j.UnwrappedTileID=uf,j.ValidationError=In,j.VectorTileWorkerSource=class extends jn{constructor(U,y,I,G,Q){super(),this.actor=U,this.layerIndex=y,this.availableImages=I,this.loadVectorData=Q||Em,this.loading={},this.loaded={},this.deduped=new Tm(U.scheduler),this.isSpriteLoaded=G,this.scheduler=U.scheduler}loadTile(U,y){const I=U.uid,G=U&&U.request,Q=G&&G.collectResourceTiming,ne=this.loading[I]=new ry(U);ne.abort=this.loadVectorData(U,(he,ge)=>{const we=!this.loading[I];if(delete this.loading[I],we||he||!ge)return ne.status="done",we||(this.loaded[I]=ne),y(he);const Ee=ge.rawData,ke={};ge.expires&&(ke.expires=ge.expires),ge.cacheControl&&(ke.cacheControl=ge.cacheControl),ne.vectorTile=ge.vectorTile||new xa.VectorTile(new Uc(Ee));const De=()=>{ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Oe,Ne)=>{if(Oe||!Ne)return y(Oe);const Ge={};if(Q){const We=tr(G);We.length>0&&(Ge.resourceTiming=JSON.parse(JSON.stringify(We)))}y(null,Ut({rawTileData:Ee.slice(0)},Ne,ke,Ge))})};this.isSpriteLoaded?De():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(De,{type:"parseTile",isSymbolTile:U.isSymbolTile,zoom:U.tileZoom}):De()}),this.loaded=this.loaded||{},this.loaded[I]=ne})}reloadTile(U,y){const I=this.loaded,G=U.uid,Q=this;if(I&&I[G]){const ne=I[G];ne.showCollisionBoxes=U.showCollisionBoxes,ne.enableTerrain=!!U.enableTerrain,ne.projection=U.projection,ne.tileTransform=ba(U.tileID.canonical,U.projection);const he=(ge,we)=>{const Ee=ne.reloadCallback;Ee&&(delete ne.reloadCallback,ne.parse(ne.vectorTile,Q.layerIndex,this.availableImages,Q.actor,Ee)),y(ge,we)};ne.status==="parsing"?ne.reloadCallback=he:ne.status==="done"&&(ne.vectorTile?ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}}abortTile(U,y){const I=U.uid,G=this.loading[I];G&&(G.abort&&G.abort(),delete this.loading[I]),y()}removeTile(U,y){const I=this.loaded,G=U.uid;I&&I[G]&&delete I[G],y()}},j.WritingMode=no,j.ZoomHistory=ku,j.add=Ms,j.addDynamicAttributes=Eh,j.adjoint=function(U,y){var I=y[0],G=y[1],Q=y[2],ne=y[3],he=y[4],ge=y[5],we=y[6],Ee=y[7],ke=y[8];return U[0]=he*ke-ge*Ee,U[1]=Q*Ee-G*ke,U[2]=G*ge-Q*he,U[3]=ge*we-ne*ke,U[4]=I*ke-Q*we,U[5]=Q*ne-I*ge,U[6]=ne*Ee-he*we,U[7]=G*we-I*Ee,U[8]=I*he-G*ne,U},j.asyncAll=Dt,j.bezier=yt,j.bindAll=bn,j.boundsAttributes=lm,j.bufferConvexPolygon=function(U,y){const I=[];for(let G=0;G<U.length;G++){const Q=At(G-1,-1,U.length-1),ne=At(G+1,-1,U.length-1),he=U[G],ge=U[ne],we=U[Q].sub(he).unit(),Ee=ge.sub(he).unit(),ke=Ee.angleWithSep(we.x,we.y),De=we.add(Ee).unit().mult(-1*y/Math.sin(ke/2));I.push(he.add(De))}return I},j.cacheEntryPossiblyAdded=function(U){ut++,ut>Ca&&(U.getActor().send("enforceCacheSizeLimit",ls),ut=0)},j.calculateGlobeLabelMatrix=function(U,y){const{x:I,y:G}=U.point,Q=Xf(I,G,U.worldSize/U._pixelsPerMercatorPixel,0,0);return hl(Q,Q,Fd(Fo(y)))},j.calculateGlobeMatrix=function(U){const{x:y,y:I}=U.point,{lng:G,lat:Q}=U._center;return Xf(y,I,U.worldSize,G,Q)},j.calculateGlobeMercatorMatrix=function(U){const y=U.pixelsPerMeter,I=y/oo(1,U.center.lat),G=Bo(new Float64Array(16));return Sc(G,G,[U.point.x,U.point.y,0]),ga(G,G,[I,I,y]),Float32Array.from(G)},j.circumferenceAtLatitude=Qh,j.clamp=Mt,j.clearTileCache=function(U){const y=at(),I=[];for(const G in Mi)y&&I.push(y.delete(G)),delete Mi[G];U&&Promise.all(I).catch(U).then(()=>U())},j.clipLine=Lf,j.clone=function(U){var y=new qi(16);return y[0]=U[0],y[1]=U[1],y[2]=U[2],y[3]=U[3],y[4]=U[4],y[5]=U[5],y[6]=U[6],y[7]=U[7],y[8]=U[8],y[9]=U[9],y[10]=U[10],y[11]=U[11],y[12]=U[12],y[13]=U[13],y[14]=U[14],y[15]=U[15],y},j.clone$1=sr,j.collisionCircleLayout=Y_,j.config=en,j.conjugate=function(U,y){return U[0]=-y[0],U[1]=-y[1],U[2]=-y[2],U[3]=y[3],U},j.create=function(){var U=new qi(16);return qi!=Float32Array&&(U[1]=0,U[2]=0,U[3]=0,U[4]=0,U[6]=0,U[7]=0,U[8]=0,U[9]=0,U[11]=0,U[12]=0,U[13]=0,U[14]=0),U[0]=1,U[5]=1,U[10]=1,U[15]=1,U},j.create$1=Pp,j.createExpression=vs,j.createLayout=Jt,j.createStyleLayer=function(U){return U.type==="custom"?new Wg(U):new Kg[U.type](U)},j.cross=dd,j.degToRad=Ke,j.distance=function(U,y){return Math.hypot(y[0]-U[0],y[1]-U[1],y[2]-U[2])},j.div=function(U,y,I){return U[0]=y[0]/I[0],U[1]=y[1]/I[1],U[2]=y[2]/I[2],U},j.dot=ao,j.ease=Ot,j.easeCubicInOut=Ct,j.emitValidationErrors=fc,j.endsWith=Ln,j.enforceCacheSizeLimit=function(U){for(const y in Mi)qe(y),Mi[y].then(I=>{I.keys().then(G=>{for(let Q=0;Q<G.length-U;Q++)I.delete(G[Q])})})},j.evaluateSizeForFeature=uh,j.evaluateSizeForZoom=ml,j.evaluateVariableOffset=$f,j.evented=Ze,j.exactEquals=function(U,y){return U[0]===y[0]&&U[1]===y[1]&&U[2]===y[2]&&U[3]===y[3]},j.exactEquals$1=function(U,y){return U[0]===y[0]&&U[1]===y[1]&&U[2]===y[2]},j.exported=yn,j.exported$1=Tn,j.extend=Ut,j.extend$1=Bi,j.fillExtrusionHeightLift=af,j.filterObject=Xn,j.fromMat4=function(U,y){return U[0]=y[0],U[1]=y[1],U[2]=y[2],U[3]=y[4],U[4]=y[5],U[5]=y[6],U[6]=y[8],U[7]=y[9],U[8]=y[10],U},j.fromQuat=function(U,y){var I=y[0],G=y[1],Q=y[2],ne=y[3],he=I+I,ge=G+G,we=Q+Q,Ee=I*he,ke=G*he,De=G*ge,Oe=Q*he,Ne=Q*ge,Ge=Q*we,We=ne*he,Je=ne*ge,st=ne*we;return U[0]=1-De-Ge,U[1]=ke+st,U[2]=Oe-Je,U[3]=0,U[4]=ke-st,U[5]=1-Ee-Ge,U[6]=Ne+We,U[7]=0,U[8]=Oe+Je,U[9]=Ne-We,U[10]=1-Ee-De,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,U},j.fromRotation=function(U,y){var I=Math.sin(y),G=Math.cos(y);return U[0]=G,U[1]=I,U[2]=0,U[3]=-I,U[4]=G,U[5]=0,U[6]=0,U[7]=0,U[8]=1,U},j.fromScaling=kp,j.furthestTileCorner=function(U){const y=Math.round((U+45+360)%360/90)%4;return It[y]},j.getAABBPointSquareDist=function(U,y,I){let G=0;for(let Q=0;Q<2;++Q){const ne=I?I[Q]:0;U[Q]>ne&&(G+=(U[Q]-ne)*(U[Q]-ne)),y[Q]<ne&&(G+=(ne-y[Q])*(ne-y[Q]))}return G},j.getAnchorAlignment=Pd,j.getAnchorJustification=zd,j.getBounds=function(U){let y=1/0,I=1/0,G=-1/0,Q=-1/0;for(const ne of U)y=Math.min(y,ne.x),I=Math.min(I,ne.y),G=Math.max(G,ne.x),Q=Math.max(Q,ne.y);return{min:new ze(y,I),max:new ze(G,Q)}},j.getColumn=_r,j.getGridMatrix=function(U,y,I){const G=y.getNorth(),Q=y.getSouth(),ne=y.getWest(),he=.015625;return[0,(y.getEast()-ne)*he,1<<U.z,(Q-G)/bl[I],0,U.y,G,ne,he]},j.getImage=Zn,j.getJSON=function(U,y){return Et(Ut(U,{type:"json"}),y)},j.getLatitudinalLod=function(U){const y=80.051129;U=Mt(U,-80.051129,y)/y*90;const I=Math.pow(Math.abs(Math.sin(Ke(U))),3);return Math.round(I*(bl.length-1))},j.getMapSessionAPI=Sl,j.getPerformanceMeasurement=tr,j.getProjection=rm,j.getRTLTextPluginStatus=Ye,j.getReferrer=kt,j.getTilePoint=function(U,{x:y,y:I},G=0){return new ze(((y-G)*U.scale-U.x)*Hn,(I*U.scale-U.y)*Hn)},j.getTileVec3=function(U,y,I=0){return dl(((y.x-I)*U.scale-U.x)*Hn,(y.y*U.scale-U.y)*Hn,vp(y.z,y.y))},j.getVideo=function(U,y){const I=Ce.document.createElement("video");I.muted=!0,I.onloadstart=function(){y(null,I)};for(let G=0;G<U.length;G++){const Q=Ce.document.createElement("source");sn(U[G])||(I.crossOrigin="Anonymous"),Q.src=U[G],I.appendChild(Q)}return{cancel:()=>{}}},j.globeCenterToScreenPoint=function(U){const y=[0,0,0],I=Bo(new Float64Array(16));return hl(I,U.pixelMatrix,U.globeMatrix),ci(y,y,I),new ze(y[0],y[1])},j.globeDenormalizeECEF=Fd,j.globeECEFOrigin=function(U,y){const I=[0,0,0];return ci(I,I,Gc(Fo(y.canonical))),ci(I,I,U),I},j.globeNormalizeECEF=Gc,j.globePixelsToTileUnits=function(U,y){return Hn/(512*Math.pow(2,U))*vh(Fo(y))},j.globePoleMatrixForTile=function(U,y,I){const G=Bo(new Float64Array(16)),Q=(y/(1<<U)-.5)*Math.PI*2;return Ju(G,I.globeMatrix,Q),Float32Array.from(G)},j.globeTileBounds=Fo,j.globeTiltAtLngLat=Kf,j.globeToMercatorTransition=qc,j.globeUseCustomAntiAliasing=function(U,y,I){const G=qc(I.zoom),Q=U.style.map._antialias,ne=!!y.extStandardDerivatives,he=y.extStandardDerivativesForceOff||U.terrain&&U.terrain.exaggeration()>0;return G===0&&!Q&&!he&&ne},j.identity=Bo,j.identity$1=Fp,j.invert=sd,j.isFullscreen=function(){return!!Ce.document.fullscreenElement||!!Ce.document.webkitFullscreenElement},j.isLngLatBehindGlobe=function(U,y){return Kf(U,y)>Math.PI/2*1.01},j.isMapAuthenticated=function(U){return Eo.has(U)},j.isMapboxURL=br,j.isSafariWithAntialiasingBug=function(U){const y=U.navigator?U.navigator.userAgent:null;return!!Un(U)&&y&&(y.match("Version/15.4")||y.match("Version/15.5")||y.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},j.latFromMercatorY=wi,j.len=r_,j.length=Cc,j.length$1=function(U){return Math.hypot(U[0],U[1],U[2],U[3])},j.loadVectorTile=Em,j.makeRequest=Et,j.mapValue=function(U,y,I,G,Q){return Mt((U-y)/(I-y)*(Q-G)+G,G,Q)},j.mercatorScale=xp,j.mercatorXfromLng=Do,j.mercatorYfromLat=ts,j.mercatorZfromAltitude=oo,j.mul=t_,j.mul$1=n_,j.multiply=hl,j.multiply$1=function(U,y,I){var G=y[0],Q=y[1],ne=y[2],he=y[3],ge=y[4],we=y[5],Ee=y[6],ke=y[7],De=y[8],Oe=I[0],Ne=I[1],Ge=I[2],We=I[3],Je=I[4],st=I[5],pt=I[6],ct=I[7],ht=I[8];return U[0]=Oe*G+Ne*he+Ge*Ee,U[1]=Oe*Q+Ne*ge+Ge*ke,U[2]=Oe*ne+Ne*we+Ge*De,U[3]=We*G+Je*he+st*Ee,U[4]=We*Q+Je*ge+st*ke,U[5]=We*ne+Je*we+st*De,U[6]=pt*G+ct*he+ht*Ee,U[7]=pt*Q+ct*ge+ht*ke,U[8]=pt*ne+ct*we+ht*De,U},j.multiply$2=Dp,j.nextPowerOfTwo=_n,j.normalize=Ri,j.normalize$1=function(U,y){var I=y[0],G=y[1],Q=y[2],ne=y[3],he=I*I+G*G+Q*Q+ne*ne;return he>0&&(he=1/Math.sqrt(he)),U[0]=I*he,U[1]=G*he,U[2]=Q*he,U[3]=ne*he,U},j.number=wr,j.ortho=function(U,y,I,G,Q,ne,he){var ge=1/(y-I),we=1/(G-Q),Ee=1/(ne-he);return U[0]=-2*ge,U[1]=0,U[2]=0,U[3]=0,U[4]=0,U[5]=-2*we,U[6]=0,U[7]=0,U[8]=0,U[9]=0,U[10]=2*Ee,U[11]=0,U[12]=(y+I)*ge,U[13]=(Q+G)*we,U[14]=(he+ne)*Ee,U[15]=1,U},j.pbf=Uc,j.perspective=function(U,y,I,G,Q){var ne,he=1/Math.tan(y/2);return U[0]=he/I,U[1]=0,U[2]=0,U[3]=0,U[4]=0,U[5]=he,U[6]=0,U[7]=0,U[8]=0,U[9]=0,U[11]=-1,U[12]=0,U[13]=0,U[15]=0,Q!=null&&Q!==1/0?(U[10]=(Q+G)*(ne=1/(G-Q)),U[14]=2*Q*G*ne):(U[10]=-1,U[14]=-2*G),U},j.pick=function(U,y){const I={};for(let G=0;G<y.length;G++){const Q=y[G];Q in U&&(I[Q]=U[Q])}return I},j.plugin=et,j.pointGeometry=ze,j.polygonContainsPoint=_a,j.polygonIntersectsBox=Cp,j.polygonIntersectsPolygon=Tp,j.polygonizeBounds=function(U,y,I=0,G=!0){const Q=new ze(I,I),ne=U.sub(Q),he=y.add(Q),ge=[ne,new ze(he.x,ne.y),he,new ze(ne.x,he.y)];return G&&ge.push(ne.clone()),ge},j.posAttributes=jc,j.postMapLoadEvent=Aa,j.postTurnstileEvent=yi,j.potpack=Sd,j.prevPowerOfTwo=function(U){return U<=1?1:Math.pow(2,Math.floor(Math.log(U)/Math.LN2))},j.radToDeg=Xe,j.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],j.registerForPluginStateChange=function(U){return U({pluginStatus:Ie,pluginURL:Re}),Ze.on("pluginStateChange",U),U},j.removeAuthState=function(U){Eo.delete(U)},j.renderColorRamp=gd,j.resample=bp,j.rotateX=ad,j.rotateX$1=Up,j.rotateY=Ju,j.rotateY$1=$p,j.rotateZ=function(U,y,I){var G=Math.sin(I),Q=Math.cos(I),ne=y[0],he=y[1],ge=y[2],we=y[3],Ee=y[4],ke=y[5],De=y[6],Oe=y[7];return y!==U&&(U[8]=y[8],U[9]=y[9],U[10]=y[10],U[11]=y[11],U[12]=y[12],U[13]=y[13],U[14]=y[14],U[15]=y[15]),U[0]=ne*Q+Ee*G,U[1]=he*Q+ke*G,U[2]=ge*Q+De*G,U[3]=we*Q+Oe*G,U[4]=Ee*Q-ne*G,U[5]=ke*Q-he*G,U[6]=De*Q-ge*G,U[7]=Oe*Q-we*G,U},j.rotateZ$1=function(U,y,I){I*=.5;var G=y[0],Q=y[1],ne=y[2],he=y[3],ge=Math.sin(I),we=Math.cos(I);return U[0]=G*we+Q*ge,U[1]=Q*we-G*ge,U[2]=ne*we+he*ge,U[3]=he*we-ne*ge,U},j.scale=ga,j.scale$1=Bp,j.scale$2=go,j.scaleAndAdd=Qu,j.setCacheLimits=function(U,y){ls=U,Ca=y},j.setColumn=function(U,y,I){U[4*y+0]=I[0],U[4*y+1]=I[1],U[4*y+2]=I[2],U[4*y+3]=I[3]},j.setRTLTextPlugin=function(U,y,I=!1){if(Ie===re||Ie===ye||Ie===be)throw new Error("setRTLTextPlugin cannot be called multiple times.");Re=yn.resolveURL(U),Ie=re,Se=y,Ue(),I||rt()},j.smoothstep=Pt,j.spec=Zt,j.storeAuthState=function(U,y){y?Eo.add(U):Eo.delete(U)},j.sub=yo,j.subtract=cd,j.symbolSize=J_,j.tileAABB=function(U,y,I,G,Q,ne,he,ge,we){if(we.name==="globe")return kg(U,y,new ah(I,G,Q));const Ee=ba({z:I,x:G,y:Q},we);return new Ui([(ne+Ee.x/Ee.scale)*y,y*(Ee.y/Ee.scale),he],[(ne+Ee.x2/Ee.scale)*y,y*(Ee.y2/Ee.scale),ge])},j.tileCornersToBounds=gh,j.tileTransform=ba,j.transformMat3=function(U,y,I){var G=y[0],Q=y[1],ne=y[2];return U[0]=G*I[0]+Q*I[3]+ne*I[6],U[1]=G*I[1]+Q*I[4]+ne*I[7],U[2]=G*I[2]+Q*I[5]+ne*I[8],U},j.transformMat4=ci,j.transformMat4$1=ya,j.transformQuat=Lp,j.transitionTileAABBinECEF=Zf,j.translate=Sc,j.transpose=function(U,y){if(U===y){var I=y[1],G=y[2],Q=y[5];U[1]=y[3],U[2]=y[6],U[3]=I,U[5]=y[7],U[6]=G,U[7]=Q}else U[0]=y[0],U[1]=y[3],U[2]=y[6],U[3]=y[1],U[4]=y[4],U[5]=y[7],U[6]=y[2],U[7]=y[5],U[8]=y[8];return U},j.triggerPluginCompletionEvent=Fe,j.uniqueId=Vt,j.updateGlobeVertexNormal=function(U,y,I,G,Q){const ne=5*y+2;U.float32[ne+0]=I,U.float32[ne+1]=G,U.float32[ne+2]=Q},j.validateCustomStyleLayer=function(U){const y=[],I=U.id;return I===void 0&&y.push({message:`layers.${I}: missing required property "id"`}),U.render===void 0&&y.push({message:`layers.${I}: missing required method "render"`}),U.renderingMode&&U.renderingMode!=="2d"&&U.renderingMode!=="3d"&&y.push({message:`layers.${I}: property "renderingMode" must be either "2d" or "3d"`}),y},j.validateFilter=U=>po(ws(U)),j.validateFog=U=>po(Cu(U)),j.validateLayer=U=>po(Ja(U)),j.validateLight=U=>po(Su(U)),j.validateSource=U=>po(Au(U)),j.validateStyle=tl,j.validateTerrain=U=>po(el(U)),j.values=Gt,j.vectorTile=xa,j.version=ft,j.warnOnce=er,j.window=Ce,j.wrap=At}),xe(["./shared"],function(j){function Ce(at){if(typeof at=="number"||typeof at=="boolean"||typeof at=="string"||at==null)return JSON.stringify(at);if(Array.isArray(at)){let He="[";for(const ot of at)He+=`${Ce(ot)},`;return`${He}]`}let qe="{";for(const He of Object.keys(at).sort())qe+=`${He}:${Ce(at[He])},`;return`${qe}}`}function Pe(at){let qe="";for(const He of j.refProperties)qe+=`/${Ce(at[He])}`;return qe}class Le{constructor(qe){this.keyCache={},qe&&this.replace(qe)}replace(qe){this._layerConfigs={},this._layers={},this.update(qe,[])}update(qe,He){for(const ut of qe)this._layerConfigs[ut.id]=ut,(this._layers[ut.id]=j.createStyleLayer(ut)).compileFilter(),this.keyCache[ut.id]&&delete this.keyCache[ut.id];for(const ut of He)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const ot=function(ut,Tt){const zt={};for(let Et=0;Et<ut.length;Et++){const Lt=Tt&&Tt[ut[Et].id]||Pe(ut[Et]);Tt&&(Tt[ut[Et].id]=Lt);let tn=zt[Lt];tn||(tn=zt[Lt]=[]),tn.push(ut[Et])}const kt=[];for(const Et in zt)kt.push(zt[Et]);return kt}(j.values(this._layerConfigs),this.keyCache);for(const ut of ot){const Tt=ut.map(Sn=>this._layers[Sn.id]),zt=Tt[0];if(zt.visibility==="none")continue;const kt=zt.source||"";let Et=this.familiesBySource[kt];Et||(Et=this.familiesBySource[kt]={});const Lt=zt.sourceLayer||"_geojsonTileLayer";let tn=Et[Lt];tn||(tn=Et[Lt]=[]),tn.push(Tt)}}}class ze{loadTile(qe,He){const{uid:ot,encoding:ut,rawImageData:Tt,padding:zt,buildQuadTree:kt}=qe,Et=j.window.ImageBitmap&&Tt instanceof j.window.ImageBitmap?this.getImageData(Tt,zt):Tt;He(null,new j.DEMData(ot,Et,ut,zt<1,kt))}getImageData(qe,He){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(qe.width,qe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=qe.width,this.offscreenCanvas.height=qe.height,this.offscreenCanvasContext.drawImage(qe,0,0,qe.width,qe.height);const ot=this.offscreenCanvasContext.getImageData(-He,-He,qe.width+2*He,qe.height+2*He);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ot}}var Be=function at(qe,He){var ot,ut=qe&&qe.type;if(ut==="FeatureCollection")for(ot=0;ot<qe.features.length;ot++)at(qe.features[ot],He);else if(ut==="GeometryCollection")for(ot=0;ot<qe.geometries.length;ot++)at(qe.geometries[ot],He);else if(ut==="Feature")at(qe.geometry,He);else if(ut==="Polygon")$e(qe.coordinates,He);else if(ut==="MultiPolygon")for(ot=0;ot<qe.coordinates.length;ot++)$e(qe.coordinates[ot],He);return qe};function $e(at,qe){if(at.length!==0){Ve(at[0],qe);for(var He=1;He<at.length;He++)Ve(at[He],!qe)}}function Ve(at,qe){for(var He=0,ot=0,ut=0,Tt=at.length,zt=Tt-1;ut<Tt;zt=ut++){var kt=(at[ut][0]-at[zt][0])*(at[zt][1]+at[ut][1]),Et=He+kt;ot+=Math.abs(He)>=Math.abs(kt)?He-Et+kt:kt-Et+He,He=Et}He+ot>=0!=!!qe&&at.reverse()}const Ke=j.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Xe{constructor(qe){this._feature=qe,this.extent=j.EXTENT,this.type=qe.type,this.properties=qe.tags,"id"in qe&&!isNaN(qe.id)&&(this.id=parseInt(qe.id,10))}loadGeometry(){if(this._feature.type===1){const qe=[];for(const He of this._feature.geometry)qe.push([new j.pointGeometry(He[0],He[1])]);return qe}{const qe=[];for(const He of this._feature.geometry){const ot=[];for(const ut of He)ot.push(new j.pointGeometry(ut[0],ut[1]));qe.push(ot)}return qe}}toGeoJSON(qe,He,ot){return Ke.call(this,qe,He,ot)}}class It{constructor(qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=j.EXTENT,this.length=qe.length,this._features=qe}feature(qe){return new Xe(this._features[qe])}}var Ct=j.vectorTile.VectorTileFeature,yt=Ot;function Ot(at,qe){this.options=qe||{},this.features=at,this.length=at.length}function Mt(at,qe){this.id=typeof at.id=="number"?at.id:void 0,this.type=at.type,this.rawGeometry=at.type===1?[at.geometry]:at.geometry,this.properties=at.tags,this.extent=qe||4096}Ot.prototype.feature=function(at){return new Mt(this.features[at],this.options.extent)},Mt.prototype.loadGeometry=function(){var at=this.rawGeometry;this.geometry=[];for(var qe=0;qe<at.length;qe++){for(var He=at[qe],ot=[],ut=0;ut<He.length;ut++)ot.push(new j.pointGeometry(He[ut][0],He[ut][1]));this.geometry.push(ot)}return this.geometry},Mt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var at=this.geometry,qe=1/0,He=-1/0,ot=1/0,ut=-1/0,Tt=0;Tt<at.length;Tt++)for(var zt=at[Tt],kt=0;kt<zt.length;kt++){var Et=zt[kt];qe=Math.min(qe,Et.x),He=Math.max(He,Et.x),ot=Math.min(ot,Et.y),ut=Math.max(ut,Et.y)}return[qe,ot,He,ut]},Mt.prototype.toGeoJSON=Ct.prototype.toGeoJSON;var Pt=Dt,At=yt;function Dt(at){var qe=new j.pbf;return function(He,ot){for(var ut in He.layers)ot.writeMessage(3,Gt,He.layers[ut])}(at,qe),qe.finish()}function Gt(at,qe){var He;qe.writeVarintField(15,at.version||1),qe.writeStringField(1,at.name||""),qe.writeVarintField(5,at.extent||4096);var ot={keys:[],values:[],keycache:{},valuecache:{}};for(He=0;He<at.length;He++)ot.feature=at.feature(He),qe.writeMessage(2,Ut,ot);var ut=ot.keys;for(He=0;He<ut.length;He++)qe.writeStringField(3,ut[He]);var Tt=ot.values;for(He=0;He<Tt.length;He++)qe.writeMessage(4,Yn,Tt[He])}function Ut(at,qe){var He=at.feature;He.id!==void 0&&qe.writeVarintField(1,He.id),qe.writeMessage(2,on,at),qe.writeVarintField(3,He.type),qe.writeMessage(4,_n,He)}function on(at,qe){var He=at.feature,ot=at.keys,ut=at.values,Tt=at.keycache,zt=at.valuecache;for(var kt in He.properties){var Et=He.properties[kt],Lt=Tt[kt];if(Et!==null){Lt===void 0&&(ot.push(kt),Tt[kt]=Lt=ot.length-1),qe.writeVarint(Lt);var tn=typeof Et;tn!=="string"&&tn!=="boolean"&&tn!=="number"&&(Et=JSON.stringify(Et));var Sn=tn+":"+Et,sn=zt[Sn];sn===void 0&&(ut.push(Et),zt[Sn]=sn=ut.length-1),qe.writeVarint(sn)}}}function Vt(at,qe){return(qe<<3)+(7&at)}function An(at){return at<<1^at>>31}function _n(at,qe){for(var He=at.loadGeometry(),ot=at.type,ut=0,Tt=0,zt=He.length,kt=0;kt<zt;kt++){var Et=He[kt],Lt=1;ot===1&&(Lt=Et.length),qe.writeVarint(Vt(1,Lt));for(var tn=ot===3?Et.length-1:Et.length,Sn=0;Sn<tn;Sn++){Sn===1&&ot!==1&&qe.writeVarint(Vt(2,tn-1));var sn=Et[Sn].x-ut,Vn=Et[Sn].y-Tt;qe.writeVarint(An(sn)),qe.writeVarint(An(Vn)),ut+=sn,Tt+=Vn}ot===3&&qe.writeVarint(Vt(7,1))}}function Yn(at,qe){var He=typeof at;He==="string"?qe.writeStringField(1,at):He==="boolean"?qe.writeBooleanField(7,at):He==="number"&&(at%1!=0?qe.writeDoubleField(3,at):at<0?qe.writeSVarintField(6,at):qe.writeVarintField(5,at))}function bn(at,qe,He,ot,ut,Tt){if(ut-ot<=He)return;const zt=ot+ut>>1;Ln(at,qe,zt,ot,ut,Tt%2),bn(at,qe,He,ot,zt-1,Tt+1),bn(at,qe,He,zt+1,ut,Tt+1)}function Ln(at,qe,He,ot,ut,Tt){for(;ut>ot;){if(ut-ot>600){const Lt=ut-ot+1,tn=He-ot+1,Sn=Math.log(Lt),sn=.5*Math.exp(2*Sn/3),Vn=.5*Math.sqrt(Sn*sn*(Lt-sn)/Lt)*(tn-Lt/2<0?-1:1);Ln(at,qe,He,Math.max(ot,Math.floor(He-tn*sn/Lt+Vn)),Math.min(ut,Math.floor(He+(Lt-tn)*sn/Lt+Vn)),Tt)}const zt=qe[2*He+Tt];let kt=ot,Et=ut;for(mn(at,qe,ot,He),qe[2*ut+Tt]>zt&&mn(at,qe,ot,ut);kt<Et;){for(mn(at,qe,kt,Et),kt++,Et--;qe[2*kt+Tt]<zt;)kt++;for(;qe[2*Et+Tt]>zt;)Et--}qe[2*ot+Tt]===zt?mn(at,qe,ot,Et):(Et++,mn(at,qe,Et,ut)),Et<=He&&(ot=Et+1),He<=Et&&(ut=Et-1)}}function mn(at,qe,He,ot){Xn(at,He,ot),Xn(qe,2*He,2*ot),Xn(qe,2*He+1,2*ot+1)}function Xn(at,qe,He){const ot=at[qe];at[qe]=at[He],at[He]=ot}function sr(at,qe,He,ot){const ut=at-He,Tt=qe-ot;return ut*ut+Tt*Tt}Pt.fromVectorTileJs=Dt,Pt.fromGeojsonVt=function(at,qe){qe=qe||{};var He={};for(var ot in at)He[ot]=new yt(at[ot].features,qe),He[ot].name=ot,He[ot].version=qe.version,He[ot].extent=qe.extent;return Dt({layers:He})},Pt.GeoJSONWrapper=At;const Pr=at=>at[0],er=at=>at[1];class rr{constructor(qe,He=Pr,ot=er,ut=64,Tt=Float64Array){this.nodeSize=ut,this.points=qe;const zt=qe.length<65536?Uint16Array:Uint32Array,kt=this.ids=new zt(qe.length),Et=this.coords=new Tt(2*qe.length);for(let Lt=0;Lt<qe.length;Lt++)kt[Lt]=Lt,Et[2*Lt]=He(qe[Lt]),Et[2*Lt+1]=ot(qe[Lt]);bn(kt,Et,ut,0,kt.length-1,0)}range(qe,He,ot,ut){return function(Tt,zt,kt,Et,Lt,tn,Sn){const sn=[0,Tt.length-1,0],Vn=[];let qn,On;for(;sn.length;){const Zn=sn.pop(),lr=sn.pop(),kr=sn.pop();if(lr-kr<=Sn){for(let jn=kr;jn<=lr;jn++)qn=zt[2*jn],On=zt[2*jn+1],qn>=kt&&qn<=Lt&&On>=Et&&On<=tn&&Vn.push(Tt[jn]);continue}const Br=Math.floor((kr+lr)/2);qn=zt[2*Br],On=zt[2*Br+1],qn>=kt&&qn<=Lt&&On>=Et&&On<=tn&&Vn.push(Tt[Br]);const Rr=(Zn+1)%2;(Zn===0?kt<=qn:Et<=On)&&(sn.push(kr),sn.push(Br-1),sn.push(Rr)),(Zn===0?Lt>=qn:tn>=On)&&(sn.push(Br+1),sn.push(lr),sn.push(Rr))}return Vn}(this.ids,this.coords,qe,He,ot,ut,this.nodeSize)}within(qe,He,ot){return function(ut,Tt,zt,kt,Et,Lt){const tn=[0,ut.length-1,0],Sn=[],sn=Et*Et;for(;tn.length;){const Vn=tn.pop(),qn=tn.pop(),On=tn.pop();if(qn-On<=Lt){for(let Rr=On;Rr<=qn;Rr++)sr(Tt[2*Rr],Tt[2*Rr+1],zt,kt)<=sn&&Sn.push(ut[Rr]);continue}const Zn=Math.floor((On+qn)/2),lr=Tt[2*Zn],kr=Tt[2*Zn+1];sr(lr,kr,zt,kt)<=sn&&Sn.push(ut[Zn]);const Br=(Vn+1)%2;(Vn===0?zt-Et<=lr:kt-Et<=kr)&&(tn.push(On),tn.push(Zn-1),tn.push(Br)),(Vn===0?zt+Et>=lr:kt+Et>=kr)&&(tn.push(Zn+1),tn.push(qn),tn.push(Br))}return Sn}(this.ids,this.coords,qe,He,ot,this.nodeSize)}}const Vr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:at=>at},Wt=Math.fround||(Rn=new Float32Array(1),at=>(Rn[0]=+at,Rn[0]));var Rn;class ln{constructor(qe){this.options=qt(Object.create(Vr),qe),this.trees=new Array(this.options.maxZoom+1)}load(qe){const{log:He,minZoom:ot,maxZoom:ut,nodeSize:Tt}=this.options;He&&console.time("total time");const zt=`prepare ${qe.length} points`;He&&console.time(zt),this.points=qe;let kt=[];for(let Et=0;Et<qe.length;Et++)qe[Et].geometry&&kt.push(dr(qe[Et],Et));this.trees[ut+1]=new rr(kt,cn,an,Tt,Float32Array),He&&console.timeEnd(zt);for(let Et=ut;Et>=ot;Et--){const Lt=+Date.now();kt=this._cluster(kt,Et),this.trees[Et]=new rr(kt,cn,an,Tt,Float32Array),He&&console.log("z%d: %d clusters in %dms",Et,kt.length,+Date.now()-Lt)}return He&&console.timeEnd("total time"),this}getClusters(qe,He){let ot=((qe[0]+180)%360+360)%360-180;const ut=Math.max(-90,Math.min(90,qe[1]));let Tt=qe[2]===180?180:((qe[2]+180)%360+360)%360-180;const zt=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)ot=-180,Tt=180;else if(ot>Tt){const tn=this.getClusters([ot,ut,180,zt],He),Sn=this.getClusters([-180,ut,Tt,zt],He);return tn.concat(Sn)}const kt=this.trees[this._limitZoom(He)],Et=kt.range(tr(ot),ft(zt),tr(Tt),ft(ut)),Lt=[];for(const tn of Et){const Sn=kt.points[tn];Lt.push(Sn.numPoints?_r(Sn):this.points[Sn.index])}return Lt}getChildren(qe){const He=this._getOriginId(qe),ot=this._getOriginZoom(qe),ut="No cluster with the specified id.",Tt=this.trees[ot];if(!Tt)throw new Error(ut);const zt=Tt.points[He];if(!zt)throw new Error(ut);const kt=this.options.radius/(this.options.extent*Math.pow(2,ot-1)),Et=Tt.within(zt.x,zt.y,kt),Lt=[];for(const tn of Et){const Sn=Tt.points[tn];Sn.parentId===qe&&Lt.push(Sn.numPoints?_r(Sn):this.points[Sn.index])}if(Lt.length===0)throw new Error(ut);return Lt}getLeaves(qe,He,ot){const ut=[];return this._appendLeaves(ut,qe,He=He||10,ot=ot||0,0),ut}getTile(qe,He,ot){const ut=this.trees[this._limitZoom(qe)],Tt=Math.pow(2,qe),{extent:zt,radius:kt}=this.options,Et=kt/zt,Lt=(ot-Et)/Tt,tn=(ot+1+Et)/Tt,Sn={features:[]};return this._addTileFeatures(ut.range((He-Et)/Tt,Lt,(He+1+Et)/Tt,tn),ut.points,He,ot,Tt,Sn),He===0&&this._addTileFeatures(ut.range(1-Et/Tt,Lt,1,tn),ut.points,Tt,ot,Tt,Sn),He===Tt-1&&this._addTileFeatures(ut.range(0,Lt,Et/Tt,tn),ut.points,-1,ot,Tt,Sn),Sn.features.length?Sn:null}getClusterExpansionZoom(qe){let He=this._getOriginZoom(qe)-1;for(;He<=this.options.maxZoom;){const ot=this.getChildren(qe);if(He++,ot.length!==1)break;qe=ot[0].properties.cluster_id}return He}_appendLeaves(qe,He,ot,ut,Tt){const zt=this.getChildren(He);for(const kt of zt){const Et=kt.properties;if(Et&&Et.cluster?Tt+Et.point_count<=ut?Tt+=Et.point_count:Tt=this._appendLeaves(qe,Et.cluster_id,ot,ut,Tt):Tt<ut?Tt++:qe.push(kt),qe.length===ot)break}return Tt}_addTileFeatures(qe,He,ot,ut,Tt,zt){for(const kt of qe){const Et=He[kt],Lt=Et.numPoints;let tn,Sn,sn;if(Lt)tn=pr(Et),Sn=Et.x,sn=Et.y;else{const On=this.points[Et.index];tn=On.properties,Sn=tr(On.geometry.coordinates[0]),sn=ft(On.geometry.coordinates[1])}const Vn={type:1,geometry:[[Math.round(this.options.extent*(Sn*Tt-ot)),Math.round(this.options.extent*(sn*Tt-ut))]],tags:tn};let qn;Lt?qn=Et.id:this.options.generateId?qn=Et.index:this.points[Et.index].id&&(qn=this.points[Et.index].id),qn!==void 0&&(Vn.id=qn),zt.features.push(Vn)}}_limitZoom(qe){return Math.max(this.options.minZoom,Math.min(+qe,this.options.maxZoom+1))}_cluster(qe,He){const ot=[],{radius:ut,extent:Tt,reduce:zt,minPoints:kt}=this.options,Et=ut/(Tt*Math.pow(2,He));for(let Lt=0;Lt<qe.length;Lt++){const tn=qe[Lt];if(tn.zoom<=He)continue;tn.zoom=He;const Sn=this.trees[He+1],sn=Sn.within(tn.x,tn.y,Et),Vn=tn.numPoints||1;let qn=Vn;for(const On of sn){const Zn=Sn.points[On];Zn.zoom>He&&(qn+=Zn.numPoints||1)}if(qn>Vn&&qn>=kt){let On=tn.x*Vn,Zn=tn.y*Vn,lr=zt&&Vn>1?this._map(tn,!0):null;const kr=(Lt<<5)+(He+1)+this.points.length;for(const Br of sn){const Rr=Sn.points[Br];if(Rr.zoom<=He)continue;Rr.zoom=He;const jn=Rr.numPoints||1;On+=Rr.x*jn,Zn+=Rr.y*jn,Rr.parentId=kr,zt&&(lr||(lr=this._map(tn,!0)),zt(lr,this._map(Rr)))}tn.parentId=kr,ot.push(Un(On/qn,Zn/qn,kr,qn,lr))}else if(ot.push(tn),qn>1)for(const On of sn){const Zn=Sn.points[On];Zn.zoom<=He||(Zn.zoom=He,ot.push(Zn))}}return ot}_getOriginId(qe){return qe-this.points.length>>5}_getOriginZoom(qe){return(qe-this.points.length)%32}_map(qe,He){if(qe.numPoints)return He?qt({},qe.properties):qe.properties;const ot=this.points[qe.index].properties,ut=this.options.map(ot);return He&&ut===ot?qt({},ut):ut}}function Un(at,qe,He,ot,ut){return{x:Wt(at),y:Wt(qe),zoom:1/0,id:He,parentId:-1,numPoints:ot,properties:ut}}function dr(at,qe){const[He,ot]=at.geometry.coordinates;return{x:Wt(tr(He)),y:Wt(ft(ot)),zoom:1/0,index:qe,parentId:-1}}function _r(at){return{type:"Feature",id:at.id,properties:pr(at),geometry:{type:"Point",coordinates:[(qe=at.x,360*(qe-.5)),wt(at.y)]}};var qe}function pr(at){const qe=at.numPoints,He=qe>=1e4?`${Math.round(qe/1e3)}k`:qe>=1e3?Math.round(qe/100)/10+"k":qe;return qt(qt({},at.properties),{cluster:!0,cluster_id:at.id,point_count:qe,point_count_abbreviated:He})}function tr(at){return at/360+.5}function ft(at){const qe=Math.sin(at*Math.PI/180),He=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return He<0?0:He>1?1:He}function wt(at){const qe=(180-360*at)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function qt(at,qe){for(const He in qe)at[He]=qe[He];return at}function cn(at){return at.x}function an(at){return at.y}function yn(at,qe,He,ot){for(var ut,Tt=ot,zt=He-qe>>1,kt=He-qe,Et=at[qe],Lt=at[qe+1],tn=at[He],Sn=at[He+1],sn=qe+3;sn<He;sn+=3){var Vn=kn(at[sn],at[sn+1],Et,Lt,tn,Sn);if(Vn>Tt)ut=sn,Tt=Vn;else if(Vn===Tt){var qn=Math.abs(sn-zt);qn<kt&&(ut=sn,kt=qn)}}Tt>ot&&(ut-qe>3&&yn(at,qe,ut,ot),at[ut+2]=Tt,He-ut>3&&yn(at,ut,He,ot))}function kn(at,qe,He,ot,ut,Tt){var zt=ut-He,kt=Tt-ot;if(zt!==0||kt!==0){var Et=((at-He)*zt+(qe-ot)*kt)/(zt*zt+kt*kt);Et>1?(He=ut,ot=Tt):Et>0&&(He+=zt*Et,ot+=kt*Et)}return(zt=at-He)*zt+(kt=qe-ot)*kt}function en(at,qe,He,ot){var ut={id:at===void 0?null:at,type:qe,geometry:He,tags:ot,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Tt){var zt=Tt.geometry,kt=Tt.type;if(kt==="Point"||kt==="MultiPoint"||kt==="LineString")Tn(Tt,zt);else if(kt==="Polygon"||kt==="MultiLineString")for(var Et=0;Et<zt.length;Et++)Tn(Tt,zt[Et]);else if(kt==="MultiPolygon")for(Et=0;Et<zt.length;Et++)for(var Lt=0;Lt<zt[Et].length;Lt++)Tn(Tt,zt[Et][Lt])}(ut),ut}function Tn(at,qe){for(var He=0;He<qe.length;He+=3)at.minX=Math.min(at.minX,qe[He]),at.minY=Math.min(at.minY,qe[He+1]),at.maxX=Math.max(at.maxX,qe[He]),at.maxY=Math.max(at.maxY,qe[He+1])}function fn(at,qe,He,ot){if(qe.geometry){var ut=qe.geometry.coordinates,Tt=qe.geometry.type,zt=Math.pow(He.tolerance/((1<<He.maxZoom)*He.extent),2),kt=[],Et=qe.id;if(He.promoteId?Et=qe.properties[He.promoteId]:He.generateId&&(Et=ot||0),Tt==="Point")Nn(ut,kt);else if(Tt==="MultiPoint")for(var Lt=0;Lt<ut.length;Lt++)Nn(ut[Lt],kt);else if(Tt==="LineString")Bn(ut,kt,zt,!1);else if(Tt==="MultiLineString"){if(He.lineMetrics){for(Lt=0;Lt<ut.length;Lt++)Bn(ut[Lt],kt=[],zt,!1),at.push(en(Et,"LineString",kt,qe.properties));return}Gn(ut,kt,zt,!1)}else if(Tt==="Polygon")Gn(ut,kt,zt,!0);else{if(Tt!=="MultiPolygon"){if(Tt==="GeometryCollection"){for(Lt=0;Lt<qe.geometry.geometries.length;Lt++)fn(at,{id:Et,geometry:qe.geometry.geometries[Lt],properties:qe.properties},He,ot);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Lt=0;Lt<ut.length;Lt++){var tn=[];Gn(ut[Lt],tn,zt,!0),kt.push(tn)}}at.push(en(Et,Tt,kt,qe.properties))}}function Nn(at,qe){qe.push(Jn(at[0])),qe.push(gr(at[1])),qe.push(0)}function Bn(at,qe,He,ot){for(var ut,Tt,zt=0,kt=0;kt<at.length;kt++){var Et=Jn(at[kt][0]),Lt=gr(at[kt][1]);qe.push(Et),qe.push(Lt),qe.push(0),kt>0&&(zt+=ot?(ut*Lt-Et*Tt)/2:Math.sqrt(Math.pow(Et-ut,2)+Math.pow(Lt-Tt,2))),ut=Et,Tt=Lt}var tn=qe.length-3;qe[2]=1,yn(qe,0,tn,He),qe[tn+2]=1,qe.size=Math.abs(zt),qe.start=0,qe.end=qe.size}function Gn(at,qe,He,ot){for(var ut=0;ut<at.length;ut++){var Tt=[];Bn(at[ut],Tt,He,ot),qe.push(Tt)}}function Jn(at){return at/360+.5}function gr(at){var qe=Math.sin(at*Math.PI/180),He=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return He<0?0:He>1?1:He}function xr(at,qe,He,ot,ut,Tt,zt,kt){if(ot/=qe,Tt>=(He/=qe)&&zt<ot)return at;if(zt<He||Tt>=ot)return null;for(var Et=[],Lt=0;Lt<at.length;Lt++){var tn=at[Lt],Sn=tn.geometry,sn=tn.type,Vn=ut===0?tn.minX:tn.minY,qn=ut===0?tn.maxX:tn.maxY;if(Vn>=He&&qn<ot)Et.push(tn);else if(!(qn<He||Vn>=ot)){var On=[];if(sn==="Point"||sn==="MultiPoint")br(Sn,On,He,ot,ut);else if(sn==="LineString")Ir(Sn,On,He,ot,ut,!1,kt.lineMetrics);else if(sn==="MultiLineString")si(Sn,On,He,ot,ut,!1);else if(sn==="Polygon")si(Sn,On,He,ot,ut,!0);else if(sn==="MultiPolygon")for(var Zn=0;Zn<Sn.length;Zn++){var lr=[];si(Sn[Zn],lr,He,ot,ut,!0),lr.length&&On.push(lr)}if(On.length){if(kt.lineMetrics&&sn==="LineString"){for(Zn=0;Zn<On.length;Zn++)Et.push(en(tn.id,sn,On[Zn],tn.tags));continue}sn!=="LineString"&&sn!=="MultiLineString"||(On.length===1?(sn="LineString",On=On[0]):sn="MultiLineString"),sn!=="Point"&&sn!=="MultiPoint"||(sn=On.length===3?"Point":"MultiPoint"),Et.push(en(tn.id,sn,On,tn.tags))}}}return Et.length?Et:null}function br(at,qe,He,ot,ut){for(var Tt=0;Tt<at.length;Tt+=3){var zt=at[Tt+ut];zt>=He&&zt<=ot&&(qe.push(at[Tt]),qe.push(at[Tt+1]),qe.push(at[Tt+2]))}}function Ir(at,qe,He,ot,ut,Tt,zt){for(var kt,Et,Lt=gi(at),tn=ut===0?ro:wo,Sn=at.start,sn=0;sn<at.length-3;sn+=3){var Vn=at[sn],qn=at[sn+1],On=at[sn+2],Zn=at[sn+3],lr=at[sn+4],kr=ut===0?Vn:qn,Br=ut===0?Zn:lr,Rr=!1;zt&&(kt=Math.sqrt(Math.pow(Vn-Zn,2)+Math.pow(qn-lr,2))),kr<He?Br>He&&(Et=tn(Lt,Vn,qn,Zn,lr,He),zt&&(Lt.start=Sn+kt*Et)):kr>ot?Br<ot&&(Et=tn(Lt,Vn,qn,Zn,lr,ot),zt&&(Lt.start=Sn+kt*Et)):Ni(Lt,Vn,qn,On),Br<He&&kr>=He&&(Et=tn(Lt,Vn,qn,Zn,lr,He),Rr=!0),Br>ot&&kr<=ot&&(Et=tn(Lt,Vn,qn,Zn,lr,ot),Rr=!0),!Tt&&Rr&&(zt&&(Lt.end=Sn+kt*Et),qe.push(Lt),Lt=gi(at)),zt&&(Sn+=kt)}var jn=at.length-3;Vn=at[jn],qn=at[jn+1],On=at[jn+2],(kr=ut===0?Vn:qn)>=He&&kr<=ot&&Ni(Lt,Vn,qn,On),jn=Lt.length-3,Tt&&jn>=3&&(Lt[jn]!==Lt[0]||Lt[jn+1]!==Lt[1])&&Ni(Lt,Lt[0],Lt[1],Lt[2]),Lt.length&&qe.push(Lt)}function gi(at){var qe=[];return qe.size=at.size,qe.start=at.start,qe.end=at.end,qe}function si(at,qe,He,ot,ut,Tt){for(var zt=0;zt<at.length;zt++)Ir(at[zt],qe,He,ot,ut,Tt,!1)}function Ni(at,qe,He,ot){at.push(qe),at.push(He),at.push(ot)}function ro(at,qe,He,ot,ut,Tt){var zt=(Tt-qe)/(ot-qe);return at.push(Tt),at.push(He+(ut-He)*zt),at.push(1),zt}function wo(at,qe,He,ot,ut,Tt){var zt=(Tt-He)/(ut-He);return at.push(qe+(ot-qe)*zt),at.push(Tt),at.push(1),zt}function li(at,qe){for(var He=[],ot=0;ot<at.length;ot++){var ut,Tt=at[ot],zt=Tt.type;if(zt==="Point"||zt==="MultiPoint"||zt==="LineString")ut=yi(Tt.geometry,qe);else if(zt==="MultiLineString"||zt==="Polygon"){ut=[];for(var kt=0;kt<Tt.geometry.length;kt++)ut.push(yi(Tt.geometry[kt],qe))}else if(zt==="MultiPolygon")for(ut=[],kt=0;kt<Tt.geometry.length;kt++){for(var Et=[],Lt=0;Lt<Tt.geometry[kt].length;Lt++)Et.push(yi(Tt.geometry[kt][Lt],qe));ut.push(Et)}He.push(en(Tt.id,zt,ut,Tt.tags))}return He}function yi(at,qe){var He=[];He.size=at.size,at.start!==void 0&&(He.start=at.start,He.end=at.end);for(var ot=0;ot<at.length;ot+=3)He.push(at[ot]+qe,at[ot+1],at[ot+2]);return He}function To(at,qe){if(at.transformed)return at;var He,ot,ut,Tt=1<<at.z,zt=at.x,kt=at.y;for(He=0;He<at.features.length;He++){var Et=at.features[He],Lt=Et.geometry,tn=Et.type;if(Et.geometry=[],tn===1)for(ot=0;ot<Lt.length;ot+=2)Et.geometry.push(Aa(Lt[ot],Lt[ot+1],qe,Tt,zt,kt));else for(ot=0;ot<Lt.length;ot++){var Sn=[];for(ut=0;ut<Lt[ot].length;ut+=2)Sn.push(Aa(Lt[ot][ut],Lt[ot][ut+1],qe,Tt,zt,kt));Et.geometry.push(Sn)}}return at.transformed=!0,at}function Aa(at,qe,He,ot,ut,Tt){return[Math.round(He*(at*ot-ut)),Math.round(He*(qe*ot-Tt))]}function Sa(at,qe,He,ot,ut){for(var Tt=qe===ut.maxZoom?0:ut.tolerance/((1<<qe)*ut.extent),zt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:He,y:ot,z:qe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},kt=0;kt<at.length;kt++){zt.numFeatures++,Sl(zt,at[kt],Tt,ut);var Et=at[kt].minX,Lt=at[kt].minY,tn=at[kt].maxX,Sn=at[kt].maxY;Et<zt.minX&&(zt.minX=Et),Lt<zt.minY&&(zt.minY=Lt),tn>zt.maxX&&(zt.maxX=tn),Sn>zt.maxY&&(zt.maxY=Sn)}return zt}function Sl(at,qe,He,ot){var ut=qe.geometry,Tt=qe.type,zt=[];if(Tt==="Point"||Tt==="MultiPoint")for(var kt=0;kt<ut.length;kt+=3)zt.push(ut[kt]),zt.push(ut[kt+1]),at.numPoints++,at.numSimplified++;else if(Tt==="LineString")Eo(zt,ut,at,He,!1,!1);else if(Tt==="MultiLineString"||Tt==="Polygon")for(kt=0;kt<ut.length;kt++)Eo(zt,ut[kt],at,He,Tt==="Polygon",kt===0);else if(Tt==="MultiPolygon")for(var Et=0;Et<ut.length;Et++){var Lt=ut[Et];for(kt=0;kt<Lt.length;kt++)Eo(zt,Lt[kt],at,He,!0,kt===0)}if(zt.length){var tn=qe.tags||null;if(Tt==="LineString"&&ot.lineMetrics){for(var Sn in tn={},qe.tags)tn[Sn]=qe.tags[Sn];tn.mapbox_clip_start=ut.start/ut.size,tn.mapbox_clip_end=ut.end/ut.size}var sn={geometry:zt,type:Tt==="Polygon"||Tt==="MultiPolygon"?3:Tt==="LineString"||Tt==="MultiLineString"?2:1,tags:tn};qe.id!==null&&(sn.id=qe.id),at.features.push(sn)}}function Eo(at,qe,He,ot,ut,Tt){var zt=ot*ot;if(ot>0&&qe.size<(ut?zt:ot))He.numPoints+=qe.length/3;else{for(var kt=[],Et=0;Et<qe.length;Et+=3)(ot===0||qe[Et+2]>zt)&&(He.numSimplified++,kt.push(qe[Et]),kt.push(qe[Et+1])),He.numPoints++;ut&&function(Lt,tn){for(var Sn=0,sn=0,Vn=Lt.length,qn=Vn-2;sn<Vn;qn=sn,sn+=2)Sn+=(Lt[sn]-Lt[qn])*(Lt[sn+1]+Lt[qn+1]);if(Sn>0===tn)for(sn=0,Vn=Lt.length;sn<Vn/2;sn+=2){var On=Lt[sn],Zn=Lt[sn+1];Lt[sn]=Lt[Vn-2-sn],Lt[sn+1]=Lt[Vn-1-sn],Lt[Vn-2-sn]=On,Lt[Vn-1-sn]=Zn}}(kt,Tt),at.push(kt)}}function co(at,qe){var He=(qe=this.options=function(ut,Tt){for(var zt in Tt)ut[zt]=Tt[zt];return ut}(Object.create(this.options),qe)).debug;if(He&&console.time("preprocess data"),qe.maxZoom<0||qe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(qe.promoteId&&qe.generateId)throw new Error("promoteId and generateId cannot be used together.");var ot=function(ut,Tt){var zt=[];if(ut.type==="FeatureCollection")for(var kt=0;kt<ut.features.length;kt++)fn(zt,ut.features[kt],Tt,kt);else fn(zt,ut.type==="Feature"?ut:{geometry:ut},Tt);return zt}(at,qe);this.tiles={},this.tileCoords=[],He&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",qe.indexMaxZoom,qe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ot=function(ut,Tt){var zt=Tt.buffer/Tt.extent,kt=ut,Et=xr(ut,1,-1-zt,zt,0,-1,2,Tt),Lt=xr(ut,1,1-zt,2+zt,0,-1,2,Tt);return(Et||Lt)&&(kt=xr(ut,1,-zt,1+zt,0,-1,2,Tt)||[],Et&&(kt=li(Et,1).concat(kt)),Lt&&(kt=kt.concat(li(Lt,-1)))),kt}(ot,qe)).length&&this.splitTile(ot,0,0,0),He&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ls(at,qe,He){return 32*((1<<at)*He+qe)+at}function Ca(at,qe){const He=at.tileID.canonical;if(!this._geoJSONIndex)return qe(null,null);const ot=this._geoJSONIndex.getTile(He.z,He.x,He.y);if(!ot)return qe(null,null);const ut=new It(ot.features);let Tt=Pt(ut);Tt.byteOffset===0&&Tt.byteLength===Tt.buffer.byteLength||(Tt=new Uint8Array(Tt)),qe(null,{vectorTile:ut,rawData:Tt.buffer})}co.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},co.prototype.splitTile=function(at,qe,He,ot,ut,Tt,zt){for(var kt=[at,qe,He,ot],Et=this.options,Lt=Et.debug;kt.length;){ot=kt.pop(),He=kt.pop(),qe=kt.pop(),at=kt.pop();var tn=1<<qe,Sn=ls(qe,He,ot),sn=this.tiles[Sn];if(!sn&&(Lt>1&&console.time("creation"),sn=this.tiles[Sn]=Sa(at,qe,He,ot,Et),this.tileCoords.push({z:qe,x:He,y:ot}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",qe,He,ot,sn.numFeatures,sn.numPoints,sn.numSimplified),console.timeEnd("creation"));var Vn="z"+qe;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(sn.source=at,ut){if(qe===Et.maxZoom||qe===ut)continue;var qn=1<<ut-qe;if(He!==Math.floor(Tt/qn)||ot!==Math.floor(zt/qn))continue}else if(qe===Et.indexMaxZoom||sn.numPoints<=Et.indexMaxPoints)continue;if(sn.source=null,at.length!==0){Lt>1&&console.time("clipping");var On,Zn,lr,kr,Br,Rr,jn=.5*Et.buffer/Et.extent,Zt=.5-jn,Bi=.5+jn,Qr=1+jn;On=Zn=lr=kr=null,Br=xr(at,tn,He-jn,He+Bi,0,sn.minX,sn.maxX,Et),Rr=xr(at,tn,He+Zt,He+Qr,0,sn.minX,sn.maxX,Et),at=null,Br&&(On=xr(Br,tn,ot-jn,ot+Bi,1,sn.minY,sn.maxY,Et),Zn=xr(Br,tn,ot+Zt,ot+Qr,1,sn.minY,sn.maxY,Et),Br=null),Rr&&(lr=xr(Rr,tn,ot-jn,ot+Bi,1,sn.minY,sn.maxY,Et),kr=xr(Rr,tn,ot+Zt,ot+Qr,1,sn.minY,sn.maxY,Et),Rr=null),Lt>1&&console.timeEnd("clipping"),kt.push(On||[],qe+1,2*He,2*ot),kt.push(Zn||[],qe+1,2*He,2*ot+1),kt.push(lr||[],qe+1,2*He+1,2*ot),kt.push(kr||[],qe+1,2*He+1,2*ot+1)}}},co.prototype.getTile=function(at,qe,He){var ot=this.options,ut=ot.extent,Tt=ot.debug;if(at<0||at>24)return null;var zt=1<<at,kt=ls(at,qe=(qe%zt+zt)%zt,He);if(this.tiles[kt])return To(this.tiles[kt],ut);Tt>1&&console.log("drilling down to z%d-%d-%d",at,qe,He);for(var Et,Lt=at,tn=qe,Sn=He;!Et&&Lt>0;)Lt--,tn=Math.floor(tn/2),Sn=Math.floor(Sn/2),Et=this.tiles[ls(Lt,tn,Sn)];return Et&&Et.source?(Tt>1&&console.log("found parent tile z%d-%d-%d",Lt,tn,Sn),Tt>1&&console.time("drilling down"),this.splitTile(Et.source,Lt,tn,Sn,at,qe,He),Tt>1&&console.timeEnd("drilling down"),this.tiles[kt]?To(this.tiles[kt],ut):null):null};class Mi extends j.VectorTileWorkerSource{constructor(qe,He,ot,ut,Tt){super(qe,He,ot,ut,Ca),Tt&&(this.loadGeoJSON=Tt)}loadData(qe,He){const ot=qe&&qe.request,ut=ot&&ot.collectResourceTiming;this.loadGeoJSON(qe,(Tt,zt)=>{if(Tt||!zt)return He(Tt);if(typeof zt!="object")return He(new Error(`Input data given to '${qe.source}' is not a valid GeoJSON object.`));{Be(zt,!0);try{if(qe.filter){const Et=j.createExpression(qe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Et.result==="error")throw new Error(Et.value.map(tn=>`${tn.key}: ${tn.message}`).join(", "));const Lt=zt.features.filter(tn=>Et.value.evaluate({zoom:0},tn));zt={type:"FeatureCollection",features:Lt}}this._geoJSONIndex=qe.cluster?new ln(function({superclusterOptions:Et,clusterProperties:Lt}){if(!Lt||!Et)return Et;const tn={},Sn={},sn={accumulated:null,zoom:0},Vn={properties:null},qn=Object.keys(Lt);for(const On of qn){const[Zn,lr]=Lt[On],kr=j.createExpression(lr),Br=j.createExpression(typeof Zn=="string"?[Zn,["accumulated"],["get",On]]:Zn);tn[On]=kr.value,Sn[On]=Br.value}return Et.map=On=>{Vn.properties=On;const Zn={};for(const lr of qn)Zn[lr]=tn[lr].evaluate(sn,Vn);return Zn},Et.reduce=(On,Zn)=>{Vn.properties=Zn;for(const lr of qn)sn.accumulated=On[lr],On[lr]=Sn[lr].evaluate(sn,Vn)},Et}(qe)).load(zt.features):function(Et,Lt){return new co(Et,Lt)}(zt,qe.geojsonVtOptions)}catch(Et){return He(Et)}this.loaded={};const kt={};if(ut){const Et=j.getPerformanceMeasurement(ot);Et&&(kt.resourceTiming={},kt.resourceTiming[qe.source]=JSON.parse(JSON.stringify(Et)))}He(null,kt)}})}reloadTile(qe,He){const ot=this.loaded;return ot&&ot[qe.uid]?super.reloadTile(qe,He):this.loadTile(qe,He)}loadGeoJSON(qe,He){if(qe.request)j.getJSON(qe.request,He);else{if(typeof qe.data!="string")return He(new Error(`Input data given to '${qe.source}' is not a valid GeoJSON object.`));try{return He(null,JSON.parse(qe.data))}catch{return He(new Error(`Input data given to '${qe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(qe,He){try{He(null,this._geoJSONIndex.getClusterExpansionZoom(qe.clusterId))}catch(ot){He(ot)}}getClusterChildren(qe,He){try{He(null,this._geoJSONIndex.getChildren(qe.clusterId))}catch(ot){He(ot)}}getClusterLeaves(qe,He){try{He(null,this._geoJSONIndex.getLeaves(qe.clusterId,qe.limit,qe.offset))}catch(ot){He(ot)}}}class Os{constructor(qe){this.self=qe,this.actor=new j.Actor(qe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=j.getProjection({name:"mercator"}),this.workerSourceTypes={vector:j.VectorTileWorkerSource,geojson:Mi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(He,ot)=>{if(this.workerSourceTypes[He])throw new Error(`Worker source with name "${He}" already registered.`);this.workerSourceTypes[He]=ot},this.self.registerRTLTextPlugin=He=>{if(j.plugin.isParsed())throw new Error("RTL text plugin already registered.");j.plugin.applyArabicShaping=He.applyArabicShaping,j.plugin.processBidirectionalText=He.processBidirectionalText,j.plugin.processStyledBidirectionalText=He.processStyledBidirectionalText}}clearCaches(qe,He,ot){delete this.layerIndexes[qe],delete this.availableImages[qe],delete this.workerSources[qe],delete this.demWorkerSources[qe],ot()}checkIfReady(qe,He,ot){ot()}setReferrer(qe,He){this.referrer=He}spriteLoaded(qe,He){this.isSpriteLoaded[qe]=He;for(const ot in this.workerSources[qe]){const ut=this.workerSources[qe][ot];for(const Tt in ut)ut[Tt]instanceof j.VectorTileWorkerSource&&(ut[Tt].isSpriteLoaded=He,ut[Tt].fire(new j.Event("isSpriteLoaded")))}}setImages(qe,He,ot){this.availableImages[qe]=He;for(const ut in this.workerSources[qe]){const Tt=this.workerSources[qe][ut];for(const zt in Tt)Tt[zt].availableImages=He}ot()}enableTerrain(qe,He,ot){this.terrain=He,ot()}setProjection(qe,He){this.projections[qe]=j.getProjection(He)}setLayers(qe,He,ot){this.getLayerIndex(qe).replace(He),ot()}updateLayers(qe,He,ot){this.getLayerIndex(qe).update(He.layers,He.removedIds),ot()}loadTile(qe,He,ot){const ut=this.enableTerrain?j.extend({enableTerrain:this.terrain},He):He;ut.projection=this.projections[qe]||this.defaultProjection,this.getWorkerSource(qe,He.type,He.source).loadTile(ut,ot)}loadDEMTile(qe,He,ot){const ut=this.enableTerrain?j.extend({buildQuadTree:this.terrain},He):He;this.getDEMWorkerSource(qe,He.source).loadTile(ut,ot)}reloadTile(qe,He,ot){const ut=this.enableTerrain?j.extend({enableTerrain:this.terrain},He):He;ut.projection=this.projections[qe]||this.defaultProjection,this.getWorkerSource(qe,He.type,He.source).reloadTile(ut,ot)}abortTile(qe,He,ot){this.getWorkerSource(qe,He.type,He.source).abortTile(He,ot)}removeTile(qe,He,ot){this.getWorkerSource(qe,He.type,He.source).removeTile(He,ot)}removeSource(qe,He,ot){if(!this.workerSources[qe]||!this.workerSources[qe][He.type]||!this.workerSources[qe][He.type][He.source])return;const ut=this.workerSources[qe][He.type][He.source];delete this.workerSources[qe][He.type][He.source],ut.removeSource!==void 0?ut.removeSource(He,ot):ot()}loadWorkerSource(qe,He,ot){try{this.self.importScripts(He.url),ot()}catch(ut){ot(ut.toString())}}syncRTLPluginState(qe,He,ot){try{j.plugin.setState(He);const ut=j.plugin.getPluginURL();if(j.plugin.isLoaded()&&!j.plugin.isParsed()&&ut!=null){this.self.importScripts(ut);const Tt=j.plugin.isParsed();ot(Tt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ut}`),Tt)}}catch(ut){ot(ut.toString())}}getAvailableImages(qe){let He=this.availableImages[qe];return He||(He=[]),He}getLayerIndex(qe){let He=this.layerIndexes[qe];return He||(He=this.layerIndexes[qe]=new Le),He}getWorkerSource(qe,He,ot){return this.workerSources[qe]||(this.workerSources[qe]={}),this.workerSources[qe][He]||(this.workerSources[qe][He]={}),this.workerSources[qe][He][ot]||(this.workerSources[qe][He][ot]=new this.workerSourceTypes[He]({send:(ut,Tt,zt,kt,Et,Lt)=>{this.actor.send(ut,Tt,zt,qe,Et,Lt)},scheduler:this.actor.scheduler},this.getLayerIndex(qe),this.getAvailableImages(qe),this.isSpriteLoaded[qe])),this.workerSources[qe][He][ot]}getDEMWorkerSource(qe,He){return this.demWorkerSources[qe]||(this.demWorkerSources[qe]={}),this.demWorkerSources[qe][He]||(this.demWorkerSources[qe][He]=new ze),this.demWorkerSources[qe][He]}enforceCacheSizeLimit(qe,He){j.enforceCacheSizeLimit(He)}getWorkerPerformanceMetrics(qe,He,ot){ot(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Os(self)),Os}),xe(["./shared"],function(j){function Ce(te,$){if(Array.isArray(te)){if(!Array.isArray($)||te.length!==$.length)return!1;for(let q=0;q<te.length;q++)if(!Ce(te[q],$[q]))return!1;return!0}if(typeof te=="object"&&te!==null&&$!==null){if(typeof $!="object"||Object.keys(te).length!==Object.keys($).length)return!1;for(const q in te)if(!Ce(te[q],$[q]))return!1;return!0}return te===$}var Pe=Le;function Le(te){return!function($){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var re,ye,be=new Blob([""],{type:"text/javascript"}),Se=URL.createObjectURL(be);try{ye=new Worker(Se),re=!0}catch{re=!1}return ye&&ye.terminate(),URL.revokeObjectURL(Se),re}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var re=document.createElement("canvas");re.width=re.height=1;var ye=re.getContext("2d");if(!ye)return!1;var be=ye.getImageData(0,0,1,1);return be&&be.width===re.width}()?(ze[q=$&&$.failIfMajorPerformanceCaveat]===void 0&&(ze[q]=function(re){var ye,be=function(Se){var Ie=document.createElement("canvas"),Re=Object.create(Le.webGLContextAttributes);return Re.failIfMajorPerformanceCaveat=Se,Ie.getContext("webgl",Re)||Ie.getContext("experimental-webgl",Re)}(re);if(!be)return!1;try{ye=be.createShader(be.VERTEX_SHADER)}catch{return!1}return!(!ye||be.isContextLost())&&(be.shaderSource(ye,"void main() {}"),be.compileShader(ye),be.getShaderParameter(ye,be.COMPILE_STATUS)===!0)}(q)),ze[q]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var q}(te)}var ze={};function Be(te,$,q){const re=j.window.document.createElement(te);return $!==void 0&&(re.className=$),q&&q.appendChild(re),re}function $e(te,$,q){const re=j.window.document.createElementNS("http://www.w3.org/2000/svg",te);for(const ye of Object.keys($))re.setAttributeNS(null,ye,$[ye]);return q&&q.appendChild(re),re}Le.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ve=j.window.document&&j.window.document.documentElement.style,Ke=Ve&&Ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Xe;function It(){Ve&&Ke&&(Xe=Ve[Ke],Ve[Ke]="none")}function Ct(){Ve&&Ke&&(Ve[Ke]=Xe)}function yt(te){te.preventDefault(),te.stopPropagation(),j.window.removeEventListener("click",yt,!0)}function Ot(){j.window.addEventListener("click",yt,!0),j.window.setTimeout(()=>{j.window.removeEventListener("click",yt,!0)},0)}function Mt(te,$){const q=te.getBoundingClientRect();return Dt(te,q,$)}function Pt(te,$){const q=te.getBoundingClientRect(),re=[];for(let ye=0;ye<$.length;ye++)re.push(Dt(te,q,$[ye]));return re}function At(te){return j.window.InstallTrigger!==void 0&&te.button===2&&te.ctrlKey&&j.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:te.button}function Dt(te,$,q){const re=te.offsetWidth===$.width?1:te.offsetWidth/$.width;return new j.pointGeometry((q.clientX-$.left)*re,(q.clientY-$.top)*re)}function Gt(te,$){var q=$[0],re=$[1],ye=$[2],be=$[3],Se=q*be-ye*re;return Se?(te[0]=be*(Se=1/Se),te[1]=-re*Se,te[2]=-ye*Se,te[3]=q*Se,te):null}function Ut(te){const{userImage:$}=te;return!!($&&$.render&&$.render())&&(te.data.replace(new Uint8Array($.data.buffer)),!0)}class on extends j.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new j.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded($){if(this.loaded!==$&&(this.loaded=$,$)){for(const{ids:q,callback:re}of this.requestors)this._notify(q,re);this.requestors=[]}}hasImage($){return!!this.getImage($)}getImage($){return this.images[$]}addImage($,q){this._validate($,q)&&(this.images[$]=q)}_validate($,q){let re=!0;return this._validateStretch(q.stretchX,q.data&&q.data.width)||(this.fire(new j.ErrorEvent(new Error(`Image "${$}" has invalid "stretchX" value`))),re=!1),this._validateStretch(q.stretchY,q.data&&q.data.height)||(this.fire(new j.ErrorEvent(new Error(`Image "${$}" has invalid "stretchY" value`))),re=!1),this._validateContent(q.content,q)||(this.fire(new j.ErrorEvent(new Error(`Image "${$}" has invalid "content" value`))),re=!1),re}_validateStretch($,q){if(!$)return!0;let re=0;for(const ye of $){if(ye[0]<re||ye[1]<ye[0]||q<ye[1])return!1;re=ye[1]}return!0}_validateContent($,q){return!($&&($.length!==4||$[0]<0||q.data.width<$[0]||$[1]<0||q.data.height<$[1]||$[2]<0||q.data.width<$[2]||$[3]<0||q.data.height<$[3]||$[2]<$[0]||$[3]<$[1]))}updateImage($,q){q.version=this.images[$].version+1,this.images[$]=q,this.updatedImages[$]=!0}removeImage($){const q=this.images[$];delete this.images[$],delete this.patterns[$],q.userImage&&q.userImage.onRemove&&q.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages($,q){let re=!0;if(!this.isLoaded())for(const ye of $)this.images[ye]||(re=!1);this.isLoaded()||re?this._notify($,q):this.requestors.push({ids:$,callback:q})}_notify($,q){const re={};for(const ye of $){this.images[ye]||this.fire(new j.Event("styleimagemissing",{id:ye}));const be=this.images[ye];be?re[ye]={data:be.data.clone(),pixelRatio:be.pixelRatio,sdf:be.sdf,version:be.version,stretchX:be.stretchX,stretchY:be.stretchY,content:be.content,hasRenderCallback:Boolean(be.userImage&&be.userImage.render)}:j.warnOnce(`Image "${ye}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}q(null,re)}getPixelSize(){const{width:$,height:q}=this.atlasImage;return{width:$,height:q}}getPattern($){const q=this.patterns[$],re=this.getImage($);if(!re)return null;if(q&&q.position.version===re.version)return q.position;if(q)q.position.version=re.version;else{const ye={w:re.data.width+2,h:re.data.height+2,x:0,y:0},be=new j.ImagePosition(ye,re);this.patterns[$]={bin:ye,position:be}}return this._updatePatternAtlas(),this.patterns[$].position}bind($){const q=$.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new j.Texture($,this.atlasImage,q.RGBA),this.atlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE)}_updatePatternAtlas(){const $=[];for(const be in this.patterns)$.push(this.patterns[be].bin);const{w:q,h:re}=j.potpack($),ye=this.atlasImage;ye.resize({width:q||1,height:re||1});for(const be in this.patterns){const{bin:Se}=this.patterns[be],Ie=Se.x+1,Re=Se.y+1,Fe=this.images[be].data,Ue=Fe.width,Ze=Fe.height;j.RGBAImage.copy(Fe,ye,{x:0,y:0},{x:Ie,y:Re},{width:Ue,height:Ze}),j.RGBAImage.copy(Fe,ye,{x:0,y:Ze-1},{x:Ie,y:Re-1},{width:Ue,height:1}),j.RGBAImage.copy(Fe,ye,{x:0,y:0},{x:Ie,y:Re+Ze},{width:Ue,height:1}),j.RGBAImage.copy(Fe,ye,{x:Ue-1,y:0},{x:Ie-1,y:Re},{width:1,height:Ze}),j.RGBAImage.copy(Fe,ye,{x:0,y:0},{x:Ie+Ue,y:Re},{width:1,height:Ze})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks($){for(const q of $){if(this.callbackDispatchedThisFrame[q])continue;this.callbackDispatchedThisFrame[q]=!0;const re=this.images[q];Ut(re)&&this.updateImage(q,re)}}}const Vt=new j.Properties({anchor:new j.DataConstantProperty(j.spec.light.anchor),position:new class{constructor(){this.specification=j.spec.light.position}possiblyEvaluate(te,$){return function([q,re,ye]){const be=j.degToRad(re+90),Se=j.degToRad(ye);return{x:q*Math.cos(be)*Math.sin(Se),y:q*Math.sin(be)*Math.sin(Se),z:q*Math.cos(Se),azimuthal:re,polar:ye}}(te.expression.evaluate($))}interpolate(te,$,q){return{x:j.number(te.x,$.x,q),y:j.number(te.y,$.y,q),z:j.number(te.z,$.z,q),azimuthal:j.number(te.azimuthal,$.azimuthal,q),polar:j.number(te.polar,$.polar,q)}}},color:new j.DataConstantProperty(j.spec.light.color),intensity:new j.DataConstantProperty(j.spec.light.intensity)}),An="-transition";class _n extends j.Evented{constructor($){super(),this._transitionable=new j.Transitionable(Vt),this.setLight($),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight($,q={}){if(!this._validate(j.validateLight,$,q))for(const re in $){const ye=$[re];j.endsWith(re,An)?this._transitionable.setTransition(re.slice(0,-An.length),ye):this._transitionable.setValue(re,ye)}}updateTransitions($){this._transitioning=this._transitionable.transitioned($,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate($){this.properties=this._transitioning.possiblyEvaluate($)}_validate($,q,re){return(!re||re.validate!==!1)&&j.emitValidationErrors(this,$.call(j.validateStyle,j.extend({value:q,style:{glyphs:!0,sprite:!0},styleSpec:j.spec})))}}const Yn=new j.Properties({source:new j.DataConstantProperty(j.spec.terrain.source),exaggeration:new j.DataConstantProperty(j.spec.terrain.exaggeration)}),bn="-transition";class Ln extends j.Evented{constructor($,q){super(),this._transitionable=new j.Transitionable(Yn),this.set($),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=q}get(){return this._transitionable.serialize()}set($){for(const q in $){const re=$[q];j.endsWith(q,bn)?this._transitionable.setTransition(q.slice(0,-bn.length),re):this._transitionable.setValue(q,re)}}updateTransitions($){this._transitioning=this._transitionable.transitioned($,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate($){this.properties=this._transitioning.possiblyEvaluate($)}}function mn(te,$,q,re){const ye=j.smoothstep(45,65,q),[be,Se]=Xn(te,re),Ie=j.length($);let Re=1-Math.min(1,Math.exp((Ie-be)/(Se-be)*-6));return Re*=Re*Re,Re=Math.min(1,1.00747*Re),Re*ye*te.alpha}function Xn(te,$){const q=.5/Math.tan(.5*$);return[te.range[0]+q,te.range[1]+q]}const sr=new j.Properties({range:new j.DataConstantProperty(j.spec.fog.range),color:new j.DataConstantProperty(j.spec.fog.color),"high-color":new j.DataConstantProperty(j.spec.fog["high-color"]),"space-color":new j.DataConstantProperty(j.spec.fog["space-color"]),"horizon-blend":new j.DataConstantProperty(j.spec.fog["horizon-blend"]),"star-intensity":new j.DataConstantProperty(j.spec.fog["star-intensity"])}),Pr="-transition";class er extends j.Evented{constructor($,q){super(),this._transitionable=new j.Transitionable(sr),this.set($),this._transitioning=this._transitionable.untransitioned(),this._transform=q}get state(){const $=this._transform,q=$.projection.name==="globe",re=j.globeToMercatorTransition($.zoom),ye=this.properties.get("range"),be=[.5,3];return{range:q?[j.number(be[0],ye[0],re),j.number(be[1],ye[1],re)]:ye,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set($,q={}){if(!this._validate(j.validateFog,$,q)){for(const re of Object.keys(j.spec.fog))$&&$[re]===void 0&&($[re]=j.spec.fog[re].default);for(const re in $){const ye=$[re];j.endsWith(re,Pr)?this._transitionable.setTransition(re.slice(0,-Pr.length),ye):this._transitionable.setValue(re,ye)}}}getOpacity($){if(!this._transform.projection.supportsFog)return 0;const q=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:j.smoothstep(45,65,$))*q.a}getOpacityAtLatLng($,q){return this._transform.projection.supportsFog?function(re,ye,be){const Se=j.MercatorCoordinate.fromLngLat(ye),Ie=be.elevation?be.elevation.getAtPointOrZero(Se):0,Re=[Se.x,Se.y,Ie];return j.transformMat4(Re,Re,be.mercatorFogMatrix),mn(re,Re,be.pitch,be._fov)}(this.state,$,q):0}getFovAdjustedRange($){return this._transform.projection.supportsFog?Xn(this.state,$):[0,1]}updateTransitions($){this._transitioning=this._transitionable.transitioned($,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate($){this.properties=this._transitioning.possiblyEvaluate($)}_validate($,q,re){return(!re||re.validate!==!1)&&j.emitValidationErrors(this,$.call(j.validateStyle,j.extend({value:q,style:{glyphs:!0,sprite:!0},styleSpec:j.spec})))}}class rr{constructor($,q){this.workerPool=$,this.actors=[],this.currentActor=0,this.id=j.uniqueId();const re=this.workerPool.acquire(this.id);for(let ye=0;ye<re.length;ye++){const be=new rr.Actor(re[ye],q,this.id);be.name=`Worker ${ye}`,this.actors.push(be)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast($,q,re){j.asyncAll(this.actors,(ye,be)=>{ye.send($,q,be)},re=re||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach($=>{$.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Vr(te,$,q){return $*(j.EXTENT/(te.tileSize*Math.pow(2,q-te.tileID.overscaledZ)))}rr.Actor=j.Actor;class Wt{constructor($,q,re,ye){this.screenBounds=$,this.cameraPoint=q,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=re,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,ye)}static createFromScreenPoints($,q){let re,ye;if($ instanceof j.pointGeometry||typeof $[0]=="number"){const be=j.pointGeometry.convert($);re=[j.pointGeometry.convert($)],ye=q.isPointAboveHorizon(be)}else{const be=j.pointGeometry.convert($[0]),Se=j.pointGeometry.convert($[1]);re=[be,Se],ye=j.polygonizeBounds(be,Se).every(Ie=>q.isPointAboveHorizon(Ie))}return new Wt(re,q.getCameraPoint(),ye,q)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry($){return j.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],$)}bufferedCameraGeometry($){const q=this.screenBounds[0],re=this.screenBounds.length===1?this.screenBounds[0].add(new j.pointGeometry(1,1)):this.screenBounds[1],ye=j.polygonizeBounds(q,re,0,!1);return this.cameraPoint.y>re.y&&(this.cameraPoint.x>q.x&&this.cameraPoint.x<re.x?ye.splice(3,0,this.cameraPoint):this.cameraPoint.x>=re.x?ye[2]=this.cameraPoint:this.cameraPoint.x<=q.x&&(ye[3]=this.cameraPoint)),j.bufferConvexPolygon(ye,$)}bufferedCameraGeometryGlobe($){const q=this.screenBounds[0],re=this.screenBounds.length===1?this.screenBounds[0].add(new j.pointGeometry(1,1)):this.screenBounds[1],ye=j.polygonizeBounds(q,re,$),be=this.cameraPoint.clone();switch(3*((be.y>q.y)+(be.y>re.y))+((be.x>q.x)+(be.x>re.x))){case 0:ye[0]=be,ye[4]=be.clone();break;case 1:ye.splice(1,0,be);break;case 2:ye[1]=be;break;case 3:ye.splice(4,0,be);break;case 5:ye.splice(2,0,be);break;case 6:ye[3]=be;break;case 7:ye.splice(3,0,be);break;case 8:ye[2]=be}return ye}containsTile($,q,re,ye=0){const be=$.queryPadding/q._pixelsPerMercatorPixel+1,Se=re?this._bufferedCameraMercator(be,q):this._bufferedScreenMercator(be,q);let Ie=$.tileID.wrap+(Se.unwrapped?ye:0);const Re=Se.polygon.map(nt=>j.getTilePoint($.tileTransform,nt,Ie));if(!j.polygonIntersectsBox(Re,0,0,j.EXTENT,j.EXTENT))return;Ie=$.tileID.wrap+(this.screenGeometryMercator.unwrapped?ye:0);const Fe=this.screenGeometryMercator.polygon.map(nt=>j.getTileVec3($.tileTransform,nt,Ie)),Ue=Fe.map(nt=>new j.pointGeometry(nt[0],nt[1])),Ze=q.getFreeCameraOptions().position||new j.MercatorCoordinate(0,0,0),Ye=j.getTileVec3($.tileTransform,Ze,Ie),rt=Fe.map(nt=>{const Qe=j.sub(nt,nt,Ye);return j.normalize(Qe,Qe),new j.Ray(Ye,Qe)}),et=Vr($,1,q.zoom)*q._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Ue,tilespaceRays:rt,bufferedTilespaceGeometry:Re,bufferedTilespaceBounds:(tt=j.getBounds(Re),tt.min.x=j.clamp(tt.min.x,0,j.EXTENT),tt.min.y=j.clamp(tt.min.y,0,j.EXTENT),tt.max.x=j.clamp(tt.max.x,0,j.EXTENT),tt.max.y=j.clamp(tt.max.y,0,j.EXTENT),tt),tile:$,tileID:$.tileID,pixelToTileUnitsFactor:et};var tt}_bufferedScreenMercator($,q){const re=Un($);if(this._screenRaycastCache[re])return this._screenRaycastCache[re];{let ye;return ye=q.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry($),q):{polygon:this.bufferedScreenGeometry($).map(be=>q.pointCoordinate3D(be)),unwrapped:!0},this._screenRaycastCache[re]=ye,ye}}_bufferedCameraMercator($,q){const re=Un($);if(this._cameraRaycastCache[re])return this._cameraRaycastCache[re];{let ye;return ye=q.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe($),q):{polygon:this.bufferedCameraGeometry($).map(be=>q.pointCoordinate3D(be)),unwrapped:!0},this._cameraRaycastCache[re]=ye,ye}}_projectAndResample($,q){const re=function(be,Se){const Ie=j.multiply([],Se.pixelMatrix,Se.globeMatrix),Re=[0,-j.GLOBE_RADIUS,0,1],Fe=[0,j.GLOBE_RADIUS,0,1],Ue=[0,0,0,1];j.transformMat4$1(Re,Re,Ie),j.transformMat4$1(Fe,Fe,Ie),j.transformMat4$1(Ue,Ue,Ie);const Ze=new j.pointGeometry(Re[0]/Re[3],Re[1]/Re[3]),Ye=new j.pointGeometry(Fe[0]/Fe[3],Fe[1]/Fe[3]),rt=j.polygonContainsPoint(be,Ze)&&Re[3]<Ue[3],et=j.polygonContainsPoint(be,Ye)&&Fe[3]<Ue[3];if(!rt&&!et)return null;const tt=function(vt,_t,St){for(let Bt=1;Bt<vt.length;Bt++){const un=ln(_t.pointCoordinate3D(vt[Bt-1]).x),Rt=ln(_t.pointCoordinate3D(vt[Bt]).x);if(St<0){if(un<Rt)return{idx:Bt,t:-un/(Rt-1-un)}}else if(Rt<un)return{idx:Bt,t:(1-un)/(Rt+1-un)}}return null}(be,Se,rt?-1:1);if(!tt)return null;const{idx:nt,t:Qe}=tt;let lt=nt>1?Rn(be.slice(0,nt),Se):[],it=nt<be.length?Rn(be.slice(nt),Se):[];lt=lt.map(vt=>new j.pointGeometry(ln(vt.x),vt.y)),it=it.map(vt=>new j.pointGeometry(ln(vt.x),vt.y));const xt=[...lt];xt.length===0&&xt.push(it[it.length-1]);const gt=j.number(xt[xt.length-1].y,(it.length===0?lt[0]:it[0]).y,Qe);let dt;return dt=rt?[new j.pointGeometry(0,gt),new j.pointGeometry(0,0),new j.pointGeometry(1,0),new j.pointGeometry(1,gt)]:[new j.pointGeometry(1,gt),new j.pointGeometry(1,1),new j.pointGeometry(0,1),new j.pointGeometry(0,gt)],xt.push(...dt),it.length===0?xt.push(lt[0]):xt.push(...it),{polygon:xt.map(vt=>new j.MercatorCoordinate(vt.x,vt.y)),unwrapped:!1}}($,q);if(re)return re;const ye=function(be,Se){let Ie=!1,Re=-1/0,Fe=0;for(let Ze=0;Ze<be.length-1;Ze++)be[Ze].x>Re&&(Re=be[Ze].x,Fe=Ze);for(let Ze=0;Ze<be.length-1;Ze++){const Ye=(Fe+Ze)%(be.length-1),rt=be[Ye],et=be[Ye+1];Math.abs(rt.x-et.x)>.5&&(rt.x<et.x?(rt.x+=1,Ye===0&&(be[be.length-1].x+=1)):(et.x+=1,Ye+1===be.length-1&&(be[0].x+=1)),Ie=!0)}const Ue=j.mercatorXfromLng(Se.center.lng);return Ie&&Ue<Math.abs(Ue-1)&&be.forEach(Ze=>{Ze.x-=1}),{polygon:be,unwrapped:Ie}}(Rn($,q).map(be=>new j.pointGeometry(ln(be.x),be.y)),q);return{polygon:ye.polygon.map(be=>new j.MercatorCoordinate(be.x,be.y)),unwrapped:ye.unwrapped}}}function Rn(te,$){return j.resample(te,q=>{const re=$.pointCoordinate3D(q);q.x=re.x,q.y=re.y},1/256)}function ln(te){return te<0?1+te%1:te%1}function Un(te){return 100*te|0}function dr(te,$,q,re,ye){const be=function(Se,Ie){if(Se)return ye(Se);if(Ie){const Re=j.pick(j.extend(Ie,te),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);Ie.vector_layers&&(Re.vectorLayers=Ie.vector_layers,Re.vectorLayerIds=Re.vectorLayers.map(Fe=>Fe.id)),Ie.language_options&&(Re.languageOptions=Ie.language_options),Ie.language&&Ie.language[Ie.id]&&(Re.language=Ie.language[Ie.id]),Ie.worldview_options&&(Re.worldviewOptions=Ie.worldview_options),Ie.worldview?Re.worldview=Ie.worldview[Ie.id]:Ie.worldview_default&&(Re.worldview=Ie.worldview_default),Re.tiles=$.canonicalizeTileset(Re,te.url),ye(null,Re)}};return te.url?j.getJSON($.transformRequest($.normalizeSourceURL(te.url,null,q,re),j.ResourceType.Source),be):j.exported.frame(()=>be(null,te))}class _r{constructor($,q,re){this.bounds=j.LngLatBounds.convert(this.validateBounds($)),this.minzoom=q||0,this.maxzoom=re||24}validateBounds($){return Array.isArray($)&&$.length===4?[Math.max(-180,$[0]),Math.max(-90,$[1]),Math.min(180,$[2]),Math.min(90,$[3])]:[-180,-90,180,90]}contains($){const q=Math.pow(2,$.z),re=Math.floor(j.mercatorXfromLng(this.bounds.getWest())*q),ye=Math.floor(j.mercatorYfromLat(this.bounds.getNorth())*q),be=Math.ceil(j.mercatorXfromLng(this.bounds.getEast())*q),Se=Math.ceil(j.mercatorYfromLat(this.bounds.getSouth())*q);return $.x>=re&&$.x<be&&$.y>=ye&&$.y<Se}}class pr{constructor($,q,re){this.context=$;const ye=$.gl;this.buffer=ye.createBuffer(),this.dynamicDraw=Boolean(re),this.context.unbindVAO(),$.bindElementBuffer.set(this.buffer),ye.bufferData(ye.ELEMENT_ARRAY_BUFFER,q.arrayBuffer,this.dynamicDraw?ye.DYNAMIC_DRAW:ye.STATIC_DRAW),this.dynamicDraw||q.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData($){const q=this.context.gl;this.context.unbindVAO(),this.bind(),q.bufferSubData(q.ELEMENT_ARRAY_BUFFER,0,$.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ft{constructor($,q,re,ye){this.length=q.length,this.attributes=re,this.itemSize=q.bytesPerElement,this.dynamicDraw=ye,this.context=$;const be=$.gl;this.buffer=be.createBuffer(),$.bindVertexBuffer.set(this.buffer),be.bufferData(be.ARRAY_BUFFER,q.arrayBuffer,this.dynamicDraw?be.DYNAMIC_DRAW:be.STATIC_DRAW),this.dynamicDraw||q.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData($){const q=this.context.gl;this.bind(),q.bufferSubData(q.ARRAY_BUFFER,0,$.arrayBuffer)}enableAttributes($,q){for(let re=0;re<this.attributes.length;re++){const ye=q.attributes[this.attributes[re].name];ye!==void 0&&$.enableVertexAttribArray(ye)}}setVertexAttribPointers($,q,re){for(let ye=0;ye<this.attributes.length;ye++){const be=this.attributes[ye],Se=q.attributes[be.name];Se!==void 0&&$.vertexAttribPointer(Se,be.components,$[tr[be.type]],!1,this.itemSize,be.offset+this.itemSize*(re||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wt{constructor($){this.gl=$.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set($){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qt extends wt{getDefault(){return j.Color.transparent}set($){const q=this.current;($.r!==q.r||$.g!==q.g||$.b!==q.b||$.a!==q.a||this.dirty)&&(this.gl.clearColor($.r,$.g,$.b,$.a),this.current=$,this.dirty=!1)}}class cn extends wt{getDefault(){return 1}set($){($!==this.current||this.dirty)&&(this.gl.clearDepth($),this.current=$,this.dirty=!1)}}class an extends wt{getDefault(){return 0}set($){($!==this.current||this.dirty)&&(this.gl.clearStencil($),this.current=$,this.dirty=!1)}}class yn extends wt{getDefault(){return[!0,!0,!0,!0]}set($){const q=this.current;($[0]!==q[0]||$[1]!==q[1]||$[2]!==q[2]||$[3]!==q[3]||this.dirty)&&(this.gl.colorMask($[0],$[1],$[2],$[3]),this.current=$,this.dirty=!1)}}class kn extends wt{getDefault(){return!0}set($){($!==this.current||this.dirty)&&(this.gl.depthMask($),this.current=$,this.dirty=!1)}}class en extends wt{getDefault(){return 255}set($){($!==this.current||this.dirty)&&(this.gl.stencilMask($),this.current=$,this.dirty=!1)}}class Tn extends wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set($){const q=this.current;($.func!==q.func||$.ref!==q.ref||$.mask!==q.mask||this.dirty)&&(this.gl.stencilFunc($.func,$.ref,$.mask),this.current=$,this.dirty=!1)}}class fn extends wt{getDefault(){const $=this.gl;return[$.KEEP,$.KEEP,$.KEEP]}set($){const q=this.current;($[0]!==q[0]||$[1]!==q[1]||$[2]!==q[2]||this.dirty)&&(this.gl.stencilOp($[0],$[1],$[2]),this.current=$,this.dirty=!1)}}class Nn extends wt{getDefault(){return!1}set($){if($===this.current&&!this.dirty)return;const q=this.gl;$?q.enable(q.STENCIL_TEST):q.disable(q.STENCIL_TEST),this.current=$,this.dirty=!1}}class Bn extends wt{getDefault(){return[0,1]}set($){const q=this.current;($[0]!==q[0]||$[1]!==q[1]||this.dirty)&&(this.gl.depthRange($[0],$[1]),this.current=$,this.dirty=!1)}}class Gn extends wt{getDefault(){return!1}set($){if($===this.current&&!this.dirty)return;const q=this.gl;$?q.enable(q.DEPTH_TEST):q.disable(q.DEPTH_TEST),this.current=$,this.dirty=!1}}class Jn extends wt{getDefault(){return this.gl.LESS}set($){($!==this.current||this.dirty)&&(this.gl.depthFunc($),this.current=$,this.dirty=!1)}}class gr extends wt{getDefault(){return!1}set($){if($===this.current&&!this.dirty)return;const q=this.gl;$?q.enable(q.BLEND):q.disable(q.BLEND),this.current=$,this.dirty=!1}}class xr extends wt{getDefault(){const $=this.gl;return[$.ONE,$.ZERO]}set($){const q=this.current;($[0]!==q[0]||$[1]!==q[1]||this.dirty)&&(this.gl.blendFunc($[0],$[1]),this.current=$,this.dirty=!1)}}class br extends wt{getDefault(){return j.Color.transparent}set($){const q=this.current;($.r!==q.r||$.g!==q.g||$.b!==q.b||$.a!==q.a||this.dirty)&&(this.gl.blendColor($.r,$.g,$.b,$.a),this.current=$,this.dirty=!1)}}class Ir extends wt{getDefault(){return this.gl.FUNC_ADD}set($){($!==this.current||this.dirty)&&(this.gl.blendEquation($),this.current=$,this.dirty=!1)}}class gi extends wt{getDefault(){return!1}set($){if($===this.current&&!this.dirty)return;const q=this.gl;$?q.enable(q.CULL_FACE):q.disable(q.CULL_FACE),this.current=$,this.dirty=!1}}class si extends wt{getDefault(){return this.gl.BACK}set($){($!==this.current||this.dirty)&&(this.gl.cullFace($),this.current=$,this.dirty=!1)}}class Ni extends wt{getDefault(){return this.gl.CCW}set($){($!==this.current||this.dirty)&&(this.gl.frontFace($),this.current=$,this.dirty=!1)}}class ro extends wt{getDefault(){return null}set($){($!==this.current||this.dirty)&&(this.gl.useProgram($),this.current=$,this.dirty=!1)}}class wo extends wt{getDefault(){return this.gl.TEXTURE0}set($){($!==this.current||this.dirty)&&(this.gl.activeTexture($),this.current=$,this.dirty=!1)}}class li extends wt{getDefault(){const $=this.gl;return[0,0,$.drawingBufferWidth,$.drawingBufferHeight]}set($){const q=this.current;($[0]!==q[0]||$[1]!==q[1]||$[2]!==q[2]||$[3]!==q[3]||this.dirty)&&(this.gl.viewport($[0],$[1],$[2],$[3]),this.current=$,this.dirty=!1)}}class yi extends wt{getDefault(){return null}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.bindFramebuffer(q.FRAMEBUFFER,$),this.current=$,this.dirty=!1}}class To extends wt{getDefault(){return null}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.bindRenderbuffer(q.RENDERBUFFER,$),this.current=$,this.dirty=!1}}class Aa extends wt{getDefault(){return null}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.bindTexture(q.TEXTURE_2D,$),this.current=$,this.dirty=!1}}class Sa extends wt{getDefault(){return null}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.bindBuffer(q.ARRAY_BUFFER,$),this.current=$,this.dirty=!1}}class Sl extends wt{getDefault(){return null}set($){const q=this.gl;q.bindBuffer(q.ELEMENT_ARRAY_BUFFER,$),this.current=$,this.dirty=!1}}class Eo extends wt{constructor($){super($),this.vao=$.extVertexArrayObject}getDefault(){return null}set($){this.vao&&($!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES($),this.current=$,this.dirty=!1)}}class co extends wt{getDefault(){return 4}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.pixelStorei(q.UNPACK_ALIGNMENT,$),this.current=$,this.dirty=!1}}class ls extends wt{getDefault(){return!1}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$),this.current=$,this.dirty=!1}}class Ca extends wt{getDefault(){return!1}set($){if($===this.current&&!this.dirty)return;const q=this.gl;q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,$),this.current=$,this.dirty=!1}}class Mi extends wt{constructor($,q){super($),this.context=$,this.parent=q}getDefault(){return null}}class Os extends Mi{setDirty(){this.dirty=!0}set($){if($===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const q=this.gl;q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,$,0),this.current=$,this.dirty=!1}}class at extends Mi{attachment(){return this.gl.DEPTH_ATTACHMENT}set($){if($===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const q=this.gl;q.framebufferRenderbuffer(q.FRAMEBUFFER,this.attachment(),q.RENDERBUFFER,$),this.current=$,this.dirty=!1}}class qe extends at{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class He{constructor($,q,re,ye){this.context=$,this.width=q,this.height=re;const be=this.framebuffer=$.gl.createFramebuffer();this.colorAttachment=new Os($,be),ye&&(this.depthAttachment=new at($,be))}destroy(){const $=this.context.gl,q=this.colorAttachment.get();if(q&&$.deleteTexture(q),this.depthAttachment){const re=this.depthAttachment.get();re&&$.deleteRenderbuffer(re)}$.deleteFramebuffer(this.framebuffer)}}class ot{constructor($){this.gl=$,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qt(this),this.clearDepth=new cn(this),this.clearStencil=new an(this),this.colorMask=new yn(this),this.depthMask=new kn(this),this.stencilMask=new en(this),this.stencilFunc=new Tn(this),this.stencilOp=new fn(this),this.stencilTest=new Nn(this),this.depthRange=new Bn(this),this.depthTest=new Gn(this),this.depthFunc=new Jn(this),this.blend=new gr(this),this.blendFunc=new xr(this),this.blendColor=new br(this),this.blendEquation=new Ir(this),this.cullFace=new gi(this),this.cullFaceSide=new si(this),this.frontFace=new Ni(this),this.program=new ro(this),this.activeTexture=new wo(this),this.viewport=new li(this),this.bindFramebuffer=new yi(this),this.bindRenderbuffer=new To(this),this.bindTexture=new Aa(this),this.bindVertexBuffer=new Sa(this),this.bindElementBuffer=new Sl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Eo(this),this.pixelStoreUnpack=new co(this),this.pixelStoreUnpackPremultiplyAlpha=new ls(this),this.pixelStoreUnpackFlipY=new Ca(this),this.extTextureFilterAnisotropic=$.getExtension("EXT_texture_filter_anisotropic")||$.getExtension("MOZ_EXT_texture_filter_anisotropic")||$.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=$.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=$.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&($.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=$.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=$.getExtension("OES_standard_derivatives"),this.extTimerQuery=$.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=$.getParameter($.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer($,q){return new pr(this,$,q)}createVertexBuffer($,q,re){return new ft(this,$,q,re)}createRenderbuffer($,q,re){const ye=this.gl,be=ye.createRenderbuffer();return this.bindRenderbuffer.set(be),ye.renderbufferStorage(ye.RENDERBUFFER,$,q,re),this.bindRenderbuffer.set(null),be}createFramebuffer($,q,re){return new He(this,$,q,re)}clear({color:$,depth:q,stencil:re}){const ye=this.gl;let be=0;$&&(be|=ye.COLOR_BUFFER_BIT,this.clearColor.set($),this.colorMask.set([!0,!0,!0,!0])),q!==void 0&&(be|=ye.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(q),this.depthMask.set(!0)),re!==void 0&&(be|=ye.STENCIL_BUFFER_BIT,this.clearStencil.set(re),this.stencilMask.set(255)),ye.clear(be)}setCullFace($){$.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set($.mode),this.frontFace.set($.frontFace))}setDepthMode($){$.func!==this.gl.ALWAYS||$.mask?(this.depthTest.set(!0),this.depthFunc.set($.func),this.depthMask.set($.mask),this.depthRange.set($.range)):this.depthTest.set(!1)}setStencilMode($){$.test.func!==this.gl.ALWAYS||$.mask?(this.stencilTest.set(!0),this.stencilMask.set($.mask),this.stencilOp.set([$.fail,$.depthFail,$.pass]),this.stencilFunc.set({func:$.test.func,ref:$.ref,mask:$.test.mask})):this.stencilTest.set(!1)}setColorMode($){Ce($.blendFunction,j.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set($.blendFunction),this.blendColor.set($.blendColor)),this.colorMask.set($.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ut extends j.Evented{constructor($,q,re,ye){super(),this.id=$,this.dispatcher=re,this.setEventedParent(ye),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=j.extend({type:"raster"},q),j.extend(this,j.pick(q,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new j.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dr(this._options,this.map._requestManager,null,null,($,q)=>{this._tileJSONRequest=null,this._loaded=!0,$?this.fire(new j.ErrorEvent($)):q&&(j.extend(this,q),q.bounds&&(this.tileBounds=new _r(q.bounds,this.minzoom,this.maxzoom)),j.postTurnstileEvent(q.tiles),this.fire(new j.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new j.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd($){this.map=$,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return j.extend({},this._options)}hasTile($){return!this.tileBounds||this.tileBounds.contains($.canonical)}loadTile($,q){const re=j.exported.devicePixelRatio>=2,ye=this.map._requestManager.normalizeTileURL($.tileID.canonical.url(this.tiles,this.scheme),re,this.tileSize);$.request=j.getImage(this.map._requestManager.transformRequest(ye,j.ResourceType.Tile),(be,Se,Ie,Re)=>(delete $.request,$.aborted?($.state="unloaded",q(null)):be?($.state="errored",q(be)):Se?(this.map._refreshExpiredTiles&&$.setExpiryData({cacheControl:Ie,expires:Re}),$.setTexture(Se,this.map.painter),$.state="loaded",j.cacheEntryPossiblyAdded(this.dispatcher),void q(null)):q(null)))}static loadTileData($,q,re){$.setTexture(q,re)}static unloadTileData($,q){$.texture&&q.saveTileTexture($.texture)}abortTile($,q){$.request&&($.request.cancel(),delete $.request),q()}unloadTile($,q){$.texture&&this.map.painter.saveTileTexture($.texture),q()}hasTransition(){return!1}}let Tt;function zt(te,$,q,re,ye,be,Se,Ie){const Re=[te,q,ye,$,re,be,1,1,1],Fe=[Se,Ie,1],Ue=j.adjoint([],Re),[Ze,Ye,rt]=j.transformMat3(Fe,Fe,j.transpose(Ue,Ue));return j.multiply$1(Re,[Ze,0,0,0,Ye,0,0,0,rt],Re)}class kt extends j.Evented{constructor($,q,re,ye){super(),this.id=$,this.dispatcher=re,this.coordinates=q.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ye),this.options=q}load($,q){this._loaded=q||!1,this.fire(new j.Event("dataloading",{dataType:"source"})),this.url=this.options.url,j.getImage(this.map._requestManager.transformRequest(this.url,j.ResourceType.Image),(re,ye)=>{if(this._loaded=!0,re)this.fire(new j.ErrorEvent(re));else if(ye){const{HTMLImageElement:be}=j.window;this.image=ye instanceof be?j.exported.getImageData(ye):ye,this.width=this.image.width,this.height=this.image.height,$&&(this.coordinates=$),this._finishLoading()}})}loaded(){return this._loaded}updateImage($){return this.image&&$.url?(this.options.url=$.url,this.load($.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new j.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd($){this.map=$,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates($){this.coordinates=$,this._boundsArray=void 0;const q=$.map(j.MercatorCoordinate.fromLngLat);return this.tileID=function(re){let ye=1/0,be=1/0,Se=-1/0,Ie=-1/0;for(const Ze of re)ye=Math.min(ye,Ze.x),be=Math.min(be,Ze.y),Se=Math.max(Se,Ze.x),Ie=Math.max(Ie,Ze.y);const Re=Math.max(Se-ye,Ie-be),Fe=Math.max(0,Math.floor(-Math.log(Re)/Math.LN2)),Ue=Math.pow(2,Fe);return new j.CanonicalTileID(Fe,Math.floor((ye+Se)/2*Ue),Math.floor((be+Ie)/2*Ue))}(q),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new j.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData($){for(const Re in this.tiles){const Fe=this.tiles[Re];Fe.state!=="loaded"&&(Fe.state="loaded",Fe.texture=this.texture)}if(this._boundsArray)return;const q=j.tileTransform(this.tileID,this.map.transform.projection),[re,ye,be,Se]=this.coordinates.map(Re=>{const Fe=q.projection.project(Re[0],Re[1]);return j.getTilePoint(q,Fe)._round()});this.perspectiveTransform=function(Re,Fe,Ue,Ze,Ye,rt,et,tt,nt,Qe){const lt=zt(0,0,Re,0,0,Fe,Re,Fe),it=zt(Ue,Ze,Ye,rt,et,tt,nt,Qe);return j.multiply$1(it,j.adjoint(lt,lt),it),[it[6]/it[8]*Re/j.EXTENT,it[7]/it[8]*Fe/j.EXTENT]}(this.width,this.height,re.x,re.y,ye.x,ye.y,Se.x,Se.y,be.x,be.y);const Ie=this._boundsArray=new j.StructArrayLayout4i8;Ie.emplaceBack(re.x,re.y,0,0),Ie.emplaceBack(ye.x,ye.y,j.EXTENT,0),Ie.emplaceBack(Se.x,Se.y,0,j.EXTENT),Ie.emplaceBack(be.x,be.y,j.EXTENT,j.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=$.createVertexBuffer(Ie,j.boundsAttributes.members),this.boundsSegments=j.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const $=this.map.painter.context,q=$.gl;this.texture?this.texture.update(this.image):(this.texture=new j.Texture($,this.image,q.RGBA),this.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE)),this._prepareData($)}loadTile($,q){this.tileID&&this.tileID.equals($.tileID.canonical)?(this.tiles[String($.tileID.wrap)]=$,$.buckets={},q(null)):($.state="errored",q(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Et={vector:class extends j.Evented{constructor(te,$,q,re){if(super(),this.id=te,this.dispatcher=q,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,j.extend(this,j.pick($,["url","scheme","tileSize","promoteId"])),this._options=j.extend({type:"vector"},$),this._collectResourceTiming=$.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(re),this._tileWorkers={},this._deduped=new j.DedupedRequest}load(te){this._loaded=!1,this.fire(new j.Event("dataloading",{dataType:"source"}));const $=this.language||this.map._language,q=this.worldview||this.map._worldview;this._tileJSONRequest=dr(this._options,this.map._requestManager,$,q,(re,ye)=>{this._tileJSONRequest=null,this._loaded=!0,re?($&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${$}`),q&&q.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${q}`),this.fire(new j.ErrorEvent(re))):ye&&(j.extend(this,ye),ye.bounds&&(this.tileBounds=new _r(ye.bounds,this.minzoom,this.maxzoom)),j.postTurnstileEvent(ye.tiles,this.map._requestManager._customAccessToken),this.fire(new j.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new j.Event("data",{dataType:"source",sourceDataType:"content"}))),te&&te(re)})}loaded(){return this._loaded}hasTile(te){return!this.tileBounds||this.tileBounds.contains(te.canonical)}onAdd(te){this.map=te,this.load()}setSourceProperty(te){this._tileJSONRequest&&this._tileJSONRequest.cancel(),te(),this.load(()=>{const $=this.map.style._getSourceCaches(this.id);for(const q of $)q.clearTiles()})}setTiles(te){return this.setSourceProperty(()=>{this._options.tiles=te}),this}setUrl(te){return this.setSourceProperty(()=>{this.url=te,this._options.url=te}),this}_setLanguage(te){return te===this.language||this.setSourceProperty(()=>{this.language=te}),this}_setWorldview(te){return te===this.worldview?this:this.worldviewOptions&&te&&!this.worldviewOptions[te]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${te}".`),this):(this.setSourceProperty(()=>{this.worldview=te}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return j.extend({},this._options)}loadTile(te,$){const q=this.map._requestManager.normalizeTileURL(te.tileID.canonical.url(this.tiles,this.scheme)),re={request:this.map._requestManager.transformRequest(q,j.ResourceType.Tile),data:void 0,uid:te.uid,tileID:te.tileID,tileZoom:te.tileZoom,zoom:te.tileID.overscaledZ,tileSize:this.tileSize*te.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:j.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:te.isSymbolTile};if(re.request.collectResourceTiming=this._collectResourceTiming,te.actor&&te.state!=="expired")te.state==="loading"?te.reloadCallback=$:te.request=te.actor.send("reloadTile",re,ye.bind(this));else if(te.actor=this._tileWorkers[q]=this._tileWorkers[q]||this.dispatcher.getActor(),this.dispatcher.ready)te.request=te.actor.send("loadTile",re,ye.bind(this),void 0,!0);else{const be=j.loadVectorTile.call({deduped:this._deduped},re,(Se,Ie)=>{Se||!Ie?ye.call(this,Se):(re.data={cacheControl:Ie.cacheControl,expires:Ie.expires,rawData:Ie.rawData.slice(0)},te.actor&&te.actor.send("loadTile",re,ye.bind(this),void 0,!0))},!0);te.request={cancel:be}}function ye(be,Se){return delete te.request,te.aborted?$(null):be&&be.status!==404?$(be):(Se&&Se.resourceTiming&&(te.resourceTiming=Se.resourceTiming),this.map._refreshExpiredTiles&&Se&&te.setExpiryData(Se),te.loadVectorData(Se,this.map.painter),j.cacheEntryPossiblyAdded(this.dispatcher),$(null),void(te.reloadCallback&&(this.loadTile(te,te.reloadCallback),te.reloadCallback=null)))}}abortTile(te){te.request&&(te.request.cancel(),delete te.request),te.actor&&te.actor.send("abortTile",{uid:te.uid,type:this.type,source:this.id})}unloadTile(te){te.unloadVectorData(),te.actor&&te.actor.send("removeTile",{uid:te.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ut,"raster-dem":class extends ut{constructor(te,$,q,re){super(te,$,q,re),this.type="raster-dem",this.maxzoom=22,this._options=j.extend({type:"raster-dem"},$),this.encoding=$.encoding||"mapbox"}loadTile(te,$){const q=this.map._requestManager.normalizeTileURL(te.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function re(ye,be){ye&&(te.state="errored",$(ye)),be&&(te.dem=be,te.dem.onDeserialize(),te.needsHillshadePrepare=!0,te.needsDEMTextureUpload=!0,te.state="loaded",$(null))}te.request=j.getImage(this.map._requestManager.transformRequest(q,j.ResourceType.Tile),function(ye,be,Se,Ie){if(delete te.request,te.aborted)te.state="unloaded",$(null);else if(ye)te.state="errored",$(ye);else if(be){this.map._refreshExpiredTiles&&te.setExpiryData({cacheControl:Se,expires:Ie});const Re=j.window.ImageBitmap&&be instanceof j.window.ImageBitmap&&(Tt==null&&(Tt=j.window.OffscreenCanvas&&new j.window.OffscreenCanvas(1,1).getContext("2d")&&typeof j.window.createImageBitmap=="function"),Tt),Fe=1-(be.width-j.prevPowerOfTwo(be.width))/2;Fe<1||te.neighboringTiles||(te.neighboringTiles=this._getNeighboringTiles(te.tileID));const Ue=Re?be:j.exported.getImageData(be,Fe),Ze={uid:te.uid,coord:te.tileID,source:this.id,rawImageData:Ue,encoding:this.encoding,padding:Fe};te.actor&&te.state!=="expired"||(te.actor=this.dispatcher.getActor(),te.actor.send("loadDEMTile",Ze,re.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(te){const $=te.canonical,q=Math.pow(2,$.z),re=($.x-1+q)%q,ye=$.x===0?te.wrap-1:te.wrap,be=($.x+1+q)%q,Se=$.x+1===q?te.wrap+1:te.wrap,Ie={};return Ie[new j.OverscaledTileID(te.overscaledZ,ye,$.z,re,$.y).key]={backfilled:!1},Ie[new j.OverscaledTileID(te.overscaledZ,Se,$.z,be,$.y).key]={backfilled:!1},$.y>0&&(Ie[new j.OverscaledTileID(te.overscaledZ,ye,$.z,re,$.y-1).key]={backfilled:!1},Ie[new j.OverscaledTileID(te.overscaledZ,te.wrap,$.z,$.x,$.y-1).key]={backfilled:!1},Ie[new j.OverscaledTileID(te.overscaledZ,Se,$.z,be,$.y-1).key]={backfilled:!1}),$.y+1<q&&(Ie[new j.OverscaledTileID(te.overscaledZ,ye,$.z,re,$.y+1).key]={backfilled:!1},Ie[new j.OverscaledTileID(te.overscaledZ,te.wrap,$.z,$.x,$.y+1).key]={backfilled:!1},Ie[new j.OverscaledTileID(te.overscaledZ,Se,$.z,be,$.y+1).key]={backfilled:!1}),Ie}unloadTile(te){te.demTexture&&this.map.painter.saveTileTexture(te.demTexture),te.fbo&&(te.fbo.destroy(),delete te.fbo),te.dem&&delete te.dem,delete te.neighboringTiles,te.state="unloaded"}},geojson:class extends j.Evented{constructor(te,$,q,re){super(),this.id=te,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=q.getActor(),this.setEventedParent(re),this._data=$.data,this._options=j.extend({},$),this._collectResourceTiming=$.collectResourceTiming,$.maxzoom!==void 0&&(this.maxzoom=$.maxzoom),$.type&&(this.type=$.type),$.attribution&&(this.attribution=$.attribution),this.promoteId=$.promoteId;const ye=j.EXTENT/this.tileSize;this.workerOptions=j.extend({source:this.id,cluster:$.cluster||!1,geojsonVtOptions:{buffer:($.buffer!==void 0?$.buffer:128)*ye,tolerance:($.tolerance!==void 0?$.tolerance:.375)*ye,extent:j.EXTENT,maxZoom:this.maxzoom,lineMetrics:$.lineMetrics||!1,generateId:$.generateId||!1},superclusterOptions:{maxZoom:$.clusterMaxZoom!==void 0?$.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,$.clusterMinPoints||2),extent:j.EXTENT,radius:($.clusterRadius!==void 0?$.clusterRadius:50)*ye,log:!1,generateId:$.generateId||!1},clusterProperties:$.clusterProperties,filter:$.filter},$.workerOptions)}onAdd(te){this.map=te,this.setData(this._data)}setData(te){return this._data=te,this._updateWorkerData(),this}getClusterExpansionZoom(te,$){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:te,source:this.id},$),this}getClusterChildren(te,$){return this.actor.send("geojson.getClusterChildren",{clusterId:te,source:this.id},$),this}getClusterLeaves(te,$,q,re){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:te,limit:$,offset:q},re),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new j.Event("dataloading",{dataType:"source"})),this._loaded=!1;const te=j.extend({},this.workerOptions),$=this._data;typeof $=="string"?(te.request=this.map._requestManager.transformRequest(j.exported.resolveURL($),j.ResourceType.Source),te.request.collectResourceTiming=this._collectResourceTiming):te.data=JSON.stringify($),this._pendingLoad=this.actor.send(`${this.type}.loadData`,te,(q,re)=>{if(this._loaded=!0,this._pendingLoad=null,q)this.fire(new j.ErrorEvent(q));else{const ye={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&re&&re.resourceTiming&&re.resourceTiming[this.id]&&(ye.resourceTiming=re.resourceTiming[this.id]),this.fire(new j.Event("data",ye)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(te,$){const q=te.actor?"reloadTile":"loadTile";te.actor=this.actor,te.request=this.actor.send(q,{type:this.type,uid:te.uid,tileID:te.tileID,tileZoom:te.tileZoom,zoom:te.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:j.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(re,ye)=>(delete te.request,te.unloadVectorData(),te.aborted?$(null):re?$(re):(te.loadVectorData(ye,this.map.painter,q==="reloadTile"),$(null))),void 0,q==="loadTile")}abortTile(te){te.request&&(te.request.cancel(),delete te.request),te.aborted=!0}unloadTile(te){te.unloadVectorData(),this.actor.send("removeTile",{uid:te.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return j.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends kt{constructor(te,$,q,re){super(te,$,q,re),this.roundZoom=!0,this.type="video",this.options=$}load(){this._loaded=!1;const te=this.options;this.urls=[];for(const $ of te.urls)this.urls.push(this.map._requestManager.transformRequest($,j.ResourceType.Source).url);j.getVideo(this.urls,($,q)=>{this._loaded=!0,$?this.fire(new j.ErrorEvent($)):q&&(this.video=q,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(te){if(this.video){const $=this.video.seekable;te<$.start(0)||te>$.end(0)?this.fire(new j.ErrorEvent(new j.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${$.start(0)} and ${$.end(0)}-second mark.`))):this.video.currentTime=te}}getVideo(){return this.video}onAdd(te){this.map||(this.map=te,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const te=this.map.painter.context,$=te.gl;this.texture?this.video.paused||(this.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),$.texSubImage2D($.TEXTURE_2D,0,0,0,$.RGBA,$.UNSIGNED_BYTE,this.video)):(this.texture=new j.Texture(te,this.video,$.RGBA),this.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(te)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:kt,canvas:class extends kt{constructor(te,$,q,re){super(te,$,q,re),$.coordinates?Array.isArray($.coordinates)&&$.coordinates.length===4&&!$.coordinates.some(ye=>!Array.isArray(ye)||ye.length!==2||ye.some(be=>typeof be!="number"))||this.fire(new j.ErrorEvent(new j.ValidationError(`sources.${te}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new j.ErrorEvent(new j.ValidationError(`sources.${te}`,null,'missing required property "coordinates"'))),$.animate&&typeof $.animate!="boolean"&&this.fire(new j.ErrorEvent(new j.ValidationError(`sources.${te}`,null,'optional "animate" property must be a boolean value'))),$.canvas?typeof $.canvas=="string"||$.canvas instanceof j.window.HTMLCanvasElement||this.fire(new j.ErrorEvent(new j.ValidationError(`sources.${te}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new j.ErrorEvent(new j.ValidationError(`sources.${te}`,null,'missing required property "canvas"'))),this.options=$,this.animate=$.animate===void 0||$.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof j.window.HTMLCanvasElement?this.options.canvas:j.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new j.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(te){this.map=te,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let te=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,te=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,te=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const $=this.map.painter.context;this.texture?(te||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new j.Texture($,this.canvas,$.gl.RGBA,{premultiply:!0}),this._prepareData($)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const te of[this.canvas.width,this.canvas.height])if(isNaN(te)||te<=0)return!0;return!1}},custom:class extends j.Evented{constructor(te,$,q,re){super(),this.id=te,this.type="custom",this._dataType="raster",this._dispatcher=q,this._implementation=$,this.setEventedParent(re),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new j.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new j.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _r(this._implementation.bounds,this.minzoom,this.maxzoom)),$.update=this._update.bind(this),$.coveringTiles=this._coveringTiles.bind(this),j.extend(this,j.pick($,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return j.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new j.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new j.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(te){this._map=te,this._loaded=!1,this.fire(new j.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(te),this.load()}onRemove(te){this._implementation.onRemove&&this._implementation.onRemove(te)}hasTile(te){if(this._implementation.hasTile){const{x:$,y:q,z:re}=te.canonical;return this._implementation.hasTile({x:$,y:q,z:re})}return!this.tileBounds||this.tileBounds.contains(te.canonical)}loadTile(te,$){const{x:q,y:re,z:ye}=te.tileID.canonical,be=new j.window.AbortController,Se=this._implementation.loadTile({x:q,y:re,z:ye},{signal:be.signal});if(!Se)return this.loadTileData(te,{width:this.tileSize,height:this.tileSize,data:null}),te.state="loaded",$(null);Se.cancel=()=>be.abort(),te.request=Se.then(function(Ie){return delete te.request,te.aborted?(te.state="unloaded",$(null)):Ie?function(Re){return Re instanceof j.window.ImageData||Re instanceof j.window.ImageBitmap||Re instanceof j.window.HTMLCanvasElement}(Ie)?(this.loadTileData(te,Ie),te.state="loaded",void $(null)):(te.state="errored",$(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(te,{width:this.tileSize,height:this.tileSize,data:null}),te.state="loaded",$(null))}.bind(this)).catch(Ie=>{Ie.code!==20&&(te.state="errored",$(Ie))})}loadTileData(te,$){ut.loadTileData(te,$,this._map.painter)}unloadTileData(te){ut.unloadTileData(te,this._map.painter)}prepareTile(te){if(!this._implementation.prepareTile)return null;const{x:$,y:q,z:re}=te.tileID.canonical,ye=this._implementation.prepareTile({x:$,y:q,z:re});return ye?(this.loadTileData(te,ye),te.state="loaded",ye):null}unloadTile(te,$){if(this.unloadTileData(te),this._implementation.unloadTile){const{x:q,y:re,z:ye}=te.tileID.canonical;this._implementation.unloadTile({x:q,y:re,z:ye})}$()}abortTile(te,$){te.request&&te.request.cancel&&(te.request.cancel(),delete te.request),$()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(te=>({x:te.canonical.x,y:te.canonical.y,z:te.canonical.z}))}_update(){this.fire(new j.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Lt=function(te,$,q,re){const ye=new Et[$.type](te,$,q,re);if(ye.id!==te)throw new Error(`Expected Source id to be ${te} instead of ${ye.id}`);return j.bindAll(["load","abort","unload","serialize","prepare"],ye),ye};function tn(te,$){const q=j.identity([]);return j.scale(q,q,[.5*te.width,.5*-te.height,1]),j.translate(q,q,[1,-1,0]),j.multiply(q,q,te.calculateProjMatrix($.toUnwrapped())),Float32Array.from(q)}function Sn(te,$,q,re,ye,be,Se,Ie=!1){const Re=te.tilesIn(re,Se,Ie);Re.sort(Vn);const Fe=[];for(const Ze of Re)Fe.push({wrappedTileID:Ze.tile.tileID.wrapped().key,queryResults:Ze.tile.queryRenderedFeatures($,q,te._state,Ze,ye,be,tn(te.transform,Ze.tile.tileID),Ie)});const Ue=function(Ze){const Ye={},rt={};for(const et of Ze){const tt=et.queryResults,nt=et.wrappedTileID,Qe=rt[nt]=rt[nt]||{};for(const lt in tt){const it=tt[lt],xt=Qe[lt]=Qe[lt]||{},gt=Ye[lt]=Ye[lt]||[];for(const dt of it)xt[dt.featureIndex]||(xt[dt.featureIndex]=!0,gt.push(dt))}}return Ye}(Fe);for(const Ze in Ue)Ue[Ze].forEach(Ye=>{const rt=Ye.feature,et=rt.layer;et&&et.type!=="background"&&et.type!=="sky"&&(rt.source=et.source,et["source-layer"]&&(rt.sourceLayer=et["source-layer"]),rt.state=rt.id!==void 0?te.getFeatureState(et["source-layer"],rt.id):{})});return Ue}function sn(te,$){const q=te.getRenderableIds().map(be=>te.getTileByID(be)),re=[],ye={};for(let be=0;be<q.length;be++){const Se=q[be],Ie=Se.tileID.canonical.key;ye[Ie]||(ye[Ie]=!0,Se.querySourceFeatures(re,$))}return re}function Vn(te,$){const q=te.tileID,re=$.tileID;return q.overscaledZ-re.overscaledZ||q.canonical.y-re.canonical.y||q.wrap-re.wrap||q.canonical.x-re.canonical.x}function qn(){return da.workerClass!=null?new da.workerClass:new j.window.Worker(da.workerUrl)}const On="mapboxgl_preloaded_worker_pool";class Zn{constructor(){this.active={}}acquire($){if(!this.workers)for(this.workers=[];this.workers.length<Zn.workerCount;)this.workers.push(new qn);return this.active[$]=!0,this.workers.slice()}release($){delete this.active[$],this.numActive()===0&&(this.workers.forEach(q=>{q.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[On]}numActive(){return Object.keys(this.active).length}}let lr;function kr(){return lr||(lr=new Zn),lr}function Br(te,$){const q={};for(const re in te)re!=="ref"&&(q[re]=te[re]);return j.refProperties.forEach(re=>{re in $&&(q[re]=$[re])}),q}function Rr(te){te=te.slice();const $=Object.create(null);for(let q=0;q<te.length;q++)$[te[q].id]=te[q];for(let q=0;q<te.length;q++)"ref"in te[q]&&(te[q]=Br(te[q],$[te[q].ref]));return te}Zn.workerCount=2;const jn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Zt(te,$,q){q.push({command:jn.addSource,args:[te,$[te]]})}function Bi(te,$,q){$.push({command:jn.removeSource,args:[te]}),q[te]=!0}function Qr(te,$,q,re){Bi(te,q,re),Zt(te,$,q)}function Ao(te,$,q){let re;for(re in te[q])if(te[q].hasOwnProperty(re)&&re!=="data"&&!Ce(te[q][re],$[q][re]))return!1;for(re in $[q])if($[q].hasOwnProperty(re)&&re!=="data"&&!Ce(te[q][re],$[q][re]))return!1;return!0}function Ia(te,$,q,re,ye,be){let Se;for(Se in $=$||{},te=te||{})te.hasOwnProperty(Se)&&(Ce(te[Se],$[Se])||q.push({command:be,args:[re,Se,$[Se],ye]}));for(Se in $)$.hasOwnProperty(Se)&&!te.hasOwnProperty(Se)&&(Ce(te[Se],$[Se])||q.push({command:be,args:[re,Se,$[Se],ye]}))}function Ki(te){return te.id}function Ma(te,$){return te[$.id]=$,te}class Ph{constructor($,q){this.reset($,q)}reset($,q){this.points=$||[],this._distances=[0];for(let re=1;re<this.points.length;re++)this._distances[re]=this._distances[re-1]+this.points[re].dist(this.points[re-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(q||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp($){if(this.points.length===1)return this.points[0];$=j.clamp($,0,1);let q=1,re=this._distances[q];const ye=$*this.paddedLength+this.padding;for(;re<ye&&q<this._distances.length;)re=this._distances[++q];const be=q-1,Se=this._distances[be],Ie=re-Se,Re=Ie>0?(ye-Se)/Ie:0;return this.points[be].mult(1-Re).add(this.points[q].mult(Re))}}class cs{constructor($,q,re){const ye=this.boxCells=[],be=this.circleCells=[];this.xCellCount=Math.ceil($/re),this.yCellCount=Math.ceil(q/re);for(let Se=0;Se<this.xCellCount*this.yCellCount;Se++)ye.push([]),be.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=$,this.height=q,this.xScale=this.xCellCount/$,this.yScale=this.yCellCount/q,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert($,q,re,ye,be){this._forEachCell(q,re,ye,be,this._insertBoxCell,this.boxUid++),this.boxKeys.push($),this.bboxes.push(q),this.bboxes.push(re),this.bboxes.push(ye),this.bboxes.push(be)}insertCircle($,q,re,ye){this._forEachCell(q-ye,re-ye,q+ye,re+ye,this._insertCircleCell,this.circleUid++),this.circleKeys.push($),this.circles.push(q),this.circles.push(re),this.circles.push(ye)}_insertBoxCell($,q,re,ye,be,Se){this.boxCells[be].push(Se)}_insertCircleCell($,q,re,ye,be,Se){this.circleCells[be].push(Se)}_query($,q,re,ye,be,Se){if(re<0||$>this.width||ye<0||q>this.height)return!be&&[];const Ie=[];if($<=0&&q<=0&&this.width<=re&&this.height<=ye){if(be)return!0;for(let Re=0;Re<this.boxKeys.length;Re++)Ie.push({key:this.boxKeys[Re],x1:this.bboxes[4*Re],y1:this.bboxes[4*Re+1],x2:this.bboxes[4*Re+2],y2:this.bboxes[4*Re+3]});for(let Re=0;Re<this.circleKeys.length;Re++){const Fe=this.circles[3*Re],Ue=this.circles[3*Re+1],Ze=this.circles[3*Re+2];Ie.push({key:this.circleKeys[Re],x1:Fe-Ze,y1:Ue-Ze,x2:Fe+Ze,y2:Ue+Ze})}return Se?Ie.filter(Se):Ie}return this._forEachCell($,q,re,ye,this._queryCell,Ie,{hitTest:be,seenUids:{box:{},circle:{}}},Se),be?Ie.length>0:Ie}_queryCircle($,q,re,ye,be){const Se=$-re,Ie=$+re,Re=q-re,Fe=q+re;if(Ie<0||Se>this.width||Fe<0||Re>this.height)return!ye&&[];const Ue=[];return this._forEachCell(Se,Re,Ie,Fe,this._queryCellCircle,Ue,{hitTest:ye,circle:{x:$,y:q,radius:re},seenUids:{box:{},circle:{}}},be),ye?Ue.length>0:Ue}query($,q,re,ye,be){return this._query($,q,re,ye,!1,be)}hitTest($,q,re,ye,be){return this._query($,q,re,ye,!0,be)}hitTestCircle($,q,re,ye){return this._queryCircle($,q,re,!0,ye)}_queryCell($,q,re,ye,be,Se,Ie,Re){const Fe=Ie.seenUids,Ue=this.boxCells[be];if(Ue!==null){const Ye=this.bboxes;for(const rt of Ue)if(!Fe.box[rt]){Fe.box[rt]=!0;const et=4*rt;if($<=Ye[et+2]&&q<=Ye[et+3]&&re>=Ye[et+0]&&ye>=Ye[et+1]&&(!Re||Re(this.boxKeys[rt]))){if(Ie.hitTest)return Se.push(!0),!0;Se.push({key:this.boxKeys[rt],x1:Ye[et],y1:Ye[et+1],x2:Ye[et+2],y2:Ye[et+3]})}}}const Ze=this.circleCells[be];if(Ze!==null){const Ye=this.circles;for(const rt of Ze)if(!Fe.circle[rt]){Fe.circle[rt]=!0;const et=3*rt;if(this._circleAndRectCollide(Ye[et],Ye[et+1],Ye[et+2],$,q,re,ye)&&(!Re||Re(this.circleKeys[rt]))){if(Ie.hitTest)return Se.push(!0),!0;{const tt=Ye[et],nt=Ye[et+1],Qe=Ye[et+2];Se.push({key:this.circleKeys[rt],x1:tt-Qe,y1:nt-Qe,x2:tt+Qe,y2:nt+Qe})}}}}}_queryCellCircle($,q,re,ye,be,Se,Ie,Re){const Fe=Ie.circle,Ue=Ie.seenUids,Ze=this.boxCells[be];if(Ze!==null){const rt=this.bboxes;for(const et of Ze)if(!Ue.box[et]){Ue.box[et]=!0;const tt=4*et;if(this._circleAndRectCollide(Fe.x,Fe.y,Fe.radius,rt[tt+0],rt[tt+1],rt[tt+2],rt[tt+3])&&(!Re||Re(this.boxKeys[et])))return Se.push(!0),!0}}const Ye=this.circleCells[be];if(Ye!==null){const rt=this.circles;for(const et of Ye)if(!Ue.circle[et]){Ue.circle[et]=!0;const tt=3*et;if(this._circlesCollide(rt[tt],rt[tt+1],rt[tt+2],Fe.x,Fe.y,Fe.radius)&&(!Re||Re(this.circleKeys[et])))return Se.push(!0),!0}}}_forEachCell($,q,re,ye,be,Se,Ie,Re){const Fe=this._convertToXCellCoord($),Ue=this._convertToYCellCoord(q),Ze=this._convertToXCellCoord(re),Ye=this._convertToYCellCoord(ye);for(let rt=Fe;rt<=Ze;rt++)for(let et=Ue;et<=Ye;et++)if(be.call(this,$,q,re,ye,this.xCellCount*et+rt,Se,Ie,Re))return}_convertToXCellCoord($){return Math.max(0,Math.min(this.xCellCount-1,Math.floor($*this.xScale)))}_convertToYCellCoord($){return Math.max(0,Math.min(this.yCellCount-1,Math.floor($*this.yScale)))}_circlesCollide($,q,re,ye,be,Se){const Ie=ye-$,Re=be-q,Fe=re+Se;return Fe*Fe>Ie*Ie+Re*Re}_circleAndRectCollide($,q,re,ye,be,Se,Ie){const Re=(Se-ye)/2,Fe=Math.abs($-(ye+Re));if(Fe>Re+re)return!1;const Ue=(Ie-be)/2,Ze=Math.abs(q-(be+Ue));if(Ze>Ue+re)return!1;if(Fe<=Re||Ze<=Ue)return!0;const Ye=Fe-Re,rt=Ze-Ue;return Ye*Ye+rt*rt<=re*re}}const Cn=Math.tan(85*Math.PI/180);function ur(te,$,q,re,ye,be,Se){const Ie=j.create();if(q)if(be.name==="globe"){const Re=j.calculateGlobeLabelMatrix(ye,$);j.multiply(Ie,Ie,Re)}else{const Re=Gt([],Se);Ie[0]=Re[0],Ie[1]=Re[1],Ie[4]=Re[2],Ie[5]=Re[3],re||j.rotateZ(Ie,Ie,ye.angle)}else j.multiply(Ie,ye.labelPlaneMatrix,te);return Ie}function hr(te,$,q,re,ye,be,Se){const Ie=ur(te,$,q,re,ye,be,Se);return be.name==="globe"&&q||(Ie[2]=Ie[6]=Ie[10]=Ie[14]=0),Ie}function Yi(te,$,q,re,ye,be,Se){if(q){if(be.name==="globe"){const Ie=ur(te,$,q,re,ye,be,Se);return j.invert(Ie,Ie),j.multiply(Ie,te,Ie),Ie}{const Ie=j.clone(te),Re=j.identity([]);return Re[0]=Se[0],Re[1]=Se[1],Re[4]=Se[2],Re[5]=Se[3],j.multiply(Ie,Ie,Re),re||j.rotateZ(Ie,Ie,-ye.angle),Ie}}return ye.glCoordMatrix}function Ji(te,$,q=0){const re=[te.x,te.y,q,1];q?j.transformMat4$1(re,re,$):Ai(re,re,$);const ye=re[3];return{point:[re[0]/ye,re[1]/ye,re[2]/ye],signedDistanceFromCamera:ye}}function ir(te,$){const q=[te[0],te[1],te[2],1];j.transformMat4$1(q,q,$);const re=q[3];return{point:[q[0]/re,q[1]/re,q[2]/re],signedDistanceFromCamera:re}}function Fs(te,$){return Math.min(.5+te/$*.5,1.5)}function Us(te,$){const q=te[0]/te[3],re=te[1]/te[3];return q>=-$[0]&&q<=$[0]&&re>=-$[1]&&re<=$[1]}function $s(te,$,q,re,ye,be,Se,Ie,Re,Fe){const Ue=q.transform,Ze=re?te.textSizeData:te.iconSizeData,Ye=j.evaluateSizeForZoom(Ze,q.transform.zoom),rt=Ue.projection.name==="globe",et=[256/q.width*2+1,256/q.height*2+1],tt=re?te.text.dynamicLayoutVertexArray:te.icon.dynamicLayoutVertexArray;tt.clear();let nt=null;rt&&(nt=re?te.text.globeExtVertexArray:te.icon.globeExtVertexArray);const Qe=te.lineVertexArray,lt=re?te.text.placedSymbolArray:te.icon.placedSymbolArray,it=q.transform.width/q.transform.height;let xt=!1;for(let gt=0;gt<lt.length;gt++){const dt=lt.get(gt);if(dt.writingMode!==j.WritingMode.vertical||xt||gt!==0&&lt.get(gt-1).writingMode===j.WritingMode.horizontal||(xt=!0),(dt.hidden||dt.writingMode===j.WritingMode.vertical)&&!xt){Co(dt.numGlyphs,tt);continue}xt=!1;const vt=new j.pointGeometry(dt.tileAnchorX,dt.tileAnchorY),_t=Re?Re(vt):[0,0,0],St=Ue.projection.projectTilePoint(vt.x,vt.y,Fe.canonical),Bt=[St.x+_t[0],St.y+_t[1],St.z+_t[2]],un=[...Bt,1];if(j.transformMat4$1(un,un,$),!Us(un,et)){Co(dt.numGlyphs,tt);continue}const Rt=Fs(q.transform.cameraToCenterDistance,un[3]),Xt=j.evaluateSizeForFeature(Ze,Ye,dt),Qt=Se?Xt/Rt:Xt*Rt,gn=Ji(new j.pointGeometry(Bt[0],Bt[1]),ye,Bt[2]);if(gn.signedDistanceFromCamera<=0){Co(dt.numGlyphs,tt);continue}let jt={};const dn=Se?null:Re,Jt=tu(dt,Qt,!1,Ie,$,ye,be,te.glyphOffsetArray,Qe,tt,nt,gn.point,vt,jt,it,dn,Ue.projection,Fe,Se);xt=Jt.useVertical,dn&&Jt.needsFlipping&&(jt={}),(Jt.notEnoughRoom||xt||Jt.needsFlipping&&tu(dt,Qt,!0,Ie,$,ye,be,te.glyphOffsetArray,Qe,tt,nt,gn.point,vt,jt,it,dn,Ue.projection,Fe,Se).notEnoughRoom)&&Co(dt.numGlyphs,tt)}re?(te.text.dynamicLayoutVertexBuffer.updateData(tt),nt&&te.text.globeExtVertexBuffer.updateData(nt)):(te.icon.dynamicLayoutVertexBuffer.updateData(tt),nt&&te.icon.globeExtVertexBuffer.updateData(nt))}function Oi(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt){const nt=Ie.glyphStartIndex+Ie.numGlyphs,Qe=Ie.lineStartIndex,lt=Ie.lineStartIndex+Ie.lineLength,it=$.getoffsetX(Ie.glyphStartIndex),xt=$.getoffsetX(nt-1),gt=So(te*it,q,re,ye,be,Se,Ie.segment,Qe,lt,Re,Fe,Ue,Ze,Ye,!0,rt,et,tt);if(!gt)return null;const dt=So(te*xt,q,re,ye,be,Se,Ie.segment,Qe,lt,Re,Fe,Ue,Ze,Ye,!0,rt,et,tt);return dt?{first:gt,last:dt}:null}function Kr(te,$,q,re){return te.writingMode===j.WritingMode.horizontal&&Math.abs(q.y-$.y)>Math.abs(q.x-$.x)*re?{useVertical:!0}:te.writingMode===j.WritingMode.vertical?$.y<q.y?{needsFlipping:!0}:null:te.flipState!==0&&function(ye,be,Se){const Ie=(be.x-ye.x)*Se;return Ie===0||Math.abs((be.y-ye.y)/Ie)>Cn}($,q,re)?te.flipState===1?{needsFlipping:!0}:null:$.x>q.x?{needsFlipping:!0}:null}function tu(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt,nt,Qe,lt){const it=$/24,xt=te.lineOffsetX*it,gt=te.lineOffsetY*it;let dt;if(te.numGlyphs>1){const vt=te.glyphStartIndex+te.numGlyphs,_t=te.lineStartIndex,St=te.lineStartIndex+te.lineLength,Bt=Oi(it,Ie,xt,gt,q,Ze,Ye,te,Re,be,rt,tt,!1,nt,Qe,lt);if(!Bt)return{notEnoughRoom:!0};const un=ir(Bt.first.point,Se).point,Rt=ir(Bt.last.point,Se).point,Xt=new j.pointGeometry(un[0],un[1]),Qt=new j.pointGeometry(Rt[0],Rt[1]);if(re&&!q){const gn=Kr(te,Xt,Qt,et);if(te.flipState=gn&&gn.needsFlipping?1:2,gn)return gn}dt=[Bt.first];for(let gn=te.glyphStartIndex+1;gn<vt-1;gn++)dt.push(So(it*Ie.getoffsetX(gn),xt,gt,q,Ze,Ye,te.segment,_t,St,Re,be,rt,tt,!1,!1,nt,Qe,lt));dt.push(Bt.last)}else{if(re&&!q){const _t=Ji(Ye,ye).point,St=te.lineStartIndex+te.segment+1,Bt=new j.pointGeometry(Re.getx(St),Re.gety(St)),un=Ji(Bt,ye),Rt=un.signedDistanceFromCamera>0?un.point:Pa(Ye,Bt,_t,1,ye,void 0,nt,Qe.canonical),Xt=Kr(te,new j.pointGeometry(_t[0],_t[1]),new j.pointGeometry(Rt[0],Rt[1]),et);if(te.flipState=Xt&&Xt.needsFlipping?1:2,Xt)return Xt}const vt=So(it*Ie.getoffsetX(te.glyphStartIndex),xt,gt,q,Ze,Ye,te.segment,te.lineStartIndex,te.lineStartIndex+te.lineLength,Re,be,rt,tt,!1,!1,nt,Qe,lt);if(!vt)return{notEnoughRoom:!0};dt=[vt]}if(Ue)for(const vt of dt)j.updateGlobeVertexNormal(Ue,Fe.length+0,vt.up[0],vt.up[1],vt.up[2]),j.updateGlobeVertexNormal(Ue,Fe.length+1,vt.up[0],vt.up[1],vt.up[2]),j.updateGlobeVertexNormal(Ue,Fe.length+2,vt.up[0],vt.up[1],vt.up[2]),j.updateGlobeVertexNormal(Ue,Fe.length+3,vt.up[0],vt.up[1],vt.up[2]),j.addDynamicAttributes(Fe,vt.point[0],vt.point[1],vt.point[2],vt.angle);else for(const vt of dt)j.addDynamicAttributes(Fe,vt.point[0],vt.point[1],vt.point[2],vt.angle);return{}}function us(te,$,q,re,ye){const be=re.projectTilePoint(te.x,te.y,$);if(!ye)return Ji(be,q,be.z);const Se=ye(te);return Ji(new j.pointGeometry(be.x+Se[0],be.y+Se[1]),q,be.z+Se[2])}function Pa(te,$,q,re,ye,be,Se,Ie){const Re=us(te.add(te.sub($)._unit()),Ie,ye,Se,be).point,Fe=j.sub([],q,Re);return j.scaleAndAdd([],q,Fe,re/j.length(Fe))}function So(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt,nt,Qe){const lt=re?te-$:te+$;let it=lt>0?1:-1,xt=0;re&&(it*=-1,xt=Math.PI),it<0&&(xt+=Math.PI);let gt=it>0?Ie+Se:Ie+Se+1,dt=ye,vt=ye,_t=0,St=0;const Bt=Math.abs(lt),un=[],Rt=[];let Xt=be;const Qt=()=>{const Dn=gt-it;return _t===0?be:new j.pointGeometry(Fe.getx(Dn),Fe.gety(Dn))},gn=()=>Pa(Qt(),Xt,vt,Bt-_t+1,Ue,Ye,tt,nt.canonical);for(;_t+St<=Bt;){if(gt+=it,gt<Ie||gt>=Re)return null;if(vt=dt,un.push(dt),rt&&Rt.push(Xt||Qt()),dt=Ze[gt],dt===void 0){Xt=new j.pointGeometry(Fe.getx(gt),Fe.gety(gt));const Dn=us(Xt,nt.canonical,Ue,tt,Ye);dt=Dn.signedDistanceFromCamera>0?Ze[gt]=Dn.point:gn()}else Xt=null;_t+=St,St=j.distance(vt,dt)}Xt=Xt||new j.pointGeometry(Fe.getx(gt),Fe.gety(gt));const jt=Qt();et&&Ye&&(Ze[gt]=dt=Ze[gt]===void 0?dt:gn(),St=j.distance(vt,dt));const dn=(Bt-_t)/St,Jt=Xt.sub(jt).mult(dn)._add(jt),wn=j.sub([],dt,vt),xn=j.scaleAndAdd([],vt,wn,dn);let zn=[0,0,1],$n=wn[0],Wn=wn[1];if(Qe&&(zn=tt.upVector(nt.canonical,Jt.x,Jt.y),zn[0]!==0||zn[1]!==0||zn[2]!==1)){const Dn=[1,0,0],Qn=[0,1,0];Dn[0]=zn[2],Dn[1]=0,Dn[2]=-zn[0],j.cross(Qn,zn,Dn),j.normalize(Dn,Dn),j.normalize(Qn,Qn),$n=j.dot(wn,Dn),Wn=j.dot(wn,Qn)}if(q){const Dn=j.cross([],zn,wn);j.normalize(Dn,Dn),j.scaleAndAdd(xn,xn,Dn,q*it)}const fr=xt+Math.atan2(Wn,$n);return un.push(xn),rt&&Rt.push(Jt),{point:xn,angle:fr,path:un,tilePath:Rt,up:zn}}const Cl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Co(te,$){for(let q=0;q<te;q++){const re=$.length;$.resize(re+4),$.float32.set(Cl,4*re)}}function Ai(te,$,q){const re=$[0],ye=$[1];return te[0]=q[0]*re+q[4]*ye+q[12],te[1]=q[1]*re+q[5]*ye+q[13],te[3]=q[3]*re+q[7]*ye+q[15],te}const zr=100;class Il{constructor($,q,re=new cs($.width+200,$.height+200,25),ye=new cs($.width+200,$.height+200,25)){this.transform=$,this.grid=re,this.ignoredGrid=ye,this.pitchfactor=Math.cos($._pitch)*$.cameraToCenterDistance,this.screenRightBoundary=$.width+zr,this.screenBottomBoundary=$.height+zr,this.gridRightBoundary=$.width+200,this.gridBottomBoundary=$.height+200,this.fogState=q}placeCollisionBox($,q,re,ye,be,Se,Ie,Re){let Fe=re.projectedAnchorX,Ue=re.projectedAnchorY,Ze=re.projectedAnchorZ;const Ye=re.elevation,rt=re.tileID;if(Ye&&rt){const gt=$.getProjection().upVector(rt.canonical,re.tileAnchorX,re.tileAnchorY),dt=$.getProjection().upVectorScale(rt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Fe+=gt[0]*Ye*dt,Ue+=gt[1]*Ye*dt,Ze+=gt[2]*Ye*dt}const et=this.projectAndGetPerspectiveRatio(Ie,[Fe,Ue,Ze],re.tileID,$.projection.name==="globe"||!!Ye||this.transform.pitch>0,$.getProjection()),tt=Se*et.perspectiveRatio,nt=(re.x1*q+ye.x-re.padding)*tt+et.point.x,Qe=(re.y1*q+ye.y-re.padding)*tt+et.point.y,lt=(re.x2*q+ye.x+re.padding)*tt+et.point.x,it=(re.y2*q+ye.y+re.padding)*tt+et.point.y,xt=et.perspectiveRatio<=.55||et.occluded;return!this.isInsideGrid(nt,Qe,lt,it)||!be&&this.grid.hitTest(nt,Qe,lt,it,Re)||xt?{box:[],offscreen:!1,occluded:et.occluded}:{box:[nt,Qe,lt,it],offscreen:this.isOffscreen(nt,Qe,lt,it),occluded:!1}}placeCollisionCircles($,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt){const nt=[],Qe=this.transform.elevation,lt=Qe?Qe.getAtTileOffsetFunc(tt,this.transform.center.lat,this.transform.worldSize,$.getProjection()):jt=>[0,0,0],it=new j.pointGeometry(re.tileAnchorX,re.tileAnchorY),xt=$.getProjection().projectTilePoint(re.tileAnchorX,re.tileAnchorY,tt.canonical),gt=lt(it),dt=[xt.x+gt[0],xt.y+gt[1],xt.z+gt[2]],vt=$.projection.name==="globe",_t=this.projectAndGetPerspectiveRatio(Ie,[dt[0],dt[1],dt[2]],tt,vt||!!Qe||this.transform.pitch>0,$.getProjection()),{perspectiveRatio:St}=_t,Bt=(Ze?Se/St:Se*St)/j.ONE_EM,un=Ji(new j.pointGeometry(dt[0],dt[1]),Re,dt[2]).point,Rt=_t.signedDistanceFromCamera>0?Oi(Bt,be,re.lineOffsetX*Bt,re.lineOffsetY*Bt,!1,un,it,re,ye,Re,{},Qe&&!Ze?lt:null,Ze&&!!Qe,$.getProjection(),tt,Ze):null;let Xt=!1,Qt=!1,gn=!0;if(Rt&&!_t.occluded){const jt=.5*rt*St+et,dn=new j.pointGeometry(-100,-100),Jt=new j.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),wn=new Ph,xn=Rt.first,zn=Rt.last;let $n=[];for(let Dn=xn.path.length-1;Dn>=1;Dn--)$n.push(xn.path[Dn]);for(let Dn=1;Dn<zn.path.length;Dn++)$n.push(zn.path[Dn]);const Wn=2.5*jt;if(Fe){const Dn=$n.map(Qe&&!vt?(Qn,Tr)=>{const Gr=lt(Tr<xn.path.length-1?xn.tilePath[xn.path.length-1-Tr]:zn.tilePath[Tr-xn.path.length+2]);return Qn[2]=Gr[2],ir(Qn,Fe)}:Qn=>ir(Qn,Fe));$n=Dn.some(Qn=>Qn.signedDistanceFromCamera<=0)?[]:Dn.map(Qn=>Qn.point)}let fr=[];if($n.length>0){const Dn=$n.map(Dr=>new j.pointGeometry(Dr[0],Dr[1]));let Qn=1/0,Tr=-1/0,Gr=1/0,ei=-1/0;for(let Dr=0;Dr<Dn.length;Dr++)Qn=Math.min(Qn,Dn[Dr].x),Gr=Math.min(Gr,Dn[Dr].y),Tr=Math.max(Tr,Dn[Dr].x),ei=Math.max(ei,Dn[Dr].y);fr=Qn>=dn.x&&Tr<=Jt.x&&Gr>=dn.y&&ei<=Jt.y?[Dn]:Tr<dn.x||Qn>Jt.x||ei<dn.y||Gr>Jt.y?[]:j.clipLine([Dn],dn.x,dn.y,Jt.x,Jt.y)}for(const Dn of fr){wn.reset(Dn,.25*jt);let Qn=0;Qn=wn.length<=.5*jt?1:Math.ceil(wn.paddedLength/Wn)+1;for(let Tr=0;Tr<Qn;Tr++){const Gr=Tr/Math.max(Qn-1,1),ei=wn.lerp(Gr),Dr=ei.x+zr,pi=ei.y+zr;nt.push(Dr,pi,jt,0);const to=Dr-jt,fo=pi-jt,qr=Dr+jt,Hr=pi+jt;if(gn=gn&&this.isOffscreen(to,fo,qr,Hr),Qt=Qt||this.isInsideGrid(to,fo,qr,Hr),!q&&this.grid.hitTestCircle(Dr,pi,jt,Ye)&&(Xt=!0,!Ue))return{circles:[],offscreen:!1,collisionDetected:Xt,occluded:!1}}}}return{circles:!Ue&&Xt||!Qt?[]:nt,offscreen:gn,collisionDetected:Xt,occluded:_t.occluded}}queryRenderedSymbols($){if($.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const q=[];let re=1/0,ye=1/0,be=-1/0,Se=-1/0;for(const Ue of $){const Ze=new j.pointGeometry(Ue.x+zr,Ue.y+zr);re=Math.min(re,Ze.x),ye=Math.min(ye,Ze.y),be=Math.max(be,Ze.x),Se=Math.max(Se,Ze.y),q.push(Ze)}const Ie=this.grid.query(re,ye,be,Se).concat(this.ignoredGrid.query(re,ye,be,Se)),Re={},Fe={};for(const Ue of Ie){const Ze=Ue.key;if(Re[Ze.bucketInstanceId]===void 0&&(Re[Ze.bucketInstanceId]={}),Re[Ze.bucketInstanceId][Ze.featureIndex])continue;const Ye=[new j.pointGeometry(Ue.x1,Ue.y1),new j.pointGeometry(Ue.x2,Ue.y1),new j.pointGeometry(Ue.x2,Ue.y2),new j.pointGeometry(Ue.x1,Ue.y2)];j.polygonIntersectsPolygon(q,Ye)&&(Re[Ze.bucketInstanceId][Ze.featureIndex]=!0,Fe[Ze.bucketInstanceId]===void 0&&(Fe[Ze.bucketInstanceId]=[]),Fe[Ze.bucketInstanceId].push(Ze.featureIndex))}return Fe}insertCollisionBox($,q,re,ye,be){(q?this.ignoredGrid:this.grid).insert({bucketInstanceId:re,featureIndex:ye,collisionGroupID:be},$[0],$[1],$[2],$[3])}insertCollisionCircles($,q,re,ye,be){const Se=q?this.ignoredGrid:this.grid,Ie={bucketInstanceId:re,featureIndex:ye,collisionGroupID:be};for(let Re=0;Re<$.length;Re+=4)Se.insertCircle(Ie,$[Re],$[Re+1],$[Re+2])}projectAndGetPerspectiveRatio($,q,re,ye,be){const Se=[q[0],q[1],q[2],1];let Ie=!1;if(q[2]||this.transform.pitch>0){j.transformMat4$1(Se,Se,$);const Re=be.name==="globe";this.fogState&&re&&!Re&&(Ie=function(Fe,Ue,Ze,Ye,rt,et){const tt=et.calculateFogTileMatrix(rt),nt=[Ue,Ze,Ye];return j.transformMat4(nt,nt,tt),mn(Fe,nt,et.pitch,et._fov)}(this.fogState,q[0],q[1],q[2],re.toUnwrapped(),this.transform)>.9)}else Ai(Se,Se,$);return{point:new j.pointGeometry((Se[0]/Se[3]+1)/2*this.transform.width+zr,(-Se[1]/Se[3]+1)/2*this.transform.height+zr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(be)/Se[3]*.5,1.5),signedDistanceFromCamera:Se[3],occluded:ye&&Se[2]>Se[3]||Ie}}isOffscreen($,q,re,ye){return re<zr||$>=this.screenRightBoundary||ye<zr||q>this.screenBottomBoundary}isInsideGrid($,q,re,ye){return re>=0&&$<this.gridRightBoundary&&ye>=0&&q<this.gridBottomBoundary}getViewportMatrix(){const $=j.identity([]);return j.translate($,$,[-100,-100,0]),$}}function Ns(te,$,q){const re=$.createTileMatrix(te,te.worldSize,q.toUnwrapped());return j.multiply(new Float32Array(16),te.projMatrix,re)}function Pi(te,$,q){if($.projection.name===q.projection.name)return te.projMatrix;const re=q.clone();return re.setProjection($.projection),Ns(re,$.getProjection(),te)}function ki(te,$,q){return $.name===q.projection.name?te.projMatrix:Ns(q,$,te)}class Ml{constructor($,q,re,ye){this.opacity=$?Math.max(0,Math.min(1,$.opacity+($.placed?q:-q))):ye&&re?1:0,this.placed=re}isHidden(){return this.opacity===0&&!this.placed}}class Io{constructor($,q,re,ye,be,Se=!1){this.text=new Ml($?$.text:null,q,re,be),this.icon=new Ml($?$.icon:null,q,ye,be),this.clipped=Se}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ni{constructor($,q,re,ye=!1){this.text=$,this.icon=q,this.skipFade=re,this.clipped=ye}}class js{constructor(){this.invProjMatrix=j.create(),this.viewportMatrix=j.create(),this.circles=[]}}class Pl{constructor($,q,re,ye,be){this.bucketInstanceId=$,this.featureIndex=q,this.sourceLayerIndex=re,this.bucketIndex=ye,this.tileID=be}}class Vs{constructor($){this.crossSourceCollisions=$,this.maxGroupID=0,this.collisionGroups={}}get($){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[$]){const q=++this.maxGroupID;this.collisionGroups[$]={ID:q,predicate:re=>re.collisionGroupID===q}}return this.collisionGroups[$]}}function ui(te,$,q,re,ye){const{horizontalAlign:be,verticalAlign:Se}=j.getAnchorAlignment(te),Ie=-(be-.5)*$,Re=-(Se-.5)*q,Fe=j.evaluateVariableOffset(te,re);return new j.pointGeometry(Ie+Fe[0]*ye,Re+Fe[1]*ye)}function Gs(te,$,q,re,ye){const be=new j.pointGeometry(te,$);return q&&be._rotate(re?ye:-ye),be}class kl{constructor($,q,re,ye,be){this.transform=$.clone(),this.projection=$.projection.name,this.collisionIndex=new Il(this.transform,be),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=q,this.retainedQueryData={},this.collisionGroups=new Vs(re),this.collisionCircleArrays={},this.prevPlacement=ye,ye&&(ye.prevPlacement=void 0),this.placedOrientations={}}getBucketParts($,q,re,ye){const be=re.getBucket(q),Se=re.latestFeatureIndex;if(!be||!Se||q.id!==be.layerIds[0])return;const Ie=be.layers[0].layout,Re=re.collisionBoxArray,Fe=Math.pow(2,this.transform.zoom-re.tileID.overscaledZ),Ue=re.tileSize/j.EXTENT,Ze=re.tileID.toUnwrapped();this.transform.setProjection(be.projection);const Ye=(rt=re.tileID,et=be.getProjection(),tt=this.transform,et.name===this.projection?tt.calculateProjMatrix(rt.toUnwrapped()):Ns(tt,et,rt));var rt,et,tt;const nt=Ie.get("text-pitch-alignment")==="map",Qe=Ie.get("text-rotation-alignment")==="map";q.compileFilter();const lt=q.dynamicFilter(),it=q.dynamicFilterNeedsFeature(),xt=this.transform.calculatePixelsToTileUnitsMatrix(re),gt=hr(Ye,re.tileID.canonical,nt,Qe,this.transform,be.getProjection(),xt);let dt=null;if(nt){const St=Yi(Ye,re.tileID.canonical,nt,Qe,this.transform,be.getProjection(),xt);dt=j.multiply([],this.transform.labelPlaneMatrix,St)}let vt=null;lt&&re.latestFeatureIndex&&(vt={unwrappedTileID:Ze,dynamicFilter:lt,dynamicFilterNeedsFeature:it,featureIndex:re.latestFeatureIndex}),this.retainedQueryData[be.bucketInstanceId]=new Pl(be.bucketInstanceId,Se,be.sourceLayerIndex,be.index,re.tileID);const _t={bucket:be,layout:Ie,posMatrix:Ye,textLabelPlaneMatrix:gt,labelToScreenMatrix:dt,clippingData:vt,scale:Fe,textPixelRatio:Ue,holdingForFade:re.holdingForFade(),collisionBoxArray:Re,partiallyEvaluatedTextSize:j.evaluateSizeForZoom(be.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:j.evaluateSizeForZoom(be.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(be.sourceID)};if(ye)for(const St of be.sortKeyRanges){const{sortKey:Bt,symbolInstanceStart:un,symbolInstanceEnd:Rt}=St;$.push({sortKey:Bt,symbolInstanceStart:un,symbolInstanceEnd:Rt,parameters:_t})}else $.push({symbolInstanceStart:0,symbolInstanceEnd:be.symbolInstances.length,parameters:_t})}attemptAnchorPlacement($,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt,nt,Qe,lt){const it=[Ye.textOffset0,Ye.textOffset1],xt=ui($,re,ye,it,be),gt=this.collisionIndex.placeCollisionBox(et,be,q,Gs(xt.x,xt.y,Se,Ie,this.transform.angle),Ze,Re,Fe,Ue.predicate);if((!nt||this.collisionIndex.placeCollisionBox(et,et.getSymbolInstanceIconSize(lt,this.transform.zoom,rt),nt,Gs(xt.x,xt.y,Se,Ie,this.transform.angle),Ze,Re,Fe,Ue.predicate).box.length!==0)&&gt.box.length>0){let dt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ye.crossTileID]&&this.prevPlacement.placements[Ye.crossTileID]&&this.prevPlacement.placements[Ye.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[Ye.crossTileID].anchor),this.variableOffsets[Ye.crossTileID]={textOffset:it,width:re,height:ye,anchor:$,textScale:be,prevAnchor:dt},this.markUsedJustification(et,$,Ye,tt),et.allowVerticalPlacement&&(this.markUsedOrientation(et,tt,Ye),this.placedOrientations[Ye.crossTileID]=tt),{shift:xt,placedGlyphBoxes:gt}}}placeLayerBucketPart($,q,re,ye){const{bucket:be,layout:Se,posMatrix:Ie,textLabelPlaneMatrix:Re,labelToScreenMatrix:Fe,clippingData:Ue,textPixelRatio:Ze,holdingForFade:Ye,collisionBoxArray:rt,partiallyEvaluatedTextSize:et,partiallyEvaluatedIconSize:tt,collisionGroup:nt}=$.parameters,Qe=Se.get("text-optional"),lt=Se.get("icon-optional"),it=Se.get("text-allow-overlap"),xt=Se.get("icon-allow-overlap"),gt=Se.get("text-rotation-alignment")==="map",dt=Se.get("text-pitch-alignment")==="map",vt=Se.get("icon-text-fit")!=="none",_t=Se.get("symbol-z-order")==="viewport-y";this.transform.setProjection(be.projection);let St=it&&(xt||!be.hasIconData()||lt),Bt=xt&&(it||!be.hasTextData()||Qe);!be.collisionArrays&&rt&&be.deserializeCollisionBoxes(rt),re&&ye&&be.updateCollisionDebugBuffers(this.transform.zoom,rt);const un=(Rt,Xt,Qt)=>{if(Ue){const qr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Hr=null;if(Ue.dynamicFilterNeedsFeature){const cr=this.retainedQueryData[be.bucketInstanceId];Hr=Ue.featureIndex.loadFeature({featureIndex:Rt.featureIndex,bucketIndex:cr.bucketIndex,sourceLayerIndex:cr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Ue.dynamicFilter)(qr,Hr,this.retainedQueryData[be.bucketInstanceId].tileID.canonical,new j.pointGeometry(Rt.tileAnchorX,Rt.tileAnchorY),this.transform.calculateDistanceTileData(Ue.unwrappedTileID)))return this.placements[Rt.crossTileID]=new ni(!1,!1,!1,!0),void(q[Rt.crossTileID]=!0)}if(q[Rt.crossTileID])return;if(Ye)return void(this.placements[Rt.crossTileID]=new ni(!1,!1,!1));let gn=!1,jt=!1,dn=!0,Jt=!1,wn=!1,xn=null,zn={box:null,offscreen:null,occluded:null},$n={box:null,offscreen:null,occluded:null},Wn=null,fr=null,Dn=null,Qn=0,Tr=0,Gr=0;Qt.textFeatureIndex?Qn=Qt.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(Qn=Rt.featureIndex),Qt.verticalTextFeatureIndex&&(Tr=Qt.verticalTextFeatureIndex);const ei=qr=>{qr.tileID=this.retainedQueryData[be.bucketInstanceId].tileID,(this.transform.elevation||qr.elevation)&&(qr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[be.bucketInstanceId].tileID,qr.tileAnchorX,qr.tileAnchorY):0)},Dr=Qt.textBox;if(Dr){ei(Dr);const qr=cr=>{let ii=j.WritingMode.horizontal;if(be.allowVerticalPlacement&&!cr&&this.prevPlacement){const xi=this.prevPlacement.placedOrientations[Rt.crossTileID];xi&&(this.placedOrientations[Rt.crossTileID]=xi,ii=xi,this.markUsedOrientation(be,ii,Rt))}return ii},Hr=(cr,ii)=>{if(be.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&Qt.verticalTextBox){for(const xi of be.writingModes)if(xi===j.WritingMode.vertical?(zn=ii(),$n=zn):zn=cr(),zn&&zn.box&&zn.box.length)break}else zn=cr()};if(Se.get("text-variable-anchor")){let cr=Se.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt.crossTileID]){const Ur=this.prevPlacement.variableOffsets[Rt.crossTileID];cr.indexOf(Ur.anchor)>0&&(cr=cr.filter(bi=>bi!==Ur.anchor),cr.unshift(Ur.anchor))}const ii=(Ur,bi,Wo)=>{const Si=be.getSymbolInstanceTextSize(et,Rt,this.transform.zoom,Xt),Xo=(Ur.x2-Ur.x1)*Si+2*Ur.padding,Ko=(Ur.y2-Ur.y1)*Si+2*Ur.padding,Yo=vt&&!xt?bi:null;Yo&&ei(Yo);let Ci={box:[],offscreen:!1,occluded:!1};const Jo=it?2*cr.length:cr.length;for(let zo=0;zo<Jo;++zo){const pa=this.attemptAnchorPlacement(cr[zo%cr.length],Ur,Xo,Ko,Si,gt,dt,Ze,Ie,nt,zo>=cr.length,Rt,Xt,be,Wo,Yo,et,tt);if(pa&&(Ci=pa.placedGlyphBoxes,Ci&&Ci.box&&Ci.box.length)){gn=!0,xn=pa.shift;break}}return Ci};Hr(()=>ii(Dr,Qt.iconBox,j.WritingMode.horizontal),()=>{const Ur=Qt.verticalTextBox;return Ur&&ei(Ur),be.allowVerticalPlacement&&!(zn&&zn.box&&zn.box.length)&&Rt.numVerticalGlyphVertices>0&&Ur?ii(Ur,Qt.verticalIconBox,j.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),zn&&(gn=zn.box,dn=zn.offscreen,Jt=zn.occluded);const xi=qr(zn&&zn.box);if(!gn&&this.prevPlacement){const Ur=this.prevPlacement.variableOffsets[Rt.crossTileID];Ur&&(this.variableOffsets[Rt.crossTileID]=Ur,this.markUsedJustification(be,Ur.anchor,Rt,xi))}}else{const cr=(ii,xi)=>{const Ur=be.getSymbolInstanceTextSize(et,Rt,this.transform.zoom,Xt),bi=this.collisionIndex.placeCollisionBox(be,Ur,ii,new j.pointGeometry(0,0),it,Ze,Ie,nt.predicate);return bi&&bi.box&&bi.box.length&&(this.markUsedOrientation(be,xi,Rt),this.placedOrientations[Rt.crossTileID]=xi),bi};Hr(()=>cr(Dr,j.WritingMode.horizontal),()=>{const ii=Qt.verticalTextBox;return be.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&ii?(ei(ii),cr(ii,j.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),qr(zn&&zn.box&&zn.box.length)}}if(Wn=zn,gn=Wn&&Wn.box&&Wn.box.length>0,dn=Wn&&Wn.offscreen,Jt=Wn&&Wn.occluded,Rt.useRuntimeCollisionCircles){const qr=be.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex>=0?Rt.centerJustifiedTextSymbolIndex:Rt.verticalPlacedTextSymbolIndex),Hr=j.evaluateSizeForFeature(be.textSizeData,et,qr),cr=Se.get("text-padding");fr=this.collisionIndex.placeCollisionCircles(be,it,qr,be.lineVertexArray,be.glyphOffsetArray,Hr,Ie,Re,Fe,re,dt,nt.predicate,Rt.collisionCircleDiameter*Hr/j.ONE_EM,cr,this.retainedQueryData[be.bucketInstanceId].tileID),gn=it||fr.circles.length>0&&!fr.collisionDetected,dn=dn&&fr.offscreen,Jt=fr.occluded}if(Qt.iconFeatureIndex&&(Gr=Qt.iconFeatureIndex),Qt.iconBox){const qr=Hr=>{ei(Hr);const cr=vt&&xn?Gs(xn.x,xn.y,gt,dt,this.transform.angle):new j.pointGeometry(0,0),ii=be.getSymbolInstanceIconSize(tt,this.transform.zoom,Xt);return this.collisionIndex.placeCollisionBox(be,ii,Hr,cr,xt,Ze,Ie,nt.predicate)};$n&&$n.box&&$n.box.length&&Qt.verticalIconBox?(Dn=qr(Qt.verticalIconBox),jt=Dn.box.length>0):(Dn=qr(Qt.iconBox),jt=Dn.box.length>0),dn=dn&&Dn.offscreen,wn=Dn.occluded}const pi=Qe||Rt.numHorizontalGlyphVertices===0&&Rt.numVerticalGlyphVertices===0,to=lt||Rt.numIconVertices===0;if(pi||to?to?pi||(jt=jt&&gn):gn=jt&&gn:jt=gn=jt&&gn,gn&&Wn&&Wn.box&&this.collisionIndex.insertCollisionBox(Wn.box,Se.get("text-ignore-placement"),be.bucketInstanceId,$n&&$n.box&&Tr?Tr:Qn,nt.ID),jt&&Dn&&this.collisionIndex.insertCollisionBox(Dn.box,Se.get("icon-ignore-placement"),be.bucketInstanceId,Gr,nt.ID),fr&&(gn&&this.collisionIndex.insertCollisionCircles(fr.circles,Se.get("text-ignore-placement"),be.bucketInstanceId,Qn,nt.ID),re)){const qr=be.bucketInstanceId;let Hr=this.collisionCircleArrays[qr];Hr===void 0&&(Hr=this.collisionCircleArrays[qr]=new js);for(let cr=0;cr<fr.circles.length;cr+=4)Hr.circles.push(fr.circles[cr+0]),Hr.circles.push(fr.circles[cr+1]),Hr.circles.push(fr.circles[cr+2]),Hr.circles.push(fr.collisionDetected?1:0)}const fo=be.projection.name!=="globe";St=St&&(fo||!Jt),Bt=Bt&&(fo||!wn),this.placements[Rt.crossTileID]=new ni(gn||St,jt||Bt,dn||be.justReloaded),q[Rt.crossTileID]=!0};if(_t){const Rt=be.getSortedSymbolIndexes(this.transform.angle);for(let Xt=Rt.length-1;Xt>=0;--Xt){const Qt=Rt[Xt];un(be.symbolInstances.get(Qt),Qt,be.collisionArrays[Qt])}}else for(let Rt=$.symbolInstanceStart;Rt<$.symbolInstanceEnd;Rt++)un(be.symbolInstances.get(Rt),Rt,be.collisionArrays[Rt]);if(re&&be.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[be.bucketInstanceId];j.invert(Rt.invProjMatrix,Ie),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}be.justReloaded=!1}markUsedJustification($,q,re,ye){let be;be=ye===j.WritingMode.vertical?re.verticalPlacedTextSymbolIndex:{left:re.leftJustifiedTextSymbolIndex,center:re.centerJustifiedTextSymbolIndex,right:re.rightJustifiedTextSymbolIndex}[j.getAnchorJustification(q)];const Se=[re.leftJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.rightJustifiedTextSymbolIndex,re.verticalPlacedTextSymbolIndex];for(const Ie of Se)Ie>=0&&($.text.placedSymbolArray.get(Ie).crossTileID=be>=0&&Ie!==be?0:re.crossTileID)}markUsedOrientation($,q,re){const ye=q===j.WritingMode.horizontal||q===j.WritingMode.horizontalOnly?q:0,be=q===j.WritingMode.vertical?q:0,Se=[re.leftJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.rightJustifiedTextSymbolIndex];for(const Ie of Se)$.text.placedSymbolArray.get(Ie).placedOrientation=ye;re.verticalPlacedTextSymbolIndex&&($.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).placedOrientation=be)}commit($){this.commitTime=$,this.zoomAtLastRecencyCheck=this.transform.zoom;const q=this.prevPlacement;let re=!1;this.prevZoomAdjustment=q?q.zoomAdjustment(this.transform.zoom):0;const ye=q?q.symbolFadeChange($):1,be=q?q.opacities:{},Se=q?q.variableOffsets:{},Ie=q?q.placedOrientations:{};for(const Re in this.placements){const Fe=this.placements[Re],Ue=be[Re];Ue?(this.opacities[Re]=new Io(Ue,ye,Fe.text,Fe.icon,null,Fe.clipped),re=re||Fe.text!==Ue.text.placed||Fe.icon!==Ue.icon.placed):(this.opacities[Re]=new Io(null,ye,Fe.text,Fe.icon,Fe.skipFade,Fe.clipped),re=re||Fe.text||Fe.icon)}for(const Re in be){const Fe=be[Re];if(!this.opacities[Re]){const Ue=new Io(Fe,ye,!1,!1);Ue.isHidden()||(this.opacities[Re]=Ue,re=re||Fe.text.placed||Fe.icon.placed)}}for(const Re in Se)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=Se[Re]);for(const Re in Ie)this.placedOrientations[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.placedOrientations[Re]=Ie[Re]);re?this.lastPlacementChangeTime=$:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=q?q.lastPlacementChangeTime:$)}updateLayerOpacities($,q){const re={};for(const ye of q){const be=ye.getBucket($);be&&ye.latestFeatureIndex&&$.id===be.layerIds[0]&&this.updateBucketOpacities(be,re,ye.collisionBoxArray)}}updateBucketOpacities($,q,re){$.hasTextData()&&$.text.opacityVertexArray.clear(),$.hasIconData()&&$.icon.opacityVertexArray.clear(),$.hasIconCollisionBoxData()&&$.iconCollisionBox.collisionVertexArray.clear(),$.hasTextCollisionBoxData()&&$.textCollisionBox.collisionVertexArray.clear();const ye=$.layers[0].layout,be=!!$.layers[0].dynamicFilter(),Se=new Io(null,0,!1,!1,!0),Ie=ye.get("text-allow-overlap"),Re=ye.get("icon-allow-overlap"),Fe=ye.get("text-variable-anchor"),Ue=ye.get("text-rotation-alignment")==="map",Ze=ye.get("text-pitch-alignment")==="map",Ye=ye.get("icon-text-fit")!=="none",rt=new Io(null,0,Ie&&(Re||!$.hasIconData()||ye.get("icon-optional")),Re&&(Ie||!$.hasTextData()||ye.get("text-optional")),!0);!$.collisionArrays&&re&&($.hasIconCollisionBoxData()||$.hasTextCollisionBoxData())&&$.deserializeCollisionBoxes(re);const et=(nt,Qe,lt)=>{for(let it=0;it<Qe/4;it++)nt.opacityVertexArray.emplaceBack(lt)};let tt=0;for(let nt=0;nt<$.symbolInstances.length;nt++){const Qe=$.symbolInstances.get(nt),{numHorizontalGlyphVertices:lt,numVerticalGlyphVertices:it,crossTileID:xt}=Qe;let gt=this.opacities[xt];q[xt]?gt=Se:gt||(gt=rt,this.opacities[xt]=gt),q[xt]=!0;const dt=lt>0||it>0,vt=Qe.numIconVertices>0,_t=this.placedOrientations[Qe.crossTileID],St=_t===j.WritingMode.vertical,Bt=_t===j.WritingMode.horizontal||_t===j.WritingMode.horizontalOnly;if(!dt&&!vt||gt.isHidden()||tt++,dt){const un=Go(gt.text);et($.text,lt,St?Qi:un),et($.text,it,Bt?Qi:un);const Rt=gt.text.isHidden();[Qe.rightJustifiedTextSymbolIndex,Qe.centerJustifiedTextSymbolIndex,Qe.leftJustifiedTextSymbolIndex].forEach(gn=>{gn>=0&&($.text.placedSymbolArray.get(gn).hidden=Rt||St?1:0)}),Qe.verticalPlacedTextSymbolIndex>=0&&($.text.placedSymbolArray.get(Qe.verticalPlacedTextSymbolIndex).hidden=Rt||Bt?1:0);const Xt=this.variableOffsets[Qe.crossTileID];Xt&&this.markUsedJustification($,Xt.anchor,Qe,_t);const Qt=this.placedOrientations[Qe.crossTileID];Qt&&(this.markUsedJustification($,"left",Qe,Qt),this.markUsedOrientation($,Qt,Qe))}if(vt){const un=Go(gt.icon);Qe.placedIconSymbolIndex>=0&&(et($.icon,Qe.numIconVertices,St?Qi:un),$.icon.placedSymbolArray.get(Qe.placedIconSymbolIndex).hidden=gt.icon.isHidden()),Qe.verticalPlacedIconSymbolIndex>=0&&(et($.icon,Qe.numVerticalIconVertices,Bt?Qi:un),$.icon.placedSymbolArray.get(Qe.verticalPlacedIconSymbolIndex).hidden=gt.icon.isHidden())}if($.hasIconCollisionBoxData()||$.hasTextCollisionBoxData()){const un=$.collisionArrays[nt];if(un){let Rt=new j.pointGeometry(0,0),Xt=!0;if(un.textBox||un.verticalTextBox){if(Fe){const gn=this.variableOffsets[xt];gn?(Rt=ui(gn.anchor,gn.width,gn.height,gn.textOffset,gn.textScale),Ue&&Rt._rotate(Ze?this.transform.angle:-this.transform.angle)):Xt=!1}be&&(Xt=!gt.clipped),un.textBox&&ji($.textCollisionBox.collisionVertexArray,gt.text.placed,!Xt||St,Rt.x,Rt.y),un.verticalTextBox&&ji($.textCollisionBox.collisionVertexArray,gt.text.placed,!Xt||Bt,Rt.x,Rt.y)}const Qt=Xt&&Boolean(!Bt&&un.verticalIconBox);un.iconBox&&ji($.iconCollisionBox.collisionVertexArray,gt.icon.placed,Qt,Ye?Rt.x:0,Ye?Rt.y:0),un.verticalIconBox&&ji($.iconCollisionBox.collisionVertexArray,gt.icon.placed,!Qt,Ye?Rt.x:0,Ye?Rt.y:0)}}}if($.fullyClipped=tt===0,$.sortFeatures(this.transform.angle),this.retainedQueryData[$.bucketInstanceId]&&(this.retainedQueryData[$.bucketInstanceId].featureSortOrder=$.featureSortOrder),$.hasTextData()&&$.text.opacityVertexBuffer&&$.text.opacityVertexBuffer.updateData($.text.opacityVertexArray),$.hasIconData()&&$.icon.opacityVertexBuffer&&$.icon.opacityVertexBuffer.updateData($.icon.opacityVertexArray),$.hasIconCollisionBoxData()&&$.iconCollisionBox.collisionVertexBuffer&&$.iconCollisionBox.collisionVertexBuffer.updateData($.iconCollisionBox.collisionVertexArray),$.hasTextCollisionBoxData()&&$.textCollisionBox.collisionVertexBuffer&&$.textCollisionBox.collisionVertexBuffer.updateData($.textCollisionBox.collisionVertexArray),$.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[$.bucketInstanceId];$.placementInvProjMatrix=nt.invProjMatrix,$.placementViewportMatrix=nt.viewportMatrix,$.collisionCircleArray=nt.circles,delete this.collisionCircleArrays[$.bucketInstanceId]}}symbolFadeChange($){return this.fadeDuration===0?1:($-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment($){return Math.max(0,(this.transform.zoom-$)/1.5)}hasTransitions($){return this.stale||$-this.lastPlacementChangeTime<this.fadeDuration}stillRecent($,q){const re=this.zoomAtLastRecencyCheck===q?1-this.zoomAdjustment(q):1;return this.zoomAtLastRecencyCheck=q,this.commitTime+this.fadeDuration*re>$}setStale(){this.stale=!0}}function ji(te,$,q,re,ye){te.emplaceBack($?1:0,q?1:0,re||0,ye||0),te.emplaceBack($?1:0,q?1:0,re||0,ye||0),te.emplaceBack($?1:0,q?1:0,re||0,ye||0),te.emplaceBack($?1:0,q?1:0,re||0,ye||0)}const qs=Math.pow(2,25),ka=Math.pow(2,24),kh=Math.pow(2,17),Rl=Math.pow(2,16),hs=Math.pow(2,9),Rh=Math.pow(2,8),nu=Math.pow(2,1);function Go(te){if(te.opacity===0&&!te.placed)return 0;if(te.opacity===1&&te.placed)return 4294967295;const $=te.placed?1:0,q=Math.floor(127*te.opacity);return q*qs+$*ka+q*kh+$*Rl+q*hs+$*Rh+q*nu+$}const Qi=0;class Ra{constructor($){this._sortAcrossTiles=$.layout.get("symbol-z-order")!=="viewport-y"&&$.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement($,q,re,ye,be){const Se=this._bucketParts;for(;this._currentTileIndex<$.length;)if(q.getBucketParts(Se,ye,$[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,be())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Se.sort((Ie,Re)=>Ie.sortKey-Re.sortKey));this._currentPartIndex<Se.length;){const Ie=Se[this._currentPartIndex];if(q.placeLayerBucketPart(Ie,this._seenCrossTileIDs,re,Ie.symbolInstanceStart===0),this._currentPartIndex++,be())return!0}return!1}}class Mo{constructor($,q,re,ye,be,Se,Ie,Re){this.placement=new kl($,be,Se,Ie,Re),this._currentPlacementIndex=q.length-1,this._forceFullPlacement=re,this._showCollisionBoxes=ye,this._done=!1}isDone(){return this._done}continuePlacement($,q,re){const ye=j.exported.now(),be=()=>{const Se=j.exported.now()-ye;return!this._forceFullPlacement&&Se>2};for(;this._currentPlacementIndex>=0;){const Se=q[$[this._currentPlacementIndex]],Ie=this.placement.collisionIndex.transform.zoom;if(Se.type==="symbol"&&(!Se.minzoom||Se.minzoom<=Ie)&&(!Se.maxzoom||Se.maxzoom>Ie)){if(this._inProgressLayer||(this._inProgressLayer=new Ra(Se)),this._inProgressLayer.continuePlacement(re[Se.source],this.placement,this._showCollisionBoxes,Se,be))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit($){return this.placement.commit($),this.placement}}const zl=512/j.EXTENT/2;class za{constructor($,q,re){this.tileID=$,this.indexedSymbolInstances={},this.bucketInstanceId=re;for(let ye=0;ye<q.length;ye++){const be=q.get(ye),Se=be.key;this.indexedSymbolInstances[Se]||(this.indexedSymbolInstances[Se]=[]),this.indexedSymbolInstances[Se].push({crossTileID:be.crossTileID,coord:this.getScaledCoordinates(be,$)})}}getScaledCoordinates($,q){const re=zl/Math.pow(2,q.canonical.z-this.tileID.canonical.z);return{x:Math.floor((q.canonical.x*j.EXTENT+$.tileAnchorX)*re),y:Math.floor((q.canonical.y*j.EXTENT+$.tileAnchorY)*re)}}findMatches($,q,re){const ye=this.tileID.canonical.z<q.canonical.z?1:Math.pow(2,this.tileID.canonical.z-q.canonical.z);for(let be=0;be<$.length;be++){const Se=$.get(be);if(Se.crossTileID)continue;const Ie=this.indexedSymbolInstances[Se.key];if(!Ie)continue;const Re=this.getScaledCoordinates(Se,q);for(const Fe of Ie)if(Math.abs(Fe.coord.x-Re.x)<=ye&&Math.abs(Fe.coord.y-Re.y)<=ye&&!re[Fe.crossTileID]){re[Fe.crossTileID]=!0,Se.crossTileID=Fe.crossTileID;break}}}}class zh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Dh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump($){const q=Math.round(($-this.lng)/360);if(q!==0)for(const re in this.indexes){const ye=this.indexes[re],be={};for(const Se in ye){const Ie=ye[Se];Ie.tileID=Ie.tileID.unwrapTo(Ie.tileID.wrap+q),be[Ie.tileID.key]=Ie}this.indexes[re]=be}this.lng=$}addBucket($,q,re){if(this.indexes[$.overscaledZ]&&this.indexes[$.overscaledZ][$.key]){if(this.indexes[$.overscaledZ][$.key].bucketInstanceId===q.bucketInstanceId)return!1;this.removeBucketCrossTileIDs($.overscaledZ,this.indexes[$.overscaledZ][$.key])}for(let be=0;be<q.symbolInstances.length;be++)q.symbolInstances.get(be).crossTileID=0;this.usedCrossTileIDs[$.overscaledZ]||(this.usedCrossTileIDs[$.overscaledZ]={});const ye=this.usedCrossTileIDs[$.overscaledZ];for(const be in this.indexes){const Se=this.indexes[be];if(Number(be)>$.overscaledZ)for(const Ie in Se){const Re=Se[Ie];Re.tileID.isChildOf($)&&Re.findMatches(q.symbolInstances,$,ye)}else{const Ie=Se[$.scaledTo(Number(be)).key];Ie&&Ie.findMatches(q.symbolInstances,$,ye)}}for(let be=0;be<q.symbolInstances.length;be++){const Se=q.symbolInstances.get(be);Se.crossTileID||(Se.crossTileID=re.generate(),ye[Se.crossTileID]=!0)}return this.indexes[$.overscaledZ]===void 0&&(this.indexes[$.overscaledZ]={}),this.indexes[$.overscaledZ][$.key]=new za($,q.symbolInstances,q.bucketInstanceId),!0}removeBucketCrossTileIDs($,q){for(const re in q.indexedSymbolInstances)for(const ye of q.indexedSymbolInstances[re])delete this.usedCrossTileIDs[$][ye.crossTileID]}removeStaleBuckets($){let q=!1;for(const re in this.indexes){const ye=this.indexes[re];for(const be in ye)$[ye[be].bucketInstanceId]||(this.removeBucketCrossTileIDs(re,ye[be]),delete ye[be],q=!0)}return q}}class Da{constructor(){this.layerIndexes={},this.crossTileIDs=new zh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer($,q,re,ye){let be=this.layerIndexes[$.id];be===void 0&&(be=this.layerIndexes[$.id]=new Dh);let Se=!1;const Ie={};ye.name!=="globe"&&be.handleWrapJump(re);for(const Re of q){const Fe=Re.getBucket($);Fe&&$.id===Fe.layerIds[0]&&(Fe.bucketInstanceId||(Fe.bucketInstanceId=++this.maxBucketInstanceId),be.addBucket(Re.tileID,Fe,this.crossTileIDs)&&(Se=!0),Ie[Fe.bucketInstanceId]=!0)}return be.removeStaleBuckets(Ie)&&(Se=!0),Se}pruneUnusedLayers($){const q={};$.forEach(re=>{q[re]=!0});for(const re in this.layerIndexes)q[re]||delete this.layerIndexes[re]}}const La=(te,$)=>j.emitValidationErrors(te,$&&$.filter(q=>q.identifier!=="source.canvas")),ru=j.pick(jn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Lh=j.pick(jn,["setCenter","setZoom","setBearing","setPitch"]),iu={version:8,layers:[],sources:{}},Bh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Vi extends j.Evented{constructor($,q={}){super(),this.map=$,this.dispatcher=new rr(kr(),this),this.imageManager=new on,this.imageManager.setEventedParent(this),this.glyphManager=new j.GlyphManager($._requestManager,q.localFontFamily?j.LocalGlyphMode.all:q.localIdeographFontFamily?j.LocalGlyphMode.ideographs:j.LocalGlyphMode.none,q.localFontFamily||q.localIdeographFontFamily),this.lineAtlas=new j.LineAtlas(256,512),this.crossTileSymbolIndex=new Da,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new j.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",j.getReferrer());const re=this;this._rtlTextPluginCallback=Vi.registerForPluginStateChange(ye=>{re.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ye.pluginStatus,pluginURL:ye.pluginURL},(be,Se)=>{if(j.triggerPluginCompletionEvent(be),Se&&Se.every(Ie=>Ie))for(const Ie in re._sourceCaches){const Re=re._sourceCaches[Ie],Fe=Re.getSource().type;Fe!=="vector"&&Fe!=="geojson"||Re.reload()}})}),this.on("data",ye=>{if(ye.dataType!=="source"||ye.sourceDataType!=="metadata")return;const be=this.getSource(ye.sourceId);if(be&&be.vectorLayerIds)for(const Se in this._layers){const Ie=this._layers[Se];Ie.source===be.id&&this._validateLayer(Ie)}})}loadURL($,q={}){this.fire(new j.Event("dataloading",{dataType:"style"}));const re=typeof q.validate=="boolean"?q.validate:!j.isMapboxURL($);$=this.map._requestManager.normalizeStyleURL($,q.accessToken);const ye=this.map._requestManager.transformRequest($,j.ResourceType.Style);this._request=j.getJSON(ye,(be,Se)=>{this._request=null,be?this.fire(new j.ErrorEvent(be)):Se&&this._load(Se,re)})}loadJSON($,q={}){this.fire(new j.Event("dataloading",{dataType:"style"})),this._request=j.exported.frame(()=>{this._request=null,this._load($,q.validate!==!1)})}loadEmpty(){this.fire(new j.Event("dataloading",{dataType:"style"})),this._load(iu,!1)}_updateLayerCount($,q){const re=q?1:-1;$.is3D()&&(this._num3DLayers+=re),$.type==="circle"&&(this._numCircleLayers+=re),$.type==="symbol"&&(this._numSymbolLayers+=re)}_load($,q){if(q&&La(this,j.validateStyle($)))return;this._loaded=!0,this.stylesheet=j.clone$1($),this._updateMapProjection();for(const ye in $.sources)this.addSource(ye,$.sources[ye],{validate:!1});this._changed=!1,$.sprite?this._loadSprite($.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL($.glyphs);const re=Rr(this.stylesheet.layers);this._order=re.map(ye=>ye.id),this._layers={},this._serializedLayers={};for(let ye of re)ye=j.createStyleLayer(ye),ye.setEventedParent(this,{layer:{id:ye.id}}),this._layers[ye.id]=ye,this._serializedLayers[ye.id]=ye.serialize(),this._updateLayerCount(ye,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _n(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new j.Event("data",{dataType:"style"})),this.fire(new j.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection($){$?this.stylesheet.projection=$:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite($){this._spriteRequest=function(q,re,ye){let be,Se,Ie;const Re=j.exported.devicePixelRatio>1?"@2x":"";let Fe=j.getJSON(re.transformRequest(re.normalizeSpriteURL(q,Re,".json"),j.ResourceType.SpriteJSON),(Ye,rt)=>{Fe=null,Ie||(Ie=Ye,be=rt,Ze())}),Ue=j.getImage(re.transformRequest(re.normalizeSpriteURL(q,Re,".png"),j.ResourceType.SpriteImage),(Ye,rt)=>{Ue=null,Ie||(Ie=Ye,Se=rt,Ze())});function Ze(){if(Ie)ye(Ie);else if(be&&Se){const Ye=j.exported.getImageData(Se),rt={};for(const et in be){const{width:tt,height:nt,x:Qe,y:lt,sdf:it,pixelRatio:xt,stretchX:gt,stretchY:dt,content:vt}=be[et],_t=new j.RGBAImage({width:tt,height:nt});j.RGBAImage.copy(Ye,_t,{x:Qe,y:lt},{x:0,y:0},{width:tt,height:nt}),rt[et]={data:_t,pixelRatio:xt,sdf:it,stretchX:gt,stretchY:dt,content:vt}}ye(null,rt)}}return{cancel(){Fe&&(Fe.cancel(),Fe=null),Ue&&(Ue.cancel(),Ue=null)}}}($,this.map._requestManager,(q,re)=>{if(this._spriteRequest=null,q)this.fire(new j.ErrorEvent(q));else if(re)for(const ye in re)this.imageManager.addImage(ye,re[ye]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new j.Event("data",{dataType:"style"}))})}_validateLayer($){const q=this.getSource($.source);if(!q)return;const re=$.sourceLayer;re&&(q.type==="geojson"||q.vectorLayerIds&&q.vectorLayerIds.indexOf(re)===-1)&&this.fire(new j.ErrorEvent(new Error(`Source layer "${re}" does not exist on source "${q.id}" as specified by style layer "${$.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const $ in this._sourceCaches)if(!this._sourceCaches[$].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers($){const q=[];for(const re of $){const ye=this._layers[re];ye.type!=="custom"&&q.push(ye.serialize())}return q}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const $ in this._sourceCaches)if(this._sourceCaches[$].hasTransition())return!0;for(const $ in this._layers)if(this._layers[$].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped($){return!!this.terrain&&Bh[$.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update($){if(!this._loaded)return;const q=this._changed;if(this._changed){const ye=Object.keys(this._updatedLayers),be=Object.keys(this._removedLayers);(ye.length||be.length)&&this._updateWorkerLayers(ye,be);for(const Se in this._updatedSources){const Ie=this._updatedSources[Se];Ie==="reload"?this._reloadSource(Se):Ie==="clear"&&this._clearSource(Se)}this._updateTilesForChangedImages();for(const Se in this._updatedPaintProps)this._layers[Se].updateTransitions($);this.light.updateTransitions($),this.fog&&this.fog.updateTransitions($),this._resetUpdates()}const re={};for(const ye in this._sourceCaches){const be=this._sourceCaches[ye];re[ye]=be.used,be.used=!1}for(const ye of this._order){const be=this._layers[ye];if(be.recalculate($,this._availableImages),!be.isHidden($.zoom)){const Ie=this._getLayerSourceCache(be);Ie&&(Ie.used=!0)}const Se=this.map.painter;if(Se){const Ie=be.getProgramIds();if(!Ie)continue;const Re=be.getProgramConfiguration($.zoom);for(const Fe of Ie)Se.useProgram(Fe,Re)}}for(const ye in re){const be=this._sourceCaches[ye];re[ye]!==be.used&&be.getSource().fire(new j.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:be.getSource().id}))}this.light.recalculate($),this.terrain&&this.terrain.recalculate($),this.fog&&this.fog.recalculate($),this.z=$.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),q&&this.fire(new j.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const $=Object.keys(this._changedImages);if($.length){for(const q in this._sourceCaches)this._sourceCaches[q].reloadTilesForDependencies(["icons","patterns"],$);this._changedImages={}}}_updateWorkerLayers($,q){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers($),removedIds:q})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState($){if(this._checkLoaded(),La(this,j.validateStyle($)))return!1;($=j.clone$1($)).layers=Rr($.layers);const q=function(ye,be){if(!ye)return[{command:jn.setStyle,args:[be]}];let Se=[];try{if(!Ce(ye.version,be.version))return[{command:jn.setStyle,args:[be]}];Ce(ye.center,be.center)||Se.push({command:jn.setCenter,args:[be.center]}),Ce(ye.zoom,be.zoom)||Se.push({command:jn.setZoom,args:[be.zoom]}),Ce(ye.bearing,be.bearing)||Se.push({command:jn.setBearing,args:[be.bearing]}),Ce(ye.pitch,be.pitch)||Se.push({command:jn.setPitch,args:[be.pitch]}),Ce(ye.sprite,be.sprite)||Se.push({command:jn.setSprite,args:[be.sprite]}),Ce(ye.glyphs,be.glyphs)||Se.push({command:jn.setGlyphs,args:[be.glyphs]}),Ce(ye.transition,be.transition)||Se.push({command:jn.setTransition,args:[be.transition]}),Ce(ye.light,be.light)||Se.push({command:jn.setLight,args:[be.light]}),Ce(ye.fog,be.fog)||Se.push({command:jn.setFog,args:[be.fog]}),Ce(ye.projection,be.projection)||Se.push({command:jn.setProjection,args:[be.projection]});const Ie={},Re=[];(function(Ze,Ye,rt,et){let tt;for(tt in Ye=Ye||{},Ze=Ze||{})Ze.hasOwnProperty(tt)&&(Ye.hasOwnProperty(tt)||Bi(tt,rt,et));for(tt in Ye)Ye.hasOwnProperty(tt)&&(Ze.hasOwnProperty(tt)?Ce(Ze[tt],Ye[tt])||(Ze[tt].type==="geojson"&&Ye[tt].type==="geojson"&&Ao(Ze,Ye,tt)?rt.push({command:jn.setGeoJSONSourceData,args:[tt,Ye[tt].data]}):Qr(tt,Ye,rt,et)):Zt(tt,Ye,rt))})(ye.sources,be.sources,Re,Ie);const Fe=[];ye.layers&&ye.layers.forEach(Ze=>{Ze.source&&Ie[Ze.source]?Se.push({command:jn.removeLayer,args:[Ze.id]}):Fe.push(Ze)});let Ue=ye.terrain;Ue&&Ie[Ue.source]&&(Se.push({command:jn.setTerrain,args:[void 0]}),Ue=void 0),Se=Se.concat(Re),Ce(Ue,be.terrain)||Se.push({command:jn.setTerrain,args:[be.terrain]}),function(Ze,Ye,rt){Ye=Ye||[];const et=(Ze=Ze||[]).map(Ki),tt=Ye.map(Ki),nt=Ze.reduce(Ma,{}),Qe=Ye.reduce(Ma,{}),lt=et.slice(),it=Object.create(null);let xt,gt,dt,vt,_t,St,Bt;for(xt=0,gt=0;xt<et.length;xt++)dt=et[xt],Qe.hasOwnProperty(dt)?gt++:(rt.push({command:jn.removeLayer,args:[dt]}),lt.splice(lt.indexOf(dt,gt),1));for(xt=0,gt=0;xt<tt.length;xt++)dt=tt[tt.length-1-xt],lt[lt.length-1-xt]!==dt&&(nt.hasOwnProperty(dt)?(rt.push({command:jn.removeLayer,args:[dt]}),lt.splice(lt.lastIndexOf(dt,lt.length-gt),1)):gt++,St=lt[lt.length-xt],rt.push({command:jn.addLayer,args:[Qe[dt],St]}),lt.splice(lt.length-xt,0,dt),it[dt]=!0);for(xt=0;xt<tt.length;xt++)if(dt=tt[xt],vt=nt[dt],_t=Qe[dt],!it[dt]&&!Ce(vt,_t))if(Ce(vt.source,_t.source)&&Ce(vt["source-layer"],_t["source-layer"])&&Ce(vt.type,_t.type)){for(Bt in Ia(vt.layout,_t.layout,rt,dt,null,jn.setLayoutProperty),Ia(vt.paint,_t.paint,rt,dt,null,jn.setPaintProperty),Ce(vt.filter,_t.filter)||rt.push({command:jn.setFilter,args:[dt,_t.filter]}),Ce(vt.minzoom,_t.minzoom)&&Ce(vt.maxzoom,_t.maxzoom)||rt.push({command:jn.setLayerZoomRange,args:[dt,_t.minzoom,_t.maxzoom]}),vt)vt.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?Ia(vt[Bt],_t[Bt],rt,dt,Bt.slice(6),jn.setPaintProperty):Ce(vt[Bt],_t[Bt])||rt.push({command:jn.setLayerProperty,args:[dt,Bt,_t[Bt]]}));for(Bt in _t)_t.hasOwnProperty(Bt)&&!vt.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?Ia(vt[Bt],_t[Bt],rt,dt,Bt.slice(6),jn.setPaintProperty):Ce(vt[Bt],_t[Bt])||rt.push({command:jn.setLayerProperty,args:[dt,Bt,_t[Bt]]}))}else rt.push({command:jn.removeLayer,args:[dt]}),St=lt[lt.lastIndexOf(dt)+1],rt.push({command:jn.addLayer,args:[_t,St]})}(Fe,be.layers,Se)}catch(Ie){console.warn("Unable to compute style diff:",Ie),Se=[{command:jn.setStyle,args:[be]}]}return Se}(this.serialize(),$).filter(ye=>!(ye.command in Lh));if(q.length===0)return!1;const re=q.filter(ye=>!(ye.command in ru));if(re.length>0)throw new Error(`Unimplemented: ${re.map(ye=>ye.command).join(", ")}.`);return q.forEach(ye=>{ye.command!=="setTransition"&&ye.command!=="setProjection"&&this[ye.command].apply(this,ye.args)}),this.stylesheet=$,this._updateMapProjection(),!0}addImage($,q){return this.getImage($)?this.fire(new j.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage($,q),this._afterImageUpdated($),this)}updateImage($,q){this.imageManager.updateImage($,q)}getImage($){return this.imageManager.getImage($)}removeImage($){return this.getImage($)?(this.imageManager.removeImage($),this._afterImageUpdated($),this):this.fire(new j.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated($){this._availableImages=this.imageManager.listImages(),this._changedImages[$]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new j.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource($,q,re={}){if(this._checkLoaded(),this.getSource($)!==void 0)throw new Error("There is already a source with this ID");if(!q.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(q).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(q.type)>=0&&this._validate(j.validateSource,`sources.${$}`,q,null,re))return;this.map&&this.map._collectResourceTiming&&(q.collectResourceTiming=!0);const ye=Lt($,q,this.dispatcher,this);ye.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded($),source:ye.serialize(),sourceId:$}));const be=Se=>{const Ie=(Se?"symbol:":"other:")+$,Re=this._sourceCaches[Ie]=new j.SourceCache(Ie,ye,Se);(Se?this._symbolSourceCaches:this._otherSourceCaches)[$]=Re,Re.style=this,Re.onAdd(this.map)};be(!1),q.type!=="vector"&&q.type!=="geojson"||be(!0),ye.onAdd&&ye.onAdd(this.map),this._changed=!0}removeSource($){this._checkLoaded();const q=this.getSource($);if(!q)throw new Error("There is no source with this ID");for(const ye in this._layers)if(this._layers[ye].source===$)return this.fire(new j.ErrorEvent(new Error(`Source "${$}" cannot be removed while layer "${ye}" is using it.`)));if(this.terrain&&this.terrain.get().source===$)return this.fire(new j.ErrorEvent(new Error(`Source "${$}" cannot be removed while terrain is using it.`)));const re=this._getSourceCaches($);for(const ye of re)delete this._sourceCaches[ye.id],delete this._updatedSources[ye.id],ye.fire(new j.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:ye.getSource().id})),ye.setEventedParent(null),ye.clearTiles();return delete this._otherSourceCaches[$],delete this._symbolSourceCaches[$],q.setEventedParent(null),q.onRemove&&q.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData($,q){this._checkLoaded(),this.getSource($).setData(q),this._changed=!0}getSource($){const q=this._getSourceCache($);return q&&q.getSource()}addLayer($,q,re={}){this._checkLoaded();const ye=$.id;if(this.getLayer(ye))return void this.fire(new j.ErrorEvent(new Error(`Layer with id "${ye}" already exists on this map`)));let be;if($.type==="custom"){if(La(this,j.validateCustomStyleLayer($)))return;be=j.createStyleLayer($)}else{if(typeof $.source=="object"&&(this.addSource(ye,$.source),$=j.clone$1($),$=j.extend($,{source:ye})),this._validate(j.validateLayer,`layers.${ye}`,$,{arrayIndex:-1},re))return;be=j.createStyleLayer($),this._validateLayer(be),be.setEventedParent(this,{layer:{id:ye}}),this._serializedLayers[be.id]=be.serialize(),this._updateLayerCount(be,!0)}const Se=q?this._order.indexOf(q):this._order.length;if(q&&Se===-1)return void this.fire(new j.ErrorEvent(new Error(`Layer with id "${q}" does not exist on this map.`)));this._order.splice(Se,0,ye),this._layerOrderChanged=!0,this._layers[ye]=be;const Ie=this._getLayerSourceCache(be);if(this._removedLayers[ye]&&be.source&&Ie&&be.type!=="custom"){const Re=this._removedLayers[ye];delete this._removedLayers[ye],Re.type!==be.type?this._updatedSources[be.source]="clear":(this._updatedSources[be.source]="reload",Ie.pause())}this._updateLayer(be),be.onAdd&&be.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer($,q){if(this._checkLoaded(),this._changed=!0,!this._layers[$])return void this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be moved.`)));if($===q)return;const re=this._order.indexOf($);this._order.splice(re,1);const ye=q?this._order.indexOf(q):this._order.length;q&&ye===-1?this.fire(new j.ErrorEvent(new Error(`Layer with id "${q}" does not exist on this map.`))):(this._order.splice(ye,0,$),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer($){this._checkLoaded();const q=this._layers[$];if(!q)return void this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be removed.`)));q.setEventedParent(null),this._updateLayerCount(q,!1);const re=this._order.indexOf($);this._order.splice(re,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[$]=q,delete this._layers[$],delete this._serializedLayers[$],delete this._updatedLayers[$],delete this._updatedPaintProps[$],q.onRemove&&q.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer($){return this._layers[$]}hasLayer($){return $ in this._layers}hasLayerType($){for(const q in this._layers)if(this._layers[q].type===$)return!0;return!1}setLayerZoomRange($,q,re){this._checkLoaded();const ye=this.getLayer($);ye?ye.minzoom===q&&ye.maxzoom===re||(q!=null&&(ye.minzoom=q),re!=null&&(ye.maxzoom=re),this._updateLayer(ye)):this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter($,q,re={}){this._checkLoaded();const ye=this.getLayer($);if(ye){if(!Ce(ye.filter,q))return q==null?(ye.filter=void 0,void this._updateLayer(ye)):void(this._validate(j.validateFilter,`layers.${ye.id}.filter`,q,{layerType:ye.type},re)||(ye.filter=j.clone$1(q),this._updateLayer(ye)))}else this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be filtered.`)))}getFilter($){const q=this.getLayer($);return q&&j.clone$1(q.filter)}setLayoutProperty($,q,re,ye={}){this._checkLoaded();const be=this.getLayer($);be?Ce(be.getLayoutProperty(q),re)||(be.setLayoutProperty(q,re,ye),this._updateLayer(be)):this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty($,q){const re=this.getLayer($);if(re)return re.getLayoutProperty(q);this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style.`)))}setPaintProperty($,q,re,ye={}){this._checkLoaded();const be=this.getLayer($);be?Ce(be.getPaintProperty(q),re)||(be.setPaintProperty(q,re,ye)&&this._updateLayer(be),this._changed=!0,this._updatedPaintProps[$]=!0):this.fire(new j.ErrorEvent(new Error(`The layer '${$}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty($,q){const re=this.getLayer($);return re&&re.getPaintProperty(q)}setFeatureState($,q){this._checkLoaded();const re=$.source,ye=$.sourceLayer,be=this.getSource(re);if(!be)return void this.fire(new j.ErrorEvent(new Error(`The source '${re}' does not exist in the map's style.`)));const Se=be.type;if(Se==="geojson"&&ye)return void this.fire(new j.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(Se==="vector"&&!ye)return void this.fire(new j.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));$.id===void 0&&this.fire(new j.ErrorEvent(new Error("The feature id parameter must be provided.")));const Ie=this._getSourceCaches(re);for(const Re of Ie)Re.setFeatureState(ye,$.id,q)}removeFeatureState($,q){this._checkLoaded();const re=$.source,ye=this.getSource(re);if(!ye)return void this.fire(new j.ErrorEvent(new Error(`The source '${re}' does not exist in the map's style.`)));const be=ye.type,Se=be==="vector"?$.sourceLayer:void 0;if(be==="vector"&&!Se)return void this.fire(new j.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(q&&typeof $.id!="string"&&typeof $.id!="number")return void this.fire(new j.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const Ie=this._getSourceCaches(re);for(const Re of Ie)Re.removeFeatureState(Se,$.id,q)}getFeatureState($){this._checkLoaded();const q=$.source,re=$.sourceLayer,ye=this.getSource(q);if(ye){if(ye.type!=="vector"||re)return $.id===void 0&&this.fire(new j.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(q)[0].getFeatureState(re,$.id);this.fire(new j.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new j.ErrorEvent(new Error(`The source '${q}' does not exist in the map's style.`)))}getTransition(){return j.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const $={};for(const q in this._sourceCaches){const re=this._sourceCaches[q].getSource();$[re.id]||($[re.id]=re.serialize())}return j.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:$,layers:this._serializeLayers(this._order)},q=>q!==void 0)}_updateLayer($){this._updatedLayers[$.id]=!0;const q=this._getLayerSourceCache($);$.source&&!this._updatedSources[$.source]&&q&&q.getSource().type!=="raster"&&(this._updatedSources[$.source]="reload",q.pause()),this._changed=!0,$.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures($){const q=Se=>this._layers[Se].type==="fill-extrusion",re={},ye=[];for(let Se=this._order.length-1;Se>=0;Se--){const Ie=this._order[Se];if(q(Ie)){re[Ie]=Se;for(const Re of $){const Fe=Re[Ie];if(Fe)for(const Ue of Fe)ye.push(Ue)}}}ye.sort((Se,Ie)=>Ie.intersectionZ-Se.intersectionZ);const be=[];for(let Se=this._order.length-1;Se>=0;Se--){const Ie=this._order[Se];if(q(Ie))for(let Re=ye.length-1;Re>=0;Re--){const Fe=ye[Re].feature;if(re[Fe.layer.id]<Se)break;be.push(Fe),ye.pop()}else for(const Re of $){const Fe=Re[Ie];if(Fe)for(const Ue of Fe)be.push(Ue.feature)}}return be}queryRenderedFeatures($,q,re){q&&q.filter&&this._validate(j.validateFilter,"queryRenderedFeatures.filter",q.filter,null,q);const ye={};if(q&&q.layers){if(!Array.isArray(q.layers))return this.fire(new j.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const Re of q.layers){const Fe=this._layers[Re];if(!Fe)return this.fire(new j.ErrorEvent(new Error(`The layer '${Re}' does not exist in the map's style and cannot be queried for features.`))),[];ye[Fe.source]=!0}}const be=[];q.availableImages=this._availableImages;const Se=q&&q.layers?q.layers.some(Re=>{const Fe=this.getLayer(Re);return Fe&&Fe.is3D()}):this.has3DLayers(),Ie=Wt.createFromScreenPoints($,re);for(const Re in this._sourceCaches){const Fe=this._sourceCaches[Re].getSource().id;q.layers&&!ye[Fe]||be.push(Sn(this._sourceCaches[Re],this._layers,this._serializedLayers,Ie,q,re,Se,!!this.map._showQueryGeometry))}return this.placement&&be.push(function(Re,Fe,Ue,Ze,Ye,rt,et){const tt={},nt=rt.queryRenderedSymbols(Ze),Qe=[];for(const lt of Object.keys(nt).map(Number))Qe.push(et[lt]);Qe.sort(Vn);for(const lt of Qe){const it=lt.featureIndex.lookupSymbolFeatures(nt[lt.bucketInstanceId],Fe,lt.bucketIndex,lt.sourceLayerIndex,Ye.filter,Ye.layers,Ye.availableImages,Re);for(const xt in it){const gt=tt[xt]=tt[xt]||[],dt=it[xt];dt.sort((vt,_t)=>{const St=lt.featureSortOrder;if(St){const Bt=St.indexOf(vt.featureIndex);return St.indexOf(_t.featureIndex)-Bt}return _t.featureIndex-vt.featureIndex});for(const vt of dt)gt.push(vt)}}for(const lt in tt)tt[lt].forEach(it=>{const xt=it.feature,gt=Ue(Re[lt]).getFeatureState(xt.layer["source-layer"],xt.id);xt.source=xt.layer.source,xt.layer["source-layer"]&&(xt.sourceLayer=xt.layer["source-layer"]),xt.state=gt});return tt}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),Ie.screenGeometry,q,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(be)}querySourceFeatures($,q){q&&q.filter&&this._validate(j.validateFilter,"querySourceFeatures.filter",q.filter,null,q);const re=this._getSourceCaches($);let ye=[];for(const be of re)ye=ye.concat(sn(be,q));return ye}addSourceType($,q,re){return Vi.getSourceType($)?re(new Error(`A source type called "${$}" already exists.`)):(Vi.setSourceType($,q),q.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:$,url:q.workerSourceURL},re):re(null,null))}getLight(){return this.light.getLight()}setLight($,q={}){this._checkLoaded();const re=this.light.getLight();let ye=!1;for(const Se in $)if(!Ce($[Se],re[Se])){ye=!0;break}if(!ye)return;const be=this._setTransitionParameters({duration:300,delay:0});this.light.setLight($,q),this.light.updateTransitions(be)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain($,q=1){if(this._checkLoaded(),!$)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(q===1){if(typeof $.source=="object"){const re="terrain-dem-src";this.addSource(re,$.source),$=j.clone$1($),$=j.extend($,{source:re})}if(this._validate(j.validateTerrain,"terrain",$))return}if(!this.terrain||this.terrain&&q!==this.terrain.drapeRenderMode)this._createTerrain($,q);else{const re=this.terrain,ye=re.get();for(const be of Object.keys(j.spec.terrain))!$.hasOwnProperty(be)&&j.spec.terrain[be].default&&($[be]=j.spec.terrain[be].default);for(const be in $)if(!Ce($[be],ye[be])){re.set($),this.stylesheet.terrain=$;const Se=this._setTransitionParameters({duration:0});re.updateTransitions(Se);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog($){const q=this.fog=new er($,this.map.transform);this.stylesheet.fog=$;const re=this._setTransitionParameters({duration:0});q.updateTransitions(re)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const $ of this.map._markers)$._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog($){if(this._checkLoaded(),!$)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const q=this.fog,re=q.get();Object.keys($).length===0&&q.set($);for(const ye in $)if(!Ce($[ye],re[ye])){q.set($),this.stylesheet.fog=$;const be=this._setTransitionParameters({duration:0});q.updateTransitions(be);break}}else this._createFog($);this._markersNeedUpdate=!0}_setTransitionParameters($){return{now:j.exported.now(),transition:j.extend($,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const $=this._order.filter(re=>this.isLayerDraped(this._layers[re])),q=this._order.filter(re=>!this.isLayerDraped(this._layers[re]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...$),this._drapedFirstOrder.push(...q)}_createTerrain($,q){const re=this.terrain=new Ln($,q);this.stylesheet.terrain=$,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const ye=this._setTransitionParameters({duration:0});re.updateTransitions(ye)}_force3DLayerUpdate(){for(const $ in this._layers){const q=this._layers[$];q.type==="fill-extrusion"&&this._updateLayer(q)}}_forceSymbolLayerUpdate(){for(const $ in this._layers){const q=this._layers[$];q.type==="symbol"&&this._updateLayer(q)}}_validate($,q,re,ye,be={}){return(!be||be.validate!==!1)&&La(this,$.call(j.validateStyle,j.extend({key:q,style:this.serialize(),value:re,styleSpec:j.spec},ye)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),j.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const $ in this._layers)this._layers[$].setEventedParent(null);for(const $ in this._sourceCaches)this._sourceCaches[$].clearTiles(),this._sourceCaches[$].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource($){const q=this._getSourceCaches($);for(const re of q)re.clearTiles()}_reloadSource($){const q=this._getSourceCaches($);for(const re of q)re.resume(),re.reload()}_updateSources($){for(const q in this._sourceCaches)this._sourceCaches[q].update($)}_generateCollisionBoxes(){for(const $ in this._sourceCaches){const q=this._sourceCaches[$];q.resume(),q.reload()}}_updatePlacement($,q,re,ye,be=!1){let Se=!1,Ie=!1;const Re={};for(const Fe of this._order){const Ue=this._layers[Fe];if(Ue.type!=="symbol")continue;if(!Re[Ue.source]){const Ye=this._getLayerSourceCache(Ue);if(!Ye)continue;Re[Ue.source]=Ye.getRenderableIds(!0).map(rt=>Ye.getTileByID(rt)).sort((rt,et)=>et.tileID.overscaledZ-rt.tileID.overscaledZ||(rt.tileID.isLessThan(et.tileID)?-1:1))}const Ze=this.crossTileSymbolIndex.addLayer(Ue,Re[Ue.source],$.center.lng,$.projection);Se=Se||Ze}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),be=be||this._layerOrderChanged||re===0,this._layerOrderChanged&&this.fire(new j.Event("neworder")),(be||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(j.exported.now(),$.zoom))&&(this.pauseablePlacement=new Mo($,this._order,be,q,re,ye,this.placement,this.fog&&$.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Re),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(j.exported.now()),Ie=!0),Se&&this.pauseablePlacement.placement.setStale()),Ie||Se)for(const Fe of this._order){const Ue=this._layers[Fe];Ue.type==="symbol"&&this.placement.updateLayerOpacities(Ue,Re[Ue.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(j.exported.now())}_releaseSymbolFadeTiles(){for(const $ in this._sourceCaches)this._sourceCaches[$].releaseSymbolFadeTiles()}getImages($,q,re){this.imageManager.getImages(q.icons,re),this._updateTilesForChangedImages();const ye=be=>{be&&be.setDependencies(q.tileID.key,q.type,q.icons)};ye(this._otherSourceCaches[q.source]),ye(this._symbolSourceCaches[q.source])}getGlyphs($,q,re){this.glyphManager.getGlyphs(q.stacks,re)}getResource($,q,re){return j.makeRequest(q,re)}_getSourceCache($){return this._otherSourceCaches[$]}_getLayerSourceCache($){return $.type==="symbol"?this._symbolSourceCaches[$.source]:this._otherSourceCaches[$.source]}_getSourceCaches($){const q=[];return this._otherSourceCaches[$]&&q.push(this._otherSourceCaches[$]),this._symbolSourceCaches[$]&&q.push(this._symbolSourceCaches[$]),q}_isSourceCacheLoaded($){const q=this._getSourceCaches($);return q.length===0?(this.fire(new j.ErrorEvent(new Error(`There is no source with ID '${$}'`))),!1):q.every(re=>re.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Vi.getSourceType=function(te){return Et[te]},Vi.setSourceType=function(te,$){Et[te]=$},Vi.registerForPluginStateChange=j.registerForPluginStateChange;var Dl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ll="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ol=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ds=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Ba={},qo={};const Po=[];Zo(Dl,Po),Zo(Bl,Po),Zo(Ol,Po),Zo(ds,Po),Ba=Ar("",Bl),qo=Ar(ds,Ol);const Zs=Ar(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Oa=Dl,Fa=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Ua={background:Ar(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ar(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ar(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ar("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ar(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ar("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ar("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ar(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ar(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ar(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ar(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ar(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ar(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ar(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ar(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ar(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ar(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ar(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ar(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ar(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ar(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ar(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ar(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ll),skyboxGradient:Ar(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ll),skyboxCapture:Ar(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ar(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ar(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Zo(te,$){const q=te.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let re of q)if(re=re.trim(),re[0]==="#"&&re.includes("if")&&!re.includes("endif")){re=re.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const ye=re.split(" ");for(const be of ye)$.includes(be)||$.push(be)}}function Ar(te,$){const q=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,re=$.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),ye={},be=[...Po];return Zo(te,be),Zo($,be),{fragmentSource:te=te.replace(q,(Se,Ie,Re,Fe,Ue)=>(ye[Ue]=!0,Ie==="define"?`
#ifndef HAS_UNIFORM_u_${Ue}
varying ${Re} ${Fe} ${Ue};
#else
uniform ${Re} ${Fe} u_${Ue};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Ue}
    ${Re} ${Fe} ${Ue} = u_${Ue};
#endif
`)),vertexSource:$=$.replace(q,(Se,Ie,Re,Fe,Ue)=>{const Ze=Fe==="float"?"vec2":"vec4",Ye=Ue.match(/color/)?"color":Ze;return ye[Ue]?Ie==="define"?`
#ifndef HAS_UNIFORM_u_${Ue}
uniform lowp float u_${Ue}_t;
attribute ${Re} ${Ze} a_${Ue};
varying ${Re} ${Fe} ${Ue};
#else
uniform ${Re} ${Fe} u_${Ue};
#endif
`:Ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ue}
    ${Ue} = a_${Ue};
#else
    ${Re} ${Fe} ${Ue} = u_${Ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ue}
    ${Ue} = unpack_mix_${Ye}(a_${Ue}, u_${Ue}_t);
#else
    ${Re} ${Fe} ${Ue} = u_${Ue};
#endif
`:Ie==="define"?`
#ifndef HAS_UNIFORM_u_${Ue}
uniform lowp float u_${Ue}_t;
attribute ${Re} ${Ze} a_${Ue};
#else
uniform ${Re} ${Fe} u_${Ue};
#endif
`:Ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ue}
    ${Re} ${Fe} ${Ue} = a_${Ue};
#else
    ${Re} ${Fe} ${Ue} = u_${Ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ue}
    ${Re} ${Fe} ${Ue} = unpack_mix_${Ye}(a_${Ue}, u_${Ue}_t);
#else
    ${Re} ${Fe} ${Ue} = u_${Ue};
#endif
`}),staticAttributes:re,usedDefines:be}}class $a{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind($,q,re,ye,be,Se,Ie){this.context=$;let Re=this.boundPaintVertexBuffers.length!==ye.length;for(let Ue=0;!Re&&Ue<ye.length;Ue++)this.boundPaintVertexBuffers[Ue]!==ye[Ue]&&(Re=!0);let Fe=this.boundDynamicVertexBuffers.length!==Ie.length;for(let Ue=0;!Fe&&Ue<Ie.length;Ue++)this.boundDynamicVertexBuffers[Ue]!==Ie[Ue]&&(Fe=!0);if(!$.extVertexArrayObject||!this.vao||this.boundProgram!==q||this.boundLayoutVertexBuffer!==re||Re||Fe||this.boundIndexBuffer!==be||this.boundVertexOffset!==Se)this.freshBind(q,re,ye,be,Se,Ie);else{$.bindVertexArrayOES.set(this.vao);for(const Ue of Ie)Ue&&Ue.bind();be&&be.dynamicDraw&&be.bind()}}freshBind($,q,re,ye,be,Se){let Ie;const Re=$.numAttributes,Fe=this.context,Ue=Fe.gl;if(Fe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Fe.extVertexArrayObject.createVertexArrayOES(),Fe.bindVertexArrayOES.set(this.vao),Ie=0,this.boundProgram=$,this.boundLayoutVertexBuffer=q,this.boundPaintVertexBuffers=re,this.boundIndexBuffer=ye,this.boundVertexOffset=be,this.boundDynamicVertexBuffers=Se;else{Ie=Fe.currentNumAttributes||0;for(let Ze=Re;Ze<Ie;Ze++)Ue.disableVertexAttribArray(Ze)}q.enableAttributes(Ue,$),q.bind(),q.setVertexAttribPointers(Ue,$,be);for(const Ze of re)Ze.enableAttributes(Ue,$),Ze.bind(),Ze.setVertexAttribPointers(Ue,$,be);for(const Ze of Se)Ze&&(Ze.enableAttributes(Ue,$),Ze.bind(),Ze.setVertexAttribPointers(Ue,$,be));ye&&ye.bind(),Fe.currentNumAttributes=Re}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Fl(te,$){const q=Math.pow(2,$.canonical.z),re=$.canonical.y;return[new j.MercatorCoordinate(0,re/q).toLngLat().lat,new j.MercatorCoordinate(0,(re+1)/q).toLngLat().lat]}function Ul(te,$,q,re,ye,be,Se){const Ie=te.context,Re=Ie.gl,Fe=q.fbo;if(!Fe)return;te.prepareDrawTile();const Ue=te.useProgram("hillshade");Ie.activeTexture.set(Re.TEXTURE0),Re.bindTexture(Re.TEXTURE_2D,Fe.colorAttachment.get());const Ze=((tt,nt,Qe,lt)=>{const it=Qe.paint.get("hillshade-shadow-color"),xt=Qe.paint.get("hillshade-highlight-color"),gt=Qe.paint.get("hillshade-accent-color");let dt=Qe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Qe.paint.get("hillshade-illumination-anchor")==="viewport"&&(dt-=tt.transform.angle);const vt=!tt.options.moving;return{u_matrix:lt||tt.transform.calculateProjMatrix(nt.tileID.toUnwrapped(),vt),u_image:0,u_latrange:Fl(0,nt.tileID),u_light:[Qe.paint.get("hillshade-exaggeration"),dt],u_shadow:it,u_highlight:xt,u_accent:gt}})(te,q,re,te.terrain?$.projMatrix:null);te.prepareDrawProgram(Ie,Ue,$.toUnwrapped());const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:rt,tileBoundsSegments:et}=te.getTileBoundsBuffers(q);Ue.draw(Ie,Re.TRIANGLES,ye,be,Se,j.CullFaceMode.disabled,Ze,re.id,Ye,rt,et)}function wr(te,$,q){if(!$.needsDEMTextureUpload)return;const re=te.context,ye=re.gl;re.pixelStoreUnpackPremultiplyAlpha.set(!1),$.demTexture=$.demTexture||te.getTileTexture(q.stride);const be=q.getPixels();$.demTexture?$.demTexture.update(be,{premultiply:!1}):$.demTexture=new j.Texture(re,be,ye.RGBA,{premultiply:!1}),$.needsDEMTextureUpload=!1}function ps(te,$,q,re,ye,be){const Se=te.context,Ie=Se.gl;if(!$.dem)return;const Re=$.dem;if(Se.activeTexture.set(Ie.TEXTURE1),wr(te,$,Re),!$.demTexture)return;$.demTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const Fe=Re.dim;Se.activeTexture.set(Ie.TEXTURE0);let Ue=$.fbo;if(!Ue){const et=new j.Texture(Se,{width:Fe,height:Fe,data:null},Ie.RGBA);et.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Ue=$.fbo=Se.createFramebuffer(Fe,Fe,!0),Ue.colorAttachment.set(et.texture)}Se.bindFramebuffer.set(Ue.framebuffer),Se.viewport.set([0,0,Fe,Fe]);const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:Ye,tileBoundsSegments:rt}=te.getMercatorTileBoundsBuffers();te.useProgram("hillshadePrepare").draw(Se,Ie.TRIANGLES,re,ye,be,j.CullFaceMode.disabled,((et,tt)=>{const nt=tt.stride,Qe=j.create();return j.ortho(Qe,0,j.EXTENT,-j.EXTENT,0,0,1),j.translate(Qe,Qe,[0,-j.EXTENT,0]),{u_matrix:Qe,u_image:1,u_dimension:[nt,nt],u_zoom:et.overscaledZ,u_unpack:tt.unpackVector}})($.tileID,Re),q.id,Ze,Ye,rt),$.needsHillshadePrepare=!1}const Hs=te=>({u_matrix:new j.UniformMatrix4f(te),u_image0:new j.Uniform1i(te),u_skirt_height:new j.Uniform1f(te)}),$l=(te,$)=>({u_matrix:te,u_image0:0,u_skirt_height:$}),Nl=(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt)=>({u_proj_matrix:Float32Array.from(te),u_globe_matrix:$,u_normalize_matrix:Float32Array.from(re),u_merc_matrix:q,u_zoom_transition:ye,u_merc_center:be,u_image0:0,u_frustum_tl:Se,u_frustum_tr:Ie,u_frustum_br:Re,u_frustum_bl:Fe,u_globe_pos:Ue,u_globe_radius:Ze,u_viewport:Ye,u_grid_matrix:rt?Float32Array.from(rt):new Float32Array(9)});function jl(te,$){return te!=null&&$!=null&&!(!te.hasData()||!$.hasData())&&te.demTexture!=null&&$.demTexture!=null&&te.tileID.key!==$.tileID.key}const ko=new class{constructor(){this.operations={}}newMorphing(te,$,q,re,ye){if(te in this.operations){const be=this.operations[te];be.to.tileID.key!==q.tileID.key&&(be.queued=q)}else this.operations[te]={startTime:re,phase:0,duration:ye,from:$,to:q,queued:null}}getMorphValuesForProxy(te){if(!(te in this.operations))return null;const $=this.operations[te];return{from:$.from,to:$.to,phase:$.phase}}update(te){for(const $ in this.operations){const q=this.operations[$];for(q.phase=(te-q.startTime)/q.duration;q.phase>=1||!this._validOp(q);)if(!this._nextOp(q,te)){delete this.operations[$];break}}}_nextOp(te,$){return!!te.queued&&(te.from=te.to,te.to=te.queued,te.queued=null,te.phase=0,te.startTime=$,!0)}_validOp(te){return te.from.hasData()&&te.to.hasData()}},Ws={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Oh(te,$){const q=1<<te.z;return!$&&(te.x===0||te.x===q-1)||te.y===0||te.y===q-1}const Vl=te=>({u_matrix:te});function Na(te,$,q,re,ye){if(ye>0){const be=j.exported.now(),Se=(be-te.timeAdded)/ye,Ie=$?(be-$.timeAdded)/ye:-1,Re=q.getSource(),Fe=re.coveringZoomLevel({tileSize:Re.tileSize,roundZoom:Re.roundZoom}),Ue=!$||Math.abs($.tileID.overscaledZ-Fe)>Math.abs(te.tileID.overscaledZ-Fe),Ze=Ue&&te.refreshedUponExpiration?1:j.clamp(Ue?Se:1-Ie,0,1);return te.refreshedUponExpiration&&Se>=1&&(te.refreshedUponExpiration=!1),$?{opacity:1,mix:1-Ze}:{opacity:Ze,mix:0}}return{opacity:1,mix:0}}class Gl extends j.SourceCache{constructor($){const q={type:"raster-dem",maxzoom:$.transform.maxZoom},re=new rr(kr(),null),ye=Lt("mock-dem",q,re,$.style);super("mock-dem",ye,!1),ye.setEventedParent(this),this._sourceLoaded=!0}_loadTile($,q){$.state="loaded",q(null)}}class ql extends j.SourceCache{constructor($){const q=Lt("proxy",{type:"geojson",maxzoom:$.transform.maxZoom},new rr(kr(),null),$.style);super("proxy",q,!1),q.setEventedParent(this),this.map=this.getSource().map=$,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update($,q,re){if($.freezeTileCoverage)return;this.transform=$;const ye=$.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((be,Se)=>{if(be[Se.key]="",!this._tiles[Se.key]){const Ie=new j.Tile(Se,this._source.tileSize*Se.overscaleFactor(),$.tileZoom);Ie.state="loaded",this._tiles[Se.key]=Ie}return be},{});for(const be in this._tiles)be in ye||(this.freeFBO(be),this._tiles[be].unloadVectorData(),delete this._tiles[be])}freeFBO($){const q=this.proxyCachedFBO[$];if(q!==void 0){const re=Object.values(q);this.renderCachePool.push(...re),delete this.proxyCachedFBO[$]}}deallocRenderCache(){this.renderCache.forEach($=>$.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ja extends j.OverscaledTileID{constructor($,q,re){super($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y),this.proxyTileKey=q,this.projMatrix=re}}class ou extends j.Elevation{constructor($,q){super(),this.painter=$,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[re,ye,be]=function(Re){const Fe=new j.StructArrayLayout4i8,Ue=new j.StructArrayLayout3ui6,Ze=131;Fe.reserve(17161),Ue.reserve(33800);const Ye=j.EXTENT/128,rt=j.EXTENT+Ye/2,et=rt+Ye;for(let nt=-Ye;nt<et;nt+=Ye)for(let Qe=-Ye;Qe<et;Qe+=Ye){const lt=Qe<0||Qe>rt||nt<0||nt>rt?24575:0,it=j.clamp(Math.round(Qe),0,j.EXTENT),xt=j.clamp(Math.round(nt),0,j.EXTENT);Fe.emplaceBack(it+lt,xt,it,xt)}const tt=(nt,Qe)=>{const lt=Qe*Ze+nt;Ue.emplaceBack(lt+1,lt,lt+Ze),Ue.emplaceBack(lt+Ze,lt+Ze+1,lt+1)};for(let nt=1;nt<129;nt++)for(let Qe=1;Qe<129;Qe++)tt(Qe,nt);return[0,129].forEach(nt=>{for(let Qe=0;Qe<130;Qe++)tt(Qe,nt),tt(nt,Qe)}),[Fe,Ue,32768]}(),Se=$.context;this.gridBuffer=Se.createVertexBuffer(re,j.boundsAttributes.members),this.gridIndexBuffer=Se.createIndexBuffer(ye),this.gridSegments=j.SegmentVector.simpleSegment(0,0,re.length,ye.length),this.gridNoSkirtSegments=j.SegmentVector.simpleSegment(0,0,re.length,be),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ql(q.map),this.orthoMatrix=j.create(),j.ortho(this.orthoMatrix,0,j.EXTENT,0,j.EXTENT,0,1);const Ie=Se.gl;this._overlapStencilMode=new j.StencilMode({func:Ie.GEQUAL,mask:255},0,255,Ie.KEEP,Ie.KEEP,Ie.REPLACE),this._previousZoom=$.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=q,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gl(q.map)}set style($){$.on("data",this._onStyleDataEvent.bind(this)),$.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=$,this._checkRenderCacheEfficiency()}update($,q,re){if($&&$.terrain){this._style!==$&&(this.style=$),this.enabled=!0;const ye=$.terrain.properties;this.sourceCache=$.terrain.drapeRenderMode===0?this._mockSourceCache:$._getSourceCache(ye.get("source")),this._exaggeration=ye.get("exaggeration");const be=()=>{this.sourceCache.used&&j.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Se=this.getScaledDemTileSize();this.sourceCache.update(q,Se,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,be(),this._initializing=!0),be(),q.updateElevation(!re),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(q),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache($){this._findCoveringTileCache[$]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const $=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||$.efficiency!==100&&j.warnOnce(`Terrain render cache efficiency is not optimal (${$.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${$.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent($){$.coord&&$.dataType==="source"?this._clearRenderCacheForTile($.sourceCacheId,$.coord):$.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const $ in this._style._sourceCaches)this._style._sourceCaches[$].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach($=>$.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const $=2*this.proxySourceCache.getSource().tileSize;return[$,$]}set useVertexMorphing($){this._useVertexMorphing=$}updateTileBinding($){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const q=this.proxySourceCache,re=this.painter.transform;this._initializing&&(this._initializing=re._centerAltitude===0&&this.getAtPointOrZero(j.MercatorCoordinate.fromLngLat(re.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const ye=this.proxyCoords=q.getIds().map(Re=>{const Fe=q.getTileByID(Re).tileID;return Fe.projMatrix=re.calculateProjMatrix(Fe.toUnwrapped()),Fe});(function(Re,Fe){const Ue=Fe.transform.pointCoordinate(Fe.transform.getCameraPoint()),Ze=new j.pointGeometry(Ue.x,Ue.y);Re.sort((Ye,rt)=>{if(rt.overscaledZ-Ye.overscaledZ)return rt.overscaledZ-Ye.overscaledZ;const et=new j.pointGeometry(Ye.canonical.x+(1<<Ye.canonical.z)*Ye.wrap,Ye.canonical.y),tt=new j.pointGeometry(rt.canonical.x+(1<<rt.canonical.z)*rt.wrap,rt.canonical.y),nt=Ze.mult(1<<Ye.canonical.z);return nt.x-=.5,nt.y-=.5,nt.distSqr(et)-nt.distSqr(tt)})})(ye,this.painter),this._previousZoom=re.zoom;const be=this.proxyToSource||{};this.proxyToSource={},ye.forEach(Re=>{this.proxyToSource[Re.key]={}}),this.terrainTileForTile={};const Se=this._style._sourceCaches;for(const Re in Se){const Fe=Se[Re];if(!Fe.used||(Fe!==this.sourceCache&&this.resetTileLookupCache(Fe.id),this._setupProxiedCoordsForOrtho(Fe,$[Re],be),Fe.usedForTerrain))continue;const Ue=$[Re];Fe.getSource().reparseOverscaled&&this._assignTerrainTiles(Ue)}this.proxiedCoords[q.id]=ye.map(Re=>new ja(Re,Re.key,this.orthoMatrix)),this._assignTerrainTiles(ye),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(be),this.renderingToTexture=!1,this._updateTimestamp=j.exported.now();const Ie={};this._visibleDemTiles=[];for(const Re of this.proxyCoords){const Fe=this.terrainTileForTile[Re.key];if(!Fe)continue;const Ue=Fe.tileID.key;Ue in Ie||(this._visibleDemTiles.push(Fe),Ie[Ue]=Ue)}}_assignTerrainTiles($){this._initializing||$.forEach(q=>{if(this.terrainTileForTile[q.key])return;const re=this._findTileCoveringTileID(q,this.sourceCache);re&&(this.terrainTileForTile[q.key]=re)})}_prepareDEMTextures(){const $=this.painter.context,q=$.gl;for(const re in this.terrainTileForTile){const ye=this.terrainTileForTile[re],be=ye.dem;!be||ye.demTexture&&!ye.needsDEMTextureUpload||($.activeTexture.set(q.TEXTURE1),wr(this.painter,ye,be))}}_prepareDemTileUniforms($,q,re,ye){if(!q||q.demTexture==null)return!1;const be=$.tileID.canonical,Se=Math.pow(2,q.tileID.canonical.z-be.z),Ie=ye||"";return re[`u_dem_tl${Ie}`]=[be.x*Se%1,be.y*Se%1],re[`u_dem_scale${Ie}`]=Se,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const $=this.painter.context,q=$.gl;if(!this._emptyDepthBufferTexture){const re=new j.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new j.Texture($,re,q.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let $=0;const q=this._visibleDemTiles.reduce((re,ye)=>{if(!ye.dem)return re;const be=ye.dem.tree.minimums[0];return be>0&&$++,re+be},0);return $?q/$:0}_updateEmptyDEMTexture(){const $=this.painter.context,q=$.gl;$.activeTexture.set(q.TEXTURE2);const re=this._getLoadedAreaMinimum(),ye=new j.RGBAImage({width:1,height:1},new Uint8Array(j.DEMData.pack(re,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let be=this._emptyDEMTexture;return be?be.update(ye,{premultiply:!1}):be=this._emptyDEMTexture=new j.Texture($,ye,q.RGBA,{premultiply:!1}),be}setupElevationDraw($,q,re){const ye=this.painter.context,be=ye.gl,Se=(Ie=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:j.DEMData.getUnpackVector(Ie),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var Ie;Se.u_dem_size=this.sourceCache.getSource().tileSize,Se.u_exaggeration=this.exaggeration();const Re=this.painter.transform,Fe=Re.projection,Ue=$.tileID.canonical;Se.u_tile_tl_up=Fe.upVector(Ue,0,0),Se.u_tile_tr_up=Fe.upVector(Ue,j.EXTENT,0),Se.u_tile_br_up=Fe.upVector(Ue,j.EXTENT,j.EXTENT),Se.u_tile_bl_up=Fe.upVector(Ue,0,j.EXTENT),Se.u_tile_up_scale=re&&re.useDenormalizedUpVectorScale?j.GLOBE_METERS_TO_ECEF:Fe.upVectorScale(Ue,Re.center.lat,Re.worldSize).metersToTile;let Ze=null,Ye=null,rt=1;if(re&&re.morphing&&this._useVertexMorphing){const et=re.morphing.srcDemTile,tt=re.morphing.dstDemTile;rt=re.morphing.phase,et&&tt&&(this._prepareDemTileUniforms($,et,Se,"_prev")&&(Ye=et),this._prepareDemTileUniforms($,tt,Se)&&(Ze=tt))}if(Ye&&Ze?(ye.activeTexture.set(be.TEXTURE2),Ze.demTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE,be.NEAREST),ye.activeTexture.set(be.TEXTURE4),Ye.demTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE,be.NEAREST),Se.u_dem_lerp=rt):(Ze=this.terrainTileForTile[$.tileID.key],ye.activeTexture.set(be.TEXTURE2),(this._prepareDemTileUniforms($,Ze,Se)?Ze.demTexture:this.emptyDEMTexture).bind(be.NEAREST,be.CLAMP_TO_EDGE)),ye.activeTexture.set(be.TEXTURE3),re&&re.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE),this._depthFBO&&(Se.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE),Se.u_depth_size_inv=[1,1]),re&&re.useMeterToDem&&Ze){const et=(1<<Ze.tileID.canonical.z)*j.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;Se.u_meter_to_dem=et}re&&re.labelPlaneMatrixInv&&(Se.u_label_plane_matrix_inv=re.labelPlaneMatrixInv),q.setTerrainUniformValues(ye,Se)}renderToBackBuffer($){const q=this.painter,re=this.painter.context;$.length!==0&&(re.bindFramebuffer.set(null),re.viewport.set([0,0,q.width,q.height]),q.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ye,be,Se,Ie,Re){if(ye.transform.projection.name==="globe")(function(Fe,Ue,Ze,Ye,rt){const et=Fe.context,tt=et.gl;let nt,Qe;const lt=Fe.options.showTerrainWireframe?2:0,it=Fe.transform,xt=j.globeUseCustomAntiAliasing(Fe,et,it),gt=(gn,jt)=>{if(Qe===gn)return;const dn=[Ws[gn],"PROJECTION_GLOBE_VIEW"];xt&&dn.push("CUSTOM_ANTIALIASING"),jt&&dn.push(Ws[lt]),nt=Fe.useProgram("globeRaster",null,dn),Qe=gn},dt=Fe.colorModeForRenderPass(),vt=new j.DepthMode(tt.LEQUAL,j.DepthMode.ReadWrite,Fe.depthRangeFor3D);ko.update(rt);const _t=j.calculateGlobeMercatorMatrix(it),St=[j.mercatorXfromLng(it.center.lng),j.mercatorYfromLat(it.center.lat)],Bt=lt?[!1,!0]:[!1],un=Fe.globeSharedBuffers,Rt=[it.width*j.exported.devicePixelRatio,it.height*j.exported.devicePixelRatio],Xt=Float32Array.from(it.globeMatrix),Qt={useDenormalizedUpVectorScale:!0};if(Bt.forEach(gn=>{Qe=-1;const jt=gn?tt.LINES:tt.TRIANGLES;for(const dn of Ye){const Jt=Ze.getTile(dn),wn=j.StencilMode.disabled,xn=Ue.prevTerrainTileForTile[dn.key],zn=Ue.terrainTileForTile[dn.key];jl(xn,zn)&&ko.newMorphing(dn.key,xn,zn,rt,250),et.activeTexture.set(tt.TEXTURE0),Jt.texture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE);const $n=ko.getMorphValuesForProxy(dn.key),Wn=$n?1:0;$n&&j.extend$1(Qt,{morphing:{srcDemTile:$n.from,dstDemTile:$n.to,phase:j.easeCubicInOut($n.phase)}});const fr=j.tileCornersToBounds(dn.canonical),Dn=j.getLatitudinalLod(fr.getCenter().lat),Qn=j.getGridMatrix(dn.canonical,fr,Dn),Tr=j.globeNormalizeECEF(j.globeTileBounds(dn.canonical)),Gr=Nl(it.projMatrix,Xt,_t,Tr,j.globeToMercatorTransition(it.zoom),St,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Rt,Qn);if(gt(Wn,gn),Ue.setupElevationDraw(Jt,nt,Qt),Fe.prepareDrawProgram(et,nt,dn.toUnwrapped()),un){const[ei,Dr,pi]=gn?un.getWirefameBuffers(Fe.context,Dn):un.getGridBuffers(Dn);nt.draw(et,jt,vt,wn,dt,j.CullFaceMode.backCCW,Gr,"globe_raster",ei,Dr,pi)}}}),un){const gn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xt&&gn.push("CUSTOM_ANTIALIASING"),nt=Fe.useProgram("globeRaster",null,gn);for(const jt of Ye){const{x:dn,y:Jt,z:wn}=jt.canonical,xn=Jt===0,zn=Jt===(1<<wn)-1,[$n,Wn,fr,Dn]=un.getPoleBuffers(wn);if(Dn&&(xn||zn)){const Qn=Ze.getTile(jt);et.activeTexture.set(tt.TEXTURE0),Qn.texture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE);let Tr=j.globePoleMatrixForTile(wn,dn,it);const Gr=j.globeNormalizeECEF(j.globeTileBounds(jt.canonical)),ei=(Dr,pi)=>Dr.draw(et,tt.TRIANGLES,vt,j.StencilMode.disabled,dt,j.CullFaceMode.disabled,Nl(it.projMatrix,Tr,Tr,Gr,0,St,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Rt),"globe_pole_raster",pi,fr,Dn);Ue.setupElevationDraw(Qn,nt,Qt),Fe.prepareDrawProgram(et,nt,jt.toUnwrapped()),xn&&ei(nt,$n),zn&&(Tr=j.scale(j.create(),Tr,[1,-1,1]),ei(nt,Wn))}}}})(ye,be,Se,Ie,Re);else{const Fe=ye.context,Ue=Fe.gl;let Ze,Ye;const rt=ye.options.showTerrainWireframe?2:0,et=(it,xt)=>{if(Ye===it)return;const gt=[Ws[it]];xt&&gt.push(Ws[rt]),Ze=ye.useProgram("terrainRaster",null,gt),Ye=it},tt=ye.colorModeForRenderPass(),nt=new j.DepthMode(Ue.LEQUAL,j.DepthMode.ReadWrite,ye.depthRangeFor3D);ko.update(Re);const Qe=ye.transform,lt=6*Math.pow(1.5,22-Qe.zoom)*be.exaggeration();(rt?[!1,!0]:[!1]).forEach(it=>{Ye=-1;const xt=it?Ue.LINES:Ue.TRIANGLES,[gt,dt]=it?be.getWirefameBuffer():[be.gridIndexBuffer,be.gridSegments];for(const vt of Ie){const _t=Se.getTile(vt),St=j.StencilMode.disabled,Bt=be.prevTerrainTileForTile[vt.key],un=be.terrainTileForTile[vt.key];jl(Bt,un)&&ko.newMorphing(vt.key,Bt,un,Re,250),Fe.activeTexture.set(Ue.TEXTURE0),_t.texture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE,Ue.LINEAR_MIPMAP_NEAREST);const Rt=ko.getMorphValuesForProxy(vt.key),Xt=Rt?1:0;let Qt;Rt&&(Qt={morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:j.easeCubicInOut(Rt.phase)}});const gn=$l(vt.projMatrix,Oh(vt.canonical,Qe.renderWorldCopies)?lt/10:lt);et(Xt,it),be.setupElevationDraw(_t,Ze,Qt),ye.prepareDrawProgram(Fe,Ze,vt.toUnwrapped()),Ze.draw(Fe,xt,nt,St,tt,j.CullFaceMode.backCCW,gn,"terrain_raster",be.gridBuffer,gt,dt)}})}}(q,this,this.proxySourceCache,$,this._updateTimestamp),this.renderingToTexture=!0,q.gpuTimingDeferredRenderEnd(),$.splice(0,$.length))}renderBatch($){if(this._drapedRenderBatches.length===0)return $+1;this.renderingToTexture=!0;const q=this.painter,re=this.painter.context,ye=this.proxySourceCache,be=this.proxiedCoords[ye.id],Se=this._drapedRenderBatches.shift(),Ie=[],Re=q.style.order;let Fe=0;for(const Ue of be){const Ze=ye.getTileByID(Ue.proxyTileKey),Ye=ye.proxyCachedFBO[Ue.key]?ye.proxyCachedFBO[Ue.key][$]:void 0,rt=Ye!==void 0?ye.renderCache[Ye]:this.pool[Fe++],et=Ye!==void 0;if(Ze.texture=rt.tex,et&&!rt.dirty){Ie.push(Ze.tileID);continue}let tt;re.bindFramebuffer.set(rt.fb.framebuffer),this.renderedToTile=!1,rt.dirty&&(re.clear({color:j.Color.transparent,stencil:0}),rt.dirty=!1);for(let nt=Se.start;nt<=Se.end;++nt){const Qe=q.style._layers[Re[nt]];if(Qe.isHidden(q.transform.zoom))continue;const lt=q.style._getLayerSourceCache(Qe),it=lt?this.proxyToSource[Ue.key][lt.id]:[Ue];if(!it)continue;const xt=it;re.viewport.set([0,0,rt.fb.width,rt.fb.height]),tt!==(lt?lt.id:null)&&(this._setupStencil(rt,it,Qe,lt),tt=lt?lt.id:null),q.renderLayer(q,lt,Qe,xt)}this.renderedToTile?(rt.dirty=!0,Ie.push(Ze.tileID)):et||--Fe,Fe===5&&(Fe=0,this.renderToBackBuffer(Ie))}return this.renderToBackBuffer(Ie),this.renderingToTexture=!1,re.bindFramebuffer.set(null),re.viewport.set([0,0,q.width,q.height]),Se.end+1}postRender(){}renderCacheEfficiency($){const q=$.order.length;if(q===0)return{efficiency:100};let re,ye=0,be=0,Se=!1;for(let Ie=0;Ie<q;++Ie){const Re=$._layers[$.order[Ie]];this._style.isLayerDraped(Re)?(Se&&++ye,++be):Se||(Se=!0,re=Re.id)}return be===0?{efficiency:100}:{efficiency:100*(1-ye/be),firstUndrapedLayer:re}}getMinElevationBelowMSL(){let $=0;return this._visibleDemTiles.filter(q=>q.dem).forEach(q=>{$=Math.min($,q.dem.tree.minimums[0])}),$===0?$:($-30)*this._exaggeration}raycast($,q,re){if(!this._visibleDemTiles)return null;const ye=this._visibleDemTiles.filter(be=>be.dem).map(be=>{const Se=be.tileID,Ie=1<<Se.overscaledZ,{x:Re,y:Fe}=Se.canonical,Ue=Re/Ie,Ze=(Re+1)/Ie,Ye=Fe/Ie,rt=(Fe+1)/Ie;return{minx:Ue,miny:Ye,maxx:Ze,maxy:rt,t:be.dem.tree.raycastRoot(Ue,Ye,Ze,rt,$,q,re),tile:be}});ye.sort((be,Se)=>(be.t!==null?be.t:Number.MAX_VALUE)-(Se.t!==null?Se.t:Number.MAX_VALUE));for(const be of ye){if(be.t==null)return null;const Se=be.tile.dem.tree.raycast(be.minx,be.miny,be.maxx,be.maxy,$,q,re);if(Se!=null)return Se}return null}_createFBO(){const $=this.painter.context,q=$.gl,re=this.drapeBufferSize;$.activeTexture.set(q.TEXTURE0);const ye=new j.Texture($,{width:re[0],height:re[1],data:null},q.RGBA);ye.bind(q.LINEAR,q.CLAMP_TO_EDGE);const be=$.createFramebuffer(re[0],re[1],!1);return be.colorAttachment.set(ye.texture),be.depthAttachment=new qe($,be.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=$.createRenderbuffer($.gl.DEPTH_STENCIL,re[0],re[1]),this._stencilRef=0,be.depthAttachment.set(this._sharedDepthStencil),$.clear({stencil:0})):be.depthAttachment.set(this._sharedDepthStencil),$.extTextureFilterAnisotropic&&!$.extTextureFilterAnisotropicForceOff&&q.texParameterf(q.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax),{fb:be,tex:ye,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const $ in this._style._sourceCaches)if(this._style._sourceCaches[$].hasTransition())return!0;return this._style.order.some($=>{const q=this._style._layers[$],re=q.isHidden(this.painter.transform.zoom),ye=q.getCrossfadeParameters(),be=!!ye&&ye.t!==1,Se=q.hasTransition();return q.type!=="custom"&&!re&&(be||Se)})}_clearRasterFadeFromRenderCache(){let $=!1;for(const q in this._style._sourceCaches)if(this._style._sourceCaches[q]._source instanceof ut){$=!0;break}if($)for(let q=0;q<this._style.order.length;++q){const re=this._style._layers[this._style.order[q]],ye=re.isHidden(this.painter.transform.zoom),be=this._style._getLayerSourceCache(re);if(re.type!=="raster"||ye||!be)continue;const Se=re.paint.get("raster-fade-duration");for(const Ie of this.proxyCoords){const Re=this.proxyToSource[Ie.key][be.id];if(Re)for(const Fe of Re){const Ue=Na(be.getTile(Fe),be.findLoadedParent(Fe,0),be,this.painter.transform,Se);(Ue.opacity!==1||Ue.mix!==0)&&this._clearRenderCacheForTile(be.id,Fe)}}}}_setupDrapedRenderBatches(){const $=this._style.order,q=$.length;if(q===0)return;const re=[];let ye,be=0,Se=this._style._layers[$[be]];for(;!this._style.isLayerDraped(Se)&&Se.isHidden(this.painter.transform.zoom)&&++be<q;)Se=this._style._layers[$[be]];for(;be<q;++be){const Ie=this._style._layers[$[be]];Ie.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(Ie)?ye===void 0&&(ye=be):ye!==void 0&&(re.push({start:ye,end:be-1}),ye=void 0))}ye!==void 0&&re.push({start:ye,end:be-1}),this._drapedRenderBatches=re}_setupRenderCache($){const q=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,q.renderCache.length>q.renderCachePool.length){const Se=Object.values(q.proxyCachedFBO);q.proxyCachedFBO={};for(let Ie=0;Ie<Se.length;++Ie){const Re=Object.values(Se[Ie]);q.renderCachePool.push(...Re)}}return}this._clearRasterFadeFromRenderCache();const re=this.proxyCoords,ye=this._tilesDirty;for(let Se=re.length-1;Se>=0;Se--){const Ie=re[Se];if(q.getTileByID(Ie.key),q.proxyCachedFBO[Ie.key]!==void 0){const Re=$[Ie.key],Fe=this.proxyToSource[Ie.key];let Ue=0;for(const Ze in Fe){const Ye=Fe[Ze],rt=Re[Ze];if(!rt||rt.length!==Ye.length||Ye.some((et,tt)=>et!==rt[tt]||ye[Ze]&&ye[Ze].hasOwnProperty(et.key))){Ue=-1;break}++Ue}for(const Ze in q.proxyCachedFBO[Ie.key])q.renderCache[q.proxyCachedFBO[Ie.key][Ze]].dirty=Ue<0||Ue!==Object.values(Re).length}}const be=[...this._drapedRenderBatches];be.sort((Se,Ie)=>Ie.end-Ie.start-(Se.end-Se.start));for(const Se of be)for(const Ie of re){if(q.proxyCachedFBO[Ie.key])continue;let Re=q.renderCachePool.pop();Re===void 0&&q.renderCache.length<50&&(Re=q.renderCache.length,q.renderCache.push(this._createFBO())),Re!==void 0&&(q.proxyCachedFBO[Ie.key]={},q.proxyCachedFBO[Ie.key][Se.start]=Re,q.renderCache[Re].dirty=!0)}this._tilesDirty={}}_setupStencil($,q,re,ye){if(!ye||!this._sourceTilesOverlap[ye.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const be=this.painter.context,Se=be.gl;if(q.length<=1)return void(this._overlapStencilType=!1);let Ie;if(re.isTileClipped())Ie=q.length,this._overlapStencilMode.test={func:Se.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(q[0].overscaledZ>q[q.length-1].overscaledZ))return void(this._overlapStencilType=!1);Ie=1,this._overlapStencilMode.test={func:Se.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+Ie>255&&(be.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=Ie,this._overlapStencilMode.ref=this._stencilRef,re.isTileClipped()&&this._renderTileClippingMasks(q,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap($){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[$.key]),this._overlapStencilMode):j.StencilMode.disabled}_renderTileClippingMasks($,q){const re=this.painter,ye=this.painter.context,be=ye.gl;re._tileClippingMaskIDs={},ye.setColorMode(j.ColorMode.disabled),ye.setDepthMode(j.DepthMode.disabled);const Se=re.useProgram("clippingMask");for(const Ie of $){const Re=re._tileClippingMaskIDs[Ie.key]=--q;Se.draw(ye,be.TRIANGLES,j.DepthMode.disabled,new j.StencilMode({func:be.ALWAYS,mask:0},Re,255,be.KEEP,be.KEEP,be.REPLACE),j.ColorMode.disabled,j.CullFaceMode.disabled,Vl(Ie.projMatrix),"$clipping",re.tileExtentBuffer,re.quadTriangleIndexBuffer,re.tileExtentSegments)}}pointCoordinate($){const q=this.painter.transform;if($.x<0||$.x>q.width||$.y<0||$.y>q.height)return null;const re=[$.x,$.y,1,1];j.transformMat4$1(re,re,q.pixelMatrixInverse),j.scale$1(re,re,1/re[3]),re[0]/=q.worldSize,re[1]/=q.worldSize;const ye=q._camera.position,be=j.mercatorZfromAltitude(1,q.center.lat),Se=[ye[0],ye[1],ye[2]/be,0],Ie=j.subtract([],re.slice(0,3),Se);j.normalize(Ie,Ie);const Re=this.raycast(Se,Ie,this._exaggeration);return Re!==null&&Re?(j.scaleAndAdd(Se,Se,Ie,Re),Se[3]=Se[2],Se[2]*=be,Se):null}drawDepth(){const $=this.painter,q=$.context,re=this.proxySourceCache,ye=Math.ceil($.width),be=Math.ceil($.height);if(!this._depthFBO||this._depthFBO.width===ye&&this._depthFBO.height===be||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const Se=q.gl,Ie=q.createFramebuffer(ye,be,!0);q.activeTexture.set(Se.TEXTURE0);const Re=new j.Texture(q,{width:ye,height:be,data:null},Se.RGBA);Re.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),Ie.colorAttachment.set(Re.texture);const Fe=q.createRenderbuffer(q.gl.DEPTH_COMPONENT16,ye,be);Ie.depthAttachment.set(Fe),this._depthFBO=Ie,this._depthTexture=Re}q.bindFramebuffer.set(this._depthFBO.framebuffer),q.viewport.set([0,0,ye,be]),function(Se,Ie,Re,Fe){if(Se.transform.projection.name==="globe")return;const Ue=Se.context,Ze=Ue.gl;Ue.clear({depth:1});const Ye=Se.useProgram("terrainDepth"),rt=new j.DepthMode(Ze.LESS,j.DepthMode.ReadWrite,Se.depthRangeFor3D);for(const et of Fe){const tt=Re.getTile(et),nt=$l(et.projMatrix,0);Ie.setupElevationDraw(tt,Ye),Ye.draw(Ue,Ze.TRIANGLES,rt,j.StencilMode.disabled,j.ColorMode.unblended,j.CullFaceMode.backCCW,nt,"terrain_depth",Ie.gridBuffer,Ie.gridIndexBuffer,Ie.gridNoSkirtSegments)}}($,this,re,this.proxyCoords)}_setupProxiedCoordsForOrtho($,q,re){if($.getSource()instanceof kt)return this._setupProxiedCoordsForImageSource($,q,re);this._findCoveringTileCache[$.id]=this._findCoveringTileCache[$.id]||{};const ye=this.proxiedCoords[$.id]=[],be=this.proxyCoords;for(let Ie=0;Ie<be.length;Ie++){const Re=be[Ie],Fe=this._findTileCoveringTileID(Re,$);if(Fe){const Ue=this._createProxiedId(Re,Fe,re[Re.key]&&re[Re.key][$.id]);ye.push(Ue),this.proxyToSource[Re.key][$.id]=[Ue]}}let Se=!1;for(let Ie=0;Ie<q.length;Ie++){const Re=$.getTile(q[Ie]);if(!Re||!Re.hasData())continue;const Fe=this._findTileCoveringTileID(Re.tileID,this.proxySourceCache);if(Fe&&Fe.tileID.canonical.z!==Re.tileID.canonical.z){const Ue=this.proxyToSource[Fe.tileID.key][$.id],Ze=this._createProxiedId(Fe.tileID,Re,re[Fe.tileID.key]&&re[Fe.tileID.key][$.id]);Ue?Ue.splice(Ue.length-1,0,Ze):this.proxyToSource[Fe.tileID.key][$.id]=[Ze],ye.push(Ze),Se=!0}}this._sourceTilesOverlap[$.id]=Se}_setupProxiedCoordsForImageSource($,q,re){if(!$.getSource().loaded())return;const ye=this.proxiedCoords[$.id]=[],be=this.proxyCoords,Se=$.getSource(),Ie=new j.pointGeometry(Se.tileID.x,Se.tileID.y)._div(1<<Se.tileID.z),Re=Se.coordinates.map(j.MercatorCoordinate.fromLngLat).reduce((Ue,Ze)=>(Ue.min.x=Math.min(Ue.min.x,Ze.x-Ie.x),Ue.min.y=Math.min(Ue.min.y,Ze.y-Ie.y),Ue.max.x=Math.max(Ue.max.x,Ze.x-Ie.x),Ue.max.y=Math.max(Ue.max.y,Ze.y-Ie.y),Ue),{min:new j.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new j.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Fe=(Ue,Ze)=>{const Ye=Ue.wrap+Ue.canonical.x/(1<<Ue.canonical.z),rt=Ue.canonical.y/(1<<Ue.canonical.z),et=j.EXTENT/(1<<Ue.canonical.z),tt=Ze.wrap+Ze.canonical.x/(1<<Ze.canonical.z),nt=Ze.canonical.y/(1<<Ze.canonical.z);return Ye+et<tt+Re.min.x||Ye>tt+Re.max.x||rt+et<nt+Re.min.y||rt>nt+Re.max.y};for(let Ue=0;Ue<be.length;Ue++){const Ze=be[Ue];for(let Ye=0;Ye<q.length;Ye++){const rt=$.getTile(q[Ye]);if(!rt||!rt.hasData()||Fe(Ze,rt.tileID))continue;const et=this._createProxiedId(Ze,rt,re[Ze.key]&&re[Ze.key][$.id]),tt=this.proxyToSource[Ze.key][$.id];tt?tt.push(et):this.proxyToSource[Ze.key][$.id]=[et],ye.push(et)}}}_createProxiedId($,q,re){let ye=this.orthoMatrix;if(re){const be=re.find(Se=>Se.key===q.tileID.key);if(be)return be}if(q.tileID.key!==$.key){const be=$.canonical.z-q.tileID.canonical.z;let Se,Ie,Re;ye=j.create();const Fe=q.tileID.wrap-$.wrap<<$.overscaledZ;be>0?(Se=j.EXTENT>>be,Ie=Se*((q.tileID.canonical.x<<be)-$.canonical.x+Fe),Re=Se*((q.tileID.canonical.y<<be)-$.canonical.y)):(Se=j.EXTENT<<-be,Ie=j.EXTENT*(q.tileID.canonical.x-($.canonical.x+Fe<<-be)),Re=j.EXTENT*(q.tileID.canonical.y-($.canonical.y<<-be))),j.ortho(ye,0,Se,0,Se,0,1),j.translate(ye,ye,[Ie,Re,0])}return new ja(q.tileID,$.key,ye)}_findTileCoveringTileID($,q){let re=q.getTile($);if(re&&re.hasData())return re;const ye=this._findCoveringTileCache[q.id],be=ye[$.key];if(re=be?q.getTileByID(be):null,re&&re.hasData()||be===null)return re;let Se=re?re.tileID:$,Ie=Se.overscaledZ;const Re=q.getSource().minzoom,Fe=[];if(!be){const Ze=q.getSource().maxzoom;if($.canonical.z>=Ze){const Ye=$.canonical.z-Ze;q.getSource().reparseOverscaled?(Ie=Math.max($.canonical.z+2,q.transform.tileZoom),Se=new j.OverscaledTileID(Ie,$.wrap,Ze,$.canonical.x>>Ye,$.canonical.y>>Ye)):Ye!==0&&(Ie=Ze,Se=new j.OverscaledTileID(Ie,$.wrap,Ze,$.canonical.x>>Ye,$.canonical.y>>Ye))}Se.key!==$.key&&(Fe.push(Se.key),re=q.getTile(Se))}const Ue=Ze=>{Fe.forEach(Ye=>{ye[Ye]=Ze}),Fe.length=0};for(Ie-=1;Ie>=Re&&(!re||!re.hasData());Ie--){re&&Ue(re.tileID.key);const Ze=Se.calculateScaledKey(Ie);if(re=q.getTileByID(Ze),re&&re.hasData())break;const Ye=ye[Ze];if(Ye===null)break;Ye===void 0?Fe.push(Ze):re=q.getTileByID(Ye)}return Ue(re?re.tileID.key:null),re&&re.hasData()?re:null}findDEMTileFor($){return this.enabled?this._findTileCoveringTileID($,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile($,q){let re=this._tilesDirty[$];re||(re=this._tilesDirty[$]={}),re[q.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const $=function(q){let re=0;const ye=new j.StructArrayLayout2ui4,be=131;for(let Se=1;Se<129;Se++){for(let Ie=1;Ie<129;Ie++)re=Se*be+Ie,ye.emplaceBack(re,re+1),ye.emplaceBack(re,re+be),ye.emplaceBack(re+1,re+be),Se===128&&ye.emplaceBack(re+be,re+be+1);ye.emplaceBack(re+1,re+1+be)}return ye}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer($),this.wireframeSegments=j.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,$.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Zl{static cacheKey($,q,re,ye){let be=`${q}${ye?ye.cacheKey:""}`;for(const Se of re)$.usedDefines.includes(Se)&&(be+=`/${Se}`);return be}constructor($,q,re,ye,be,Se){const Ie=$.gl;this.program=Ie.createProgram();const Re=function(nt){const Qe=[];for(let lt=0;lt<nt.length;lt++){if(nt[lt]===null)continue;const it=nt[lt].split(" ");Qe.push(it.pop())}return Qe}(re.staticAttributes),Fe=ye?ye.getBinderAttributes():[],Ue=Re.concat(Fe);let Ze=ye?ye.defines():[];Ze=Ze.concat(Se.map(nt=>`#define ${nt}`));const Ye=Ze.concat($.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Fa):Fa,Fa,Oa,Zs.fragmentSource,qo.fragmentSource,re.fragmentSource).join(`
`),rt=Ze.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Oa,Zs.vertexSource,qo.vertexSource,Ba.vertexSource,re.vertexSource).join(`
`),et=Ie.createShader(Ie.FRAGMENT_SHADER);if(Ie.isContextLost())return void(this.failedToCreate=!0);Ie.shaderSource(et,Ye),Ie.compileShader(et),Ie.attachShader(this.program,et);const tt=Ie.createShader(Ie.VERTEX_SHADER);if(Ie.isContextLost())this.failedToCreate=!0;else{Ie.shaderSource(tt,rt),Ie.compileShader(tt),Ie.attachShader(this.program,tt),this.attributes={},this.numAttributes=Ue.length;for(let nt=0;nt<this.numAttributes;nt++)Ue[nt]&&(Ie.bindAttribLocation(this.program,nt,Ue[nt]),this.attributes[Ue[nt]]=nt);Ie.linkProgram(this.program),Ie.deleteShader(tt),Ie.deleteShader(et),this.fixedUniforms=be($),this.binderUniforms=ye?ye.getUniforms($):[],Se.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(nt=>({u_dem:new j.Uniform1i(nt),u_dem_prev:new j.Uniform1i(nt),u_dem_unpack:new j.Uniform4f(nt),u_dem_tl:new j.Uniform2f(nt),u_dem_scale:new j.Uniform1f(nt),u_dem_tl_prev:new j.Uniform2f(nt),u_dem_scale_prev:new j.Uniform1f(nt),u_dem_size:new j.Uniform1f(nt),u_dem_lerp:new j.Uniform1f(nt),u_exaggeration:new j.Uniform1f(nt),u_depth:new j.Uniform1i(nt),u_depth_size_inv:new j.Uniform2f(nt),u_meter_to_dem:new j.Uniform1f(nt),u_label_plane_matrix_inv:new j.UniformMatrix4f(nt),u_tile_tl_up:new j.Uniform3f(nt),u_tile_tr_up:new j.Uniform3f(nt),u_tile_br_up:new j.Uniform3f(nt),u_tile_bl_up:new j.Uniform3f(nt),u_tile_up_scale:new j.Uniform1f(nt)}))($)),Se.indexOf("FOG")!==-1&&(this.fogUniforms=(nt=>({u_fog_matrix:new j.UniformMatrix4f(nt),u_fog_range:new j.Uniform2f(nt),u_fog_color:new j.Uniform4f(nt),u_fog_horizon_blend:new j.Uniform1f(nt),u_fog_temporal_offset:new j.Uniform1f(nt),u_frustum_tl:new j.Uniform3f(nt),u_frustum_tr:new j.Uniform3f(nt),u_frustum_br:new j.Uniform3f(nt),u_frustum_bl:new j.Uniform3f(nt),u_globe_pos:new j.Uniform3f(nt),u_globe_radius:new j.Uniform1f(nt),u_globe_transition:new j.Uniform1f(nt),u_is_globe:new j.Uniform1i(nt),u_viewport:new j.Uniform2f(nt)}))($))}}setTerrainUniformValues($,q){if(!this.terrainUniforms)return;const re=this.terrainUniforms;if(!this.failedToCreate){$.program.set(this.program);for(const ye in q)re[ye].set(this.program,ye,q[ye])}}setFogUniformValues($,q){if(!this.fogUniforms)return;const re=this.fogUniforms;if(!this.failedToCreate){$.program.set(this.program);for(const ye in q)re[ye].set(this.program,ye,q[ye])}}draw($,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt){const nt=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(re),$.setStencilMode(ye),$.setColorMode(be),$.setCullFace(Se);for(const lt of Object.keys(this.fixedUniforms))this.fixedUniforms[lt].set(this.program,lt,Ie[lt]);et&&et.setUniforms(this.program,$,this.binderUniforms,Ye,{zoom:rt});const Qe={[nt.LINES]:2,[nt.TRIANGLES]:3,[nt.LINE_STRIP]:1}[q];for(const lt of Ze.get()){const it=lt.vaos||(lt.vaos={});(it[Re]||(it[Re]=new $a)).bind($,this,Fe,et?et.getPaintVertexBuffers():[],Ue,lt.vertexOffset,tt||[]),nt.drawElements(q,lt.primitiveLength*Qe,nt.UNSIGNED_SHORT,lt.primitiveOffset*Qe*2)}}}function su(te,$,q){const re=1/Vr(q,1,$.transform.tileZoom),ye=Math.pow(2,q.tileID.overscaledZ),be=q.tileSize*Math.pow(2,$.transform.tileZoom)/ye,Se=be*(q.tileID.canonical.x+q.tileID.wrap*ye),Ie=be*q.tileID.canonical.y;return{u_image:0,u_texsize:q.imageAtlasTexture.size,u_scale:[re,te.fromScale,te.toScale],u_fade:te.t,u_pixel_coord_upper:[Se>>16,Ie>>16],u_pixel_coord_lower:[65535&Se,65535&Ie]}}const Xs=j.create(),fs=(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue)=>{const Ze=$.style.light,Ye=Ze.properties.get("position"),rt=[Ye.x,Ye.y,Ye.z],et=j.create$1();Ze.properties.get("anchor")==="viewport"&&(j.fromRotation(et,-$.transform.angle),j.transformMat3(rt,rt,et));const tt=Ze.properties.get("color"),nt=$.transform,Qe={u_matrix:te,u_lightpos:rt,u_lightintensity:Ze.properties.get("intensity"),u_lightcolor:[tt.r,tt.g,tt.b],u_vertical_gradient:+q,u_opacity:re,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:ye,u_edge_radius:be};return nt.projection.name==="globe"&&(Qe.u_tile_id=[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z],Qe.u_zoom_transition=Re,Qe.u_inv_rot_matrix=Ue,Qe.u_merc_center=Fe,Qe.u_up_dir=nt.projection.upVector(new j.CanonicalTileID(0,0,0),Fe[0]*j.EXTENT,Fe[1]*j.EXTENT),Qe.u_height_lift=Ie),Qe},au=(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye)=>{const rt=fs(te,$,q,re,ye,be,Se,Fe,Ue,Ze,Ye),et={u_height_factor:-Math.pow(2,Se.overscaledZ)/Re.tileSize/8};return j.extend(rt,su(Ie,$,Re),et)},Ks=te=>({u_matrix:te}),Va=(te,$,q,re)=>j.extend(Ks(te),su(q,$,re)),io=(te,$)=>({u_matrix:te,u_world:$}),Hl=(te,$,q,re,ye)=>j.extend(Va(te,$,q,re),{u_world:ye}),lu=j.create(),Wl=(te,$,q,re,ye,be)=>{const Se=te.transform,Ie=Se.projection.name==="globe";let Re;if(be.paint.get("circle-pitch-alignment")==="map")if(Ie){const Ue=j.globePixelsToTileUnits(Se.zoom,$.canonical)*Se._pixelsPerMercatorPixel;Re=Float32Array.from([Ue,0,0,Ue])}else Re=Se.calculatePixelsToTileUnitsMatrix(q);else Re=new Float32Array([Se.pixelsToGLUnits[0],0,0,Se.pixelsToGLUnits[1]]);const Fe={u_camera_to_center_distance:Se.cameraToCenterDistance,u_matrix:te.translatePosMatrix($.projMatrix,q,be.paint.get("circle-translate"),be.paint.get("circle-translate-anchor")),u_device_pixel_ratio:j.exported.devicePixelRatio,u_extrude_scale:Re,u_inv_rot_matrix:lu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Ie){Fe.u_inv_rot_matrix=re,Fe.u_merc_center=ye,Fe.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],Fe.u_zoom_transition=j.globeToMercatorTransition(Se.zoom);const Ue=ye[0]*j.EXTENT,Ze=ye[1]*j.EXTENT;Fe.u_up_dir=Se.projection.upVector(new j.CanonicalTileID(0,0,0),Ue,Ze)}return Fe},cu=te=>{const $=[];return te.paint.get("circle-pitch-alignment")==="map"&&$.push("PITCH_WITH_MAP"),te.paint.get("circle-pitch-scale")==="map"&&$.push("SCALE_WITH_MAP"),$},Xl=(te,$,q,re)=>{const ye=j.EXTENT/q.tileSize;return{u_matrix:te,u_camera_to_center_distance:$.getCameraToCenterDistance(re),u_extrude_scale:[$.pixelsToGLUnits[0]/ye,$.pixelsToGLUnits[1]/ye]}},uu=(te,$,q=1)=>({u_matrix:te,u_color:$,u_overlay:0,u_overlay_scale:q}),Kl=j.create(),Fh=(te,$,q,re,ye,be,Se)=>{const Ie=te.transform,Re=Ie.projection.name==="globe",Fe=Re?j.globePixelsToTileUnits(Ie.zoom,$.canonical)*Ie._pixelsPerMercatorPixel:Vr(q,1,be),Ue={u_matrix:$.projMatrix,u_extrude_scale:Fe,u_intensity:Se,u_inv_rot_matrix:Kl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(Re){Ue.u_inv_rot_matrix=re,Ue.u_merc_center=ye,Ue.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],Ue.u_zoom_transition=j.globeToMercatorTransition(Ie.zoom);const Ze=ye[0]*j.EXTENT,Ye=ye[1]*j.EXTENT;Ue.u_up_dir=Ie.projection.upVector(new j.CanonicalTileID(0,0,0),Ze,Ye)}return Ue},Ga=(te,$,q,re,ye,be,Se,Ie)=>{const Re=te.transform,Fe=Re.calculatePixelsToTileUnitsMatrix($),Ue={u_matrix:hu(te,$,q,ye),u_pixels_to_tile_units:Fe,u_device_pixel_ratio:Se,u_units_to_pixels:[1/Re.pixelsToGLUnits[0],1/Re.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:be,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:Ie};if(Za(q)){const Ze=qa($,te.transform);Ue.u_texsize=$.lineAtlasTexture.size,Ue.u_scale=[Ze,re.fromScale,re.toScale],Ue.u_mix=re.t}return Ue},Uh=(te,$,q,re,ye,be)=>{const Se=te.transform,Ie=qa($,Se);return{u_matrix:hu(te,$,q,ye),u_texsize:$.imageAtlasTexture.size,u_pixels_to_tile_units:Se.calculatePixelsToTileUnitsMatrix($),u_device_pixel_ratio:be,u_image:0,u_scale:[Ie,re.fromScale,re.toScale],u_fade:re.t,u_units_to_pixels:[1/Se.pixelsToGLUnits[0],1/Se.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qa(te,$){return 1/Vr(te,1,$.tileZoom)}function hu(te,$,q,re){return te.translatePosMatrix(re||$.tileID.projMatrix,$,q.paint.get("line-translate"),q.paint.get("line-translate-anchor"))}function Za(te){const $=te.paint.get("line-dasharray").value;return $.value||$.kind!=="constant"}const $h=(te,$,q,re,ye,be)=>{return{u_matrix:te,u_tl_parent:$,u_scale_parent:q,u_fade_t:re.mix,u_opacity:re.opacity*ye.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ye.paint.get("raster-brightness-min"),u_brightness_high:ye.paint.get("raster-brightness-max"),u_saturation_factor:(Ie=ye.paint.get("raster-saturation"),Ie>0?1-1/(1.001-Ie):-Ie),u_contrast_factor:(Se=ye.paint.get("raster-contrast"),Se>0?1/(1-Se):1+Se),u_spin_weights:Ha(ye.paint.get("raster-hue-rotate")),u_perspective_transform:be};var Se,Ie};function Ha(te){te*=Math.PI/180;const $=Math.sin(te),q=Math.cos(te);return[(2*q+1)/3,(-Math.sqrt(3)*$-q+1)/3,(Math.sqrt(3)*$-q+1)/3]}const du=j.create(),Yl=(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt)=>{const nt=ye.transform,Qe={u_is_size_zoom_constant:+(te==="constant"||te==="source"),u_is_size_feature_constant:+(te==="constant"||te==="camera"),u_size_t:$?$.uSizeT:0,u_size:$?$.uSize:0,u_camera_to_center_distance:nt.cameraToCenterDistance,u_rotate_symbol:+q,u_aspect_ratio:nt.width/nt.height,u_fade_change:ye.options.fadeDuration?ye.symbolFadeChange:1,u_matrix:be,u_label_plane_matrix:Se,u_coord_matrix:Ie,u_is_text:+Re,u_pitch_with_map:+re,u_texsize:Fe,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:du,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:du,u_up_vector:[0,-1,0]};return tt.name==="globe"&&(Qe.u_tile_id=[Ue.canonical.x,Ue.canonical.y,1<<Ue.canonical.z],Qe.u_zoom_transition=Ze,Qe.u_inv_rot_matrix=rt,Qe.u_merc_center=Ye,Qe.u_camera_forward=nt._camera.forward(),Qe.u_ecef_origin=j.globeECEFOrigin(nt.globeMatrix,Ue.toUnwrapped()),Qe.u_tile_matrix=Float32Array.from(nt.globeMatrix),Qe.u_up_vector=et),Qe},Jl=(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt,nt)=>j.extend(Yl(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ze,Ye,rt,et,tt,nt),{u_gamma_scale:re?ye.transform.cameraToCenterDistance*Math.cos(ye.terrain?0:ye.transform._pitch):1,u_device_pixel_ratio:j.exported.devicePixelRatio,u_is_halo:+Ue}),ms=(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt)=>j.extend(Jl(te,$,q,re,ye,be,Se,Ie,!0,Re,!0,Ue,Ze,Ye,rt,et,tt),{u_texsize_icon:Fe,u_texture_icon:1}),Nh=(te,$,q)=>({u_matrix:te,u_opacity:$,u_color:q}),jh=(te,$,q,re,ye,be)=>j.extend(function(Se,Ie,Re,Fe){const Ue=Re.imageManager.getPattern(Se.from.toString()),Ze=Re.imageManager.getPattern(Se.to.toString()),{width:Ye,height:rt}=Re.imageManager.getPixelSize(),et=Math.pow(2,Fe.tileID.overscaledZ),tt=Fe.tileSize*Math.pow(2,Re.transform.tileZoom)/et,nt=tt*(Fe.tileID.canonical.x+Fe.tileID.wrap*et),Qe=tt*Fe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ue.tl,u_pattern_br_a:Ue.br,u_pattern_tl_b:Ze.tl,u_pattern_br_b:Ze.br,u_texsize:[Ye,rt],u_mix:Ie.t,u_pattern_size_a:Ue.displaySize,u_pattern_size_b:Ze.displaySize,u_scale_a:Ie.fromScale,u_scale_b:Ie.toScale,u_tile_units_to_pixels:1/Vr(Fe,1,Re.transform.tileZoom),u_pixel_coord_upper:[nt>>16,Qe>>16],u_pixel_coord_lower:[65535&nt,65535&Qe]}}(re,be,q,ye),{u_matrix:te,u_opacity:$}),Vh={fillExtrusion:te=>({u_matrix:new j.UniformMatrix4f(te),u_lightpos:new j.Uniform3f(te),u_lightintensity:new j.Uniform1f(te),u_lightcolor:new j.Uniform3f(te),u_vertical_gradient:new j.Uniform1f(te),u_opacity:new j.Uniform1f(te),u_edge_radius:new j.Uniform1f(te),u_ao:new j.Uniform2f(te),u_tile_id:new j.Uniform3f(te),u_zoom_transition:new j.Uniform1f(te),u_inv_rot_matrix:new j.UniformMatrix4f(te),u_merc_center:new j.Uniform2f(te),u_up_dir:new j.Uniform3f(te),u_height_lift:new j.Uniform1f(te)}),fillExtrusionPattern:te=>({u_matrix:new j.UniformMatrix4f(te),u_lightpos:new j.Uniform3f(te),u_lightintensity:new j.Uniform1f(te),u_lightcolor:new j.Uniform3f(te),u_vertical_gradient:new j.Uniform1f(te),u_height_factor:new j.Uniform1f(te),u_edge_radius:new j.Uniform1f(te),u_ao:new j.Uniform2f(te),u_tile_id:new j.Uniform3f(te),u_zoom_transition:new j.Uniform1f(te),u_inv_rot_matrix:new j.UniformMatrix4f(te),u_merc_center:new j.Uniform2f(te),u_up_dir:new j.Uniform3f(te),u_height_lift:new j.Uniform1f(te),u_image:new j.Uniform1i(te),u_texsize:new j.Uniform2f(te),u_pixel_coord_upper:new j.Uniform2f(te),u_pixel_coord_lower:new j.Uniform2f(te),u_scale:new j.Uniform3f(te),u_fade:new j.Uniform1f(te),u_opacity:new j.Uniform1f(te)}),fill:te=>({u_matrix:new j.UniformMatrix4f(te)}),fillPattern:te=>({u_matrix:new j.UniformMatrix4f(te),u_image:new j.Uniform1i(te),u_texsize:new j.Uniform2f(te),u_pixel_coord_upper:new j.Uniform2f(te),u_pixel_coord_lower:new j.Uniform2f(te),u_scale:new j.Uniform3f(te),u_fade:new j.Uniform1f(te)}),fillOutline:te=>({u_matrix:new j.UniformMatrix4f(te),u_world:new j.Uniform2f(te)}),fillOutlinePattern:te=>({u_matrix:new j.UniformMatrix4f(te),u_world:new j.Uniform2f(te),u_image:new j.Uniform1i(te),u_texsize:new j.Uniform2f(te),u_pixel_coord_upper:new j.Uniform2f(te),u_pixel_coord_lower:new j.Uniform2f(te),u_scale:new j.Uniform3f(te),u_fade:new j.Uniform1f(te)}),circle:te=>({u_camera_to_center_distance:new j.Uniform1f(te),u_extrude_scale:new j.UniformMatrix2f(te),u_device_pixel_ratio:new j.Uniform1f(te),u_matrix:new j.UniformMatrix4f(te),u_inv_rot_matrix:new j.UniformMatrix4f(te),u_merc_center:new j.Uniform2f(te),u_tile_id:new j.Uniform3f(te),u_zoom_transition:new j.Uniform1f(te),u_up_dir:new j.Uniform3f(te)}),collisionBox:te=>({u_matrix:new j.UniformMatrix4f(te),u_camera_to_center_distance:new j.Uniform1f(te),u_extrude_scale:new j.Uniform2f(te)}),collisionCircle:te=>({u_matrix:new j.UniformMatrix4f(te),u_inv_matrix:new j.UniformMatrix4f(te),u_camera_to_center_distance:new j.Uniform1f(te),u_viewport_size:new j.Uniform2f(te)}),debug:te=>({u_color:new j.UniformColor(te),u_matrix:new j.UniformMatrix4f(te),u_overlay:new j.Uniform1i(te),u_overlay_scale:new j.Uniform1f(te)}),clippingMask:te=>({u_matrix:new j.UniformMatrix4f(te)}),heatmap:te=>({u_extrude_scale:new j.Uniform1f(te),u_intensity:new j.Uniform1f(te),u_matrix:new j.UniformMatrix4f(te),u_inv_rot_matrix:new j.UniformMatrix4f(te),u_merc_center:new j.Uniform2f(te),u_tile_id:new j.Uniform3f(te),u_zoom_transition:new j.Uniform1f(te),u_up_dir:new j.Uniform3f(te)}),heatmapTexture:te=>({u_image:new j.Uniform1i(te),u_color_ramp:new j.Uniform1i(te),u_opacity:new j.Uniform1f(te)}),hillshade:te=>({u_matrix:new j.UniformMatrix4f(te),u_image:new j.Uniform1i(te),u_latrange:new j.Uniform2f(te),u_light:new j.Uniform2f(te),u_shadow:new j.UniformColor(te),u_highlight:new j.UniformColor(te),u_accent:new j.UniformColor(te)}),hillshadePrepare:te=>({u_matrix:new j.UniformMatrix4f(te),u_image:new j.Uniform1i(te),u_dimension:new j.Uniform2f(te),u_zoom:new j.Uniform1f(te),u_unpack:new j.Uniform4f(te)}),line:te=>({u_matrix:new j.UniformMatrix4f(te),u_pixels_to_tile_units:new j.UniformMatrix2f(te),u_device_pixel_ratio:new j.Uniform1f(te),u_units_to_pixels:new j.Uniform2f(te),u_dash_image:new j.Uniform1i(te),u_gradient_image:new j.Uniform1i(te),u_image_height:new j.Uniform1f(te),u_texsize:new j.Uniform2f(te),u_scale:new j.Uniform3f(te),u_mix:new j.Uniform1f(te),u_alpha_discard_threshold:new j.Uniform1f(te),u_trim_offset:new j.Uniform2f(te)}),linePattern:te=>({u_matrix:new j.UniformMatrix4f(te),u_texsize:new j.Uniform2f(te),u_pixels_to_tile_units:new j.UniformMatrix2f(te),u_device_pixel_ratio:new j.Uniform1f(te),u_image:new j.Uniform1i(te),u_units_to_pixels:new j.Uniform2f(te),u_scale:new j.Uniform3f(te),u_fade:new j.Uniform1f(te),u_alpha_discard_threshold:new j.Uniform1f(te)}),raster:te=>({u_matrix:new j.UniformMatrix4f(te),u_tl_parent:new j.Uniform2f(te),u_scale_parent:new j.Uniform1f(te),u_fade_t:new j.Uniform1f(te),u_opacity:new j.Uniform1f(te),u_image0:new j.Uniform1i(te),u_image1:new j.Uniform1i(te),u_brightness_low:new j.Uniform1f(te),u_brightness_high:new j.Uniform1f(te),u_saturation_factor:new j.Uniform1f(te),u_contrast_factor:new j.Uniform1f(te),u_spin_weights:new j.Uniform3f(te),u_perspective_transform:new j.Uniform2f(te)}),symbolIcon:te=>({u_is_size_zoom_constant:new j.Uniform1i(te),u_is_size_feature_constant:new j.Uniform1i(te),u_size_t:new j.Uniform1f(te),u_size:new j.Uniform1f(te),u_camera_to_center_distance:new j.Uniform1f(te),u_rotate_symbol:new j.Uniform1i(te),u_aspect_ratio:new j.Uniform1f(te),u_fade_change:new j.Uniform1f(te),u_matrix:new j.UniformMatrix4f(te),u_label_plane_matrix:new j.UniformMatrix4f(te),u_coord_matrix:new j.UniformMatrix4f(te),u_is_text:new j.Uniform1i(te),u_pitch_with_map:new j.Uniform1i(te),u_texsize:new j.Uniform2f(te),u_tile_id:new j.Uniform3f(te),u_zoom_transition:new j.Uniform1f(te),u_inv_rot_matrix:new j.UniformMatrix4f(te),u_merc_center:new j.Uniform2f(te),u_camera_forward:new j.Uniform3f(te),u_tile_matrix:new j.UniformMatrix4f(te),u_up_vector:new j.Uniform3f(te),u_ecef_origin:new j.Uniform3f(te),u_texture:new j.Uniform1i(te)}),symbolSDF:te=>({u_is_size_zoom_constant:new j.Uniform1i(te),u_is_size_feature_constant:new j.Uniform1i(te),u_size_t:new j.Uniform1f(te),u_size:new j.Uniform1f(te),u_camera_to_center_distance:new j.Uniform1f(te),u_rotate_symbol:new j.Uniform1i(te),u_aspect_ratio:new j.Uniform1f(te),u_fade_change:new j.Uniform1f(te),u_matrix:new j.UniformMatrix4f(te),u_label_plane_matrix:new j.UniformMatrix4f(te),u_coord_matrix:new j.UniformMatrix4f(te),u_is_text:new j.Uniform1i(te),u_pitch_with_map:new j.Uniform1i(te),u_texsize:new j.Uniform2f(te),u_texture:new j.Uniform1i(te),u_gamma_scale:new j.Uniform1f(te),u_device_pixel_ratio:new j.Uniform1f(te),u_tile_id:new j.Uniform3f(te),u_zoom_transition:new j.Uniform1f(te),u_inv_rot_matrix:new j.UniformMatrix4f(te),u_merc_center:new j.Uniform2f(te),u_camera_forward:new j.Uniform3f(te),u_tile_matrix:new j.UniformMatrix4f(te),u_up_vector:new j.Uniform3f(te),u_ecef_origin:new j.Uniform3f(te),u_is_halo:new j.Uniform1i(te)}),symbolTextAndIcon:te=>({u_is_size_zoom_constant:new j.Uniform1i(te),u_is_size_feature_constant:new j.Uniform1i(te),u_size_t:new j.Uniform1f(te),u_size:new j.Uniform1f(te),u_camera_to_center_distance:new j.Uniform1f(te),u_rotate_symbol:new j.Uniform1i(te),u_aspect_ratio:new j.Uniform1f(te),u_fade_change:new j.Uniform1f(te),u_matrix:new j.UniformMatrix4f(te),u_label_plane_matrix:new j.UniformMatrix4f(te),u_coord_matrix:new j.UniformMatrix4f(te),u_is_text:new j.Uniform1i(te),u_pitch_with_map:new j.Uniform1i(te),u_texsize:new j.Uniform2f(te),u_texsize_icon:new j.Uniform2f(te),u_texture:new j.Uniform1i(te),u_texture_icon:new j.Uniform1i(te),u_gamma_scale:new j.Uniform1f(te),u_device_pixel_ratio:new j.Uniform1f(te),u_is_halo:new j.Uniform1i(te)}),background:te=>({u_matrix:new j.UniformMatrix4f(te),u_opacity:new j.Uniform1f(te),u_color:new j.UniformColor(te)}),backgroundPattern:te=>({u_matrix:new j.UniformMatrix4f(te),u_opacity:new j.Uniform1f(te),u_image:new j.Uniform1i(te),u_pattern_tl_a:new j.Uniform2f(te),u_pattern_br_a:new j.Uniform2f(te),u_pattern_tl_b:new j.Uniform2f(te),u_pattern_br_b:new j.Uniform2f(te),u_texsize:new j.Uniform2f(te),u_mix:new j.Uniform1f(te),u_pattern_size_a:new j.Uniform2f(te),u_pattern_size_b:new j.Uniform2f(te),u_scale_a:new j.Uniform1f(te),u_scale_b:new j.Uniform1f(te),u_pixel_coord_upper:new j.Uniform2f(te),u_pixel_coord_lower:new j.Uniform2f(te),u_tile_units_to_pixels:new j.Uniform1f(te)}),terrainRaster:Hs,terrainDepth:Hs,skybox:te=>({u_matrix:new j.UniformMatrix4f(te),u_sun_direction:new j.Uniform3f(te),u_cubemap:new j.Uniform1i(te),u_opacity:new j.Uniform1f(te),u_temporal_offset:new j.Uniform1f(te)}),skyboxGradient:te=>({u_matrix:new j.UniformMatrix4f(te),u_color_ramp:new j.Uniform1i(te),u_center_direction:new j.Uniform3f(te),u_radius:new j.Uniform1f(te),u_opacity:new j.Uniform1f(te),u_temporal_offset:new j.Uniform1f(te)}),skyboxCapture:te=>({u_matrix_3f:new j.UniformMatrix3f(te),u_sun_direction:new j.Uniform3f(te),u_sun_intensity:new j.Uniform1f(te),u_color_tint_r:new j.Uniform4f(te),u_color_tint_m:new j.Uniform4f(te),u_luminance:new j.Uniform1f(te)}),globeRaster:te=>({u_proj_matrix:new j.UniformMatrix4f(te),u_globe_matrix:new j.UniformMatrix4f(te),u_normalize_matrix:new j.UniformMatrix4f(te),u_merc_matrix:new j.UniformMatrix4f(te),u_zoom_transition:new j.Uniform1f(te),u_merc_center:new j.Uniform2f(te),u_image0:new j.Uniform1i(te),u_grid_matrix:new j.UniformMatrix3f(te),u_frustum_tl:new j.Uniform3f(te),u_frustum_tr:new j.Uniform3f(te),u_frustum_br:new j.Uniform3f(te),u_frustum_bl:new j.Uniform3f(te),u_globe_pos:new j.Uniform3f(te),u_globe_radius:new j.Uniform1f(te),u_viewport:new j.Uniform2f(te)}),globeAtmosphere:te=>({u_frustum_tl:new j.Uniform3f(te),u_frustum_tr:new j.Uniform3f(te),u_frustum_br:new j.Uniform3f(te),u_frustum_bl:new j.Uniform3f(te),u_horizon:new j.Uniform1f(te),u_transition:new j.Uniform1f(te),u_fadeout_range:new j.Uniform1f(te),u_color:new j.Uniform4f(te),u_high_color:new j.Uniform4f(te),u_space_color:new j.Uniform4f(te),u_star_intensity:new j.Uniform1f(te),u_star_density:new j.Uniform1f(te),u_star_size:new j.Uniform1f(te),u_temporal_offset:new j.Uniform1f(te),u_horizon_angle:new j.Uniform1f(te),u_rotation_matrix:new j.UniformMatrix4f(te)})};let Wa;function pu(te,$,q,re,ye,be,Se){const Ie=te.context,Re=Ie.gl,Fe=te.transform,Ue=te.useProgram("collisionBox"),Ze=[];let Ye=0,rt=0;for(let xt=0;xt<re.length;xt++){const gt=re[xt],dt=$.getTile(gt),vt=dt.getBucket(q);if(!vt)continue;const _t=Pi(gt,vt,Fe);let St=_t;ye[0]===0&&ye[1]===0||(St=te.translatePosMatrix(_t,dt,ye,be));const Bt=Se?vt.textCollisionBox:vt.iconCollisionBox,un=vt.collisionCircleArray;if(un.length>0){const Rt=j.create(),Xt=St;j.mul(Rt,vt.placementInvProjMatrix,Fe.glCoordMatrix),j.mul(Rt,Rt,vt.placementViewportMatrix),Ze.push({circleArray:un,circleOffset:rt,transform:Xt,invTransform:Rt,projection:vt.getProjection()}),Ye+=un.length/4,rt=Ye}Bt&&(te.terrain&&te.terrain.setupElevationDraw(dt,Ue),Ue.draw(Ie,Re.LINES,j.DepthMode.disabled,j.StencilMode.disabled,te.colorModeForRenderPass(),j.CullFaceMode.disabled,Xl(St,Fe,dt,vt.getProjection()),q.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,Fe.zoom,null,[Bt.collisionVertexBuffer,Bt.collisionVertexBufferExt]))}if(!Se||!Ze.length)return;const et=te.useProgram("collisionCircle"),tt=new j.StructArrayLayout2f1f2i16;tt.resize(4*Ye),tt._trim();let nt=0;for(const xt of Ze)for(let gt=0;gt<xt.circleArray.length/4;gt++){const dt=4*gt,vt=xt.circleArray[dt+0],_t=xt.circleArray[dt+1],St=xt.circleArray[dt+2],Bt=xt.circleArray[dt+3];tt.emplace(nt++,vt,_t,St,Bt,0),tt.emplace(nt++,vt,_t,St,Bt,1),tt.emplace(nt++,vt,_t,St,Bt,2),tt.emplace(nt++,vt,_t,St,Bt,3)}(!Wa||Wa.length<2*Ye)&&(Wa=function(xt){const gt=2*xt,dt=new j.StructArrayLayout3ui6;dt.resize(gt),dt._trim();for(let vt=0;vt<gt;vt++){const _t=6*vt;dt.uint16[_t+0]=4*vt+0,dt.uint16[_t+1]=4*vt+1,dt.uint16[_t+2]=4*vt+2,dt.uint16[_t+3]=4*vt+2,dt.uint16[_t+4]=4*vt+3,dt.uint16[_t+5]=4*vt+0}return dt}(Ye));const Qe=Ie.createIndexBuffer(Wa,!0),lt=Ie.createVertexBuffer(tt,j.collisionCircleLayout.members,!0);for(const xt of Ze){const gt={u_matrix:xt.transform,u_inv_matrix:xt.invTransform,u_camera_to_center_distance:(it=Fe).getCameraToCenterDistance(xt.projection),u_viewport_size:[it.width,it.height]};et.draw(Ie,Re.TRIANGLES,j.DepthMode.disabled,j.StencilMode.disabled,te.colorModeForRenderPass(),j.CullFaceMode.disabled,gt,q.id,lt,Qe,j.SegmentVector.simpleSegment(0,2*xt.circleOffset,xt.circleArray.length,xt.circleArray.length/2),null,Fe.zoom)}var it;lt.destroy(),Qe.destroy()}const fu=j.create();function Ql(te,$,q,re,ye,be){const{horizontalAlign:Se,verticalAlign:Ie}=j.getAnchorAlignment(te),Re=-(Se-.5)*$,Fe=-(Ie-.5)*q,Ue=j.evaluateVariableOffset(te,re);return new j.pointGeometry((Re/ye+Ue[0])*be,(Fe/ye+Ue[1])*be)}function ec(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue){const Ze=te.text.placedSymbolArray,Ye=te.text.dynamicLayoutVertexArray,rt=te.icon.dynamicLayoutVertexArray,et={},tt=ki(Ie,te.getProjection(),be),nt=be.elevation,Qe=te.getProjection().upVectorScale(Ie.canonical,be.center.lat,be.worldSize);Ye.clear();for(let lt=0;lt<Ze.length;lt++){const it=Ze.get(lt),xt=te.allowVerticalPlacement&&!it.placedOrientation,gt=it.hidden||!it.crossTileID||xt?null:re[it.crossTileID];if(gt){const dt=new j.pointGeometry(it.tileAnchorX,it.tileAnchorY),vt=te.getProjection().upVector(Ie.canonical,dt.x,dt.y),_t=nt?nt.getAtTileOffset(Ie,dt.x,dt.y):0,St=ir([it.projectedAnchorX+_t*vt[0]*Qe.metersToTile,it.projectedAnchorY+_t*vt[1]*Qe.metersToTile,it.projectedAnchorZ+_t*vt[2]*Qe.metersToTile],q?tt:Se),Bt=Fs(be.getCameraToCenterDistance(te.getProjection()),St.signedDistanceFromCamera);let un=ye.evaluateSizeForFeature(te.textSizeData,Fe,it)*Bt/j.ONE_EM;q&&(un*=te.tilePixelRatio/Re);const{width:Rt,height:Xt,anchor:Qt,textOffset:gn,textScale:jt}=gt,dn=Ql(Qt,Rt,Xt,gn,jt,un);let Jt;if(q){const xn=dt.add(dn),{x:zn,y:$n,z:Wn}=te.getProjection().projectTilePoint(xn.x,xn.y,Ie.canonical);Jt=ir([zn+_t*vt[0]*Qe.metersToTile,$n+_t*vt[1]*Qe.metersToTile,Wn+_t*vt[2]*Qe.metersToTile],Se).point}else{const xn=$?dn.rotate(-be.angle):dn;Jt=[St.point[0]+xn.x,St.point[1]+xn.y,0]}const wn=te.allowVerticalPlacement&&it.placedOrientation===j.WritingMode.vertical?Math.PI/2:0;for(let xn=0;xn<it.numGlyphs;xn++)j.addDynamicAttributes(Ye,Jt[0],Jt[1],Jt[2],wn);Ue&&it.associatedIconIndex>=0&&(et[it.associatedIconIndex]={shiftedAnchor:Jt,angle:wn})}else Co(it.numGlyphs,Ye)}if(Ue){rt.clear();const lt=te.icon.placedSymbolArray;for(let it=0;it<lt.length;it++){const xt=lt.get(it);if(xt.hidden)Co(xt.numGlyphs,rt);else{const gt=et[it];if(gt)for(let dt=0;dt<xt.numGlyphs;dt++)j.addDynamicAttributes(rt,gt.shiftedAnchor[0],gt.shiftedAnchor[1],gt.shiftedAnchor[2],gt.angle);else Co(xt.numGlyphs,rt)}}te.icon.dynamicLayoutVertexBuffer.updateData(rt)}te.text.dynamicLayoutVertexBuffer.updateData(Ye)}function mu(te,$,q){return q.iconsInText&&$?"symbolTextAndIcon":te?"symbolSDF":"symbolIcon"}function tc(te,$,q,re,ye,be,Se,Ie,Re,Fe,Ue,Ze){const Ye=te.context,rt=Ye.gl,et=te.transform,tt=Ie==="map",nt=Re==="map",Qe=tt&&q.layout.get("symbol-placement")!=="point",lt=tt&&!nt&&!Qe,it=q.layout.get("symbol-sort-key").constantOr(1)!==void 0;let xt=!1;const gt=te.depthModeForSublayer(0,j.DepthMode.ReadOnly),dt=[j.mercatorXfromLng(et.center.lng),j.mercatorYfromLat(et.center.lat)],vt=q.layout.get("text-variable-anchor"),_t=et.projection.name==="globe",St=[],Bt=[0,-1,0];let un=Bt;!_t&&!et.mercatorFromTransition||tt||(un=function(Rt){const Xt=Rt._camera.getWorldToCamera(Rt.worldSize,1),Qt=j.multiply([],Xt,Rt.globeMatrix);j.invert(Qt,Qt);const gn=[0,0,0],jt=[0,1,0,0];return j.transformMat4$1(jt,jt,Qt),gn[0]=jt[0],gn[1]=jt[1],gn[2]=jt[2],j.normalize(gn,gn),gn}(et));for(const Rt of re){const Xt=$.getTile(Rt),Qt=Xt.getBucket(q);if(!Qt||Qt.projection.name==="mercator"&&_t)continue;const gn=ye?Qt.text:Qt.icon;if(!gn||Qt.fullyClipped||!gn.segments.get().length)continue;const jt=gn.programConfigurations.get(q.id),dn=ye||Qt.sdfIcons,Jt=ye?Qt.textSizeData:Qt.iconSizeData,wn=nt||et.pitch!==0,xn=j.evaluateSizeForZoom(Jt,et.zoom);let zn,$n,Wn,fr,Dn=[0,0],Qn=null;if(ye){if($n=Xt.glyphAtlasTexture,Wn=rt.LINEAR,zn=Xt.glyphAtlasTexture.size,Qt.iconsInText){Dn=Xt.imageAtlasTexture.size,Qn=Xt.imageAtlasTexture;const Ci=Jt.kind==="composite"||Jt.kind==="camera";fr=wn||te.options.rotating||te.options.zooming||Ci?rt.LINEAR:rt.NEAREST}}else{const Ci=q.layout.get("icon-size").constantOr(0)!==1||Qt.iconsNeedLinear;$n=Xt.imageAtlasTexture,Wn=dn||te.options.rotating||te.options.zooming||Ci||wn?rt.LINEAR:rt.NEAREST,zn=Xt.imageAtlasTexture.size}const Tr=Qt.projection.name==="globe",Gr=Tr?un:Bt,ei=Tr?j.globeToMercatorTransition(et.zoom):0,Dr=ki(Rt,Qt.getProjection(),et),pi=et.calculatePixelsToTileUnitsMatrix(Xt),to=ur(Dr,Xt.tileID.canonical,nt,tt,et,Qt.getProjection(),pi),fo=te.terrain&&nt&&Qe?j.invert(j.create(),to):fu,qr=Yi(Dr,Xt.tileID.canonical,nt,tt,et,Qt.getProjection(),pi),Hr=vt&&Qt.hasTextData(),cr=q.layout.get("icon-text-fit")!=="none"&&Hr&&Qt.hasIconData();if(Qe){const Ci=et.elevation,Jo=Ci?Ci.getAtTileOffsetFunc(Rt,et.center.lat,et.worldSize,Qt.getProjection()):pa=>[0,0,0],zo=hr(Dr,Xt.tileID.canonical,nt,tt,et,Qt.getProjection(),pi);$s(Qt,Dr,te,ye,zo,qr,nt,Fe,Jo,Rt)}const ii=Qe||ye&&vt||cr,xi=te.translatePosMatrix(Dr,Xt,be,Se),Ur=ii?fu:to,bi=te.translatePosMatrix(qr,Xt,be,Se,!0),Wo=Qt.getProjection().createInversionMatrix(et,Rt.canonical),Si=[];te.terrain&&nt&&Si.push("PITCH_WITH_MAP_TERRAIN"),Tr&&Si.push("PROJECTION_GLOBE_VIEW"),ii&&Si.push("PROJECTED_POS_ON_VIEWPORT");const Xo=dn&&q.paint.get(ye?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ko;Ko=dn?Qt.iconsInText?ms(Jt.kind,xn,lt,nt,te,xi,Ur,bi,zn,Dn,Rt,ei,dt,Wo,Gr,Qt.getProjection()):Jl(Jt.kind,xn,lt,nt,te,xi,Ur,bi,ye,zn,!0,Rt,ei,dt,Wo,Gr,Qt.getProjection()):Yl(Jt.kind,xn,lt,nt,te,xi,Ur,bi,ye,zn,Rt,ei,dt,Wo,Gr,Qt.getProjection());const Yo={program:te.useProgram(mu(dn,ye,Qt),jt,Si),buffers:gn,uniformValues:Ko,atlasTexture:$n,atlasTextureIcon:Qn,atlasInterpolation:Wn,atlasInterpolationIcon:fr,isSDF:dn,hasHalo:Xo,tile:Xt,labelPlaneMatrixInv:fo};if(it&&Qt.canOverlap){xt=!0;const Ci=gn.segments.get();for(const Jo of Ci)St.push({segments:new j.SegmentVector([Jo]),sortKey:Jo.sortKey,state:Yo})}else St.push({segments:gn.segments,sortKey:0,state:Yo})}xt&&St.sort((Rt,Xt)=>Rt.sortKey-Xt.sortKey);for(const Rt of St){const Xt=Rt.state;if(te.terrain&&te.terrain.setupElevationDraw(Xt.tile,Xt.program,{useDepthForOcclusion:!_t,labelPlaneMatrixInv:Xt.labelPlaneMatrixInv}),Ye.activeTexture.set(rt.TEXTURE0),Xt.atlasTexture.bind(Xt.atlasInterpolation,rt.CLAMP_TO_EDGE),Xt.atlasTextureIcon&&(Ye.activeTexture.set(rt.TEXTURE1),Xt.atlasTextureIcon&&Xt.atlasTextureIcon.bind(Xt.atlasInterpolationIcon,rt.CLAMP_TO_EDGE)),Xt.isSDF){const Qt=Xt.uniformValues;Xt.hasHalo&&(Qt.u_is_halo=1,nc(Xt.buffers,Rt.segments,q,te,Xt.program,gt,Ue,Ze,Qt)),Qt.u_is_halo=0}nc(Xt.buffers,Rt.segments,q,te,Xt.program,gt,Ue,Ze,Xt.uniformValues)}}function nc(te,$,q,re,ye,be,Se,Ie,Re){const Fe=re.context,Ue=[te.dynamicLayoutVertexBuffer,te.opacityVertexBuffer,te.globeExtVertexBuffer];ye.draw(Fe,Fe.gl.TRIANGLES,be,Se,Ie,j.CullFaceMode.disabled,Re,q.id,te.layoutVertexBuffer,te.indexBuffer,$,q.paint,re.transform.zoom,te.programConfigurations.get(q.id),Ue)}function Xa(te,$,q,re,ye,be,Se){const Ie=te.context.gl,Re=q.paint.get("fill-pattern"),Fe=Re&&Re.constantOr(1),Ue=q.getCrossfadeParameters();let Ze,Ye,rt,et,tt;Se?(Ye=Fe&&!q.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ze=Ie.LINES):(Ye=Fe?"fillPattern":"fill",Ze=Ie.TRIANGLES);for(const nt of re){const Qe=$.getTile(nt);if(Fe&&!Qe.patternsLoaded())continue;const lt=Qe.getBucket(q);if(!lt)continue;te.prepareDrawTile();const it=lt.programConfigurations.get(q.id),xt=te.useProgram(Ye,it);Fe&&(te.context.activeTexture.set(Ie.TEXTURE0),Qe.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),it.updatePaintBuffers(Ue));const gt=Re.constantOr(null);if(gt&&Qe.imageAtlas){const vt=Qe.imageAtlas,_t=vt.patternPositions[gt.to.toString()],St=vt.patternPositions[gt.from.toString()];_t&&St&&it.setConstantPatternPositions(_t,St)}const dt=te.translatePosMatrix(nt.projMatrix,Qe,q.paint.get("fill-translate"),q.paint.get("fill-translate-anchor"));if(Se){et=lt.indexBuffer2,tt=lt.segments2;const vt=te.terrain&&te.terrain.renderingToTexture?te.terrain.drapeBufferSize:[Ie.drawingBufferWidth,Ie.drawingBufferHeight];rt=Ye==="fillOutlinePattern"&&Fe?Hl(dt,te,Ue,Qe,vt):io(dt,vt)}else et=lt.indexBuffer,tt=lt.segments,rt=Fe?Va(dt,te,Ue,Qe):Ks(dt);te.prepareDrawProgram(te.context,xt,nt.toUnwrapped()),xt.draw(te.context,Ze,ye,te.stencilModeForClipping(nt),be,j.CullFaceMode.disabled,rt,q.id,lt.layoutVertexBuffer,et,tt,q.paint,te.transform.zoom,it)}}function uo(te,$,q,re,ye,be,Se){const Ie=te.context,Re=Ie.gl,Fe=te.transform,Ue=q.paint.get("fill-extrusion-pattern"),Ze=Ue.constantOr(1),Ye=q.getCrossfadeParameters(),rt=q.paint.get("fill-extrusion-opacity"),et=[q.paint.get("fill-extrusion-ambient-occlusion-intensity"),q.paint.get("fill-extrusion-ambient-occlusion-radius")],tt=q.layout.get("fill-extrusion-edge-radius"),nt=Fe.projection.name==="globe"?j.fillExtrusionHeightLift():0,Qe=Fe.projection.name==="globe",lt=Qe?j.globeToMercatorTransition(Fe.zoom):0,it=[j.mercatorXfromLng(Fe.center.lng),j.mercatorYfromLat(Fe.center.lat)],xt=[];Qe&&(xt.push("PROJECTION_GLOBE_VIEW"),te.style.terrainSetForDrapingOnly()&&xt.push("TERRAIN")),et[0]>0&&xt.push("FAUX_AO");for(const gt of re){const dt=$.getTile(gt),vt=dt.getBucket(q);if(!vt||vt.projection.name!==Fe.projection.name)continue;const _t=vt.programConfigurations.get(q.id),St=te.useProgram(Ze?"fillExtrusionPattern":"fillExtrusion",_t,xt);if(te.terrain){const jt=te.terrain;if(te.style.terrainSetForDrapingOnly())jt.setupElevationDraw(dt,St,{useMeterToDem:!0});else{if(!vt.enableTerrain)continue;if(jt.setupElevationDraw(dt,St,{useMeterToDem:!0}),Ys(Ie,$,gt,vt,q,jt),!vt.centroidVertexBuffer){const dn=St.attributes.a_centroid_pos;dn!==void 0&&Re.vertexAttrib2f(dn,0,0)}}}Ze&&(te.context.activeTexture.set(Re.TEXTURE0),dt.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),_t.updatePaintBuffers(Ye));const Bt=Ue.constantOr(null);if(Bt&&dt.imageAtlas){const jt=dt.imageAtlas,dn=jt.patternPositions[Bt.to.toString()],Jt=jt.patternPositions[Bt.from.toString()];dn&&Jt&&_t.setConstantPatternPositions(dn,Jt)}const un=te.translatePosMatrix(gt.projMatrix,dt,q.paint.get("fill-extrusion-translate"),q.paint.get("fill-extrusion-translate-anchor")),Rt=Fe.projection.createInversionMatrix(Fe,gt.canonical),Xt=q.paint.get("fill-extrusion-vertical-gradient"),Qt=Ze?au(un,te,Xt,rt,et,tt,gt,Ye,dt,nt,lt,it,Rt):fs(un,te,Xt,rt,et,tt,gt,nt,lt,it,Rt);te.prepareDrawProgram(Ie,St,gt.toUnwrapped());const gn=[];te.terrain&&gn.push(vt.centroidVertexBuffer),Qe&&gn.push(vt.layoutVertexExtBuffer),St.draw(Ie,Ie.gl.TRIANGLES,ye,be,Se,j.CullFaceMode.backCCW,Qt,q.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,q.paint,te.transform.zoom,_t,gn)}}function Ys(te,$,q,re,ye,be){const Se=[Qe=>{let lt=Qe.canonical.x-1,it=Qe.wrap;return lt<0&&(lt=(1<<Qe.canonical.z)-1,it--),new j.OverscaledTileID(Qe.overscaledZ,it,Qe.canonical.z,lt,Qe.canonical.y)},Qe=>{let lt=Qe.canonical.x+1,it=Qe.wrap;return lt===1<<Qe.canonical.z&&(lt=0,it++),new j.OverscaledTileID(Qe.overscaledZ,it,Qe.canonical.z,lt,Qe.canonical.y)},Qe=>new j.OverscaledTileID(Qe.overscaledZ,Qe.wrap,Qe.canonical.z,Qe.canonical.x,(Qe.canonical.y===0?1<<Qe.canonical.z:Qe.canonical.y)-1),Qe=>new j.OverscaledTileID(Qe.overscaledZ,Qe.wrap,Qe.canonical.z,Qe.canonical.x,Qe.canonical.y===(1<<Qe.canonical.z)-1?0:Qe.canonical.y+1)],Ie=Qe=>{const lt=$.getSource().minzoom,it=gt=>{const dt=$.getTileByID(gt);if(dt&&dt.hasData())return dt.getBucket(ye)},xt=[0,-1,1];for(const gt of xt){if(Qe.overscaledZ+gt<lt)continue;const dt=it(Qe.calculateScaledKey(Qe.overscaledZ+gt));if(dt)return dt}},Re=[0,0,0],Fe=(Qe,lt)=>(Re[0]=Math.min(Qe.min.y,lt.min.y),Re[1]=Math.max(Qe.max.y,lt.max.y),Re[2]=j.EXTENT-lt.min.x>Qe.max.x?lt.min.x-j.EXTENT:Qe.max.x,Re),Ue=(Qe,lt)=>(Re[0]=Math.min(Qe.min.x,lt.min.x),Re[1]=Math.max(Qe.max.x,lt.max.x),Re[2]=j.EXTENT-lt.min.y>Qe.max.y?lt.min.y-j.EXTENT:Qe.max.y,Re),Ze=[(Qe,lt)=>Fe(Qe,lt),(Qe,lt)=>Fe(lt,Qe),(Qe,lt)=>Ue(Qe,lt),(Qe,lt)=>Ue(lt,Qe)],Ye=new j.pointGeometry(0,0);let rt,et,tt;const nt=(Qe,lt,it,xt,gt)=>{const dt=[[xt?it:Qe,xt?Qe:it,0],[xt?it:lt,xt?lt:it,0]],vt=gt<0?j.EXTENT+gt:gt,_t=[xt?vt:(Qe+lt)/2,xt?(Qe+lt)/2:vt,0];return it===0&&gt<0||it!==0&&gt>0?be.getForTilePoints(tt,[_t],!0,et):dt.push(_t),be.getForTilePoints(q,dt,!0,rt),Math.max(dt[0][2],dt[1][2],_t[2])/be.exaggeration()};for(let Qe=0;Qe<4;Qe++){const lt=(Qe<2?1:5)-Qe,it=re.borders[Qe];if(it.length===0)continue;const xt=tt=Se[Qe](q),gt=Ie(xt);if(!(gt&&gt instanceof j.FillExtrusionBucket&&gt.enableTerrain)||re.borderDoneWithNeighborZ[Qe]===gt.canonical.z&&gt.borderDoneWithNeighborZ[lt]===re.canonical.z||(et=be.findDEMTileFor(xt),!et||!et.dem))continue;if(!rt){const St=be.findDEMTileFor(q);if(!St||!St.dem)return;rt=St}const dt=gt.borders[lt];let vt=0;const _t=gt.borderDoneWithNeighborZ[lt]!==re.canonical.z;if(re.canonical.z===gt.canonical.z){for(let St=0;St<it.length;St++){const Bt=re.featuresOnBorder[it[St]],un=Bt.borders[Qe];let Rt;for(;vt<dt.length&&(Rt=gt.featuresOnBorder[dt[vt]],!(Rt.borders[lt][1]>un[0]+3));)_t&&gt.encodeCentroid(void 0,Rt,!1),vt++;if(Rt&&vt<dt.length){const Xt=vt;let Qt=0;for(;!(Rt.borders[lt][0]>un[1]-3)&&(Qt++,++vt!==dt.length);)Rt=gt.featuresOnBorder[dt[vt]];if(Rt=gt.featuresOnBorder[dt[Xt]],Bt.intersectsCount()>1||Rt.intersectsCount()>1||Qt!==1){Qt!==1&&(vt=Xt),re.encodeCentroid(void 0,Bt,!1),_t&&gt.encodeCentroid(void 0,Rt,!1);continue}const gn=Ze[Qe](Bt,Rt),jt=Qe%2?j.EXTENT-1:0;Ye.x=nt(gn[0],Math.min(j.EXTENT-1,gn[1]),jt,Qe<2,gn[2]),Ye.y=0,re.encodeCentroid(Ye,Bt,!1),_t&&gt.encodeCentroid(Ye,Rt,!1)}else re.encodeCentroid(void 0,Bt,!1)}re.borderDoneWithNeighborZ[Qe]=gt.canonical.z,re.needsCentroidUpdate=!0,_t&&(gt.borderDoneWithNeighborZ[lt]=re.canonical.z,gt.needsCentroidUpdate=!0)}else{for(const St of it)re.encodeCentroid(void 0,re.featuresOnBorder[St],!1);if(_t){for(const St of dt)gt.encodeCentroid(void 0,gt.featuresOnBorder[St],!1);gt.borderDoneWithNeighborZ[lt]=re.canonical.z,gt.needsCentroidUpdate=!0}re.borderDoneWithNeighborZ[Qe]=gt.canonical.z,re.needsCentroidUpdate=!0}}(re.needsCentroidUpdate||!re.centroidVertexBuffer&&re.centroidVertexArray.length!==0)&&re.uploadCentroid(te)}const _u=new j.Color(1,0,0,1),_s=new j.Color(0,1,0,1),gs=new j.Color(0,0,1,1),gu=new j.Color(1,0,1,1),rc=new j.Color(0,1,1,1);function Sr(te,$,q){const re=te.context,ye=te.transform,be=re.gl,Se=ye.projection.name==="globe",Ie=Se?["PROJECTION_GLOBE_VIEW"]:null;let Re=q.projMatrix;if(Se&&j.globeToMercatorTransition(ye.zoom)>0){const Bt=j.transitionTileAABBinECEF(q.canonical,ye),un=j.globeDenormalizeECEF(Bt);Re=j.multiply(new Float32Array(16),ye.globeMatrix,un),j.multiply(Re,ye.projMatrix,Re)}const Fe=te.useProgram("debug",null,Ie),Ue=$.getTileByID(q.key);te.terrain&&te.terrain.setupElevationDraw(Ue,Fe);const Ze=j.DepthMode.disabled,Ye=j.StencilMode.disabled,rt=te.colorModeForRenderPass(),et="$debug";re.activeTexture.set(be.TEXTURE0),te.emptyTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se?Ue._makeGlobeTileDebugBuffers(te.context,ye):Ue._makeDebugTileBoundsBuffers(te.context,ye.projection);const tt=Ue._tileDebugBuffer||te.debugBuffer,nt=Ue._tileDebugIndexBuffer||te.debugIndexBuffer,Qe=Ue._tileDebugSegments||te.debugSegments;Fe.draw(re,be.LINE_STRIP,Ze,Ye,rt,j.CullFaceMode.disabled,uu(Re,j.Color.red),et,tt,nt,Qe,null,null,null,[Ue._globeTileDebugBorderBuffer]);const lt=Ue.latestRawTileData,it=Math.floor((lt&&lt.byteLength||0)/1024),xt=$.getTile(q).tileSize,gt=512/Math.min(xt,512)*(q.overscaledZ/ye.zoom)*.5;let dt=q.canonical.toString();q.overscaledZ!==q.canonical.z&&(dt+=` => ${q.overscaledZ}`),dt+=` ${it}kb`,function(Bt,un){Bt.initDebugOverlayCanvas();const Rt=Bt.debugOverlayCanvas,Xt=Bt.context.gl,Qt=Bt.debugOverlayCanvas.getContext("2d");Qt.clearRect(0,0,Rt.width,Rt.height),Qt.shadowColor="white",Qt.shadowBlur=2,Qt.lineWidth=1.5,Qt.strokeStyle="white",Qt.textBaseline="top",Qt.font="bold 36px Open Sans, sans-serif",Qt.fillText(un,5,5),Qt.strokeText(un,5,5),Bt.debugOverlayTexture.update(Rt),Bt.debugOverlayTexture.bind(Xt.LINEAR,Xt.CLAMP_TO_EDGE)}(te,dt);const vt=Ue._tileDebugTextBuffer||te.debugBuffer,_t=Ue._tileDebugTextIndexBuffer||te.quadTriangleIndexBuffer,St=Ue._tileDebugTextSegments||te.debugSegments;Fe.draw(re,be.TRIANGLES,Ze,Ye,j.ColorMode.alphaBlended,j.CullFaceMode.disabled,uu(Re,j.Color.transparent,gt),et,vt,_t,St,null,null,null,[Ue._globeTileDebugTextBuffer])}function Js(te,$,q,re){Qs(te,0,$+q/2,te.transform.width,q,re)}function yu(te,$,q,re){Qs(te,$-q/2,0,q,te.transform.height,re)}function Qs(te,$,q,re,ye,be){const Se=te.context,Ie=Se.gl;Ie.enable(Ie.SCISSOR_TEST),Ie.scissor($*j.exported.devicePixelRatio,q*j.exported.devicePixelRatio,re*j.exported.devicePixelRatio,ye*j.exported.devicePixelRatio),Se.clear({color:be}),Ie.disable(Ie.SCISSOR_TEST)}const ea=j.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gh}=ea;function Ro(te,$,q,re){te.emplaceBack($,q,re)}class ic{constructor($){this.vertexArray=new j.StructArrayLayout3f12,this.indices=new j.StructArrayLayout3ui6,Ro(this.vertexArray,-1,-1,1),Ro(this.vertexArray,1,-1,1),Ro(this.vertexArray,-1,1,1),Ro(this.vertexArray,1,1,1),Ro(this.vertexArray,-1,-1,-1),Ro(this.vertexArray,1,-1,-1),Ro(this.vertexArray,-1,1,-1),Ro(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=$.createVertexBuffer(this.vertexArray,Gh),this.indexBuffer=$.createIndexBuffer(this.indices),this.segment=j.SegmentVector.simpleSegment(0,0,36,12)}}function ys(te,$,q,re,ye,be){const Se=te.gl,Ie=$.paint.get("sky-atmosphere-color"),Re=$.paint.get("sky-atmosphere-halo-color"),Fe=$.paint.get("sky-atmosphere-sun-intensity"),Ue=((Ze,Ye,rt,et,tt)=>({u_matrix_3f:Ze,u_sun_direction:Ye,u_sun_intensity:rt,u_color_tint_r:[et.r,et.g,et.b,et.a],u_color_tint_m:[tt.r,tt.g,tt.b,tt.a],u_luminance:5e-5}))(j.fromMat4(j.create$1(),re),ye,Fe,Ie,Re);Se.framebufferTexture2D(Se.FRAMEBUFFER,Se.COLOR_ATTACHMENT0,Se.TEXTURE_CUBE_MAP_POSITIVE_X+be,$.skyboxTexture,0),q.draw(te,Se.TRIANGLES,j.DepthMode.disabled,j.StencilMode.disabled,j.ColorMode.unblended,j.CullFaceMode.frontCW,Ue,"skyboxCapture",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}const oc=j.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ka{constructor($){const q=new j.StructArrayLayout5f20;q.emplaceBack(-1,1,1,0,0),q.emplaceBack(1,1,1,1,0),q.emplaceBack(1,-1,1,1,1),q.emplaceBack(-1,-1,1,0,1);const re=new j.StructArrayLayout3ui6;re.emplaceBack(0,1,2),re.emplaceBack(2,3,0),this.vertexBuffer=$.createVertexBuffer(q,oc.members),this.indexBuffer=$.createIndexBuffer(re),this.segments=j.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const vs={symbol:function(te,$,q,re,ye){if(te.renderPass!=="translucent")return;const be=j.StencilMode.disabled,Se=te.colorModeForRenderPass();q.layout.get("text-variable-anchor")&&function(Ie,Re,Fe,Ue,Ze,Ye,rt){const et=Re.transform,tt=Ze==="map",nt=Ye==="map";for(const Qe of Ie){const lt=Ue.getTile(Qe),it=lt.getBucket(Fe);if(!it||!it.text||!it.text.segments.get().length)continue;const xt=j.evaluateSizeForZoom(it.textSizeData,et.zoom),gt=ki(Qe,it.getProjection(),et),dt=et.calculatePixelsToTileUnitsMatrix(lt),vt=ur(gt,lt.tileID.canonical,nt,tt,et,it.getProjection(),dt),_t=Fe.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(xt){const St=Math.pow(2,et.zoom-lt.tileID.overscaledZ);ec(it,tt,nt,rt,j.symbolSize,et,vt,Qe,St,xt,_t)}}}(re,te,q,$,q.layout.get("text-rotation-alignment"),q.layout.get("text-pitch-alignment"),ye),q.paint.get("icon-opacity").constantOr(1)!==0&&tc(te,$,q,re,!1,q.paint.get("icon-translate"),q.paint.get("icon-translate-anchor"),q.layout.get("icon-rotation-alignment"),q.layout.get("icon-pitch-alignment"),q.layout.get("icon-keep-upright"),be,Se),q.paint.get("text-opacity").constantOr(1)!==0&&tc(te,$,q,re,!0,q.paint.get("text-translate"),q.paint.get("text-translate-anchor"),q.layout.get("text-rotation-alignment"),q.layout.get("text-pitch-alignment"),q.layout.get("text-keep-upright"),be,Se),$.map.showCollisionBoxes&&(pu(te,$,q,re,q.paint.get("text-translate"),q.paint.get("text-translate-anchor"),!0),pu(te,$,q,re,q.paint.get("icon-translate"),q.paint.get("icon-translate-anchor"),!1))},circle:function(te,$,q,re){if(te.renderPass!=="translucent")return;const ye=q.paint.get("circle-opacity"),be=q.paint.get("circle-stroke-width"),Se=q.paint.get("circle-stroke-opacity"),Ie=q.layout.get("circle-sort-key").constantOr(1)!==void 0;if(ye.constantOr(1)===0&&(be.constantOr(1)===0||Se.constantOr(1)===0))return;const Re=te.context,Fe=Re.gl,Ue=te.transform,Ze=te.depthModeForSublayer(0,j.DepthMode.ReadOnly),Ye=j.StencilMode.disabled,rt=te.colorModeForRenderPass(),et=Ue.projection.name==="globe",tt=[j.mercatorXfromLng(Ue.center.lng),j.mercatorYfromLat(Ue.center.lat)],nt=[];for(let lt=0;lt<re.length;lt++){const it=re[lt],xt=$.getTile(it),gt=xt.getBucket(q);if(!gt||gt.projection.name!==Ue.projection.name)continue;const dt=gt.programConfigurations.get(q.id),vt=cu(q);et&&vt.push("PROJECTION_GLOBE_VIEW");const _t=te.useProgram("circle",dt,vt),St=gt.layoutVertexBuffer,Bt=gt.globeExtVertexBuffer,un=gt.indexBuffer,Rt=Ue.projection.createInversionMatrix(Ue,it.canonical),Xt={programConfiguration:dt,program:_t,layoutVertexBuffer:St,globeExtVertexBuffer:Bt,indexBuffer:un,uniformValues:Wl(te,it,xt,Rt,tt,q),tile:xt};if(Ie){const Qt=gt.segments.get();for(const gn of Qt)nt.push({segments:new j.SegmentVector([gn]),sortKey:gn.sortKey,state:Xt})}else nt.push({segments:gt.segments,sortKey:0,state:Xt})}Ie&&nt.sort((lt,it)=>lt.sortKey-it.sortKey);const Qe={useDepthForOcclusion:!et};for(const lt of nt){const{programConfiguration:it,program:xt,layoutVertexBuffer:gt,globeExtVertexBuffer:dt,indexBuffer:vt,uniformValues:_t,tile:St}=lt.state,Bt=lt.segments;te.terrain&&te.terrain.setupElevationDraw(St,xt,Qe),te.prepareDrawProgram(Re,xt,St.tileID.toUnwrapped()),xt.draw(Re,Fe.TRIANGLES,Ze,Ye,rt,j.CullFaceMode.disabled,_t,q.id,gt,vt,Bt,q.paint,Ue.zoom,it,[dt])}},heatmap:function(te,$,q,re){if(q.paint.get("heatmap-opacity")!==0)if(te.renderPass==="offscreen"){const ye=te.context,be=ye.gl,Se=j.StencilMode.disabled,Ie=new j.ColorMode([be.ONE,be.ONE],j.Color.transparent,[!0,!0,!0,!0]);(function(rt,et,tt,nt){const Qe=rt.gl,lt=et.width*nt,it=et.height*nt;rt.activeTexture.set(Qe.TEXTURE1),rt.viewport.set([0,0,lt,it]);let xt=tt.heatmapFbo;if(!xt||xt&&(xt.width!==lt||xt.height!==it)){xt&&xt.destroy();const gt=Qe.createTexture();Qe.bindTexture(Qe.TEXTURE_2D,gt),Qe.texParameteri(Qe.TEXTURE_2D,Qe.TEXTURE_WRAP_S,Qe.CLAMP_TO_EDGE),Qe.texParameteri(Qe.TEXTURE_2D,Qe.TEXTURE_WRAP_T,Qe.CLAMP_TO_EDGE),Qe.texParameteri(Qe.TEXTURE_2D,Qe.TEXTURE_MIN_FILTER,Qe.LINEAR),Qe.texParameteri(Qe.TEXTURE_2D,Qe.TEXTURE_MAG_FILTER,Qe.LINEAR),xt=tt.heatmapFbo=rt.createFramebuffer(lt,it,!1),function(dt,vt,_t,St,Bt,un){const Rt=dt.gl;Rt.texImage2D(Rt.TEXTURE_2D,0,Rt.RGBA,Bt,un,0,Rt.RGBA,dt.extRenderToTextureHalfFloat?dt.extTextureHalfFloat.HALF_FLOAT_OES:Rt.UNSIGNED_BYTE,null),St.colorAttachment.set(_t)}(rt,0,gt,xt,lt,it)}else Qe.bindTexture(Qe.TEXTURE_2D,xt.colorAttachment.get()),rt.bindFramebuffer.set(xt.framebuffer)})(ye,te,q,te.transform.projection.name==="globe"?.5:.25),ye.clear({color:j.Color.transparent});const Re=te.transform,Fe=Re.projection.name==="globe",Ue=Fe?["PROJECTION_GLOBE_VIEW"]:null,Ze=Fe?j.CullFaceMode.frontCCW:j.CullFaceMode.disabled,Ye=[j.mercatorXfromLng(Re.center.lng),j.mercatorYfromLat(Re.center.lat)];for(let rt=0;rt<re.length;rt++){const et=re[rt];if($.hasRenderableParent(et))continue;const tt=$.getTile(et),nt=tt.getBucket(q);if(!nt||nt.projection.name!==Re.projection.name)continue;const Qe=nt.programConfigurations.get(q.id),lt=te.useProgram("heatmap",Qe,Ue),{zoom:it}=te.transform;te.terrain&&te.terrain.setupElevationDraw(tt,lt),te.prepareDrawProgram(ye,lt,et.toUnwrapped());const xt=Re.projection.createInversionMatrix(Re,et.canonical);lt.draw(ye,be.TRIANGLES,j.DepthMode.disabled,Se,Ie,Ze,Fh(te,et,tt,xt,Ye,it,q.paint.get("heatmap-intensity")),q.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,q.paint,te.transform.zoom,Qe,Fe?[nt.globeExtVertexBuffer]:null)}ye.viewport.set([0,0,te.width,te.height])}else te.renderPass==="translucent"&&(te.context.setColorMode(te.colorModeForRenderPass()),function(ye,be){const Se=ye.context,Ie=Se.gl,Re=be.heatmapFbo;if(!Re)return;Se.activeTexture.set(Ie.TEXTURE0),Ie.bindTexture(Ie.TEXTURE_2D,Re.colorAttachment.get()),Se.activeTexture.set(Ie.TEXTURE1);let Fe=be.colorRampTexture;Fe||(Fe=be.colorRampTexture=new j.Texture(Se,be.colorRamp,Ie.RGBA)),Fe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),ye.useProgram("heatmapTexture").draw(Se,Ie.TRIANGLES,j.DepthMode.disabled,j.StencilMode.disabled,ye.colorModeForRenderPass(),j.CullFaceMode.disabled,((Ue,Ze,Ye,rt)=>({u_image:0,u_color_ramp:1,u_opacity:Ze.paint.get("heatmap-opacity")}))(0,be),be.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments,be.paint,ye.transform.zoom)}(te,q))},line:function(te,$,q,re){if(te.renderPass!=="translucent")return;const ye=q.paint.get("line-opacity"),be=q.paint.get("line-width");if(ye.constantOr(1)===0||be.constantOr(1)===0)return;const Se=te.depthModeForSublayer(0,j.DepthMode.ReadOnly),Ie=te.colorModeForRenderPass(),Re=te.terrain&&te.terrain.renderingToTexture?1:j.exported.devicePixelRatio,Fe=q.paint.get("line-dasharray"),Ue=Fe.constantOr(1),Ze=q.layout.get("line-cap"),Ye=q.paint.get("line-pattern"),rt=Ye.constantOr(1),et=q.paint.get("line-gradient"),tt=q.getCrossfadeParameters(),nt=rt?"linePattern":"line",Qe=te.context,lt=Qe.gl,it=(gt=>{const dt=[];Za(gt)&&dt.push("RENDER_LINE_DASH"),gt.paint.get("line-gradient")&&dt.push("RENDER_LINE_GRADIENT");const vt=gt.paint.get("line-trim-offset");vt[0]===0&&vt[1]===0||dt.push("RENDER_LINE_TRIM_OFFSET");const _t=gt.paint.get("line-pattern").constantOr(1),St=gt.paint.get("line-opacity").constantOr(1)!==1;return!_t&&St&&dt.push("RENDER_LINE_ALPHA_DISCARD"),dt})(q);let xt=it.includes("RENDER_LINE_ALPHA_DISCARD");te.terrain&&te.terrain.clipOrMaskOverlapStencilType()&&(xt=!1);for(const gt of re){const dt=$.getTile(gt);if(rt&&!dt.patternsLoaded())continue;const vt=dt.getBucket(q);if(!vt)continue;te.prepareDrawTile();const _t=vt.programConfigurations.get(q.id),St=te.useProgram(nt,_t,it),Bt=Ye.constantOr(null);if(Bt&&dt.imageAtlas){const Jt=dt.imageAtlas,wn=Jt.patternPositions[Bt.to.toString()],xn=Jt.patternPositions[Bt.from.toString()];wn&&xn&&_t.setConstantPatternPositions(wn,xn)}const un=Fe.constantOr(null),Rt=Ze.constantOr(null);if(!rt&&un&&Rt&&dt.lineAtlas){const Jt=dt.lineAtlas,wn=Jt.getDash(un.to,Rt),xn=Jt.getDash(un.from,Rt);wn&&xn&&_t.setConstantPatternPositions(wn,xn)}let[Xt,Qt]=q.paint.get("line-trim-offset");(Rt==="round"||Rt==="square")&&Xt!==Qt&&(Xt===0&&(Xt-=1),Qt===1&&(Qt+=1));const gn=te.terrain?gt.projMatrix:null,jt=rt?Uh(te,dt,q,tt,gn,Re):Ga(te,dt,q,tt,gn,vt.lineClipsArray.length,Re,[Xt,Qt]);if(et){const Jt=vt.gradients[q.id];let wn=Jt.texture;if(q.gradientVersion!==Jt.version){let xn=256;if(q.stepInterpolant){const zn=$.getSource().maxzoom,$n=gt.canonical.z===zn?Math.ceil(1<<te.transform.maxZoom-gt.canonical.z):1;xn=j.clamp(j.nextPowerOfTwo(vt.maxLineLength/j.EXTENT*1024*$n),256,Qe.maxTextureSize)}Jt.gradient=j.renderColorRamp({expression:q.gradientExpression(),evaluationKey:"lineProgress",resolution:xn,image:Jt.gradient||void 0,clips:vt.lineClipsArray}),Jt.texture?Jt.texture.update(Jt.gradient):Jt.texture=new j.Texture(Qe,Jt.gradient,lt.RGBA),Jt.version=q.gradientVersion,wn=Jt.texture}Qe.activeTexture.set(lt.TEXTURE1),wn.bind(q.stepInterpolant?lt.NEAREST:lt.LINEAR,lt.CLAMP_TO_EDGE)}Ue&&(Qe.activeTexture.set(lt.TEXTURE0),dt.lineAtlasTexture.bind(lt.LINEAR,lt.REPEAT),_t.updatePaintBuffers(tt)),rt&&(Qe.activeTexture.set(lt.TEXTURE0),dt.imageAtlasTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),_t.updatePaintBuffers(tt)),te.prepareDrawProgram(Qe,St,gt.toUnwrapped());const dn=Jt=>{St.draw(Qe,lt.TRIANGLES,Se,Jt,Ie,j.CullFaceMode.disabled,jt,q.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,q.paint,te.transform.zoom,_t,[vt.layoutVertexBuffer2])};if(xt){const Jt=te.stencilModeForClipping(gt).ref;Jt===0&&te.terrain&&Qe.clear({stencil:0});const wn={func:lt.EQUAL,mask:255};jt.u_alpha_discard_threshold=.8,dn(new j.StencilMode(wn,Jt,255,lt.KEEP,lt.KEEP,lt.INVERT)),jt.u_alpha_discard_threshold=0,dn(new j.StencilMode(wn,Jt,255,lt.KEEP,lt.KEEP,lt.KEEP))}else dn(te.stencilModeForClipping(gt))}xt&&(te.resetStencilClippingMasks(),te.terrain&&Qe.clear({stencil:0}))},fill:function(te,$,q,re){const ye=q.paint.get("fill-color"),be=q.paint.get("fill-opacity");if(be.constantOr(1)===0)return;const Se=te.colorModeForRenderPass(),Ie=q.paint.get("fill-pattern"),Re=te.opaquePassEnabledForLayer()&&!Ie.constantOr(1)&&ye.constantOr(j.Color.transparent).a===1&&be.constantOr(0)===1?"opaque":"translucent";if(te.renderPass===Re){const Fe=te.depthModeForSublayer(1,te.renderPass==="opaque"?j.DepthMode.ReadWrite:j.DepthMode.ReadOnly);Xa(te,$,q,re,Fe,Se,!1)}if(te.renderPass==="translucent"&&q.paint.get("fill-antialias")){const Fe=te.depthModeForSublayer(q.getPaintProperty("fill-outline-color")?2:0,j.DepthMode.ReadOnly);Xa(te,$,q,re,Fe,Se,!0)}},"fill-extrusion":function(te,$,q,re){const ye=q.paint.get("fill-extrusion-opacity");if(ye!==0&&te.renderPass==="translucent"){const be=new j.DepthMode(te.context.gl.LEQUAL,j.DepthMode.ReadWrite,te.depthRangeFor3D);if(ye!==1||q.paint.get("fill-extrusion-pattern").constantOr(1))uo(te,$,q,re,be,j.StencilMode.disabled,j.ColorMode.disabled),uo(te,$,q,re,be,te.stencilModeFor3D(),te.colorModeForRenderPass()),te.resetStencilClippingMasks();else{const Se=te.colorModeForRenderPass();uo(te,$,q,re,be,j.StencilMode.disabled,Se)}}},hillshade:function(te,$,q,re){if(te.renderPass!=="offscreen"&&te.renderPass!=="translucent")return;const ye=te.context,be=te.depthModeForSublayer(0,j.DepthMode.ReadOnly),Se=te.colorModeForRenderPass(),Ie=te.terrain&&te.terrain.renderingToTexture,[Re,Fe]=te.renderPass!=="translucent"||Ie?[{},re]:te.stencilConfigForOverlap(re);for(const Ue of Fe){const Ze=$.getTile(Ue);if(Ze.needsHillshadePrepare&&te.renderPass==="offscreen")ps(te,Ze,q,be,j.StencilMode.disabled,Se);else if(te.renderPass==="translucent"){const Ye=Ie&&te.terrain?te.terrain.stencilModeForRTTOverlap(Ue):Re[Ue.overscaledZ];Ul(te,Ue,Ze,q,be,Ye,Se)}}ye.viewport.set([0,0,te.width,te.height]),te.resetStencilClippingMasks()},raster:function(te,$,q,re,ye,be){if(te.renderPass!=="translucent"||q.paint.get("raster-opacity")===0||!re.length)return;const Se=te.context,Ie=Se.gl,Re=$.getSource(),Fe=te.useProgram("raster"),Ue=te.colorModeForRenderPass(),Ze=te.terrain&&te.terrain.renderingToTexture,[Ye,rt]=Re instanceof kt||Ze?[{},re]:te.stencilConfigForOverlap(re),et=rt[rt.length-1].overscaledZ,tt=!te.options.moving;for(const nt of rt){const Qe=Ze?j.DepthMode.disabled:te.depthModeForSublayer(nt.overscaledZ-et,q.paint.get("raster-opacity")===1?j.DepthMode.ReadWrite:j.DepthMode.ReadOnly,Ie.LESS),lt=nt.toUnwrapped(),it=$.getTile(nt);if(Ze&&(!it||!it.hasData()))continue;const xt=Ze?nt.projMatrix:te.transform.calculateProjMatrix(lt,tt),gt=te.terrain&&Ze?te.terrain.stencilModeForRTTOverlap(nt):Ye[nt.overscaledZ],dt=be?0:q.paint.get("raster-fade-duration");it.registerFadeDuration(dt);const vt=$.findLoadedParent(nt,0),_t=Na(it,vt,$,te.transform,dt);let St,Bt;te.terrain&&te.terrain.prepareDrawTile();const un=q.paint.get("raster-resampling")==="nearest"?Ie.NEAREST:Ie.LINEAR;Se.activeTexture.set(Ie.TEXTURE0),it.texture.bind(un,Ie.CLAMP_TO_EDGE),Se.activeTexture.set(Ie.TEXTURE1),vt?(vt.texture.bind(un,Ie.CLAMP_TO_EDGE),St=Math.pow(2,vt.tileID.overscaledZ-it.tileID.overscaledZ),Bt=[it.tileID.canonical.x*St%1,it.tileID.canonical.y*St%1]):it.texture.bind(un,Ie.CLAMP_TO_EDGE);const Rt=$h(xt,Bt||[0,0],St||1,_t,q,Re instanceof kt?Re.perspectiveTransform:[0,0]);if(te.prepareDrawProgram(Se,Fe,lt),Re instanceof kt)Re.boundsBuffer&&Re.boundsSegments&&Fe.draw(Se,Ie.TRIANGLES,Qe,j.StencilMode.disabled,Ue,j.CullFaceMode.disabled,Rt,q.id,Re.boundsBuffer,te.quadTriangleIndexBuffer,Re.boundsSegments);else{const{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:Qt,tileBoundsSegments:gn}=te.getTileBoundsBuffers(it);Fe.draw(Se,Ie.TRIANGLES,Qe,gt,Ue,j.CullFaceMode.disabled,Rt,q.id,Xt,Qt,gn)}}te.resetStencilClippingMasks()},background:function(te,$,q,re){const ye=q.paint.get("background-color"),be=q.paint.get("background-opacity");if(be===0)return;const Se=te.context,Ie=Se.gl,Re=te.transform,Fe=Re.tileSize,Ue=q.paint.get("background-pattern");if(te.isPatternMissing(Ue))return;const Ze=!Ue&&ye.a===1&&be===1&&te.opaquePassEnabledForLayer()?"opaque":"translucent";if(te.renderPass!==Ze)return;const Ye=j.StencilMode.disabled,rt=te.depthModeForSublayer(0,Ze==="opaque"?j.DepthMode.ReadWrite:j.DepthMode.ReadOnly),et=te.colorModeForRenderPass(),tt=te.useProgram(Ue?"backgroundPattern":"background");let nt,Qe=re;Qe||(nt=te.getBackgroundTiles(),Qe=Object.values(nt).map(it=>it.tileID)),Ue&&(Se.activeTexture.set(Ie.TEXTURE0),te.imageManager.bind(te.context));const lt=q.getCrossfadeParameters();for(const it of Qe){const xt=it.toUnwrapped(),gt=re?it.projMatrix:te.transform.calculateProjMatrix(xt);te.prepareDrawTile();const dt=$?$.getTile(it):nt?nt[it.key]:new j.Tile(it,Fe,Re.zoom,te),vt=Ue?jh(gt,be,te,Ue,{tileID:it,tileSize:Fe},lt):Nh(gt,be,ye);te.prepareDrawProgram(Se,tt,xt);const{tileBoundsBuffer:_t,tileBoundsIndexBuffer:St,tileBoundsSegments:Bt}=te.getTileBoundsBuffers(dt);tt.draw(Se,Ie.TRIANGLES,rt,Ye,et,j.CullFaceMode.disabled,vt,q.id,_t,St,Bt)}},sky:function(te,$,q){const re=te.transform,ye=re.projection.name==="mercator"||re.projection.name==="globe"?1:j.smoothstep(7,8,re.zoom),be=q.paint.get("sky-opacity")*ye;if(be===0)return;const Se=te.context,Ie=q.paint.get("sky-type"),Re=new j.DepthMode(Se.gl.LEQUAL,j.DepthMode.ReadOnly,[0,1]),Fe=te.frameCounter/1e3%1;Ie==="atmosphere"?te.renderPass==="offscreen"?q.needsSkyboxCapture(te)&&(function(Ue,Ze,Ye,rt){const et=Ue.context,tt=et.gl;let nt=Ze.skyboxFbo;if(!nt){nt=Ze.skyboxFbo=et.createFramebuffer(32,32,!1),Ze.skyboxGeometry=new ic(et),Ze.skyboxTexture=et.gl.createTexture(),tt.bindTexture(tt.TEXTURE_CUBE_MAP,Ze.skyboxTexture),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_WRAP_S,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_WRAP_T,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_MIN_FILTER,tt.LINEAR),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_MAG_FILTER,tt.LINEAR);for(let xt=0;xt<6;++xt)tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,tt.RGBA,32,32,0,tt.RGBA,tt.UNSIGNED_BYTE,null)}et.bindFramebuffer.set(nt.framebuffer),et.viewport.set([0,0,32,32]);const Qe=Ze.getCenter(Ue,!0),lt=Ue.useProgram("skyboxCapture"),it=new Float64Array(16);j.identity(it),j.rotateY(it,it,.5*-Math.PI),ys(et,Ze,lt,it,Qe,0),j.identity(it),j.rotateY(it,it,.5*Math.PI),ys(et,Ze,lt,it,Qe,1),j.identity(it),j.rotateX(it,it,.5*-Math.PI),ys(et,Ze,lt,it,Qe,2),j.identity(it),j.rotateX(it,it,.5*Math.PI),ys(et,Ze,lt,it,Qe,3),j.identity(it),ys(et,Ze,lt,it,Qe,4),j.identity(it),j.rotateY(it,it,Math.PI),ys(et,Ze,lt,it,Qe,5),et.viewport.set([0,0,Ue.width,Ue.height])}(te,q),q.markSkyboxValid(te)):te.renderPass==="sky"&&function(Ue,Ze,Ye,rt,et){const tt=Ue.context,nt=tt.gl,Qe=Ue.transform,lt=Ue.useProgram("skybox");tt.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_CUBE_MAP,Ze.skyboxTexture);const it=((xt,gt,dt,vt,_t)=>({u_matrix:xt,u_sun_direction:gt,u_cubemap:0,u_opacity:vt,u_temporal_offset:_t}))(Qe.skyboxMatrix,Ze.getCenter(Ue,!1),0,rt,et);Ue.prepareDrawProgram(tt,lt),lt.draw(tt,nt.TRIANGLES,Ye,j.StencilMode.disabled,Ue.colorModeForRenderPass(),j.CullFaceMode.backCW,it,"skybox",Ze.skyboxGeometry.vertexBuffer,Ze.skyboxGeometry.indexBuffer,Ze.skyboxGeometry.segment)}(te,q,Re,be,Fe):Ie==="gradient"&&te.renderPass==="sky"&&function(Ue,Ze,Ye,rt,et){const tt=Ue.context,nt=tt.gl,Qe=Ue.transform,lt=Ue.useProgram("skyboxGradient");Ze.skyboxGeometry||(Ze.skyboxGeometry=new ic(tt)),tt.activeTexture.set(nt.TEXTURE0);let it=Ze.colorRampTexture;it||(it=Ze.colorRampTexture=new j.Texture(tt,Ze.colorRamp,nt.RGBA)),it.bind(nt.LINEAR,nt.CLAMP_TO_EDGE);const xt=((gt,dt,vt,_t,St)=>({u_matrix:gt,u_color_ramp:0,u_center_direction:dt,u_radius:j.degToRad(vt),u_opacity:_t,u_temporal_offset:St}))(Qe.skyboxMatrix,Ze.getCenter(Ue,!1),Ze.paint.get("sky-gradient-radius"),rt,et);Ue.prepareDrawProgram(tt,lt),lt.draw(tt,nt.TRIANGLES,Ye,j.StencilMode.disabled,Ue.colorModeForRenderPass(),j.CullFaceMode.backCW,xt,"skyboxGradient",Ze.skyboxGeometry.vertexBuffer,Ze.skyboxGeometry.indexBuffer,Ze.skyboxGeometry.segment)}(te,q,Re,be,Fe)},debug:function(te,$,q){for(let re=0;re<q.length;re++)Sr(te,$,q[re])},custom:function(te,$,q){const re=te.context,ye=q.implementation;if(te.transform.projection.unsupportedLayers&&te.transform.projection.unsupportedLayers.includes("custom"))j.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(te.renderPass==="offscreen"){const be=ye.prerender;be&&(te.setCustomLayerDefaults(),re.setColorMode(te.colorModeForRenderPass()),be.call(ye,re.gl,te.transform.customLayerMatrix()),re.setDirty(),te.setBaseState())}else if(te.renderPass==="translucent"){te.setCustomLayerDefaults(),re.setColorMode(te.colorModeForRenderPass()),re.setStencilMode(j.StencilMode.disabled);const be=ye.renderingMode==="3d"?new j.DepthMode(te.context.gl.LEQUAL,j.DepthMode.ReadWrite,te.depthRangeFor3D):te.depthModeForSublayer(0,j.DepthMode.ReadOnly);re.setDepthMode(be),ye.render(re.gl,te.transform.customLayerMatrix()),re.setDirty(),te.setBaseState(),re.bindFramebuffer.set(null)}}};class sc{constructor($,q){this.context=new ot($),this.transform=q,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=j.SourceCache.maxUnderzooming+j.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Da,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain($,q){const re=!!$&&!!$.terrain&&this.transform.projection.supportsTerrain;if(!(re||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ou(this,$));const ye=this._terrain;this.transform.elevation=re?ye:null,ye.update($,this.transform,q)}_updateFog($){const q=$.fog;if(!q||this.transform.projection.name==="globe"||q.getOpacity(this.transform.pitch)<1||q.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[re,ye]=q.getFovAdjustedRange(this.transform._fov);if(re>ye)return void(this.transform.fogCullDistSq=null);const be=re+.78*(ye-re);this.transform.fogCullDistSq=be*be}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize($,q){if(this.width=$*j.exported.devicePixelRatio,this.height=q*j.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const re of this.style.order)this.style._layers[re].resize()}setup(){const $=this.context,q=new j.StructArrayLayout2i4;q.emplaceBack(0,0),q.emplaceBack(j.EXTENT,0),q.emplaceBack(0,j.EXTENT),q.emplaceBack(j.EXTENT,j.EXTENT),this.tileExtentBuffer=$.createVertexBuffer(q,j.posAttributes.members),this.tileExtentSegments=j.SegmentVector.simpleSegment(0,0,4,2);const re=new j.StructArrayLayout2i4;re.emplaceBack(0,0),re.emplaceBack(j.EXTENT,0),re.emplaceBack(0,j.EXTENT),re.emplaceBack(j.EXTENT,j.EXTENT),this.debugBuffer=$.createVertexBuffer(re,j.posAttributes.members),this.debugSegments=j.SegmentVector.simpleSegment(0,0,4,5);const ye=new j.StructArrayLayout2i4;ye.emplaceBack(-1,-1),ye.emplaceBack(1,-1),ye.emplaceBack(-1,1),ye.emplaceBack(1,1),this.viewportBuffer=$.createVertexBuffer(ye,j.posAttributes.members),this.viewportSegments=j.SegmentVector.simpleSegment(0,0,4,2);const be=new j.StructArrayLayout4i8;be.emplaceBack(0,0,0,0),be.emplaceBack(j.EXTENT,0,j.EXTENT,0),be.emplaceBack(0,j.EXTENT,0,j.EXTENT),be.emplaceBack(j.EXTENT,j.EXTENT,j.EXTENT,j.EXTENT),this.mercatorBoundsBuffer=$.createVertexBuffer(be,j.boundsAttributes.members),this.mercatorBoundsSegments=j.SegmentVector.simpleSegment(0,0,4,2);const Se=new j.StructArrayLayout3ui6;Se.emplaceBack(0,1,2),Se.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=$.createIndexBuffer(Se);const Ie=new j.StructArrayLayout1ui2;for(const Fe of[0,1,3,2,0])Ie.emplaceBack(Fe);this.debugIndexBuffer=$.createIndexBuffer(Ie),this.emptyTexture=new j.Texture($,new j.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),$.gl.RGBA),this.identityMat=j.create();const Re=this.context.gl;this.stencilClearMode=new j.StencilMode({func:Re.ALWAYS,mask:0},0,255,Re.ZERO,Re.ZERO,Re.ZERO),this.loadTimeStamps.push(j.window.performance.now()),this.atmosphereBuffer=new Ka(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers($){return $._makeTileBoundsBuffers(this.context,this.transform.projection),$._tileBoundsBuffer?{tileBoundsBuffer:$._tileBoundsBuffer,tileBoundsIndexBuffer:$._tileBoundsIndexBuffer,tileBoundsSegments:$._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const $=this.context,q=$.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw($,q.TRIANGLES,j.DepthMode.disabled,this.stencilClearMode,j.ColorMode.disabled,j.CullFaceMode.disabled,Vl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks($,q,re){if(!q||this.currentStencilSource===q.id||!$.isTileClipped()||!re||re.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let Ie=!1;for(const Re of re)if(this._tileClippingMaskIDs[Re.key]===void 0){Ie=!0;break}if(!Ie)return}this.currentStencilSource=q.id;const ye=this.context,be=ye.gl;this.nextStencilID+re.length>256&&this.clearStencil(),ye.setColorMode(j.ColorMode.disabled),ye.setDepthMode(j.DepthMode.disabled);const Se=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const Ie of re){const Re=q.getTile(Ie),Fe=this._tileClippingMaskIDs[Ie.key]=this.nextStencilID++,{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Ze,tileBoundsSegments:Ye}=this.getTileBoundsBuffers(Re);Se.draw(ye,be.TRIANGLES,j.DepthMode.disabled,new j.StencilMode({func:be.ALWAYS,mask:0},Fe,255,be.KEEP,be.KEEP,be.REPLACE),j.ColorMode.disabled,j.CullFaceMode.disabled,Vl(Ie.projMatrix),"$clipping",Ue,Ze,Ye)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const $=this.nextStencilID++,q=this.context.gl;return new j.StencilMode({func:q.NOTEQUAL,mask:255},$,255,q.KEEP,q.KEEP,q.REPLACE)}stencilModeForClipping($){if(this.terrain)return this.terrain.stencilModeForRTTOverlap($);const q=this.context.gl;return new j.StencilMode({func:q.EQUAL,mask:255},this._tileClippingMaskIDs[$.key],0,q.KEEP,q.KEEP,q.REPLACE)}stencilConfigForOverlap($){const q=this.context.gl,re=$.sort((Se,Ie)=>Ie.overscaledZ-Se.overscaledZ),ye=re[re.length-1].overscaledZ,be=re[0].overscaledZ-ye+1;if(be>1){this.currentStencilSource=void 0,this.nextStencilID+be>256&&this.clearStencil();const Se={};for(let Ie=0;Ie<be;Ie++)Se[Ie+ye]=new j.StencilMode({func:q.GEQUAL,mask:255},Ie+this.nextStencilID,255,q.KEEP,q.KEEP,q.REPLACE);return this.nextStencilID+=be,[Se,re]}return[{[ye]:j.StencilMode.disabled},re]}colorModeForRenderPass(){const $=this.context.gl;return this._showOverdrawInspector?new j.ColorMode([$.CONSTANT_COLOR,$.ONE],new j.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?j.ColorMode.unblended:j.ColorMode.alphaBlended}depthModeForSublayer($,q,re){if(!this.opaquePassEnabledForLayer())return j.DepthMode.disabled;const ye=1-((1+this.currentLayer)*this.numSublayers+$)*this.depthEpsilon;return new j.DepthMode(re||this.context.gl.LEQUAL,q,[ye,ye])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render($,q){this.style=$,this.options=q,this.lineAtlas=$.lineAtlas,this.imageManager=$.imageManager,this.glyphManager=$.glyphManager,this.symbolFadeChange=$.placement.symbolFadeChange(j.exported.now()),this.imageManager.beginFrame();const re=this.style.order,ye=this.style._sourceCaches;for(const Re in ye){const Fe=ye[Re];Fe.used&&Fe.prepare(this.context)}const be={},Se={},Ie={};for(const Re in ye){const Fe=ye[Re];be[Re]=Fe.getVisibleCoordinates(),Se[Re]=be[Re].slice().reverse(),Ie[Re]=Fe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Re=0;Re<re.length;Re++)if(this.style._layers[re[Re]].is3D()){this.opaquePassCutoff=Re;break}if(this.terrain&&(this.terrain.updateTileBinding(Ie),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new j.GlobeSharedBuffers(this.context)),j.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const Re of re){const Fe=this.style._layers[Re],Ue=$._getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Ze=Ue?Se[Ue.id]:void 0;(Fe.type==="custom"||Fe.isSky()||Ze&&Ze.length)&&this.renderLayer(this,Ue,Fe,Ze)}if(this.depthRangeFor3D=[0,1-($.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:q.showOverdrawInspector?j.Color.black:j.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=q.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=re.length-1;this.currentLayer>=0;this.currentLayer--){const Re=this.style._layers[re[this.currentLayer]],Fe=$._getLayerSourceCache(Re);if(Re.isSky())continue;const Ue=Fe?Se[Fe.id]:void 0;this._renderTileClippingMasks(Re,Fe,Ue),this.renderLayer(this,Fe,Re,Ue)}if(this.style.fog&&this.transform.projection.supportsFog&&function(Re,Fe){const Ue=Re.context,Ze=Ue.gl,Ye=Re.transform,rt=new j.DepthMode(Ze.LEQUAL,j.DepthMode.ReadOnly,[0,1]),et=Re.useProgram("globeAtmosphere",null,Ye.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),tt=j.globeToMercatorTransition(Ye.zoom),nt=Fe.properties.get("color").toArray01(),Qe=Fe.properties.get("high-color").toArray01(),lt=Fe.properties.get("space-color").toArray01PremultipliedAlpha(),it=j.identity$1([]);j.rotateY$1(it,it,-j.degToRad(Ye._center.lng)),j.rotateX$1(it,it,j.degToRad(Ye._center.lat)),j.rotateZ$1(it,it,Ye.angle),j.rotateX$1(it,it,-Ye._pitch);const xt=j.fromQuat(new Float32Array(16),it),gt=j.mapValue(Fe.properties.get("star-intensity"),0,1,0,.25),dt=5e-4,vt=j.mapValue(Fe.properties.get("horizon-blend"),0,1,dt,.25),_t=j.globeUseCustomAntiAliasing(Re,Ue,Ye)&&vt===dt?Ye.worldSize/(2*Math.PI*1.025)-1:Ye.globeRadius,St=Re.frameCounter/1e3%1,Bt=j.length(Ye.globeCenterInViewSpace),un=Math.sqrt(Math.pow(Bt,2)-Math.pow(_t,2)),Rt=Math.acos(un/Bt),Xt=((gn,jt,dn,Jt,wn,xn,zn,$n,Wn,fr,Dn,Qn,Tr,Gr)=>({u_frustum_tl:gn,u_frustum_tr:jt,u_frustum_br:dn,u_frustum_bl:Jt,u_horizon:wn,u_transition:xn,u_fadeout_range:zn,u_color:$n,u_high_color:Wn,u_space_color:fr,u_star_intensity:Dn,u_star_size:5*j.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Qn,u_horizon_angle:Tr,u_rotation_matrix:Gr}))(Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.frustumCorners.horizon,tt,vt,nt,Qe,lt,gt,St,Rt,xt);Re.prepareDrawProgram(Ue,et);const Qt=Re.atmosphereBuffer;Qt&&et.draw(Ue,Ze.TRIANGLES,rt,j.StencilMode.disabled,j.ColorMode.alphaBlended,j.CullFaceMode.backCW,Xt,"skybox",Qt.vertexBuffer,Qt.indexBuffer,Qt.segments)}(this,this.style.fog),this.renderPass="sky",(j.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<re.length;this.currentLayer++){const Re=this.style._layers[re[this.currentLayer]],Fe=$._getLayerSourceCache(Re);Re.isSky()&&this.renderLayer(this,Fe,Re,Fe?Se[Fe.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<re.length;){const Re=this.style._layers[re[this.currentLayer]],Fe=$._getLayerSourceCache(Re);if(Re.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Re)){if(Re.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Ue=Fe?(Re.type==="symbol"?Ie:Se)[Fe.id]:void 0;this._renderTileClippingMasks(Re,Fe,Fe?be[Fe.id]:void 0),this.renderLayer(this,Fe,Re,Ue),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let Re=null;j.values(this.style._layers).forEach(Fe=>{const Ue=$._getLayerSourceCache(Fe);Ue&&!Fe.isHidden(this.transform.zoom)&&(!Re||Re.getSource().maxzoom<Ue.getSource().maxzoom)&&(Re=Ue)}),Re&&this.options.showTileBoundaries&&vs.debug(this,Re,Re.getVisibleCoordinates())}this.options.showPadding&&function(Re){const Fe=Re.transform.padding;Js(Re,Re.transform.height-(Fe.top||0),3,_u),Js(Re,Fe.bottom||0,3,_s),yu(Re,Fe.left||0,3,gs),yu(Re,Re.transform.width-(Fe.right||0),3,gu);const Ue=Re.transform.centerPoint;(function(Ze,Ye,rt,et){Qs(Ze,Ye-1,rt-10,2,20,et),Qs(Ze,Ye-10,rt-1,20,2,et)})(Re,Ue.x,Re.transform.height-Ue.y,rc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(j.window.performance.now()),this.saveCanvasCopy())}}renderLayer($,q,re,ye){re.isHidden(this.transform.zoom)||(re.type==="background"||re.type==="sky"||re.type==="custom"||ye&&ye.length)&&(this.id=re.id,this.gpuTimingStart(re),$.transform.projection.unsupportedLayers&&$.transform.projection.unsupportedLayers.includes(re.type)||vs[re.type]($,q,re,ye,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart($){if(!this.options.gpuTiming)return;const q=this.context.extTimerQuery;let re=this.gpuTimers[$.id];re||(re=this.gpuTimers[$.id]={calls:0,cpuTime:0,query:q.createQueryEXT()}),re.calls++,q.beginQueryEXT(q.TIME_ELAPSED_EXT,re.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const $=this.context.extTimerQuery,q=$.createQueryEXT();this.deferredRenderGpuTimeQueries.push(q),$.beginQueryEXT($.TIME_ELAPSED_EXT,q)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const $=this.context.extTimerQuery;$.endQueryEXT($.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const $=this.context.extTimerQuery;$.endQueryEXT($.TIME_ELAPSED_EXT)}collectGpuTimers(){const $=this.gpuTimers;return this.gpuTimers={},$}collectDeferredRenderGpuQueries(){const $=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],$}queryGpuTimers($){const q={};for(const re in $){const ye=$[re],be=this.context.extTimerQuery,Se=be.getQueryObjectEXT(ye.query,be.QUERY_RESULT_EXT)/1e6;be.deleteQueryEXT(ye.query),q[re]=Se}return q}queryGpuTimeDeferredRender($){if(!this.options.gpuTimingDeferredRender)return 0;const q=this.context.extTimerQuery;let re=0;for(const ye of $)re+=q.getQueryObjectEXT(ye,q.QUERY_RESULT_EXT)/1e6,q.deleteQueryEXT(ye);return re}translatePosMatrix($,q,re,ye,be){if(!re[0]&&!re[1])return $;const Se=be?ye==="map"?this.transform.angle:0:ye==="viewport"?-this.transform.angle:0;if(Se){const Fe=Math.sin(Se),Ue=Math.cos(Se);re=[re[0]*Ue-re[1]*Fe,re[0]*Fe+re[1]*Ue]}const Ie=[be?re[0]:Vr(q,re[0],this.transform.zoom),be?re[1]:Vr(q,re[1],this.transform.zoom),0],Re=new Float32Array(16);return j.translate(Re,$,Ie),Re}saveTileTexture($){const q=this._tileTextures[$.size[0]];q?q.push($):this._tileTextures[$.size[0]]=[$]}getTileTexture($){const q=this._tileTextures[$];return q&&q.length>0?q.pop():null}isPatternMissing($){if(!$)return!1;if(!$.from||!$.to)return!0;const q=this.imageManager.getPattern($.from.toString()),re=this.imageManager.getPattern($.to.toString());return!q||!re}currentGlobalDefines(){const $=this.terrain&&this.terrain.renderingToTexture,q=this.style&&this.style.fog,re=[];return this.terrain&&!this.terrain.renderingToTexture&&re.push("TERRAIN"),q&&!$&&q.getOpacity(this.transform.pitch)!==0&&re.push("FOG"),$&&re.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&re.push("OVERDRAW_INSPECTOR"),re}useProgram($,q,re){this.cache=this.cache||{};const ye=re||[],be=this.currentGlobalDefines().concat(ye),Se=Zl.cacheKey(Ua[$],$,be,q);return this.cache[Se]||(this.cache[Se]=new Zl(this.context,$,Ua[$],q,Vh[$],be)),this.cache[Se]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const $=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set($.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=j.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new j.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram($,q,re){if(this.terrain&&this.terrain.renderingToTexture)return;const ye=this.style.fog;if(ye){const be=ye.getOpacity(this.transform.pitch),Se=((Ie,Re,Fe,Ue,Ze,Ye,rt,et,tt,nt,Qe)=>{const lt=Ie.transform,it=Re.properties.get("color").toArray01();it[3]=Ue;const xt=Ie.frameCounter/1e3%1;return{u_fog_matrix:Fe?lt.calculateFogTileMatrix(Fe):Ie.identityMat,u_fog_range:Re.getFovAdjustedRange(lt._fov),u_fog_color:it,u_fog_horizon_blend:Re.properties.get("horizon-blend"),u_fog_temporal_offset:xt,u_frustum_tl:Ze,u_frustum_tr:Ye,u_frustum_br:rt,u_frustum_bl:et,u_globe_pos:tt,u_globe_radius:nt,u_viewport:Qe,u_globe_transition:j.globeToMercatorTransition(lt.zoom),u_is_globe:+(lt.projection.name==="globe")}})(this,ye,re,be,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*j.exported.devicePixelRatio,this.transform.height*j.exported.devicePixelRatio]);q.setFogUniformValues($,Se)}}setTileLoadedFlag($){this.tileLoaded=$}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const $=this.context.gl,q=$.createTexture();return $.bindTexture($.TEXTURE_2D,q),$.copyTexImage2D($.TEXTURE_2D,0,$.RGBA,0,0,$.drawingBufferWidth,$.drawingBufferHeight,0),q}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const $=this.style&&this.style.fog;return!!$&&$.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const $=this._backgroundTiles,q=this._backgroundTiles={},re=this.transform.coveringTiles({tileSize:512});for(const ye of re)q[ye.key]=$[ye.key]||new j.Tile(ye,512,this.transform.tileZoom,this);return q}clearBackgroundTiles(){this._backgroundTiles={}}}class ta{constructor($=0,q=0,re=0,ye=0){if(isNaN($)||$<0||isNaN(q)||q<0||isNaN(re)||re<0||isNaN(ye)||ye<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=$,this.bottom=q,this.left=re,this.right=ye}interpolate($,q,re){return q.top!=null&&$.top!=null&&(this.top=j.number($.top,q.top,re)),q.bottom!=null&&$.bottom!=null&&(this.bottom=j.number($.bottom,q.bottom,re)),q.left!=null&&$.left!=null&&(this.left=j.number($.left,q.left,re)),q.right!=null&&$.right!=null&&(this.right=j.number($.right,q.right,re)),this}getCenter($,q){const re=j.clamp((this.left+$-this.right)/2,0,$),ye=j.clamp((this.top+q-this.bottom)/2,0,q);return new j.pointGeometry(re,ye)}equals($){return this.top===$.top&&this.bottom===$.bottom&&this.left===$.left&&this.right===$.right}clone(){return new ta(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ac(te,$){const q=j.getColumn(te,3);j.fromQuat(te,$),j.setColumn(te,3,q)}function xs(te,$){const q=j.identity$1([]);return j.rotateZ$1(q,q,-$),j.rotateX$1(q,q,-te),q}function bs(te,$){const q=[te[0],te[1],0],re=[$[0],$[1],0];if(j.length(q)>=1e-15){const Se=j.normalize([],q);j.scale$2(re,Se,j.dot(re,Se)),$[0]=re[0],$[1]=re[1]}const ye=j.cross([],$,te);if(j.len(ye)<1e-15)return null;const be=Math.atan2(-ye[1],ye[0]);return xs(Math.atan2(Math.sqrt(te[0]*te[0]+te[1]*te[1]),-te[2]),be)}class In{constructor($,q){this.position=$,this.orientation=q}get position(){return this._position}set position($){if($){const q=$ instanceof j.MercatorCoordinate?$:new j.MercatorCoordinate($[0],$[1],$[2]);this._renderWorldCopies&&(q.x=j.wrap(q.x,0,1)),this._position=q}else this._position=null}lookAtPoint($,q){if(this.orientation=null,!this.position)return;const re=this._elevation?this._elevation.getAtPointOrZero(j.MercatorCoordinate.fromLngLat($)):0,ye=this.position,be=j.MercatorCoordinate.fromLngLat($,re),Se=[be.x-ye.x,be.y-ye.y,be.z-ye.z];q||(q=[0,0,1]),q[2]=Math.abs(q[2]),this.orientation=bs(Se,q)}setPitchBearing($,q){this.orientation=xs(j.degToRad($),j.degToRad(-q))}}class Fi{constructor($,q){this._transform=j.identity([]),this.orientation=q,this.position=$}get mercatorPosition(){const $=this.position;return new j.MercatorCoordinate($[0],$[1],$[2])}get position(){const $=j.getColumn(this._transform,3);return[$[0],$[1],$[2]]}set position($){var q;$&&j.setColumn(this._transform,3,[(q=$)[0],q[1],q[2],1])}get orientation(){return this._orientation}set orientation($){this._orientation=$||j.identity$1([]),$&&ac(this._transform,this._orientation)}getPitchBearing(){const $=this.forward(),q=this.right();return{bearing:Math.atan2(-q[1],q[0]),pitch:Math.atan2(Math.sqrt($[0]*$[0]+$[1]*$[1]),-$[2])}}setPitchBearing($,q){this._orientation=xs($,q),ac(this._transform,this._orientation)}forward(){const $=j.getColumn(this._transform,2);return[-$[0],-$[1],-$[2]]}up(){const $=j.getColumn(this._transform,1);return[-$[0],-$[1],-$[2]]}right(){const $=j.getColumn(this._transform,0);return[$[0],$[1],$[2]]}getCameraToWorld($,q){const re=new Float64Array(16);return j.invert(re,this.getWorldToCamera($,q)),re}getWorldToCameraPosition($,q,re){const ye=this.position;j.scale$2(ye,ye,-$);const be=new Float64Array(16);return j.fromScaling(be,[re,re,re]),j.translate(be,be,ye),be[10]*=q,be}getWorldToCamera($,q){const re=new Float64Array(16),ye=new Float64Array(4),be=this.position;return j.conjugate(ye,this._orientation),j.scale$2(be,be,-$),j.fromQuat(re,ye),j.translate(re,re,be),re[1]*=-1,re[5]*=-1,re[9]*=-1,re[13]*=-1,re[8]*=q,re[9]*=q,re[10]*=q,re[11]*=q,re}getCameraToClipPerspective($,q,re,ye){const be=new Float64Array(16);return j.perspective(be,$,q,re,ye),be}getDistanceToElevation($){const q=$===0?0:j.mercatorZfromAltitude($,this.position[1]),re=this.forward();return(q-this.position[2])/re[2]}clone(){return new Fi([...this.position],[...this.orientation])}}function lc(te,$){const q=na(te.projection,te.zoom,te.width,te.height),re=function(be,Se,Ie,Re,Fe){const Ue=new j.LngLat(Ie.lng-180*eo,Ie.lat),Ze=new j.LngLat(Ie.lng+180*eo,Ie.lat),Ye=be.project(Ue.lng,Ue.lat),rt=be.project(Ze.lng,Ze.lat),et=-Math.atan2(rt.y-Ye.y,rt.x-Ye.x),tt=j.MercatorCoordinate.fromLngLat(Ie);tt.y=j.clamp(tt.y,-.999975,.999975);const nt=tt.toLngLat(),Qe=be.project(nt.lng,nt.lat),lt=j.MercatorCoordinate.fromLngLat(nt);lt.x+=eo;const it=lt.toLngLat(),xt=be.project(it.lng,it.lat),gt=ra(xt.x-Qe.x,xt.y-Qe.y,et),dt=j.MercatorCoordinate.fromLngLat(nt);dt.y+=eo;const vt=dt.toLngLat(),_t=be.project(vt.lng,vt.lat),St=ra(_t.x-Qe.x,_t.y-Qe.y,et),Bt=Math.abs(gt.x)/Math.abs(St.y),un=j.identity([]);j.rotateZ(un,un,-et*(1-(Fe?0:Re)));const Rt=j.identity([]);return j.scale(Rt,Rt,[1,1-(1-Bt)*Re,1]),Rt[4]=-St.x/St.y*Re,j.rotateZ(Rt,Rt,et),j.multiply(Rt,un,Rt),Rt}(te.projection,0,te.center,q,$),ye=cc(te);return j.scale(re,re,[ye,ye,1]),re}function cc(te){const $=te.projection,q=na(te.projection,te.zoom,te.width,te.height),re=uc($,te.center),ye=uc($,j.LngLat.convert($.center));return Math.pow(2,re*q+(1-q)*ye)}function na(te,$,q,re,ye=1/0){const be=te.range;if(!be)return 0;const Se=Math.min(ye,Math.max(q,re)),Ie=Math.log(Se/1024)/Math.LN2;return j.smoothstep(be[0]+Ie,be[1]+Ie,$)}const eo=1/4e4;function uc(te,$){const q=j.clamp($.lat,-j.MAX_MERCATOR_LATITUDE,j.MAX_MERCATOR_LATITUDE),re=new j.LngLat($.lng-180*eo,q),ye=new j.LngLat($.lng+180*eo,q),be=te.project(re.lng,q),Se=te.project(ye.lng,q),Ie=j.MercatorCoordinate.fromLngLat(re),Re=j.MercatorCoordinate.fromLngLat(ye),Fe=Se.x-be.x,Ue=Se.y-be.y,Ze=Re.x-Ie.x,Ye=Re.y-Ie.y,rt=Math.sqrt((Ze*Ze+Ye*Ye)/(Fe*Fe+Ue*Ue));return Math.log(rt)/Math.LN2}function ra(te,$,q){const re=Math.cos(q),ye=Math.sin(q);return{x:te*re-$*ye,y:te*ye+$*re}}class ia{constructor($,q,re,ye,be,Se,Ie){this.tileSize=512,this._renderWorldCopies=be===void 0||be,this._minZoom=$||0,this._maxZoom=q||22,this._minPitch=re==null?0:re,this._maxPitch=ye==null?60:ye,this.setProjection(Se),this.setMaxBounds(Ie),this.width=0,this.height=0,this._center=new j.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ta,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Fi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const $=new ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return $._elevation=this._elevation,$._centerAltitude=this._centerAltitude,$._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,$.tileSize=this.tileSize,$.width=this.width,$.height=this.height,$.cameraElevationReference=this.cameraElevationReference,$._center=this._center,$._setZoom(this.zoom),$._seaLevelZoom=this._seaLevelZoom,$.angle=this.angle,$._fov=this._fov,$._pitch=this._pitch,$._nearZ=this._nearZ,$._farZ=this._farZ,$._averageElevation=this._averageElevation,$._unmodified=this._unmodified,$._edgeInsets=this._edgeInsets.clone(),$._camera=this._camera.clone(),$._calcMatrices(),$.freezeTileCoverage=this.freezeTileCoverage,$.frustumCorners=this.frustumCorners,$}get elevation(){return this._elevation}set elevation($){this._elevation!==$&&(this._elevation=$,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation($){const q=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||q)&&this._updateCameraOnTerrain(),($||q)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return j.pick(this.projection,["name","center","parallels"])}setProjection($){this.projectionOptions=$||{name:"mercator"};const q=this.projection?this.getProjection():void 0;this.projection=j.getProjection(this.projectionOptions);const re=!Ce(q,this.getProjection());return re&&this._calcMatrices(),this.mercatorFromTransition=!1,re}setMercatorFromTransition(){const $=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=j.getProjection({name:"mercator"});const q=$!==this.projection.name;return q&&this._calcMatrices(),q}get minZoom(){return this._minZoom}set minZoom($){this._minZoom!==$&&(this._minZoom=$,this.zoom=Math.max(this.zoom,$))}get maxZoom(){return this._maxZoom}set maxZoom($){this._maxZoom!==$&&(this._maxZoom=$,this.zoom=Math.min(this.zoom,$))}get minPitch(){return this._minPitch}set minPitch($){this._minPitch!==$&&(this._minPitch=$,this.pitch=Math.max(this.pitch,$))}get maxPitch(){return this._maxPitch}set maxPitch($){this._maxPitch!==$&&(this._maxPitch=$,this.pitch=Math.min(this.pitch,$))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies($){$===void 0?$=!0:$===null&&($=!1),this._renderWorldCopies=$}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const $=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ($))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return j.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new j.pointGeometry(this.width,this.height)}get bearing(){return j.wrap(this.rotation,-180,180)}set bearing($){this.rotation=$}get rotation(){return-this.angle/Math.PI*180}set rotation($){const q=-$*Math.PI/180;var re;this.angle!==q&&(this._unmodified=!1,this.angle=q,this._calcMatrices(),this.rotationMatrix=(re=new j.ARRAY_TYPE(4),j.ARRAY_TYPE!=Float32Array&&(re[1]=0,re[2]=0),re[0]=1,re[3]=1,re),function(ye,be,Se){var Ie=be[0],Re=be[1],Fe=be[2],Ue=be[3],Ze=Math.sin(Se),Ye=Math.cos(Se);ye[0]=Ie*Ye+Fe*Ze,ye[1]=Re*Ye+Ue*Ze,ye[2]=Ie*-Ze+Fe*Ye,ye[3]=Re*-Ze+Ue*Ye}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch($){const q=j.clamp($,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==q&&(this._unmodified=!1,this._pitch=q,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov($){$=Math.max(.01,Math.min(60,$)),this._fov!==$&&(this._unmodified=!1,this._fov=$/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation($){this._averageElevation=$,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom($){const q=Math.min(Math.max($,this.minZoom),this.maxZoom);this._zoom!==q&&(this._unmodified=!1,this._setZoom(q),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom($){this._zoom=$,this.scale=this.zoomScale($),this.tileZoom=Math.floor($),this.zoomFraction=$-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const $=this._elevation;this._centerAltitude=$.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=$.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const $=this._elevation,q=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],re=this.horizonLineFromTop();let ye=0,be=0;for(let Se=0;Se<q.length;Se++){const Ie=new j.pointGeometry(q[Se][0]*this.width,re+q[Se][1]*(this.height-re)),Re=$.pointCoordinate(Ie);if(!Re)continue;const Fe=1/Math.hypot(Re[0]-this._camera.position[0],Re[1]-this._camera.position[1]);ye+=Re[3]*Fe,be+=Fe}return be===0?NaN:ye/be}get center(){return this._center}set center($){$.lat===this._center.lat&&$.lng===this._center.lng||(this._unmodified=!1,this._center=$,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const $=this._seaLevelZoom,q=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),re=this.pixelsPerMeter/this.worldSize*q,ye=this._mercatorZfromZoom($),be=this._mercatorZfromZoom(this._maxZoom),Se=Math.max(ye-re,be);this._setZoom(this._zoomFromMercatorZ(Se))}get padding(){return this._edgeInsets.toJSON()}set padding($){this._edgeInsets.equals($)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,$,1),this._calcMatrices())}computeZoomRelativeTo($){const q=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,$.toAltitude()));let re;re=$.z<this._camera.position[2]?[q.x,q.y,q.z]:[$.x,$.y,$.z];const ye=j.length(j.sub([],this._camera.position,re));return j.clamp(this._zoomFromMercatorZ(ye),this._minZoom,this._maxZoom)}setFreeCameraOptions($){if(!this.height||!$.position&&!$.orientation)return;this._updateCameraState();let q=!1;if($.orientation&&!j.exactEquals($.orientation,this._camera.orientation)&&(q=this._setCameraOrientation($.orientation)),$.position){const re=[$.position.x,$.position.y,$.position.z];j.exactEquals$1(re,this._camera.position)||(this._setCameraPosition(re),q=!0)}q&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const $=this._camera.position,q=new In;return q.position=new j.MercatorCoordinate($[0],$[1],$[2]),q.orientation=this._camera.orientation,q._elevation=this.elevation,q._renderWorldCopies=this.renderWorldCopies,q}_setCameraOrientation($){if(!j.length$1($))return!1;j.normalize$1($,$);const q=j.transformQuat([],[0,0,-1],$),re=j.transformQuat([],[0,-1,0],$);if(re[2]<0)return!1;const ye=bs(q,re);return!!ye&&(this._camera.orientation=ye,!0)}_setCameraPosition($){const q=this.zoomScale(this.minZoom)*this.tileSize,re=this.zoomScale(this.maxZoom)*this.tileSize,ye=this.cameraToCenterDistance;$[2]=j.clamp($[2],ye/re,ye/q),this._camera.position=$}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual($){return this._edgeInsets.equals($)}interpolatePadding($,q,re){this._unmodified=!1,this._edgeInsets.interpolate($,q,re),this._constrain(),this._calcMatrices()}coveringZoomLevel($){const q=($.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/$.tileSize));return Math.max(0,q)}getVisibleUnwrappedCoordinates($){const q=[new j.UnwrappedTileID(0,$)];if(this.renderWorldCopies){const re=this.pointCoordinate(new j.pointGeometry(0,0)),ye=this.pointCoordinate(new j.pointGeometry(this.width,0)),be=this.pointCoordinate(new j.pointGeometry(this.width,this.height)),Se=this.pointCoordinate(new j.pointGeometry(0,this.height)),Ie=Math.floor(Math.min(re.x,ye.x,be.x,Se.x)),Re=Math.floor(Math.max(re.x,ye.x,be.x,Se.x)),Fe=1;for(let Ue=Ie-Fe;Ue<=Re+Fe;Ue++)Ue!==0&&q.push(new j.UnwrappedTileID(Ue,$))}return q}coveringTiles($){let q=this.coveringZoomLevel($);const re=q,ye=this.elevation&&!$.isTerrainDEM,be=this.projection.name==="mercator";if($.minzoom!==void 0&&q<$.minzoom)return[];$.maxzoom!==void 0&&q>$.maxzoom&&(q=$.maxzoom);const Se=this.locationCoordinate(this.center),Ie=this.center.lat,Re=1<<q,Fe=[Re*Se.x,Re*Se.y,0],Ue=this.projection.name==="globe",Ze=!Ue,Ye=j.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,q,Ze),rt=Ue?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),et=Re*j.mercatorZfromAltitude(1,this.center.lat),tt=this._camera.position[2]/j.mercatorZfromAltitude(1,this.center.lat),nt=[Re*rt.x,Re*rt.y,tt*(Ze?1:et)],Qe=this.cameraToCenterDistance/$.tileSize*($.roundZoom?1:.502),lt=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?q:0,it=$.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,xt=$.isTerrainDEM?-it:this._elevation?this._elevation.getMinElevationBelowMSL():0,gt=this.projection.isReprojectedInTileSpace?cc(this):1,dt=jt=>{const Jt=new j.MercatorCoordinate(jt.x+25e-6,jt.y,jt.z),wn=new j.MercatorCoordinate(jt.x,jt.y+25e-6,jt.z),xn=jt.toLngLat(),zn=Jt.toLngLat(),$n=wn.toLngLat(),Wn=this.locationCoordinate(xn),fr=this.locationCoordinate(zn),Dn=this.locationCoordinate($n),Qn=Math.hypot(fr.x-Wn.x,fr.y-Wn.y),Tr=Math.hypot(Dn.x-Wn.x,Dn.y-Wn.y);return Math.sqrt(Qn*Tr)*gt/25e-6},vt=jt=>{const dn=it,Jt=xt;return{aabb:j.tileAABB(this,Re,0,0,0,jt,Jt,dn,this.projection),zoom:0,x:0,y:0,minZ:Jt,maxZ:dn,wrap:jt,fullyVisible:!1}},_t=[];let St=[];const Bt=q,un=$.reparseOverscaled?re:q,Rt=jt=>jt*jt,Xt=Rt((tt-this._centerAltitude)*et),Qt=jt=>{if(!this._elevation||!jt.tileID||!be)return;const dn=this._elevation.getMinMaxForTile(jt.tileID),Jt=jt.aabb;dn?(Jt.min[2]=dn.min,Jt.max[2]=dn.max,Jt.center[2]=(Jt.min[2]+Jt.max[2])/2):(jt.shouldSplit=gn(jt),jt.shouldSplit||(Jt.min[2]=Jt.max[2]=Jt.center[2]=this._centerAltitude))},gn=jt=>{if(jt.zoom<lt)return!0;if(jt.zoom===Bt)return!1;if(jt.shouldSplit!=null)return jt.shouldSplit;const dn=jt.aabb.distanceX(nt),Jt=jt.aabb.distanceY(nt);let wn=Xt,xn=1;if(Ue){wn=Rt(jt.aabb.distanceZ(nt));const $n=Math.pow(2,jt.zoom),Wn=j.latFromMercatorY((jt.y+1)/$n),fr=j.latFromMercatorY(jt.y/$n),Dn=Math.min(Math.max(Ie,Wn),fr),Qn=j.circumferenceAtLatitude(Dn)/j.circumferenceAtLatitude(Ie);if(xn=Dn===Ie?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Qn/this._mercatorScaleRatio),this.zoom<=j.GLOBE_ZOOM_THRESHOLD_MIN&&jt.zoom===Bt-1&&Qn>=.9)return!0}else if(ye&&(wn=Rt(jt.aabb.distanceZ(nt)*et)),this.projection.isReprojectedInTileSpace&&re<=5){const $n=Math.pow(2,jt.zoom),Wn=dt(new j.MercatorCoordinate((jt.x+.5)/$n,(jt.y+.5)/$n));xn=Wn>.85?1:Wn}const zn=dn*dn+Jt*Jt+wn;return zn<Rt((1<<Bt-jt.zoom)*Qe*xn*(($n,Wn)=>{if(Wn*Rt(.707)<$n)return 1;const fr=Math.sqrt(Wn/$n);return fr/(1.4144271570014144+(Math.pow(1.1,fr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(wn,Xt),zn))};if(this.renderWorldCopies)for(let jt=1;jt<=3;jt++)_t.push(vt(-jt)),_t.push(vt(jt));for(_t.push(vt(0));_t.length>0;){const jt=_t.pop(),dn=jt.x,Jt=jt.y;let wn=jt.fullyVisible;if(!wn){const xn=jt.aabb.intersects(Ye);if(xn===0)continue;wn=xn===2}if(jt.zoom!==Bt&&gn(jt))for(let xn=0;xn<4;xn++){const zn=(dn<<1)+xn%2,$n=(Jt<<1)+(xn>>1),Wn={aabb:be?jt.aabb.quadrant(xn):j.tileAABB(this,Re,jt.zoom+1,zn,$n,jt.wrap,jt.minZ,jt.maxZ,this.projection),zoom:jt.zoom+1,x:zn,y:$n,wrap:jt.wrap,fullyVisible:wn,tileID:void 0,shouldSplit:void 0,minZ:jt.minZ,maxZ:jt.maxZ};ye&&!Ue&&(Wn.tileID=new j.OverscaledTileID(jt.zoom+1===Bt?un:jt.zoom+1,jt.wrap,jt.zoom+1,zn,$n),Qt(Wn)),_t.push(Wn)}else{const xn=jt.zoom===Bt?un:jt.zoom;if($.minzoom&&$.minzoom>xn)continue;const zn=Fe[0]-(.5+dn+(jt.wrap<<jt.zoom))*(1<<q-jt.zoom),$n=Fe[1]-.5-Jt,Wn=jt.tileID?jt.tileID:new j.OverscaledTileID(xn,jt.wrap,jt.zoom,dn,Jt);St.push({tileID:Wn,distanceSq:zn*zn+$n*$n})}}if(this.fogCullDistSq){const jt=this.fogCullDistSq,dn=this.horizonLineFromTop();St=St.filter(Jt=>{const wn=[0,0,0,1],xn=[j.EXTENT,j.EXTENT,0,1],zn=this.calculateFogTileMatrix(Jt.tileID.toUnwrapped());j.transformMat4$1(wn,wn,zn),j.transformMat4$1(xn,xn,zn);const $n=j.getAABBPointSquareDist(wn,xn);if($n===0)return!0;let Wn=!1;const fr=this._elevation;if(fr&&$n>jt&&dn!==0){const Dn=this.calculateProjMatrix(Jt.tileID.toUnwrapped());let Qn;$.isTerrainDEM||(Qn=fr.getMinMaxForTile(Jt.tileID)),Qn||(Qn={min:xt,max:it});const Tr=j.furthestTileCorner(this.rotation),Gr=[Tr[0]*j.EXTENT,Tr[1]*j.EXTENT,Qn.max];j.transformMat4(Gr,Gr,Dn),Wn=(1-Gr[1])*this.height*.5<dn}return $n<jt||Wn})}return St.sort((jt,dn)=>jt.distanceSq-dn.distanceSq).map(jt=>jt.tileID)}resize($,q){this.width=$,this.height=q,this.pixelsToGLUnits=[2/$,-2/q],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale($){return Math.pow(2,$)}scaleZoom($){return Math.log($)/Math.LN2}project($){const q=j.clamp($.lat,-j.MAX_MERCATOR_LATITUDE,j.MAX_MERCATOR_LATITUDE),re=this.projection.project($.lng,q);return new j.pointGeometry(re.x*this.worldSize,re.y*this.worldSize)}unproject($){return this.projection.unproject($.x/this.worldSize,$.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint($,q){let re,ye;const be=this.centerPoint;if(this.projection.name==="globe"){const Ie=this.worldSize;re=(q.x-be.x)/Ie,ye=(q.y-be.y)/Ie}else{const Ie=this.pointCoordinate(q),Re=this.pointCoordinate(be);re=Ie.x-Re.x,ye=Ie.y-Re.y}const Se=this.locationCoordinate($);this.setLocation(new j.MercatorCoordinate(Se.x-re,Se.y-ye))}setLocation($){this.center=this.coordinateLocation($),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint($){return this.projection.locationPoint(this,$)}locationPoint3D($){return this.projection.locationPoint(this,$,!0)}pointLocation($){return this.coordinateLocation(this.pointCoordinate($))}pointLocation3D($){return this.coordinateLocation(this.pointCoordinate3D($))}locationCoordinate($,q){const re=q?j.mercatorZfromAltitude(q,$.lat):void 0,ye=this.projection.project($.lng,$.lat);return new j.MercatorCoordinate(ye.x,ye.y,re)}coordinateLocation($){return this.projection.unproject($.x,$.y)}pointRayIntersection($,q){const re=q!=null?q:this._centerAltitude,ye=[$.x,$.y,0,1],be=[$.x,$.y,1,1];j.transformMat4$1(ye,ye,this.pixelMatrixInverse),j.transformMat4$1(be,be,this.pixelMatrixInverse);const Se=be[3];j.scale$1(ye,ye,1/ye[3]),j.scale$1(be,be,1/Se);const Ie=ye[2],Re=be[2];return{p0:ye,p1:be,t:Ie===Re?0:(re-Ie)/(Re-Ie)}}screenPointToMercatorRay($){const q=[$.x,$.y,0,1],re=[$.x,$.y,1,1];return j.transformMat4$1(q,q,this.pixelMatrixInverse),j.transformMat4$1(re,re,this.pixelMatrixInverse),j.scale$1(q,q,1/q[3]),j.scale$1(re,re,1/re[3]),q[2]=j.mercatorZfromAltitude(q[2],this._center.lat)*this.worldSize,re[2]=j.mercatorZfromAltitude(re[2],this._center.lat)*this.worldSize,j.scale$1(q,q,1/this.worldSize),j.scale$1(re,re,1/this.worldSize),new j.Ray([q[0],q[1],q[2]],j.normalize([],j.sub([],re,q)))}rayIntersectionCoordinate($){const{p0:q,p1:re,t:ye}=$,be=j.mercatorZfromAltitude(q[2],this._center.lat),Se=j.mercatorZfromAltitude(re[2],this._center.lat);return new j.MercatorCoordinate(j.number(q[0],re[0],ye)/this.worldSize,j.number(q[1],re[1],ye)/this.worldSize,j.number(be,Se,ye))}pointCoordinate($,q=this._centerAltitude){return this.projection.pointCoordinate(this,$.x,$.y,q)}pointCoordinate3D($){if(!this.elevation)return this.pointCoordinate($);let q=this.projection.pointCoordinate3D(this,$.x,$.y);if(q)return new j.MercatorCoordinate(q[0],q[1],q[2]);let re=0,ye=this.horizonLineFromTop();if($.y>ye)return this.pointCoordinate($);const be=.02*ye,Se=$.clone();for(let Ie=0;Ie<10&&ye-re>be;Ie++){Se.y=j.number(re,ye,.66);const Re=this.projection.pointCoordinate3D(this,Se.x,Se.y);Re?(ye=Se.y,q=Re):re=Se.y}return q?new j.MercatorCoordinate(q[0],q[1],q[2]):this.pointCoordinate($)}isPointAboveHorizon($){return this.projection.isPointAboveHorizon(this,$)}_coordinatePoint($,q){const re=q&&this.elevation?this.elevation.getAtPointOrZero($,this._centerAltitude):this._centerAltitude,ye=[$.x*this.worldSize,$.y*this.worldSize,re+$.toAltitude(),1];return j.transformMat4$1(ye,ye,this.pixelMatrix),ye[3]>0?new j.pointGeometry(ye[0]/ye[3],ye[1]/ye[3]):new j.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds($,q){const re=new j.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),ye=new j.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),be=new j.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),Se=new j.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let Ie=this.pointCoordinate(re,$),Re=this.pointCoordinate(ye,$);const Fe=this.pointCoordinate(be,q),Ue=this.pointCoordinate(Se,q),Ze=(Ye,rt)=>(rt.y-Ye.y)/(rt.x-Ye.x);return Ie.y>1&&Re.y>=0?Ie=new j.MercatorCoordinate((1-Ue.y)/Ze(Ue,Ie)+Ue.x,1):Ie.y<0&&Re.y<=1&&(Ie=new j.MercatorCoordinate(-Ue.y/Ze(Ue,Ie)+Ue.x,0)),Re.y>1&&Ie.y>=0?Re=new j.MercatorCoordinate((1-Fe.y)/Ze(Fe,Re)+Fe.x,1):Re.y<0&&Ie.y<=1&&(Re=new j.MercatorCoordinate(-Fe.y/Ze(Fe,Re)+Fe.x,0)),new j.LngLatBounds().extend(this.coordinateLocation(Ie)).extend(this.coordinateLocation(Re)).extend(this.coordinateLocation(Ue)).extend(this.coordinateLocation(Fe))}_getBounds3D(){const $=this.elevation;if(!$.visibleDemTiles.length)return this._getBounds(0,0);const q=$.visibleDemTiles.reduce((re,ye)=>{if(ye.dem){const be=ye.dem.tree;re.min=Math.min(re.min,be.minimums[0]),re.max=Math.max(re.max,be.maximums[0])}return re},{min:Number.MAX_VALUE,max:0});return this._getBounds(q.min*$.exaggeration(),q.max*$.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop($=!0){const q=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,re=this.height/2-q*(1-this._horizonShift);return $?Math.max(0,re):re}getMaxBounds(){return this.maxBounds}setMaxBounds($){this.maxBounds=$,this.minLat=-j.MAX_MERCATOR_LATITUDE,this.maxLat=j.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,$&&(this.minLat=$.getSouth(),this.maxLat=$.getNorth(),this.minLng=$.getWest(),this.maxLng=$.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=j.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=j.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=j.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=j.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix($,q){return this.projection.createTileMatrix(this,q,$)}calculateDistanceTileData($){const q=$.key,re=this._distanceTileDataCache;if(re[q])return re[q];const ye=$.canonical,be=1/this.height,Se=this.cameraWorldSize/this.zoomScale(ye.z),Ie=(ye.x+Math.pow(2,ye.z)*$.wrap)*Se,Re=ye.y*Se,Fe=this.point,Ue=this.angle,Ze=Math.sin(-Ue),Ye=-Math.cos(-Ue);return re[q]={bearing:[Ze,Ye],center:[(Fe.x-Ie)*be,(Fe.y-Re)*be],scale:Se/j.EXTENT*be},re[q]}calculateFogTileMatrix($){const q=$.key,re=this._fogTileMatrixCache;if(re[q])return re[q];const ye=this.projection.createTileMatrix(this,this.cameraWorldSize,$);return j.multiply(ye,this.worldToFogMatrix,ye),re[q]=new Float32Array(ye),re[q]}calculateProjMatrix($,q=!1){const re=$.key,ye=q?this._alignedProjMatrixCache:this._projMatrixCache;if(ye[re])return ye[re];const be=this.calculatePosMatrix($,this.worldSize);return j.multiply(be,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:q?this.alignedProjMatrix:this.projMatrix,be),ye[re]=new Float32Array(be),ye[re]}calculatePixelsToTileUnitsMatrix($){const q=$.tileID.key,re=this._pixelsToTileUnitsCache;if(re[q])return re[q];const ye=function(be,Se){const{scale:Ie}=be.tileTransform,Re=Ie*j.EXTENT/(be.tileSize*Math.pow(2,Se.zoom-be.tileID.overscaledZ+be.tileID.canonical.z));return Fe=new Float32Array(4),Ye=(Ue=Se.inverseAdjustmentMatrix)[1],rt=Ue[2],et=Ue[3],nt=(Ze=[Re,Re])[1],Fe[0]=Ue[0]*(tt=Ze[0]),Fe[1]=Ye*tt,Fe[2]=rt*nt,Fe[3]=et*nt,Fe;var Fe,Ue,Ze,Ye,rt,et,tt,nt}($,this);return re[q]=ye,re[q]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const $=this._elevation;this._updateCameraState();const q=j.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,re=this._computeCameraPosition(q),ye=this._camera.forward(),be=j.mercatorZfromAltitude(1,this._center.lat);re[2]/=be,ye[2]/=be,j.normalize(ye,ye);const Se=$.raycast(re,ye,$.exaggeration());if(Se){const Ie=j.scaleAndAdd([],re,ye,Se),Re=new j.MercatorCoordinate(Ie[0],Ie[1],j.mercatorZfromAltitude(Ie[2],j.latFromMercatorY(Ie[1]))),Fe=(Re.z+j.length([Re.x-re[0],Re.y-re[1],Re.z-re[2]*be]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Fe),this._centerAltitude=Re.toAltitude(),this._center=this.coordinateLocation(Re),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const $=this._elevation;this._updateCameraState();const q=j.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,re=this._computeCameraPosition(q),ye=$.getAtPointOrZero(new j.MercatorCoordinate(...re)),be=this._minimumHeightOverTerrain()*Math.cos(j.degToRad(this._maxPitch)),Se=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*ye;if(Se<be){const Ie=this.locationCoordinate(this._center,this._centerAltitude),Re=[Ie.x-re[0],Ie.y-re[1],Ie.z-re[2]],Fe=j.length(Re);Re[2]-=(be-Se)/this._pixelsPerMercatorPixel;const Ue=j.length(Re);if(Ue===0)return;j.scale$2(Re,Re,Fe/Ue*this._pixelsPerMercatorPixel),this._camera.position=[Ie.x-Re[0],Ie.y-Re[1],Ie.z*this._pixelsPerMercatorPixel-Re[2]],this._camera.orientation=bs(Re,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const $=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||$){const Ye=this.center;return Ye.lat=j.clamp(Ye.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!$)&&(Ye.lng=j.clamp(Ye.lng,this.minLng,this.maxLng)),this.center=Ye,void(this._constraining=!1)}const q=this._unmodified,{x:re,y:ye}=this.point;let be=0,Se=re,Ie=ye;const Re=this.width/2,Fe=this.height/2,Ue=this.worldMinY*this.scale,Ze=this.worldMaxY*this.scale;if(ye-Fe<Ue&&(Ie=Ue+Fe),ye+Fe>Ze&&(Ie=Ze-Fe),Ze-Ue<this.height&&(be=Math.max(be,this.height/(Ze-Ue)),Ie=(Ze+Ue)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ye=this.worldMinX*this.scale,rt=this.worldMaxX*this.scale,et=this.worldSize/2-(Ye+rt)/2;Se=(re+et+this.worldSize)%this.worldSize-et,Se-Re<Ye&&(Se=Ye+Re),Se+Re>rt&&(Se=rt-Re),rt-Ye<this.width&&(be=Math.max(be,this.width/(rt-Ye)),Se=(rt+Ye)/2)}Se===re&&Ie===ye||(this.center=this.unproject(new j.pointGeometry(Se,Ie))),be&&(this.zoom+=this.scaleZoom(be)),this._constrainCameraAltitude(),this._unmodified=q,this._constraining=!1}_minZoomForBounds(){let $=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&($=Math.max($,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),$}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const $=this.centerOffset,q=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=j.mercatorZfromAltitude(1,this.center.lat)/j.mercatorZfromAltitude(1,j.GLOBE_SCALE_MATCH_LATITUDE));const re=na(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,re),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const ye=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?q:1),be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);be[8]=2*-$.x/this.width,be[9]=2*$.y/this.height;let Se=j.mul([],be,ye);if(this.projection.isReprojectedInTileSpace){const gt=this.locationCoordinate(this.center),dt=j.identity([]);j.translate(dt,dt,[gt.x*this.worldSize,gt.y*this.worldSize,0]),j.multiply(dt,dt,lc(this)),j.translate(dt,dt,[-gt.x*this.worldSize,-gt.y*this.worldSize,0]),j.multiply(Se,Se,dt),this.inverseAdjustmentMatrix=function(vt){const _t=lc(vt,!0);return Gt([],[_t[0],_t[1],_t[4],_t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=j.scale([],Se,[this.worldSize,this.worldSize,this.worldSize/q,1]),this.projMatrix=Se,this.invProjMatrix=j.invert(new Float64Array(16),this.projMatrix);const Ie=j.invert([],be);this.frustumCorners=j.FrustumCorners.fromInvProjectionMatrix(Ie,this.horizonLineFromTop(),this.height);const Re=new Float32Array(16);j.identity(Re),j.scale(Re,Re,[1,-1,1]),j.rotateX(Re,Re,this._pitch),j.rotateZ(Re,Re,this.angle);const Fe=j.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Ue=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Fe[8]=2*-$.x/this.width,Fe[9]=2*($.y+Ue)/this.height,this.skyboxMatrix=j.multiply(Re,Fe,Re);const Ze=this.point,Ye=Ze.x,rt=Ze.y,et=this.width%2/2,tt=this.height%2/2,nt=Math.cos(this.angle),Qe=Math.sin(this.angle),lt=Ye-Math.round(Ye)+nt*et+Qe*tt,it=rt-Math.round(rt)+nt*tt+Qe*et,xt=new Float64Array(Se);if(j.translate(xt,xt,[lt>.5?lt-1:lt,it>.5?it-1:it,0]),this.alignedProjMatrix=xt,Se=j.create(),j.scale(Se,Se,[this.width/2,-this.height/2,1]),j.translate(Se,Se,[1,-1,0]),this.labelPlaneMatrix=Se,Se=j.create(),j.scale(Se,Se,[1,-1,1]),j.translate(Se,Se,[-1,-1,0]),j.scale(Se,Se,[2/this.width,2/this.height,1]),this.glCoordMatrix=Se,this.pixelMatrix=j.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},Se=j.invert(new Float64Array(16),this.pixelMatrix),!Se)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Se,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=j.calculateGlobeMatrix(this);const gt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=j.transformMat4(gt,gt,ye),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Se;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const $=this.cameraWorldSize,q=this.cameraPixelsPerMeter,re=this._camera.position,ye=1/this.height/this._pixelsPerMercatorPixel,be=[$,$,q];j.scale$2(be,be,ye),j.scale$2(re,re,-1),j.multiply$2(re,re,be);const Se=j.create();j.translate(Se,Se,re),j.scale(Se,Se,be),this.mercatorFogMatrix=Se,this.worldToFogMatrix=this._camera.getWorldToCameraPosition($,q,ye)}_computeCameraPosition($){const q=($=$||this.pixelsPerMeter)/this.pixelsPerMeter,re=this._camera.forward(),ye=this.point,be=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*q-$/this.worldSize*this._centerAltitude;return[ye.x/this.worldSize-re[0]*be,ye.y/this.worldSize-re[1]*be,$/this.worldSize*this._centerAltitude-re[2]*be]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained($){const q=this._maxCameraBoundsDistance()*Math.cos(this._pitch),re=$[2];let ye=1;re>0&&(ye=Math.min((q-this._camera.position[2])/re,1)),this._camera.position=j.scaleAndAdd([],this._camera.position,$,ye),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const $=this._camera.position,q=this._camera.forward(),{pitch:re,bearing:ye}=this._camera.getPitchBearing(),be=j.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,Se=this._mercatorZfromZoom(this._maxZoom)*Math.cos(j.degToRad(this._maxPitch)),Ie=Math.max(($[2]-be)/Math.cos(re),Se),Re=this._zoomFromMercatorZ(Ie);j.scaleAndAdd($,$,q,Ie),this._pitch=j.clamp(re,j.degToRad(this.minPitch),j.degToRad(this.maxPitch)),this.angle=j.wrap(ye,-Math.PI,Math.PI),this._setZoom(j.clamp(Re,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new j.MercatorCoordinate($[0],$[1],$[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom($){return Math.pow(2,$)*this.tileSize}_mercatorZfromZoom($){return this.cameraToCenterDistance/this._worldSizeFromZoom($)}_minimumHeightOverTerrain(){const $=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom($)}_zoomFromMercatorZ($){return this.scaleZoom(this.cameraToCenterDistance/($*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(j.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge($,q){const re=Math.min($.x,q.x),ye=Math.max($.x,q.x),be=Math.min($.y,q.y),Se=Math.max($.y,q.y);if(be<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const Ie=[new j.pointGeometry(re,be),new j.pointGeometry(ye,Se),new j.pointGeometry(re,Se),new j.pointGeometry(ye,be)],Re=this.renderWorldCopies?-3:0,Fe=this.renderWorldCopies?4:1;for(const Ue of Ie){const Ze=this.pointRayIntersection(Ue);if(Ze.t<0)return!0;const Ye=this.rayIntersectionCoordinate(Ze);if(Ye.x<Re||Ye.y<0||Ye.x>Fe||Ye.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+j.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new j.pointGeometry(0,0),new j.pointGeometry(this.width,this.height))}zoomDeltaToMovement($,q){const re=j.length(j.sub([],this._camera.position,$)),ye=this._zoomFromMercatorZ(re)+q;return re-this._mercatorZfromZoom(ye)}getCameraPoint(){if(this.projection.name==="globe"){const $=function(q,re){const ye=[q[0],q[1],q[2],1];j.transformMat4$1(ye,ye,re);const be=Math.max(ye[3],1e-6);return[ye[0]/be,ye[1]/be,ye[2]/be,be]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new j.pointGeometry($[0],$[1])}{const $=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new j.pointGeometry(0,$))}}getCameraToCenterDistance($){const q=na($,this.zoom,this.width,this.height,1024),re=$.pixelSpaceConversion(this.center.lat,this.worldSize,q);return .5/Math.tan(.5*this._fov)*this.height*re}}function oa(te,$){let q=!1,re=null;const ye=()=>{re=null,q&&(te(),re=setTimeout(ye,$),q=!1)};return()=>(q=!0,re||ye(),re)}class vu{constructor($){this._hashName=$&&encodeURIComponent($),j.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oa(this._updateHashUnthrottled.bind(this),300)}addTo($){return this._map=$,j.window.addEventListener("hashchange",this._onHashChange,!1),$.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),j.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const $=this._map;if(!$)return"";const q=hc($);if(this._hashName){const re=this._hashName;let ye=!1;const be=j.window.location.hash.slice(1).split("&").map(Se=>{const Ie=Se.split("=")[0];return Ie===re?(ye=!0,`${Ie}=${q}`):Se}).filter(Se=>Se);return ye||be.push(`${re}=${q}`),`#${be.join("&")}`}return`#${q}`}_getCurrentHash(){const $=j.window.location.hash.replace("#","");if(this._hashName){let q;return $.split("&").map(re=>re.split("=")).forEach(re=>{re[0]===this._hashName&&(q=re)}),(q&&q[1]||"").split("/")}return $.split("/")}_onHashChange(){const $=this._map;if(!$)return!1;const q=this._getCurrentHash();if(q.length>=3&&!q.some(re=>isNaN(re))){const re=$.dragRotate.isEnabled()&&$.touchZoomRotate.isEnabled()?+(q[3]||0):$.getBearing();return $.jumpTo({center:[+q[2],+q[1]],zoom:+q[0],bearing:re,pitch:+(q[4]||0)}),!0}return!1}_updateHashUnthrottled(){const $=j.window.location.href.replace(/(#.+)?$/,this.getHashString());j.window.history.replaceState(j.window.history.state,null,$)}}function hc(te,$){const q=te.getCenter(),re=Math.round(100*te.getZoom())/100,ye=Math.ceil((re*Math.LN2+Math.log(512/360/.5))/Math.LN10),be=Math.pow(10,ye),Se=Math.round(q.lng*be)/be,Ie=Math.round(q.lat*be)/be,Re=te.getBearing(),Fe=te.getPitch();let Ue=$?`/${Se}/${Ie}/${re}`:`${re}/${Ie}/${Se}`;return(Re||Fe)&&(Ue+="/"+Math.round(10*Re)/10),Fe&&(Ue+=`/${Math.round(Fe)}`),Ue}const ho={linearity:.3,easing:j.bezier(0,0,.3,1)},qh=j.extend({deceleration:2500,maxSpeed:1400},ho),Zh=j.extend({deceleration:20,maxSpeed:1400},ho),xu=j.extend({deceleration:1e3,maxSpeed:360},ho),Ya=j.extend({deceleration:1e3,maxSpeed:90},ho);class dc{constructor($){this._map=$,this.clear()}clear(){this._inertiaBuffer=[]}record($){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:j.exported.now(),settings:$})}_drainInertiaBuffer(){const $=this._inertiaBuffer,q=j.exported.now();for(;$.length>0&&q-$[0].time>160;)$.shift()}_onMoveEnd($){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const q={zoom:0,bearing:0,pitch:0,pan:new j.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:be}of this._inertiaBuffer)q.zoom+=be.zoomDelta||0,q.bearing+=be.bearingDelta||0,q.pitch+=be.pitchDelta||0,be.panDelta&&q.pan._add(be.panDelta),be.around&&(q.around=be.around),be.pinchAround&&(q.pinchAround=be.pinchAround);const re=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ye={};if(q.pan.mag()){const be=aa(q.pan.mag(),re,j.extend({},qh,$||{}));ye.offset=q.pan.mult(be.amount/q.pan.mag()),ye.center=this._map.transform.center,sa(ye,be)}if(q.zoom){const be=aa(q.zoom,re,Zh);ye.zoom=this._map.transform.zoom+be.amount,sa(ye,be)}if(q.bearing){const be=aa(q.bearing,re,xu);ye.bearing=this._map.transform.bearing+j.clamp(be.amount,-179,179),sa(ye,be)}if(q.pitch){const be=aa(q.pitch,re,Ya);ye.pitch=this._map.transform.pitch+be.amount,sa(ye,be)}if(ye.zoom||ye.bearing){const be=q.pinchAround===void 0?q.around:q.pinchAround;ye.around=be?this._map.unproject(be):this._map.getCenter()}return this.clear(),ye.noMoveStart=!0,ye}}function sa(te,$){(!te.duration||te.duration<$.duration)&&(te.duration=$.duration,te.easing=$.easing)}function aa(te,$,q){const{maxSpeed:re,linearity:ye,deceleration:be}=q,Se=j.clamp(te*ye/($/1e3),-re,re),Ie=Math.abs(Se)/(be*ye);return{easing:q.easing,duration:1e3*Ie,amount:Se*(Ie/2)}}class vi extends j.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor($,q,re,ye={}){const be=Mt(q.getCanvasContainer(),re),Se=q.unproject(be);super($,j.extend({point:be,lngLat:Se,originalEvent:re},ye)),this._defaultPrevented=!1,this.target=q}}class ws extends j.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor($,q,re){const ye=$==="touchend"?re.changedTouches:re.touches,be=Pt(q.getCanvasContainer(),ye),Se=be.map(Re=>q.unproject(Re)),Ie=be.reduce((Re,Fe,Ue,Ze)=>Re.add(Fe.div(Ze.length)),new j.pointGeometry(0,0));super($,{points:be,point:Ie,lngLats:Se,lngLat:q.unproject(Ie),originalEvent:re}),this._defaultPrevented=!1}}class bu extends j.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor($,q,re){super($,{originalEvent:re}),this._defaultPrevented=!1}}class wu{constructor($,q){this._map=$,this._clickTolerance=q.clickTolerance}reset(){this._mousedownPos=void 0}wheel($){return this._firePreventable(new bu($.type,this._map,$))}mousedown($,q){return this._mousedownPos=q,this._firePreventable(new vi($.type,this._map,$))}mouseup($){this._map.fire(new vi($.type,this._map,$))}preclick($){const q=j.extend({},$);q.type="preclick",this._map.fire(new vi(q.type,this._map,q))}click($,q){this._mousedownPos&&this._mousedownPos.dist(q)>=this._clickTolerance||(this.preclick($),this._map.fire(new vi($.type,this._map,$)))}dblclick($){return this._firePreventable(new vi($.type,this._map,$))}mouseover($){this._map.fire(new vi($.type,this._map,$))}mouseout($){this._map.fire(new vi($.type,this._map,$))}touchstart($){return this._firePreventable(new ws($.type,this._map,$))}touchmove($){this._map.fire(new ws($.type,this._map,$))}touchend($){this._map.fire(new ws($.type,this._map,$))}touchcancel($){this._map.fire(new ws($.type,this._map,$))}_firePreventable($){if(this._map.fire($),$.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tu{constructor($){this._map=$}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove($){this._map.fire(new vi($.type,this._map,$))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu($){this._delayContextMenu?this._contextMenuEvent=$:this._map.fire(new vi($.type,this._map,$)),this._map.listens("contextmenu")&&$.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eu{constructor($,q){this._map=$,this._el=$.getCanvasContainer(),this._container=$.getContainer(),this._clickTolerance=q.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown($,q){this.isEnabled()&&$.shiftKey&&$.button===0&&(It(),this._startPos=this._lastPos=q,this._active=!0)}mousemoveWindow($,q){if(!this._active)return;const re=q;if(this._lastPos.equals(re)||!this._box&&re.dist(this._startPos)<this._clickTolerance)return;const ye=this._startPos;this._lastPos=re,this._box||(this._box=Be("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",$));const be=Math.min(ye.x,re.x),Se=Math.max(ye.x,re.x),Ie=Math.min(ye.y,re.y),Re=Math.max(ye.y,re.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${be}px,${Ie}px)`,this._box.style.width=Se-be+"px",this._box.style.height=Re-Ie+"px")})}mouseupWindow($,q){if(!this._active||$.button!==0)return;const re=this._startPos,ye=q;if(this.reset(),Ot(),re.x!==ye.x||re.y!==ye.y)return this._map.fire(new j.Event("boxzoomend",{originalEvent:$})),{cameraAnimation:be=>be.fitScreenCoordinates(re,ye,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",$)}keydown($){this._active&&$.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",$))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ct(),delete this._startPos,delete this._lastPos}_fireEvent($,q){return this._map.fire(new j.Event($,{originalEvent:q}))}}function Ja(te,$){const q={};for(let re=0;re<te.length;re++)q[te[re].identifier]=$[re];return q}class Ts{constructor($){this.reset(),this.numTouches=$.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart($,q,re){(this.centroid||re.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=$.timeStamp),re.length===this.numTouches&&(this.centroid=function(ye){const be=new j.pointGeometry(0,0);for(const Se of ye)be._add(Se);return be.div(ye.length)}(q),this.touches=Ja(re,q)))}touchmove($,q,re){if(this.aborted||!this.centroid)return;const ye=Ja(re,q);for(const be in this.touches){const Se=this.touches[be],Ie=ye[be];(!Ie||Ie.dist(Se)>30)&&(this.aborted=!0)}}touchend($,q,re){if((!this.centroid||$.timeStamp-this.startTime>500)&&(this.aborted=!0),re.length===0){const ye=!this.aborted&&this.centroid;if(this.reset(),ye)return ye}}}class Qa{constructor($){this.singleTap=new Ts($),this.numTaps=$.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart($,q,re){this.singleTap.touchstart($,q,re)}touchmove($,q,re){this.singleTap.touchmove($,q,re)}touchend($,q,re){const ye=this.singleTap.touchend($,q,re);if(ye){const be=$.timeStamp-this.lastTime<500,Se=!this.lastTap||this.lastTap.dist(ye)<30;if(be&&Se||this.reset(),this.count++,this.lastTime=$.timeStamp,this.lastTap=ye,this.count===this.numTaps)return this.reset(),ye}}}class Au{constructor(){this._zoomIn=new Qa({numTouches:1,numTaps:2}),this._zoomOut=new Qa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart($,q,re){this._zoomIn.touchstart($,q,re),this._zoomOut.touchstart($,q,re)}touchmove($,q,re){this._zoomIn.touchmove($,q,re),this._zoomOut.touchmove($,q,re)}touchend($,q,re){const ye=this._zoomIn.touchend($,q,re),be=this._zoomOut.touchend($,q,re);return ye?(this._active=!0,$.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Se=>Se.easeTo({duration:300,zoom:Se.getZoom()+1,around:Se.unproject(ye)},{originalEvent:$})}):be?(this._active=!0,$.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Se=>Se.easeTo({duration:300,zoom:Se.getZoom()-1,around:Se.unproject(be)},{originalEvent:$})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Su={0:1,2:2};class el{constructor($){this.reset(),this._clickTolerance=$.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton($,q){return!1}_move($,q){return{}}mousedown($,q){if(this._lastPoint)return;const re=At($);this._correctButton($,re)&&(this._lastPoint=q,this._eventButton=re)}mousemoveWindow($,q){const re=this._lastPoint;if(re){if($.preventDefault(),this._eventButton!=null&&function(ye,be){const Se=Su[be];return ye.buttons===void 0||(ye.buttons&Se)!==Se}($,this._eventButton))this.reset();else if(this._moved||!(q.dist(re)<this._clickTolerance))return this._moved=!0,this._lastPoint=q,this._move(re,q)}}mouseupWindow($){this._lastPoint&&At($)===this._eventButton&&(this._moved&&Ot(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cu extends el{mousedown($,q){super.mousedown($,q),this._lastPoint&&(this._active=!0)}_correctButton($,q){return q===0&&!$.ctrlKey}_move($,q){return{around:q,panDelta:q.sub($)}}}class pc extends el{_correctButton($,q){return q===0&&$.ctrlKey||q===2}_move($,q){const re=.8*(q.x-$.x);if(re)return this._active=!0,{bearingDelta:re}}contextmenu($){$.preventDefault()}}class di extends el{_correctButton($,q){return q===0&&$.ctrlKey||q===2}_move($,q){const re=-.5*(q.y-$.y);if(re)return this._active=!0,{pitchDelta:re}}contextmenu($){$.preventDefault()}}class Hh{constructor($,q){this._map=$,this._el=$.getCanvasContainer(),this._minTouches=1,this._clickTolerance=q.clickTolerance||1,this.reset(),j.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new j.pointGeometry(0,0)}touchstart($,q,re){return this._calculateTransform($,q,re)}touchmove($,q,re){if(this._active&&!(re.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(re.length===1&&!j.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return $.cancelable&&$.preventDefault(),this._calculateTransform($,q,re)}}touchend($,q,re){this._calculateTransform($,q,re),this._active&&re.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform($,q,re){re.length>0&&(this._active=!0);const ye=Ja(re,q),be=new j.pointGeometry(0,0),Se=new j.pointGeometry(0,0);let Ie=0;for(const Fe in ye){const Ue=ye[Fe],Ze=this._touches[Fe];Ze&&(be._add(Ue),Se._add(Ue.sub(Ze)),Ie++,ye[Fe]=Ue)}if(this._touches=ye,Ie<this._minTouches||!Se.mag())return;const Re=Se.div(Ie);return this._sum._add(Re),this._sum.mag()<this._clickTolerance?void 0:{around:be.div(Ie),panDelta:Re}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class tl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start($){}_move($,q,re){return{}}touchstart($,q,re){this._firstTwoTouches||re.length<2||(this._firstTwoTouches=[re[0].identifier,re[1].identifier],this._start([q[0],q[1]]))}touchmove($,q,re){const ye=this._firstTwoTouches;if(!ye)return;$.preventDefault();const[be,Se]=ye,Ie=nl(re,q,be),Re=nl(re,q,Se);if(!Ie||!Re)return;const Fe=this._aroundCenter?null:Ie.add(Re).div(2);return this._move([Ie,Re],Fe,$)}touchend($,q,re){if(!this._firstTwoTouches)return;const[ye,be]=this._firstTwoTouches,Se=nl(re,q,ye),Ie=nl(re,q,be);Se&&Ie||(this._active&&Ot(),this.reset())}touchcancel(){this.reset()}enable($){this._enabled=!0,this._aroundCenter=!!$&&$.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function nl(te,$,q){for(let re=0;re<te.length;re++)if(te[re].identifier===q)return $[re]}function Iu(te,$){return Math.log(te/$)/Math.LN2}class po extends tl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start($){this._startDistance=this._distance=$[0].dist($[1])}_move($,q){const re=this._distance;if(this._distance=$[0].dist($[1]),this._active||!(Math.abs(Iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Iu(this._distance,re),pinchAround:q}}}function fc(te,$){return 180*te.angleWith($)/Math.PI}class Es extends tl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start($){this._startVector=this._vector=$[0].sub($[1]),this._minDiameter=$[0].dist($[1])}_move($,q){const re=this._vector;if(this._vector=$[0].sub($[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fc(this._vector,re),pinchAround:q}}_isBelowThreshold($){this._minDiameter=Math.min(this._minDiameter,$.mag());const q=25/(Math.PI*this._minDiameter)*360,re=fc($,this._startVector);return Math.abs(re)<q}}function Gi(te){return Math.abs(te.y)>Math.abs(te.x)}class rl extends tl{constructor($){super(),this._map=$}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start($){this._lastPoints=$,Gi($[0].sub($[1]))&&(this._valid=!1)}_move($,q,re){const ye=this._lastPoints;if(!ye)return;const be=$[0].sub(ye[0]),Se=$[1].sub(ye[1]);return this._map._cooperativeGestures&&re.touches.length<3||(this._valid=this.gestureBeginsVertically(be,Se,re.timeStamp),!this._valid)?void 0:(this._lastPoints=$,this._active=!0,{pitchDelta:(be.y+Se.y)/2*-.5})}gestureBeginsVertically($,q,re){if(this._valid!==void 0)return this._valid;const ye=$.mag()>=2,be=q.mag()>=2;if(!ye&&!be)return;if(!ye||!be)return this._firstMove==null&&(this._firstMove=re),re-this._firstMove<100&&void 0;const Se=$.y>0==q.y>0;return Gi($)&&Gi(q)&&Se}}const Pn={panStep:100,bearingStep:15,pitchStep:10};class Mu{constructor(){const $=Pn;this._panStep=$.panStep,this._bearingStep=$.bearingStep,this._pitchStep=$.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown($){if($.altKey||$.ctrlKey||$.metaKey)return;let q=0,re=0,ye=0,be=0,Se=0;switch($.keyCode){case 61:case 107:case 171:case 187:q=1;break;case 189:case 109:case 173:q=-1;break;case 37:$.shiftKey?re=-1:($.preventDefault(),be=-1);break;case 39:$.shiftKey?re=1:($.preventDefault(),be=1);break;case 38:$.shiftKey?ye=1:($.preventDefault(),Se=-1);break;case 40:$.shiftKey?ye=-1:($.preventDefault(),Se=1);break;default:return}return this._rotationDisabled&&(re=0,ye=0),{cameraAnimation:Ie=>{const Re=Ie.getZoom();Ie.easeTo({duration:300,easeId:"keyboardHandler",easing:Pu,zoom:q?Math.round(Re)+q*($.shiftKey?2:1):Re,bearing:Ie.getBearing()+re*this._bearingStep,pitch:Ie.getPitch()+ye*this._pitchStep,offset:[-be*this._panStep,-Se*this._panStep],center:Ie.getCenter()},{originalEvent:$})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pu(te){return te*(2-te)}const As=4.000244140625;class la{constructor($,q){this._map=$,this._el=$.getCanvasContainer(),this._handler=q,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,j.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate($){this._defaultZoomRate=$}setWheelZoomRate($){this._wheelZoomRate=$}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable($){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!$&&$.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel($){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!($.ctrlKey||$.metaKey||this.isZooming()||j.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let q=$.deltaMode===j.window.WheelEvent.DOM_DELTA_LINE?40*$.deltaY:$.deltaY;const re=j.exported.now(),ye=re-(this._lastWheelEventTime||0);this._lastWheelEventTime=re,q!==0&&q%As==0?this._type="wheel":q!==0&&Math.abs(q)<4?this._type="trackpad":ye>400?(this._type=null,this._lastValue=q,this._timeout=setTimeout(this._onTimeout,40,$)):this._type||(this._type=Math.abs(ye*q)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,q+=this._lastValue)),$.shiftKey&&q&&(q/=4),this._type&&(this._lastWheelEvent=$,this._delta-=q,this._active||this._start($)),$.preventDefault()}_onTimeout($){this._type="wheel",this._delta-=this._lastValue,this._active||this._start($)}_start($){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const q=Mt(this._el,$);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:q,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const $=this._map.transform,q=()=>$._terrainEnabled()&&this._aroundCoord?$.computeZoomRelativeTo(this._aroundCoord):$.zoom;if(this._delta!==0){const Re=this._type==="wheel"&&Math.abs(this._delta)>As?this._wheelZoomRate:this._defaultZoomRate;let Fe=2/(1+Math.exp(-Math.abs(this._delta*Re)));this._delta<0&&Fe!==0&&(Fe=1/Fe);const Ue=q(),Ze=Math.pow(2,Ue),Ye=typeof this._targetZoom=="number"?$.zoomScale(this._targetZoom):Ze;this._targetZoom=Math.min($.maxZoom,Math.max($.minZoom,$.scaleZoom(Ye*Fe))),this._type==="wheel"&&(this._startZoom=Ue,this._easing=this._smoothOutEasing(200)),this._delta=0}const re=typeof this._targetZoom=="number"?this._targetZoom:q(),ye=this._startZoom,be=this._easing;let Se,Ie=!1;if(this._type==="wheel"&&ye&&be){const Re=Math.min((j.exported.now()-this._lastWheelEventTime)/200,1),Fe=be(Re);Se=j.number(ye,re,Fe),Re<1?this._frameId||(this._frameId=!0):Ie=!0}else Se=re,Ie=!0;return this._active=!0,Ie&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Ie,zoomDelta:Se-q(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing($){let q=j.ease;if(this._prevEase){const re=this._prevEase,ye=(j.exported.now()-re.start)/re.duration,be=re.easing(ye+.01)-re.easing(ye),Se=.27/Math.sqrt(be*be+1e-4)*.01,Ie=Math.sqrt(.0729-Se*Se);q=j.bezier(Se,Ie,.25,1)}return this._prevEase={start:j.exported.now(),duration:$,easing:q},q}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(j.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ku{constructor($,q){this._clickZoom=$,this._tapZoom=q}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ru{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick($,q){return $.preventDefault(),{cameraAnimation:re=>{re.easeTo({duration:300,zoom:re.getZoom()+($.shiftKey?-1:1),around:re.unproject(q)},{originalEvent:$})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu{constructor(){this._tap=new Qa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart($,q,re){this._swipePoint||(this._tapTime&&$.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?re.length>0&&(this._swipePoint=q[0],this._swipeTouch=re[0].identifier):this._tap.touchstart($,q,re))}touchmove($,q,re){if(this._tapTime){if(this._swipePoint){if(re[0].identifier!==this._swipeTouch)return;const ye=q[0],be=ye.y-this._swipePoint.y;return this._swipePoint=ye,$.preventDefault(),this._active=!0,{zoomDelta:be/128}}}else this._tap.touchmove($,q,re)}touchend($,q,re){this._tapTime?this._swipePoint&&re.length===0&&this.reset():this._tap.touchend($,q,re)&&(this._tapTime=$.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Du{constructor($,q,re){this._el=$,this._mousePan=q,this._touchPan=re}enable($){this._inertiaOptions=$||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lu{constructor($,q,re){this._pitchWithRotate=$.pitchWithRotate,this._mouseRotate=q,this._mousePitch=re}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bu{constructor($,q,re,ye){this._el=$,this._touchZoom=q,this._touchRotate=re,this._tapDragZoom=ye,this._rotationDisabled=!1,this._enabled=!0}enable($){this._touchZoom.enable($),this._rotationDisabled||this._touchRotate.enable($),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ca=te=>te.zoom||te.drag||te.pitch||te.rotate;class il extends j.Event{}class mc{constructor(){this.constants=[1,1,.01],this.radius=0}setup($,q){const re=j.sub([],q,$);this.radius=j.length(re[2]<0?j.div([],re,this.constants):[re[0],re[1],0])}projectRay($){j.div($,$,this.constants),j.normalize($,$),j.mul$1($,$,this.constants);const q=j.scale$2([],$,this.radius);if(q[2]>0){const re=j.scale$2([],[0,0,1],j.dot(q,[0,0,1])),ye=j.scale$2([],j.normalize([],[q[0],q[1],0]),this.radius),be=j.add([],q,j.scale$2([],j.sub([],j.add([],ye,re),q),2));q[0]=be[0],q[1]=be[1]}return q}}function Ho(te){return te.panDelta&&te.panDelta.mag()||te.zoomDelta||te.bearingDelta||te.pitchDelta}class Ou{constructor($,q){this._map=$,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dc($),this._bearingSnap=q.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new mc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(q),j.bindAll(["handleEvent","handleWindowEvent"],this);const re=this._el;this._listeners=[[re,"touchstart",{passive:!0}],[re,"touchmove",{passive:!1}],[re,"touchend",void 0],[re,"touchcancel",void 0],[re,"mousedown",void 0],[re,"mousemove",void 0],[re,"mouseup",void 0],[j.window.document,"mousemove",{capture:!0}],[j.window.document,"mouseup",void 0],[re,"mouseover",void 0],[re,"mouseout",void 0],[re,"dblclick",void 0],[re,"click",void 0],[re,"keydown",{capture:!1}],[re,"keyup",void 0],[re,"wheel",{passive:!1}],[re,"contextmenu",void 0],[j.window,"blur",void 0]];for(const[ye,be,Se]of this._listeners)ye.addEventListener(be,ye===j.window.document?this.handleWindowEvent:this.handleEvent,Se)}destroy(){for(const[$,q,re]of this._listeners)$.removeEventListener(q,$===j.window.document?this.handleWindowEvent:this.handleEvent,re)}_addDefaultHandlers($){const q=this._map,re=q.getCanvasContainer();this._add("mapEvent",new wu(q,$));const ye=q.boxZoom=new Eu(q,$);this._add("boxZoom",ye);const be=new Au,Se=new Ru;q.doubleClickZoom=new ku(Se,be),this._add("tapZoom",be),this._add("clickZoom",Se);const Ie=new zu;this._add("tapDragZoom",Ie);const Re=q.touchPitch=new rl(q);this._add("touchPitch",Re);const Fe=new pc($),Ue=new di($);q.dragRotate=new Lu($,Fe,Ue),this._add("mouseRotate",Fe,["mousePitch"]),this._add("mousePitch",Ue,["mouseRotate"]);const Ze=new Cu($),Ye=new Hh(q,$);q.dragPan=new Du(re,Ze,Ye),this._add("mousePan",Ze),this._add("touchPan",Ye,["touchZoom","touchRotate"]);const rt=new Es,et=new po;q.touchZoomRotate=new Bu(re,et,rt,Ie),this._add("touchRotate",rt,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Tu(q));const tt=q.scrollZoom=new la(q,this);this._add("scrollZoom",tt,["mousePan"]);const nt=q.keyboard=new Mu;this._add("keyboard",nt);for(const Qe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])$.interactive&&$[Qe]&&q[Qe].enable($[Qe])}_add($,q,re){this._handlers.push({handlerName:$,handler:q,allowed:re}),this._handlersById[$]=q}stop($){if(!this._updatingCamera){for(const{handler:q}of this._handlers)q.reset();this._inertia.clear(),this._fireEvents({},{},$),this._changes=[]}}isActive(){for(const{handler:$}of this._handlers)if($.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ca(this._eventsInProgress)||this.isZooming()}_blockedByActive($,q,re){for(const ye in $)if(ye!==re&&(!q||q.indexOf(ye)<0))return!0;return!1}handleWindowEvent($){this.handleEvent($,`${$.type}Window`)}_getMapTouches($){const q=[];for(const re of $)this._el.contains(re.target)&&q.push(re);return q}handleEvent($,q){this._updatingCamera=!0;const re=$.type==="renderFrame",ye=re?void 0:$,be={needsRenderFrame:!1},Se={},Ie={},Re=$.touches?this._getMapTouches($.touches):void 0,Fe=Re?Pt(this._el,Re):re?void 0:Mt(this._el,$);for(const{handlerName:Ye,handler:rt,allowed:et}of this._handlers){if(!rt.isEnabled())continue;let tt;this._blockedByActive(Ie,et,Ye)?rt.reset():rt[q||$.type]&&(tt=rt[q||$.type]($,Fe,Re),this.mergeHandlerResult(be,Se,tt,Ye,ye),tt&&tt.needsRenderFrame&&this._triggerRenderFrame()),(tt||rt.isActive())&&(Ie[Ye]=rt)}const Ue={};for(const Ye in this._previousActiveHandlers)Ie[Ye]||(Ue[Ye]=ye);this._previousActiveHandlers=Ie,(Object.keys(Ue).length||Ho(be))&&(this._changes.push([be,Se,Ue]),this._triggerRenderFrame()),(Object.keys(Ie).length||Ho(be))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ze}=be;Ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ze(this._map))}mergeHandlerResult($,q,re,ye,be){if(!re)return;j.extend($,re);const Se={handlerName:ye,originalEvent:re.originalEvent||be};re.zoomDelta!==void 0&&(q.zoom=Se),re.panDelta!==void 0&&(q.drag=Se),re.pitchDelta!==void 0&&(q.pitch=Se),re.bearingDelta!==void 0&&(q.rotate=Se)}_applyChanges(){const $={},q={},re={};for(const[ye,be,Se]of this._changes)ye.panDelta&&($.panDelta=($.panDelta||new j.pointGeometry(0,0))._add(ye.panDelta)),ye.zoomDelta&&($.zoomDelta=($.zoomDelta||0)+ye.zoomDelta),ye.bearingDelta&&($.bearingDelta=($.bearingDelta||0)+ye.bearingDelta),ye.pitchDelta&&($.pitchDelta=($.pitchDelta||0)+ye.pitchDelta),ye.around!==void 0&&($.around=ye.around),ye.aroundCoord!==void 0&&($.aroundCoord=ye.aroundCoord),ye.pinchAround!==void 0&&($.pinchAround=ye.pinchAround),ye.noInertia&&($.noInertia=ye.noInertia),j.extend(q,be),j.extend(re,Se);this._updateMapTransform($,q,re),this._changes=[]}_updateMapTransform($,q,re){const ye=this._map,be=ye.transform,Se=lt=>[lt.x,lt.y,lt.z];if((lt=>{const it=this._eventsInProgress.drag;return it&&!this._handlersById[it.handlerName].isActive()})()&&!Ho($)){const lt=be.zoom;be.cameraElevationReference="sea",be.recenterOnTerrain(),be.cameraElevationReference="ground",lt!==be.zoom&&this._map._update(!0)}if(!Ho($))return void this._fireEvents(q,re,!0);let{panDelta:Ie,zoomDelta:Re,bearingDelta:Fe,pitchDelta:Ue,around:Ze,aroundCoord:Ye,pinchAround:rt}=$;rt!==void 0&&(Ze=rt),(lt=>q.drag&&!this._eventsInProgress.drag)()&&Ze&&(this._dragOrigin=Se(be.pointCoordinate3D(Ze)),this._trackingEllipsoid.setup(be._camera.position,this._dragOrigin)),be.cameraElevationReference="sea",ye._stop(!0),Ze=Ze||ye.transform.centerPoint,Fe&&(be.bearing+=Fe),Ue&&(be.pitch+=Ue),be._updateCameraState();const et=[0,0,0];if(Ie)if(be.projection.name==="mercator"){const lt=this._trackingEllipsoid.projectRay(be.screenPointToMercatorRay(Ze).dir),it=this._trackingEllipsoid.projectRay(be.screenPointToMercatorRay(Ze.sub(Ie)).dir);et[0]=it[0]-lt[0],et[1]=it[1]-lt[1]}else{const lt=be.pointCoordinate(Ze);if(be.projection.name==="globe"){Ie=Ie.rotate(-be.angle);const it=be._pixelsPerMercatorPixel/be.worldSize;et[0]=-Ie.x*j.mercatorScale(j.latFromMercatorY(lt.y))*it,et[1]=-Ie.y*j.mercatorScale(be.center.lat)*it}else{const it=be.pointCoordinate(Ze.sub(Ie));lt&&it&&(et[0]=it.x-lt.x,et[1]=it.y-lt.y)}}const tt=be.zoom,nt=[0,0,0];if(Re){const lt=Se(Ye||be.pointCoordinate3D(Ze)),it={dir:j.normalize([],j.sub([],lt,be._camera.position))};if(it.dir[2]<0){const xt=be.zoomDeltaToMovement(lt,Re);j.scale$2(nt,it.dir,xt)}}const Qe=j.add(et,et,nt);be._translateCameraConstrained(Qe),Re&&Math.abs(be.zoom-tt)>1e-4&&be.recenterOnTerrain(),be.cameraElevationReference="ground",this._map._update(),$.noInertia||this._inertia.record($),this._fireEvents(q,re,!0)}_fireEvents($,q,re){const ye=ca(this._eventsInProgress),be=ca($),Se={};for(const Ue in $){const{originalEvent:Ze}=$[Ue];this._eventsInProgress[Ue]||(Se[`${Ue}start`]=Ze),this._eventsInProgress[Ue]=$[Ue]}!ye&&be&&this._fireEvent("movestart",be.originalEvent);for(const Ue in Se)this._fireEvent(Ue,Se[Ue]);be&&this._fireEvent("move",be.originalEvent);for(const Ue in $){const{originalEvent:Ze}=$[Ue];this._fireEvent(Ue,Ze)}const Ie={};let Re;for(const Ue in this._eventsInProgress){const{handlerName:Ze,originalEvent:Ye}=this._eventsInProgress[Ue];this._handlersById[Ze].isActive()||(delete this._eventsInProgress[Ue],Re=q[Ze]||Ye,Ie[`${Ue}end`]=Re)}for(const Ue in Ie)this._fireEvent(Ue,Ie[Ue]);const Fe=ca(this._eventsInProgress);if(re&&(ye||be)&&!Fe){this._updatingCamera=!0;const Ue=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ze=Ye=>Ye!==0&&-this._bearingSnap<Ye&&Ye<this._bearingSnap;Ue?(Ze(Ue.bearing||this._map.getBearing())&&(Ue.bearing=0),this._map.easeTo(Ue,{originalEvent:Re})):(this._map.fire(new j.Event("moveend",{originalEvent:Re})),Ze(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent($,q){this._map.fire(new j.Event($,q?{originalEvent:q}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add($=>{this._frameId=void 0,this.handleEvent(new il("renderFrame",{timeStamp:$})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const _c="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fu extends j.Evented{constructor($,q){super(),this._moving=!1,this._zooming=!1,this.transform=$,this._bearingSnap=q.bearingSnap,j.bindAll(["_renderFrameCallback"],this)}getCenter(){return new j.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter($,q){return this.jumpTo({center:$},q)}panBy($,q,re){return $=j.pointGeometry.convert($).mult(-1),this.panTo(this.transform.center,j.extend({offset:$},q),re)}panTo($,q,re){return this.easeTo(j.extend({center:$},q),re)}getZoom(){return this.transform.zoom}setZoom($,q){return this.jumpTo({zoom:$},q),this}zoomTo($,q,re){return this.easeTo(j.extend({zoom:$},q),re)}zoomIn($,q){return this.zoomTo(this.getZoom()+1,$,q),this}zoomOut($,q){return this.zoomTo(this.getZoom()-1,$,q),this}getBearing(){return this.transform.bearing}setBearing($,q){return this.jumpTo({bearing:$},q),this}getPadding(){return this.transform.padding}setPadding($,q){return this.jumpTo({padding:$},q),this}rotateTo($,q,re){return this.easeTo(j.extend({bearing:$},q),re)}resetNorth($,q){return this.rotateTo(0,j.extend({duration:1e3},$),q),this}resetNorthPitch($,q){return this.easeTo(j.extend({bearing:0,pitch:0,duration:1e3},$),q),this}snapToNorth($,q){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth($,q):this}getPitch(){return this.transform.pitch}setPitch($,q){return this.jumpTo({pitch:$},q),this}cameraForBounds($,q){this.transform.projection.name==="globe"&&j.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),$=j.LngLatBounds.convert($);const re=q&&q.bearing||0;return this._cameraForBoxAndBearing($.getNorthWest(),$.getSouthEast(),re,q)}_extendCameraOptions($){const q={top:0,bottom:0,right:0,left:0};if(typeof($=j.extend({padding:q,offset:[0,0],maxZoom:this.transform.maxZoom},$)).padding=="number"){const re=$.padding;$.padding={top:re,bottom:re,right:re,left:re}}return $.padding=j.extend(q,$.padding),$}_cameraForBoxAndBearing($,q,re,ye){const be=this._extendCameraOptions(ye),Se=this.transform,Ie=Se.padding,Re=Se.project(j.LngLat.convert($)),Fe=Se.project(j.LngLat.convert(q)),Ue=new j.pointGeometry(Re.x,Fe.y),Ze=new j.pointGeometry(Fe.x,Re.y),Ye=-j.degToRad(re),rt=Re.rotate(Ye),et=Fe.rotate(Ye),tt=Ue.rotate(Ye),nt=Ze.rotate(Ye),Qe=new j.pointGeometry(Math.max(rt.x,et.x,tt.x,nt.x),Math.max(rt.y,et.y,tt.y,nt.y)),lt=new j.pointGeometry(Math.min(rt.x,et.x,tt.x,nt.x),Math.min(rt.y,et.y,tt.y,nt.y)),it=Qe.sub(lt),xt=(Se.width-((Ie.left||0)+(Ie.right||0)+be.padding.left+be.padding.right))/it.x,gt=(Se.height-((Ie.top||0)+(Ie.bottom||0)+be.padding.top+be.padding.bottom))/it.y;if(gt<0||xt<0)return void j.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const dt=Math.min(Se.scaleZoom(Se.scale*Math.min(xt,gt)),be.maxZoom),vt=typeof be.offset.x=="number"&&typeof be.offset.y=="number"?new j.pointGeometry(be.offset.x,be.offset.y):j.pointGeometry.convert(be.offset),_t=new j.pointGeometry((be.padding.left-be.padding.right)/2,(be.padding.top-be.padding.bottom)/2).rotate(re*Math.PI/180),St=vt.add(_t).mult(Se.scale/Se.zoomScale(dt));return{center:Se.unproject(Re.add(Fe).div(2).sub(St)),zoom:dt,bearing:re}}_cameraForBox($,q,re,ye,be){const Se=this._extendCameraOptions(be);re=re||0,ye=ye||0,$=j.LngLat.convert($),q=j.LngLat.convert(q);const Ie=this.transform.clone();Ie.padding=Se.padding;const Re=this.getFreeCameraOptions(),Fe=new j.LngLat(.5*($.lng+q.lng),.5*($.lat+q.lat)),Ue=.5*(re+ye);if(Ie._camera.position[2]<j.mercatorZfromAltitude(Ue,Fe.lat))return void j.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Re.lookAtPoint(Fe),Ie.setFreeCameraOptions(Re);const Ze=j.MercatorCoordinate.fromLngLat($),Ye=j.MercatorCoordinate.fromLngLat(q),rt=Ie.pointRayIntersection(Ie.centerPoint,Ue),et=[(tt=Ie.rayIntersectionCoordinate(rt)).x,tt.y,tt.z];var tt;const nt=Ie.screenPointToMercatorRay(Ie.centerPoint),Qe=Ie.projection.name!=="globe";let lt,it=0;do{const xt=Math.floor(Ie.zoom),gt=1<<xt,dt=Math.min(gt*Ze.x,gt*Ye.x),vt=Math.min(gt*Ze.y,gt*Ye.y),_t=Math.max(gt*Ze.x,gt*Ye.x),St=Math.max(gt*Ze.y,gt*Ye.y),Bt=new j.Aabb([dt,vt,re],[_t,St,ye]),un=j.Frustum.fromInvProjectionMatrix(Ie.invProjMatrix,Ie.worldSize,xt,Qe);if(Bt.intersects(un)!==2){lt&&(Ie._camera.position=j.scaleAndAdd([],Ie._camera.position,nt.dir,-lt),Ie._updateStateFromCamera());break}const Rt=j.sub([],Ie._camera.position,et);lt=.5*j.length(Rt),Ie._camera.position=j.scaleAndAdd([],Ie._camera.position,nt.dir,lt);try{Ie._updateStateFromCamera()}catch{return void j.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++it<10);return{center:Ie.center,zoom:Ie.zoom,bearing:Ie.bearing,pitch:Ie.pitch}}fitBounds($,q,re){return this.transform.projection.name==="globe"&&j.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds($,q),q,re)}_raycastElevationBox($,q){const re=this.transform.elevation;if(!re)return;const ye=new j.pointGeometry($.x,q.y),be=new j.pointGeometry(q.x,$.y),Se=re.pointCoordinate($);if(!Se)return;const Ie=re.pointCoordinate(q);if(!Ie)return;const Re=re.pointCoordinate(ye);if(!Re)return;const Fe=re.pointCoordinate(be);if(!Fe)return;const Ue=new j.MercatorCoordinate(Se[0],Se[1]).toLngLat(),Ze=new j.MercatorCoordinate(Ie[0],Ie[1]).toLngLat(),Ye=new j.MercatorCoordinate(Re[0],Re[1]).toLngLat(),rt=new j.MercatorCoordinate(Fe[0],Fe[1]).toLngLat(),et=Math.min(Ue.lng,Math.min(Ze.lng,Math.min(Ye.lng,rt.lng))),tt=Math.min(Ue.lat,Math.min(Ze.lat,Math.min(Ye.lat,rt.lat))),nt=Math.max(Ue.lng,Math.max(Ze.lng,Math.max(Ye.lng,rt.lng))),Qe=Math.max(Ue.lat,Math.max(Ze.lat,Math.max(Ye.lat,rt.lat))),lt=Math.min(Se[3],Math.min(Ie[3],Math.min(Re[3],Fe[3]))),it=Math.max(Se[3],Math.max(Ie[3],Math.max(Re[3],Fe[3])));return{minLngLat:new j.LngLat(et,tt),maxLngLat:new j.LngLat(nt,Qe),minAltitude:lt,maxAltitude:it}}fitScreenCoordinates($,q,re,ye,be){let Se,Ie,Re,Fe;this.transform.projection.name==="globe"&&j.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const Ue=j.pointGeometry.convert($),Ze=j.pointGeometry.convert(q),Ye=this._raycastElevationBox(Ue,Ze);if(Ye)Se=Ye.minLngLat,Ie=Ye.maxLngLat,Re=Ye.minAltitude,Fe=Ye.maxAltitude;else{if(this.transform.anyCornerOffEdge(Ue,Ze))return this;Se=this.transform.pointLocation(Ue),Ie=this.transform.pointLocation(Ze)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(j.pointGeometry.convert($)),this.transform.pointLocation(j.pointGeometry.convert(q)),re,ye):this._cameraForBox(Se,Ie,Re,Fe,ye),ye,be)}_fitInternal($,q,re){return $?(delete(q=j.extend($,q)).padding,q.linear?this.easeTo(q,re):this.flyTo(q,re)):this}jumpTo($,q){this.stop();const re=$.preloadOnly?this.transform.clone():this.transform;let ye=!1,be=!1,Se=!1;return"zoom"in $&&re.zoom!==+$.zoom&&(ye=!0,re.zoom=+$.zoom),$.center!==void 0&&(re.center=j.LngLat.convert($.center)),"bearing"in $&&re.bearing!==+$.bearing&&(be=!0,re.bearing=+$.bearing),"pitch"in $&&re.pitch!==+$.pitch&&(Se=!0,re.pitch=+$.pitch),$.padding==null||re.isPaddingEqual($.padding)||(re.padding=$.padding),$.preloadOnly?(this._preloadTiles(re),this):(this.fire(new j.Event("movestart",q)).fire(new j.Event("move",q)),ye&&this.fire(new j.Event("zoomstart",q)).fire(new j.Event("zoom",q)).fire(new j.Event("zoomend",q)),be&&this.fire(new j.Event("rotatestart",q)).fire(new j.Event("rotate",q)).fire(new j.Event("rotateend",q)),Se&&this.fire(new j.Event("pitchstart",q)).fire(new j.Event("pitch",q)).fire(new j.Event("pitchend",q)),this.fire(new j.Event("moveend",q)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||j.warnOnce(_c),this.transform.getFreeCameraOptions()}setFreeCameraOptions($,q){const re=this.transform;if(!re.projection.supportsFreeCamera)return j.warnOnce(_c),this;this.stop();const ye=re.zoom,be=re.pitch,Se=re.bearing;re.setFreeCameraOptions($);const Ie=ye!==re.zoom,Re=be!==re.pitch,Fe=Se!==re.bearing;return this.fire(new j.Event("movestart",q)).fire(new j.Event("move",q)),Ie&&this.fire(new j.Event("zoomstart",q)).fire(new j.Event("zoom",q)).fire(new j.Event("zoomend",q)),Fe&&this.fire(new j.Event("rotatestart",q)).fire(new j.Event("rotate",q)).fire(new j.Event("rotateend",q)),Re&&this.fire(new j.Event("pitchstart",q)).fire(new j.Event("pitch",q)).fire(new j.Event("pitchend",q)),this.fire(new j.Event("moveend",q)),this}easeTo($,q){this._stop(!1,$.easeId),(($=j.extend({offset:[0,0],duration:500,easing:j.ease},$)).animate===!1||!$.essential&&j.exported.prefersReducedMotion)&&($.duration=0);const re=this.transform,ye=this.getZoom(),be=this.getBearing(),Se=this.getPitch(),Ie=this.getPadding(),Re="zoom"in $?+$.zoom:ye,Fe="bearing"in $?this._normalizeBearing($.bearing,be):be,Ue="pitch"in $?+$.pitch:Se,Ze="padding"in $?$.padding:re.padding,Ye=j.pointGeometry.convert($.offset);let rt,et,tt;if(re.projection.name==="globe"){const St=j.MercatorCoordinate.fromLngLat(re.center),Bt=Ye.rotate(-re.angle);St.x+=Bt.x/re.worldSize,St.y+=Bt.y/re.worldSize;const un=St.toLngLat(),Rt=j.LngLat.convert($.center||un);this._normalizeCenter(Rt),rt=re.centerPoint.add(Bt),et=new j.pointGeometry(St.x,St.y).mult(re.worldSize),tt=new j.pointGeometry(j.mercatorXfromLng(Rt.lng),j.mercatorYfromLat(Rt.lat)).mult(re.worldSize).sub(et)}else{rt=re.centerPoint.add(Ye);const St=re.pointLocation(rt),Bt=j.LngLat.convert($.center||St);this._normalizeCenter(Bt),et=re.project(St),tt=re.project(Bt).sub(et)}const nt=re.zoomScale(Re-ye);let Qe,lt;$.around&&(Qe=j.LngLat.convert($.around),lt=re.locationPoint(Qe));const it=this._zooming||Re!==ye,xt=this._rotating||be!==Fe,gt=this._pitching||Ue!==Se,dt=!re.isPaddingEqual(Ze),vt=St=>Bt=>{if(it&&(St.zoom=j.number(ye,Re,Bt)),xt&&(St.bearing=j.number(be,Fe,Bt)),gt&&(St.pitch=j.number(Se,Ue,Bt)),dt&&(St.interpolatePadding(Ie,Ze,Bt),rt=St.centerPoint.add(Ye)),Qe)St.setLocationAtPoint(Qe,lt);else{const un=St.zoomScale(St.zoom-ye),Rt=Re>ye?Math.min(2,nt):Math.max(.5,nt),Xt=Math.pow(Rt,1-Bt),Qt=St.unproject(et.add(tt.mult(Bt*Xt)).mult(un));St.setLocationAtPoint(St.renderWorldCopies?Qt.wrap():Qt,rt)}return $.preloadOnly||this._fireMoveEvents(q),St};if($.preloadOnly){const St=this._emulate(vt,$.duration,re);return this._preloadTiles(St),this}const _t={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=it,this._rotating=xt,this._pitching=gt,this._padding=dt,this._easeId=$.easeId,this._prepareEase(q,$.noMoveStart,_t),this._ease(vt(re),St=>{re.recenterOnTerrain(),this._afterEase(q,St)},$),this}_prepareEase($,q,re={}){this._moving=!0,this.transform.cameraElevationReference="sea",q||re.moving||this.fire(new j.Event("movestart",$)),this._zooming&&!re.zooming&&this.fire(new j.Event("zoomstart",$)),this._rotating&&!re.rotating&&this.fire(new j.Event("rotatestart",$)),this._pitching&&!re.pitching&&this.fire(new j.Event("pitchstart",$))}_fireMoveEvents($){this.fire(new j.Event("move",$)),this._zooming&&this.fire(new j.Event("zoom",$)),this._rotating&&this.fire(new j.Event("rotate",$)),this._pitching&&this.fire(new j.Event("pitch",$))}_afterEase($,q){if(this._easeId&&q&&this._easeId===q)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const re=this._zooming,ye=this._rotating,be=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,re&&this.fire(new j.Event("zoomend",$)),ye&&this.fire(new j.Event("rotateend",$)),be&&this.fire(new j.Event("pitchend",$)),this.fire(new j.Event("moveend",$))}flyTo($,q){if(!$.essential&&j.exported.prefersReducedMotion){const wn=j.pick($,["center","zoom","bearing","pitch","around"]);return this.jumpTo(wn,q)}this.stop(),$=j.extend({offset:[0,0],speed:1.2,curve:1.42,easing:j.ease},$);const re=this.transform,ye=this.getZoom(),be=this.getBearing(),Se=this.getPitch(),Ie=this.getPadding(),Re="zoom"in $?j.clamp(+$.zoom,re.minZoom,re.maxZoom):ye,Fe="bearing"in $?this._normalizeBearing($.bearing,be):be,Ue="pitch"in $?+$.pitch:Se,Ze="padding"in $?$.padding:re.padding,Ye=re.zoomScale(Re-ye),rt=j.pointGeometry.convert($.offset);let et=re.centerPoint.add(rt);const tt=re.pointLocation(et),nt=j.LngLat.convert($.center||tt);this._normalizeCenter(nt);const Qe=re.project(tt),lt=re.project(nt).sub(Qe);let it=$.curve;const xt=Math.max(re.width,re.height),gt=xt/Ye,dt=lt.mag();if("minZoom"in $){const wn=j.clamp(Math.min($.minZoom,ye,Re),re.minZoom,re.maxZoom),xn=xt/re.zoomScale(wn-ye);it=Math.sqrt(xn/dt*2)}const vt=it*it;function _t(wn){const xn=(gt*gt-xt*xt+(wn?-1:1)*vt*vt*dt*dt)/(2*(wn?gt:xt)*vt*dt);return Math.log(Math.sqrt(xn*xn+1)-xn)}function St(wn){return(Math.exp(wn)-Math.exp(-wn))/2}function Bt(wn){return(Math.exp(wn)+Math.exp(-wn))/2}const un=_t(0);let Rt=function(wn){return Bt(un)/Bt(un+it*wn)},Xt=function(wn){return xt*((Bt(un)*(St(xn=un+it*wn)/Bt(xn))-St(un))/vt)/dt;var xn},Qt=(_t(1)-un)/it;if(Math.abs(dt)<1e-6||!isFinite(Qt)){if(Math.abs(xt-gt)<1e-6)return this.easeTo($,q);const wn=gt<xt?-1:1;Qt=Math.abs(Math.log(gt/xt))/it,Xt=function(){return 0},Rt=function(xn){return Math.exp(wn*it*xn)}}$.duration="duration"in $?+$.duration:1e3*Qt/("screenSpeed"in $?+$.screenSpeed/it:+$.speed),$.maxDuration&&$.duration>$.maxDuration&&($.duration=0);const gn=be!==Fe,jt=Ue!==Se,dn=!re.isPaddingEqual(Ze),Jt=wn=>xn=>{const zn=xn*Qt,$n=1/Rt(zn);wn.zoom=xn===1?Re:ye+wn.scaleZoom($n),gn&&(wn.bearing=j.number(be,Fe,xn)),jt&&(wn.pitch=j.number(Se,Ue,xn)),dn&&(wn.interpolatePadding(Ie,Ze,xn),et=wn.centerPoint.add(rt));const Wn=xn===1?nt:wn.unproject(Qe.add(lt.mult(Xt(zn))).mult($n));return wn.setLocationAtPoint(wn.renderWorldCopies?Wn.wrap():Wn,et),wn._updateCameraOnTerrain(),$.preloadOnly||this._fireMoveEvents(q),wn};if($.preloadOnly){const wn=this._emulate(Jt,$.duration,re);return this._preloadTiles(wn),this}return this._zooming=!0,this._rotating=gn,this._pitching=jt,this._padding=dn,this._prepareEase(q,!1),this._ease(Jt(re),()=>this._afterEase(q),$),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop($,q){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const re=this._onEaseEnd;this._onEaseEnd=void 0,re.call(this,q)}if(!$){const re=this.handlers;re&&re.stop(!1)}return this}_ease($,q,re){re.animate===!1||re.duration===0?($(1),q()):(this._easeStart=j.exported.now(),this._easeOptions=re,this._onEaseFrame=$,this._onEaseEnd=q,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const $=Math.min((j.exported.now()-this._easeStart)/this._easeOptions.duration,1),q=this._onEaseFrame;q&&q(this._easeOptions.easing($)),$<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing($,q){$=j.wrap($,-180,180);const re=Math.abs($-q);return Math.abs($-360-q)<re&&($-=360),Math.abs($+360-q)<re&&($+=360),$}_normalizeCenter($){const q=this.transform;if(!q.renderWorldCopies||q.maxBounds)return;const re=$.lng-q.center.lng;$.lng+=re>180?-360:re<-180?360:0}_emulate($,q,re){const ye=Math.ceil(15*q/1e3),be=[],Se=$(re.clone());for(let Ie=0;Ie<=ye;Ie++){const Re=Se(Ie/ye);be.push(Re.clone())}return be}}class gc{constructor($={}){this.options=$,j.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd($){const q=this.options&&this.options.compact;return this._map=$,this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Be("button","mapboxgl-ctrl-attrib-button",this._container),Be("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Be("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),q&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),q===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle($,q){const re=this._map._getUIString(`AttributionControl.${q}`);$.setAttribute("aria-label",re),$.removeAttribute("title"),$.firstElementChild&&$.firstElementChild.setAttribute("title",re)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let $=this._editLink;$||($=this._editLink=this._container.querySelector(".mapbox-improve-map"));const q=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||j.config.ACCESS_TOKEN}];if($){const re=q.reduce((ye,be,Se)=>(be.value&&(ye+=`${be.key}=${be.value}${Se<q.length-1?"&":""}`),ye),"?");$.href=`${j.config.FEEDBACK_URL}/${re}#${hc(this._map,!0)}`,$.rel="noopener nofollow",this._setElementTitle($,"MapFeedback")}}_updateData($){!$||$.sourceDataType!=="metadata"&&$.sourceDataType!=="visibility"&&$.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let $=[];if(this._map.style.stylesheet){const ye=this._map.style.stylesheet;this.styleOwner=ye.owner,this.styleId=ye.id}const q=this._map.style._sourceCaches;for(const ye in q){const be=q[ye];if(be.used){const Se=be.getSource();Se.attribution&&$.indexOf(Se.attribution)<0&&$.push(Se.attribution)}}$.sort((ye,be)=>ye.length-be.length),$=$.filter((ye,be)=>{for(let Se=be+1;Se<$.length;Se++)if($[Se].indexOf(ye)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?$=[...this.options.customAttribution,...$]:$.unshift(this.options.customAttribution));const re=$.join(" | ");re!==this._attribHTML&&(this._attribHTML=re,$.length?(this._innerContainer.innerHTML=re,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yc{constructor(){j.bindAll(["_updateLogo","_updateCompact"],this)}onAdd($){this._map=$,this._container=Be("div","mapboxgl-ctrl");const q=Be("a","mapboxgl-ctrl-logo");return q.target="_blank",q.rel="noopener nofollow",q.href="https://www.mapbox.com/",q.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),q.setAttribute("rel","noopener nofollow"),this._container.appendChild(q),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo($){$&&$.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const $=this._map.style._sourceCaches;if(Object.entries($).length===0)return!0;for(const q in $){const re=$[q].getSource();if(re.hasOwnProperty("mapbox_logo")&&!re.mapbox_logo)return!1}return!0}_updateCompact(){const $=this._container.children;if($.length){const q=$[0];this._map.getCanvasContainer().offsetWidth<250?q.classList.add("mapboxgl-compact"):q.classList.remove("mapboxgl-compact")}}}class vc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add($){const q=++this._id;return this._queue.push({callback:$,id:q,cancelled:!1}),q}remove($){const q=this._currentlyRunning,re=q?this._queue.concat(q):this._queue;for(const ye of re)if(ye.id===$)return void(ye.cancelled=!0)}run($=0){const q=this._currentlyRunning=this._queue;this._queue=[];for(const re of q)if(!re.cancelled&&(re.callback($),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function xc(te,$,q){if(te=new j.LngLat(te.lng,te.lat),$){const re=new j.LngLat(te.lng-360,te.lat),ye=new j.LngLat(te.lng+360,te.lat),be=360*Math.ceil(Math.abs(te.lng-q.center.lng)/360),Se=q.locationPoint(te).distSqr($),Ie=$.x<0||$.y<0||$.x>q.width||$.y>q.height;q.locationPoint(re).distSqr($)<Se&&(Ie||Math.abs(re.lng-q.center.lng)<be)?te=re:q.locationPoint(ye).distSqr($)<Se&&(Ie||Math.abs(ye.lng-q.center.lng)<be)&&(te=ye)}for(;Math.abs(te.lng-q.center.lng)>180;){const re=q.locationPoint(te);if(re.x>=0&&re.y>=0&&re.x<=q.width&&re.y<=q.height)break;te.lng>q.center.lng?te.lng-=360:te.lng+=360}return te}const ua={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ol extends j.Evented{constructor($,q){if(super(),($ instanceof j.window.HTMLElement||q)&&($=j.extend({element:$},q)),j.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=$&&$.anchor||"center",this._color=$&&$.color||"#3FB1CE",this._scale=$&&$.scale||1,this._draggable=$&&$.draggable||!1,this._clickTolerance=$&&$.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=$&&$.rotation||0,this._rotationAlignment=$&&$.rotationAlignment||"auto",this._pitchAlignment=$&&$.pitchAlignment&&$.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),$&&$.element)this._element=$.element,this._offset=j.pointGeometry.convert($&&$.offset||[0,0]);else{this._defaultMarker=!0,this._element=Be("div");const ye=41,be=27,Se=$e("svg",{display:"block",height:ye*this._scale+"px",width:be*this._scale+"px",viewBox:`0 0 ${be} ${ye}`},this._element),Ie=$e("radialGradient",{id:"shadowGradient"},$e("defs",{},Se));$e("stop",{offset:"10%","stop-opacity":.4},Ie),$e("stop",{offset:"100%","stop-opacity":.05},Ie),$e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},Se),$e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},Se),$e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},Se),$e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},Se),this._offset=j.pointGeometry.convert($&&$.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ye=>{ye.preventDefault()}),this._element.addEventListener("mousedown",ye=>{ye.preventDefault()});const re=this._element.classList;for(const ye in ua)re.remove(`mapboxgl-marker-anchor-${ye}`);re.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo($){return $===this._map||(this.remove(),this._map=$,$.getCanvasContainer().appendChild(this._element),$.on("move",this._updateMoving),$.on("moveend",this._update),$.on("remove",this._clearFadeTimer),$._addMarker(this),this.setDraggable(this._draggable),this._update(),$.on("click",this._onMapClick)),this}remove(){const $=this._map;return $&&($.off("click",this._onMapClick),$.off("move",this._updateMoving),$.off("moveend",this._update),$.off("mousedown",this._addDragHandler),$.off("touchstart",this._addDragHandler),$.off("mouseup",this._onUp),$.off("touchend",this._onUp),$.off("mousemove",this._onMove),$.off("touchmove",this._onMove),$.off("remove",this._clearFadeTimer),$._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat($){return this._lngLat=j.LngLat.convert($),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup($){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),$){if(!("offset"in $.options)){const ye=Math.sqrt(Math.pow(13.5,2)/2);$.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ye,-1*(38.1-13.5+ye)],"bottom-right":[-ye,-1*(38.1-13.5+ye)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=$,$._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress($){const q=$.code,re=$.charCode||$.keyCode;q!=="Space"&&q!=="Enter"&&re!==32&&re!==13||this.togglePopup()}_onMapClick($){const q=$.originalEvent.target,re=this._element;this._popup&&(q===re||re.contains(q))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const $=this._popup;return $?($.isOpen()?($.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&($.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const $=this._map;if(!$)return!1;const q=$.unproject(this._pos),re=$.getFreeCameraOptions();if(!re.position)return!1;const ye=re.position.toLngLat();return ye.distanceTo(q)<.9*ye.distanceTo(this._lngLat)}_evaluateOpacity(){const $=this._map;if(!$)return;const q=this._pos;if(!q||q.x<0||q.x>$.transform.width||q.y<0||q.y>$.transform.height)return void this._clearFadeTimer();const re=$.unproject(q);let ye;$._showingGlobe()&&j.isLngLatBehindGlobe($.transform,this._lngLat)?ye=0:(ye=1-$._queryFogOpacity(re),$.transform._terrainEnabled()&&$.getTerrain()&&this._behindTerrain()&&(ye*=.2)),this._element.style.opacity=`${ye}`,this._element.style.pointerEvents=ye>0?"auto":"none",this._popup&&this._popup._setOpacity(ye),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const $=this._pos;if(!$||!this._map)return;const q=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${$.x}px,${$.y}px)
            ${ua[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${q.x}px,${q.y}px)
        `}_calculateXYTransform(){const $=this._pos,q=this._map,re=this.getPitchAlignment();if(!q||!$||re!=="map")return"";if(!q._showingGlobe()){const Re=q.getPitch();return Re?`rotateX(${Re}deg)`:""}const ye=j.radToDeg(j.globeTiltAtLngLat(q.transform,this._lngLat)),be=$.sub(j.globeCenterToScreenPoint(q.transform)),Se=Math.abs(be.x)+Math.abs(be.y);if(Se===0)return"";const Ie=ye/Se;return`rotateX(${-be.y*Ie}deg) rotateY(${be.x*Ie}deg)`}_calculateZTransform(){const $=this._pos,q=this._map;if(!q||!$)return"";let re=0;const ye=this.getRotationAlignment();if(ye==="map")if(q._showingGlobe()){const be=q.project(new j.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),Se=q.project(new j.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(be);re=j.radToDeg(Math.atan2(Se.y,Se.x))-90}else re=-q.getBearing();else if(ye==="horizon"){const be=j.smoothstep(4,6,q.getZoom()),Se=j.globeCenterToScreenPoint(q.transform);Se.y+=be*q.transform.height;const Ie=$.sub(Se),Re=j.radToDeg(Math.atan2(Ie.y,Ie.x));re=(Re>90?Re-270:Re+90)*(1-be)}return re+=this._rotation,re?`rotateZ(${re}deg)`:""}_update($){j.window.cancelAnimationFrame(this._updateFrameId);const q=this._map;q&&(q.transform.renderWorldCopies&&(this._lngLat=xc(this._lngLat,this._pos,q.transform)),this._pos=q.project(this._lngLat),$===!0?this._updateFrameId=j.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),q._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(q._showingGlobe()||q.getTerrain()||q.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset($){return this._offset=j.pointGeometry.convert($),this._update(),this}_onMove($){const q=this._map;if(q){if(!this._isDragging){const re=this._clickTolerance||q._clickTolerance;this._isDragging=$.point.dist(this._pointerdownPos)>=re}this._isDragging&&(this._pos=$.point.sub(this._positionDelta),this._lngLat=q.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new j.Event("dragstart"))),this.fire(new j.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const $=this._map;$&&($.off("mousemove",this._onMove),$.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new j.Event("dragend")),this._state="inactive"}_addDragHandler($){const q=this._map;q&&this._element.contains($.originalEvent.target)&&($.preventDefault(),this._positionDelta=$.point.sub(this._pos),this._pointerdownPos=$.point,this._state="pending",q.on("mousemove",this._onMove),q.on("touchmove",this._onMove),q.once("mouseup",this._onUp),q.once("touchend",this._onUp))}setDraggable($){this._draggable=!!$;const q=this._map;return q&&($?(q.on("mousedown",this._addDragHandler),q.on("touchstart",this._addDragHandler)):(q.off("mousedown",this._addDragHandler),q.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation($){return this._rotation=$||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment($){return this._rotationAlignment=$||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment($){return this._pitchAlignment=$||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Uu{constructor($){this.jumpTo($)}getValue($){if($<=this._startTime)return this._start;if($>=this._endTime)return this._end;const q=j.easeCubicInOut(($-this._startTime)/(this._endTime-this._startTime));return this._start*(1-q)+this._end*q}isEasing($){return $>=this._startTime&&$<=this._endTime}jumpTo($){this._startTime=-1/0,this._endTime=-1/0,this._start=$,this._end=$}easeTo($,q,re){this._start=this.getValue(q),this._end=$,this._startTime=q,this._endTime=q+re}}const $u={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Nu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ha(te){te.parentNode&&te.parentNode.removeChild(te)}const ju={showCompass:!0,showZoom:!0,visualizePitch:!1};class bc{constructor($,q,re=!1){this._clickTolerance=10,this.element=q,this.mouseRotate=new pc({clickTolerance:$.dragRotate._mouseRotate._clickTolerance}),this.map=$,re&&(this.mousePitch=new di({clickTolerance:$.dragRotate._mousePitch._clickTolerance})),j.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),q.addEventListener("mousedown",this.mousedown),q.addEventListener("touchstart",this.touchstart,{passive:!1}),q.addEventListener("touchmove",this.touchmove),q.addEventListener("touchend",this.touchend),q.addEventListener("touchcancel",this.reset)}down($,q){this.mouseRotate.mousedown($,q),this.mousePitch&&this.mousePitch.mousedown($,q),It()}move($,q){const re=this.map,ye=this.mouseRotate.mousemoveWindow($,q),be=ye&&ye.bearingDelta;if(be&&re.setBearing(re.getBearing()+be),this.mousePitch){const Se=this.mousePitch.mousemoveWindow($,q),Ie=Se&&Se.pitchDelta;Ie&&re.setPitch(re.getPitch()+Ie)}}off(){const $=this.element;$.removeEventListener("mousedown",this.mousedown),$.removeEventListener("touchstart",this.touchstart,{passive:!1}),$.removeEventListener("touchmove",this.touchmove),$.removeEventListener("touchend",this.touchend),$.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ct(),j.window.removeEventListener("mousemove",this.mousemove),j.window.removeEventListener("mouseup",this.mouseup)}mousedown($){this.down(j.extend({},$,{ctrlKey:!0,preventDefault:()=>$.preventDefault()}),Mt(this.element,$)),j.window.addEventListener("mousemove",this.mousemove),j.window.addEventListener("mouseup",this.mouseup)}mousemove($){this.move($,Mt(this.element,$))}mouseup($){this.mouseRotate.mouseupWindow($),this.mousePitch&&this.mousePitch.mouseupWindow($),this.offTemp()}touchstart($){$.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pt(this.element,$.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>$.preventDefault()},this._startPos))}touchmove($){$.targetTouches.length!==1?this.reset():(this._lastPos=Pt(this.element,$.targetTouches)[0],this.move({preventDefault:()=>$.preventDefault()},this._lastPos))}touchend($){$.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Vu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},wc={maxWidth:100,unit:"metric"};function Tc(te,$,q){const re=sl($),ye=re/$,be={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[q];this._map._requestDomTask(()=>{this._container.style.width=te*ye+"px",this._container.innerHTML=`${re}&nbsp;${be}`})}function sl(te){const $=Math.pow(10,`${Math.floor(te)}`.length-1);let q=te/$;return q=q>=10?10:q>=5?5:q>=3?3:q>=2?2:q>=1?1:function(re){const ye=Math.pow(10,Math.ceil(-Math.log(re)/Math.LN10));return Math.round(re*ye)/ye}(q),$*q}const Wh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function al(te=new j.pointGeometry(0,0),$="bottom"){if(typeof te=="number"){const q=Math.round(Math.sqrt(.5*Math.pow(te,2)));switch($){case"top":return new j.pointGeometry(0,te);case"top-left":return new j.pointGeometry(q,q);case"top-right":return new j.pointGeometry(-q,q);case"bottom":return new j.pointGeometry(0,-te);case"bottom-left":return new j.pointGeometry(q,-q);case"bottom-right":return new j.pointGeometry(-q,-q);case"left":return new j.pointGeometry(te,0);case"right":return new j.pointGeometry(-te,0)}return new j.pointGeometry(0,0)}return te instanceof j.pointGeometry||Array.isArray(te)?j.pointGeometry.convert(te):j.pointGeometry.convert(te[$]||[0,0])}const da={version:j.version,supported:Pe,setRTLTextPlugin:j.setRTLTextPlugin,getRTLTextPluginStatus:j.getRTLTextPluginStatus,Map:class extends Fu{constructor(te){if((te=j.extend({},Nu,te)).minZoom!=null&&te.maxZoom!=null&&te.minZoom>te.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(te.minPitch!=null&&te.maxPitch!=null&&te.minPitch>te.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(te.minPitch!=null&&te.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(te.maxPitch!=null&&te.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(te.antialias&&j.isSafariWithAntialiasingBug(j.window)&&(te.antialias=!1,j.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ia(te.minZoom,te.maxZoom,te.minPitch,te.maxPitch,te.renderWorldCopies),te),this._interactive=te.interactive,this._minTileCacheSize=te.minTileCacheSize,this._maxTileCacheSize=te.maxTileCacheSize,this._failIfMajorPerformanceCaveat=te.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=te.preserveDrawingBuffer,this._antialias=te.antialias,this._trackResize=te.trackResize,this._bearingSnap=te.bearingSnap,this._refreshExpiredTiles=te.refreshExpiredTiles,this._fadeDuration=te.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=te.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=te.collectResourceTiming,this._optimizeForTerrain=te.optimizeForTerrain,this._language=te.language==="auto"?j.window.navigator.language:te.language,this._worldview=te.worldview,this._renderTaskQueue=new vc,this._domRenderTaskQueue=new vc,this._controls=[],this._markers=[],this._mapId=j.uniqueId(),this._locale=j.extend({},$u,te.locale),this._clickTolerance=te.clickTolerance,this._cooperativeGestures=te.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Uu(0),this._useExplicitProjection=!1,this._requestManager=new j.RequestManager(te.transformRequest,te.accessToken,te.testMode),this._silenceAuthErrors=!!te.testMode,typeof te.container=="string"){if(this._container=j.window.document.getElementById(te.container),!this._container)throw new Error(`Container '${te.container}' not found.`)}else{if(!(te.container instanceof j.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=te.container}if(this._container.childNodes.length>0&&j.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),te.maxBounds&&this.setMaxBounds(te.maxBounds),j.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),j.window!==void 0&&(j.window.addEventListener("online",this._onWindowOnline,!1),j.window.addEventListener("resize",this._onWindowResize,!1),j.window.addEventListener("orientationchange",this._onWindowResize,!1),j.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ou(this,te),this._localFontFamily=te.localFontFamily,this._localIdeographFontFamily=te.localIdeographFontFamily,te.style&&this.setStyle(te.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),te.projection&&this.setProjection(te.projection),this._hash=te.hash&&new vu(typeof te.hash=="string"&&te.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:te.center,zoom:te.zoom,bearing:te.bearing,pitch:te.pitch}),te.bounds&&(this.resize(),this.fitBounds(te.bounds,j.extend({},te.fitBoundsOptions,{duration:0})))),this.resize(),te.attributionControl&&this.addControl(new gc({customAttribution:te.customAttribution})),this._logoControl=new yc,this.addControl(this._logoControl,te.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",$=>{this._update($.dataType==="style"),this.fire(new j.Event(`${$.dataType}data`,$))}),this.on("dataloading",$=>{this.fire(new j.Event(`${$.dataType}dataloading`,$))})}_getMapId(){return this._mapId}addControl(te,$){if($===void 0&&($=te.getDefaultPosition?te.getDefaultPosition():"top-right"),!te||!te.onAdd)return this.fire(new j.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const q=te.onAdd(this);this._controls.push(te);const re=this._controlPositions[$];return $.indexOf("bottom")!==-1?re.insertBefore(q,re.firstChild):re.appendChild(q),this}removeControl(te){if(!te||!te.onRemove)return this.fire(new j.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const $=this._controls.indexOf(te);return $>-1&&this._controls.splice($,1),te.onRemove(this),this}hasControl(te){return this._controls.indexOf(te)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(te){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const $=!this._moving;return $&&this.fire(new j.Event("movestart",te)).fire(new j.Event("move",te)),this.fire(new j.Event("resize",te)),$&&this.fire(new j.Event("moveend",te)),this}getBounds(){return this.transform.projection.name==="globe"&&j.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(te){return this.transform.setMaxBounds(j.LngLatBounds.convert(te)),this._update()}setMinZoom(te){if((te=te==null?-2:te)>=-2&&te<=this.transform.maxZoom)return this.transform.minZoom=te,this._update(),this.getZoom()<te?this.setZoom(te):this.fire(new j.Event("zoomstart")).fire(new j.Event("zoom")).fire(new j.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(te){if((te=te==null?22:te)>=this.transform.minZoom)return this.transform.maxZoom=te,this._update(),this.getZoom()>te?this.setZoom(te):this.fire(new j.Event("zoomstart")).fire(new j.Event("zoom")).fire(new j.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(te){if((te=te==null?0:te)<0)throw new Error("minPitch must be greater than or equal to 0");if(te>=0&&te<=this.transform.maxPitch)return this.transform.minPitch=te,this._update(),this.getPitch()<te?this.setPitch(te):this.fire(new j.Event("pitchstart")).fire(new j.Event("pitch")).fire(new j.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(te){if((te=te==null?85:te)>85)throw new Error("maxPitch must be less than or equal to 85");if(te>=this.transform.minPitch)return this.transform.maxPitch=te,this._update(),this.getPitch()>te?this.setPitch(te):this.fire(new j.Event("pitchstart")).fire(new j.Event("pitch")).fire(new j.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(te){return this.transform.renderWorldCopies=te,this._update()}getLanguage(){return this._language}setLanguage(te){if(this._language=te==="auto"?j.window.navigator.language:te,this.style)for(const $ in this.style._sourceCaches){const q=this.style._sourceCaches[$]._source;q._setLanguage&&q._setLanguage(this._language)}for(const $ of this._controls)$._setLanguage&&$._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(te){if(this._worldview=te,this.style)for(const $ in this.style._sourceCaches){const q=this.style._sourceCaches[$]._source;q._setWorldview&&q._setWorldview(te)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(te){return this._lazyInitEmptyStyle(),te?typeof te=="string"&&(te={name:te}):te=null,this._useExplicitProjection=!!te,this._prioritizeAndUpdateProjection(te,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const te=this.transform,$=te.projection.name;let q;$==="globe"&&te.zoom>=j.GLOBE_ZOOM_THRESHOLD_MAX?(te.setMercatorFromTransition(),q=!0):$==="mercator"&&te.zoom<j.GLOBE_ZOOM_THRESHOLD_MAX&&(te.setProjection({name:"globe"}),q=!0),q&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(te,$){return this._updateProjection(te||$||{name:"mercator"})}_updateProjection(te){let $;if($=te.name==="globe"&&this.transform.zoom>=j.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(te),this.style.applyProjectionUpdate(),$){this.painter.clearBackgroundTiles();for(const q in this.style._sourceCaches)this.style._sourceCaches[q].clearTiles();this._update(!0)}return this}project(te){return this.transform.locationPoint3D(j.LngLat.convert(te))}unproject(te){return this.transform.pointLocation3D(j.pointGeometry.convert(te))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(te,$,q){if(te==="mouseenter"||te==="mouseover"){let re=!1;const ye=Se=>{const Ie=$.filter(Fe=>this.getLayer(Fe)),Re=Ie.length?this.queryRenderedFeatures(Se.point,{layers:Ie}):[];Re.length?re||(re=!0,q.call(this,new vi(te,this,Se.originalEvent,{features:Re}))):re=!1},be=()=>{re=!1};return{layers:new Set($),listener:q,delegates:{mousemove:ye,mouseout:be}}}if(te==="mouseleave"||te==="mouseout"){let re=!1;const ye=Se=>{const Ie=$.filter(Re=>this.getLayer(Re));(Ie.length?this.queryRenderedFeatures(Se.point,{layers:Ie}):[]).length?re=!0:re&&(re=!1,q.call(this,new vi(te,this,Se.originalEvent)))},be=Se=>{re&&(re=!1,q.call(this,new vi(te,this,Se.originalEvent)))};return{layers:new Set($),listener:q,delegates:{mousemove:ye,mouseout:be}}}{const re=ye=>{const be=$.filter(Ie=>this.getLayer(Ie)),Se=be.length?this.queryRenderedFeatures(ye.point,{layers:be}):[];Se.length&&(ye.features=Se,q.call(this,ye),delete ye.features)};return{layers:new Set($),listener:q,delegates:{[te]:re}}}}on(te,$,q){if(q===void 0)return super.on(te,$);Array.isArray($)||($=[$]);const re=this._createDelegatedListener(te,$,q);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[te]=this._delegatedListeners[te]||[],this._delegatedListeners[te].push(re);for(const ye in re.delegates)this.on(ye,re.delegates[ye]);return this}once(te,$,q){if(q===void 0)return super.once(te,$);Array.isArray($)||($=[$]);const re=this._createDelegatedListener(te,$,q);for(const ye in re.delegates)this.once(ye,re.delegates[ye]);return this}off(te,$,q){if(q===void 0)return super.off(te,$);$=new Set(Array.isArray($)?$:[$]);const re=(be,Se)=>{if(be.size!==Se.size)return!1;for(const Ie of be)if(!Se.has(Ie))return!1;return!0},ye=this._delegatedListeners?this._delegatedListeners[te]:void 0;return ye&&(be=>{for(let Se=0;Se<be.length;Se++){const Ie=be[Se];if(Ie.listener===q&&re(Ie.layers,$)){for(const Re in Ie.delegates)this.off(Re,Ie.delegates[Re]);return be.splice(Se,1),this}}})(ye),this}queryRenderedFeatures(te,$){return this.style?($!==void 0||te===void 0||te instanceof j.pointGeometry||Array.isArray(te)||($=te,te=void 0),this.style.queryRenderedFeatures(te=te||[[0,0],[this.transform.width,this.transform.height]],$=$||{},this.transform)):[]}querySourceFeatures(te,$){return this.style.querySourceFeatures(te,$)}queryTerrainElevation(te,$){const q=this.transform.elevation;return q?($=j.extend({},{exaggerated:!0},$),q.getAtPoint(j.MercatorCoordinate.fromLngLat(te),null,$.exaggerated)):null}setStyle(te,$){return($=j.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},$)).diff!==!1&&$.localIdeographFontFamily===this._localIdeographFontFamily&&$.localFontFamily===this._localFontFamily&&this.style&&te?(this._diffStyle(te,$),this):(this._localIdeographFontFamily=$.localIdeographFontFamily,this._localFontFamily=$.localFontFamily,this._updateStyle(te,$))}_getUIString(te){const $=this._locale[te];if($==null)throw new Error(`Missing UI string '${te}'`);return $}_updateStyle(te,$){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),te&&(this.style=new Vi(this,$||{}),this.style.setEventedParent(this,{style:this.style}),typeof te=="string"?this.style.loadURL(te):this.style.loadJSON(te)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(te,$){if(typeof te=="string"){const q=this._requestManager.normalizeStyleURL(te),re=this._requestManager.transformRequest(q,j.ResourceType.Style);j.getJSON(re,(ye,be)=>{ye?this.fire(new j.ErrorEvent(ye)):be&&this._updateDiff(be,$)})}else typeof te=="object"&&this._updateDiff(te,$)}_updateDiff(te,$){try{this.style.setState(te)&&this._update(!0)}catch(q){j.warnOnce(`Unable to perform style diff: ${q.message||q.error||q}.  Rebuilding the style from scratch.`),this._updateStyle(te,$)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(j.warnOnce("There is no style added to the map."),!1)}addSource(te,$){return this._lazyInitEmptyStyle(),this.style.addSource(te,$),this._update(!0)}isSourceLoaded(te){return!!this.style&&this.style._isSourceCacheLoaded(te)}areTilesLoaded(){const te=this.style&&this.style._sourceCaches;for(const $ in te){const q=te[$]._tiles;for(const re in q){const ye=q[re];if(ye.state!=="loaded"&&ye.state!=="errored")return!1}}return!0}addSourceType(te,$,q){this._lazyInitEmptyStyle(),this.style.addSourceType(te,$,q)}removeSource(te){return this.style.removeSource(te),this._updateTerrain(),this._update(!0)}getSource(te){return this.style.getSource(te)}addImage(te,$,{pixelRatio:q=1,sdf:re=!1,stretchX:ye,stretchY:be,content:Se}={}){if(this._lazyInitEmptyStyle(),$ instanceof j.window.HTMLImageElement||j.window.ImageBitmap&&$ instanceof j.window.ImageBitmap){const{width:Ie,height:Re,data:Fe}=j.exported.getImageData($);this.style.addImage(te,{data:new j.RGBAImage({width:Ie,height:Re},Fe),pixelRatio:q,stretchX:ye,stretchY:be,content:Se,sdf:re,version:0})}else if($.width===void 0||$.height===void 0)this.fire(new j.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:Ie,height:Re}=$,Fe=$;this.style.addImage(te,{data:new j.RGBAImage({width:Ie,height:Re},new Uint8Array(Fe.data)),pixelRatio:q,stretchX:ye,stretchY:be,content:Se,sdf:re,version:0,userImage:Fe}),Fe.onAdd&&Fe.onAdd(this,te)}}updateImage(te,$){const q=this.style.getImage(te);if(!q)return void this.fire(new j.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const re=$ instanceof j.window.HTMLImageElement||j.window.ImageBitmap&&$ instanceof j.window.ImageBitmap?j.exported.getImageData($):$,{width:ye,height:be}=re;ye!==void 0&&be!==void 0?ye===q.data.width&&be===q.data.height?(q.data.replace(re.data,!($ instanceof j.window.HTMLImageElement||j.window.ImageBitmap&&$ instanceof j.window.ImageBitmap)),this.style.updateImage(te,q)):this.fire(new j.ErrorEvent(new Error(`The width and height of the updated image (${ye}, ${be})
                must be that same as the previous version of the image
                (${q.data.width}, ${q.data.height})`))):this.fire(new j.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(te){return te?!!this.style.getImage(te):(this.fire(new j.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(te){this.style.removeImage(te)}loadImage(te,$){j.getImage(this._requestManager.transformRequest(te,j.ResourceType.Image),(q,re)=>{$(q,re instanceof j.window.HTMLImageElement?j.exported.getImageData(re):re)})}listImages(){return this.style.listImages()}addLayer(te,$){return this._lazyInitEmptyStyle(),this.style.addLayer(te,$),this._update(!0)}moveLayer(te,$){return this.style.moveLayer(te,$),this._update(!0)}removeLayer(te){return this.style.removeLayer(te),this._update(!0)}getLayer(te){return this.style.getLayer(te)}setLayerZoomRange(te,$,q){return this.style.setLayerZoomRange(te,$,q),this._update(!0)}setFilter(te,$,q={}){return this.style.setFilter(te,$,q),this._update(!0)}getFilter(te){return this.style.getFilter(te)}setPaintProperty(te,$,q,re={}){return this.style.setPaintProperty(te,$,q,re),this._update(!0)}getPaintProperty(te,$){return this.style.getPaintProperty(te,$)}setLayoutProperty(te,$,q,re={}){return this.style.setLayoutProperty(te,$,q,re),this._update(!0)}getLayoutProperty(te,$){return this.style.getLayoutProperty(te,$)}setLight(te,$={}){return this._lazyInitEmptyStyle(),this.style.setLight(te,$),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(te){return this._lazyInitEmptyStyle(),!te&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(te),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(te){return this._lazyInitEmptyStyle(),this.style.setFog(te),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(te){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(j.LngLat.convert(te),this.transform):0}setFeatureState(te,$){return this.style.setFeatureState(te,$),this._update()}removeFeatureState(te,$){return this.style.removeFeatureState(te,$),this._update()}getFeatureState(te){return this.style.getFeatureState(te)}_updateContainerDimensions(){if(!this._container)return;const te=this._container.getBoundingClientRect().width||400,$=this._container.getBoundingClientRect().height||300;let q,re,ye,be=this._container;for(;be&&(!re||!ye);){const Se=j.window.getComputedStyle(be).transform;Se&&Se!=="none"&&(q=Se.match(/matrix.*\((.+)\)/)[1].split(", "),q[0]&&q[0]!=="0"&&q[0]!=="1"&&(re=q[0]),q[3]&&q[3]!=="0"&&q[3]!=="1"&&(ye=q[3])),be=be.parentElement}this._containerWidth=re?Math.abs(te/re):te,this._containerHeight=ye?Math.abs($/ye):$}_detectMissingCSS(){j.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&j.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const te=this._container;te.classList.add("mapboxgl-map"),(this._missingCSSCanary=Be("div","mapboxgl-canary",te)).style.visibility="hidden",this._detectMissingCSS();const $=this._canvasContainer=Be("div","mapboxgl-canvas-container",te);this._interactive&&$.classList.add("mapboxgl-interactive"),this._canvas=Be("canvas","mapboxgl-canvas",$),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const q=this._controlContainer=Be("div","mapboxgl-control-container",te),re=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(ye=>{re[ye]=Be("div",`mapboxgl-ctrl-${ye}`,q)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(te,$){const q=j.exported.devicePixelRatio||1;this._canvas.width=q*Math.ceil(te),this._canvas.height=q*Math.ceil($),this._canvas.style.width=`${te}px`,this._canvas.style.height=`${$}px`}_addMarker(te){this._markers.push(te)}_removeMarker(te){const $=this._markers.indexOf(te);$!==-1&&this._markers.splice($,1)}_setupPainter(){const te=j.extend({},Pe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),$=this._canvas.getContext("webgl",te)||this._canvas.getContext("experimental-webgl",te);$?(j.storeAuthState($,!0),this.painter=new sc($,this.transform),this.on("data",q=>{q.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),j.exported$1.testSupport($)):this.fire(new j.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(te){te.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new j.Event("webglcontextlost",{originalEvent:te}))}_contextRestored(te){this._setupPainter(),this.resize(),this._update(),this.fire(new j.Event("webglcontextrestored",{originalEvent:te}))}_onMapScroll(te){if(te.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(te){return this.style?(this._styleDirty=this._styleDirty||te,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(te){return this._update(),this._renderTaskQueue.add(te)}_cancelRenderFrame(te){this._renderTaskQueue.remove(te)}_requestDomTask(te){!this.loaded()||this.loaded()&&!this.isMoving()?te():this._domRenderTaskQueue.add(te)}_render(te){let $;const q=this.painter.context.extTimerQuery,re=j.exported.now();if(this.listens("gpu-timing-frame")&&($=q.createQueryEXT(),q.beginQueryEXT(q.TIME_ELAPSED_EXT,$)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(te),this._domRenderTaskQueue.run(te),this._removed)return;this._updateProjectionTransition();let ye=!1;const be=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Re=this.transform.zoom,Fe=this.transform.pitch,Ue=j.exported.now();this.style.zoomHistory.update(Re,Ue);const Ze=new j.EvaluationParameters(Re,{now:Ue,fadeDuration:be,pitch:Fe,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ye=Ze.crossFadingFactor();Ye===1&&Ye===this._crossFadingFactor||(ye=!0,this._crossFadingFactor=Ye),this.style.update(Ze)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let Se=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),Se=this._updateAverageElevation(re),this.style._updateSources(this.transform),this._forceMarkerUpdate()):Se=this._updateAverageElevation(re),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,be,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:be,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new j.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new j.Event("load"))),this.style&&(this.style.hasTransitions()||ye)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),$){const Re=j.exported.now()-re;q.endQueryEXT(q.TIME_ELAPSED_EXT,$),setTimeout(()=>{const Fe=q.getQueryObjectEXT($,q.QUERY_RESULT_EXT)/1e6;q.deleteQueryEXT($),this.fire(new j.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:Fe})),j.window.performance.mark("frame-gpu",{startTime:re,detail:{gpuTime:Fe}})},50)}if(this.listens("gpu-timing-layer")){const Re=this.painter.collectGpuTimers();setTimeout(()=>{const Fe=this.painter.queryGpuTimers(Re);this.fire(new j.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}if(this.listens("gpu-timing-deferred-render")){const Re=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Fe=this.painter.queryGpuTimeDeferredRender(Re);this.fire(new j.Event("gpu-timing-deferred-render",{gpuTime:Fe}))},50)}const Ie=this._sourcesDirty||this._styleDirty||this._placementDirty||Se;if(Ie||this._repaint)this.triggerRepaint();else{const Re=!this.isMoving()&&this.loaded();if(Re&&(Se=this._updateAverageElevation(re,!0)),Se)this.triggerRepaint();else if(this._triggerFrame(!1),Re&&(this.fire(new j.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Fe=this._calculateSpeedIndex();this.fire(new j.Event("speedindexcompleted",{speedIndex:Fe})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||Ie||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const te of this._markers)te._update()}_updateAverageElevation(te,$=!1){const q=re=>(this.transform.averageElevation=re,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&q(0);if(($||te-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(te)){const re=this.transform.averageElevation;let ye=this.transform.sampleAverageElevation(),be=!1;this.transform.elevation&&(be=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ye)?ye=0:this._averageElevationLastSampledAt=te;const Se=Math.abs(re-ye);if(Se>1){if(this._isInitialLoad||be)return this._averageElevation.jumpTo(ye),q(ye);this._averageElevation.easeTo(ye,te,300)}else if(Se>1e-4)return this._averageElevation.jumpTo(ye),q(ye)}return!!this._averageElevation.isEasing(te)&&q(this._averageElevation.getValue(te))}_authenticate(){j.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,te=>{if(te&&(te.message===j.AUTH_ERR_MSG||te.status===401)){const $=this.painter.context.gl;j.storeAuthState($,!1),this._logoControl instanceof yc&&this._logoControl._updateLogo(),$&&$.clear($.DEPTH_BUFFER_BIT|$.COLOR_BUFFER_BIT|$.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new j.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),j.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const te=this.painter.canvasCopy(),$=this.painter.getCanvasCopiesAndTimestamps();$.timeStamps.push(performance.now());const q=this.painter.context.gl,re=q.createFramebuffer();function ye(be){q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,be,0);const Se=new Uint8Array(q.drawingBufferWidth*q.drawingBufferHeight*4);return q.readPixels(0,0,q.drawingBufferWidth,q.drawingBufferHeight,q.RGBA,q.UNSIGNED_BYTE,Se),Se}return q.bindFramebuffer(q.FRAMEBUFFER,re),this._canvasPixelComparison(ye(te),$.canvasCopies.map(ye),$.timeStamps)}_canvasPixelComparison(te,$,q){let re=q[1]-q[0];const ye=te.length/4;for(let be=0;be<$.length;be++){const Se=$[be];let Ie=0;for(let Re=0;Re<Se.length;Re+=4)Se[Re]===te[Re]&&Se[Re+1]===te[Re+1]&&Se[Re+2]===te[Re+2]&&Se[Re+3]===te[Re+3]&&(Ie+=1);re+=(q[be+2]-q[be+1])*(1-Ie/ye)}return re}remove(){this._hash&&this._hash.remove();for(const $ of this._controls)$.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),j.window!==void 0&&(j.window.removeEventListener("resize",this._onWindowResize,!1),j.window.removeEventListener("orientationchange",this._onWindowResize,!1),j.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),j.window.removeEventListener("online",this._onWindowOnline,!1));const te=this.painter.context.gl.getExtension("WEBGL_lose_context");te&&te.loseContext(),ha(this._canvasContainer),ha(this._controlContainer),ha(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),j.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new j.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(te){this._renderNextFrame=this._renderNextFrame||te,this.style&&!this._frame&&(this._frame=j.exported.frame($=>{const q=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,q&&this._render($)}))}_preloadTiles(te){const $=this.style?Object.values(this.style._sourceCaches):[];return j.asyncAll($,(q,re)=>q._preloadTiles(te,re),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(te){this._trackResize&&this.resize({originalEvent:te})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(te){this._showTileBoundaries!==te&&(this._showTileBoundaries=te,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(te){this._showTerrainWireframe!==te&&(this._showTerrainWireframe=te,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(te){this._speedIndexTiming!==te&&(this._speedIndexTiming=te,this._update())}get showPadding(){return!!this._showPadding}set showPadding(te){this._showPadding!==te&&(this._showPadding=te,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(te){this._showCollisionBoxes!==te&&(this._showCollisionBoxes=te,te?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(te){this._showOverdrawInspector!==te&&(this._showOverdrawInspector=te,this._update())}get repaint(){return!!this._repaint}set repaint(te){this._repaint!==te&&(this._repaint=te,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(te){this._vertices=te,this._update()}_setCacheLimits(te,$){j.setCacheLimits(te,$)}get version(){return j.version}},NavigationControl:class{constructor(te){this.options=j.extend({},ju,te),this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",$=>$.preventDefault()),this.options.showZoom&&(j.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",$=>{this._map&&this._map.zoomIn({},{originalEvent:$})}),Be("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",$=>{this._map&&this._map.zoomOut({},{originalEvent:$})}),Be("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(j.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",$=>{const q=this._map;q&&(this.options.visualizePitch?q.resetNorthPitch({},{originalEvent:$}):q.resetNorth({},{originalEvent:$}))}),this._compassIcon=Be("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const te=this._map;if(!te)return;const $=te.getZoom(),q=$===te.getMaxZoom(),re=$===te.getMinZoom();this._zoomInButton.disabled=q,this._zoomOutButton.disabled=re,this._zoomInButton.setAttribute("aria-disabled",q.toString()),this._zoomOutButton.setAttribute("aria-disabled",re.toString())}_rotateCompassArrow(){const te=this._map;if(!te)return;const $=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(te.transform.pitch*(Math.PI/180)),.5)}) rotateX(${te.transform.pitch}deg) rotateZ(${te.transform.angle*(180/Math.PI)}deg)`:`rotate(${te.transform.angle*(180/Math.PI)}deg)`;te._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=$)})}onAdd(te){return this._map=te,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),te.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&te.on("pitch",this._rotateCompassArrow),te.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bc(te,this._compass,this.options.visualizePitch)),this._container}onRemove(){const te=this._map;te&&(this._container.remove(),this.options.showZoom&&te.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&te.off("pitch",this._rotateCompassArrow),te.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(te,$){const q=Be("button",te,this._container);return q.type="button",q.addEventListener("click",$),q}_setButtonTitle(te,$){if(!this._map)return;const q=this._map._getUIString(`NavigationControl.${$}`);te.setAttribute("aria-label",q),te.firstElementChild&&te.firstElementChild.setAttribute("title",q)}},GeolocateControl:class extends j.Evented{constructor(te){super(),this.options=j.extend({geolocation:j.window.navigator.geolocation},Vu,te),j.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(te){return this._map=te,this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(te){this._supportsGeolocation!==void 0?te(this._supportsGeolocation):j.window.navigator.permissions!==void 0?j.window.navigator.permissions.query({name:"geolocation"}).then($=>{this._supportsGeolocation=$.state!=="denied",te(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,te(this._supportsGeolocation))}_isOutOfMapMaxBounds(te){const $=this._map.getMaxBounds(),q=te.coords;return!!$&&(q.longitude<$.getWest()||q.longitude>$.getEast()||q.latitude<$.getSouth()||q.latitude>$.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(te){if(this._map){if(this._isOutOfMapMaxBounds(te))return this._setErrorState(),this.fire(new j.Event("outofmaxbounds",te)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=te,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(te),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(te),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new j.Event("geolocate",te)),this._finish()}}_updateCamera(te){const $=new j.LngLat(te.coords.longitude,te.coords.latitude),q=te.coords.accuracy,re=this._map.getBearing(),ye=j.extend({bearing:re},this.options.fitBoundsOptions);this._map.fitBounds($.toBounds(q),ye,{geolocateSource:!0})}_updateMarker(te){if(te){const $=new j.LngLat(te.coords.longitude,te.coords.latitude);this._accuracyCircleMarker.setLngLat($).addTo(this._map),this._userLocationDotMarker.setLngLat($).addTo(this._map),this._accuracy=te.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const te=this._map.transform,$=j.mercatorZfromAltitude(1,te._center.lat)*te.worldSize,q=Math.ceil(2*this._accuracy*$);this._circleElement.style.width=`${q}px`,this._circleElement.style.height=`${q}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(te){if(this._map){if(this.options.trackUserLocation)if(te.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const $=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",$),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",$),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(te.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new j.Event("error",te)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(te){if(this._container.addEventListener("contextmenu",$=>$.preventDefault()),this._geolocateButton=Be("button","mapboxgl-ctrl-geolocate",this._container),Be("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",te===!1){j.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const $=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",$),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",$)}else{const $=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",$),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",$)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Be("div","mapboxgl-user-location"),this._dotElement.appendChild(Be("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Be("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ol({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Be("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",$=>{$.geolocateSource||this._watchState!=="ACTIVE_LOCK"||$.originalEvent&&$.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new j.Event("trackuserlocationend")))})}_onDeviceOrientation(te){this._userLocationDotMarker&&(te.webkitCompassHeading?this._heading=te.webkitCompassHeading:te.absolute===!0&&(this._heading=-1*te.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return j.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new j.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new j.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new j.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let te;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(te={maximumAge:6e5,timeout:0},this._noTimeout=!0):(te=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,te),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const te=()=>{j.window.addEventListener("ondeviceorientationabsolute"in j.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};j.window.DeviceMotionEvent!==void 0&&typeof j.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then($=>{$==="granted"&&te()}).catch(console.error):te()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),j.window.removeEventListener("deviceorientation",this._onDeviceOrientation),j.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:gc,ScaleControl:class{constructor(te){this.options=j.extend({},wc,te),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Tc.bind(this)),j.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const te=this.options.maxWidth||100,$=this._map,q=$._containerHeight/2,re=$._containerWidth/2-te/2,ye=$.unproject([re,q]),be=$.unproject([re+te,q]),Se=ye.distanceTo(be);if(this.options.unit==="imperial"){const Ie=3.2808*Se;Ie>5280?this._setScale(te,Ie/5280,"mile"):this._setScale(te,Ie,"foot")}else this.options.unit==="nautical"?this._setScale(te,Se/1852,"nautical-mile"):Se>=1e3?this._setScale(te,Se/1e3,"kilometer"):this._setScale(te,Se,"meter")}_setScale(te,$,q){const re=sl($),ye=re/$;this._map._requestDomTask(()=>{this._container.style.width=te*ye+"px",this._container.innerHTML=q!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:q}).format(re):`${re}&nbsp;nm`})}onAdd(te){return this._map=te,this._language=te.getLanguage(),this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-scale",te.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(te){this._language=te,this._update()}setUnit(te){this.options.unit=te,this._update()}},FullscreenControl:class{constructor(te){this._fullscreen=!1,te&&te.container&&(te.container instanceof j.window.HTMLElement?this._container=te.container:j.warnOnce("Full screen control 'container' must be a DOM element.")),j.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in j.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in j.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(te){return this._map=te,this._container||(this._container=this._map.getContainer()),this._controlContainer=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",j.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,j.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!j.window.document.fullscreenEnabled&&!j.window.document.webkitFullscreenEnabled)}_setupUI(){const te=this._fullscreenButton=Be("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Be("span","mapboxgl-ctrl-icon",te).setAttribute("aria-hidden","true"),te.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),j.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const te=this._getTitle();this._fullscreenButton.setAttribute("aria-label",te),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",te)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(j.window.document.fullscreenElement||j.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?j.window.document.exitFullscreen?j.window.document.exitFullscreen():j.window.document.webkitCancelFullScreen&&j.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends j.Evented{constructor(te){super(),this.options=j.extend(Object.create(Wh),te),j.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(te&&te.className?te.className.trim().split(/\s+/):[])}addTo(te){return this._map&&this.remove(),this._map=te,this.options.closeOnClick&&te.on("preclick",this._onClose),this.options.closeOnMove&&te.on("move",this._onClose),te.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(te.on("mousemove",this._onMouseEvent),te.on("mouseup",this._onMouseEvent),te._canvasContainer.classList.add("mapboxgl-track-pointer")):te.on("move",this._update),this.fire(new j.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const te=this._map;return te&&(te.off("move",this._update),te.off("move",this._onClose),te.off("preclick",this._onClose),te.off("click",this._onClose),te.off("remove",this.remove),te.off("mousemove",this._onMouseEvent),te.off("mouseup",this._onMouseEvent),te.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new j.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(te){this._lngLat=j.LngLat.convert(te),this._pos=null,this._trackPointer=!1,this._update();const $=this._map;return $&&($.on("move",this._update),$.off("mousemove",this._onMouseEvent),$._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const te=this._map;return te&&(te.off("move",this._update),te.on("mousemove",this._onMouseEvent),te.on("drag",this._onMouseEvent),te._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(te){return this.setDOMContent(j.window.document.createTextNode(te))}setHTML(te){const $=j.window.document.createDocumentFragment(),q=j.window.document.createElement("body");let re;for(q.innerHTML=te;re=q.firstChild,re;)$.appendChild(re);return this.setDOMContent($)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(te){return this.options.maxWidth=te,this._update(),this}setDOMContent(te){let $=this._content;if($)for(;$.hasChildNodes();)$.firstChild&&$.removeChild($.firstChild);else $=this._content=Be("div","mapboxgl-popup-content",this._container||void 0);if($.appendChild(te),this.options.closeButton){const q=this._closeButton=Be("button","mapboxgl-popup-close-button",$);q.type="button",q.setAttribute("aria-label","Close popup"),q.setAttribute("aria-hidden","true"),q.innerHTML="&#215;",q.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(te){return this._classList.add(te),this._updateClassList(),this}removeClassName(te){return this._classList.delete(te),this._updateClassList(),this}setOffset(te){return this.options.offset=te,this._update(),this}toggleClassName(te){let $;return this._classList.delete(te)?$=!1:(this._classList.add(te),$=!0),this._updateClassList(),$}_onMouseEvent(te){this._update(te.point)}_getAnchor(te){if(this.options.anchor)return this.options.anchor;const $=this._map,q=this._container,re=this._pos;if(!$||!q||!re)return"bottom";const ye=q.offsetWidth,be=q.offsetHeight,Se=re.x<ye/2,Ie=re.x>$.transform.width-ye/2;if(re.y+te<be)return Se?"top-left":Ie?"top-right":"top";if(re.y>$.transform.height-be){if(Se)return"bottom-left";if(Ie)return"bottom-right"}return Se?"left":Ie?"right":"bottom"}_updateClassList(){const te=this._container;if(!te)return;const $=[...this._classList];$.push("mapboxgl-popup"),this._anchor&&$.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&$.push("mapboxgl-popup-track-pointer"),te.className=$.join(" ")}_update(te){const $=this._map,q=this._content;if(!$||!this._lngLat&&!this._trackPointer||!q)return;let re=this._container;if(re||(re=this._container=Be("div","mapboxgl-popup",$.getContainer()),this._tip=Be("div","mapboxgl-popup-tip",re),re.appendChild(q)),this.options.maxWidth&&re.style.maxWidth!==this.options.maxWidth&&(re.style.maxWidth=this.options.maxWidth),$.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xc(this._lngLat,this._pos,$.transform)),!this._trackPointer||te){const ye=this._pos=this._trackPointer&&te?te:$.project(this._lngLat),be=al(this.options.offset),Se=this._anchor=this._getAnchor(be.y),Ie=al(this.options.offset,Se),Re=ye.add(Ie).round();$._requestDomTask(()=>{this._container&&Se&&(this._container.style.transform=`${ua[Se]} translate(${Re.x}px,${Re.y}px)`)})}if(!this._marker&&$._showingGlobe()){const ye=j.isLngLatBehindGlobe($.transform,this._lngLat)?0:1;this._setOpacity(ye)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const te=this._container.querySelector(Xh);te&&te.focus()}_onClose(){this.remove()}_setOpacity(te){this._container&&(this._container.style.opacity=`${te}`),this._content&&(this._content.style.pointerEvents=te?"auto":"none")}},Marker:ol,Style:Vi,LngLat:j.LngLat,LngLatBounds:j.LngLatBounds,Point:j.pointGeometry,MercatorCoordinate:j.MercatorCoordinate,FreeCameraOptions:In,Evented:j.Evented,config:j.config,prewarm:function(){kr().acquire(On)},clearPrewarmedResources:function(){const te=lr;te&&(te.isPreloaded()&&te.numActive()===1?(te.release(On),lr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return j.config.ACCESS_TOKEN},set accessToken(te){j.config.ACCESS_TOKEN=te},get baseApiUrl(){return j.config.API_URL},set baseApiUrl(te){j.config.API_URL=te},get workerCount(){return Zn.workerCount},set workerCount(te){Zn.workerCount=te},get maxParallelImageRequests(){return j.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(te){j.config.MAX_PARALLEL_IMAGE_REQUESTS=te},clearStorage(te){j.clearTileCache(te)},workerUrl:"",workerClass:null,setNow:j.exported.setNow,restoreNow:j.exported.restoreNow};return da});var Te=de;return Te})})(mapboxGl);var mapbox=mapboxGl.exports;function render(V,ee){return openBlock(),createBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[createVNode("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])}var axios$2={exports:{}},bind$2=function(ee,ce){return function(){for(var de=new Array(arguments.length),xe=0;xe<de.length;xe++)de[xe]=arguments[xe];return ee.apply(ce,de)}},bind$1=bind$2,toString=Object.prototype.toString;function isArray(V){return Array.isArray(V)}function isUndefined(V){return typeof V=="undefined"}function isBuffer(V){return V!==null&&!isUndefined(V)&&V.constructor!==null&&!isUndefined(V.constructor)&&typeof V.constructor.isBuffer=="function"&&V.constructor.isBuffer(V)}function isArrayBuffer(V){return toString.call(V)==="[object ArrayBuffer]"}function isFormData(V){return toString.call(V)==="[object FormData]"}function isArrayBufferView(V){var ee;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ee=ArrayBuffer.isView(V):ee=V&&V.buffer&&isArrayBuffer(V.buffer),ee}function isString(V){return typeof V=="string"}function isNumber(V){return typeof V=="number"}function isObject(V){return V!==null&&typeof V=="object"}function isPlainObject(V){if(toString.call(V)!=="[object Object]")return!1;var ee=Object.getPrototypeOf(V);return ee===null||ee===Object.prototype}function isDate(V){return toString.call(V)==="[object Date]"}function isFile(V){return toString.call(V)==="[object File]"}function isBlob(V){return toString.call(V)==="[object Blob]"}function isFunction$1(V){return toString.call(V)==="[object Function]"}function isStream(V){return isObject(V)&&isFunction$1(V.pipe)}function isURLSearchParams(V){return toString.call(V)==="[object URLSearchParams]"}function trim(V){return V.trim?V.trim():V.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function forEach(V,ee){if(!(V===null||typeof V=="undefined"))if(typeof V!="object"&&(V=[V]),isArray(V))for(var ce=0,_e=V.length;ce<_e;ce++)ee.call(null,V[ce],ce,V);else for(var de in V)Object.prototype.hasOwnProperty.call(V,de)&&ee.call(null,V[de],de,V)}function merge(){var V={};function ee(de,xe){isPlainObject(V[xe])&&isPlainObject(de)?V[xe]=merge(V[xe],de):isPlainObject(de)?V[xe]=merge({},de):isArray(de)?V[xe]=de.slice():V[xe]=de}for(var ce=0,_e=arguments.length;ce<_e;ce++)forEach(arguments[ce],ee);return V}function extend(V,ee,ce){return forEach(ee,function(de,xe){ce&&typeof de=="function"?V[xe]=bind$1(de,ce):V[xe]=de}),V}function stripBOM(V){return V.charCodeAt(0)===65279&&(V=V.slice(1)),V}var utils$e={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isObject,isPlainObject,isUndefined,isDate,isFile,isBlob,isFunction:isFunction$1,isStream,isURLSearchParams,isStandardBrowserEnv,forEach,merge,extend,trim,stripBOM},utils$d=utils$e;function encode(V){return encodeURIComponent(V).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$2=function(ee,ce,_e){if(!ce)return ee;var de;if(_e)de=_e(ce);else if(utils$d.isURLSearchParams(ce))de=ce.toString();else{var xe=[];utils$d.forEach(ce,function(Ce,Pe){Ce===null||typeof Ce=="undefined"||(utils$d.isArray(Ce)?Pe=Pe+"[]":Ce=[Ce],utils$d.forEach(Ce,function(ze){utils$d.isDate(ze)?ze=ze.toISOString():utils$d.isObject(ze)&&(ze=JSON.stringify(ze)),xe.push(encode(Pe)+"="+encode(ze))}))}),de=xe.join("&")}if(de){var Te=ee.indexOf("#");Te!==-1&&(ee=ee.slice(0,Te)),ee+=(ee.indexOf("?")===-1?"?":"&")+de}return ee},utils$c=utils$e;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function(ee,ce,_e){return this.handlers.push({fulfilled:ee,rejected:ce,synchronous:_e?_e.synchronous:!1,runWhen:_e?_e.runWhen:null}),this.handlers.length-1};InterceptorManager$1.prototype.eject=function(ee){this.handlers[ee]&&(this.handlers[ee]=null)};InterceptorManager$1.prototype.forEach=function(ee){utils$c.forEach(this.handlers,function(_e){_e!==null&&ee(_e)})};var InterceptorManager_1=InterceptorManager$1,utils$b=utils$e,normalizeHeaderName$1=function(ee,ce){utils$b.forEach(ee,function(de,xe){xe!==ce&&xe.toUpperCase()===ce.toUpperCase()&&(ee[ce]=de,delete ee[xe])})},enhanceError$2=function(ee,ce,_e,de,xe){return ee.config=ce,_e&&(ee.code=_e),ee.request=de,ee.response=xe,ee.isAxiosError=!0,ee.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},ee},transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},enhanceError$1=enhanceError$2,createError$2=function(ee,ce,_e,de,xe){var Te=new Error(ee);return enhanceError$1(Te,ce,_e,de,xe)},createError$1=createError$2,settle$1=function(ee,ce,_e){var de=_e.config.validateStatus;!_e.status||!de||de(_e.status)?ee(_e):ce(createError$1("Request failed with status code "+_e.status,_e.config,null,_e.request,_e))},utils$a=utils$e,cookies$1=utils$a.isStandardBrowserEnv()?function(){return{write:function(ce,_e,de,xe,Te,j){var Ce=[];Ce.push(ce+"="+encodeURIComponent(_e)),utils$a.isNumber(de)&&Ce.push("expires="+new Date(de).toGMTString()),utils$a.isString(xe)&&Ce.push("path="+xe),utils$a.isString(Te)&&Ce.push("domain="+Te),j===!0&&Ce.push("secure"),document.cookie=Ce.join("; ")},read:function(ce){var _e=document.cookie.match(new RegExp("(^|;\\s*)("+ce+")=([^;]*)"));return _e?decodeURIComponent(_e[3]):null},remove:function(ce){this.write(ce,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),isAbsoluteURL$1=function(ee){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(ee)},combineURLs$1=function(ee,ce){return ce?ee.replace(/\/+$/,"")+"/"+ce.replace(/^\/+/,""):ee},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$1=function(ee,ce){return ee&&!isAbsoluteURL(ce)?combineURLs(ee,ce):ce},utils$9=utils$e,ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders$1=function(ee){var ce={},_e,de,xe;return ee&&utils$9.forEach(ee.split(`
`),function(j){if(xe=j.indexOf(":"),_e=utils$9.trim(j.substr(0,xe)).toLowerCase(),de=utils$9.trim(j.substr(xe+1)),_e){if(ce[_e]&&ignoreDuplicateOf.indexOf(_e)>=0)return;_e==="set-cookie"?ce[_e]=(ce[_e]?ce[_e]:[]).concat([de]):ce[_e]=ce[_e]?ce[_e]+", "+de:de}}),ce},utils$8=utils$e,isURLSameOrigin$1=utils$8.isStandardBrowserEnv()?function(){var ee=/(msie|trident)/i.test(navigator.userAgent),ce=document.createElement("a"),_e;function de(xe){var Te=xe;return ee&&(ce.setAttribute("href",Te),Te=ce.href),ce.setAttribute("href",Te),{href:ce.href,protocol:ce.protocol?ce.protocol.replace(/:$/,""):"",host:ce.host,search:ce.search?ce.search.replace(/^\?/,""):"",hash:ce.hash?ce.hash.replace(/^#/,""):"",hostname:ce.hostname,port:ce.port,pathname:ce.pathname.charAt(0)==="/"?ce.pathname:"/"+ce.pathname}}return _e=de(window.location.href),function(Te){var j=utils$8.isString(Te)?de(Te):Te;return j.protocol===_e.protocol&&j.host===_e.host}}():function(){return function(){return!0}}();function Cancel$3(V){this.message=V}Cancel$3.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};Cancel$3.prototype.__CANCEL__=!0;var Cancel_1=Cancel$3,utils$7=utils$e,settle=settle$1,cookies=cookies$1,buildURL$1=buildURL$2,buildFullPath=buildFullPath$1,parseHeaders=parseHeaders$1,isURLSameOrigin=isURLSameOrigin$1,createError=createError$2,transitionalDefaults$1=transitional,Cancel$2=Cancel_1,xhr=function(ee){return new Promise(function(_e,de){var xe=ee.data,Te=ee.headers,j=ee.responseType,Ce;function Pe(){ee.cancelToken&&ee.cancelToken.unsubscribe(Ce),ee.signal&&ee.signal.removeEventListener("abort",Ce)}utils$7.isFormData(xe)&&delete Te["Content-Type"];var Le=new XMLHttpRequest;if(ee.auth){var ze=ee.auth.username||"",Be=ee.auth.password?unescape(encodeURIComponent(ee.auth.password)):"";Te.Authorization="Basic "+btoa(ze+":"+Be)}var $e=buildFullPath(ee.baseURL,ee.url);Le.open(ee.method.toUpperCase(),buildURL$1($e,ee.params,ee.paramsSerializer),!0),Le.timeout=ee.timeout;function Ve(){if(!!Le){var Xe="getAllResponseHeaders"in Le?parseHeaders(Le.getAllResponseHeaders()):null,It=!j||j==="text"||j==="json"?Le.responseText:Le.response,Ct={data:It,status:Le.status,statusText:Le.statusText,headers:Xe,config:ee,request:Le};settle(function(Ot){_e(Ot),Pe()},function(Ot){de(Ot),Pe()},Ct),Le=null}}if("onloadend"in Le?Le.onloadend=Ve:Le.onreadystatechange=function(){!Le||Le.readyState!==4||Le.status===0&&!(Le.responseURL&&Le.responseURL.indexOf("file:")===0)||setTimeout(Ve)},Le.onabort=function(){!Le||(de(createError("Request aborted",ee,"ECONNABORTED",Le)),Le=null)},Le.onerror=function(){de(createError("Network Error",ee,null,Le)),Le=null},Le.ontimeout=function(){var It=ee.timeout?"timeout of "+ee.timeout+"ms exceeded":"timeout exceeded",Ct=ee.transitional||transitionalDefaults$1;ee.timeoutErrorMessage&&(It=ee.timeoutErrorMessage),de(createError(It,ee,Ct.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",Le)),Le=null},utils$7.isStandardBrowserEnv()){var Ke=(ee.withCredentials||isURLSameOrigin($e))&&ee.xsrfCookieName?cookies.read(ee.xsrfCookieName):void 0;Ke&&(Te[ee.xsrfHeaderName]=Ke)}"setRequestHeader"in Le&&utils$7.forEach(Te,function(It,Ct){typeof xe=="undefined"&&Ct.toLowerCase()==="content-type"?delete Te[Ct]:Le.setRequestHeader(Ct,It)}),utils$7.isUndefined(ee.withCredentials)||(Le.withCredentials=!!ee.withCredentials),j&&j!=="json"&&(Le.responseType=ee.responseType),typeof ee.onDownloadProgress=="function"&&Le.addEventListener("progress",ee.onDownloadProgress),typeof ee.onUploadProgress=="function"&&Le.upload&&Le.upload.addEventListener("progress",ee.onUploadProgress),(ee.cancelToken||ee.signal)&&(Ce=function(Xe){!Le||(de(!Xe||Xe&&Xe.type?new Cancel$2("canceled"):Xe),Le.abort(),Le=null)},ee.cancelToken&&ee.cancelToken.subscribe(Ce),ee.signal&&(ee.signal.aborted?Ce():ee.signal.addEventListener("abort",Ce))),xe||(xe=null),Le.send(xe)})},utils$6=utils$e,normalizeHeaderName=normalizeHeaderName$1,enhanceError=enhanceError$2,transitionalDefaults=transitional,DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(V,ee){!utils$6.isUndefined(V)&&utils$6.isUndefined(V["Content-Type"])&&(V["Content-Type"]=ee)}function getDefaultAdapter(){var V;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(V=xhr),V}function stringifySafely(V,ee,ce){if(utils$6.isString(V))try{return(ee||JSON.parse)(V),utils$6.trim(V)}catch(_e){if(_e.name!=="SyntaxError")throw _e}return(ce||JSON.stringify)(V)}var defaults$3={transitional:transitionalDefaults,adapter:getDefaultAdapter(),transformRequest:[function(ee,ce){return normalizeHeaderName(ce,"Accept"),normalizeHeaderName(ce,"Content-Type"),utils$6.isFormData(ee)||utils$6.isArrayBuffer(ee)||utils$6.isBuffer(ee)||utils$6.isStream(ee)||utils$6.isFile(ee)||utils$6.isBlob(ee)?ee:utils$6.isArrayBufferView(ee)?ee.buffer:utils$6.isURLSearchParams(ee)?(setContentTypeIfUnset(ce,"application/x-www-form-urlencoded;charset=utf-8"),ee.toString()):utils$6.isObject(ee)||ce&&ce["Content-Type"]==="application/json"?(setContentTypeIfUnset(ce,"application/json"),stringifySafely(ee)):ee}],transformResponse:[function(ee){var ce=this.transitional||defaults$3.transitional,_e=ce&&ce.silentJSONParsing,de=ce&&ce.forcedJSONParsing,xe=!_e&&this.responseType==="json";if(xe||de&&utils$6.isString(ee)&&ee.length)try{return JSON.parse(ee)}catch(Te){if(xe)throw Te.name==="SyntaxError"?enhanceError(Te,this,"E_JSON_PARSE"):Te}return ee}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(ee){return ee>=200&&ee<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$6.forEach(["delete","get","head"],function(ee){defaults$3.headers[ee]={}});utils$6.forEach(["post","put","patch"],function(ee){defaults$3.headers[ee]=utils$6.merge(DEFAULT_CONTENT_TYPE)});var defaults_1=defaults$3,utils$5=utils$e,defaults$2=defaults_1,transformData$1=function(ee,ce,_e){var de=this||defaults$2;return utils$5.forEach(_e,function(Te){ee=Te.call(de,ee,ce)}),ee},isCancel$1=function(ee){return!!(ee&&ee.__CANCEL__)},utils$4=utils$e,transformData=transformData$1,isCancel=isCancel$1,defaults$1=defaults_1,Cancel$1=Cancel_1;function throwIfCancellationRequested(V){if(V.cancelToken&&V.cancelToken.throwIfRequested(),V.signal&&V.signal.aborted)throw new Cancel$1("canceled")}var dispatchRequest$1=function(ee){throwIfCancellationRequested(ee),ee.headers=ee.headers||{},ee.data=transformData.call(ee,ee.data,ee.headers,ee.transformRequest),ee.headers=utils$4.merge(ee.headers.common||{},ee.headers[ee.method]||{},ee.headers),utils$4.forEach(["delete","get","head","post","put","patch","common"],function(de){delete ee.headers[de]});var ce=ee.adapter||defaults$1.adapter;return ce(ee).then(function(de){return throwIfCancellationRequested(ee),de.data=transformData.call(ee,de.data,de.headers,ee.transformResponse),de},function(de){return isCancel(de)||(throwIfCancellationRequested(ee),de&&de.response&&(de.response.data=transformData.call(ee,de.response.data,de.response.headers,ee.transformResponse))),Promise.reject(de)})},utils$3=utils$e,mergeConfig$2=function(ee,ce){ce=ce||{};var _e={};function de(Le,ze){return utils$3.isPlainObject(Le)&&utils$3.isPlainObject(ze)?utils$3.merge(Le,ze):utils$3.isPlainObject(ze)?utils$3.merge({},ze):utils$3.isArray(ze)?ze.slice():ze}function xe(Le){if(utils$3.isUndefined(ce[Le])){if(!utils$3.isUndefined(ee[Le]))return de(void 0,ee[Le])}else return de(ee[Le],ce[Le])}function Te(Le){if(!utils$3.isUndefined(ce[Le]))return de(void 0,ce[Le])}function j(Le){if(utils$3.isUndefined(ce[Le])){if(!utils$3.isUndefined(ee[Le]))return de(void 0,ee[Le])}else return de(void 0,ce[Le])}function Ce(Le){if(Le in ce)return de(ee[Le],ce[Le]);if(Le in ee)return de(void 0,ee[Le])}var Pe={url:Te,method:Te,data:Te,baseURL:j,transformRequest:j,transformResponse:j,paramsSerializer:j,timeout:j,timeoutMessage:j,withCredentials:j,adapter:j,responseType:j,xsrfCookieName:j,xsrfHeaderName:j,onUploadProgress:j,onDownloadProgress:j,decompress:j,maxContentLength:j,maxBodyLength:j,transport:j,httpAgent:j,httpsAgent:j,cancelToken:j,socketPath:j,responseEncoding:j,validateStatus:Ce};return utils$3.forEach(Object.keys(ee).concat(Object.keys(ce)),function(ze){var Be=Pe[ze]||xe,$e=Be(ze);utils$3.isUndefined($e)&&Be!==Ce||(_e[ze]=$e)}),_e},data={version:"0.26.1"},VERSION=data.version,validators$1={};["object","boolean","number","function","string","symbol"].forEach(function(V,ee){validators$1[V]=function(_e){return typeof _e===V||"a"+(ee<1?"n ":" ")+V}});var deprecatedWarnings={};validators$1.transitional=function(ee,ce,_e){function de(xe,Te){return"[Axios v"+VERSION+"] Transitional option '"+xe+"'"+Te+(_e?". "+_e:"")}return function(xe,Te,j){if(ee===!1)throw new Error(de(Te," has been removed"+(ce?" in "+ce:"")));return ce&&!deprecatedWarnings[Te]&&(deprecatedWarnings[Te]=!0,console.warn(de(Te," has been deprecated since v"+ce+" and will be removed in the near future"))),ee?ee(xe,Te,j):!0}};function assertOptions(V,ee,ce){if(typeof V!="object")throw new TypeError("options must be an object");for(var _e=Object.keys(V),de=_e.length;de-- >0;){var xe=_e[de],Te=ee[xe];if(Te){var j=V[xe],Ce=j===void 0||Te(j,xe,V);if(Ce!==!0)throw new TypeError("option "+xe+" must be "+Ce);continue}if(ce!==!0)throw Error("Unknown option "+xe)}}var validator$1={assertOptions,validators:validators$1},utils$2=utils$e,buildURL=buildURL$2,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$1=mergeConfig$2,validator=validator$1,validators=validator.validators;function Axios$1(V){this.defaults=V,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function(ee,ce){typeof ee=="string"?(ce=ce||{},ce.url=ee):ce=ee||{},ce=mergeConfig$1(this.defaults,ce),ce.method?ce.method=ce.method.toLowerCase():this.defaults.method?ce.method=this.defaults.method.toLowerCase():ce.method="get";var _e=ce.transitional;_e!==void 0&&validator.assertOptions(_e,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1);var de=[],xe=!0;this.interceptors.request.forEach(function($e){typeof $e.runWhen=="function"&&$e.runWhen(ce)===!1||(xe=xe&&$e.synchronous,de.unshift($e.fulfilled,$e.rejected))});var Te=[];this.interceptors.response.forEach(function($e){Te.push($e.fulfilled,$e.rejected)});var j;if(!xe){var Ce=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(Ce,de),Ce=Ce.concat(Te),j=Promise.resolve(ce);Ce.length;)j=j.then(Ce.shift(),Ce.shift());return j}for(var Pe=ce;de.length;){var Le=de.shift(),ze=de.shift();try{Pe=Le(Pe)}catch(Be){ze(Be);break}}try{j=dispatchRequest(Pe)}catch(Be){return Promise.reject(Be)}for(;Te.length;)j=j.then(Te.shift(),Te.shift());return j};Axios$1.prototype.getUri=function(ee){return ee=mergeConfig$1(this.defaults,ee),buildURL(ee.url,ee.params,ee.paramsSerializer).replace(/^\?/,"")};utils$2.forEach(["delete","get","head","options"],function(ee){Axios$1.prototype[ee]=function(ce,_e){return this.request(mergeConfig$1(_e||{},{method:ee,url:ce,data:(_e||{}).data}))}});utils$2.forEach(["post","put","patch"],function(ee){Axios$1.prototype[ee]=function(ce,_e,de){return this.request(mergeConfig$1(de||{},{method:ee,url:ce,data:_e}))}});var Axios_1=Axios$1,Cancel=Cancel_1;function CancelToken(V){if(typeof V!="function")throw new TypeError("executor must be a function.");var ee;this.promise=new Promise(function(de){ee=de});var ce=this;this.promise.then(function(_e){if(!!ce._listeners){var de,xe=ce._listeners.length;for(de=0;de<xe;de++)ce._listeners[de](_e);ce._listeners=null}}),this.promise.then=function(_e){var de,xe=new Promise(function(Te){ce.subscribe(Te),de=Te}).then(_e);return xe.cancel=function(){ce.unsubscribe(de)},xe},V(function(de){ce.reason||(ce.reason=new Cancel(de),ee(ce.reason))})}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};CancelToken.prototype.subscribe=function(ee){if(this.reason){ee(this.reason);return}this._listeners?this._listeners.push(ee):this._listeners=[ee]};CancelToken.prototype.unsubscribe=function(ee){if(!!this._listeners){var ce=this._listeners.indexOf(ee);ce!==-1&&this._listeners.splice(ce,1)}};CancelToken.source=function(){var ee,ce=new CancelToken(function(de){ee=de});return{token:ce,cancel:ee}};var CancelToken_1=CancelToken,spread=function(ee){return function(_e){return ee.apply(null,_e)}},utils$1=utils$e,isAxiosError=function(ee){return utils$1.isObject(ee)&&ee.isAxiosError===!0},utils=utils$e,bind=bind$2,Axios=Axios_1,mergeConfig=mergeConfig$2,defaults=defaults_1;function createInstance(V){var ee=new Axios(V),ce=bind(Axios.prototype.request,ee);return utils.extend(ce,Axios.prototype,ee),utils.extend(ce,ee),ce.create=function(de){return createInstance(mergeConfig(V,de))},ce}var axios$1=createInstance(defaults);axios$1.Axios=Axios;axios$1.Cancel=Cancel_1;axios$1.CancelToken=CancelToken_1;axios$1.isCancel=isCancel$1;axios$1.VERSION=data.version;axios$1.all=function(ee){return Promise.all(ee)};axios$1.spread=spread;axios$1.isAxiosError=isAxiosError;axios$2.exports=axios$1;axios$2.exports.default=axios$1;var axios=axios$2.exports;function unwrapObj(V){let ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Object.keys(V).reduce((ce,_e)=>(ee.includes(_e)||(ce[_e]=unref(V[_e])),ce),{})}function isFunction(V){return typeof V=="function"}function isProxy(V){return isReactive(V)||isReadonly(V)}function callRule(V,ee,ce,_e){return V.call(_e,unref(ee),unref(ce),_e)}function normalizeValidatorResponse(V){return V.$valid!==void 0?!V.$valid:!V}function createAsyncResult(V,ee,ce,_e,de,xe,Te){let{$lazy:j,$rewardEarly:Ce}=de,Pe=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[],Le=arguments.length>8?arguments[8]:void 0,ze=arguments.length>9?arguments[9]:void 0,Be=arguments.length>10?arguments[10]:void 0;const $e=ref(!!_e.value),Ve=ref(0);ce.value=!1;const Ke=watch([ee,_e].concat(Pe,Be),()=>{if(j&&!_e.value||Ce&&!ze.value&&!ce.value)return;let Xe;try{Xe=callRule(V,ee,Le,Te)}catch(It){Xe=Promise.reject(It)}Ve.value++,ce.value=!!Ve.value,$e.value=!1,Promise.resolve(Xe).then(It=>{Ve.value--,ce.value=!!Ve.value,xe.value=It,$e.value=normalizeValidatorResponse(It)}).catch(It=>{Ve.value--,ce.value=!!Ve.value,xe.value=It,$e.value=!0})},{immediate:!0,deep:typeof ee=="object"});return{$invalid:$e,$unwatch:Ke}}function createSyncResult(V,ee,ce,_e,de,xe,Te,j){let{$lazy:Ce,$rewardEarly:Pe}=_e;const Le=()=>({}),ze=computed(()=>{if(Ce&&!ce.value||Pe&&!j.value)return!1;let Be=!0;try{const $e=callRule(V,ee,Te,xe);de.value=$e,Be=normalizeValidatorResponse($e)}catch($e){de.value=$e}return Be});return{$unwatch:Le,$invalid:ze}}function createValidatorResult(V,ee,ce,_e,de,xe,Te,j,Ce,Pe,Le){const ze=ref(!1),Be=V.$params||{},$e=ref(null);let Ve,Ke;V.$async?{$invalid:Ve,$unwatch:Ke}=createAsyncResult(V.$validator,ee,ze,ce,_e,$e,de,V.$watchTargets,Ce,Pe,Le):{$invalid:Ve,$unwatch:Ke}=createSyncResult(V.$validator,ee,ce,_e,$e,de,Ce,Pe);const Xe=V.$message;return{$message:isFunction(Xe)?computed(()=>Xe(unwrapObj({$pending:ze,$invalid:Ve,$params:unwrapObj(Be),$model:ee,$response:$e,$validator:xe,$propertyPath:j,$property:Te}))):Xe||"",$params:Be,$pending:ze,$invalid:Ve,$response:$e,$unwatch:Ke}}function sortValidations(){let V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const ee=unref(V),ce=Object.keys(ee),_e={},de={},xe={};return ce.forEach(Te=>{const j=ee[Te];switch(!0){case isFunction(j.$validator):_e[Te]=j;break;case isFunction(j):_e[Te]={$validator:j};break;case Te.startsWith("$"):xe[Te]=j;break;default:de[Te]=j}}),{rules:_e,nestedValidators:de,config:xe}}function _empty(){}const ROOT_PATH="__root";function _call(V,ee,ce){if(ce)return ee?ee(V()):V();try{var _e=Promise.resolve(V());return ee?_e.then(ee):_e}catch(de){return Promise.reject(de)}}function _callIgnored(V,ee){return _call(V,_empty,ee)}function _invoke(V,ee){var ce=V();return ce&&ce.then?ce.then(ee):ee(ce)}function _async(V){return function(){for(var ee=[],ce=0;ce<arguments.length;ce++)ee[ce]=arguments[ce];try{return Promise.resolve(V.apply(this,ee))}catch(_e){return Promise.reject(_e)}}}function createValidationResults(V,ee,ce,_e,de,xe,Te,j,Ce){const Pe=Object.keys(V),Le=_e.get(de,V),ze=ref(!1),Be=ref(!1),$e=ref(0);if(Le){if(!Le.$partial)return Le;Le.$unwatch(),ze.value=Le.$dirty.value}const Ve={$dirty:ze,$path:de,$touch:()=>{ze.value||(ze.value=!0)},$reset:()=>{ze.value&&(ze.value=!1)},$commit:()=>{}};return Pe.length?(Pe.forEach(Ke=>{Ve[Ke]=createValidatorResult(V[Ke],ee,Ve.$dirty,xe,Te,Ke,ce,de,Ce,Be,$e)}),Ve.$externalResults=computed(()=>j.value?[].concat(j.value).map((Ke,Xe)=>({$propertyPath:de,$property:ce,$validator:"$externalResults",$uid:`${de}-externalResult-${Xe}`,$message:Ke,$params:{},$response:null,$pending:!1})):[]),Ve.$invalid=computed(()=>{const Ke=Pe.some(Xe=>unref(Ve[Xe].$invalid));return Be.value=Ke,!!Ve.$externalResults.value.length||Ke}),Ve.$pending=computed(()=>Pe.some(Ke=>unref(Ve[Ke].$pending))),Ve.$error=computed(()=>Ve.$dirty.value?Ve.$pending.value||Ve.$invalid.value:!1),Ve.$silentErrors=computed(()=>Pe.filter(Ke=>unref(Ve[Ke].$invalid)).map(Ke=>{const Xe=Ve[Ke];return reactive({$propertyPath:de,$property:ce,$validator:Ke,$uid:`${de}-${Ke}`,$message:Xe.$message,$params:Xe.$params,$response:Xe.$response,$pending:Xe.$pending})}).concat(Ve.$externalResults.value)),Ve.$errors=computed(()=>Ve.$dirty.value?Ve.$silentErrors.value:[]),Ve.$unwatch=()=>Pe.forEach(Ke=>{Ve[Ke].$unwatch()}),Ve.$commit=()=>{Be.value=!0,$e.value=Date.now()},_e.set(de,V,Ve),Ve):(Le&&_e.set(de,V,Ve),Ve)}function collectNestedValidationResults(V,ee,ce,_e,de,xe,Te){const j=Object.keys(V);return j.length?j.reduce((Ce,Pe)=>(Ce[Pe]=setValidations({validations:V[Pe],state:ee,key:Pe,parentKey:ce,resultsCache:_e,globalConfig:de,instance:xe,externalResults:Te}),Ce),{}):{}}function createMetaFields(V,ee,ce){const _e=computed(()=>[ee,ce].filter(Ve=>Ve).reduce((Ve,Ke)=>Ve.concat(Object.values(unref(Ke))),[])),de=computed({get(){return V.$dirty.value||(_e.value.length?_e.value.every(Ve=>Ve.$dirty):!1)},set(Ve){V.$dirty.value=Ve}}),xe=computed(()=>{const Ve=unref(V.$silentErrors)||[],Ke=_e.value.filter(Xe=>(unref(Xe).$silentErrors||[]).length).reduce((Xe,It)=>Xe.concat(...It.$silentErrors),[]);return Ve.concat(Ke)}),Te=computed(()=>{const Ve=unref(V.$errors)||[],Ke=_e.value.filter(Xe=>(unref(Xe).$errors||[]).length).reduce((Xe,It)=>Xe.concat(...It.$errors),[]);return Ve.concat(Ke)}),j=computed(()=>_e.value.some(Ve=>Ve.$invalid)||unref(V.$invalid)||!1),Ce=computed(()=>_e.value.some(Ve=>unref(Ve.$pending))||unref(V.$pending)||!1),Pe=computed(()=>_e.value.some(Ve=>Ve.$dirty)||_e.value.some(Ve=>Ve.$anyDirty)||de.value),Le=computed(()=>de.value?Ce.value||j.value:!1),ze=()=>{V.$touch(),_e.value.forEach(Ve=>{Ve.$touch()})},Be=()=>{V.$commit(),_e.value.forEach(Ve=>{Ve.$commit()})},$e=()=>{V.$reset(),_e.value.forEach(Ve=>{Ve.$reset()})};return _e.value.length&&_e.value.every(Ve=>Ve.$dirty)&&ze(),{$dirty:de,$errors:Te,$invalid:j,$anyDirty:Pe,$error:Le,$pending:Ce,$touch:ze,$reset:$e,$silentErrors:xe,$commit:Be}}function setValidations(V){const ee=_async(function(){return on(),_invoke(function(){if(Ke.$rewardEarly)return _n(),_callIgnored(nextTick)},function(){return _call(nextTick,function(){return new Promise(mn=>{if(!Ut.value)return mn(!At.value);const Xn=watch(Ut,()=>{mn(!At.value),Xn()})})})})});let{validations:ce,state:_e,key:de,parentKey:xe,childResults:Te,resultsCache:j,globalConfig:Ce={},instance:Pe,externalResults:Le}=V;const ze=xe?`${xe}.${de}`:de,{rules:Be,nestedValidators:$e,config:Ve}=sortValidations(ce),Ke=Object.assign({},Ce,Ve),Xe=de?computed(()=>{const mn=unref(_e);return mn?unref(mn[de]):void 0}):_e,It=Object.assign({},unref(Le)||{}),Ct=computed(()=>{const mn=unref(Le);return de?mn?unref(mn[de]):void 0:mn}),yt=createValidationResults(Be,Xe,de,j,ze,Ke,Pe,Ct,_e),Ot=collectNestedValidationResults($e,Xe,ze,j,Ke,Pe,Ct),{$dirty:Mt,$errors:Pt,$invalid:At,$anyDirty:Dt,$error:Gt,$pending:Ut,$touch:on,$reset:Vt,$silentErrors:An,$commit:_n}=createMetaFields(yt,Ot,Te),Yn=de?computed({get:()=>unref(Xe),set:mn=>{Mt.value=!0;const Xn=unref(_e),sr=unref(Le);sr&&(sr[de]=It[de]),isRef(Xn[de])?Xn[de].value=mn:Xn[de]=mn}}):null;de&&Ke.$autoDirty&&watch(Xe,()=>{Mt.value||on();const mn=unref(Le);mn&&(mn[de]=It[de])},{flush:"sync"});function bn(mn){return(Te.value||{})[mn]}function Ln(){isRef(Le)?Le.value=It:Object.keys(It).length===0?Object.keys(Le).forEach(mn=>{delete Le[mn]}):Object.assign(Le,It)}return reactive(Object.assign({},yt,{$model:Yn,$dirty:Mt,$error:Gt,$errors:Pt,$invalid:At,$anyDirty:Dt,$pending:Ut,$touch:on,$reset:Vt,$path:ze||ROOT_PATH,$silentErrors:An,$validate:ee,$commit:_n},Te&&{$getResultsForChild:bn,$clearExternalResults:Ln},Ot))}class ResultsStorage{constructor(){this.storage=new Map}set(ee,ce,_e){this.storage.set(ee,{rules:ce,result:_e})}checkRulesValidity(ee,ce,_e){const de=Object.keys(_e),xe=Object.keys(ce);return xe.length!==de.length||!xe.every(j=>de.includes(j))?!1:xe.every(j=>ce[j].$params?Object.keys(ce[j].$params).every(Ce=>unref(_e[j].$params[Ce])===unref(ce[j].$params[Ce])):!0)}get(ee,ce){const _e=this.storage.get(ee);if(!_e)return;const{rules:de,result:xe}=_e,Te=this.checkRulesValidity(ee,ce,de),j=xe.$unwatch?xe.$unwatch:()=>({});return Te?xe:{$dirty:xe.$dirty,$partial:!0,$unwatch:j}}}const CollectFlag={COLLECT_ALL:!0,COLLECT_NONE:!1},VuelidateInjectChildResults=Symbol("vuelidate#injectChildResults"),VuelidateRemoveChildResults=Symbol("vuelidate#removeChildResults");function nestedValidations(V){let{$scope:ee,instance:ce}=V;const _e={},de=ref([]),xe=computed(()=>de.value.reduce((Le,ze)=>(Le[ze]=unref(_e[ze]),Le),{}));function Te(Le,ze){let{$registerAs:Be,$scope:$e,$stopPropagation:Ve}=ze;Ve||ee===CollectFlag.COLLECT_NONE||$e===CollectFlag.COLLECT_NONE||ee!==CollectFlag.COLLECT_ALL&&ee!==$e||(_e[Be]=Le,de.value.push(Be))}ce.__vuelidateInjectInstances=[].concat(ce.__vuelidateInjectInstances||[],Te);function j(Le){de.value=de.value.filter(ze=>ze!==Le),delete _e[Le]}ce.__vuelidateRemoveInstances=[].concat(ce.__vuelidateRemoveInstances||[],j);const Ce=inject(VuelidateInjectChildResults,[]);provide(VuelidateInjectChildResults,ce.__vuelidateInjectInstances);const Pe=inject(VuelidateRemoveChildResults,[]);return provide(VuelidateRemoveChildResults,ce.__vuelidateRemoveInstances),{childResults:xe,sendValidationResultsToParent:Ce,removeValidationResultsFromParent:Pe}}function ComputedProxyFactory(V){return new Proxy(V,{get(ee,ce){return typeof ee[ce]=="object"?ComputedProxyFactory(ee[ce]):computed(()=>ee[ce])}})}function useVuelidate(V,ee){let ce=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};arguments.length===1&&(ce=V,V=void 0,ee=void 0);let{$registerAs:_e,$scope:de=CollectFlag.COLLECT_ALL,$stopPropagation:xe,$externalResults:Te,currentVueInstance:j}=ce;const Ce=j||getCurrentInstance(),Pe=Ce?Ce.type:{};!_e&&Ce&&(_e=`_vuelidate_${Ce.uid||Ce._uid}`);const Le=ref({}),ze=new ResultsStorage,{childResults:Be,sendValidationResultsToParent:$e,removeValidationResultsFromParent:Ve}=Ce?nestedValidations({$scope:de,instance:Ce}):{childResults:ref({})};if(!V&&Pe.validations){const Ke=Pe.validations;ee=ref({}),onBeforeMount(()=>{ee.value=Ce.proxy,watch(()=>isFunction(Ke)?Ke.call(ee.value,new ComputedProxyFactory(ee.value)):Ke,Xe=>{Le.value=setValidations({validations:Xe,state:ee,childResults:Be,resultsCache:ze,globalConfig:ce,instance:Ce.proxy,externalResults:Te||Ce.proxy.vuelidateExternalResults})},{immediate:!0})}),ce=Pe.validationsConfig||ce}else{const Ke=isRef(V)||isProxy(V)?V:reactive(V||{});watch(Ke,Xe=>{Le.value=setValidations({validations:Xe,state:ee,childResults:Be,resultsCache:ze,globalConfig:ce,instance:Ce?Ce.proxy:{},externalResults:Te})},{immediate:!0})}return Ce&&($e.forEach(Ke=>Ke(Le,{$registerAs:_e,$scope:de,$stopPropagation:xe})),onBeforeUnmount(()=>Ve.forEach(Ke=>Ke(_e)))),computed(()=>Object.assign({},unref(Le.value),Be.value))}const req=V=>{if(V=unref(V),Array.isArray(V))return!!V.length;if(V==null)return!1;if(V===!1)return!0;if(V instanceof Date)return!isNaN(V.getTime());if(typeof V=="object"){for(let ee in V)return!0;return!1}return!!String(V).length},len=V=>(V=unref(V),Array.isArray(V)?V.length:typeof V=="object"?Object.keys(V).length:String(V).length);function regex(){for(var V=arguments.length,ee=new Array(V),ce=0;ce<V;ce++)ee[ce]=arguments[ce];return _e=>(_e=unref(_e),!req(_e)||ee.every(de=>de.test(_e)))}regex(/^[a-zA-Z]*$/);regex(/^[a-zA-Z0-9]*$/);var numeric$1=regex(/^\d*(\.\d+)?$/),numeric={$validator:numeric$1,$message:"Value must be numeric",$params:{type:"numeric"}};const emailRegex=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;var email$1=regex(emailRegex),email={$validator:email$1,$message:"Value is not a valid email address",$params:{type:"email"}};function minLength$1(V){return ee=>!req(ee)||len(ee)>=unref(V)}function minLength(V){return{$validator:minLength$1(V),$message:ee=>{let{$params:ce}=ee;return`This field should be at least ${ce.min} long`},$params:{min:V,type:"minLength"}}}function required$1(V){return typeof V=="string"&&(V=V.trim()),req(V)}var required={$validator:required$1,$message:"Value is required",$params:{type:"required"}};function sameAs$1(V){return ee=>unref(ee)===unref(V)}function sameAs(V){let ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"other";return{$validator:sameAs$1(V),$message:ce=>`The value must be equal to the ${ee} value`,$params:{equalTo:V,otherName:ee,type:"sameAs"}}}const urlRegex=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i;regex(urlRegex);regex(/(^[0-9]*$)|(^-[0-9]+$)/);regex(/^[-]?\d*(\.\d+)?$/);function _mergeNamespaces(V,ee){return ee.forEach(function(ce){Object.keys(ce).forEach(function(_e){if(_e!=="default"&&!(_e in V)){var de=Object.getOwnPropertyDescriptor(ce,_e);Object.defineProperty(V,_e,de.get?de:{enumerable:!0,get:function(){return ce[_e]}})}})}),Object.freeze(V)}function ownKeys(V,ee){var ce=Object.keys(V);if(Object.getOwnPropertySymbols){var _e=Object.getOwnPropertySymbols(V);ee&&(_e=_e.filter(function(de){return Object.getOwnPropertyDescriptor(V,de).enumerable})),ce.push.apply(ce,_e)}return ce}function _objectSpread2(V){for(var ee=1;ee<arguments.length;ee++){var ce=arguments[ee]!=null?arguments[ee]:{};ee%2?ownKeys(Object(ce),!0).forEach(function(_e){_defineProperty(V,_e,ce[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(ce)):ownKeys(Object(ce)).forEach(function(_e){Object.defineProperty(V,_e,Object.getOwnPropertyDescriptor(ce,_e))})}return V}function _defineProperty(V,ee,ce){return ee in V?Object.defineProperty(V,ee,{value:ce,enumerable:!0,configurable:!0,writable:!0}):V[ee]=ce,V}function _slicedToArray(V,ee){return _arrayWithHoles(V)||_iterableToArrayLimit(V,ee)||_unsupportedIterableToArray(V,ee)||_nonIterableRest()}function _arrayWithHoles(V){if(Array.isArray(V))return V}function _iterableToArrayLimit(V,ee){var ce=V==null?null:typeof Symbol!="undefined"&&V[Symbol.iterator]||V["@@iterator"];if(ce!=null){var _e,de,xe=[],Te=!0,j=!1;try{for(ce=ce.call(V);!(Te=(_e=ce.next()).done)&&(xe.push(_e.value),!ee||xe.length!==ee);Te=!0);}catch(Ce){j=!0,de=Ce}finally{try{Te||ce.return==null||ce.return()}finally{if(j)throw de}}return xe}}function _unsupportedIterableToArray(V,ee){if(V){if(typeof V=="string")return _arrayLikeToArray(V,ee);var ce=Object.prototype.toString.call(V).slice(8,-1);return ce==="Object"&&V.constructor&&(ce=V.constructor.name),ce==="Map"||ce==="Set"?Array.from(V):ce==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ce)?_arrayLikeToArray(V,ee):void 0}}function _arrayLikeToArray(V,ee){(ee==null||ee>V.length)&&(ee=V.length);for(var ce=0,_e=new Array(ee);ce<ee;ce++)_e[ce]=V[ce];return _e}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function createCommonjsModule(V){var ee={exports:{}};return V(ee,ee.exports),ee.exports}var UZIP_1=createCommonjsModule(function(V){var ee,ce,_e={};V.exports=_e,_e.parse=function(de,xe){for(var Te=_e.bin.readUshort,j=_e.bin.readUint,Ce=0,Pe={},Le=new Uint8Array(de),ze=Le.length-4;j(Le,ze)!=101010256;)ze--;Ce=ze,Ce+=4;var Be=Te(Le,Ce+=4);Te(Le,Ce+=2);var $e=j(Le,Ce+=2),Ve=j(Le,Ce+=4);Ce+=4,Ce=Ve;for(var Ke=0;Ke<Be;Ke++){j(Le,Ce),Ce+=4,Ce+=4,Ce+=4,j(Le,Ce+=4),$e=j(Le,Ce+=4);var Xe=j(Le,Ce+=4),It=Te(Le,Ce+=4),Ct=Te(Le,Ce+2),yt=Te(Le,Ce+4);Ce+=6;var Ot=j(Le,Ce+=8);Ce+=4,Ce+=It+Ct+yt,_e._readLocal(Le,Ot,Pe,$e,Xe,xe)}return Pe},_e._readLocal=function(de,xe,Te,j,Ce,Pe){var Le=_e.bin.readUshort,ze=_e.bin.readUint;ze(de,xe),Le(de,xe+=4),Le(de,xe+=2);var Be=Le(de,xe+=2);ze(de,xe+=2),ze(de,xe+=4),xe+=4;var $e=Le(de,xe+=8),Ve=Le(de,xe+=2);xe+=2;var Ke=_e.bin.readUTF8(de,xe,$e);if(xe+=$e,xe+=Ve,Pe)Te[Ke]={size:Ce,csize:j};else{var Xe=new Uint8Array(de.buffer,xe);if(Be==0)Te[Ke]=new Uint8Array(Xe.buffer.slice(xe,xe+j));else{if(Be!=8)throw"unknown compression method: "+Be;var It=new Uint8Array(Ce);_e.inflateRaw(Xe,It),Te[Ke]=It}}},_e.inflateRaw=function(de,xe){return _e.F.inflate(de,xe)},_e.inflate=function(de,xe){return de[0],de[1],_e.inflateRaw(new Uint8Array(de.buffer,de.byteOffset+2,de.length-6),xe)},_e.deflate=function(de,xe){xe==null&&(xe={level:6});var Te=0,j=new Uint8Array(50+Math.floor(1.1*de.length));j[Te]=120,j[Te+1]=156,Te+=2,Te=_e.F.deflateRaw(de,j,Te,xe.level);var Ce=_e.adler(de,0,de.length);return j[Te+0]=Ce>>>24&255,j[Te+1]=Ce>>>16&255,j[Te+2]=Ce>>>8&255,j[Te+3]=Ce>>>0&255,new Uint8Array(j.buffer,0,Te+4)},_e.deflateRaw=function(de,xe){xe==null&&(xe={level:6});var Te=new Uint8Array(50+Math.floor(1.1*de.length)),j=_e.F.deflateRaw(de,Te,j,xe.level);return new Uint8Array(Te.buffer,0,j)},_e.encode=function(de,xe){xe==null&&(xe=!1);var Te=0,j=_e.bin.writeUint,Ce=_e.bin.writeUshort,Pe={};for(var Le in de){var ze=!_e._noNeed(Le)&&!xe,Be=de[Le],$e=_e.crc.crc(Be,0,Be.length);Pe[Le]={cpr:ze,usize:Be.length,crc:$e,file:ze?_e.deflateRaw(Be):Be}}for(var Le in Pe)Te+=Pe[Le].file.length+30+46+2*_e.bin.sizeUTF8(Le);Te+=22;var Ve=new Uint8Array(Te),Ke=0,Xe=[];for(var Le in Pe){var It=Pe[Le];Xe.push(Ke),Ke=_e._writeHeader(Ve,Ke,Le,It,0)}var Ct=0,yt=Ke;for(var Le in Pe)It=Pe[Le],Xe.push(Ke),Ke=_e._writeHeader(Ve,Ke,Le,It,1,Xe[Ct++]);var Ot=Ke-yt;return j(Ve,Ke,101010256),Ke+=4,Ce(Ve,Ke+=4,Ct),Ce(Ve,Ke+=2,Ct),j(Ve,Ke+=2,Ot),j(Ve,Ke+=4,yt),Ke+=4,Ke+=2,Ve.buffer},_e._noNeed=function(de){var xe=de.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(xe)!=-1},_e._writeHeader=function(de,xe,Te,j,Ce,Pe){var Le=_e.bin.writeUint,ze=_e.bin.writeUshort,Be=j.file;return Le(de,xe,Ce==0?67324752:33639248),xe+=4,Ce==1&&(xe+=2),ze(de,xe,20),ze(de,xe+=2,0),ze(de,xe+=2,j.cpr?8:0),Le(de,xe+=2,0),Le(de,xe+=4,j.crc),Le(de,xe+=4,Be.length),Le(de,xe+=4,j.usize),ze(de,xe+=4,_e.bin.sizeUTF8(Te)),ze(de,xe+=2,0),xe+=2,Ce==1&&(xe+=2,xe+=2,Le(de,xe+=6,Pe),xe+=4),xe+=_e.bin.writeUTF8(de,xe,Te),Ce==0&&(de.set(Be,xe),xe+=Be.length),xe},_e.crc={table:function(){for(var de=new Uint32Array(256),xe=0;xe<256;xe++){for(var Te=xe,j=0;j<8;j++)1&Te?Te=3988292384^Te>>>1:Te>>>=1;de[xe]=Te}return de}(),update:function(de,xe,Te,j){for(var Ce=0;Ce<j;Ce++)de=_e.crc.table[255&(de^xe[Te+Ce])]^de>>>8;return de},crc:function(de,xe,Te){return 4294967295^_e.crc.update(4294967295,de,xe,Te)}},_e.adler=function(de,xe,Te){for(var j=1,Ce=0,Pe=xe,Le=xe+Te;Pe<Le;){for(var ze=Math.min(Pe+5552,Le);Pe<ze;)Ce+=j+=de[Pe++];j%=65521,Ce%=65521}return Ce<<16|j},_e.bin={readUshort:function(de,xe){return de[xe]|de[xe+1]<<8},writeUshort:function(de,xe,Te){de[xe]=255&Te,de[xe+1]=Te>>8&255},readUint:function(de,xe){return 16777216*de[xe+3]+(de[xe+2]<<16|de[xe+1]<<8|de[xe])},writeUint:function(de,xe,Te){de[xe]=255&Te,de[xe+1]=Te>>8&255,de[xe+2]=Te>>16&255,de[xe+3]=Te>>24&255},readASCII:function(de,xe,Te){for(var j="",Ce=0;Ce<Te;Ce++)j+=String.fromCharCode(de[xe+Ce]);return j},writeASCII:function(de,xe,Te){for(var j=0;j<Te.length;j++)de[xe+j]=Te.charCodeAt(j)},pad:function(de){return de.length<2?"0"+de:de},readUTF8:function(de,xe,Te){for(var j,Ce="",Pe=0;Pe<Te;Pe++)Ce+="%"+_e.bin.pad(de[xe+Pe].toString(16));try{j=decodeURIComponent(Ce)}catch{return _e.bin.readASCII(de,xe,Te)}return j},writeUTF8:function(de,xe,Te){for(var j=Te.length,Ce=0,Pe=0;Pe<j;Pe++){var Le=Te.charCodeAt(Pe);if((4294967168&Le)==0)de[xe+Ce]=Le,Ce++;else if((4294965248&Le)==0)de[xe+Ce]=192|Le>>6,de[xe+Ce+1]=128|Le>>0&63,Ce+=2;else if((4294901760&Le)==0)de[xe+Ce]=224|Le>>12,de[xe+Ce+1]=128|Le>>6&63,de[xe+Ce+2]=128|Le>>0&63,Ce+=3;else{if((4292870144&Le)!=0)throw"e";de[xe+Ce]=240|Le>>18,de[xe+Ce+1]=128|Le>>12&63,de[xe+Ce+2]=128|Le>>6&63,de[xe+Ce+3]=128|Le>>0&63,Ce+=4}}return Ce},sizeUTF8:function(de){for(var xe=de.length,Te=0,j=0;j<xe;j++){var Ce=de.charCodeAt(j);if((4294967168&Ce)==0)Te++;else if((4294965248&Ce)==0)Te+=2;else if((4294901760&Ce)==0)Te+=3;else{if((4292870144&Ce)!=0)throw"e";Te+=4}}return Te}},_e.F={},_e.F.deflateRaw=function(de,xe,Te,j){var Ce=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][j],Pe=_e.F.U,Le=_e.F._goodIndex;_e.F._hash;var ze=_e.F._putsE,Be=0,$e=Te<<3,Ve=0,Ke=de.length;if(j==0){for(;Be<Ke;)ze(xe,$e,Be+(on=Math.min(65535,Ke-Be))==Ke?1:0),$e=_e.F._copyExact(de,Be,on,xe,$e+8),Be+=on;return $e>>>3}var Xe=Pe.lits,It=Pe.strt,Ct=Pe.prev,yt=0,Ot=0,Mt=0,Pt=0,At=0,Dt=0;for(Ke>2&&(It[Dt=_e.F._hash(de,0)]=0),Be=0;Be<Ke;Be++){if(At=Dt,Be+1<Ke-2){Dt=_e.F._hash(de,Be+1);var Gt=Be+1&32767;Ct[Gt]=It[Dt],It[Dt]=Gt}if(Ve<=Be){(yt>14e3||Ot>26697)&&Ke-Be>100&&(Ve<Be&&(Xe[yt]=Be-Ve,yt+=2,Ve=Be),$e=_e.F._writeBlock(Be==Ke-1||Ve==Ke?1:0,Xe,yt,Pt,de,Mt,Be-Mt,xe,$e),yt=Ot=Pt=0,Mt=Be);var Ut=0;Be<Ke-2&&(Ut=_e.F._bestMatch(de,Be,Ct,At,Math.min(Ce[2],Ke-Be),Ce[3]));var on=Ut>>>16,Vt=65535&Ut;if(Ut!=0){Vt=65535&Ut;var An=Le(on=Ut>>>16,Pe.of0);Pe.lhst[257+An]++;var _n=Le(Vt,Pe.df0);Pe.dhst[_n]++,Pt+=Pe.exb[An]+Pe.dxb[_n],Xe[yt]=on<<23|Be-Ve,Xe[yt+1]=Vt<<16|An<<8|_n,yt+=2,Ve=Be+on}else Pe.lhst[de[Be]]++;Ot++}}for(Mt==Be&&de.length!=0||(Ve<Be&&(Xe[yt]=Be-Ve,yt+=2,Ve=Be),$e=_e.F._writeBlock(1,Xe,yt,Pt,de,Mt,Be-Mt,xe,$e),yt=0,Ot=0,yt=Ot=Pt=0,Mt=Be);(7&$e)!=0;)$e++;return $e>>>3},_e.F._bestMatch=function(de,xe,Te,j,Ce,Pe){var Le=32767&xe,ze=Te[Le],Be=Le-ze+32768&32767;if(ze==Le||j!=_e.F._hash(de,xe-Be))return 0;for(var $e=0,Ve=0,Ke=Math.min(32767,xe);Be<=Ke&&--Pe!=0&&ze!=Le;){if($e==0||de[xe+$e]==de[xe+$e-Be]){var Xe=_e.F._howLong(de,xe,Be);if(Xe>$e){if(Ve=Be,($e=Xe)>=Ce)break;Be+2<Xe&&(Xe=Be+2);for(var It=0,Ct=0;Ct<Xe-2;Ct++){var yt=xe-Be+Ct+32768&32767,Ot=yt-Te[yt]+32768&32767;Ot>It&&(It=Ot,ze=yt)}}}Be+=(Le=ze)-(ze=Te[Le])+32768&32767}return $e<<16|Ve},_e.F._howLong=function(de,xe,Te){if(de[xe]!=de[xe-Te]||de[xe+1]!=de[xe+1-Te]||de[xe+2]!=de[xe+2-Te])return 0;var j=xe,Ce=Math.min(de.length,xe+258);for(xe+=3;xe<Ce&&de[xe]==de[xe-Te];)xe++;return xe-j},_e.F._hash=function(de,xe){return(de[xe]<<8|de[xe+1])+(de[xe+2]<<4)&65535},_e.saved=0,_e.F._writeBlock=function(de,xe,Te,j,Ce,Pe,Le,ze,Be){var $e,Ve,Ke,Xe,It,Ct,yt,Ot,Mt,Pt=_e.F.U,At=_e.F._putsF,Dt=_e.F._putsE;Pt.lhst[256]++,Ve=($e=_e.F.getTrees())[0],Ke=$e[1],Xe=$e[2],It=$e[3],Ct=$e[4],yt=$e[5],Ot=$e[6],Mt=$e[7];var Gt=32+((Be+3&7)==0?0:8-(Be+3&7))+(Le<<3),Ut=j+_e.F.contSize(Pt.fltree,Pt.lhst)+_e.F.contSize(Pt.fdtree,Pt.dhst),on=j+_e.F.contSize(Pt.ltree,Pt.lhst)+_e.F.contSize(Pt.dtree,Pt.dhst);on+=14+3*yt+_e.F.contSize(Pt.itree,Pt.ihst)+(2*Pt.ihst[16]+3*Pt.ihst[17]+7*Pt.ihst[18]);for(var Vt=0;Vt<286;Vt++)Pt.lhst[Vt]=0;for(Vt=0;Vt<30;Vt++)Pt.dhst[Vt]=0;for(Vt=0;Vt<19;Vt++)Pt.ihst[Vt]=0;var An=Gt<Ut&&Gt<on?0:Ut<on?1:2;if(At(ze,Be,de),At(ze,Be+1,An),Be+=3,An==0){for(;(7&Be)!=0;)Be++;Be=_e.F._copyExact(Ce,Pe,Le,ze,Be)}else{var _n,Yn;if(An==1&&(_n=Pt.fltree,Yn=Pt.fdtree),An==2){_e.F.makeCodes(Pt.ltree,Ve),_e.F.revCodes(Pt.ltree,Ve),_e.F.makeCodes(Pt.dtree,Ke),_e.F.revCodes(Pt.dtree,Ke),_e.F.makeCodes(Pt.itree,Xe),_e.F.revCodes(Pt.itree,Xe),_n=Pt.ltree,Yn=Pt.dtree,Dt(ze,Be,It-257),Dt(ze,Be+=5,Ct-1),Dt(ze,Be+=5,yt-4),Be+=4;for(var bn=0;bn<yt;bn++)Dt(ze,Be+3*bn,Pt.itree[1+(Pt.ordr[bn]<<1)]);Be+=3*yt,Be=_e.F._codeTiny(Ot,Pt.itree,ze,Be),Be=_e.F._codeTiny(Mt,Pt.itree,ze,Be)}for(var Ln=Pe,mn=0;mn<Te;mn+=2){for(var Xn=xe[mn],sr=Xn>>>23,Pr=Ln+(8388607&Xn);Ln<Pr;)Be=_e.F._writeLit(Ce[Ln++],_n,ze,Be);if(sr!=0){var er=xe[mn+1],rr=er>>16,Vr=er>>8&255,Wt=255&er;Dt(ze,Be=_e.F._writeLit(257+Vr,_n,ze,Be),sr-Pt.of0[Vr]),Be+=Pt.exb[Vr],At(ze,Be=_e.F._writeLit(Wt,Yn,ze,Be),rr-Pt.df0[Wt]),Be+=Pt.dxb[Wt],Ln+=sr}}Be=_e.F._writeLit(256,_n,ze,Be)}return Be},_e.F._copyExact=function(de,xe,Te,j,Ce){var Pe=Ce>>>3;return j[Pe]=Te,j[Pe+1]=Te>>>8,j[Pe+2]=255-j[Pe],j[Pe+3]=255-j[Pe+1],Pe+=4,j.set(new Uint8Array(de.buffer,xe,Te),Pe),Ce+(Te+4<<3)},_e.F.getTrees=function(){for(var de=_e.F.U,xe=_e.F._hufTree(de.lhst,de.ltree,15),Te=_e.F._hufTree(de.dhst,de.dtree,15),j=[],Ce=_e.F._lenCodes(de.ltree,j),Pe=[],Le=_e.F._lenCodes(de.dtree,Pe),ze=0;ze<j.length;ze+=2)de.ihst[j[ze]]++;for(ze=0;ze<Pe.length;ze+=2)de.ihst[Pe[ze]]++;for(var Be=_e.F._hufTree(de.ihst,de.itree,7),$e=19;$e>4&&de.itree[1+(de.ordr[$e-1]<<1)]==0;)$e--;return[xe,Te,Be,Ce,Le,$e,j,Pe]},_e.F.getSecond=function(de){for(var xe=[],Te=0;Te<de.length;Te+=2)xe.push(de[Te+1]);return xe},_e.F.nonZero=function(de){for(var xe="",Te=0;Te<de.length;Te+=2)de[Te+1]!=0&&(xe+=(Te>>1)+",");return xe},_e.F.contSize=function(de,xe){for(var Te=0,j=0;j<xe.length;j++)Te+=xe[j]*de[1+(j<<1)];return Te},_e.F._codeTiny=function(de,xe,Te,j){for(var Ce=0;Ce<de.length;Ce+=2){var Pe=de[Ce],Le=de[Ce+1];j=_e.F._writeLit(Pe,xe,Te,j);var ze=Pe==16?2:Pe==17?3:7;Pe>15&&(_e.F._putsE(Te,j,Le,ze),j+=ze)}return j},_e.F._lenCodes=function(de,xe){for(var Te=de.length;Te!=2&&de[Te-1]==0;)Te-=2;for(var j=0;j<Te;j+=2){var Ce=de[j+1],Pe=j+3<Te?de[j+3]:-1,Le=j+5<Te?de[j+5]:-1,ze=j==0?-1:de[j-1];if(Ce==0&&Pe==Ce&&Le==Ce){for(var Be=j+5;Be+2<Te&&de[Be+2]==Ce;)Be+=2;($e=Math.min(Be+1-j>>>1,138))<11?xe.push(17,$e-3):xe.push(18,$e-11),j+=2*$e-2}else if(Ce==ze&&Pe==Ce&&Le==Ce){for(Be=j+5;Be+2<Te&&de[Be+2]==Ce;)Be+=2;var $e=Math.min(Be+1-j>>>1,6);xe.push(16,$e-3),j+=2*$e-2}else xe.push(Ce,0)}return Te>>>1},_e.F._hufTree=function(de,xe,Te){var j=[],Ce=de.length,Pe=xe.length,Le=0;for(Le=0;Le<Pe;Le+=2)xe[Le]=0,xe[Le+1]=0;for(Le=0;Le<Ce;Le++)de[Le]!=0&&j.push({lit:Le,f:de[Le]});var ze=j.length,Be=j.slice(0);if(ze==0)return 0;if(ze==1){var $e=j[0].lit;return Be=$e==0?1:0,xe[1+($e<<1)]=1,xe[1+(Be<<1)]=1,1}j.sort(function(Ot,Mt){return Ot.f-Mt.f});var Ve=j[0],Ke=j[1],Xe=0,It=1,Ct=2;for(j[0]={lit:-1,f:Ve.f+Ke.f,l:Ve,r:Ke,d:0};It!=ze-1;)Ve=Xe!=It&&(Ct==ze||j[Xe].f<j[Ct].f)?j[Xe++]:j[Ct++],Ke=Xe!=It&&(Ct==ze||j[Xe].f<j[Ct].f)?j[Xe++]:j[Ct++],j[It++]={lit:-1,f:Ve.f+Ke.f,l:Ve,r:Ke};var yt=_e.F.setDepth(j[It-1],0);for(yt>Te&&(_e.F.restrictDepth(Be,Te,yt),yt=Te),Le=0;Le<ze;Le++)xe[1+(Be[Le].lit<<1)]=Be[Le].d;return yt},_e.F.setDepth=function(de,xe){return de.lit!=-1?(de.d=xe,xe):Math.max(_e.F.setDepth(de.l,xe+1),_e.F.setDepth(de.r,xe+1))},_e.F.restrictDepth=function(de,xe,Te){var j=0,Ce=1<<Te-xe,Pe=0;for(de.sort(function(ze,Be){return Be.d==ze.d?ze.f-Be.f:Be.d-ze.d}),j=0;j<de.length&&de[j].d>xe;j++){var Le=de[j].d;de[j].d=xe,Pe+=Ce-(1<<Te-Le)}for(Pe>>>=Te-xe;Pe>0;)(Le=de[j].d)<xe?(de[j].d++,Pe-=1<<xe-Le-1):j++;for(;j>=0;j--)de[j].d==xe&&Pe<0&&(de[j].d--,Pe++);Pe!=0&&console.log("debt left")},_e.F._goodIndex=function(de,xe){var Te=0;return xe[16|Te]<=de&&(Te|=16),xe[8|Te]<=de&&(Te|=8),xe[4|Te]<=de&&(Te|=4),xe[2|Te]<=de&&(Te|=2),xe[1|Te]<=de&&(Te|=1),Te},_e.F._writeLit=function(de,xe,Te,j){return _e.F._putsF(Te,j,xe[de<<1]),j+xe[1+(de<<1)]},_e.F.inflate=function(de,xe){var Te=Uint8Array;if(de[0]==3&&de[1]==0)return xe||new Te(0);var j=_e.F,Ce=j._bitsF,Pe=j._bitsE,Le=j._decodeTiny,ze=j.makeCodes,Be=j.codes2map,$e=j._get17,Ve=j.U,Ke=xe==null;Ke&&(xe=new Te(de.length>>>2<<3));for(var Xe,It,Ct=0,yt=0,Ot=0,Mt=0,Pt=0,At=0,Dt=0,Gt=0,Ut=0;Ct==0;)if(Ct=Ce(de,Ut,1),yt=Ce(de,Ut+1,2),Ut+=3,yt!=0){if(Ke&&(xe=_e.F._check(xe,Gt+(1<<17))),yt==1&&(Xe=Ve.flmap,It=Ve.fdmap,At=511,Dt=31),yt==2){Ot=Pe(de,Ut,5)+257,Mt=Pe(de,Ut+5,5)+1,Pt=Pe(de,Ut+10,4)+4,Ut+=14;for(var on=0;on<38;on+=2)Ve.itree[on]=0,Ve.itree[on+1]=0;var Vt=1;for(on=0;on<Pt;on++){var An=Pe(de,Ut+3*on,3);Ve.itree[1+(Ve.ordr[on]<<1)]=An,An>Vt&&(Vt=An)}Ut+=3*Pt,ze(Ve.itree,Vt),Be(Ve.itree,Vt,Ve.imap),Xe=Ve.lmap,It=Ve.dmap,Ut=Le(Ve.imap,(1<<Vt)-1,Ot+Mt,de,Ut,Ve.ttree);var _n=j._copyOut(Ve.ttree,0,Ot,Ve.ltree);At=(1<<_n)-1;var Yn=j._copyOut(Ve.ttree,Ot,Mt,Ve.dtree);Dt=(1<<Yn)-1,ze(Ve.ltree,_n),Be(Ve.ltree,_n,Xe),ze(Ve.dtree,Yn),Be(Ve.dtree,Yn,It)}for(;;){var bn=Xe[$e(de,Ut)&At];Ut+=15&bn;var Ln=bn>>>4;if(Ln>>>8==0)xe[Gt++]=Ln;else{if(Ln==256)break;var mn=Gt+Ln-254;if(Ln>264){var Xn=Ve.ldef[Ln-257];mn=Gt+(Xn>>>3)+Pe(de,Ut,7&Xn),Ut+=7&Xn}var sr=It[$e(de,Ut)&Dt];Ut+=15&sr;var Pr=sr>>>4,er=Ve.ddef[Pr],rr=(er>>>4)+Ce(de,Ut,15&er);for(Ut+=15&er,Ke&&(xe=_e.F._check(xe,Gt+(1<<17)));Gt<mn;)xe[Gt]=xe[Gt++-rr],xe[Gt]=xe[Gt++-rr],xe[Gt]=xe[Gt++-rr],xe[Gt]=xe[Gt++-rr];Gt=mn}}}else{(7&Ut)!=0&&(Ut+=8-(7&Ut));var Vr=4+(Ut>>>3),Wt=de[Vr-4]|de[Vr-3]<<8;Ke&&(xe=_e.F._check(xe,Gt+Wt)),xe.set(new Te(de.buffer,de.byteOffset+Vr,Wt),Gt),Ut=Vr+Wt<<3,Gt+=Wt}return xe.length==Gt?xe:xe.slice(0,Gt)},_e.F._check=function(de,xe){var Te=de.length;if(xe<=Te)return de;var j=new Uint8Array(Math.max(Te<<1,xe));return j.set(de,0),j},_e.F._decodeTiny=function(de,xe,Te,j,Ce,Pe){for(var Le=_e.F._bitsE,ze=_e.F._get17,Be=0;Be<Te;){var $e=de[ze(j,Ce)&xe];Ce+=15&$e;var Ve=$e>>>4;if(Ve<=15)Pe[Be]=Ve,Be++;else{var Ke=0,Xe=0;Ve==16?(Xe=3+Le(j,Ce,2),Ce+=2,Ke=Pe[Be-1]):Ve==17?(Xe=3+Le(j,Ce,3),Ce+=3):Ve==18&&(Xe=11+Le(j,Ce,7),Ce+=7);for(var It=Be+Xe;Be<It;)Pe[Be]=Ke,Be++}}return Ce},_e.F._copyOut=function(de,xe,Te,j){for(var Ce=0,Pe=0,Le=j.length>>>1;Pe<Te;){var ze=de[Pe+xe];j[Pe<<1]=0,j[1+(Pe<<1)]=ze,ze>Ce&&(Ce=ze),Pe++}for(;Pe<Le;)j[Pe<<1]=0,j[1+(Pe<<1)]=0,Pe++;return Ce},_e.F.makeCodes=function(de,xe){for(var Te,j,Ce,Pe,Le=_e.F.U,ze=de.length,Be=Le.bl_count,$e=0;$e<=xe;$e++)Be[$e]=0;for($e=1;$e<ze;$e+=2)Be[de[$e]]++;var Ve=Le.next_code;for(Te=0,Be[0]=0,j=1;j<=xe;j++)Te=Te+Be[j-1]<<1,Ve[j]=Te;for(Ce=0;Ce<ze;Ce+=2)(Pe=de[Ce+1])!=0&&(de[Ce]=Ve[Pe],Ve[Pe]++)},_e.F.codes2map=function(de,xe,Te){for(var j=de.length,Ce=_e.F.U.rev15,Pe=0;Pe<j;Pe+=2)if(de[Pe+1]!=0)for(var Le=Pe>>1,ze=de[Pe+1],Be=Le<<4|ze,$e=xe-ze,Ve=de[Pe]<<$e,Ke=Ve+(1<<$e);Ve!=Ke;)Te[Ce[Ve]>>>15-xe]=Be,Ve++},_e.F.revCodes=function(de,xe){for(var Te=_e.F.U.rev15,j=15-xe,Ce=0;Ce<de.length;Ce+=2){var Pe=de[Ce]<<xe-de[Ce+1];de[Ce]=Te[Pe]>>>j}},_e.F._putsE=function(de,xe,Te){Te<<=7&xe;var j=xe>>>3;de[j]|=Te,de[j+1]|=Te>>>8},_e.F._putsF=function(de,xe,Te){Te<<=7&xe;var j=xe>>>3;de[j]|=Te,de[j+1]|=Te>>>8,de[j+2]|=Te>>>16},_e.F._bitsE=function(de,xe,Te){return(de[xe>>>3]|de[1+(xe>>>3)]<<8)>>>(7&xe)&(1<<Te)-1},_e.F._bitsF=function(de,xe,Te){return(de[xe>>>3]|de[1+(xe>>>3)]<<8|de[2+(xe>>>3)]<<16)>>>(7&xe)&(1<<Te)-1},_e.F._get17=function(de,xe){return(de[xe>>>3]|de[1+(xe>>>3)]<<8|de[2+(xe>>>3)]<<16)>>>(7&xe)},_e.F._get25=function(de,xe){return(de[xe>>>3]|de[1+(xe>>>3)]<<8|de[2+(xe>>>3)]<<16|de[3+(xe>>>3)]<<24)>>>(7&xe)},_e.F.U=(ee=Uint16Array,ce=Uint32Array,{next_code:new ee(16),bl_count:new ee(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new ee(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new ce(32),flmap:new ee(512),fltree:[],fdmap:new ee(32),fdtree:[],lmap:new ee(32768),ltree:[],ttree:[],dmap:new ee(32768),dtree:[],imap:new ee(512),itree:[],rev15:new ee(32768),lhst:new ce(286),dhst:new ce(30),ihst:new ce(19),lits:new ce(15e3),strt:new ee(65536),prev:new ee(32768)}),function(){for(var de=_e.F.U,xe=0;xe<32768;xe++){var Te=xe;Te=(4278255360&(Te=(4042322160&(Te=(3435973836&(Te=(2863311530&Te)>>>1|(1431655765&Te)<<1))>>>2|(858993459&Te)<<2))>>>4|(252645135&Te)<<4))>>>8|(16711935&Te)<<8,de.rev15[xe]=(Te>>>16|Te<<16)>>>17}function j(Ce,Pe,Le){for(;Pe--!=0;)Ce.push(0,Le)}for(xe=0;xe<32;xe++)de.ldef[xe]=de.of0[xe]<<3|de.exb[xe],de.ddef[xe]=de.df0[xe]<<4|de.dxb[xe];j(de.fltree,144,8),j(de.fltree,112,9),j(de.fltree,24,7),j(de.fltree,8,8),_e.F.makeCodes(de.fltree,9),_e.F.codes2map(de.fltree,9,de.flmap),_e.F.revCodes(de.fltree,9),j(de.fdtree,32,5),_e.F.makeCodes(de.fdtree,5),_e.F.codes2map(de.fdtree,5,de.fdmap),_e.F.revCodes(de.fdtree,5),j(de.itree,19,0),j(de.ltree,286,0),j(de.dtree,30,0),j(de.ttree,320,0)}()}),UZIP=Object.freeze(_mergeNamespaces({__proto__:null,default:UZIP_1},[UZIP_1])),UPNG={},N,W,H;UPNG.toRGBA8=function(V){var ee=V.width,ce=V.height;if(V.tabs.acTL==null)return[UPNG.toRGBA8.decodeImage(V.data,ee,ce,V).buffer];var _e=[];V.frames[0].data==null&&(V.frames[0].data=V.data);for(var de=ee*ce*4,xe=new Uint8Array(de),Te=new Uint8Array(de),j=new Uint8Array(de),Ce=0;Ce<V.frames.length;Ce++){var Pe=V.frames[Ce],Le=Pe.rect.x,ze=Pe.rect.y,Be=Pe.rect.width,$e=Pe.rect.height,Ve=UPNG.toRGBA8.decodeImage(Pe.data,Be,$e,V);if(Ce!=0)for(var Ke=0;Ke<de;Ke++)j[Ke]=xe[Ke];if(Pe.blend==0?UPNG._copyTile(Ve,Be,$e,xe,ee,ce,Le,ze,0):Pe.blend==1&&UPNG._copyTile(Ve,Be,$e,xe,ee,ce,Le,ze,1),_e.push(xe.buffer.slice(0)),Pe.dispose!=0){if(Pe.dispose==1)UPNG._copyTile(Te,Be,$e,xe,ee,ce,Le,ze,0);else if(Pe.dispose==2)for(Ke=0;Ke<de;Ke++)xe[Ke]=j[Ke]}}return _e},UPNG.toRGBA8.decodeImage=function(V,ee,ce,_e){var de=ee*ce,xe=UPNG.decode._getBPP(_e),Te=Math.ceil(ee*xe/8),j=new Uint8Array(4*de),Ce=new Uint32Array(j.buffer),Pe=_e.ctype,Le=_e.depth,ze=UPNG._bin.readUshort;if(Pe==6){var Be=de<<2;if(Le==8)for(var $e=0;$e<Be;$e+=4)j[$e]=V[$e],j[$e+1]=V[$e+1],j[$e+2]=V[$e+2],j[$e+3]=V[$e+3];if(Le==16)for($e=0;$e<Be;$e++)j[$e]=V[$e<<1]}else if(Pe==2){var Ve=_e.tabs.tRNS;if(Ve==null){if(Le==8)for($e=0;$e<de;$e++){var Ke=3*$e;Ce[$e]=255<<24|V[Ke+2]<<16|V[Ke+1]<<8|V[Ke]}if(Le==16)for($e=0;$e<de;$e++)Ke=6*$e,Ce[$e]=255<<24|V[Ke+4]<<16|V[Ke+2]<<8|V[Ke]}else{var Xe=Ve[0],It=Ve[1],Ct=Ve[2];if(Le==8)for($e=0;$e<de;$e++){var yt=$e<<2;Ke=3*$e,Ce[$e]=255<<24|V[Ke+2]<<16|V[Ke+1]<<8|V[Ke],V[Ke]==Xe&&V[Ke+1]==It&&V[Ke+2]==Ct&&(j[yt+3]=0)}if(Le==16)for($e=0;$e<de;$e++)yt=$e<<2,Ke=6*$e,Ce[$e]=255<<24|V[Ke+4]<<16|V[Ke+2]<<8|V[Ke],ze(V,Ke)==Xe&&ze(V,Ke+2)==It&&ze(V,Ke+4)==Ct&&(j[yt+3]=0)}}else if(Pe==3){var Ot=_e.tabs.PLTE,Mt=_e.tabs.tRNS,Pt=Mt?Mt.length:0;if(Le==1)for(var At=0;At<ce;At++){var Dt=At*Te,Gt=At*ee;for($e=0;$e<ee;$e++){yt=Gt+$e<<2;var Ut=3*(on=V[Dt+($e>>3)]>>7-((7&$e)<<0)&1);j[yt]=Ot[Ut],j[yt+1]=Ot[Ut+1],j[yt+2]=Ot[Ut+2],j[yt+3]=on<Pt?Mt[on]:255}}if(Le==2)for(At=0;At<ce;At++)for(Dt=At*Te,Gt=At*ee,$e=0;$e<ee;$e++)yt=Gt+$e<<2,Ut=3*(on=V[Dt+($e>>2)]>>6-((3&$e)<<1)&3),j[yt]=Ot[Ut],j[yt+1]=Ot[Ut+1],j[yt+2]=Ot[Ut+2],j[yt+3]=on<Pt?Mt[on]:255;if(Le==4)for(At=0;At<ce;At++)for(Dt=At*Te,Gt=At*ee,$e=0;$e<ee;$e++)yt=Gt+$e<<2,Ut=3*(on=V[Dt+($e>>1)]>>4-((1&$e)<<2)&15),j[yt]=Ot[Ut],j[yt+1]=Ot[Ut+1],j[yt+2]=Ot[Ut+2],j[yt+3]=on<Pt?Mt[on]:255;if(Le==8)for($e=0;$e<de;$e++){var on;yt=$e<<2,Ut=3*(on=V[$e]),j[yt]=Ot[Ut],j[yt+1]=Ot[Ut+1],j[yt+2]=Ot[Ut+2],j[yt+3]=on<Pt?Mt[on]:255}}else if(Pe==4){if(Le==8)for($e=0;$e<de;$e++){yt=$e<<2;var Vt=V[An=$e<<1];j[yt]=Vt,j[yt+1]=Vt,j[yt+2]=Vt,j[yt+3]=V[An+1]}if(Le==16)for($e=0;$e<de;$e++){var An;yt=$e<<2,Vt=V[An=$e<<2],j[yt]=Vt,j[yt+1]=Vt,j[yt+2]=Vt,j[yt+3]=V[An+2]}}else if(Pe==0)for(Xe=_e.tabs.tRNS?_e.tabs.tRNS:-1,At=0;At<ce;At++){var _n=At*Te,Yn=At*ee;if(Le==1)for(var bn=0;bn<ee;bn++){var Ln=(Vt=255*(V[_n+(bn>>>3)]>>>7-(7&bn)&1))==255*Xe?0:255;Ce[Yn+bn]=Ln<<24|Vt<<16|Vt<<8|Vt}else if(Le==2)for(bn=0;bn<ee;bn++)Ln=(Vt=85*(V[_n+(bn>>>2)]>>>6-((3&bn)<<1)&3))==85*Xe?0:255,Ce[Yn+bn]=Ln<<24|Vt<<16|Vt<<8|Vt;else if(Le==4)for(bn=0;bn<ee;bn++)Ln=(Vt=17*(V[_n+(bn>>>1)]>>>4-((1&bn)<<2)&15))==17*Xe?0:255,Ce[Yn+bn]=Ln<<24|Vt<<16|Vt<<8|Vt;else if(Le==8)for(bn=0;bn<ee;bn++)Ln=(Vt=V[_n+bn])==Xe?0:255,Ce[Yn+bn]=Ln<<24|Vt<<16|Vt<<8|Vt;else if(Le==16)for(bn=0;bn<ee;bn++)Vt=V[_n+(bn<<1)],Ln=ze(V,_n+(bn<<$e))==Xe?0:255,Ce[Yn+bn]=Ln<<24|Vt<<16|Vt<<8|Vt}return j},UPNG.decode=function(V){for(var ee,ce=new Uint8Array(V),_e=8,de=UPNG._bin,xe=de.readUshort,Te=de.readUint,j={tabs:{},frames:[]},Ce=new Uint8Array(ce.length),Pe=0,Le=0,ze=[137,80,78,71,13,10,26,10],Be=0;Be<8;Be++)if(ce[Be]!=ze[Be])throw"The input is not a PNG file!";for(;_e<ce.length;){var $e=de.readUint(ce,_e);_e+=4;var Ve=de.readASCII(ce,_e,4);if(_e+=4,Ve=="IHDR")UPNG.decode._IHDR(ce,_e,j);else if(Ve=="CgBI")j.tabs[Ve]=ce.slice(_e,_e+4);else if(Ve=="IDAT"){for(Be=0;Be<$e;Be++)Ce[Pe+Be]=ce[_e+Be];Pe+=$e}else if(Ve=="acTL")j.tabs[Ve]={num_frames:Te(ce,_e),num_plays:Te(ce,_e+4)},ee=new Uint8Array(ce.length);else if(Ve=="fcTL"){var Ke;Le!=0&&((Ke=j.frames[j.frames.length-1]).data=UPNG.decode._decompress(j,ee.slice(0,Le),Ke.rect.width,Ke.rect.height),Le=0);var Xe={x:Te(ce,_e+12),y:Te(ce,_e+16),width:Te(ce,_e+4),height:Te(ce,_e+8)},It=xe(ce,_e+22);It=xe(ce,_e+20)/(It==0?100:It);var Ct={rect:Xe,delay:Math.round(1e3*It),dispose:ce[_e+24],blend:ce[_e+25]};j.frames.push(Ct)}else if(Ve=="fdAT"){for(Be=0;Be<$e-4;Be++)ee[Le+Be]=ce[_e+Be+4];Le+=$e-4}else if(Ve=="pHYs")j.tabs[Ve]=[de.readUint(ce,_e),de.readUint(ce,_e+4),ce[_e+8]];else if(Ve=="cHRM")for(j.tabs[Ve]=[],Be=0;Be<8;Be++)j.tabs[Ve].push(de.readUint(ce,_e+4*Be));else if(Ve=="tEXt"||Ve=="zTXt"){j.tabs[Ve]==null&&(j.tabs[Ve]={});var yt=de.nextZero(ce,_e),Ot=de.readASCII(ce,_e,yt-_e),Mt=_e+$e-yt-1;if(Ve=="tEXt")Dt=de.readASCII(ce,yt+1,Mt);else{var Pt=UPNG.decode._inflate(ce.slice(yt+2,yt+2+Mt));Dt=de.readUTF8(Pt,0,Pt.length)}j.tabs[Ve][Ot]=Dt}else if(Ve=="iTXt"){j.tabs[Ve]==null&&(j.tabs[Ve]={}),yt=0;var At=_e;yt=de.nextZero(ce,At),Ot=de.readASCII(ce,At,yt-At);var Dt,Gt=ce[At=yt+1];ce[At+1],At+=2,yt=de.nextZero(ce,At),de.readASCII(ce,At,yt-At),At=yt+1,yt=de.nextZero(ce,At),de.readUTF8(ce,At,yt-At),Mt=$e-((At=yt+1)-_e),Gt==0?Dt=de.readUTF8(ce,At,Mt):(Pt=UPNG.decode._inflate(ce.slice(At,At+Mt)),Dt=de.readUTF8(Pt,0,Pt.length)),j.tabs[Ve][Ot]=Dt}else if(Ve=="PLTE")j.tabs[Ve]=de.readBytes(ce,_e,$e);else if(Ve=="hIST"){var Ut=j.tabs.PLTE.length/3;for(j.tabs[Ve]=[],Be=0;Be<Ut;Be++)j.tabs[Ve].push(xe(ce,_e+2*Be))}else if(Ve=="tRNS")j.ctype==3?j.tabs[Ve]=de.readBytes(ce,_e,$e):j.ctype==0?j.tabs[Ve]=xe(ce,_e):j.ctype==2&&(j.tabs[Ve]=[xe(ce,_e),xe(ce,_e+2),xe(ce,_e+4)]);else if(Ve=="gAMA")j.tabs[Ve]=de.readUint(ce,_e)/1e5;else if(Ve=="sRGB")j.tabs[Ve]=ce[_e];else if(Ve=="bKGD")j.ctype==0||j.ctype==4?j.tabs[Ve]=[xe(ce,_e)]:j.ctype==2||j.ctype==6?j.tabs[Ve]=[xe(ce,_e),xe(ce,_e+2),xe(ce,_e+4)]:j.ctype==3&&(j.tabs[Ve]=ce[_e]);else if(Ve=="IEND")break;_e+=$e,de.readUint(ce,_e),_e+=4}return Le!=0&&((Ke=j.frames[j.frames.length-1]).data=UPNG.decode._decompress(j,ee.slice(0,Le),Ke.rect.width,Ke.rect.height),Le=0),j.data=UPNG.decode._decompress(j,Ce,j.width,j.height),delete j.compress,delete j.interlace,delete j.filter,j},UPNG.decode._decompress=function(V,ee,ce,_e){var de=UPNG.decode._getBPP(V),xe=Math.ceil(ce*de/8),Te=new Uint8Array((xe+1+V.interlace)*_e);return ee=V.tabs.CgBI?UPNG.inflateRaw(ee,Te):UPNG.decode._inflate(ee,Te),V.interlace==0?ee=UPNG.decode._filterZero(ee,V,0,ce,_e):V.interlace==1&&(ee=UPNG.decode._readInterlace(ee,V)),ee},UPNG.decode._inflate=function(V,ee){return UPNG.inflateRaw(new Uint8Array(V.buffer,2,V.length-6),ee)},UPNG.inflateRaw=(H={},H.H={},H.H.N=function(V,ee){var ce,_e,de=Uint8Array,xe=0,Te=0,j=0,Ce=0,Pe=0,Le=0,ze=0,Be=0,$e=0;if(V[0]==3&&V[1]==0)return ee||new de(0);var Ve=H.H,Ke=Ve.b,Xe=Ve.e,It=Ve.R,Ct=Ve.n,yt=Ve.A,Ot=Ve.Z,Mt=Ve.m,Pt=ee==null;for(Pt&&(ee=new de(V.length>>>2<<5));xe==0;)if(xe=Ke(V,$e,1),Te=Ke(V,$e+1,2),$e+=3,Te!=0){if(Pt&&(ee=H.H.W(ee,Be+(1<<17))),Te==1&&(ce=Mt.J,_e=Mt.h,Le=511,ze=31),Te==2){j=Xe(V,$e,5)+257,Ce=Xe(V,$e+5,5)+1,Pe=Xe(V,$e+10,4)+4,$e+=14;for(var At=1,Dt=0;Dt<38;Dt+=2)Mt.Q[Dt]=0,Mt.Q[Dt+1]=0;for(Dt=0;Dt<Pe;Dt++){var Gt=Xe(V,$e+3*Dt,3);Mt.Q[1+(Mt.X[Dt]<<1)]=Gt,Gt>At&&(At=Gt)}$e+=3*Pe,Ct(Mt.Q,At),yt(Mt.Q,At,Mt.u),ce=Mt.w,_e=Mt.d,$e=It(Mt.u,(1<<At)-1,j+Ce,V,$e,Mt.v);var Ut=Ve.V(Mt.v,0,j,Mt.C);Le=(1<<Ut)-1;var on=Ve.V(Mt.v,j,Ce,Mt.D);ze=(1<<on)-1,Ct(Mt.C,Ut),yt(Mt.C,Ut,ce),Ct(Mt.D,on),yt(Mt.D,on,_e)}for(;;){var Vt=ce[Ot(V,$e)&Le];$e+=15&Vt;var An=Vt>>>4;if(An>>>8==0)ee[Be++]=An;else{if(An==256)break;var _n=Be+An-254;if(An>264){var Yn=Mt.q[An-257];_n=Be+(Yn>>>3)+Xe(V,$e,7&Yn),$e+=7&Yn}var bn=_e[Ot(V,$e)&ze];$e+=15&bn;var Ln=bn>>>4,mn=Mt.c[Ln],Xn=(mn>>>4)+Ke(V,$e,15&mn);for($e+=15&mn;Be<_n;)ee[Be]=ee[Be++-Xn],ee[Be]=ee[Be++-Xn],ee[Be]=ee[Be++-Xn],ee[Be]=ee[Be++-Xn];Be=_n}}}else{(7&$e)!=0&&($e+=8-(7&$e));var sr=4+($e>>>3),Pr=V[sr-4]|V[sr-3]<<8;Pt&&(ee=H.H.W(ee,Be+Pr)),ee.set(new de(V.buffer,V.byteOffset+sr,Pr),Be),$e=sr+Pr<<3,Be+=Pr}return ee.length==Be?ee:ee.slice(0,Be)},H.H.W=function(V,ee){var ce=V.length;if(ee<=ce)return V;var _e=new Uint8Array(ce<<1);return _e.set(V,0),_e},H.H.R=function(V,ee,ce,_e,de,xe){for(var Te=H.H.e,j=H.H.Z,Ce=0;Ce<ce;){var Pe=V[j(_e,de)&ee];de+=15&Pe;var Le=Pe>>>4;if(Le<=15)xe[Ce]=Le,Ce++;else{var ze=0,Be=0;Le==16?(Be=3+Te(_e,de,2),de+=2,ze=xe[Ce-1]):Le==17?(Be=3+Te(_e,de,3),de+=3):Le==18&&(Be=11+Te(_e,de,7),de+=7);for(var $e=Ce+Be;Ce<$e;)xe[Ce]=ze,Ce++}}return de},H.H.V=function(V,ee,ce,_e){for(var de=0,xe=0,Te=_e.length>>>1;xe<ce;){var j=V[xe+ee];_e[xe<<1]=0,_e[1+(xe<<1)]=j,j>de&&(de=j),xe++}for(;xe<Te;)_e[xe<<1]=0,_e[1+(xe<<1)]=0,xe++;return de},H.H.n=function(V,ee){for(var ce,_e,de,xe,Te=H.H.m,j=V.length,Ce=Te.j,Pe=0;Pe<=ee;Pe++)Ce[Pe]=0;for(Pe=1;Pe<j;Pe+=2)Ce[V[Pe]]++;var Le=Te.K;for(ce=0,Ce[0]=0,_e=1;_e<=ee;_e++)ce=ce+Ce[_e-1]<<1,Le[_e]=ce;for(de=0;de<j;de+=2)(xe=V[de+1])!=0&&(V[de]=Le[xe],Le[xe]++)},H.H.A=function(V,ee,ce){for(var _e=V.length,de=H.H.m.r,xe=0;xe<_e;xe+=2)if(V[xe+1]!=0)for(var Te=xe>>1,j=V[xe+1],Ce=Te<<4|j,Pe=ee-j,Le=V[xe]<<Pe,ze=Le+(1<<Pe);Le!=ze;)ce[de[Le]>>>15-ee]=Ce,Le++},H.H.l=function(V,ee){for(var ce=H.H.m.r,_e=15-ee,de=0;de<V.length;de+=2){var xe=V[de]<<ee-V[de+1];V[de]=ce[xe]>>>_e}},H.H.M=function(V,ee,ce){ce<<=7&ee;var _e=ee>>>3;V[_e]|=ce,V[_e+1]|=ce>>>8},H.H.I=function(V,ee,ce){ce<<=7&ee;var _e=ee>>>3;V[_e]|=ce,V[_e+1]|=ce>>>8,V[_e+2]|=ce>>>16},H.H.e=function(V,ee,ce){return(V[ee>>>3]|V[1+(ee>>>3)]<<8)>>>(7&ee)&(1<<ce)-1},H.H.b=function(V,ee,ce){return(V[ee>>>3]|V[1+(ee>>>3)]<<8|V[2+(ee>>>3)]<<16)>>>(7&ee)&(1<<ce)-1},H.H.Z=function(V,ee){return(V[ee>>>3]|V[1+(ee>>>3)]<<8|V[2+(ee>>>3)]<<16)>>>(7&ee)},H.H.i=function(V,ee){return(V[ee>>>3]|V[1+(ee>>>3)]<<8|V[2+(ee>>>3)]<<16|V[3+(ee>>>3)]<<24)>>>(7&ee)},H.H.m=(N=Uint16Array,W=Uint32Array,{K:new N(16),j:new N(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new N(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new W(32),J:new N(512),_:[],h:new N(32),$:[],w:new N(32768),C:[],v:[],d:new N(32768),D:[],u:new N(512),Q:[],r:new N(32768),s:new W(286),Y:new W(30),a:new W(19),t:new W(15e3),k:new N(65536),g:new N(32768)}),function(){for(var V=H.H.m,ee=0;ee<32768;ee++){var ce=ee;ce=(4278255360&(ce=(4042322160&(ce=(3435973836&(ce=(2863311530&ce)>>>1|(1431655765&ce)<<1))>>>2|(858993459&ce)<<2))>>>4|(252645135&ce)<<4))>>>8|(16711935&ce)<<8,V.r[ee]=(ce>>>16|ce<<16)>>>17}function _e(de,xe,Te){for(;xe--!=0;)de.push(0,Te)}for(ee=0;ee<32;ee++)V.q[ee]=V.S[ee]<<3|V.T[ee],V.c[ee]=V.p[ee]<<4|V.z[ee];_e(V._,144,8),_e(V._,112,9),_e(V._,24,7),_e(V._,8,8),H.H.n(V._,9),H.H.A(V._,9,V.J),H.H.l(V._,9),_e(V.$,32,5),H.H.n(V.$,5),H.H.A(V.$,5,V.h),H.H.l(V.$,5),_e(V.Q,19,0),_e(V.C,286,0),_e(V.D,30,0),_e(V.v,320,0)}(),H.H.N),UPNG.decode._readInterlace=function(V,ee){for(var ce=ee.width,_e=ee.height,de=UPNG.decode._getBPP(ee),xe=de>>3,Te=Math.ceil(ce*de/8),j=new Uint8Array(_e*Te),Ce=0,Pe=[0,0,4,0,2,0,1],Le=[0,4,0,2,0,1,0],ze=[8,8,8,4,4,2,2],Be=[8,8,4,4,2,2,1],$e=0;$e<7;){for(var Ve=ze[$e],Ke=Be[$e],Xe=0,It=0,Ct=Pe[$e];Ct<_e;)Ct+=Ve,It++;for(var yt=Le[$e];yt<ce;)yt+=Ke,Xe++;var Ot=Math.ceil(Xe*de/8);UPNG.decode._filterZero(V,ee,Ce,Xe,It);for(var Mt=0,Pt=Pe[$e];Pt<_e;){for(var At=Le[$e],Dt=Ce+Mt*Ot<<3;At<ce;){var Gt;if(de==1&&(Gt=(Gt=V[Dt>>3])>>7-(7&Dt)&1,j[Pt*Te+(At>>3)]|=Gt<<7-((7&At)<<0)),de==2&&(Gt=(Gt=V[Dt>>3])>>6-(7&Dt)&3,j[Pt*Te+(At>>2)]|=Gt<<6-((3&At)<<1)),de==4&&(Gt=(Gt=V[Dt>>3])>>4-(7&Dt)&15,j[Pt*Te+(At>>1)]|=Gt<<4-((1&At)<<2)),de>=8)for(var Ut=Pt*Te+At*xe,on=0;on<xe;on++)j[Ut+on]=V[(Dt>>3)+on];Dt+=de,At+=Ke}Mt++,Pt+=Ve}Xe*It!=0&&(Ce+=It*(1+Ot)),$e+=1}return j},UPNG.decode._getBPP=function(V){return[1,null,3,1,2,null,4][V.ctype]*V.depth},UPNG.decode._filterZero=function(V,ee,ce,_e,de){var xe=UPNG.decode._getBPP(ee),Te=Math.ceil(_e*xe/8),j=UPNG.decode._paeth;xe=Math.ceil(xe/8);var Ce=0,Pe=1,Le=V[ce],ze=0;if(Le>1&&(V[ce]=[0,0,1][Le-2]),Le==3)for(ze=xe;ze<Te;ze++)V[ze+1]=V[ze+1]+(V[ze+1-xe]>>>1)&255;for(var Be=0;Be<de;Be++)if(ze=0,(Le=V[(Pe=(Ce=ce+Be*Te)+Be+1)-1])==0)for(;ze<Te;ze++)V[Ce+ze]=V[Pe+ze];else if(Le==1){for(;ze<xe;ze++)V[Ce+ze]=V[Pe+ze];for(;ze<Te;ze++)V[Ce+ze]=V[Pe+ze]+V[Ce+ze-xe]}else if(Le==2)for(;ze<Te;ze++)V[Ce+ze]=V[Pe+ze]+V[Ce+ze-Te];else if(Le==3){for(;ze<xe;ze++)V[Ce+ze]=V[Pe+ze]+(V[Ce+ze-Te]>>>1);for(;ze<Te;ze++)V[Ce+ze]=V[Pe+ze]+(V[Ce+ze-Te]+V[Ce+ze-xe]>>>1)}else{for(;ze<xe;ze++)V[Ce+ze]=V[Pe+ze]+j(0,V[Ce+ze-Te],0);for(;ze<Te;ze++)V[Ce+ze]=V[Pe+ze]+j(V[Ce+ze-xe],V[Ce+ze-Te],V[Ce+ze-xe-Te])}return V},UPNG.decode._paeth=function(V,ee,ce){var _e=V+ee-ce,de=_e-V,xe=_e-ee,Te=_e-ce;return de*de<=xe*xe&&de*de<=Te*Te?V:xe*xe<=Te*Te?ee:ce},UPNG.decode._IHDR=function(V,ee,ce){var _e=UPNG._bin;ce.width=_e.readUint(V,ee),ee+=4,ce.height=_e.readUint(V,ee),ee+=4,ce.depth=V[ee],ee++,ce.ctype=V[ee],ee++,ce.compress=V[ee],ee++,ce.filter=V[ee],ee++,ce.interlace=V[ee],ee++},UPNG._bin={nextZero:function(ee,ce){for(;ee[ce]!=0;)ce++;return ce},readUshort:function(ee,ce){return ee[ce]<<8|ee[ce+1]},writeUshort:function(ee,ce,_e){ee[ce]=_e>>8&255,ee[ce+1]=255&_e},readUint:function(ee,ce){return 16777216*ee[ce]+(ee[ce+1]<<16|ee[ce+2]<<8|ee[ce+3])},writeUint:function(ee,ce,_e){ee[ce]=_e>>24&255,ee[ce+1]=_e>>16&255,ee[ce+2]=_e>>8&255,ee[ce+3]=255&_e},readASCII:function(ee,ce,_e){for(var de="",xe=0;xe<_e;xe++)de+=String.fromCharCode(ee[ce+xe]);return de},writeASCII:function(ee,ce,_e){for(var de=0;de<_e.length;de++)ee[ce+de]=_e.charCodeAt(de)},readBytes:function(ee,ce,_e){for(var de=[],xe=0;xe<_e;xe++)de.push(ee[ce+xe]);return de},pad:function(ee){return ee.length<2?"0".concat(ee):ee},readUTF8:function(ee,ce,_e){for(var de,xe="",Te=0;Te<_e;Te++)xe+="%".concat(UPNG._bin.pad(ee[ce+Te].toString(16)));try{de=decodeURIComponent(xe)}catch{return UPNG._bin.readASCII(ee,ce,_e)}return de}},UPNG._copyTile=function(V,ee,ce,_e,de,xe,Te,j,Ce){for(var Pe=Math.min(ee,de),Le=Math.min(ce,xe),ze=0,Be=0,$e=0;$e<Le;$e++)for(var Ve=0;Ve<Pe;Ve++)if(Te>=0&&j>=0?(ze=$e*ee+Ve<<2,Be=(j+$e)*de+Te+Ve<<2):(ze=(-j+$e)*ee-Te+Ve<<2,Be=$e*de+Ve<<2),Ce==0)_e[Be]=V[ze],_e[Be+1]=V[ze+1],_e[Be+2]=V[ze+2],_e[Be+3]=V[ze+3];else if(Ce==1){var Ke=V[ze+3]*.00392156862745098,Xe=V[ze]*Ke,It=V[ze+1]*Ke,Ct=V[ze+2]*Ke,yt=_e[Be+3]*(1/255),Ot=_e[Be]*yt,Mt=_e[Be+1]*yt,Pt=_e[Be+2]*yt,At=1-Ke,Dt=Ke+yt*At,Gt=Dt==0?0:1/Dt;_e[Be+3]=255*Dt,_e[Be+0]=(Xe+Ot*At)*Gt,_e[Be+1]=(It+Mt*At)*Gt,_e[Be+2]=(Ct+Pt*At)*Gt}else if(Ce==2)Ke=V[ze+3],Xe=V[ze],It=V[ze+1],Ct=V[ze+2],yt=_e[Be+3],Ot=_e[Be],Mt=_e[Be+1],Pt=_e[Be+2],Ke==yt&&Xe==Ot&&It==Mt&&Ct==Pt?(_e[Be]=0,_e[Be+1]=0,_e[Be+2]=0,_e[Be+3]=0):(_e[Be]=Xe,_e[Be+1]=It,_e[Be+2]=Ct,_e[Be+3]=Ke);else if(Ce==3){if(Ke=V[ze+3],Xe=V[ze],It=V[ze+1],Ct=V[ze+2],yt=_e[Be+3],Ot=_e[Be],Mt=_e[Be+1],Pt=_e[Be+2],Ke==yt&&Xe==Ot&&It==Mt&&Ct==Pt)continue;if(Ke<220&&yt>20)return!1}return!0},UPNG.encode=function(V,ee,ce,_e,de,xe,Te){_e==null&&(_e=0),Te==null&&(Te=!1);var j=UPNG.encode.compress(V,ee,ce,_e,[!1,!1,!1,0,Te]);return UPNG.encode.compressPNG(j,-1),UPNG.encode._main(j,ee,ce,de,xe)},UPNG.encodeLL=function(V,ee,ce,_e,de,xe,Te,j){for(var Ce={ctype:0+(_e==1?0:2)+(de==0?0:4),depth:xe,frames:[]},Pe=(_e+de)*xe,Le=Pe*ee,ze=0;ze<V.length;ze++)Ce.frames.push({rect:{x:0,y:0,width:ee,height:ce},img:new Uint8Array(V[ze]),blend:0,dispose:1,bpp:Math.ceil(Pe/8),bpl:Math.ceil(Le/8)});return UPNG.encode.compressPNG(Ce,0,!0),UPNG.encode._main(Ce,ee,ce,Te,j)},UPNG.encode._main=function(V,ee,ce,_e,de){de==null&&(de={});var xe=UPNG.crc.crc,Te=UPNG._bin.writeUint,j=UPNG._bin.writeUshort,Ce=UPNG._bin.writeASCII,Pe=8,Le=V.frames.length>1,ze=!1,Be=33+(Le?20:0);if(de.sRGB!=null&&(Be+=13),de.pHYs!=null&&(Be+=21),V.ctype==3){for(var $e=V.plte.length,Ve=0;Ve<$e;Ve++)V.plte[Ve]>>>24!=255&&(ze=!0);Be+=8+3*$e+4+(ze?8+1*$e+4:0)}for(var Ke=0;Ke<V.frames.length;Ke++)Le&&(Be+=38),Be+=(Dt=V.frames[Ke]).cimg.length+12,Ke!=0&&(Be+=4);Be+=12;var Xe=new Uint8Array(Be),It=[137,80,78,71,13,10,26,10];for(Ve=0;Ve<8;Ve++)Xe[Ve]=It[Ve];if(Te(Xe,Pe,13),Ce(Xe,Pe+=4,"IHDR"),Te(Xe,Pe+=4,ee),Te(Xe,Pe+=4,ce),Xe[Pe+=4]=V.depth,Xe[++Pe]=V.ctype,Xe[++Pe]=0,Xe[++Pe]=0,Xe[++Pe]=0,Te(Xe,++Pe,xe(Xe,Pe-17,17)),Pe+=4,de.sRGB!=null&&(Te(Xe,Pe,1),Ce(Xe,Pe+=4,"sRGB"),Xe[Pe+=4]=de.sRGB,Te(Xe,++Pe,xe(Xe,Pe-5,5)),Pe+=4),de.pHYs!=null&&(Te(Xe,Pe,9),Ce(Xe,Pe+=4,"pHYs"),Te(Xe,Pe+=4,de.pHYs[0]),Te(Xe,Pe+=4,de.pHYs[1]),Xe[Pe+=4]=de.pHYs[2],Te(Xe,++Pe,xe(Xe,Pe-13,13)),Pe+=4),Le&&(Te(Xe,Pe,8),Ce(Xe,Pe+=4,"acTL"),Te(Xe,Pe+=4,V.frames.length),Te(Xe,Pe+=4,de.loop!=null?de.loop:0),Te(Xe,Pe+=4,xe(Xe,Pe-12,12)),Pe+=4),V.ctype==3){for(Te(Xe,Pe,3*($e=V.plte.length)),Ce(Xe,Pe+=4,"PLTE"),Pe+=4,Ve=0;Ve<$e;Ve++){var Ct=3*Ve,yt=V.plte[Ve],Ot=255&yt,Mt=yt>>>8&255,Pt=yt>>>16&255;Xe[Pe+Ct+0]=Ot,Xe[Pe+Ct+1]=Mt,Xe[Pe+Ct+2]=Pt}if(Te(Xe,Pe+=3*$e,xe(Xe,Pe-3*$e-4,3*$e+4)),Pe+=4,ze){for(Te(Xe,Pe,$e),Ce(Xe,Pe+=4,"tRNS"),Pe+=4,Ve=0;Ve<$e;Ve++)Xe[Pe+Ve]=V.plte[Ve]>>>24&255;Te(Xe,Pe+=$e,xe(Xe,Pe-$e-4,$e+4)),Pe+=4}}var At=0;for(Ke=0;Ke<V.frames.length;Ke++){var Dt=V.frames[Ke];Le&&(Te(Xe,Pe,26),Ce(Xe,Pe+=4,"fcTL"),Te(Xe,Pe+=4,At++),Te(Xe,Pe+=4,Dt.rect.width),Te(Xe,Pe+=4,Dt.rect.height),Te(Xe,Pe+=4,Dt.rect.x),Te(Xe,Pe+=4,Dt.rect.y),j(Xe,Pe+=4,_e[Ke]),j(Xe,Pe+=2,1e3),Xe[Pe+=2]=Dt.dispose,Xe[++Pe]=Dt.blend,Te(Xe,++Pe,xe(Xe,Pe-30,30)),Pe+=4);var Gt=Dt.cimg;Te(Xe,Pe,($e=Gt.length)+(Ke==0?0:4));var Ut=Pe+=4;Ce(Xe,Pe,Ke==0?"IDAT":"fdAT"),Pe+=4,Ke!=0&&(Te(Xe,Pe,At++),Pe+=4),Xe.set(Gt,Pe),Te(Xe,Pe+=$e,xe(Xe,Ut,Pe-Ut)),Pe+=4}return Te(Xe,Pe,0),Ce(Xe,Pe+=4,"IEND"),Te(Xe,Pe+=4,xe(Xe,Pe-4,4)),Pe+=4,Xe.buffer},UPNG.encode.compressPNG=function(V,ee,ce){for(var _e=0;_e<V.frames.length;_e++){var de=V.frames[_e];de.rect.width;var xe=de.rect.height,Te=new Uint8Array(xe*de.bpl+xe);de.cimg=UPNG.encode._filterZero(de.img,xe,de.bpp,de.bpl,Te,ee,ce)}},UPNG.encode.compress=function(V,ee,ce,_e,de){for(var xe=de[0],Te=de[1],j=de[2],Ce=de[3],Pe=de[4],Le=6,ze=8,Be=255,$e=0;$e<V.length;$e++)for(var Ve=new Uint8Array(V[$e]),Ke=Ve.length,Xe=0;Xe<Ke;Xe+=4)Be&=Ve[Xe+3];var It=Be!=255,Ct=UPNG.encode.framize(V,ee,ce,xe,Te,j),yt={},Ot=[],Mt=[];if(_e!=0){var Pt=[];for(Xe=0;Xe<Ct.length;Xe++)Pt.push(Ct[Xe].img.buffer);var At=UPNG.encode.concatRGBA(Pt),Dt=UPNG.quantize(At,_e),Gt=0,Ut=new Uint8Array(Dt.abuf);for(Xe=0;Xe<Ct.length;Xe++){var on=(dr=Ct[Xe].img).length;for(Mt.push(new Uint8Array(Dt.inds.buffer,Gt>>2,on>>2)),$e=0;$e<on;$e+=4)dr[$e]=Ut[Gt+$e],dr[$e+1]=Ut[Gt+$e+1],dr[$e+2]=Ut[Gt+$e+2],dr[$e+3]=Ut[Gt+$e+3];Gt+=on}for(Xe=0;Xe<Dt.plte.length;Xe++)Ot.push(Dt.plte[Xe].est.rgba)}else for($e=0;$e<Ct.length;$e++){var Vt=Ct[$e],An=new Uint32Array(Vt.img.buffer),_n=Vt.rect.width,Yn=(Ke=An.length,new Uint8Array(Ke));for(Mt.push(Yn),Xe=0;Xe<Ke;Xe++){var bn=An[Xe];if(Xe!=0&&bn==An[Xe-1])Yn[Xe]=Yn[Xe-1];else if(Xe>_n&&bn==An[Xe-_n])Yn[Xe]=Yn[Xe-_n];else{var Ln=yt[bn];if(Ln==null&&(yt[bn]=Ln=Ot.length,Ot.push(bn),Ot.length>=300))break;Yn[Xe]=Ln}}}var mn=Ot.length;for(mn<=256&&Pe==0&&(ze=mn<=2?1:mn<=4?2:mn<=16?4:8,ze=Math.max(ze,Ce)),$e=0;$e<Ct.length;$e++){(Vt=Ct[$e]).rect.x,Vt.rect.y,_n=Vt.rect.width;var Xn=Vt.rect.height,sr=Vt.img;new Uint32Array(sr.buffer);var Pr=4*_n,er=4;if(mn<=256&&Pe==0){Pr=Math.ceil(ze*_n/8);for(var rr=new Uint8Array(Pr*Xn),Vr=Mt[$e],Wt=0;Wt<Xn;Wt++){Xe=Wt*Pr;var Rn=Wt*_n;if(ze==8)for(var ln=0;ln<_n;ln++)rr[Xe+ln]=Vr[Rn+ln];else if(ze==4)for(ln=0;ln<_n;ln++)rr[Xe+(ln>>1)]|=Vr[Rn+ln]<<4-4*(1&ln);else if(ze==2)for(ln=0;ln<_n;ln++)rr[Xe+(ln>>2)]|=Vr[Rn+ln]<<6-2*(3&ln);else if(ze==1)for(ln=0;ln<_n;ln++)rr[Xe+(ln>>3)]|=Vr[Rn+ln]<<7-1*(7&ln)}sr=rr,Le=3,er=1}else if(It==0&&Ct.length==1){rr=new Uint8Array(_n*Xn*3);var Un=_n*Xn;for(Xe=0;Xe<Un;Xe++){var dr,_r=4*Xe;rr[dr=3*Xe]=sr[_r],rr[dr+1]=sr[_r+1],rr[dr+2]=sr[_r+2]}sr=rr,Le=2,er=3,Pr=3*_n}Vt.img=sr,Vt.bpl=Pr,Vt.bpp=er}return{ctype:Le,depth:ze,plte:Ot,frames:Ct}},UPNG.encode.framize=function(V,ee,ce,_e,de,xe){for(var Te=[],j=0;j<V.length;j++){var Ce,Pe=new Uint8Array(V[j]),Le=new Uint32Array(Pe.buffer),ze=0,Be=0,$e=ee,Ve=ce,Ke=_e?1:0;if(j!=0){for(var Xe=xe||_e||j==1||Te[j-2].dispose!=0?1:2,It=0,Ct=1e9,yt=0;yt<Xe;yt++){for(var Ot=new Uint8Array(V[j-1-yt]),Mt=new Uint32Array(V[j-1-yt]),Pt=ee,At=ce,Dt=-1,Gt=-1,Ut=0;Ut<ce;Ut++)for(var on=0;on<ee;on++)Le[mn=Ut*ee+on]!=Mt[mn]&&(on<Pt&&(Pt=on),on>Dt&&(Dt=on),Ut<At&&(At=Ut),Ut>Gt&&(Gt=Ut));Dt==-1&&(Pt=At=Dt=Gt=0),de&&((1&Pt)==1&&Pt--,(1&At)==1&&At--);var Vt=(Dt-Pt+1)*(Gt-At+1);Vt<Ct&&(Ct=Vt,It=yt,ze=Pt,Be=At,$e=Dt-Pt+1,Ve=Gt-At+1)}Ot=new Uint8Array(V[j-1-It]),It==1&&(Te[j-1].dispose=2),Ce=new Uint8Array($e*Ve*4),UPNG._copyTile(Ot,ee,ce,Ce,$e,Ve,-ze,-Be,0),(Ke=UPNG._copyTile(Pe,ee,ce,Ce,$e,Ve,-ze,-Be,3)?1:0)==1?UPNG.encode._prepareDiff(Pe,ee,ce,Ce,{x:ze,y:Be,width:$e,height:Ve}):UPNG._copyTile(Pe,ee,ce,Ce,$e,Ve,-ze,-Be,0)}else Ce=Pe.slice(0);Te.push({rect:{x:ze,y:Be,width:$e,height:Ve},img:Ce,blend:Ke,dispose:0})}if(_e){for(j=0;j<Te.length;j++)if((Xn=Te[j]).blend!=1){var An=Xn.rect,_n=Te[j-1].rect,Yn=Math.min(An.x,_n.x),bn=Math.min(An.y,_n.y),Ln={x:Yn,y:bn,width:Math.max(An.x+An.width,_n.x+_n.width)-Yn,height:Math.max(An.y+An.height,_n.y+_n.height)-bn};Te[j-1].dispose=1,j-1!=0&&UPNG.encode._updateFrame(V,ee,ce,Te,j-1,Ln,de),UPNG.encode._updateFrame(V,ee,ce,Te,j,Ln,de)}}if(V.length!=1)for(var mn=0;mn<Te.length;mn++){var Xn;(Xn=Te[mn]).rect.width*Xn.rect.height}return Te},UPNG.encode._updateFrame=function(V,ee,ce,_e,de,xe,Te){for(var j=Uint8Array,Ce=Uint32Array,Pe=new j(V[de-1]),Le=new Ce(V[de-1]),ze=de+1<V.length?new j(V[de+1]):null,Be=new j(V[de]),$e=new Ce(Be.buffer),Ve=ee,Ke=ce,Xe=-1,It=-1,Ct=0;Ct<xe.height;Ct++)for(var yt=0;yt<xe.width;yt++){var Ot=xe.x+yt,Mt=xe.y+Ct,Pt=Mt*ee+Ot,At=$e[Pt];At==0||_e[de-1].dispose==0&&Le[Pt]==At&&(ze==null||ze[4*Pt+3]!=0)||(Ot<Ve&&(Ve=Ot),Ot>Xe&&(Xe=Ot),Mt<Ke&&(Ke=Mt),Mt>It&&(It=Mt))}Xe==-1&&(Ve=Ke=Xe=It=0),Te&&((1&Ve)==1&&Ve--,(1&Ke)==1&&Ke--),xe={x:Ve,y:Ke,width:Xe-Ve+1,height:It-Ke+1};var Dt=_e[de];Dt.rect=xe,Dt.blend=1,Dt.img=new Uint8Array(xe.width*xe.height*4),_e[de-1].dispose==0?(UPNG._copyTile(Pe,ee,ce,Dt.img,xe.width,xe.height,-xe.x,-xe.y,0),UPNG.encode._prepareDiff(Be,ee,ce,Dt.img,xe)):UPNG._copyTile(Be,ee,ce,Dt.img,xe.width,xe.height,-xe.x,-xe.y,0)},UPNG.encode._prepareDiff=function(V,ee,ce,_e,de){UPNG._copyTile(V,ee,ce,_e,de.width,de.height,-de.x,-de.y,2)},UPNG.encode._filterZero=function(V,ee,ce,_e,de,xe,Te){var j,Ce=[],Pe=[0,1,2,3,4];xe!=-1?Pe=[xe]:(ee*_e>5e5||ce==1)&&(Pe=[0]),Te&&(j={level:0});for(var Le,ze=UZIP,Be=0;Be<Pe.length;Be++){for(var $e=0;$e<ee;$e++)UPNG.encode._filterLine(de,V,$e,_e,ce,Pe[Be]);Ce.push(ze.deflate(de,j))}var Ve=1e9;for(Be=0;Be<Ce.length;Be++)Ce[Be].length<Ve&&(Le=Be,Ve=Ce[Be].length);return Ce[Le]},UPNG.encode._filterLine=function(V,ee,ce,_e,de,xe){var Te=ce*_e,j=Te+ce,Ce=UPNG.decode._paeth;if(V[j]=xe,j++,xe==0)if(_e<500)for(var Pe=0;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe];else V.set(new Uint8Array(ee.buffer,Te,_e),j);else if(xe==1){for(Pe=0;Pe<de;Pe++)V[j+Pe]=ee[Te+Pe];for(Pe=de;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe]-ee[Te+Pe-de]+256&255}else if(ce==0){for(Pe=0;Pe<de;Pe++)V[j+Pe]=ee[Te+Pe];if(xe==2)for(Pe=de;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe];if(xe==3)for(Pe=de;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe]-(ee[Te+Pe-de]>>1)+256&255;if(xe==4)for(Pe=de;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe]-Ce(ee[Te+Pe-de],0,0)+256&255}else{if(xe==2)for(Pe=0;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe]+256-ee[Te+Pe-_e]&255;if(xe==3){for(Pe=0;Pe<de;Pe++)V[j+Pe]=ee[Te+Pe]+256-(ee[Te+Pe-_e]>>1)&255;for(Pe=de;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe]+256-(ee[Te+Pe-_e]+ee[Te+Pe-de]>>1)&255}if(xe==4){for(Pe=0;Pe<de;Pe++)V[j+Pe]=ee[Te+Pe]+256-Ce(0,ee[Te+Pe-_e],0)&255;for(Pe=de;Pe<_e;Pe++)V[j+Pe]=ee[Te+Pe]+256-Ce(ee[Te+Pe-de],ee[Te+Pe-_e],ee[Te+Pe-de-_e])&255}}},UPNG.crc={table:function(){for(var V=new Uint32Array(256),ee=0;ee<256;ee++){for(var ce=ee,_e=0;_e<8;_e++)1&ce?ce=3988292384^ce>>>1:ce>>>=1;V[ee]=ce}return V}(),update:function(ee,ce,_e,de){for(var xe=0;xe<de;xe++)ee=UPNG.crc.table[255&(ee^ce[_e+xe])]^ee>>>8;return ee},crc:function(ee,ce,_e){return 4294967295^UPNG.crc.update(4294967295,ee,ce,_e)}},UPNG.quantize=function(V,ee){var ce,_e=new Uint8Array(V),de=_e.slice(0),xe=new Uint32Array(de.buffer),Te=UPNG.quantize.getKDtree(de,ee),j=Te[0],Ce=Te[1],Pe=UPNG.quantize.planeDst,Le=_e,ze=xe,Be=Le.length,$e=new Uint8Array(_e.length>>2);if(_e.length<2e7)for(var Ve=0;Ve<Be;Ve+=4){var Ke=Le[Ve]*.00392156862745098,Xe=Le[Ve+1]*(1/255),It=Le[Ve+2]*(1/255),Ct=Le[Ve+3]*(1/255);ce=UPNG.quantize.getNearest(j,Ke,Xe,It,Ct),$e[Ve>>2]=ce.ind,ze[Ve>>2]=ce.est.rgba}else for(Ve=0;Ve<Be;Ve+=4){for(Ke=Le[Ve]*(1/255),Xe=Le[Ve+1]*(1/255),It=Le[Ve+2]*(1/255),Ct=Le[Ve+3]*(1/255),ce=j;ce.left;)ce=Pe(ce.est,Ke,Xe,It,Ct)<=0?ce.left:ce.right;$e[Ve>>2]=ce.ind,ze[Ve>>2]=ce.est.rgba}return{abuf:de.buffer,inds:$e,plte:Ce}},UPNG.quantize.getKDtree=function(V,ee,ce){ce==null&&(ce=1e-4);var _e=new Uint32Array(V.buffer),de={i0:0,i1:V.length,bst:null,est:null,tdst:0,left:null,right:null};de.bst=UPNG.quantize.stats(V,de.i0,de.i1),de.est=UPNG.quantize.estats(de.bst);for(var xe=[de];xe.length<ee;){for(var Te=0,j=0,Ce=0;Ce<xe.length;Ce++)xe[Ce].est.L>Te&&(Te=xe[Ce].est.L,j=Ce);if(Te<ce)break;var Pe=xe[j],Le=UPNG.quantize.splitPixels(V,_e,Pe.i0,Pe.i1,Pe.est.e,Pe.est.eMq255);if(Pe.i0>=Le||Pe.i1<=Le)Pe.est.L=0;else{var ze={i0:Pe.i0,i1:Le,bst:null,est:null,tdst:0,left:null,right:null};ze.bst=UPNG.quantize.stats(V,ze.i0,ze.i1),ze.est=UPNG.quantize.estats(ze.bst);var Be={i0:Le,i1:Pe.i1,bst:null,est:null,tdst:0,left:null,right:null};for(Be.bst={R:[],m:[],N:Pe.bst.N-ze.bst.N},Ce=0;Ce<16;Ce++)Be.bst.R[Ce]=Pe.bst.R[Ce]-ze.bst.R[Ce];for(Ce=0;Ce<4;Ce++)Be.bst.m[Ce]=Pe.bst.m[Ce]-ze.bst.m[Ce];Be.est=UPNG.quantize.estats(Be.bst),Pe.left=ze,Pe.right=Be,xe[j]=ze,xe.push(Be)}}for(xe.sort(function($e,Ve){return Ve.bst.N-$e.bst.N}),Ce=0;Ce<xe.length;Ce++)xe[Ce].ind=Ce;return[de,xe]},UPNG.quantize.getNearest=function(V,ee,ce,_e,de){if(V.left==null)return V.tdst=UPNG.quantize.dist(V.est.q,ee,ce,_e,de),V;var xe=UPNG.quantize.planeDst(V.est,ee,ce,_e,de),Te=V.left,j=V.right;xe>0&&(Te=V.right,j=V.left);var Ce=UPNG.quantize.getNearest(Te,ee,ce,_e,de);if(Ce.tdst<=xe*xe)return Ce;var Pe=UPNG.quantize.getNearest(j,ee,ce,_e,de);return Pe.tdst<Ce.tdst?Pe:Ce},UPNG.quantize.planeDst=function(V,ee,ce,_e,de){var xe=V.e;return xe[0]*ee+xe[1]*ce+xe[2]*_e+xe[3]*de-V.eMq},UPNG.quantize.dist=function(V,ee,ce,_e,de){var xe=ee-V[0],Te=ce-V[1],j=_e-V[2],Ce=de-V[3];return xe*xe+Te*Te+j*j+Ce*Ce},UPNG.quantize.splitPixels=function(V,ee,ce,_e,de,xe){var Te=UPNG.quantize.vecDot;for(_e-=4;ce<_e;){for(;Te(V,ce,de)<=xe;)ce+=4;for(;Te(V,_e,de)>xe;)_e-=4;if(ce>=_e)break;var j=ee[ce>>2];ee[ce>>2]=ee[_e>>2],ee[_e>>2]=j,ce+=4,_e-=4}for(;Te(V,ce,de)>xe;)ce-=4;return ce+4},UPNG.quantize.vecDot=function(V,ee,ce){return V[ee]*ce[0]+V[ee+1]*ce[1]+V[ee+2]*ce[2]+V[ee+3]*ce[3]},UPNG.quantize.stats=function(V,ee,ce){for(var _e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],de=[0,0,0,0],xe=ce-ee>>2,Te=ee;Te<ce;Te+=4){var j=V[Te]*.00392156862745098,Ce=V[Te+1]*(1/255),Pe=V[Te+2]*(1/255),Le=V[Te+3]*(1/255);de[0]+=j,de[1]+=Ce,de[2]+=Pe,de[3]+=Le,_e[0]+=j*j,_e[1]+=j*Ce,_e[2]+=j*Pe,_e[3]+=j*Le,_e[5]+=Ce*Ce,_e[6]+=Ce*Pe,_e[7]+=Ce*Le,_e[10]+=Pe*Pe,_e[11]+=Pe*Le,_e[15]+=Le*Le}return _e[4]=_e[1],_e[8]=_e[2],_e[9]=_e[6],_e[12]=_e[3],_e[13]=_e[7],_e[14]=_e[11],{R:_e,m:de,N:xe}},UPNG.quantize.estats=function(V){var ee=V.R,ce=V.m,_e=V.N,de=ce[0],xe=ce[1],Te=ce[2],j=ce[3],Ce=_e==0?0:1/_e,Pe=[ee[0]-de*de*Ce,ee[1]-de*xe*Ce,ee[2]-de*Te*Ce,ee[3]-de*j*Ce,ee[4]-xe*de*Ce,ee[5]-xe*xe*Ce,ee[6]-xe*Te*Ce,ee[7]-xe*j*Ce,ee[8]-Te*de*Ce,ee[9]-Te*xe*Ce,ee[10]-Te*Te*Ce,ee[11]-Te*j*Ce,ee[12]-j*de*Ce,ee[13]-j*xe*Ce,ee[14]-j*Te*Ce,ee[15]-j*j*Ce],Le=Pe,ze=UPNG.M4,Be=[Math.random(),Math.random(),Math.random(),Math.random()],$e=0,Ve=0;if(_e!=0)for(var Ke=0;Ke<16&&(Be=ze.multVec(Le,Be),Ve=Math.sqrt(ze.dot(Be,Be)),Be=ze.sml(1/Ve,Be),!(Ke!=0&&Math.abs(Ve-$e)<1e-9));Ke++)$e=Ve;var Xe=[de*Ce,xe*Ce,Te*Ce,j*Ce];return{Cov:Pe,q:Xe,e:Be,L:$e,eMq255:ze.dot(ze.sml(255,Xe),Be),eMq:ze.dot(Be,Xe),rgba:(Math.round(255*Xe[3])<<24|Math.round(255*Xe[2])<<16|Math.round(255*Xe[1])<<8|Math.round(255*Xe[0])<<0)>>>0}},UPNG.M4={multVec:function(ee,ce){return[ee[0]*ce[0]+ee[1]*ce[1]+ee[2]*ce[2]+ee[3]*ce[3],ee[4]*ce[0]+ee[5]*ce[1]+ee[6]*ce[2]+ee[7]*ce[3],ee[8]*ce[0]+ee[9]*ce[1]+ee[10]*ce[2]+ee[11]*ce[3],ee[12]*ce[0]+ee[13]*ce[1]+ee[14]*ce[2]+ee[15]*ce[3]]},dot:function(ee,ce){return ee[0]*ce[0]+ee[1]*ce[1]+ee[2]*ce[2]+ee[3]*ce[3]},sml:function(ee,ce){return[ee*ce[0],ee*ce[1],ee*ce[2],ee*ce[3]]}},UPNG.encode.concatRGBA=function(V){for(var ee=0,ce=0;ce<V.length;ce++)ee+=V[ce].byteLength;var _e=new Uint8Array(ee),de=0;for(ce=0;ce<V.length;ce++){for(var xe=new Uint8Array(V[ce]),Te=xe.length,j=0;j<Te;j+=4){var Ce=xe[j],Pe=xe[j+1],Le=xe[j+2],ze=xe[j+3];ze==0&&(Ce=Pe=Le=0),_e[de+j]=Ce,_e[de+j+1]=Pe,_e[de+j+2]=Le,_e[de+j+3]=ze}de+=Te}return _e.buffer};var BROWSER_NAME={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",MOBILE_SAFARI:"MOBILE_SAFARI",ETC:"ETC"},_BROWSER_NAME$CHROME$,MAX_CANVAS_SIZE=(_BROWSER_NAME$CHROME$={},_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.CHROME,16384),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.FIREFOX,11180),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.DESKTOP_SAFARI,16384),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.IE,8192),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.MOBILE_SAFARI,4096),_defineProperty(_BROWSER_NAME$CHROME$,BROWSER_NAME.ETC,8192),_BROWSER_NAME$CHROME$),isBrowser=typeof window!="undefined",moduleMapper=isBrowser&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),CustomFile=isBrowser&&(moduleMapper&&moduleMapper.getOriginalSymbol(window,"File")||window.File!==void 0&&File),CustomFileReader=isBrowser&&(moduleMapper&&moduleMapper.getOriginalSymbol(window,"FileReader")||window.FileReader!==void 0&&FileReader);function getFilefromDataUrl(V,ee){var ce=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Date.now();return new Promise(function(_e){for(var de=V.split(","),xe=de[0].match(/:(.*?);/)[1],Te=globalThis.atob(de[1]),j=Te.length,Ce=new Uint8Array(j);j--;)Ce[j]=Te.charCodeAt(j);var Pe=new Blob([Ce],{type:xe});Pe.name=ee,Pe.lastModified=ce,_e(Pe)})}function getDataUrlFromFile(V){return new Promise(function(ee,ce){var _e=new CustomFileReader;_e.onload=function(){return ee(_e.result)},_e.onerror=function(de){return ce(de)},_e.readAsDataURL(V)})}function loadImage(V){return new Promise(function(ee,ce){var _e=new Image;_e.onload=function(){return ee(_e)},_e.onerror=function(de){return ce(de)},_e.src=V})}function getBrowserName(){if(getBrowserName.cachedResult!==void 0)return getBrowserName.cachedResult;var V=BROWSER_NAME.ETC,ee=navigator.userAgent;return/Chrom(e|ium)/i.test(ee)?V=BROWSER_NAME.CHROME:/iP(ad|od|hone)/i.test(ee)&&/WebKit/i.test(ee)&&!/(CriOS|FxiOS|OPiOS|mercury)/i.test(ee)?V=BROWSER_NAME.MOBILE_SAFARI:/Safari/i.test(ee)?V=BROWSER_NAME.DESKTOP_SAFARI:/Firefox/i.test(ee)?V=BROWSER_NAME.FIREFOX:(/MSIE/i.test(ee)||!!document.documentMode)&&(V=BROWSER_NAME.IE),getBrowserName.cachedResult=V,getBrowserName.cachedResult}function approximateBelowMaximumCanvasSizeOfBrowser(V,ee){for(var ce=getBrowserName(),_e=MAX_CANVAS_SIZE[ce],de=V,xe=ee,Te=de*xe,j=de>xe?xe/de:de/xe;Te>_e*_e;){var Ce=(_e+de)/2,Pe=(_e+xe)/2;Ce<Pe?(xe=Pe,de=Pe*j):(xe=Ce*j,de=Ce),Te=de*xe}return{width:de,height:xe}}function getNewCanvasAndCtx(V,ee){var ce,_e;try{if((_e=(ce=new OffscreenCanvas(V,ee)).getContext("2d"))===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{_e=(ce=document.createElement("canvas")).getContext("2d")}return ce.width=V,ce.height=ee,[ce,_e]}function drawImageInCanvas(V){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,ce=approximateBelowMaximumCanvasSizeOfBrowser(V.width,V.height),_e=ce.width,de=ce.height,xe=getNewCanvasAndCtx(_e,de),Te=_slicedToArray(xe,2),j=Te[0],Ce=Te[1];return ee&&/jpe?g/.test(ee)&&(Ce.fillStyle="white",Ce.fillRect(0,0,j.width,j.height)),Ce.drawImage(V,0,0,j.width,j.height),j}function isIOS(){return isIOS.cachedResult!==void 0||(isIOS.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document!="undefined"&&"ontouchend"in document),isIOS.cachedResult}function drawFileInCanvas(V){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(ce,_e){var de,xe,Te=function(){try{return xe=drawImageInCanvas(de,ee.fileType||V.type),ce([de,xe])}catch(Pe){return _e(Pe)}},j=function(Pe){try{var Le=function(Be){try{throw Be}catch($e){return _e($e)}};try{return getDataUrlFromFile(V).then(function(ze){try{return loadImage(ze).then(function(Be){try{return de=Be,function(){try{return Te()}catch(Ve){return _e(Ve)}}()}catch($e){return Le($e)}},Le)}catch(Be){return Le(Be)}},Le)}catch(ze){Le(ze)}}catch(ze){return _e(ze)}};try{if(isIOS()||[BROWSER_NAME.DESKTOP_SAFARI,BROWSER_NAME.MOBILE_SAFARI].includes(getBrowserName()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(V).then(function(Ce){try{return de=Ce,Te()}catch{return j()}},j)}catch{j()}})}function canvasToFile(V,ee,ce,_e){var de=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1;return new Promise(function(xe,Te){var j,Ce,Pe;if(ee==="image/png")return Ce=V.getContext("2d").getImageData(0,0,V.width,V.height).data,Pe=UPNG.encode([Ce],V.width,V.height,256*de),(j=new Blob([Pe],{type:ee})).name=ce,j.lastModified=_e,Le.call(this);{let ze=function(){return Le.call(this)};return typeof OffscreenCanvas=="function"&&V instanceof OffscreenCanvas?V.convertToBlob({type:ee,quality:de}).then(function(Be){try{return(j=Be).name=ce,j.lastModified=_e,ze.call(this)}catch($e){return Te($e)}}.bind(this),Te):getFilefromDataUrl(V.toDataURL(ee,de),ce,_e).then(function(Be){try{return j=Be,ze.call(this)}catch($e){return Te($e)}}.bind(this),Te)}function Le(){return xe(j)}})}function cleanupCanvasMemory(V){V.width=0,V.height=0}function isAutoOrientationInBrowser(){return new Promise(function(V,ee){var ce,_e,de,xe;return isAutoOrientationInBrowser.cachedResult!==void 0?V(isAutoOrientationInBrowser.cachedResult):getFilefromDataUrl("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(Te){try{return drawFileInCanvas(ce=Te).then(function(j){try{return canvasToFile(_e=j[1],ce.type,ce.name,ce.lastModified).then(function(Ce){try{return de=Ce,cleanupCanvasMemory(_e),drawFileInCanvas(de).then(function(Pe){try{return xe=Pe[0],isAutoOrientationInBrowser.cachedResult=xe.width===1&&xe.height===2,V(isAutoOrientationInBrowser.cachedResult)}catch(Le){return ee(Le)}},ee)}catch(Pe){return ee(Pe)}},ee)}catch(Ce){return ee(Ce)}},ee)}catch(j){return ee(j)}},ee)})}function getExifOrientation(V){return new Promise(function(ee,ce){var _e=new CustomFileReader;_e.onload=function(de){var xe=new DataView(de.target.result);if(xe.getUint16(0,!1)!=65496)return ee(-2);for(var Te=xe.byteLength,j=2;j<Te;){if(xe.getUint16(j+2,!1)<=8)return ee(-1);var Ce=xe.getUint16(j,!1);if(j+=2,Ce==65505){if(xe.getUint32(j+=2,!1)!=1165519206)return ee(-1);var Pe=xe.getUint16(j+=6,!1)==18761;j+=xe.getUint32(j+4,Pe);var Le=xe.getUint16(j,Pe);j+=2;for(var ze=0;ze<Le;ze++)if(xe.getUint16(j+12*ze,Pe)==274)return ee(xe.getUint16(j+12*ze+8,Pe))}else{if((65280&Ce)!=65280)break;j+=xe.getUint16(j,!1)}}return ee(-1)},_e.onerror=function(de){return ce(de)},_e.readAsArrayBuffer(V)})}function handleMaxWidthOrHeight(V,ee){var ce,_e=V.width,de=V.height,xe=ee.maxWidthOrHeight,Te=V;if(isFinite(xe)&&(_e>xe||de>xe)){var j=_slicedToArray(getNewCanvasAndCtx(_e,de),2);Te=j[0],ce=j[1],_e>de?(Te.width=xe,Te.height=de/_e*xe):(Te.width=_e/de*xe,Te.height=xe),ce.drawImage(V,0,0,Te.width,Te.height),cleanupCanvasMemory(V)}return Te}function followExifOrientation(V,ee){var ce=V.width,_e=V.height,de=_slicedToArray(getNewCanvasAndCtx(ce,_e),2),xe=de[0],Te=de[1];switch(ee>4&&ee<9?(xe.width=_e,xe.height=ce):(xe.width=ce,xe.height=_e),ee){case 2:Te.transform(-1,0,0,1,ce,0);break;case 3:Te.transform(-1,0,0,-1,ce,_e);break;case 4:Te.transform(1,0,0,-1,0,_e);break;case 5:Te.transform(0,1,1,0,0,0);break;case 6:Te.transform(0,1,-1,0,_e,0);break;case 7:Te.transform(0,-1,-1,0,_e,ce);break;case 8:Te.transform(0,-1,1,0,0,ce)}return Te.drawImage(V,0,0,ce,_e),cleanupCanvasMemory(V),xe}function compress(V,ee){var ce=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return new Promise(function(_e,de){var xe,Te,j,Ce,Pe,Le,ze,Be,$e,Ve,Ke,Xe,It,Ct,yt,Ot,Mt,Pt,At;function Dt(){var Ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;if(ee.signal&&ee.signal.aborted)throw ee.signal.reason;xe+=Ut,ee.onProgress(Math.min(xe,100))}function Gt(Ut){if(ee.signal&&ee.signal.aborted)throw ee.signal.reason;xe=Math.min(Math.max(Ut,xe),100),ee.onProgress(xe)}return xe=ce,Te=ee.maxIteration||10,j=1024*ee.maxSizeMB*1024,Dt(),drawFileInCanvas(V,ee).then(function(Ut){try{var on=_slicedToArray(Ut,2);return Ce=on[1],Dt(),Pe=handleMaxWidthOrHeight(Ce,ee),Dt(),new Promise(function(Vt,An){var _n;if(!(_n=ee.exifOrientation))return getExifOrientation(V).then(function(bn){try{return _n=bn,Yn.call(this)}catch(Ln){return An(Ln)}}.bind(this),An);function Yn(){return Vt(_n)}return Yn.call(this)}).then(function(Vt){try{return Le=Vt,Dt(),isAutoOrientationInBrowser().then(function(An){try{return ze=An?Pe:followExifOrientation(Pe,Le),Dt(),Be=ee.initialQuality||1,$e=ee.fileType||V.type,canvasToFile(ze,$e,V.name,V.lastModified,Be).then(function(_n){try{{let bn=function(){if(Te--&&(yt>j||yt>It)){var mn,Xn,sr=_slicedToArray(getNewCanvasAndCtx(mn=At?.95*Pt.width:Pt.width,Xn=At?.95*Pt.height:Pt.height),2);return Mt=sr[0],sr[1].drawImage(Pt,0,0,mn,Xn),Be*=.95,canvasToFile(Mt,$e,V.name,V.lastModified,Be).then(function(Pr){try{return Ot=Pr,cleanupCanvasMemory(Pt),Pt=Mt,yt=Ot.size,Gt(Math.min(99,Math.floor((Ct-yt)/(Ct-j)*100))),bn}catch(er){return de(er)}},de)}return[1]},Ln=function(){return cleanupCanvasMemory(Pt),cleanupCanvasMemory(Mt),cleanupCanvasMemory(Pe),cleanupCanvasMemory(ze),cleanupCanvasMemory(Ce),Gt(100),_e(Ot)};if(Ve=_n,Dt(),Ke=Ve.size>j,Xe=Ve.size>V.size,!Ke&&!Xe)return Gt(100),_e(Ve);var Yn;return It=V.size,Ct=Ve.size,yt=Ct,Pt=ze,At=!ee.alwaysKeepResolution&&Ke,(Yn=function(mn){for(;mn;){if(mn.then)return void mn.then(Yn,de);try{if(mn.pop){if(mn.length)return mn.pop()?Ln.call(this):mn;mn=bn}else mn=mn.call(this)}catch(Xn){return de(Xn)}}}.bind(this))(bn)}}catch(bn){return de(bn)}}.bind(this),de)}catch(_n){return de(_n)}}.bind(this),de)}catch(An){return de(An)}}.bind(this),de)}catch(Vt){return de(Vt)}}.bind(this),de)})}var cnt=0,imageCompressionLibUrl,worker;function createWorker(V){var ee=[];return typeof V=="function"?ee.push("(".concat(V,")()")):ee.push(V),new Worker(URL.createObjectURL(new Blob(ee)))}function createSourceObject(V){return URL.createObjectURL(new Blob([V],{type:"application/javascript"}))}function stringify(V){return JSON.stringify(V,function(ee,ce){return typeof ce=="function"?"BIC_FN:::(function () { return ".concat(ce.toString()," })()"):ce})}function parse(o){if(typeof o=="string")return o;var result={};return Object.entries(o).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];if(typeof value=="string"&&value.startsWith("BIC_FN:::"))try{result[key]=eval(value.replace(/^BIC_FN:::/,""))}catch(V){throw V}else result[key]=parse(value)}),result}function generateLib(){return createSourceObject(`
    // reconstruct library
    function imageCompression (){return (`.concat(imageCompression,`).apply(null, arguments)}

    imageCompression.getDataUrlFromFile = `).concat(imageCompression.getDataUrlFromFile,`
    imageCompression.getFilefromDataUrl = `).concat(imageCompression.getFilefromDataUrl,`
    imageCompression.loadImage = `).concat(imageCompression.loadImage,`
    imageCompression.drawImageInCanvas = `).concat(imageCompression.drawImageInCanvas,`
    imageCompression.drawFileInCanvas = `).concat(imageCompression.drawFileInCanvas,`
    imageCompression.canvasToFile = `).concat(imageCompression.canvasToFile,`
    imageCompression.getExifOrientation = `).concat(imageCompression.getExifOrientation,`
    imageCompression.handleMaxWidthOrHeight = `).concat(imageCompression.handleMaxWidthOrHeight,`
    imageCompression.followExifOrientation = `).concat(imageCompression.followExifOrientation,`
    imageCompression.cleanupCanvasMemory = `).concat(imageCompression.cleanupCanvasMemory,`
    imageCompression.isAutoOrientationInBrowser = `).concat(imageCompression.isAutoOrientationInBrowser,`
    imageCompression.approximateBelowMaximumCanvasSizeOfBrowser = `).concat(imageCompression.approximateBelowMaximumCanvasSizeOfBrowser,`
    imageCompression.getBrowserName = `).concat(imageCompression.getBrowserName,`

    // functions / objects
    getDataUrlFromFile = imageCompression.getDataUrlFromFile
    getFilefromDataUrl = imageCompression.getFilefromDataUrl
    loadImage = imageCompression.loadImage
    drawImageInCanvas = imageCompression.drawImageInCanvas
    drawFileInCanvas = imageCompression.drawFileInCanvas
    canvasToFile = imageCompression.canvasToFile
    getExifOrientation = imageCompression.getExifOrientation
    handleMaxWidthOrHeight = imageCompression.handleMaxWidthOrHeight
    followExifOrientation = imageCompression.followExifOrientation
    cleanupCanvasMemory = imageCompression.cleanupCanvasMemory
    isAutoOrientationInBrowser = imageCompression.isAutoOrientationInBrowser
    approximateBelowMaximumCanvasSizeOfBrowser = imageCompression.approximateBelowMaximumCanvasSizeOfBrowser
    getBrowserName = imageCompression.getBrowserName
    isIOS = `).concat(isIOS,`
    
    getNewCanvasAndCtx = `).concat(getNewCanvasAndCtx,`
    CustomFileReader = FileReader
    CustomFile = File
    MAX_CANVAS_SIZE = `).concat(JSON.stringify(MAX_CANVAS_SIZE),`
    BROWSER_NAME = `).concat(JSON.stringify(BROWSER_NAME),`
    function compress (){return (`).concat(compress,`).apply(null, arguments)}

    // core-js
    function _slicedToArray(arr, n) { return arr }
    function _typeof(a) { return typeof a }
    function _objectSpread2(target) {
      for (var i = 1; i < arguments.length; i++) {
        var source = arguments[i] != null ? arguments[i] : {};
  
        Object.assign(target, source)
      }
  
      return target;
    }

    // Libraries
    const parse = `).concat(parse,`
    const UPNG = {}
    UPNG.toRGBA8 = `).concat(UPNG.toRGBA8,`
    UPNG.toRGBA8.decodeImage = `).concat(UPNG.toRGBA8.decodeImage,`
    UPNG.decode = `).concat(UPNG.decode,`
    UPNG.decode._decompress = `).concat(UPNG.decode._decompress,`
    UPNG.decode._inflate = `).concat(UPNG.decode._inflate,`
    UPNG.decode._readInterlace = `).concat(UPNG.decode._readInterlace,`
    UPNG.decode._getBPP = `).concat(UPNG.decode._getBPP,` 
    UPNG.decode._filterZero = `).concat(UPNG.decode._filterZero,`
    UPNG.decode._paeth = `).concat(UPNG.decode._paeth,`
    UPNG.decode._IHDR = `).concat(UPNG.decode._IHDR,`
    UPNG._bin = parse(`).concat(stringify(UPNG._bin),`)
    UPNG._copyTile = `).concat(UPNG._copyTile,`
    UPNG.encode = `).concat(UPNG.encode,`
    UPNG.encodeLL = `).concat(UPNG.encodeLL,` 
    UPNG.encode._main = `).concat(UPNG.encode._main,`
    UPNG.encode.compressPNG = `).concat(UPNG.encode.compressPNG,` 
    UPNG.encode.compress = `).concat(UPNG.encode.compress,`
    UPNG.encode.framize = `).concat(UPNG.encode.framize,` 
    UPNG.encode._updateFrame = `).concat(UPNG.encode._updateFrame,` 
    UPNG.encode._prepareDiff = `).concat(UPNG.encode._prepareDiff,` 
    UPNG.encode._filterZero = `).concat(UPNG.encode._filterZero,` 
    UPNG.encode._filterLine = `).concat(UPNG.encode._filterLine,`
    UPNG.encode.concatRGBA = `).concat(UPNG.encode.concatRGBA,`
    UPNG.crc = parse(`).concat(stringify(UPNG.crc),`)
    UPNG.crc.table = ( function() {
    var tab = new Uint32Array(256);
    for (var n=0; n<256; n++) {
      var c = n;
      for (var k=0; k<8; k++) {
        if (c & 1)  c = 0xedb88320 ^ (c >>> 1);
        else        c = c >>> 1;
      }
      tab[n] = c;  }
    return tab;  })()
    UPNG.quantize = `).concat(UPNG.quantize,` 
    UPNG.quantize.getKDtree = `).concat(UPNG.quantize.getKDtree,` 
    UPNG.quantize.getNearest = `).concat(UPNG.quantize.getNearest,` 
    UPNG.quantize.planeDst = `).concat(UPNG.quantize.planeDst,` 
    UPNG.quantize.dist = `).concat(UPNG.quantize.dist,`     
    UPNG.quantize.splitPixels = `).concat(UPNG.quantize.splitPixels,` 
    UPNG.quantize.vecDot = `).concat(UPNG.quantize.vecDot,` 
    UPNG.quantize.stats = `).concat(UPNG.quantize.stats,` 
    UPNG.quantize.estats = `).concat(UPNG.quantize.estats,`
    UPNG.M4 = parse(`).concat(stringify(UPNG.M4),`)
    UPNG.encode.concatRGBA = `).concat(UPNG.encode.concatRGBA,`
    UPNG.inflateRaw=function(){
    var H={};H.H={};H.H.N=function(N,W){var R=Uint8Array,i=0,m=0,J=0,h=0,Q=0,X=0,u=0,w=0,d=0,v,C;
      if(N[0]==3&&N[1]==0)return W?W:new R(0);var V=H.H,n=V.b,A=V.e,l=V.R,M=V.n,I=V.A,e=V.Z,b=V.m,Z=W==null;
      if(Z)W=new R(N.length>>>2<<5);while(i==0){i=n(N,d,1);m=n(N,d+1,2);d+=3;if(m==0){if((d&7)!=0)d+=8-(d&7);
        var D=(d>>>3)+4,q=N[D-4]|N[D-3]<<8;if(Z)W=H.H.W(W,w+q);W.set(new R(N.buffer,N.byteOffset+D,q),w);d=D+q<<3;
        w+=q;continue}if(Z)W=H.H.W(W,w+(1<<17));if(m==1){v=b.J;C=b.h;X=(1<<9)-1;u=(1<<5)-1}if(m==2){J=A(N,d,5)+257;
        h=A(N,d+5,5)+1;Q=A(N,d+10,4)+4;d+=14;var E=d,j=1;for(var c=0;c<38;c+=2){b.Q[c]=0;b.Q[c+1]=0}for(var c=0;
                                                                                                        c<Q;c++){var K=A(N,d+c*3,3);b.Q[(b.X[c]<<1)+1]=K;if(K>j)j=K}d+=3*Q;M(b.Q,j);I(b.Q,j,b.u);v=b.w;C=b.d;
        d=l(b.u,(1<<j)-1,J+h,N,d,b.v);var r=V.V(b.v,0,J,b.C);X=(1<<r)-1;var S=V.V(b.v,J,h,b.D);u=(1<<S)-1;M(b.C,r);
        I(b.C,r,v);M(b.D,S);I(b.D,S,C)}while(!0){var T=v[e(N,d)&X];d+=T&15;var p=T>>>4;if(p>>>8==0){W[w++]=p}else if(p==256){break}else{var z=w+p-254;
        if(p>264){var _=b.q[p-257];z=w+(_>>>3)+A(N,d,_&7);d+=_&7}var $=C[e(N,d)&u];d+=$&15;var s=$>>>4,Y=b.c[s],a=(Y>>>4)+n(N,d,Y&15);
        d+=Y&15;while(w<z){W[w]=W[w++-a];W[w]=W[w++-a];W[w]=W[w++-a];W[w]=W[w++-a]}w=z}}}return W.length==w?W:W.slice(0,w)};
      H.H.W=function(N,W){var R=N.length;if(W<=R)return N;var V=new Uint8Array(R<<1);V.set(N,0);return V};
      H.H.R=function(N,W,R,V,n,A){var l=H.H.e,M=H.H.Z,I=0;while(I<R){var e=N[M(V,n)&W];n+=e&15;var b=e>>>4;
        if(b<=15){A[I]=b;I++}else{var Z=0,m=0;if(b==16){m=3+l(V,n,2);n+=2;Z=A[I-1]}else if(b==17){m=3+l(V,n,3);
          n+=3}else if(b==18){m=11+l(V,n,7);n+=7}var J=I+m;while(I<J){A[I]=Z;I++}}}return n};H.H.V=function(N,W,R,V){var n=0,A=0,l=V.length>>>1;
        while(A<R){var M=N[A+W];V[A<<1]=0;V[(A<<1)+1]=M;if(M>n)n=M;A++}while(A<l){V[A<<1]=0;V[(A<<1)+1]=0;A++}return n};
      H.H.n=function(N,W){var R=H.H.m,V=N.length,n,A,l,M,I,e=R.j;for(var M=0;M<=W;M++)e[M]=0;for(M=1;M<V;M+=2)e[N[M]]++;
        var b=R.K;n=0;e[0]=0;for(A=1;A<=W;A++){n=n+e[A-1]<<1;b[A]=n}for(l=0;l<V;l+=2){I=N[l+1];if(I!=0){N[l]=b[I];
          b[I]++}}};H.H.A=function(N,W,R){var V=N.length,n=H.H.m,A=n.r;for(var l=0;l<V;l+=2)if(N[l+1]!=0){var M=l>>1,I=N[l+1],e=M<<4|I,b=W-I,Z=N[l]<<b,m=Z+(1<<b);
        while(Z!=m){var J=A[Z]>>>15-W;R[J]=e;Z++}}};H.H.l=function(N,W){var R=H.H.m.r,V=15-W;for(var n=0;n<N.length;
                                                                                                 n+=2){var A=N[n]<<W-N[n+1];N[n]=R[A]>>>V}};H.H.M=function(N,W,R){R=R<<(W&7);var V=W>>>3;N[V]|=R;N[V+1]|=R>>>8};
      H.H.I=function(N,W,R){R=R<<(W&7);var V=W>>>3;N[V]|=R;N[V+1]|=R>>>8;N[V+2]|=R>>>16};H.H.e=function(N,W,R){return(N[W>>>3]|N[(W>>>3)+1]<<8)>>>(W&7)&(1<<R)-1};
      H.H.b=function(N,W,R){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16)>>>(W&7)&(1<<R)-1};H.H.Z=function(N,W){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16)>>>(W&7)};
      H.H.i=function(N,W){return(N[W>>>3]|N[(W>>>3)+1]<<8|N[(W>>>3)+2]<<16|N[(W>>>3)+3]<<24)>>>(W&7)};H.H.m=function(){var N=Uint16Array,W=Uint32Array;
        return{K:new N(16),j:new N(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new N(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new W(32),J:new N(512),_:[],h:new N(32),$:[],w:new N(32768),C:[],v:[],d:new N(32768),D:[],u:new N(512),Q:[],r:new N(1<<15),s:new W(286),Y:new W(30),a:new W(19),t:new W(15e3),k:new N(1<<16),g:new N(1<<15)}}();
      (function(){var N=H.H.m,W=1<<15;for(var R=0;R<W;R++){var V=R;V=(V&2863311530)>>>1|(V&1431655765)<<1;
        V=(V&3435973836)>>>2|(V&858993459)<<2;V=(V&4042322160)>>>4|(V&252645135)<<4;V=(V&4278255360)>>>8|(V&16711935)<<8;
        N.r[R]=(V>>>16|V<<16)>>>17}function n(A,l,M){while(l--!=0)A.push(0,M)}for(var R=0;R<32;R++){N.q[R]=N.S[R]<<3|N.T[R];
        N.c[R]=N.p[R]<<4|N.z[R]}n(N._,144,8);n(N._,255-143,9);n(N._,279-255,7);n(N._,287-279,8);H.H.n(N._,9);
        H.H.A(N._,9,N.J);H.H.l(N._,9);n(N.$,32,5);H.H.n(N.$,5);H.H.A(N.$,5,N.h);H.H.l(N.$,5);n(N.Q,19,0);n(N.C,286,0);
        n(N.D,30,0);n(N.v,320,0)}());return H.H.N}()
    
    const UZIP = {}
    UZIP["parse"] = `).concat(UZIP_1.parse,`
    UZIP._readLocal = `).concat(UZIP_1._readLocal,`
    UZIP.inflateRaw = `).concat(UZIP_1.inflateRaw,`
    UZIP.inflate = `).concat(UZIP_1.inflate,`
    UZIP.deflate = `).concat(UZIP_1.deflate,`
    UZIP.deflateRaw = `).concat(UZIP_1.deflateRaw,`
    UZIP.encode = `).concat(UZIP_1.encode,`
    UZIP._noNeed = `).concat(UZIP_1._noNeed,`
    UZIP._writeHeader = `).concat(UZIP_1._writeHeader,`
    UZIP.crc = parse(`).concat(stringify(UZIP_1.crc),`)
    UZIP.crc.table = ( function() {
      var tab = new Uint32Array(256);
      for (var n=0; n<256; n++) {
        var c = n;
        for (var k=0; k<8; k++) {
          if (c & 1)  c = 0xedb88320 ^ (c >>> 1);
          else        c = c >>> 1;
        }
        tab[n] = c;  }
      return tab;  })()
    
    UZIP.adler = `).concat(UZIP_1.adler,`
    UZIP.bin = parse(`).concat(stringify(UZIP_1.bin),`)
    UZIP.F = {}
    UZIP.F.deflateRaw = `).concat(UZIP_1.F.deflateRaw,`
    UZIP.F._bestMatch = `).concat(UZIP_1.F._bestMatch,`
    UZIP.F._howLong = `).concat(UZIP_1.F._howLong,`
    UZIP.F._hash = `).concat(UZIP_1.F._hash,`
    UZIP.saved = `).concat(UZIP_1.saved,`
    UZIP.F._writeBlock = `).concat(UZIP_1.F._writeBlock,`
    UZIP.F._copyExact = `).concat(UZIP_1.F._copyExact,`
    UZIP.F.getTrees = `).concat(UZIP_1.F.getTrees,`
    UZIP.F.getSecond = `).concat(UZIP_1.F.getSecond,`
    UZIP.F.nonZero = `).concat(UZIP_1.F.nonZero,`
    UZIP.F.contSize = `).concat(UZIP_1.F.contSize,`
    UZIP.F._codeTiny = `).concat(UZIP_1.F._codeTiny,` 
    UZIP.F._lenCodes = `).concat(UZIP_1.F._lenCodes,` 
    UZIP.F._hufTree = `).concat(UZIP_1.F._hufTree,` 
    UZIP.F.setDepth = `).concat(UZIP_1.F.setDepth,` 
    UZIP.F.restrictDepth = `).concat(UZIP_1.F.restrictDepth,`
    UZIP.F._goodIndex = `).concat(UZIP_1.F._goodIndex,` 
    UZIP.F._writeLit = `).concat(UZIP_1.F._writeLit,` 
    UZIP.F.inflate = `).concat(UZIP_1.F.inflate,` 
    UZIP.F._check = `).concat(UZIP_1.F._check,` 
    UZIP.F._decodeTiny = `).concat(UZIP_1.F._decodeTiny,` 
    UZIP.F._copyOut = `).concat(UZIP_1.F._copyOut,` 
    UZIP.F.makeCodes = `).concat(UZIP_1.F.makeCodes,` 
    UZIP.F.codes2map = `).concat(UZIP_1.F.codes2map,` 
    UZIP.F.revCodes = `).concat(UZIP_1.F.revCodes,` 

    // used only in deflate
    UZIP.F._putsE = `).concat(UZIP_1.F._putsE,`
    UZIP.F._putsF = `).concat(UZIP_1.F._putsF,`
  
    UZIP.F._bitsE = `).concat(UZIP_1.F._bitsE,`
    UZIP.F._bitsF = `).concat(UZIP_1.F._bitsF,`

    UZIP.F._get17 = `).concat(UZIP_1.F._get17,`
    UZIP.F._get25 = `).concat(UZIP_1.F._get25,`
    UZIP.F.U = function(){
      var u16=Uint16Array, u32=Uint32Array;
      return {
        next_code : new u16(16),
        bl_count  : new u16(16),
        ordr : [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ],
        of0  : [3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],
        exb  : [0,0,0,0,0,0,0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,  4,  5,  5,  5,  5,  0,  0,  0,  0],
        ldef : new u16(32),
        df0  : [1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577, 65535, 65535],
        dxb  : [0,0,0,0,1,1,2, 2, 3, 3, 4, 4, 5, 5,  6,  6,  7,  7,  8,  8,   9,   9,  10,  10,  11,  11,  12,   12,   13,   13,     0,     0],
        ddef : new u32(32),
        flmap: new u16(  512),  fltree: [],
        fdmap: new u16(   32),  fdtree: [],
        lmap : new u16(32768),  ltree : [],  ttree:[],
        dmap : new u16(32768),  dtree : [],
        imap : new u16(  512),  itree : [],
        //rev9 : new u16(  512)
        rev15: new u16(1<<15),
        lhst : new u32(286), dhst : new u32( 30), ihst : new u32(19),
        lits : new u32(15000),
        strt : new u16(1<<16),
        prev : new u16(1<<15)
      };
    } ();

    (function(){
      var U = UZIP.F.U;
      var len = 1<<15;
      for(var i=0; i<len; i++) {
        var x = i;
        x = (((x & 0xaaaaaaaa) >>> 1) | ((x & 0x55555555) << 1));
        x = (((x & 0xcccccccc) >>> 2) | ((x & 0x33333333) << 2));
        x = (((x & 0xf0f0f0f0) >>> 4) | ((x & 0x0f0f0f0f) << 4));
        x = (((x & 0xff00ff00) >>> 8) | ((x & 0x00ff00ff) << 8));
        U.rev15[i] = (((x >>> 16) | (x << 16)))>>>17;
      }
  
      function pushV(tgt, n, sv) {  while(n--!=0) tgt.push(0,sv);  }
  
      for(var i=0; i<32; i++) {  U.ldef[i]=(U.of0[i]<<3)|U.exb[i];  U.ddef[i]=(U.df0[i]<<4)|U.dxb[i];  }
  
      pushV(U.fltree, 144, 8);  pushV(U.fltree, 255-143, 9);  pushV(U.fltree, 279-255, 7);  pushV(U.fltree,287-279,8);
      /*
        var i = 0;
        for(; i<=143; i++) U.fltree.push(0,8);
        for(; i<=255; i++) U.fltree.push(0,9);
        for(; i<=279; i++) U.fltree.push(0,7);
        for(; i<=287; i++) U.fltree.push(0,8);
        */
      UZIP.F.makeCodes(U.fltree, 9);
      UZIP.F.codes2map(U.fltree, 9, U.flmap);
      UZIP.F.revCodes (U.fltree, 9)
  
      pushV(U.fdtree,32,5);
      //for(i=0;i<32; i++) U.fdtree.push(0,5);
      UZIP.F.makeCodes(U.fdtree, 5);
      UZIP.F.codes2map(U.fdtree, 5, U.fdmap);
      UZIP.F.revCodes (U.fdtree, 5)
  
      pushV(U.itree,19,0);  pushV(U.ltree,286,0);  pushV(U.dtree,30,0);  pushV(U.ttree,320,0);
      /*
        for(var i=0; i< 19; i++) U.itree.push(0,0);
        for(var i=0; i<286; i++) U.ltree.push(0,0);
        for(var i=0; i< 30; i++) U.dtree.push(0,0);
        for(var i=0; i<320; i++) U.ttree.push(0,0);
        */
    })()
    `))}function generateWorkerScript(){return createWorker(`
    let scriptImported = false
    self.addEventListener('message', async (e) => {
      const { file, id, imageCompressionLibUrl, options } = e.data
      options.onProgress = (progress) => self.postMessage({ progress, id })
      try {
        if (!scriptImported) {
          // console.log('[worker] importScripts', imageCompressionLibUrl)
          self.importScripts(imageCompressionLibUrl)
          scriptImported = true
        }
        // console.log('[worker] self', self)
        const compressedFile = await imageCompression(file, options)
        self.postMessage({ file: compressedFile, id })
      } catch (e) {
        // console.error('[worker] error', e)
        self.postMessage({ error: e.message + '\\n' + e.stack, id })
      }
    })
  `)}function compressOnWebWorker(V,ee){return new Promise(function(ce,_e){var de=cnt+=1;imageCompressionLibUrl||(imageCompressionLibUrl=generateLib()),worker||(worker=generateWorkerScript()),worker.addEventListener("message",function xe(Te){if(Te.data.id===de){if(ee.signal&&ee.signal.aborted)return;if(Te.data.progress!==void 0)return void ee.onProgress(Te.data.progress);worker.removeEventListener("message",xe),Te.data.error&&_e(new Error(Te.data.error)),ce(Te.data.file)}}),worker.addEventListener("error",_e),ee.signal&&ee.signal.addEventListener("abort",function(){worker.terminate(),_e(ee.signal.reason)}),worker.postMessage({file:V,id:de,imageCompressionLibUrl,options:_objectSpread2(_objectSpread2({},ee),{},{onProgress:void 0,signal:void 0})})})}function imageCompression(V,ee){return new Promise(function(ce,_e){var de,xe,Te,j,Ce,Pe;if(de=_objectSpread2({},ee),Te=0,j=de.onProgress,de.maxSizeMB=de.maxSizeMB||Number.POSITIVE_INFINITY,Ce=typeof de.useWebWorker!="boolean"||de.useWebWorker,delete de.useWebWorker,de.onProgress=function($e){Te=$e,typeof j=="function"&&j(Te)},!(V instanceof Blob||V instanceof CustomFile))return _e(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(V.type))return _e(new Error("The file given is not an image"));if(Pe=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope,!Ce||typeof Worker!="function"||Pe)return compress(V,de).then(function($e){try{return xe=$e,Be.call(this)}catch(Ve){return _e(Ve)}}.bind(this),_e);var Le=function(){try{return Be.call(this)}catch($e){return _e($e)}}.bind(this),ze=function(Ve){try{return compress(V,de).then(function(Ke){try{return xe=Ke,Le()}catch(Xe){return _e(Xe)}},_e)}catch(Ke){return _e(Ke)}};try{return compressOnWebWorker(V,de).then(function($e){try{return xe=$e,Le()}catch{return ze()}},ze)}catch{ze()}function Be(){try{xe.name=V.name,xe.lastModified=V.lastModified}catch{}return ce(xe)}})}imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage,imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.drawFileInCanvas=drawFileInCanvas,imageCompression.canvasToFile=canvasToFile,imageCompression.getExifOrientation=getExifOrientation,imageCompression.handleMaxWidthOrHeight=handleMaxWidthOrHeight,imageCompression.followExifOrientation=followExifOrientation,imageCompression.cleanupCanvasMemory=cleanupCanvasMemory,imageCompression.isAutoOrientationInBrowser=isAutoOrientationInBrowser,imageCompression.approximateBelowMaximumCanvasSizeOfBrowser=approximateBelowMaximumCanvasSizeOfBrowser,imageCompression.getBrowserName=getBrowserName,imageCompression.version="2.0.0";var vueMatomo={exports:{}};(function(V,ee){(function(ce,_e){V.exports=_e()})(window,function(){return function(ce){var _e={};function de(xe){if(_e[xe])return _e[xe].exports;var Te=_e[xe]={i:xe,l:!1,exports:{}};return ce[xe].call(Te.exports,Te,Te.exports,de),Te.l=!0,Te.exports}return de.m=ce,de.c=_e,de.d=function(xe,Te,j){de.o(xe,Te)||Object.defineProperty(xe,Te,{enumerable:!0,get:j})},de.r=function(xe){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(xe,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(xe,"__esModule",{value:!0})},de.t=function(xe,Te){if(1&Te&&(xe=de(xe)),8&Te||4&Te&&typeof xe=="object"&&xe&&xe.__esModule)return xe;var j=Object.create(null);if(de.r(j),Object.defineProperty(j,"default",{enumerable:!0,value:xe}),2&Te&&typeof xe!="string")for(var Ce in xe)de.d(j,Ce,function(Pe){return xe[Pe]}.bind(null,Ce));return j},de.n=function(xe){var Te=xe&&xe.__esModule?function(){return xe.default}:function(){return xe};return de.d(Te,"a",Te),Te},de.o=function(xe,Te){return Object.prototype.hasOwnProperty.call(xe,Te)},de.p="",de(de.s=0)}([function(ce,_e,de){function xe(){return window.Piwik.getAsyncTracker()}function Te(Ve){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;return new Promise(function(Xe,It){var Ct=document.createElement("script");Ct.async=!0,Ct.defer=!0,Ct.src=Ve,Ke&&["anonymous","use-credentials"].includes(Ke)&&(Ct.crossOrigin=Ke),(document.head||document.getElementsByTagName("head")[0]).appendChild(Ct),Ct.onload=Xe,Ct.onerror=It})}function j(Ve,Ke){return Ve.resolve(Ke).href}de.r(_e),de.d(_e,"matomoKey",function(){return Pe}),de.d(_e,"default",function(){return $e});var Ce={debug:!1,disableCookies:!1,requireCookieConsent:!1,enableHeartBeatTimer:!1,enableLinkTracking:!0,heartBeatTimerInterval:15,requireConsent:!1,trackInitialView:!0,trackSiteSearch:!1,trackerFileName:"matomo",trackerUrl:void 0,trackerScriptUrl:void 0,userId:void 0,cookieDomain:void 0,domains:void 0,preInitActions:[],crossOrigin:void 0},Pe="Matomo";function Le(Ve,Ke,Xe){if(typeof Ve.trackSiteSearch=="function"){var It=Ve.trackSiteSearch(Ke);if(It)return void function(Ct,yt){var Ot=yt.keyword,Mt=yt.category,Pt=yt.resultsCount,At=xe();Ct.debug&&console.debug("[vue-matomo] Site Search "+Ot),At.trackSiteSearch(Ot,Mt,Pt)}(Ve,It)}(function(Ct,yt,Ot){var Mt,Pt,At,Dt=xe();if(Ct.router){if(Pt=j(Ct.router,yt.fullPath),At=Ot&&Ot.fullPath?j(Ct.router,Ot.fullPath):void 0,yt.meta.analyticsIgnore)return void(Ct.debug&&console.debug("[vue-matomo] Ignoring "+Pt));Ct.debug&&console.debug("[vue-matomo] Tracking "+Pt),Mt=yt.meta.title||Pt}At&&Dt.setReferrerUrl(window.location.origin+At),Pt&&Dt.setCustomUrl(window.location.origin+Pt),Dt.trackPageView(Mt)})(Ve,Ke,Xe)}function ze(Ve,Ke){var Xe=xe();if(Number(Ve.version.split(".")[0])>2?(Ve.config.globalProperties.$piwik=Xe,Ve.config.globalProperties.$matomo=Xe,Ve.provide(Pe,Xe)):(Ve.prototype.$piwik=Xe,Ve.prototype.$matomo=Xe),Ke.trackInitialView&&Ke.router){var It=Ke.router.currentRoute.value?Ke.router.currentRoute.value:Ke.router.currentRoute;Le(Ke,It)}Ke.router&&Ke.router.afterEach(function(Ct,yt){Le(Ke,Ct,yt),Ke.enableLinkTracking&&Xe.enableLinkTracking()})}function Be(){return new Promise(function(Ve,Ke){var Xe=Date.now(),It=setInterval(function(){if(window.Piwik)return clearInterval(It),Ve();if(Date.now()>=Xe+3e3)throw clearInterval(It),new Error("[vue-matomo]: window.Piwik undefined after waiting for ".concat(3e3,"ms"))},50)})}function $e(Ve){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Xe=Object.assign({},Ce,Ke),It=Xe.host,Ct=Xe.siteId,yt=Xe.trackerFileName,Ot=Xe.trackerUrl,Mt=Xe.trackerScriptUrl,Pt=Mt||"".concat(It,"/").concat(yt,".js"),At=Ot||"".concat(It,"/").concat(yt,".php");window._paq=window._paq||[],window._paq.push(["setTrackerUrl",At]),window._paq.push(["setSiteId",Ct]),Xe.requireConsent&&window._paq.push(["requireConsent"]),Xe.userId&&window._paq.push(["setUserId",Xe.userId]),Xe.enableLinkTracking&&window._paq.push(["enableLinkTracking"]),Xe.disableCookies&&window._paq.push(["disableCookies"]),Xe.requireCookieConsent&&window._paq.push(["requireCookieConsent"]),Xe.enableHeartBeatTimer&&window._paq.push(["enableHeartBeatTimer",Xe.heartBeatTimerInterval]),Xe.cookieDomain&&window._paq.push(["setCookieDomain",Xe.cookieDomain]),Xe.domains&&window._paq.push(["setDomains",Xe.domains]),Xe.preInitActions.forEach(function(Dt){return window._paq.push(Dt)}),Te(Pt,Xe.crossOrigin).then(function(){return Be()}).then(function(){return ze(Ve,Xe)}).catch(function(Dt){if(Dt.target)return console.error("[vue-matomo] An error occurred trying to load ".concat(Dt.target.src,". ")+"If the file exists you may have an ad- or trackingblocker enabled.");console.error(Dt)})}}])})})(vueMatomo);var VueMatomo=getDefaultExportFromCjs(vueMatomo.exports);export{required as $,Ae as A,A as B,mapbox as C,render$e as D,toDisplayString as E,Fragment as F,render$1 as G,renderList as H,withDirectives as I,vModelText as J,resolveDynamicComponent as K,render$h as L,Me as M,render$8 as N,render$a as O,normalizeStyle as P,render$b as Q,RouterView as R,render$6 as S,Transition as T,render$f as U,reactive as V,computed as W,useVuelidate as X,render$7 as Y,render$2 as Z,render as _,openBlock as a,email as a0,axios as a1,numeric as a2,minLength as a3,sameAs as a4,imageCompression as a5,createStaticVNode as a6,Y as a7,Z as a8,X as a9,W$1 as aa,render$c as ab,render$3 as ac,render$9 as ad,render$4 as ae,withAsyncContext as af,render$g as ag,Suspense as ah,createRouter as ai,createWebHistory as aj,createApp as ak,createPinia as al,VueMatomo as am,createVNode as b,createElementBlock as c,defineStore as d,unref as e,oe as f,createBaseVNode as g,render$d as h,fe as i,je as j,isRef as k,render$5 as l,createTextVNode as m,n,onMounted as o,createBlock as p,me as q,ref as r,createCommentVNode as s,pe as t,useRouter as u,v,withCtx as w,ve as x,normalizeClass as y,fe$1 as z};
