var C2=Object.defineProperty,M2=Object.defineProperties;var z2=Object.getOwnPropertyDescriptors;var ip=Object.getOwnPropertySymbols;var Mx=Object.prototype.hasOwnProperty,zx=Object.prototype.propertyIsEnumerable;var Cx=(a,d,g)=>d in a?C2(a,d,{enumerable:!0,configurable:!0,writable:!0,value:g}):a[d]=g,ui=(a,d)=>{for(var g in d||(d={}))Mx.call(d,g)&&Cx(a,g,d[g]);if(ip)for(var g of ip(d))zx.call(d,g)&&Cx(a,g,d[g]);return a},xn=(a,d)=>M2(a,z2(d));var Do=(a,d)=>{var g={};for(var b in a)Mx.call(a,b)&&d.indexOf(b)<0&&(g[b]=a[b]);if(a!=null&&ip)for(var b of ip(a))d.indexOf(b)<0&&zx.call(a,b)&&(g[b]=a[b]);return g};function m_(a,d){const g=Object.create(null),b=a.split(",");for(let T=0;T<b.length;T++)g[b[T]]=!0;return d?T=>!!g[T.toLowerCase()]:T=>!!g[T]}const P2="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",k2=m_(P2);function Kv(a){return!!a||a===""}function __(a){if(Yt(a)){const d={};for(let g=0;g<a.length;g++){const b=a[g],T=wr(b)?R2(b):__(b);if(T)for(const I in T)d[I]=T[I]}return d}else{if(wr(a))return a;if(Tr(a))return a}}const D2=/;(?![^(]*\))/g,L2=/:(.+)/;function R2(a){const d={};return a.split(D2).forEach(g=>{if(g){const b=g.split(L2);b.length>1&&(d[b[0].trim()]=b[1].trim())}}),d}function g_(a){let d="";if(wr(a))d=a;else if(Yt(a))for(let g=0;g<a.length;g++){const b=g_(a[g]);b&&(d+=b+" ")}else if(Tr(a))for(const g in a)a[g]&&(d+=g+" ");return d.trim()}const VC=a=>wr(a)?a:a==null?"":Yt(a)||Tr(a)&&(a.toString===Qv||!ai(a.toString))?JSON.stringify(a,Yv,2):String(a),Yv=(a,d)=>d&&d.__v_isRef?Yv(a,d.value):fc(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((g,[b,T])=>(g[`${b} =>`]=T,g),{})}:Jv(d)?{[`Set(${d.size})`]:[...d.values()]}:Tr(d)&&!Yt(d)&&!e0(d)?String(d):d,tr={},pc=[],co=()=>{},B2=()=>!1,O2=/^on[^a-z]/,zp=a=>O2.test(a),y_=a=>a.startsWith("onUpdate:"),Wr=Object.assign,x_=(a,d)=>{const g=a.indexOf(d);g>-1&&a.splice(g,1)},F2=Object.prototype.hasOwnProperty,Bi=(a,d)=>F2.call(a,d),Yt=Array.isArray,fc=a=>Pp(a)==="[object Map]",Jv=a=>Pp(a)==="[object Set]",ai=a=>typeof a=="function",wr=a=>typeof a=="string",v_=a=>typeof a=="symbol",Tr=a=>a!==null&&typeof a=="object",b_=a=>Tr(a)&&ai(a.then)&&ai(a.catch),Qv=Object.prototype.toString,Pp=a=>Qv.call(a),U2=a=>Pp(a).slice(8,-1),e0=a=>Pp(a)==="[object Object]",w_=a=>wr(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,fp=m_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),kp=a=>{const d=Object.create(null);return g=>d[g]||(d[g]=a(g))},j2=/-(\w)/g,Oo=kp(a=>a.replace(j2,(d,g)=>g?g.toUpperCase():"")),N2=/\B([A-Z])/g,bc=kp(a=>a.replace(N2,"-$1").toLowerCase()),Dp=kp(a=>a.charAt(0).toUpperCase()+a.slice(1)),vm=kp(a=>a?`on${Dp(a)}`:""),mh=(a,d)=>!Object.is(a,d),mp=(a,d)=>{for(let g=0;g<a.length;g++)a[g](d)},bp=(a,d,g)=>{Object.defineProperty(a,d,{configurable:!0,enumerable:!1,value:g})},_h=a=>{const d=parseFloat(a);return isNaN(d)?a:d};let Px;const V2=()=>Px||(Px=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let ns;class t0{constructor(d=!1){this.active=!0,this.effects=[],this.cleanups=[],!d&&ns&&(this.parent=ns,this.index=(ns.scopes||(ns.scopes=[])).push(this)-1)}run(d){if(this.active)try{return ns=this,d()}finally{ns=this.parent}}on(){ns=this}off(){ns=this.parent}stop(d){if(this.active){let g,b;for(g=0,b=this.effects.length;g<b;g++)this.effects[g].stop();for(g=0,b=this.cleanups.length;g<b;g++)this.cleanups[g]();if(this.scopes)for(g=0,b=this.scopes.length;g<b;g++)this.scopes[g].stop(!0);if(this.parent&&!d){const T=this.parent.scopes.pop();T&&T!==this&&(this.parent.scopes[this.index]=T,T.index=this.index)}this.active=!1}}}function i0(a){return new t0(a)}function $2(a,d=ns){d&&d.active&&d.effects.push(a)}const T_=a=>{const d=new Set(a);return d.w=0,d.n=0,d},r0=a=>(a.w&Qs)>0,n0=a=>(a.n&Qs)>0,G2=({deps:a})=>{if(a.length)for(let d=0;d<a.length;d++)a[d].w|=Qs},q2=a=>{const{deps:d}=a;if(d.length){let g=0;for(let b=0;b<d.length;b++){const T=d[b];r0(T)&&!n0(T)?T.delete(a):d[g++]=T,T.w&=~Qs,T.n&=~Qs}d.length=g}},Bm=new WeakMap;let nh=0,Qs=1;const Om=30;let Bo;const Ja=Symbol(""),Fm=Symbol("");class E_{constructor(d,g=null,b){this.fn=d,this.scheduler=g,this.active=!0,this.deps=[],this.parent=void 0,$2(this,b)}run(){if(!this.active)return this.fn();let d=Bo,g=Hs;for(;d;){if(d===this)return;d=d.parent}try{return this.parent=Bo,Bo=this,Hs=!0,Qs=1<<++nh,nh<=Om?G2(this):kx(this),this.fn()}finally{nh<=Om&&q2(this),Qs=1<<--nh,Bo=this.parent,Hs=g,this.parent=void 0}}stop(){this.active&&(kx(this),this.onStop&&this.onStop(),this.active=!1)}}function kx(a){const{deps:d}=a;if(d.length){for(let g=0;g<d.length;g++)d[g].delete(a);d.length=0}}let Hs=!0;const o0=[];function wc(){o0.push(Hs),Hs=!1}function Tc(){const a=o0.pop();Hs=a===void 0?!0:a}function On(a,d,g){if(Hs&&Bo){let b=Bm.get(a);b||Bm.set(a,b=new Map);let T=b.get(g);T||b.set(g,T=T_()),s0(T)}}function s0(a,d){let g=!1;nh<=Om?n0(a)||(a.n|=Qs,g=!r0(a)):g=!a.has(Bo),g&&(a.add(Bo),Bo.deps.push(a))}function ls(a,d,g,b,T,I){const z=Bm.get(a);if(!z)return;let o=[];if(d==="clear")o=[...z.values()];else if(g==="length"&&Yt(a))z.forEach((k,j)=>{(j==="length"||j>=b)&&o.push(k)});else switch(g!==void 0&&o.push(z.get(g)),d){case"add":Yt(a)?w_(g)&&o.push(z.get("length")):(o.push(z.get(Ja)),fc(a)&&o.push(z.get(Fm)));break;case"delete":Yt(a)||(o.push(z.get(Ja)),fc(a)&&o.push(z.get(Fm)));break;case"set":fc(a)&&o.push(z.get(Ja));break}if(o.length===1)o[0]&&Um(o[0]);else{const k=[];for(const j of o)j&&k.push(...j);Um(T_(k))}}function Um(a,d){for(const g of Yt(a)?a:[...a])(g!==Bo||g.allowRecurse)&&(g.scheduler?g.scheduler():g.run())}const Z2=m_("__proto__,__v_isRef,__isVue"),a0=new Set(Object.getOwnPropertyNames(Symbol).map(a=>Symbol[a]).filter(v_)),W2=S_(),X2=S_(!1,!0),H2=S_(!0),Dx=K2();function K2(){const a={};return["includes","indexOf","lastIndexOf"].forEach(d=>{a[d]=function(...g){const b=Oi(this);for(let I=0,z=this.length;I<z;I++)On(b,"get",I+"");const T=b[d](...g);return T===-1||T===!1?b[d](...g.map(Oi)):T}}),["push","pop","shift","unshift","splice"].forEach(d=>{a[d]=function(...g){wc();const b=Oi(this)[d].apply(this,g);return Tc(),b}}),a}function S_(a=!1,d=!1){return function(b,T,I){if(T==="__v_isReactive")return!a;if(T==="__v_isReadonly")return a;if(T==="__v_isShallow")return d;if(T==="__v_raw"&&I===(a?d?dT:d0:d?h0:u0).get(b))return b;const z=Yt(b);if(!a&&z&&Bi(Dx,T))return Reflect.get(Dx,T,I);const o=Reflect.get(b,T,I);return(v_(T)?a0.has(T):Z2(T))||(a||On(b,"get",T),d)?o:ar(o)?!z||!w_(T)?o.value:o:Tr(o)?a?p0(o):Fo(o):o}}const Y2=l0(),J2=l0(!0);function l0(a=!1){return function(g,b,T,I){let z=g[b];if(_c(z)&&ar(z)&&!ar(T))return!1;if(!a&&!_c(T)&&(f0(T)||(T=Oi(T),z=Oi(z)),!Yt(g)&&ar(z)&&!ar(T)))return z.value=T,!0;const o=Yt(g)&&w_(b)?Number(b)<g.length:Bi(g,b),k=Reflect.set(g,b,T,I);return g===Oi(I)&&(o?mh(T,z)&&ls(g,"set",b,T):ls(g,"add",b,T)),k}}function Q2(a,d){const g=Bi(a,d);a[d];const b=Reflect.deleteProperty(a,d);return b&&g&&ls(a,"delete",d,void 0),b}function eT(a,d){const g=Reflect.has(a,d);return(!v_(d)||!a0.has(d))&&On(a,"has",d),g}function tT(a){return On(a,"iterate",Yt(a)?"length":Ja),Reflect.ownKeys(a)}const c0={get:W2,set:Y2,deleteProperty:Q2,has:eT,ownKeys:tT},iT={get:H2,set(a,d){return!0},deleteProperty(a,d){return!0}},rT=Wr({},c0,{get:X2,set:J2}),A_=a=>a,Lp=a=>Reflect.getPrototypeOf(a);function rp(a,d,g=!1,b=!1){a=a.__v_raw;const T=Oi(a),I=Oi(d);d!==I&&!g&&On(T,"get",d),!g&&On(T,"get",I);const{has:z}=Lp(T),o=b?A_:g?M_:gh;if(z.call(T,d))return o(a.get(d));if(z.call(T,I))return o(a.get(I));a!==T&&a.get(d)}function np(a,d=!1){const g=this.__v_raw,b=Oi(g),T=Oi(a);return a!==T&&!d&&On(b,"has",a),!d&&On(b,"has",T),a===T?g.has(a):g.has(a)||g.has(T)}function op(a,d=!1){return a=a.__v_raw,!d&&On(Oi(a),"iterate",Ja),Reflect.get(a,"size",a)}function Lx(a){a=Oi(a);const d=Oi(this);return Lp(d).has.call(d,a)||(d.add(a),ls(d,"add",a,a)),this}function Rx(a,d){d=Oi(d);const g=Oi(this),{has:b,get:T}=Lp(g);let I=b.call(g,a);I||(a=Oi(a),I=b.call(g,a));const z=T.call(g,a);return g.set(a,d),I?mh(d,z)&&ls(g,"set",a,d):ls(g,"add",a,d),this}function Bx(a){const d=Oi(this),{has:g,get:b}=Lp(d);let T=g.call(d,a);T||(a=Oi(a),T=g.call(d,a)),b&&b.call(d,a);const I=d.delete(a);return T&&ls(d,"delete",a,void 0),I}function Ox(){const a=Oi(this),d=a.size!==0,g=a.clear();return d&&ls(a,"clear",void 0,void 0),g}function sp(a,d){return function(b,T){const I=this,z=I.__v_raw,o=Oi(z),k=d?A_:a?M_:gh;return!a&&On(o,"iterate",Ja),z.forEach((j,F)=>b.call(T,k(j),k(F),I))}}function ap(a,d,g){return function(...b){const T=this.__v_raw,I=Oi(T),z=fc(I),o=a==="entries"||a===Symbol.iterator&&z,k=a==="keys"&&z,j=T[a](...b),F=g?A_:d?M_:gh;return!d&&On(I,"iterate",k?Fm:Ja),{next(){const{value:B,done:$}=j.next();return $?{value:B,done:$}:{value:o?[F(B[0]),F(B[1])]:F(B),done:$}},[Symbol.iterator](){return this}}}}function Us(a){return function(...d){return a==="delete"?!1:this}}function nT(){const a={get(I){return rp(this,I)},get size(){return op(this)},has:np,add:Lx,set:Rx,delete:Bx,clear:Ox,forEach:sp(!1,!1)},d={get(I){return rp(this,I,!1,!0)},get size(){return op(this)},has:np,add:Lx,set:Rx,delete:Bx,clear:Ox,forEach:sp(!1,!0)},g={get(I){return rp(this,I,!0)},get size(){return op(this,!0)},has(I){return np.call(this,I,!0)},add:Us("add"),set:Us("set"),delete:Us("delete"),clear:Us("clear"),forEach:sp(!0,!1)},b={get(I){return rp(this,I,!0,!0)},get size(){return op(this,!0)},has(I){return np.call(this,I,!0)},add:Us("add"),set:Us("set"),delete:Us("delete"),clear:Us("clear"),forEach:sp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(I=>{a[I]=ap(I,!1,!1),g[I]=ap(I,!0,!1),d[I]=ap(I,!1,!0),b[I]=ap(I,!0,!0)}),[a,g,d,b]}const[oT,sT,aT,lT]=nT();function I_(a,d){const g=d?a?lT:aT:a?sT:oT;return(b,T,I)=>T==="__v_isReactive"?!a:T==="__v_isReadonly"?a:T==="__v_raw"?b:Reflect.get(Bi(g,T)&&T in b?g:b,T,I)}const cT={get:I_(!1,!1)},uT={get:I_(!1,!0)},hT={get:I_(!0,!1)},u0=new WeakMap,h0=new WeakMap,d0=new WeakMap,dT=new WeakMap;function pT(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function fT(a){return a.__v_skip||!Object.isExtensible(a)?0:pT(U2(a))}function Fo(a){return _c(a)?a:C_(a,!1,c0,cT,u0)}function mT(a){return C_(a,!1,rT,uT,h0)}function p0(a){return C_(a,!0,iT,hT,d0)}function C_(a,d,g,b,T){if(!Tr(a)||a.__v_raw&&!(d&&a.__v_isReactive))return a;const I=T.get(a);if(I)return I;const z=fT(a);if(z===0)return a;const o=new Proxy(a,z===2?b:g);return T.set(a,o),o}function as(a){return _c(a)?as(a.__v_raw):!!(a&&a.__v_isReactive)}function _c(a){return!!(a&&a.__v_isReadonly)}function f0(a){return!!(a&&a.__v_isShallow)}function m0(a){return as(a)||_c(a)}function Oi(a){const d=a&&a.__v_raw;return d?Oi(d):a}function gc(a){return bp(a,"__v_skip",!0),a}const gh=a=>Tr(a)?Fo(a):a,M_=a=>Tr(a)?p0(a):a;function _0(a){Hs&&Bo&&(a=Oi(a),s0(a.dep||(a.dep=T_())))}function g0(a,d){a=Oi(a),a.dep&&Um(a.dep)}function ar(a){return!!(a&&a.__v_isRef===!0)}function $t(a){return y0(a,!1)}function _T(a){return y0(a,!0)}function y0(a,d){return ar(a)?a:new gT(a,d)}class gT{constructor(d,g){this.__v_isShallow=g,this.dep=void 0,this.__v_isRef=!0,this._rawValue=g?d:Oi(d),this._value=g?d:gh(d)}get value(){return _0(this),this._value}set value(d){d=this.__v_isShallow?d:Oi(d),mh(d,this._rawValue)&&(this._rawValue=d,this._value=this.__v_isShallow?d:gh(d),g0(this))}}function hi(a){return ar(a)?a.value:a}const yT={get:(a,d,g)=>hi(Reflect.get(a,d,g)),set:(a,d,g,b)=>{const T=a[d];return ar(T)&&!ar(g)?(T.value=g,!0):Reflect.set(a,d,g,b)}};function x0(a){return as(a)?a:new Proxy(a,yT)}function xT(a){const d=Yt(a)?new Array(a.length):{};for(const g in a)d[g]=bT(a,g);return d}class vT{constructor(d,g,b){this._object=d,this._key=g,this._defaultValue=b,this.__v_isRef=!0}get value(){const d=this._object[this._key];return d===void 0?this._defaultValue:d}set value(d){this._object[this._key]=d}}function bT(a,d,g){const b=a[d];return ar(b)?b:new vT(a,d,g)}class wT{constructor(d,g,b,T){this._setter=g,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new E_(d,()=>{this._dirty||(this._dirty=!0,g0(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!T,this.__v_isReadonly=b}get value(){const d=Oi(this);return _0(d),(d._dirty||!d._cacheable)&&(d._dirty=!1,d._value=d.effect.run()),d._value}set value(d){this._setter(d)}}function TT(a,d,g=!1){let b,T;const I=ai(a);return I?(b=a,T=co):(b=a.get,T=a.set),new wT(b,T,I||!T,g)}Promise.resolve();function Ks(a,d,g,b){let T;try{T=b?a(...b):a()}catch(I){Th(I,d,g)}return T}function Wn(a,d,g,b){if(ai(a)){const I=Ks(a,d,g,b);return I&&b_(I)&&I.catch(z=>{Th(z,d,g)}),I}const T=[];for(let I=0;I<a.length;I++)T.push(Wn(a[I],d,g,b));return T}function Th(a,d,g,b=!0){const T=d?d.vnode:null;if(d){let I=d.parent;const z=d.proxy,o=g;for(;I;){const j=I.ec;if(j){for(let F=0;F<j.length;F++)if(j[F](a,z,o)===!1)return}I=I.parent}const k=d.appContext.config.errorHandler;if(k){Ks(k,null,10,[a,z,o]);return}}ET(a,g,T,b)}function ET(a,d,g,b=!0){console.error(a)}let wp=!1,jm=!1;const Dn=[];let ss=0;const lh=[];let oh=null,cc=0;const ch=[];let Gs=null,uc=0;const v0=Promise.resolve();let z_=null,Nm=null;function Rn(a){const d=z_||v0;return a?d.then(this?a.bind(this):a):d}function ST(a){let d=ss+1,g=Dn.length;for(;d<g;){const b=d+g>>>1;yh(Dn[b])<a?d=b+1:g=b}return d}function b0(a){(!Dn.length||!Dn.includes(a,wp&&a.allowRecurse?ss+1:ss))&&a!==Nm&&(a.id==null?Dn.push(a):Dn.splice(ST(a.id),0,a),w0())}function w0(){!wp&&!jm&&(jm=!0,z_=v0.then(A0))}function AT(a){const d=Dn.indexOf(a);d>ss&&Dn.splice(d,1)}function T0(a,d,g,b){Yt(a)?g.push(...a):(!d||!d.includes(a,a.allowRecurse?b+1:b))&&g.push(a),w0()}function IT(a){T0(a,oh,lh,cc)}function E0(a){T0(a,Gs,ch,uc)}function P_(a,d=null){if(lh.length){for(Nm=d,oh=[...new Set(lh)],lh.length=0,cc=0;cc<oh.length;cc++)oh[cc]();oh=null,cc=0,Nm=null,P_(a,d)}}function S0(a){if(ch.length){const d=[...new Set(ch)];if(ch.length=0,Gs){Gs.push(...d);return}for(Gs=d,Gs.sort((g,b)=>yh(g)-yh(b)),uc=0;uc<Gs.length;uc++)Gs[uc]();Gs=null,uc=0}}const yh=a=>a.id==null?1/0:a.id;function A0(a){jm=!1,wp=!0,P_(a),Dn.sort((g,b)=>yh(g)-yh(b));const d=co;try{for(ss=0;ss<Dn.length;ss++){const g=Dn[ss];g&&g.active!==!1&&Ks(g,null,14)}}finally{ss=0,Dn.length=0,S0(),wp=!1,z_=null,(Dn.length||lh.length||ch.length)&&A0(a)}}function CT(a,d,...g){const b=a.vnode.props||tr;let T=g;const I=d.startsWith("update:"),z=I&&d.slice(7);if(z&&z in b){const F=`${z==="modelValue"?"model":z}Modifiers`,{number:B,trim:$}=b[F]||tr;$?T=g.map(ne=>ne.trim()):B&&(T=g.map(_h))}let o,k=b[o=vm(d)]||b[o=vm(Oo(d))];!k&&I&&(k=b[o=vm(bc(d))]),k&&Wn(k,a,6,T);const j=b[o+"Once"];if(j){if(!a.emitted)a.emitted={};else if(a.emitted[o])return;a.emitted[o]=!0,Wn(j,a,6,T)}}function I0(a,d,g=!1){const b=d.emitsCache,T=b.get(a);if(T!==void 0)return T;const I=a.emits;let z={},o=!1;if(!ai(a)){const k=j=>{const F=I0(j,d,!0);F&&(o=!0,Wr(z,F))};!g&&d.mixins.length&&d.mixins.forEach(k),a.extends&&k(a.extends),a.mixins&&a.mixins.forEach(k)}return!I&&!o?(b.set(a,null),null):(Yt(I)?I.forEach(k=>z[k]=null):Wr(z,I),b.set(a,z),z)}function k_(a,d){return!a||!zp(d)?!1:(d=d.slice(2).replace(/Once$/,""),Bi(a,d[0].toLowerCase()+d.slice(1))||Bi(a,bc(d))||Bi(a,d))}let Zn=null,C0=null;function Tp(a){const d=Zn;return Zn=a,C0=a&&a.type.__scopeId||null,d}function MT(a,d=Zn,g){if(!d||a._n)return a;const b=(...T)=>{b._d&&Kx(-1);const I=Tp(d),z=a(...T);return Tp(I),b._d&&Kx(1),z};return b._n=!0,b._c=!0,b._d=!0,b}function bm(a){const{type:d,vnode:g,proxy:b,withProxy:T,props:I,propsOptions:[z],slots:o,attrs:k,emit:j,render:F,renderCache:B,data:$,setupState:ne,ctx:oe,inheritAttrs:ve}=a;let Ie,Ge;const qe=Tp(a);try{if(g.shapeFlag&4){const ft=T||b;Ie=lo(F.call(ft,ft,B,I,ne,$,oe)),Ge=k}else{const ft=d;Ie=lo(ft.length>1?ft(I,{attrs:k,slots:o,emit:j}):ft(I,null)),Ge=d.props?k:PT(k)}}catch(ft){hh.length=0,Th(ft,a,1),Ie=ki(Xn)}let st=Ie;if(Ge&&ve!==!1){const ft=Object.keys(Ge),{shapeFlag:He}=st;ft.length&&He&7&&(z&&ft.some(y_)&&(Ge=kT(Ge,z)),st=Qa(st,Ge))}return g.dirs&&(st.dirs=st.dirs?st.dirs.concat(g.dirs):g.dirs),g.transition&&(st.transition=g.transition),Ie=st,Tp(qe),Ie}function zT(a){let d;for(let g=0;g<a.length;g++){const b=a[g];if(Sp(b)){if(b.type!==Xn||b.children==="v-if"){if(d)return;d=b}}else return}return d}const PT=a=>{let d;for(const g in a)(g==="class"||g==="style"||zp(g))&&((d||(d={}))[g]=a[g]);return d},kT=(a,d)=>{const g={};for(const b in a)(!y_(b)||!(b.slice(9)in d))&&(g[b]=a[b]);return g};function DT(a,d,g){const{props:b,children:T,component:I}=a,{props:z,children:o,patchFlag:k}=d,j=I.emitsOptions;if(d.dirs||d.transition)return!0;if(g&&k>=0){if(k&1024)return!0;if(k&16)return b?Fx(b,z,j):!!z;if(k&8){const F=d.dynamicProps;for(let B=0;B<F.length;B++){const $=F[B];if(z[$]!==b[$]&&!k_(j,$))return!0}}}else return(T||o)&&(!o||!o.$stable)?!0:b===z?!1:b?z?Fx(b,z,j):!0:!!z;return!1}function Fx(a,d,g){const b=Object.keys(d);if(b.length!==Object.keys(a).length)return!0;for(let T=0;T<b.length;T++){const I=b[T];if(d[I]!==a[I]&&!k_(g,I))return!0}return!1}function D_({vnode:a,parent:d},g){for(;d&&d.subTree===a;)(a=d.vnode).el=g,d=d.parent}const LT=a=>a.__isSuspense,RT={name:"Suspense",__isSuspense:!0,process(a,d,g,b,T,I,z,o,k,j){a==null?BT(d,g,b,T,I,z,o,k,j):OT(a,d,g,b,T,z,o,k,j)},hydrate:FT,create:L_,normalize:UT},$C=RT;function xh(a,d){const g=a.props&&a.props[d];ai(g)&&g()}function BT(a,d,g,b,T,I,z,o,k){const{p:j,o:{createElement:F}}=k,B=F("div"),$=a.suspense=L_(a,T,b,d,B,g,I,z,o,k);j(null,$.pendingBranch=a.ssContent,B,null,b,$,I,z),$.deps>0?(xh(a,"onPending"),xh(a,"onFallback"),j(null,a.ssFallback,d,g,b,null,I,z),mc($,a.ssFallback)):$.resolve()}function OT(a,d,g,b,T,I,z,o,{p:k,um:j,o:{createElement:F}}){const B=d.suspense=a.suspense;B.vnode=d,d.el=a.el;const $=d.ssContent,ne=d.ssFallback,{activeBranch:oe,pendingBranch:ve,isInFallback:Ie,isHydrating:Ge}=B;if(ve)B.pendingBranch=$,Ro($,ve)?(k(ve,$,B.hiddenContainer,null,T,B,I,z,o),B.deps<=0?B.resolve():Ie&&(k(oe,ne,g,b,T,null,I,z,o),mc(B,ne))):(B.pendingId++,Ge?(B.isHydrating=!1,B.activeBranch=ve):j(ve,T,B),B.deps=0,B.effects.length=0,B.hiddenContainer=F("div"),Ie?(k(null,$,B.hiddenContainer,null,T,B,I,z,o),B.deps<=0?B.resolve():(k(oe,ne,g,b,T,null,I,z,o),mc(B,ne))):oe&&Ro($,oe)?(k(oe,$,g,b,T,B,I,z,o),B.resolve(!0)):(k(null,$,B.hiddenContainer,null,T,B,I,z,o),B.deps<=0&&B.resolve()));else if(oe&&Ro($,oe))k(oe,$,g,b,T,B,I,z,o),mc(B,$);else if(xh(d,"onPending"),B.pendingBranch=$,B.pendingId++,k(null,$,B.hiddenContainer,null,T,B,I,z,o),B.deps<=0)B.resolve();else{const{timeout:qe,pendingId:st}=B;qe>0?setTimeout(()=>{B.pendingId===st&&B.fallback(ne)},qe):qe===0&&B.fallback(ne)}}function L_(a,d,g,b,T,I,z,o,k,j,F=!1){const{p:B,m:$,um:ne,n:oe,o:{parentNode:ve,remove:Ie}}=j,Ge=_h(a.props&&a.props.timeout),qe={vnode:a,parent:d,parentComponent:g,isSVG:z,container:b,hiddenContainer:T,anchor:I,deps:0,pendingId:0,timeout:typeof Ge=="number"?Ge:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:F,isUnmounted:!1,effects:[],resolve(st=!1){const{vnode:ft,activeBranch:He,pendingBranch:yt,pendingId:We,effects:xt,parentComponent:Et,container:gt}=qe;if(qe.isHydrating)qe.isHydrating=!1;else if(!st){const ei=He&&yt.transition&&yt.transition.mode==="out-in";ei&&(He.transition.afterLeave=()=>{We===qe.pendingId&&$(yt,gt,ri,0)});let{anchor:ri}=qe;He&&(ri=oe(He),ne(He,Et,qe,!0)),ei||$(yt,gt,ri,0)}mc(qe,yt),qe.pendingBranch=null,qe.isInFallback=!1;let Ft=qe.parent,bt=!1;for(;Ft;){if(Ft.pendingBranch){Ft.effects.push(...xt),bt=!0;break}Ft=Ft.parent}bt||E0(xt),qe.effects=[],xh(ft,"onResolve")},fallback(st){if(!qe.pendingBranch)return;const{vnode:ft,activeBranch:He,parentComponent:yt,container:We,isSVG:xt}=qe;xh(ft,"onFallback");const Et=oe(He),gt=()=>{!qe.isInFallback||(B(null,st,We,Et,yt,null,xt,o,k),mc(qe,st))},Ft=st.transition&&st.transition.mode==="out-in";Ft&&(He.transition.afterLeave=gt),qe.isInFallback=!0,ne(He,yt,null,!0),Ft||gt()},move(st,ft,He){qe.activeBranch&&$(qe.activeBranch,st,ft,He),qe.container=st},next(){return qe.activeBranch&&oe(qe.activeBranch)},registerDep(st,ft){const He=!!qe.pendingBranch;He&&qe.deps++;const yt=st.vnode.el;st.asyncDep.catch(We=>{Th(We,st,0)}).then(We=>{if(st.isUnmounted||qe.isUnmounted||qe.pendingId!==st.suspenseId)return;st.asyncResolved=!0;const{vnode:xt}=st;Ym(st,We,!1),yt&&(xt.el=yt);const Et=!yt&&st.subTree.el;ft(st,xt,ve(yt||st.subTree.el),yt?null:oe(st.subTree),qe,z,k),Et&&Ie(Et),D_(st,xt.el),He&&--qe.deps===0&&qe.resolve()})},unmount(st,ft){qe.isUnmounted=!0,qe.activeBranch&&ne(qe.activeBranch,g,st,ft),qe.pendingBranch&&ne(qe.pendingBranch,g,st,ft)}};return qe}function FT(a,d,g,b,T,I,z,o,k){const j=d.suspense=L_(d,b,g,a.parentNode,document.createElement("div"),null,T,I,z,o,!0),F=k(a,j.pendingBranch=d.ssContent,g,j,I,z);return j.deps===0&&j.resolve(),F}function UT(a){const{shapeFlag:d,children:g}=a,b=d&32;a.ssContent=Ux(b?g.default:g),a.ssFallback=b?Ux(g.fallback):ki(Xn)}function Ux(a){let d;if(ai(a)){const g=vh&&a._c;g&&(a._d=!1,zr()),a=a(),g&&(a._d=!0,d=Ys,q0())}return Yt(a)&&(a=zT(a)),a=lo(a),d&&!a.dynamicChildren&&(a.dynamicChildren=d.filter(g=>g!==a)),a}function jT(a,d){d&&d.pendingBranch?Yt(a)?d.effects.push(...a):d.effects.push(a):E0(a)}function mc(a,d){a.activeBranch=d;const{vnode:g,parentComponent:b}=a,T=g.el=d.el;b&&b.subTree===g&&(b.vnode.el=T,D_(b,T))}function br(a,d){if(Ur){let g=Ur.provides;const b=Ur.parent&&Ur.parent.provides;b===g&&(g=Ur.provides=Object.create(b)),g[a]=d}}function ir(a,d,g=!1){const b=Ur||Zn;if(b){const T=b.parent==null?b.vnode.appContext&&b.vnode.appContext.provides:b.parent.provides;if(T&&a in T)return T[a];if(arguments.length>1)return g&&ai(d)?d.call(b.proxy):d}}function wn(a,d){return R_(a,null,d)}const jx={};function bn(a,d,g){return R_(a,d,g)}function R_(a,d,{immediate:g,deep:b,flush:T,onTrack:I,onTrigger:z}=tr){const o=Ur;let k,j=!1,F=!1;if(ar(a)?(k=()=>a.value,j=f0(a)):as(a)?(k=()=>a,b=!0):Yt(a)?(F=!0,j=a.some(as),k=()=>a.map(Ge=>{if(ar(Ge))return Ge.value;if(as(Ge))return Ya(Ge);if(ai(Ge))return Ks(Ge,o,2)})):ai(a)?d?k=()=>Ks(a,o,2):k=()=>{if(!(o&&o.isUnmounted))return B&&B(),Wn(a,o,3,[$])}:k=co,d&&b){const Ge=k;k=()=>Ya(Ge())}let B,$=Ge=>{B=Ie.onStop=()=>{Ks(Ge,o,4)}};if(bh)return $=co,d?g&&Wn(d,o,3,[k(),F?[]:void 0,$]):k(),co;let ne=F?[]:jx;const oe=()=>{if(!!Ie.active)if(d){const Ge=Ie.run();(b||j||(F?Ge.some((qe,st)=>mh(qe,ne[st])):mh(Ge,ne)))&&(B&&B(),Wn(d,o,3,[Ge,ne===jx?void 0:ne,$]),ne=Ge)}else Ie.run()};oe.allowRecurse=!!d;let ve;T==="sync"?ve=oe:T==="post"?ve=()=>vn(oe,o&&o.suspense):ve=()=>{!o||o.isMounted?IT(oe):oe()};const Ie=new E_(k,ve);return d?g?oe():ne=Ie.run():T==="post"?vn(Ie.run.bind(Ie),o&&o.suspense):Ie.run(),()=>{Ie.stop(),o&&o.scope&&x_(o.scope.effects,Ie)}}function NT(a,d,g){const b=this.proxy,T=wr(a)?a.includes(".")?M0(b,a):()=>b[a]:a.bind(b,b);let I;ai(d)?I=d:(I=d.handler,g=d);const z=Ur;ea(this);const o=R_(T,I.bind(b),g);return z?ea(z):Js(),o}function M0(a,d){const g=d.split(".");return()=>{let b=a;for(let T=0;T<g.length&&b;T++)b=b[g[T]];return b}}function Ya(a,d){if(!Tr(a)||a.__v_skip||(d=d||new Set,d.has(a)))return a;if(d.add(a),ar(a))Ya(a.value,d);else if(Yt(a))for(let g=0;g<a.length;g++)Ya(a[g],d);else if(Jv(a)||fc(a))a.forEach(g=>{Ya(g,d)});else if(e0(a))for(const g in a)Ya(a[g],d);return a}function VT(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return tn(()=>{a.isMounted=!0}),B_(()=>{a.isUnmounting=!0}),a}const qn=[Function,Array],$T={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:qn,onEnter:qn,onAfterEnter:qn,onEnterCancelled:qn,onBeforeLeave:qn,onLeave:qn,onAfterLeave:qn,onLeaveCancelled:qn,onBeforeAppear:qn,onAppear:qn,onAfterAppear:qn,onAppearCancelled:qn},setup(a,{slots:d}){const g=Eh(),b=VT();let T;return()=>{const I=d.default&&k0(d.default(),!0);if(!I||!I.length)return;const z=Oi(a),{mode:o}=z,k=I[0];if(b.isLeaving)return wm(k);const j=Nx(k);if(!j)return wm(k);const F=Vm(j,z,b,g);$m(j,F);const B=g.subTree,$=B&&Nx(B);let ne=!1;const{getTransitionKey:oe}=j.type;if(oe){const ve=oe();T===void 0?T=ve:ve!==T&&(T=ve,ne=!0)}if($&&$.type!==Xn&&(!Ro(j,$)||ne)){const ve=Vm($,z,b,g);if($m($,ve),o==="out-in")return b.isLeaving=!0,ve.afterLeave=()=>{b.isLeaving=!1,g.update()},wm(k);o==="in-out"&&j.type!==Xn&&(ve.delayLeave=(Ie,Ge,qe)=>{const st=P0(b,$);st[String($.key)]=$,Ie._leaveCb=()=>{Ge(),Ie._leaveCb=void 0,delete F.delayedLeave},F.delayedLeave=qe})}return k}}},z0=$T;function P0(a,d){const{leavingVNodes:g}=a;let b=g.get(d.type);return b||(b=Object.create(null),g.set(d.type,b)),b}function Vm(a,d,g,b){const{appear:T,mode:I,persisted:z=!1,onBeforeEnter:o,onEnter:k,onAfterEnter:j,onEnterCancelled:F,onBeforeLeave:B,onLeave:$,onAfterLeave:ne,onLeaveCancelled:oe,onBeforeAppear:ve,onAppear:Ie,onAfterAppear:Ge,onAppearCancelled:qe}=d,st=String(a.key),ft=P0(g,a),He=(We,xt)=>{We&&Wn(We,b,9,xt)},yt={mode:I,persisted:z,beforeEnter(We){let xt=o;if(!g.isMounted)if(T)xt=ve||o;else return;We._leaveCb&&We._leaveCb(!0);const Et=ft[st];Et&&Ro(a,Et)&&Et.el._leaveCb&&Et.el._leaveCb(),He(xt,[We])},enter(We){let xt=k,Et=j,gt=F;if(!g.isMounted)if(T)xt=Ie||k,Et=Ge||j,gt=qe||F;else return;let Ft=!1;const bt=We._enterCb=ei=>{Ft||(Ft=!0,ei?He(gt,[We]):He(Et,[We]),yt.delayedLeave&&yt.delayedLeave(),We._enterCb=void 0)};xt?(xt(We,bt),xt.length<=1&&bt()):bt()},leave(We,xt){const Et=String(a.key);if(We._enterCb&&We._enterCb(!0),g.isUnmounting)return xt();He(B,[We]);let gt=!1;const Ft=We._leaveCb=bt=>{gt||(gt=!0,xt(),bt?He(oe,[We]):He(ne,[We]),We._leaveCb=void 0,ft[Et]===a&&delete ft[Et])};ft[Et]=a,$?($(We,Ft),$.length<=1&&Ft()):Ft()},clone(We){return Vm(We,d,g,b)}};return yt}function wm(a){if(Rp(a))return a=Qa(a),a.children=null,a}function Nx(a){return Rp(a)?a.children?a.children[0]:void 0:a}function $m(a,d){a.shapeFlag&6&&a.component?$m(a.component.subTree,d):a.shapeFlag&128?(a.ssContent.transition=d.clone(a.ssContent),a.ssFallback.transition=d.clone(a.ssFallback)):a.transition=d}function k0(a,d=!1){let g=[],b=0;for(let T=0;T<a.length;T++){const I=a[T];I.type===ao?(I.patchFlag&128&&b++,g=g.concat(k0(I.children,d))):(d||I.type!==Xn)&&g.push(I)}if(b>1)for(let T=0;T<g.length;T++)g[T].patchFlag=-2;return g}function hr(a){return ai(a)?{setup:a,name:a.name}:a}const Gm=a=>!!a.type.__asyncLoader,Rp=a=>a.type.__isKeepAlive;function GT(a,d){D0(a,"a",d)}function qT(a,d){D0(a,"da",d)}function D0(a,d,g=Ur){const b=a.__wdc||(a.__wdc=()=>{let T=g;for(;T;){if(T.isDeactivated)return;T=T.parent}return a()});if(Bp(d,b,g),g){let T=g.parent;for(;T&&T.parent;)Rp(T.parent.vnode)&&ZT(b,d,g,T),T=T.parent}}function ZT(a,d,g,b){const T=Bp(d,a,b,!0);uo(()=>{x_(b[d],T)},g)}function Bp(a,d,g=Ur,b=!1){if(g){const T=g[a]||(g[a]=[]),I=d.__weh||(d.__weh=(...z)=>{if(g.isUnmounted)return;wc(),ea(g);const o=Wn(d,g,a,z);return Js(),Tc(),o});return b?T.unshift(I):T.push(I),I}}const cs=a=>(d,g=Ur)=>(!bh||a==="sp")&&Bp(a,d,g),L0=cs("bm"),tn=cs("m"),WT=cs("bu"),XT=cs("u"),B_=cs("bum"),uo=cs("um"),HT=cs("sp"),KT=cs("rtg"),YT=cs("rtc");function JT(a,d=Ur){Bp("ec",a,d)}let qm=!0;function QT(a){const d=B0(a),g=a.proxy,b=a.ctx;qm=!1,d.beforeCreate&&Vx(d.beforeCreate,a,"bc");const{data:T,computed:I,methods:z,watch:o,provide:k,inject:j,created:F,beforeMount:B,mounted:$,beforeUpdate:ne,updated:oe,activated:ve,deactivated:Ie,beforeDestroy:Ge,beforeUnmount:qe,destroyed:st,unmounted:ft,render:He,renderTracked:yt,renderTriggered:We,errorCaptured:xt,serverPrefetch:Et,expose:gt,inheritAttrs:Ft,components:bt,directives:ei,filters:ri}=d;if(j&&eE(j,b,null,a.appContext.config.unwrapInjectedRef),z)for(const fi in z){const Lt=z[fi];ai(Lt)&&(b[fi]=Lt.bind(g))}if(T){const fi=T.call(g,g);Tr(fi)&&(a.data=Fo(fi))}if(qm=!0,I)for(const fi in I){const Lt=I[fi],Gi=ai(Lt)?Lt.bind(g,g):ai(Lt.get)?Lt.get.bind(g,g):co,lr=!ai(Lt)&&ai(Lt.set)?Lt.set.bind(g):co,Nr=Dt({get:Gi,set:lr});Object.defineProperty(b,fi,{enumerable:!0,configurable:!0,get:()=>Nr.value,set:bi=>Nr.value=bi})}if(o)for(const fi in o)R0(o[fi],b,g,fi);if(k){const fi=ai(k)?k.call(g):k;Reflect.ownKeys(fi).forEach(Lt=>{br(Lt,fi[Lt])})}F&&Vx(F,a,"c");function vi(fi,Lt){Yt(Lt)?Lt.forEach(Gi=>fi(Gi.bind(g))):Lt&&fi(Lt.bind(g))}if(vi(L0,B),vi(tn,$),vi(WT,ne),vi(XT,oe),vi(GT,ve),vi(qT,Ie),vi(JT,xt),vi(YT,yt),vi(KT,We),vi(B_,qe),vi(uo,ft),vi(HT,Et),Yt(gt))if(gt.length){const fi=a.exposed||(a.exposed={});gt.forEach(Lt=>{Object.defineProperty(fi,Lt,{get:()=>g[Lt],set:Gi=>g[Lt]=Gi})})}else a.exposed||(a.exposed={});He&&a.render===co&&(a.render=He),Ft!=null&&(a.inheritAttrs=Ft),bt&&(a.components=bt),ei&&(a.directives=ei)}function eE(a,d,g=co,b=!1){Yt(a)&&(a=Zm(a));for(const T in a){const I=a[T];let z;Tr(I)?"default"in I?z=ir(I.from||T,I.default,!0):z=ir(I.from||T):z=ir(I),ar(z)&&b?Object.defineProperty(d,T,{enumerable:!0,configurable:!0,get:()=>z.value,set:o=>z.value=o}):d[T]=z}}function Vx(a,d,g){Wn(Yt(a)?a.map(b=>b.bind(d.proxy)):a.bind(d.proxy),d,g)}function R0(a,d,g,b){const T=b.includes(".")?M0(g,b):()=>g[b];if(wr(a)){const I=d[a];ai(I)&&bn(T,I)}else if(ai(a))bn(T,a.bind(g));else if(Tr(a))if(Yt(a))a.forEach(I=>R0(I,d,g,b));else{const I=ai(a.handler)?a.handler.bind(g):d[a.handler];ai(I)&&bn(T,I,a)}}function B0(a){const d=a.type,{mixins:g,extends:b}=d,{mixins:T,optionsCache:I,config:{optionMergeStrategies:z}}=a.appContext,o=I.get(d);let k;return o?k=o:!T.length&&!g&&!b?k=d:(k={},T.length&&T.forEach(j=>Ep(k,j,z,!0)),Ep(k,d,z)),I.set(d,k),k}function Ep(a,d,g,b=!1){const{mixins:T,extends:I}=d;I&&Ep(a,I,g,!0),T&&T.forEach(z=>Ep(a,z,g,!0));for(const z in d)if(!(b&&z==="expose")){const o=tE[z]||g&&g[z];a[z]=o?o(a[z],d[z]):d[z]}return a}const tE={data:$x,props:Ha,emits:Ha,methods:Ha,computed:Ha,beforeCreate:cn,created:cn,beforeMount:cn,mounted:cn,beforeUpdate:cn,updated:cn,beforeDestroy:cn,beforeUnmount:cn,destroyed:cn,unmounted:cn,activated:cn,deactivated:cn,errorCaptured:cn,serverPrefetch:cn,components:Ha,directives:Ha,watch:rE,provide:$x,inject:iE};function $x(a,d){return d?a?function(){return Wr(ai(a)?a.call(this,this):a,ai(d)?d.call(this,this):d)}:d:a}function iE(a,d){return Ha(Zm(a),Zm(d))}function Zm(a){if(Yt(a)){const d={};for(let g=0;g<a.length;g++)d[a[g]]=a[g];return d}return a}function cn(a,d){return a?[...new Set([].concat(a,d))]:d}function Ha(a,d){return a?Wr(Wr(Object.create(null),a),d):d}function rE(a,d){if(!a)return d;if(!d)return a;const g=Wr(Object.create(null),a);for(const b in d)g[b]=cn(a[b],d[b]);return g}function nE(a,d,g,b=!1){const T={},I={};bp(I,Op,1),a.propsDefaults=Object.create(null),O0(a,d,T,I);for(const z in a.propsOptions[0])z in T||(T[z]=void 0);g?a.props=b?T:mT(T):a.type.props?a.props=T:a.props=I,a.attrs=I}function oE(a,d,g,b){const{props:T,attrs:I,vnode:{patchFlag:z}}=a,o=Oi(T),[k]=a.propsOptions;let j=!1;if((b||z>0)&&!(z&16)){if(z&8){const F=a.vnode.dynamicProps;for(let B=0;B<F.length;B++){let $=F[B];const ne=d[$];if(k)if(Bi(I,$))ne!==I[$]&&(I[$]=ne,j=!0);else{const oe=Oo($);T[oe]=Wm(k,o,oe,ne,a,!1)}else ne!==I[$]&&(I[$]=ne,j=!0)}}}else{O0(a,d,T,I)&&(j=!0);let F;for(const B in o)(!d||!Bi(d,B)&&((F=bc(B))===B||!Bi(d,F)))&&(k?g&&(g[B]!==void 0||g[F]!==void 0)&&(T[B]=Wm(k,o,B,void 0,a,!0)):delete T[B]);if(I!==o)for(const B in I)(!d||!Bi(d,B)&&!0)&&(delete I[B],j=!0)}j&&ls(a,"set","$attrs")}function O0(a,d,g,b){const[T,I]=a.propsOptions;let z=!1,o;if(d)for(let k in d){if(fp(k))continue;const j=d[k];let F;T&&Bi(T,F=Oo(k))?!I||!I.includes(F)?g[F]=j:(o||(o={}))[F]=j:k_(a.emitsOptions,k)||(!(k in b)||j!==b[k])&&(b[k]=j,z=!0)}if(I){const k=Oi(g),j=o||tr;for(let F=0;F<I.length;F++){const B=I[F];g[B]=Wm(T,k,B,j[B],a,!Bi(j,B))}}return z}function Wm(a,d,g,b,T,I){const z=a[g];if(z!=null){const o=Bi(z,"default");if(o&&b===void 0){const k=z.default;if(z.type!==Function&&ai(k)){const{propsDefaults:j}=T;g in j?b=j[g]:(ea(T),b=j[g]=k.call(null,d),Js())}else b=k}z[0]&&(I&&!o?b=!1:z[1]&&(b===""||b===bc(g))&&(b=!0))}return b}function F0(a,d,g=!1){const b=d.propsCache,T=b.get(a);if(T)return T;const I=a.props,z={},o=[];let k=!1;if(!ai(a)){const F=B=>{k=!0;const[$,ne]=F0(B,d,!0);Wr(z,$),ne&&o.push(...ne)};!g&&d.mixins.length&&d.mixins.forEach(F),a.extends&&F(a.extends),a.mixins&&a.mixins.forEach(F)}if(!I&&!k)return b.set(a,pc),pc;if(Yt(I))for(let F=0;F<I.length;F++){const B=Oo(I[F]);Gx(B)&&(z[B]=tr)}else if(I)for(const F in I){const B=Oo(F);if(Gx(B)){const $=I[F],ne=z[B]=Yt($)||ai($)?{type:$}:$;if(ne){const oe=Wx(Boolean,ne.type),ve=Wx(String,ne.type);ne[0]=oe>-1,ne[1]=ve<0||oe<ve,(oe>-1||Bi(ne,"default"))&&o.push(B)}}}const j=[z,o];return b.set(a,j),j}function Gx(a){return a[0]!=="$"}function qx(a){const d=a&&a.toString().match(/^\s*function (\w+)/);return d?d[1]:a===null?"null":""}function Zx(a,d){return qx(a)===qx(d)}function Wx(a,d){return Yt(d)?d.findIndex(g=>Zx(g,a)):ai(d)&&Zx(d,a)?0:-1}const U0=a=>a[0]==="_"||a==="$stable",O_=a=>Yt(a)?a.map(lo):[lo(a)],sE=(a,d,g)=>{const b=MT((...T)=>O_(d(...T)),g);return b._c=!1,b},j0=(a,d,g)=>{const b=a._ctx;for(const T in a){if(U0(T))continue;const I=a[T];if(ai(I))d[T]=sE(T,I,b);else if(I!=null){const z=O_(I);d[T]=()=>z}}},N0=(a,d)=>{const g=O_(d);a.slots.default=()=>g},aE=(a,d)=>{if(a.vnode.shapeFlag&32){const g=d._;g?(a.slots=Oi(d),bp(d,"_",g)):j0(d,a.slots={})}else a.slots={},d&&N0(a,d);bp(a.slots,Op,1)},lE=(a,d,g)=>{const{vnode:b,slots:T}=a;let I=!0,z=tr;if(b.shapeFlag&32){const o=d._;o?g&&o===1?I=!1:(Wr(T,d),!g&&o===1&&delete T._):(I=!d.$stable,j0(d,T)),z=d}else d&&(N0(a,d),z={default:1});if(I)for(const o in T)!U0(o)&&!(o in z)&&delete T[o]};function GC(a,d){const g=Zn;if(g===null)return a;const b=g.proxy,T=a.dirs||(a.dirs=[]);for(let I=0;I<d.length;I++){let[z,o,k,j=tr]=d[I];ai(z)&&(z={mounted:z,updated:z}),z.deep&&Ya(o),T.push({dir:z,instance:b,value:o,oldValue:void 0,arg:k,modifiers:j})}return a}function qa(a,d,g,b){const T=a.dirs,I=d&&d.dirs;for(let z=0;z<T.length;z++){const o=T[z];I&&(o.oldValue=I[z].value);let k=o.dir[b];k&&(wc(),Wn(k,g,8,[a.el,o,a,d]),Tc())}}function V0(){return{app:null,config:{isNativeTag:B2,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let cE=0;function uE(a,d){return function(b,T=null){T!=null&&!Tr(T)&&(T=null);const I=V0(),z=new Set;let o=!1;const k=I.app={_uid:cE++,_component:b,_props:T,_container:null,_context:I,_instance:null,version:DE,get config(){return I.config},set config(j){},use(j,...F){return z.has(j)||(j&&ai(j.install)?(z.add(j),j.install(k,...F)):ai(j)&&(z.add(j),j(k,...F))),k},mixin(j){return I.mixins.includes(j)||I.mixins.push(j),k},component(j,F){return F?(I.components[j]=F,k):I.components[j]},directive(j,F){return F?(I.directives[j]=F,k):I.directives[j]},mount(j,F,B){if(!o){const $=ki(b,T);return $.appContext=I,F&&d?d($,j):a($,j,B),o=!0,k._container=j,j.__vue_app__=k,N_($.component)||$.component.proxy}},unmount(){o&&(a(null,k._container),delete k._container.__vue_app__)},provide(j,F){return I.provides[j]=F,k}};return k}}function Xm(a,d,g,b,T=!1){if(Yt(a)){a.forEach(($,ne)=>Xm($,d&&(Yt(d)?d[ne]:d),g,b,T));return}if(Gm(b)&&!T)return;const I=b.shapeFlag&4?N_(b.component)||b.component.proxy:b.el,z=T?null:I,{i:o,r:k}=a,j=d&&d.r,F=o.refs===tr?o.refs={}:o.refs,B=o.setupState;if(j!=null&&j!==k&&(wr(j)?(F[j]=null,Bi(B,j)&&(B[j]=null)):ar(j)&&(j.value=null)),ai(k))Ks(k,o,12,[z,F]);else{const $=wr(k),ne=ar(k);if($||ne){const oe=()=>{if(a.f){const ve=$?F[k]:k.value;T?Yt(ve)&&x_(ve,I):Yt(ve)?ve.includes(I)||ve.push(I):$?F[k]=[I]:(k.value=[I],a.k&&(F[a.k]=k.value))}else $?(F[k]=z,Bi(B,k)&&(B[k]=z)):ar(k)&&(k.value=z,a.k&&(F[a.k]=z))};z?(oe.id=-1,vn(oe,g)):oe()}}}const vn=jT;function hE(a){return dE(a)}function dE(a,d){const g=V2();g.__VUE__=!0;const{insert:b,remove:T,patchProp:I,createElement:z,createText:o,createComment:k,setText:j,setElementText:F,parentNode:B,nextSibling:$,setScopeId:ne=co,cloneNode:oe,insertStaticContent:ve}=a,Ie=(ce,_e,Pe,Ke=null,Xe=null,rt=null,vt=!1,Ue=null,lt=!!_e.dynamicChildren)=>{if(ce===_e)return;ce&&!Ro(ce,_e)&&(Ke=Pt(ce),Fi(ce,Xe,rt,!0),ce=null),_e.patchFlag===-2&&(lt=!1,_e.dynamicChildren=null);const{type:tt,ref:zt,shapeFlag:At}=_e;switch(tt){case U_:Ge(ce,_e,Pe,Ke);break;case Xn:qe(ce,_e,Pe,Ke);break;case _p:ce==null&&st(_e,Pe,Ke,vt);break;case ao:ei(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt);break;default:At&1?yt(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt):At&6?ri(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt):(At&64||At&128)&&tt.process(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt,yi)}zt!=null&&Xe&&Xm(zt,ce&&ce.ref,rt,_e||ce,!_e)},Ge=(ce,_e,Pe,Ke)=>{if(ce==null)b(_e.el=o(_e.children),Pe,Ke);else{const Xe=_e.el=ce.el;_e.children!==ce.children&&j(Xe,_e.children)}},qe=(ce,_e,Pe,Ke)=>{ce==null?b(_e.el=k(_e.children||""),Pe,Ke):_e.el=ce.el},st=(ce,_e,Pe,Ke)=>{[ce.el,ce.anchor]=ve(ce.children,_e,Pe,Ke,ce.el,ce.anchor)},ft=({el:ce,anchor:_e},Pe,Ke)=>{let Xe;for(;ce&&ce!==_e;)Xe=$(ce),b(ce,Pe,Ke),ce=Xe;b(_e,Pe,Ke)},He=({el:ce,anchor:_e})=>{let Pe;for(;ce&&ce!==_e;)Pe=$(ce),T(ce),ce=Pe;T(_e)},yt=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt)=>{vt=vt||_e.type==="svg",ce==null?We(_e,Pe,Ke,Xe,rt,vt,Ue,lt):gt(ce,_e,Xe,rt,vt,Ue,lt)},We=(ce,_e,Pe,Ke,Xe,rt,vt,Ue)=>{let lt,tt;const{type:zt,props:At,shapeFlag:Bt,transition:Gt,patchFlag:li,dirs:di}=ce;if(ce.el&&oe!==void 0&&li===-1)lt=ce.el=oe(ce.el);else{if(lt=ce.el=z(ce.type,rt,At&&At.is,At),Bt&8?F(lt,ce.children):Bt&16&&Et(ce.children,lt,null,Ke,Xe,rt&&zt!=="foreignObject",vt,Ue),di&&qa(ce,null,Ke,"created"),At){for(const Si in At)Si!=="value"&&!fp(Si)&&I(lt,Si,null,At[Si],rt,ce.children,Ke,Xe,ut);"value"in At&&I(lt,"value",null,At.value),(tt=At.onVnodeBeforeMount)&&Lo(tt,Ke,ce)}xt(lt,ce,ce.scopeId,vt,Ke)}di&&qa(ce,null,Ke,"beforeMount");const pi=(!Xe||Xe&&!Xe.pendingBranch)&&Gt&&!Gt.persisted;pi&&Gt.beforeEnter(lt),b(lt,_e,Pe),((tt=At&&At.onVnodeMounted)||pi||di)&&vn(()=>{tt&&Lo(tt,Ke,ce),pi&&Gt.enter(lt),di&&qa(ce,null,Ke,"mounted")},Xe)},xt=(ce,_e,Pe,Ke,Xe)=>{if(Pe&&ne(ce,Pe),Ke)for(let rt=0;rt<Ke.length;rt++)ne(ce,Ke[rt]);if(Xe){let rt=Xe.subTree;if(_e===rt){const vt=Xe.vnode;xt(ce,vt,vt.scopeId,vt.slotScopeIds,Xe.parent)}}},Et=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt=0)=>{for(let tt=lt;tt<ce.length;tt++){const zt=ce[tt]=Ue?Zs(ce[tt]):lo(ce[tt]);Ie(null,zt,_e,Pe,Ke,Xe,rt,vt,Ue)}},gt=(ce,_e,Pe,Ke,Xe,rt,vt)=>{const Ue=_e.el=ce.el;let{patchFlag:lt,dynamicChildren:tt,dirs:zt}=_e;lt|=ce.patchFlag&16;const At=ce.props||tr,Bt=_e.props||tr;let Gt;Pe&&Za(Pe,!1),(Gt=Bt.onVnodeBeforeUpdate)&&Lo(Gt,Pe,_e,ce),zt&&qa(_e,ce,Pe,"beforeUpdate"),Pe&&Za(Pe,!0);const li=Xe&&_e.type!=="foreignObject";if(tt?Ft(ce.dynamicChildren,tt,Ue,Pe,Ke,li,rt):vt||Gi(ce,_e,Ue,null,Pe,Ke,li,rt,!1),lt>0){if(lt&16)bt(Ue,_e,At,Bt,Pe,Ke,Xe);else if(lt&2&&At.class!==Bt.class&&I(Ue,"class",null,Bt.class,Xe),lt&4&&I(Ue,"style",At.style,Bt.style,Xe),lt&8){const di=_e.dynamicProps;for(let pi=0;pi<di.length;pi++){const Si=di[pi],Pr=At[Si],fr=Bt[Si];(fr!==Pr||Si==="value")&&I(Ue,Si,Pr,fr,Xe,ce.children,Pe,Ke,ut)}}lt&1&&ce.children!==_e.children&&F(Ue,_e.children)}else!vt&&tt==null&&bt(Ue,_e,At,Bt,Pe,Ke,Xe);((Gt=Bt.onVnodeUpdated)||zt)&&vn(()=>{Gt&&Lo(Gt,Pe,_e,ce),zt&&qa(_e,ce,Pe,"updated")},Ke)},Ft=(ce,_e,Pe,Ke,Xe,rt,vt)=>{for(let Ue=0;Ue<_e.length;Ue++){const lt=ce[Ue],tt=_e[Ue],zt=lt.el&&(lt.type===ao||!Ro(lt,tt)||lt.shapeFlag&70)?B(lt.el):Pe;Ie(lt,tt,zt,null,Ke,Xe,rt,vt,!0)}},bt=(ce,_e,Pe,Ke,Xe,rt,vt)=>{if(Pe!==Ke){for(const Ue in Ke){if(fp(Ue))continue;const lt=Ke[Ue],tt=Pe[Ue];lt!==tt&&Ue!=="value"&&I(ce,Ue,tt,lt,vt,_e.children,Xe,rt,ut)}if(Pe!==tr)for(const Ue in Pe)!fp(Ue)&&!(Ue in Ke)&&I(ce,Ue,Pe[Ue],null,vt,_e.children,Xe,rt,ut);"value"in Ke&&I(ce,"value",Pe.value,Ke.value)}},ei=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt)=>{const tt=_e.el=ce?ce.el:o(""),zt=_e.anchor=ce?ce.anchor:o("");let{patchFlag:At,dynamicChildren:Bt,slotScopeIds:Gt}=_e;Gt&&(Ue=Ue?Ue.concat(Gt):Gt),ce==null?(b(tt,Pe,Ke),b(zt,Pe,Ke),Et(_e.children,Pe,zt,Xe,rt,vt,Ue,lt)):At>0&&At&64&&Bt&&ce.dynamicChildren?(Ft(ce.dynamicChildren,Bt,Pe,Xe,rt,vt,Ue),(_e.key!=null||Xe&&_e===Xe.subTree)&&F_(ce,_e,!0)):Gi(ce,_e,Pe,zt,Xe,rt,vt,Ue,lt)},ri=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt)=>{_e.slotScopeIds=Ue,ce==null?_e.shapeFlag&512?Xe.ctx.activate(_e,Pe,Ke,vt,lt):Er(_e,Pe,Ke,Xe,rt,vt,lt):vi(ce,_e,lt)},Er=(ce,_e,Pe,Ke,Xe,rt,vt)=>{const Ue=ce.component=AE(ce,Ke,Xe);if(Rp(ce)&&(Ue.ctx.renderer=yi),IE(Ue),Ue.asyncDep){if(Xe&&Xe.registerDep(Ue,fi),!ce.el){const lt=Ue.subTree=ki(Xn);qe(null,lt,_e,Pe)}return}fi(Ue,ce,_e,Pe,Xe,rt,vt)},vi=(ce,_e,Pe)=>{const Ke=_e.component=ce.component;if(DT(ce,_e,Pe))if(Ke.asyncDep&&!Ke.asyncResolved){Lt(Ke,_e,Pe);return}else Ke.next=_e,AT(Ke.update),Ke.update();else _e.component=ce.component,_e.el=ce.el,Ke.vnode=_e},fi=(ce,_e,Pe,Ke,Xe,rt,vt)=>{const Ue=()=>{if(ce.isMounted){let{next:zt,bu:At,u:Bt,parent:Gt,vnode:li}=ce,di=zt,pi;Za(ce,!1),zt?(zt.el=li.el,Lt(ce,zt,vt)):zt=li,At&&mp(At),(pi=zt.props&&zt.props.onVnodeBeforeUpdate)&&Lo(pi,Gt,zt,li),Za(ce,!0);const Si=bm(ce),Pr=ce.subTree;ce.subTree=Si,Ie(Pr,Si,B(Pr.el),Pt(Pr),ce,Xe,rt),zt.el=Si.el,di===null&&D_(ce,Si.el),Bt&&vn(Bt,Xe),(pi=zt.props&&zt.props.onVnodeUpdated)&&vn(()=>Lo(pi,Gt,zt,li),Xe)}else{let zt;const{el:At,props:Bt}=_e,{bm:Gt,m:li,parent:di}=ce,pi=Gm(_e);if(Za(ce,!1),Gt&&mp(Gt),!pi&&(zt=Bt&&Bt.onVnodeBeforeMount)&&Lo(zt,di,_e),Za(ce,!0),At&&Zt){const Si=()=>{ce.subTree=bm(ce),Zt(At,ce.subTree,ce,Xe,null)};pi?_e.type.__asyncLoader().then(()=>!ce.isUnmounted&&Si()):Si()}else{const Si=ce.subTree=bm(ce);Ie(null,Si,Pe,Ke,ce,Xe,rt),_e.el=Si.el}if(li&&vn(li,Xe),!pi&&(zt=Bt&&Bt.onVnodeMounted)){const Si=_e;vn(()=>Lo(zt,di,Si),Xe)}_e.shapeFlag&256&&ce.a&&vn(ce.a,Xe),ce.isMounted=!0,_e=Pe=Ke=null}},lt=ce.effect=new E_(Ue,()=>b0(ce.update),ce.scope),tt=ce.update=lt.run.bind(lt);tt.id=ce.uid,Za(ce,!0),tt()},Lt=(ce,_e,Pe)=>{_e.component=ce;const Ke=ce.vnode.props;ce.vnode=_e,ce.next=null,oE(ce,_e.props,Ke,Pe),lE(ce,_e.children,Pe),wc(),P_(void 0,ce.update),Tc()},Gi=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt=!1)=>{const tt=ce&&ce.children,zt=ce?ce.shapeFlag:0,At=_e.children,{patchFlag:Bt,shapeFlag:Gt}=_e;if(Bt>0){if(Bt&128){Nr(tt,At,Pe,Ke,Xe,rt,vt,Ue,lt);return}else if(Bt&256){lr(tt,At,Pe,Ke,Xe,rt,vt,Ue,lt);return}}Gt&8?(zt&16&&ut(tt,Xe,rt),At!==tt&&F(Pe,At)):zt&16?Gt&16?Nr(tt,At,Pe,Ke,Xe,rt,vt,Ue,lt):ut(tt,Xe,rt,!0):(zt&8&&F(Pe,""),Gt&16&&Et(At,Pe,Ke,Xe,rt,vt,Ue,lt))},lr=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt)=>{ce=ce||pc,_e=_e||pc;const tt=ce.length,zt=_e.length,At=Math.min(tt,zt);let Bt;for(Bt=0;Bt<At;Bt++){const Gt=_e[Bt]=lt?Zs(_e[Bt]):lo(_e[Bt]);Ie(ce[Bt],Gt,Pe,null,Xe,rt,vt,Ue,lt)}tt>zt?ut(ce,Xe,rt,!0,!1,At):Et(_e,Pe,Ke,Xe,rt,vt,Ue,lt,At)},Nr=(ce,_e,Pe,Ke,Xe,rt,vt,Ue,lt)=>{let tt=0;const zt=_e.length;let At=ce.length-1,Bt=zt-1;for(;tt<=At&&tt<=Bt;){const Gt=ce[tt],li=_e[tt]=lt?Zs(_e[tt]):lo(_e[tt]);if(Ro(Gt,li))Ie(Gt,li,Pe,null,Xe,rt,vt,Ue,lt);else break;tt++}for(;tt<=At&&tt<=Bt;){const Gt=ce[At],li=_e[Bt]=lt?Zs(_e[Bt]):lo(_e[Bt]);if(Ro(Gt,li))Ie(Gt,li,Pe,null,Xe,rt,vt,Ue,lt);else break;At--,Bt--}if(tt>At){if(tt<=Bt){const Gt=Bt+1,li=Gt<zt?_e[Gt].el:Ke;for(;tt<=Bt;)Ie(null,_e[tt]=lt?Zs(_e[tt]):lo(_e[tt]),Pe,li,Xe,rt,vt,Ue,lt),tt++}}else if(tt>Bt)for(;tt<=At;)Fi(ce[tt],Xe,rt,!0),tt++;else{const Gt=tt,li=tt,di=new Map;for(tt=li;tt<=Bt;tt++){const gr=_e[tt]=lt?Zs(_e[tt]):lo(_e[tt]);gr.key!=null&&di.set(gr.key,tt)}let pi,Si=0;const Pr=Bt-li+1;let fr=!1,hn=0;const Un=new Array(Pr);for(tt=0;tt<Pr;tt++)Un[tt]=0;for(tt=Gt;tt<=At;tt++){const gr=ce[tt];if(Si>=Pr){Fi(gr,Xe,rt,!0);continue}let kr;if(gr.key!=null)kr=di.get(gr.key);else for(pi=li;pi<=Bt;pi++)if(Un[pi-li]===0&&Ro(gr,_e[pi])){kr=pi;break}kr===void 0?Fi(gr,Xe,rt,!0):(Un[kr-li]=tt+1,kr>=hn?hn=kr:fr=!0,Ie(gr,_e[kr],Pe,null,Xe,rt,vt,Ue,lt),Si++)}const ho=fr?pE(Un):pc;for(pi=ho.length-1,tt=Pr-1;tt>=0;tt--){const gr=li+tt,kr=_e[gr],po=gr+1<zt?_e[gr+1].el:Ke;Un[tt]===0?Ie(null,kr,Pe,po,Xe,rt,vt,Ue,lt):fr&&(pi<0||tt!==ho[pi]?bi(kr,Pe,po,2):pi--)}}},bi=(ce,_e,Pe,Ke,Xe=null)=>{const{el:rt,type:vt,transition:Ue,children:lt,shapeFlag:tt}=ce;if(tt&6){bi(ce.component.subTree,_e,Pe,Ke);return}if(tt&128){ce.suspense.move(_e,Pe,Ke);return}if(tt&64){vt.move(ce,_e,Pe,yi);return}if(vt===ao){b(rt,_e,Pe);for(let At=0;At<lt.length;At++)bi(lt[At],_e,Pe,Ke);b(ce.anchor,_e,Pe);return}if(vt===_p){ft(ce,_e,Pe);return}if(Ke!==2&&tt&1&&Ue)if(Ke===0)Ue.beforeEnter(rt),b(rt,_e,Pe),vn(()=>Ue.enter(rt),Xe);else{const{leave:At,delayLeave:Bt,afterLeave:Gt}=Ue,li=()=>b(rt,_e,Pe),di=()=>{At(rt,()=>{li(),Gt&&Gt()})};Bt?Bt(rt,li,di):di()}else b(rt,_e,Pe)},Fi=(ce,_e,Pe,Ke=!1,Xe=!1)=>{const{type:rt,props:vt,ref:Ue,children:lt,dynamicChildren:tt,shapeFlag:zt,patchFlag:At,dirs:Bt}=ce;if(Ue!=null&&Xm(Ue,null,Pe,ce,!0),zt&256){_e.ctx.deactivate(ce);return}const Gt=zt&1&&Bt,li=!Gm(ce);let di;if(li&&(di=vt&&vt.onVnodeBeforeUnmount)&&Lo(di,_e,ce),zt&6)St(ce.component,Pe,Ke);else{if(zt&128){ce.suspense.unmount(Pe,Ke);return}Gt&&qa(ce,null,_e,"beforeUnmount"),zt&64?ce.type.remove(ce,_e,Pe,Xe,yi,Ke):tt&&(rt!==ao||At>0&&At&64)?ut(tt,_e,Pe,!1,!0):(rt===ao&&At&384||!Xe&&zt&16)&&ut(lt,_e,Pe),Ke&&rn(ce)}(li&&(di=vt&&vt.onVnodeUnmounted)||Gt)&&vn(()=>{di&&Lo(di,_e,ce),Gt&&qa(ce,null,_e,"unmounted")},Pe)},rn=ce=>{const{type:_e,el:Pe,anchor:Ke,transition:Xe}=ce;if(_e===ao){$e(Pe,Ke);return}if(_e===_p){He(ce);return}const rt=()=>{T(Pe),Xe&&!Xe.persisted&&Xe.afterLeave&&Xe.afterLeave()};if(ce.shapeFlag&1&&Xe&&!Xe.persisted){const{leave:vt,delayLeave:Ue}=Xe,lt=()=>vt(Pe,rt);Ue?Ue(ce.el,rt,lt):lt()}else rt()},$e=(ce,_e)=>{let Pe;for(;ce!==_e;)Pe=$(ce),T(ce),ce=Pe;T(_e)},St=(ce,_e,Pe)=>{const{bum:Ke,scope:Xe,update:rt,subTree:vt,um:Ue}=ce;Ke&&mp(Ke),Xe.stop(),rt&&(rt.active=!1,Fi(vt,ce,_e,Pe)),Ue&&vn(Ue,_e),vn(()=>{ce.isUnmounted=!0},_e),_e&&_e.pendingBranch&&!_e.isUnmounted&&ce.asyncDep&&!ce.asyncResolved&&ce.suspenseId===_e.pendingId&&(_e.deps--,_e.deps===0&&_e.resolve())},ut=(ce,_e,Pe,Ke=!1,Xe=!1,rt=0)=>{for(let vt=rt;vt<ce.length;vt++)Fi(ce[vt],_e,Pe,Ke,Xe)},Pt=ce=>ce.shapeFlag&6?Pt(ce.component.subTree):ce.shapeFlag&128?ce.suspense.next():$(ce.anchor||ce.el),Ei=(ce,_e,Pe)=>{ce==null?_e._vnode&&Fi(_e._vnode,null,null,!0):Ie(_e._vnode||null,ce,_e,null,null,null,Pe),S0(),_e._vnode=ce},yi={p:Ie,um:Fi,m:bi,r:rn,mt:Er,mc:Et,pc:Gi,pbc:Ft,n:Pt,o:a};let ni,Zt;return d&&([ni,Zt]=d(yi)),{render:Ei,hydrate:ni,createApp:uE(Ei,ni)}}function Za({effect:a,update:d},g){a.allowRecurse=d.allowRecurse=g}function F_(a,d,g=!1){const b=a.children,T=d.children;if(Yt(b)&&Yt(T))for(let I=0;I<b.length;I++){const z=b[I];let o=T[I];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=T[I]=Zs(T[I]),o.el=z.el),g||F_(z,o))}}function pE(a){const d=a.slice(),g=[0];let b,T,I,z,o;const k=a.length;for(b=0;b<k;b++){const j=a[b];if(j!==0){if(T=g[g.length-1],a[T]<j){d[b]=T,g.push(b);continue}for(I=0,z=g.length-1;I<z;)o=I+z>>1,a[g[o]]<j?I=o+1:z=o;j<a[g[I]]&&(I>0&&(d[b]=g[I-1]),g[I]=b)}}for(I=g.length,z=g[I-1];I-- >0;)g[I]=z,z=d[z];return g}const fE=a=>a.__isTeleport,uh=a=>a&&(a.disabled||a.disabled===""),Xx=a=>typeof SVGElement!="undefined"&&a instanceof SVGElement,Hm=(a,d)=>{const g=a&&a.to;return wr(g)?d?d(g):null:g},mE={__isTeleport:!0,process(a,d,g,b,T,I,z,o,k,j){const{mc:F,pc:B,pbc:$,o:{insert:ne,querySelector:oe,createText:ve,createComment:Ie}}=j,Ge=uh(d.props);let{shapeFlag:qe,children:st,dynamicChildren:ft}=d;if(a==null){const He=d.el=ve(""),yt=d.anchor=ve("");ne(He,g,b),ne(yt,g,b);const We=d.target=Hm(d.props,oe),xt=d.targetAnchor=ve("");We&&(ne(xt,We),z=z||Xx(We));const Et=(gt,Ft)=>{qe&16&&F(st,gt,Ft,T,I,z,o,k)};Ge?Et(g,yt):We&&Et(We,xt)}else{d.el=a.el;const He=d.anchor=a.anchor,yt=d.target=a.target,We=d.targetAnchor=a.targetAnchor,xt=uh(a.props),Et=xt?g:yt,gt=xt?He:We;if(z=z||Xx(yt),ft?($(a.dynamicChildren,ft,Et,T,I,z,o),F_(a,d,!0)):k||B(a,d,Et,gt,T,I,z,o,!1),Ge)xt||lp(d,g,He,j,1);else if((d.props&&d.props.to)!==(a.props&&a.props.to)){const Ft=d.target=Hm(d.props,oe);Ft&&lp(d,Ft,null,j,0)}else xt&&lp(d,yt,We,j,1)}},remove(a,d,g,b,{um:T,o:{remove:I}},z){const{shapeFlag:o,children:k,anchor:j,targetAnchor:F,target:B,props:$}=a;if(B&&I(F),(z||!uh($))&&(I(j),o&16))for(let ne=0;ne<k.length;ne++){const oe=k[ne];T(oe,d,g,!0,!!oe.dynamicChildren)}},move:lp,hydrate:_E};function lp(a,d,g,{o:{insert:b},m:T},I=2){I===0&&b(a.targetAnchor,d,g);const{el:z,anchor:o,shapeFlag:k,children:j,props:F}=a,B=I===2;if(B&&b(z,d,g),(!B||uh(F))&&k&16)for(let $=0;$<j.length;$++)T(j[$],d,g,2);B&&b(o,d,g)}function _E(a,d,g,b,T,I,{o:{nextSibling:z,parentNode:o,querySelector:k}},j){const F=d.target=Hm(d.props,k);if(F){const B=F._lpa||F.firstChild;d.shapeFlag&16&&(uh(d.props)?(d.anchor=j(z(a),d,o(a),g,b,T,I),d.targetAnchor=B):(d.anchor=z(a),d.targetAnchor=j(B,d,F,g,b,T,I)),F._lpa=d.targetAnchor&&z(d.targetAnchor))}return d.anchor&&z(d.anchor)}const gE=mE,$0="components",G0=Symbol();function qC(a){return wr(a)?yE($0,a,!1)||a:a||G0}function yE(a,d,g=!0,b=!1){const T=Zn||Ur;if(T){const I=T.type;if(a===$0){const o=PE(I);if(o&&(o===d||o===Oo(d)||o===Dp(Oo(d))))return I}const z=Hx(T[a]||I[a],d)||Hx(T.appContext[a],d);return!z&&b?I:z}}function Hx(a,d){return a&&(a[d]||a[Oo(d)]||a[Dp(Oo(d))])}const ao=Symbol(void 0),U_=Symbol(void 0),Xn=Symbol(void 0),_p=Symbol(void 0),hh=[];let Ys=null;function zr(a=!1){hh.push(Ys=a?null:[])}function q0(){hh.pop(),Ys=hh[hh.length-1]||null}let vh=1;function Kx(a){vh+=a}function Z0(a){return a.dynamicChildren=vh>0?Ys||pc:null,q0(),vh>0&&Ys&&Ys.push(a),a}function ZC(a,d,g,b,T,I){return Z0(X0(a,d,g,b,T,I,!0))}function jr(a,d,g,b,T){return Z0(ki(a,d,g,b,T,!0))}function Sp(a){return a?a.__v_isVNode===!0:!1}function Ro(a,d){return a.type===d.type&&a.key===d.key}const Op="__vInternal",W0=({key:a})=>a!=null?a:null,gp=({ref:a,ref_key:d,ref_for:g})=>a!=null?wr(a)||ar(a)||ai(a)?{i:Zn,r:a,k:d,f:!!g}:a:null;function X0(a,d=null,g=null,b=0,T=null,I=a===ao?0:1,z=!1,o=!1){const k={__v_isVNode:!0,__v_skip:!0,type:a,props:d,key:d&&W0(d),ref:d&&gp(d),scopeId:C0,slotScopeIds:null,children:g,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:I,patchFlag:b,dynamicProps:T,dynamicChildren:null,appContext:null};return o?(j_(k,g),I&128&&a.normalize(k)):g&&(k.shapeFlag|=wr(g)?8:16),vh>0&&!z&&Ys&&(k.patchFlag>0||I&6)&&k.patchFlag!==32&&Ys.push(k),k}const ki=xE;function xE(a,d=null,g=null,b=0,T=null,I=!1){if((!a||a===G0)&&(a=Xn),Sp(a)){const o=Qa(a,d,!0);return g&&j_(o,g),o}if(kE(a)&&(a=a.__vccOpts),d){d=vE(d);let{class:o,style:k}=d;o&&!wr(o)&&(d.class=g_(o)),Tr(k)&&(m0(k)&&!Yt(k)&&(k=Wr({},k)),d.style=__(k))}const z=wr(a)?1:LT(a)?128:fE(a)?64:Tr(a)?4:ai(a)?2:0;return X0(a,d,g,b,T,z,I,!0)}function vE(a){return a?m0(a)||Op in a?Wr({},a):a:null}function Qa(a,d,g=!1){const{props:b,ref:T,patchFlag:I,children:z}=a,o=d?wE(b||{},d):b;return{__v_isVNode:!0,__v_skip:!0,type:a.type,props:o,key:o&&W0(o),ref:d&&d.ref?g&&T?Yt(T)?T.concat(gp(d)):[T,gp(d)]:gp(d):T,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:z,target:a.target,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:d&&a.type!==ao?I===-1?16:I|16:I,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:a.transition,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&Qa(a.ssContent),ssFallback:a.ssFallback&&Qa(a.ssFallback),el:a.el,anchor:a.anchor}}function bE(a=" ",d=0){return ki(U_,null,a,d)}function WC(a,d){const g=ki(_p,null,a);return g.staticCount=d,g}function XC(a="",d=!1){return d?(zr(),jr(Xn,null,a)):ki(Xn,null,a)}function lo(a){return a==null||typeof a=="boolean"?ki(Xn):Yt(a)?ki(ao,null,a.slice()):typeof a=="object"?Zs(a):ki(U_,null,String(a))}function Zs(a){return a.el===null||a.memo?a:Qa(a)}function j_(a,d){let g=0;const{shapeFlag:b}=a;if(d==null)d=null;else if(Yt(d))g=16;else if(typeof d=="object")if(b&65){const T=d.default;T&&(T._c&&(T._d=!1),j_(a,T()),T._c&&(T._d=!0));return}else{g=32;const T=d._;!T&&!(Op in d)?d._ctx=Zn:T===3&&Zn&&(Zn.slots._===1?d._=1:(d._=2,a.patchFlag|=1024))}else ai(d)?(d={default:d,_ctx:Zn},g=32):(d=String(d),b&64?(g=16,d=[bE(d)]):g=8);a.children=d,a.shapeFlag|=g}function wE(...a){const d={};for(let g=0;g<a.length;g++){const b=a[g];for(const T in b)if(T==="class")d.class!==b.class&&(d.class=g_([d.class,b.class]));else if(T==="style")d.style=__([d.style,b.style]);else if(zp(T)){const I=d[T],z=b[T];z&&I!==z&&!(Yt(I)&&I.includes(z))&&(d[T]=I?[].concat(I,z):z)}else T!==""&&(d[T]=b[T])}return d}function Lo(a,d,g,b=null){Wn(a,d,7,[g,b])}function HC(a,d,g,b){let T;const I=g&&g[b];if(Yt(a)||wr(a)){T=new Array(a.length);for(let z=0,o=a.length;z<o;z++)T[z]=d(a[z],z,void 0,I&&I[z])}else if(typeof a=="number"){T=new Array(a);for(let z=0;z<a;z++)T[z]=d(z+1,z,void 0,I&&I[z])}else if(Tr(a))if(a[Symbol.iterator])T=Array.from(a,(z,o)=>d(z,o,void 0,I&&I[o]));else{const z=Object.keys(a);T=new Array(z.length);for(let o=0,k=z.length;o<k;o++){const j=z[o];T[o]=d(a[j],j,o,I&&I[o])}}else T=[];return g&&(g[b]=T),T}const Km=a=>a?H0(a)?N_(a)||a.proxy:Km(a.parent):null,Ap=Wr(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>Km(a.parent),$root:a=>Km(a.root),$emit:a=>a.emit,$options:a=>B0(a),$forceUpdate:a=>()=>b0(a.update),$nextTick:a=>Rn.bind(a.proxy),$watch:a=>NT.bind(a)}),TE={get({_:a},d){const{ctx:g,setupState:b,data:T,props:I,accessCache:z,type:o,appContext:k}=a;let j;if(d[0]!=="$"){const ne=z[d];if(ne!==void 0)switch(ne){case 1:return b[d];case 2:return T[d];case 4:return g[d];case 3:return I[d]}else{if(b!==tr&&Bi(b,d))return z[d]=1,b[d];if(T!==tr&&Bi(T,d))return z[d]=2,T[d];if((j=a.propsOptions[0])&&Bi(j,d))return z[d]=3,I[d];if(g!==tr&&Bi(g,d))return z[d]=4,g[d];qm&&(z[d]=0)}}const F=Ap[d];let B,$;if(F)return d==="$attrs"&&On(a,"get",d),F(a);if((B=o.__cssModules)&&(B=B[d]))return B;if(g!==tr&&Bi(g,d))return z[d]=4,g[d];if($=k.config.globalProperties,Bi($,d))return $[d]},set({_:a},d,g){const{data:b,setupState:T,ctx:I}=a;return T!==tr&&Bi(T,d)?(T[d]=g,!0):b!==tr&&Bi(b,d)?(b[d]=g,!0):Bi(a.props,d)||d[0]==="$"&&d.slice(1)in a?!1:(I[d]=g,!0)},has({_:{data:a,setupState:d,accessCache:g,ctx:b,appContext:T,propsOptions:I}},z){let o;return!!g[z]||a!==tr&&Bi(a,z)||d!==tr&&Bi(d,z)||(o=I[0])&&Bi(o,z)||Bi(b,z)||Bi(Ap,z)||Bi(T.config.globalProperties,z)},defineProperty(a,d,g){return g.get!=null?this.set(a,d,g.get(),null):g.value!=null&&this.set(a,d,g.value,null),Reflect.defineProperty(a,d,g)}},EE=V0();let SE=0;function AE(a,d,g){const b=a.type,T=(d?d.appContext:a.appContext)||EE,I={uid:SE++,vnode:a,type:b,parent:d,appContext:T,root:null,next:null,subTree:null,effect:null,update:null,scope:new t0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(T.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:F0(b,T),emitsOptions:I0(b,T),emit:null,emitted:null,propsDefaults:tr,inheritAttrs:b.inheritAttrs,ctx:tr,data:tr,props:tr,attrs:tr,slots:tr,refs:tr,setupState:tr,setupContext:null,suspense:g,suspenseId:g?g.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return I.ctx={_:I},I.root=d?d.root:I,I.emit=CT.bind(null,I),a.ce&&a.ce(I),I}let Ur=null;const Eh=()=>Ur||Zn,ea=a=>{Ur=a,a.scope.on()},Js=()=>{Ur&&Ur.scope.off(),Ur=null};function H0(a){return a.vnode.shapeFlag&4}let bh=!1;function IE(a,d=!1){bh=d;const{props:g,children:b}=a.vnode,T=H0(a);nE(a,g,T,d),aE(a,b);const I=T?CE(a,d):void 0;return bh=!1,I}function CE(a,d){const g=a.type;a.accessCache=Object.create(null),a.proxy=gc(new Proxy(a.ctx,TE));const{setup:b}=g;if(b){const T=a.setupContext=b.length>1?zE(a):null;ea(a),wc();const I=Ks(b,a,0,[a.props,T]);if(Tc(),Js(),b_(I)){if(I.then(Js,Js),d)return I.then(z=>{Ym(a,z,d)}).catch(z=>{Th(z,a,0)});a.asyncDep=I}else Ym(a,I,d)}else K0(a,d)}function Ym(a,d,g){ai(d)?a.type.__ssrInlineRender?a.ssrRender=d:a.render=d:Tr(d)&&(a.setupState=x0(d)),K0(a,g)}let Yx;function K0(a,d,g){const b=a.type;if(!a.render){if(!d&&Yx&&!b.render){const T=b.template;if(T){const{isCustomElement:I,compilerOptions:z}=a.appContext.config,{delimiters:o,compilerOptions:k}=b,j=Wr(Wr({isCustomElement:I,delimiters:o},z),k);b.render=Yx(T,j)}}a.render=b.render||co}ea(a),wc(),QT(a),Tc(),Js()}function ME(a){return new Proxy(a.attrs,{get(d,g){return On(a,"get","$attrs"),d[g]}})}function zE(a){const d=b=>{a.exposed=b||{}};let g;return{get attrs(){return g||(g=ME(a))},slots:a.slots,emit:a.emit,expose:d}}function N_(a){if(a.exposed)return a.exposeProxy||(a.exposeProxy=new Proxy(x0(gc(a.exposed)),{get(d,g){if(g in d)return d[g];if(g in Ap)return Ap[g](a)}}))}function PE(a){return ai(a)&&a.displayName||a.name}function kE(a){return ai(a)&&"__vccOpts"in a}const Dt=(a,d)=>TT(a,d,bh);function KC(a){const d=Eh();let g=a();return Js(),b_(g)&&(g=g.catch(b=>{throw ea(d),b})),[g,()=>ea(d)]}function un(a,d,g){const b=arguments.length;return b===2?Tr(d)&&!Yt(d)?Sp(d)?ki(a,null,[d]):ki(a,d):ki(a,null,d):(b>3?g=Array.prototype.slice.call(arguments,2):b===3&&Sp(g)&&(g=[g]),ki(a,d,g))}const DE="3.2.31",LE="http://www.w3.org/2000/svg",Ka=typeof document!="undefined"?document:null,Jx=Ka&&Ka.createElement("template"),RE={insert:(a,d,g)=>{d.insertBefore(a,g||null)},remove:a=>{const d=a.parentNode;d&&d.removeChild(a)},createElement:(a,d,g,b)=>{const T=d?Ka.createElementNS(LE,a):Ka.createElement(a,g?{is:g}:void 0);return a==="select"&&b&&b.multiple!=null&&T.setAttribute("multiple",b.multiple),T},createText:a=>Ka.createTextNode(a),createComment:a=>Ka.createComment(a),setText:(a,d)=>{a.nodeValue=d},setElementText:(a,d)=>{a.textContent=d},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Ka.querySelector(a),setScopeId(a,d){a.setAttribute(d,"")},cloneNode(a){const d=a.cloneNode(!0);return"_value"in a&&(d._value=a._value),d},insertStaticContent(a,d,g,b,T,I){const z=g?g.previousSibling:d.lastChild;if(T&&(T===I||T.nextSibling))for(;d.insertBefore(T.cloneNode(!0),g),!(T===I||!(T=T.nextSibling)););else{Jx.innerHTML=b?`<svg>${a}</svg>`:a;const o=Jx.content;if(b){const k=o.firstChild;for(;k.firstChild;)o.appendChild(k.firstChild);o.removeChild(k)}d.insertBefore(o,g)}return[z?z.nextSibling:d.firstChild,g?g.previousSibling:d.lastChild]}};function BE(a,d,g){const b=a._vtc;b&&(d=(d?[d,...b]:[...b]).join(" ")),d==null?a.removeAttribute("class"):g?a.setAttribute("class",d):a.className=d}function OE(a,d,g){const b=a.style,T=wr(g);if(g&&!T){for(const I in g)Jm(b,I,g[I]);if(d&&!wr(d))for(const I in d)g[I]==null&&Jm(b,I,"")}else{const I=b.display;T?d!==g&&(b.cssText=g):d&&a.removeAttribute("style"),"_vod"in a&&(b.display=I)}}const Qx=/\s*!important$/;function Jm(a,d,g){if(Yt(g))g.forEach(b=>Jm(a,d,b));else if(d.startsWith("--"))a.setProperty(d,g);else{const b=FE(a,d);Qx.test(g)?a.setProperty(bc(b),g.replace(Qx,""),"important"):a[b]=g}}const ev=["Webkit","Moz","ms"],Tm={};function FE(a,d){const g=Tm[d];if(g)return g;let b=Oo(d);if(b!=="filter"&&b in a)return Tm[d]=b;b=Dp(b);for(let T=0;T<ev.length;T++){const I=ev[T]+b;if(I in a)return Tm[d]=I}return d}const tv="http://www.w3.org/1999/xlink";function UE(a,d,g,b,T){if(b&&d.startsWith("xlink:"))g==null?a.removeAttributeNS(tv,d.slice(6,d.length)):a.setAttributeNS(tv,d,g);else{const I=k2(d);g==null||I&&!Kv(g)?a.removeAttribute(d):a.setAttribute(d,I?"":g)}}function jE(a,d,g,b,T,I,z){if(d==="innerHTML"||d==="textContent"){b&&z(b,T,I),a[d]=g==null?"":g;return}if(d==="value"&&a.tagName!=="PROGRESS"&&!a.tagName.includes("-")){a._value=g;const o=g==null?"":g;(a.value!==o||a.tagName==="OPTION")&&(a.value=o),g==null&&a.removeAttribute(d);return}if(g===""||g==null){const o=typeof a[d];if(o==="boolean"){a[d]=Kv(g);return}else if(g==null&&o==="string"){a[d]="",a.removeAttribute(d);return}else if(o==="number"){try{a[d]=0}catch{}a.removeAttribute(d);return}}try{a[d]=g}catch{}}let Ip=Date.now,Y0=!1;if(typeof window!="undefined"){Ip()>document.createEvent("Event").timeStamp&&(Ip=()=>performance.now());const a=navigator.userAgent.match(/firefox\/(\d+)/i);Y0=!!(a&&Number(a[1])<=53)}let Qm=0;const NE=Promise.resolve(),VE=()=>{Qm=0},$E=()=>Qm||(NE.then(VE),Qm=Ip());function hc(a,d,g,b){a.addEventListener(d,g,b)}function GE(a,d,g,b){a.removeEventListener(d,g,b)}function qE(a,d,g,b,T=null){const I=a._vei||(a._vei={}),z=I[d];if(b&&z)z.value=b;else{const[o,k]=ZE(d);if(b){const j=I[d]=WE(b,T);hc(a,o,j,k)}else z&&(GE(a,o,z,k),I[d]=void 0)}}const iv=/(?:Once|Passive|Capture)$/;function ZE(a){let d;if(iv.test(a)){d={};let g;for(;g=a.match(iv);)a=a.slice(0,a.length-g[0].length),d[g[0].toLowerCase()]=!0}return[bc(a.slice(2)),d]}function WE(a,d){const g=b=>{const T=b.timeStamp||Ip();(Y0||T>=g.attached-1)&&Wn(XE(b,g.value),d,5,[b])};return g.value=a,g.attached=$E(),g}function XE(a,d){if(Yt(d)){const g=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{g.call(a),a._stopped=!0},d.map(b=>T=>!T._stopped&&b&&b(T))}else return d}const rv=/^on[a-z]/,HE=(a,d,g,b,T=!1,I,z,o,k)=>{d==="class"?BE(a,b,T):d==="style"?OE(a,g,b):zp(d)?y_(d)||qE(a,d,g,b,z):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):KE(a,d,b,T))?jE(a,d,b,I,z,o,k):(d==="true-value"?a._trueValue=b:d==="false-value"&&(a._falseValue=b),UE(a,d,b,T))};function KE(a,d,g,b){return b?!!(d==="innerHTML"||d==="textContent"||d in a&&rv.test(d)&&ai(g)):d==="spellcheck"||d==="draggable"||d==="form"||d==="list"&&a.tagName==="INPUT"||d==="type"&&a.tagName==="TEXTAREA"||rv.test(d)&&wr(g)?!1:d in a}const js="transition",eh="animation",J0=(a,{slots:d})=>un(z0,YE(a),d);J0.displayName="Transition";const Q0={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};J0.props=Wr({},z0.props,Q0);const Wa=(a,d=[])=>{Yt(a)?a.forEach(g=>g(...d)):a&&a(...d)},nv=a=>a?Yt(a)?a.some(d=>d.length>1):a.length>1:!1;function YE(a){const d={};for(const bt in a)bt in Q0||(d[bt]=a[bt]);if(a.css===!1)return d;const{name:g="v",type:b,duration:T,enterFromClass:I=`${g}-enter-from`,enterActiveClass:z=`${g}-enter-active`,enterToClass:o=`${g}-enter-to`,appearFromClass:k=I,appearActiveClass:j=z,appearToClass:F=o,leaveFromClass:B=`${g}-leave-from`,leaveActiveClass:$=`${g}-leave-active`,leaveToClass:ne=`${g}-leave-to`}=a,oe=JE(T),ve=oe&&oe[0],Ie=oe&&oe[1],{onBeforeEnter:Ge,onEnter:qe,onEnterCancelled:st,onLeave:ft,onLeaveCancelled:He,onBeforeAppear:yt=Ge,onAppear:We=qe,onAppearCancelled:xt=st}=d,Et=(bt,ei,ri)=>{rc(bt,ei?F:o),rc(bt,ei?j:z),ri&&ri()},gt=(bt,ei)=>{rc(bt,ne),rc(bt,$),ei&&ei()},Ft=bt=>(ei,ri)=>{const Er=bt?We:qe,vi=()=>Et(ei,bt,ri);Wa(Er,[ei,vi]),ov(()=>{rc(ei,bt?k:I),Ns(ei,bt?F:o),nv(Er)||sv(ei,b,ve,vi)})};return Wr(d,{onBeforeEnter(bt){Wa(Ge,[bt]),Ns(bt,I),Ns(bt,z)},onBeforeAppear(bt){Wa(yt,[bt]),Ns(bt,k),Ns(bt,j)},onEnter:Ft(!1),onAppear:Ft(!0),onLeave(bt,ei){const ri=()=>gt(bt,ei);Ns(bt,B),tS(),Ns(bt,$),ov(()=>{rc(bt,B),Ns(bt,ne),nv(ft)||sv(bt,b,Ie,ri)}),Wa(ft,[bt,ri])},onEnterCancelled(bt){Et(bt,!1),Wa(st,[bt])},onAppearCancelled(bt){Et(bt,!0),Wa(xt,[bt])},onLeaveCancelled(bt){gt(bt),Wa(He,[bt])}})}function JE(a){if(a==null)return null;if(Tr(a))return[Em(a.enter),Em(a.leave)];{const d=Em(a);return[d,d]}}function Em(a){return _h(a)}function Ns(a,d){d.split(/\s+/).forEach(g=>g&&a.classList.add(g)),(a._vtc||(a._vtc=new Set)).add(d)}function rc(a,d){d.split(/\s+/).forEach(b=>b&&a.classList.remove(b));const{_vtc:g}=a;g&&(g.delete(d),g.size||(a._vtc=void 0))}function ov(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let QE=0;function sv(a,d,g,b){const T=a._endId=++QE,I=()=>{T===a._endId&&b()};if(g)return setTimeout(I,g);const{type:z,timeout:o,propCount:k}=eS(a,d);if(!z)return b();const j=z+"end";let F=0;const B=()=>{a.removeEventListener(j,$),I()},$=ne=>{ne.target===a&&++F>=k&&B()};setTimeout(()=>{F<k&&B()},o+1),a.addEventListener(j,$)}function eS(a,d){const g=window.getComputedStyle(a),b=oe=>(g[oe]||"").split(", "),T=b(js+"Delay"),I=b(js+"Duration"),z=av(T,I),o=b(eh+"Delay"),k=b(eh+"Duration"),j=av(o,k);let F=null,B=0,$=0;d===js?z>0&&(F=js,B=z,$=I.length):d===eh?j>0&&(F=eh,B=j,$=k.length):(B=Math.max(z,j),F=B>0?z>j?js:eh:null,$=F?F===js?I.length:k.length:0);const ne=F===js&&/\b(transform|all)(,|$)/.test(g[js+"Property"]);return{type:F,timeout:B,propCount:$,hasTransform:ne}}function av(a,d){for(;a.length<d.length;)a=a.concat(a);return Math.max(...d.map((g,b)=>lv(g)+lv(a[b])))}function lv(a){return Number(a.slice(0,-1).replace(",","."))*1e3}function tS(){return document.body.offsetHeight}const cv=a=>{const d=a.props["onUpdate:modelValue"];return Yt(d)?g=>mp(d,g):d};function iS(a){a.target.composing=!0}function uv(a){const d=a.target;d.composing&&(d.composing=!1,rS(d,"input"))}function rS(a,d){const g=document.createEvent("HTMLEvents");g.initEvent(d,!0,!0),a.dispatchEvent(g)}const YC={created(a,{modifiers:{lazy:d,trim:g,number:b}},T){a._assign=cv(T);const I=b||T.props&&T.props.type==="number";hc(a,d?"change":"input",z=>{if(z.target.composing)return;let o=a.value;g?o=o.trim():I&&(o=_h(o)),a._assign(o)}),g&&hc(a,"change",()=>{a.value=a.value.trim()}),d||(hc(a,"compositionstart",iS),hc(a,"compositionend",uv),hc(a,"change",uv))},mounted(a,{value:d}){a.value=d==null?"":d},beforeUpdate(a,{value:d,modifiers:{lazy:g,trim:b,number:T}},I){if(a._assign=cv(I),a.composing||document.activeElement===a&&(g||b&&a.value.trim()===d||(T||a.type==="number")&&_h(a.value)===d))return;const z=d==null?"":d;a.value!==z&&(a.value=z)}},nS=Wr({patchProp:HE},RE);let hv;function oS(){return hv||(hv=hE(nS))}const JC=(...a)=>{const d=oS().createApp(...a),{mount:g}=d;return d.mount=b=>{const T=sS(b);if(!T)return;const I=d._component;!ai(I)&&!I.render&&!I.template&&(I.template=T.innerHTML),T.innerHTML="";const z=g(T,!1,T instanceof SVGElement);return T instanceof Element&&(T.removeAttribute("v-cloak"),T.setAttribute("data-v-app","")),z},d};function sS(a){return wr(a)?document.querySelector(a):a}/*!
  * vue-router v4.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const e1=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",Ec=a=>e1?Symbol(a):"_vr_"+a,aS=Ec("rvlm"),dv=Ec("rvd"),Fp=Ec("r"),t1=Ec("rl"),e_=Ec("rvl"),dc=typeof window!="undefined";function lS(a){return a.__esModule||e1&&a[Symbol.toStringTag]==="Module"}const er=Object.assign;function Sm(a,d){const g={};for(const b in d){const T=d[b];g[b]=Array.isArray(T)?T.map(a):a(T)}return g}const dh=()=>{},cS=/\/$/,uS=a=>a.replace(cS,"");function Am(a,d,g="/"){let b,T={},I="",z="";const o=d.indexOf("?"),k=d.indexOf("#",o>-1?o:0);return o>-1&&(b=d.slice(0,o),I=d.slice(o+1,k>-1?k:d.length),T=a(I)),k>-1&&(b=b||d.slice(0,k),z=d.slice(k,d.length)),b=fS(b!=null?b:d,g),{fullPath:b+(I&&"?")+I+z,path:b,query:T,hash:z}}function hS(a,d){const g=d.query?a(d.query):"";return d.path+(g&&"?")+g+(d.hash||"")}function pv(a,d){return!d||!a.toLowerCase().startsWith(d.toLowerCase())?a:a.slice(d.length)||"/"}function dS(a,d,g){const b=d.matched.length-1,T=g.matched.length-1;return b>-1&&b===T&&yc(d.matched[b],g.matched[T])&&i1(d.params,g.params)&&a(d.query)===a(g.query)&&d.hash===g.hash}function yc(a,d){return(a.aliasOf||a)===(d.aliasOf||d)}function i1(a,d){if(Object.keys(a).length!==Object.keys(d).length)return!1;for(const g in a)if(!pS(a[g],d[g]))return!1;return!0}function pS(a,d){return Array.isArray(a)?fv(a,d):Array.isArray(d)?fv(d,a):a===d}function fv(a,d){return Array.isArray(d)?a.length===d.length&&a.every((g,b)=>g===d[b]):a.length===1&&a[0]===d}function fS(a,d){if(a.startsWith("/"))return a;if(!a)return d;const g=d.split("/"),b=a.split("/");let T=g.length-1,I,z;for(I=0;I<b.length;I++)if(z=b[I],!(T===1||z==="."))if(z==="..")T--;else break;return g.slice(0,T).join("/")+"/"+b.slice(I-(I===b.length?1:0)).join("/")}var wh;(function(a){a.pop="pop",a.push="push"})(wh||(wh={}));var ph;(function(a){a.back="back",a.forward="forward",a.unknown=""})(ph||(ph={}));function mS(a){if(!a)if(dc){const d=document.querySelector("base");a=d&&d.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),uS(a)}const _S=/^[^#]+#/;function gS(a,d){return a.replace(_S,"#")+d}function yS(a,d){const g=document.documentElement.getBoundingClientRect(),b=a.getBoundingClientRect();return{behavior:d.behavior,left:b.left-g.left-(d.left||0),top:b.top-g.top-(d.top||0)}}const Up=()=>({left:window.pageXOffset,top:window.pageYOffset});function xS(a){let d;if("el"in a){const g=a.el,b=typeof g=="string"&&g.startsWith("#"),T=typeof g=="string"?b?document.getElementById(g.slice(1)):document.querySelector(g):g;if(!T)return;d=yS(T,a)}else d=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(d):window.scrollTo(d.left!=null?d.left:window.pageXOffset,d.top!=null?d.top:window.pageYOffset)}function mv(a,d){return(history.state?history.state.position-d:-1)+a}const t_=new Map;function vS(a,d){t_.set(a,d)}function bS(a){const d=t_.get(a);return t_.delete(a),d}let wS=()=>location.protocol+"//"+location.host;function r1(a,d){const{pathname:g,search:b,hash:T}=d,I=a.indexOf("#");if(I>-1){let o=T.includes(a.slice(I))?a.slice(I).length:1,k=T.slice(o);return k[0]!=="/"&&(k="/"+k),pv(k,"")}return pv(g,a)+b+T}function TS(a,d,g,b){let T=[],I=[],z=null;const o=({state:$})=>{const ne=r1(a,location),oe=g.value,ve=d.value;let Ie=0;if($){if(g.value=ne,d.value=$,z&&z===oe){z=null;return}Ie=ve?$.position-ve.position:0}else b(ne);T.forEach(Ge=>{Ge(g.value,oe,{delta:Ie,type:wh.pop,direction:Ie?Ie>0?ph.forward:ph.back:ph.unknown})})};function k(){z=g.value}function j($){T.push($);const ne=()=>{const oe=T.indexOf($);oe>-1&&T.splice(oe,1)};return I.push(ne),ne}function F(){const{history:$}=window;!$.state||$.replaceState(er({},$.state,{scroll:Up()}),"")}function B(){for(const $ of I)$();I=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",F)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",F),{pauseListeners:k,listen:j,destroy:B}}function _v(a,d,g,b=!1,T=!1){return{back:a,current:d,forward:g,replaced:b,position:window.history.length,scroll:T?Up():null}}function ES(a){const{history:d,location:g}=window,b={value:r1(a,g)},T={value:d.state};T.value||I(b.value,{back:null,current:b.value,forward:null,position:d.length-1,replaced:!0,scroll:null},!0);function I(k,j,F){const B=a.indexOf("#"),$=B>-1?(g.host&&document.querySelector("base")?a:a.slice(B))+k:wS()+a+k;try{d[F?"replaceState":"pushState"](j,"",$),T.value=j}catch(ne){console.error(ne),g[F?"replace":"assign"]($)}}function z(k,j){const F=er({},d.state,_v(T.value.back,k,T.value.forward,!0),j,{position:T.value.position});I(k,F,!0),b.value=k}function o(k,j){const F=er({},T.value,d.state,{forward:k,scroll:Up()});I(F.current,F,!0);const B=er({},_v(b.value,k,null),{position:F.position+1},j);I(k,B,!1),b.value=k}return{location:b,state:T,push:o,replace:z}}function QC(a){a=mS(a);const d=ES(a),g=TS(a,d.state,d.location,d.replace);function b(I,z=!0){z||g.pauseListeners(),history.go(I)}const T=er({location:"",base:a,go:b,createHref:gS.bind(null,a)},d,g);return Object.defineProperty(T,"location",{enumerable:!0,get:()=>d.location.value}),Object.defineProperty(T,"state",{enumerable:!0,get:()=>d.state.value}),T}function SS(a){return typeof a=="string"||a&&typeof a=="object"}function n1(a){return typeof a=="string"||typeof a=="symbol"}const Vs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},o1=Ec("nf");var gv;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(gv||(gv={}));function xc(a,d){return er(new Error,{type:a,[o1]:!0},d)}function $s(a,d){return a instanceof Error&&o1 in a&&(d==null||!!(a.type&d))}const yv="[^/]+?",AS={sensitive:!1,strict:!1,start:!0,end:!0},IS=/[.+*?^${}()[\]/\\]/g;function CS(a,d){const g=er({},AS,d),b=[];let T=g.start?"^":"";const I=[];for(const j of a){const F=j.length?[]:[90];g.strict&&!j.length&&(T+="/");for(let B=0;B<j.length;B++){const $=j[B];let ne=40+(g.sensitive?.25:0);if($.type===0)B||(T+="/"),T+=$.value.replace(IS,"\\$&"),ne+=40;else if($.type===1){const{value:oe,repeatable:ve,optional:Ie,regexp:Ge}=$;I.push({name:oe,repeatable:ve,optional:Ie});const qe=Ge||yv;if(qe!==yv){ne+=10;try{new RegExp(`(${qe})`)}catch(ft){throw new Error(`Invalid custom RegExp for param "${oe}" (${qe}): `+ft.message)}}let st=ve?`((?:${qe})(?:/(?:${qe}))*)`:`(${qe})`;B||(st=Ie&&j.length<2?`(?:/${st})`:"/"+st),Ie&&(st+="?"),T+=st,ne+=20,Ie&&(ne+=-8),ve&&(ne+=-20),qe===".*"&&(ne+=-50)}F.push(ne)}b.push(F)}if(g.strict&&g.end){const j=b.length-1;b[j][b[j].length-1]+=.7000000000000001}g.strict||(T+="/?"),g.end?T+="$":g.strict&&(T+="(?:/|$)");const z=new RegExp(T,g.sensitive?"":"i");function o(j){const F=j.match(z),B={};if(!F)return null;for(let $=1;$<F.length;$++){const ne=F[$]||"",oe=I[$-1];B[oe.name]=ne&&oe.repeatable?ne.split("/"):ne}return B}function k(j){let F="",B=!1;for(const $ of a){(!B||!F.endsWith("/"))&&(F+="/"),B=!1;for(const ne of $)if(ne.type===0)F+=ne.value;else if(ne.type===1){const{value:oe,repeatable:ve,optional:Ie}=ne,Ge=oe in j?j[oe]:"";if(Array.isArray(Ge)&&!ve)throw new Error(`Provided param "${oe}" is an array but it is not repeatable (* or + modifiers)`);const qe=Array.isArray(Ge)?Ge.join("/"):Ge;if(!qe)if(Ie)$.length<2&&(F.endsWith("/")?F=F.slice(0,-1):B=!0);else throw new Error(`Missing required param "${oe}"`);F+=qe}}return F}return{re:z,score:b,keys:I,parse:o,stringify:k}}function MS(a,d){let g=0;for(;g<a.length&&g<d.length;){const b=d[g]-a[g];if(b)return b;g++}return a.length<d.length?a.length===1&&a[0]===40+40?-1:1:a.length>d.length?d.length===1&&d[0]===40+40?1:-1:0}function zS(a,d){let g=0;const b=a.score,T=d.score;for(;g<b.length&&g<T.length;){const I=MS(b[g],T[g]);if(I)return I;g++}return T.length-b.length}const PS={type:0,value:""},kS=/[a-zA-Z0-9_]/;function DS(a){if(!a)return[[]];if(a==="/")return[[PS]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function d(ne){throw new Error(`ERR (${g})/"${j}": ${ne}`)}let g=0,b=g;const T=[];let I;function z(){I&&T.push(I),I=[]}let o=0,k,j="",F="";function B(){!j||(g===0?I.push({type:0,value:j}):g===1||g===2||g===3?(I.length>1&&(k==="*"||k==="+")&&d(`A repeatable param (${j}) must be alone in its segment. eg: '/:ids+.`),I.push({type:1,value:j,regexp:F,repeatable:k==="*"||k==="+",optional:k==="*"||k==="?"})):d("Invalid state to consume buffer"),j="")}function $(){j+=k}for(;o<a.length;){if(k=a[o++],k==="\\"&&g!==2){b=g,g=4;continue}switch(g){case 0:k==="/"?(j&&B(),z()):k===":"?(B(),g=1):$();break;case 4:$(),g=b;break;case 1:k==="("?g=2:kS.test(k)?$():(B(),g=0,k!=="*"&&k!=="?"&&k!=="+"&&o--);break;case 2:k===")"?F[F.length-1]=="\\"?F=F.slice(0,-1)+k:g=3:F+=k;break;case 3:B(),g=0,k!=="*"&&k!=="?"&&k!=="+"&&o--,F="";break;default:d("Unknown state");break}}return g===2&&d(`Unfinished custom RegExp for param "${j}"`),B(),z(),T}function LS(a,d,g){const b=CS(DS(a.path),g),T=er(b,{record:a,parent:d,children:[],alias:[]});return d&&!T.record.aliasOf==!d.record.aliasOf&&d.children.push(T),T}function RS(a,d){const g=[],b=new Map;d=vv({strict:!1,end:!0,sensitive:!1},d);function T(F){return b.get(F)}function I(F,B,$){const ne=!$,oe=OS(F);oe.aliasOf=$&&$.record;const ve=vv(d,F),Ie=[oe];if("alias"in F){const st=typeof F.alias=="string"?[F.alias]:F.alias;for(const ft of st)Ie.push(er({},oe,{components:$?$.record.components:oe.components,path:ft,aliasOf:$?$.record:oe}))}let Ge,qe;for(const st of Ie){const{path:ft}=st;if(B&&ft[0]!=="/"){const He=B.record.path,yt=He[He.length-1]==="/"?"":"/";st.path=B.record.path+(ft&&yt+ft)}if(Ge=LS(st,B,ve),$?$.alias.push(Ge):(qe=qe||Ge,qe!==Ge&&qe.alias.push(Ge),ne&&F.name&&!xv(Ge)&&z(F.name)),"children"in oe){const He=oe.children;for(let yt=0;yt<He.length;yt++)I(He[yt],Ge,$&&$.children[yt])}$=$||Ge,k(Ge)}return qe?()=>{z(qe)}:dh}function z(F){if(n1(F)){const B=b.get(F);B&&(b.delete(F),g.splice(g.indexOf(B),1),B.children.forEach(z),B.alias.forEach(z))}else{const B=g.indexOf(F);B>-1&&(g.splice(B,1),F.record.name&&b.delete(F.record.name),F.children.forEach(z),F.alias.forEach(z))}}function o(){return g}function k(F){let B=0;for(;B<g.length&&zS(F,g[B])>=0&&(F.record.path!==g[B].record.path||!s1(F,g[B]));)B++;g.splice(B,0,F),F.record.name&&!xv(F)&&b.set(F.record.name,F)}function j(F,B){let $,ne={},oe,ve;if("name"in F&&F.name){if($=b.get(F.name),!$)throw xc(1,{location:F});ve=$.record.name,ne=er(BS(B.params,$.keys.filter(qe=>!qe.optional).map(qe=>qe.name)),F.params),oe=$.stringify(ne)}else if("path"in F)oe=F.path,$=g.find(qe=>qe.re.test(oe)),$&&(ne=$.parse(oe),ve=$.record.name);else{if($=B.name?b.get(B.name):g.find(qe=>qe.re.test(B.path)),!$)throw xc(1,{location:F,currentLocation:B});ve=$.record.name,ne=er({},B.params,F.params),oe=$.stringify(ne)}const Ie=[];let Ge=$;for(;Ge;)Ie.unshift(Ge.record),Ge=Ge.parent;return{name:ve,path:oe,params:ne,matched:Ie,meta:US(Ie)}}return a.forEach(F=>I(F)),{addRoute:I,resolve:j,removeRoute:z,getRoutes:o,getRecordMatcher:T}}function BS(a,d){const g={};for(const b of d)b in a&&(g[b]=a[b]);return g}function OS(a){return{path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:void 0,beforeEnter:a.beforeEnter,props:FS(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||{}:{default:a.component}}}function FS(a){const d={},g=a.props||!1;if("component"in a)d.default=g;else for(const b in a.components)d[b]=typeof g=="boolean"?g:g[b];return d}function xv(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function US(a){return a.reduce((d,g)=>er(d,g.meta),{})}function vv(a,d){const g={};for(const b in a)g[b]=b in d?d[b]:a[b];return g}function s1(a,d){return d.children.some(g=>g===a||s1(a,g))}const a1=/#/g,jS=/&/g,NS=/\//g,VS=/=/g,$S=/\?/g,l1=/\+/g,GS=/%5B/g,qS=/%5D/g,c1=/%5E/g,ZS=/%60/g,u1=/%7B/g,WS=/%7C/g,h1=/%7D/g,XS=/%20/g;function V_(a){return encodeURI(""+a).replace(WS,"|").replace(GS,"[").replace(qS,"]")}function HS(a){return V_(a).replace(u1,"{").replace(h1,"}").replace(c1,"^")}function i_(a){return V_(a).replace(l1,"%2B").replace(XS,"+").replace(a1,"%23").replace(jS,"%26").replace(ZS,"`").replace(u1,"{").replace(h1,"}").replace(c1,"^")}function KS(a){return i_(a).replace(VS,"%3D")}function YS(a){return V_(a).replace(a1,"%23").replace($S,"%3F")}function JS(a){return a==null?"":YS(a).replace(NS,"%2F")}function Cp(a){try{return decodeURIComponent(""+a)}catch{}return""+a}function QS(a){const d={};if(a===""||a==="?")return d;const b=(a[0]==="?"?a.slice(1):a).split("&");for(let T=0;T<b.length;++T){const I=b[T].replace(l1," "),z=I.indexOf("="),o=Cp(z<0?I:I.slice(0,z)),k=z<0?null:Cp(I.slice(z+1));if(o in d){let j=d[o];Array.isArray(j)||(j=d[o]=[j]),j.push(k)}else d[o]=k}return d}function bv(a){let d="";for(let g in a){const b=a[g];if(g=KS(g),b==null){b!==void 0&&(d+=(d.length?"&":"")+g);continue}(Array.isArray(b)?b.map(I=>I&&i_(I)):[b&&i_(b)]).forEach(I=>{I!==void 0&&(d+=(d.length?"&":"")+g,I!=null&&(d+="="+I))})}return d}function eA(a){const d={};for(const g in a){const b=a[g];b!==void 0&&(d[g]=Array.isArray(b)?b.map(T=>T==null?null:""+T):b==null?b:""+b)}return d}function th(){let a=[];function d(b){return a.push(b),()=>{const T=a.indexOf(b);T>-1&&a.splice(T,1)}}function g(){a=[]}return{add:d,list:()=>a,reset:g}}function Ws(a,d,g,b,T){const I=b&&(b.enterCallbacks[T]=b.enterCallbacks[T]||[]);return()=>new Promise((z,o)=>{const k=B=>{B===!1?o(xc(4,{from:g,to:d})):B instanceof Error?o(B):SS(B)?o(xc(2,{from:d,to:B})):(I&&b.enterCallbacks[T]===I&&typeof B=="function"&&I.push(B),z())},j=a.call(b&&b.instances[T],d,g,k);let F=Promise.resolve(j);a.length<3&&(F=F.then(k)),F.catch(B=>o(B))})}function Im(a,d,g,b){const T=[];for(const I of a)for(const z in I.components){let o=I.components[z];if(!(d!=="beforeRouteEnter"&&!I.instances[z]))if(tA(o)){const j=(o.__vccOpts||o)[d];j&&T.push(Ws(j,g,b,I,z))}else{let k=o();T.push(()=>k.then(j=>{if(!j)return Promise.reject(new Error(`Couldn't resolve component "${z}" at "${I.path}"`));const F=lS(j)?j.default:j;I.components[z]=F;const $=(F.__vccOpts||F)[d];return $&&Ws($,g,b,I,z)()}))}}return T}function tA(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function wv(a){const d=ir(Fp),g=ir(t1),b=Dt(()=>d.resolve(hi(a.to))),T=Dt(()=>{const{matched:k}=b.value,{length:j}=k,F=k[j-1],B=g.matched;if(!F||!B.length)return-1;const $=B.findIndex(yc.bind(null,F));if($>-1)return $;const ne=Tv(k[j-2]);return j>1&&Tv(F)===ne&&B[B.length-1].path!==ne?B.findIndex(yc.bind(null,k[j-2])):$}),I=Dt(()=>T.value>-1&&oA(g.params,b.value.params)),z=Dt(()=>T.value>-1&&T.value===g.matched.length-1&&i1(g.params,b.value.params));function o(k={}){return nA(k)?d[hi(a.replace)?"replace":"push"](hi(a.to)).catch(dh):Promise.resolve()}return{route:b,href:Dt(()=>b.value.href),isActive:I,isExactActive:z,navigate:o}}const iA=hr({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:wv,setup(a,{slots:d}){const g=Fo(wv(a)),{options:b}=ir(Fp),T=Dt(()=>({[Ev(a.activeClass,b.linkActiveClass,"router-link-active")]:g.isActive,[Ev(a.exactActiveClass,b.linkExactActiveClass,"router-link-exact-active")]:g.isExactActive}));return()=>{const I=d.default&&d.default(g);return a.custom?I:un("a",{"aria-current":g.isExactActive?a.ariaCurrentValue:null,href:g.href,onClick:g.navigate,class:T.value},I)}}}),rA=iA;function nA(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const d=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(d))return}return a.preventDefault&&a.preventDefault(),!0}}function oA(a,d){for(const g in d){const b=d[g],T=a[g];if(typeof b=="string"){if(b!==T)return!1}else if(!Array.isArray(T)||T.length!==b.length||b.some((I,z)=>I!==T[z]))return!1}return!0}function Tv(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const Ev=(a,d,g)=>a!=null?a:d!=null?d:g,sA=hr({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(a,{attrs:d,slots:g}){const b=ir(e_),T=Dt(()=>a.route||b.value),I=ir(dv,0),z=Dt(()=>T.value.matched[I]);br(dv,I+1),br(aS,z),br(e_,T);const o=$t();return bn(()=>[o.value,z.value,a.name],([k,j,F],[B,$,ne])=>{j&&(j.instances[F]=k,$&&$!==j&&k&&k===B&&(j.leaveGuards.size||(j.leaveGuards=$.leaveGuards),j.updateGuards.size||(j.updateGuards=$.updateGuards))),k&&j&&(!$||!yc(j,$)||!B)&&(j.enterCallbacks[F]||[]).forEach(oe=>oe(k))},{flush:"post"}),()=>{const k=T.value,j=z.value,F=j&&j.components[a.name],B=a.name;if(!F)return Sv(g.default,{Component:F,route:k});const $=j.props[a.name],ne=$?$===!0?k.params:typeof $=="function"?$(k):$:null,ve=un(F,er({},ne,d,{onVnodeUnmounted:Ie=>{Ie.component.isUnmounted&&(j.instances[B]=null)},ref:o}));return Sv(g.default,{Component:ve,route:k})||ve}}});function Sv(a,d){if(!a)return null;const g=a(d);return g.length===1?g[0]:g}const aA=sA;function eM(a){const d=RS(a.routes,a),g=a.parseQuery||QS,b=a.stringifyQuery||bv,T=a.history,I=th(),z=th(),o=th(),k=_T(Vs);let j=Vs;dc&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const F=Sm.bind(null,$e=>""+$e),B=Sm.bind(null,JS),$=Sm.bind(null,Cp);function ne($e,St){let ut,Pt;return n1($e)?(ut=d.getRecordMatcher($e),Pt=St):Pt=$e,d.addRoute(Pt,ut)}function oe($e){const St=d.getRecordMatcher($e);St&&d.removeRoute(St)}function ve(){return d.getRoutes().map($e=>$e.record)}function Ie($e){return!!d.getRecordMatcher($e)}function Ge($e,St){if(St=er({},St||k.value),typeof $e=="string"){const Zt=Am(g,$e,St.path),ce=d.resolve({path:Zt.path},St),_e=T.createHref(Zt.fullPath);return er(Zt,ce,{params:$(ce.params),hash:Cp(Zt.hash),redirectedFrom:void 0,href:_e})}let ut;if("path"in $e)ut=er({},$e,{path:Am(g,$e.path,St.path).path});else{const Zt=er({},$e.params);for(const ce in Zt)Zt[ce]==null&&delete Zt[ce];ut=er({},$e,{params:B($e.params)}),St.params=B(St.params)}const Pt=d.resolve(ut,St),Ei=$e.hash||"";Pt.params=F($(Pt.params));const yi=hS(b,er({},$e,{hash:HS(Ei),path:Pt.path})),ni=T.createHref(yi);return er({fullPath:yi,hash:Ei,query:b===bv?eA($e.query):$e.query||{}},Pt,{redirectedFrom:void 0,href:ni})}function qe($e){return typeof $e=="string"?Am(g,$e,k.value.path):er({},$e)}function st($e,St){if(j!==$e)return xc(8,{from:St,to:$e})}function ft($e){return We($e)}function He($e){return ft(er(qe($e),{replace:!0}))}function yt($e){const St=$e.matched[$e.matched.length-1];if(St&&St.redirect){const{redirect:ut}=St;let Pt=typeof ut=="function"?ut($e):ut;return typeof Pt=="string"&&(Pt=Pt.includes("?")||Pt.includes("#")?Pt=qe(Pt):{path:Pt},Pt.params={}),er({query:$e.query,hash:$e.hash,params:$e.params},Pt)}}function We($e,St){const ut=j=Ge($e),Pt=k.value,Ei=$e.state,yi=$e.force,ni=$e.replace===!0,Zt=yt(ut);if(Zt)return We(er(qe(Zt),{state:Ei,force:yi,replace:ni}),St||ut);const ce=ut;ce.redirectedFrom=St;let _e;return!yi&&dS(b,Pt,ut)&&(_e=xc(16,{to:ce,from:Pt}),lr(Pt,Pt,!0,!1)),(_e?Promise.resolve(_e):Et(ce,Pt)).catch(Pe=>$s(Pe)?$s(Pe,2)?Pe:Gi(Pe):fi(Pe,ce,Pt)).then(Pe=>{if(Pe){if($s(Pe,2))return We(er(qe(Pe.to),{state:Ei,force:yi,replace:ni}),St||ce)}else Pe=Ft(ce,Pt,!0,ni,Ei);return gt(ce,Pt,Pe),Pe})}function xt($e,St){const ut=st($e,St);return ut?Promise.reject(ut):Promise.resolve()}function Et($e,St){let ut;const[Pt,Ei,yi]=lA($e,St);ut=Im(Pt.reverse(),"beforeRouteLeave",$e,St);for(const Zt of Pt)Zt.leaveGuards.forEach(ce=>{ut.push(Ws(ce,$e,St))});const ni=xt.bind(null,$e,St);return ut.push(ni),nc(ut).then(()=>{ut=[];for(const Zt of I.list())ut.push(Ws(Zt,$e,St));return ut.push(ni),nc(ut)}).then(()=>{ut=Im(Ei,"beforeRouteUpdate",$e,St);for(const Zt of Ei)Zt.updateGuards.forEach(ce=>{ut.push(Ws(ce,$e,St))});return ut.push(ni),nc(ut)}).then(()=>{ut=[];for(const Zt of $e.matched)if(Zt.beforeEnter&&!St.matched.includes(Zt))if(Array.isArray(Zt.beforeEnter))for(const ce of Zt.beforeEnter)ut.push(Ws(ce,$e,St));else ut.push(Ws(Zt.beforeEnter,$e,St));return ut.push(ni),nc(ut)}).then(()=>($e.matched.forEach(Zt=>Zt.enterCallbacks={}),ut=Im(yi,"beforeRouteEnter",$e,St),ut.push(ni),nc(ut))).then(()=>{ut=[];for(const Zt of z.list())ut.push(Ws(Zt,$e,St));return ut.push(ni),nc(ut)}).catch(Zt=>$s(Zt,8)?Zt:Promise.reject(Zt))}function gt($e,St,ut){for(const Pt of o.list())Pt($e,St,ut)}function Ft($e,St,ut,Pt,Ei){const yi=st($e,St);if(yi)return yi;const ni=St===Vs,Zt=dc?history.state:{};ut&&(Pt||ni?T.replace($e.fullPath,er({scroll:ni&&Zt&&Zt.scroll},Ei)):T.push($e.fullPath,Ei)),k.value=$e,lr($e,St,ut,ni),Gi()}let bt;function ei(){bt=T.listen(($e,St,ut)=>{const Pt=Ge($e),Ei=yt(Pt);if(Ei){We(er(Ei,{replace:!0}),Pt).catch(dh);return}j=Pt;const yi=k.value;dc&&vS(mv(yi.fullPath,ut.delta),Up()),Et(Pt,yi).catch(ni=>$s(ni,12)?ni:$s(ni,2)?(We(ni.to,Pt).then(Zt=>{$s(Zt,20)&&!ut.delta&&ut.type===wh.pop&&T.go(-1,!1)}).catch(dh),Promise.reject()):(ut.delta&&T.go(-ut.delta,!1),fi(ni,Pt,yi))).then(ni=>{ni=ni||Ft(Pt,yi,!1),ni&&(ut.delta?T.go(-ut.delta,!1):ut.type===wh.pop&&$s(ni,20)&&T.go(-1,!1)),gt(Pt,yi,ni)}).catch(dh)})}let ri=th(),Er=th(),vi;function fi($e,St,ut){Gi($e);const Pt=Er.list();return Pt.length?Pt.forEach(Ei=>Ei($e,St,ut)):console.error($e),Promise.reject($e)}function Lt(){return vi&&k.value!==Vs?Promise.resolve():new Promise(($e,St)=>{ri.add([$e,St])})}function Gi($e){return vi||(vi=!$e,ei(),ri.list().forEach(([St,ut])=>$e?ut($e):St()),ri.reset()),$e}function lr($e,St,ut,Pt){const{scrollBehavior:Ei}=a;if(!dc||!Ei)return Promise.resolve();const yi=!ut&&bS(mv($e.fullPath,0))||(Pt||!ut)&&history.state&&history.state.scroll||null;return Rn().then(()=>Ei($e,St,yi)).then(ni=>ni&&xS(ni)).catch(ni=>fi(ni,$e,St))}const Nr=$e=>T.go($e);let bi;const Fi=new Set;return{currentRoute:k,addRoute:ne,removeRoute:oe,hasRoute:Ie,getRoutes:ve,resolve:Ge,options:a,push:ft,replace:He,go:Nr,back:()=>Nr(-1),forward:()=>Nr(1),beforeEach:I.add,beforeResolve:z.add,afterEach:o.add,onError:Er.add,isReady:Lt,install($e){const St=this;$e.component("RouterLink",rA),$e.component("RouterView",aA),$e.config.globalProperties.$router=St,Object.defineProperty($e.config.globalProperties,"$route",{enumerable:!0,get:()=>hi(k)}),dc&&!bi&&k.value===Vs&&(bi=!0,ft(T.location).catch(Ei=>{}));const ut={};for(const Ei in Vs)ut[Ei]=Dt(()=>k.value[Ei]);$e.provide(Fp,St),$e.provide(t1,Fo(ut)),$e.provide(e_,k);const Pt=$e.unmount;Fi.add($e),$e.unmount=function(){Fi.delete($e),Fi.size<1&&(j=Vs,bt&&bt(),k.value=Vs,bi=!1,vi=!1),Pt()}}}}function nc(a){return a.reduce((d,g)=>d.then(()=>g()),Promise.resolve())}function lA(a,d){const g=[],b=[],T=[],I=Math.max(d.matched.length,a.matched.length);for(let z=0;z<I;z++){const o=d.matched[z];o&&(a.matched.find(j=>yc(j,o))?b.push(o):g.push(o));const k=a.matched[z];k&&(d.matched.find(j=>yc(j,k))||T.push(k))}return[g,b,T]}function tM(){return ir(Fp)}function Bn(a,d,...g){if(a in d){let T=d[a];return typeof T=="function"?T(...g):T}let b=new Error(`Tried to handle "${a}" but there is no handler defined. Only defined handlers are: ${Object.keys(d).map(T=>`"${T}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(b,Bn),b}var ta=(a=>(a[a.None=0]="None",a[a.RenderStrategy=1]="RenderStrategy",a[a.Static=2]="Static",a))(ta||{}),Xs=(a=>(a[a.Unmount=0]="Unmount",a[a.Hidden=1]="Hidden",a))(Xs||{});function _r(b){var T=b,{visible:a=!0,features:d=0}=T,g=Do(T,["visible","features"]);var I;if(a||d&2&&g.props.static)return Cm(g);if(d&1){let z=(I=g.props.unmount)==null||I?0:1;return Bn(z,{[0](){return null},[1](){return Cm(xn(ui({},g),{props:xn(ui({},g.props),{hidden:!0,style:{display:"none"}})}))}})}return Cm(g)}function Cm({props:a,attrs:d,slots:g,slot:b,name:T}){var I;let j=d1(a,["unmount","static"]),{as:z}=j,o=Do(j,["as"]),k=(I=g.default)==null?void 0:I.call(g,b);if(z==="template"){if(Object.keys(o).length>0||Object.keys(d).length>0){let[F,...B]=k!=null?k:[];if(!uA(F)||B.length>0)throw new Error(['Passing props on "template"!',"",`The current component <${T} /> is rendering a "template".`,"However we need to passthrough the following props:",Object.keys(o).concat(Object.keys(d)).map($=>`  - ${$}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "template".',"Render a single element as the child so that we can forward the props onto that element."].map($=>`  - ${$}`).join(`
`)].join(`
`));return Qa(F,o)}return Array.isArray(k)&&k.length===1?k[0]:k}return un(z,o,k)}function cA(a){let d=Object.assign({},a);for(let g in d)d[g]===void 0&&delete d[g];return d}function d1(a,d=[]){let g=Object.assign({},a);for(let b of d)b in g&&delete g[b];return g}function uA(a){return a==null?!1:typeof a.type=="string"||typeof a.type=="object"||typeof a.type=="function"}let hA=0;function dA(){return++hA}function Tn(){return dA()}var or=(a=>(a.Space=" ",a.Enter="Enter",a.Escape="Escape",a.Backspace="Backspace",a.Delete="Delete",a.ArrowLeft="ArrowLeft",a.ArrowUp="ArrowUp",a.ArrowRight="ArrowRight",a.ArrowDown="ArrowDown",a.Home="Home",a.End="End",a.PageUp="PageUp",a.PageDown="PageDown",a.Tab="Tab",a))(or||{});function pA(a){throw new Error("Unexpected object: "+a)}var Ln=(a=>(a[a.First=0]="First",a[a.Previous=1]="Previous",a[a.Next=2]="Next",a[a.Last=3]="Last",a[a.Specific=4]="Specific",a[a.Nothing=5]="Nothing",a))(Ln||{});function fA(a,d){let g=d.resolveItems();if(g.length<=0)return null;let b=d.resolveActiveIndex(),T=b!=null?b:-1,I=(()=>{switch(a.focus){case 0:return g.findIndex(z=>!d.resolveDisabled(z));case 1:{let z=g.slice().reverse().findIndex((o,k,j)=>T!==-1&&j.length-k-1>=T?!1:!d.resolveDisabled(o));return z===-1?z:g.length-1-z}case 2:return g.findIndex((z,o)=>o<=T?!1:!d.resolveDisabled(z));case 3:{let z=g.slice().reverse().findIndex(o=>!d.resolveDisabled(o));return z===-1?z:g.length-1-z}case 4:return g.findIndex(z=>d.resolveId(z)===a.id);case 5:return null;default:pA(a)}})();return I===-1?b:I}function $i(a){return a==null||a.value==null?null:"$el"in a.value?a.value.$el:a.value}let p1=Symbol("Context");var Fn=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(Fn||{});function mA(){return Sh()!==null}function Sh(){return ir(p1,null)}function $_(a){br(p1,a)}function Av(a,d){if(a)return a;let g=d!=null?d:"button";if(typeof g=="string"&&g.toLowerCase()==="button")return"button"}function G_(a,d){let g=$t(Av(a.value.type,a.value.as));return tn(()=>{g.value=Av(a.value.type,a.value.as)}),wn(()=>{var b;g.value||!$i(d)||$i(d)instanceof HTMLButtonElement&&!((b=$i(d))!=null&&b.hasAttribute("type"))&&(g.value="button")}),g}function el(a){if(typeof window=="undefined")return null;if(a instanceof Node)return a.ownerDocument;if(a!=null&&a.hasOwnProperty("value")){let d=$i(a);if(d)return d.ownerDocument}return document}function _A({container:a,accept:d,walk:g,enabled:b}){wn(()=>{let T=a.value;if(!T||b!==void 0&&!b.value)return;let I=el(a);if(!I)return;let z=Object.assign(k=>d(k),{acceptNode:d}),o=I.createTreeWalker(T,NodeFilter.SHOW_ELEMENT,z,!1);for(;o.nextNode();)g(o.currentNode)})}let r_=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(a=>`${a}:not([tabindex='-1'])`).join(",");var sh=(a=>(a[a.First=1]="First",a[a.Previous=2]="Previous",a[a.Next=4]="Next",a[a.Last=8]="Last",a[a.WrapAround=16]="WrapAround",a[a.NoScroll=32]="NoScroll",a))(sh||{}),n_=(a=>(a[a.Error=0]="Error",a[a.Overflow=1]="Overflow",a[a.Success=2]="Success",a[a.Underflow=3]="Underflow",a))(n_||{}),gA=(a=>(a[a.Previous=-1]="Previous",a[a.Next=1]="Next",a))(gA||{});function yA(a=document.body){return a==null?[]:Array.from(a.querySelectorAll(r_))}var f1=(a=>(a[a.Strict=0]="Strict",a[a.Loose=1]="Loose",a))(f1||{});function xA(a,d=0){var g;return a===((g=el(a))==null?void 0:g.body)?!1:Bn(d,{[0](){return a.matches(r_)},[1](){let b=a;for(;b!==null;){if(b.matches(r_))return!0;b=b.parentElement}return!1}})}function ih(a){a==null||a.focus({preventScroll:!0})}let vA=["textarea","input"].join(",");function bA(a){var d,g;return(g=(d=a==null?void 0:a.matches)==null?void 0:d.call(a,vA))!=null?g:!1}function m1(a,d=g=>g){return a.slice().sort((g,b)=>{let T=d(g),I=d(b);if(T===null||I===null)return 0;let z=T.compareDocumentPosition(I);return z&Node.DOCUMENT_POSITION_FOLLOWING?-1:z&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function Iv(a,d){var g;let b=(g=Array.isArray(a)?a.length>0?a[0].ownerDocument:document:a==null?void 0:a.ownerDocument)!=null?g:document,T=Array.isArray(a)?m1(a):yA(a),I=b.activeElement,z=(()=>{if(d&5)return 1;if(d&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),o=(()=>{if(d&1)return 0;if(d&2)return Math.max(0,T.indexOf(I))-1;if(d&4)return Math.max(0,T.indexOf(I))+1;if(d&8)return T.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),k=d&32?{preventScroll:!0}:{},j=0,F=T.length,B;do{if(j>=F||j+F<=0)return 0;let $=o+j;if(d&16)$=($+F)%F;else{if($<0)return 3;if($>=F)return 1}B=T[$],B==null||B.focus(k),j+=z}while(B!==b.activeElement);return B.hasAttribute("tabindex")||B.setAttribute("tabindex","0"),d&6&&bA(B)&&B.select(),2}function Cv(a,d,g){typeof window!="undefined"&&wn(b=>{window.addEventListener(a,d,g),b(()=>window.removeEventListener(a,d,g))})}function wA(a){typeof queueMicrotask=="function"?queueMicrotask(a):Promise.resolve().then(a).catch(d=>setTimeout(()=>{throw d}))}var _1=(a=>(a[a.None=1]="None",a[a.IgnoreScrollbars=2]="IgnoreScrollbars",a))(_1||{});function g1(a,d,g=1){let b=!1;function T(I){if(b)return;b=!0,wA(()=>{b=!1});let z=I.target;if(!z.ownerDocument.documentElement.contains(z))return;let o=function k(j){return typeof j=="function"?k(j()):Array.isArray(j)||j instanceof Set?j:[j]}(a);if((g&2)===2){let k=20,j=z.ownerDocument.documentElement;if(I.clientX>j.clientWidth-k||I.clientX<k||I.clientY>j.clientHeight-k||I.clientY<k)return}for(let k of o){if(k===null)continue;let j=k instanceof HTMLElement?k:$i(k);if(j!=null&&j.contains(z))return}d(I,z)}Cv("pointerdown",T),Cv("mousedown",T)}let TA=hr({name:"VisuallyHidden",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:d,attrs:g}){return()=>_r({props:xn(ui({},a),{style:{position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",display:"none"}}),slot:{},attrs:g,slots:d,name:"VisuallyHidden"})}});function EA(a){var d;let g=(d=a==null?void 0:a.form)!=null?d:a.closest("form");if(g){for(let b of g.elements)if(b.tagName==="INPUT"&&b.type==="submit"||b.tagName==="BUTTON"&&b.type==="submit"||b.nodeName==="INPUT"&&b.type==="image"){b.click();return}}}function o_(a,d,g,b){typeof window!="undefined"&&wn(T=>{a=a!=null?a:window,a.addEventListener(d,g,b),T(()=>a.removeEventListener(d,g,b))})}var ah=(a=>(a[a.None=1]="None",a[a.InitialFocus=2]="InitialFocus",a[a.TabLock=4]="TabLock",a[a.FocusLock=8]="FocusLock",a[a.RestoreFocus=16]="RestoreFocus",a[a.All=30]="All",a))(ah||{});function SA(a,d=$t(30),g=$t({})){var b,T;let I=$t(null),z=$t(null),o={value:!1},k=Dt(()=>Boolean(d.value&16)),j=Dt(()=>Boolean(d.value&2)),F=Dt(()=>el(a));return tn(()=>{bn(k,(B,$)=>{var ne;B!==$&&(!k.value||(o.value=!0,I.value||(I.value=(ne=F.value)==null?void 0:ne.activeElement)))},{immediate:!0}),bn(k,(B,$,ne)=>{B!==$&&(!k.value||ne(()=>{o.value!==!1&&(o.value=!1,ih(I.value),I.value=null)}))},{immediate:!0}),bn([a,g,g.value.initialFocus,j],(B,$)=>{var ne,oe;if(B.every((qe,st)=>($==null?void 0:$[st])===qe)||!j.value)return;let ve=a.value;if(!ve)return;let Ie=$i(g.value.initialFocus),Ge=(ne=F.value)==null?void 0:ne.activeElement;if(Ie){if(Ie===Ge){z.value=Ge;return}}else if(ve.contains(Ge)){z.value=Ge;return}Ie?ih(Ie):Iv(ve,sh.First)===n_.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),z.value=(oe=F.value)==null?void 0:oe.activeElement},{immediate:!0})}),o_((b=F.value)==null?void 0:b.defaultView,"keydown",B=>{var $;!(d.value&4)||!a.value||B.key===or.Tab&&(B.preventDefault(),Iv(a.value,(B.shiftKey?sh.Previous:sh.Next)|sh.WrapAround)===n_.Success&&(z.value=($=F.value)==null?void 0:$.activeElement))}),o_((T=F.value)==null?void 0:T.defaultView,"focus",B=>{var $;if(!(d.value&8))return;let ne=new Set(($=g.value.containers)==null?void 0:$.value);if(ne.add(a),!ne.size)return;let oe=z.value;if(!oe||!o.value)return;let ve=B.target;ve&&ve instanceof HTMLElement?AA(ne,ve)?(z.value=ve,ih(ve)):(B.preventDefault(),B.stopPropagation(),ih(oe)):ih(z.value)},!0),I}function AA(a,d){var g;for(let b of a)if((g=b.value)!=null&&g.contains(d))return!0;return!1}let Mv="body > *",oc=new Set,qs=new Map;function zv(a){a.setAttribute("aria-hidden","true"),a.inert=!0}function Pv(a){let d=qs.get(a);!d||(d["aria-hidden"]===null?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden",d["aria-hidden"]),a.inert=d.inert)}function IA(a,d=$t(!0)){wn(g=>{if(!d.value||!a.value)return;let b=a.value,T=el(b);if(T){oc.add(b);for(let I of qs.keys())I.contains(b)&&(Pv(I),qs.delete(I));T.querySelectorAll(Mv).forEach(I=>{if(I instanceof HTMLElement){for(let z of oc)if(I.contains(z))return;oc.size===1&&(qs.set(I,{"aria-hidden":I.getAttribute("aria-hidden"),inert:I.inert}),zv(I))}}),g(()=>{if(oc.delete(b),oc.size>0)T.querySelectorAll(Mv).forEach(I=>{if(I instanceof HTMLElement&&!qs.has(I)){for(let z of oc)if(I.contains(z))return;qs.set(I,{"aria-hidden":I.getAttribute("aria-hidden"),inert:I.inert}),zv(I)}});else for(let I of qs.keys())Pv(I),qs.delete(I)})}})}let y1=Symbol("ForcePortalRootContext");function CA(){return ir(y1,!1)}let s_=hr({name:"ForcePortalRoot",props:{as:{type:[Object,String],default:"template"},force:{type:Boolean,default:!1}},setup(a,{slots:d,attrs:g}){return br(y1,a.force),()=>{let I=a,{force:b}=I,T=Do(I,["force"]);return _r({props:T,slot:{},slots:d,attrs:g,name:"ForcePortalRoot"})}}});function MA(a){let d=el(a);if(!d)throw new Error(`[Headless UI]: Cannot find ownerDocument for contextElement: ${a}`);let g=d.getElementById("headlessui-portal-root");if(g)return g;let b=d.createElement("div");return b.setAttribute("id","headlessui-portal-root"),d.body.appendChild(b)}let x1=hr({name:"Portal",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:d,attrs:g}){let b=$t(null),T=Dt(()=>el(b)),I=CA(),z=ir(v1,null),o=$t(I===!0||z==null?MA(b.value):z.resolveTarget());return wn(()=>{I||z!=null&&(o.value=z.resolveTarget())}),uo(()=>{var k,j;let F=(k=T.value)==null?void 0:k.getElementById("headlessui-portal-root");!F||o.value===F&&o.value.children.length<=0&&((j=o.value.parentElement)==null||j.removeChild(o.value))}),()=>{if(o.value===null)return null;let k={ref:b};return un(gE,{to:o.value},_r({props:ui(ui({},a),k),slot:{},attrs:g,slots:d,name:"Portal"}))}}}),v1=Symbol("PortalGroupContext"),zA=hr({name:"PortalGroup",props:{as:{type:[Object,String],default:"template"},target:{type:Object,default:null}},setup(a,{attrs:d,slots:g}){let b=Fo({resolveTarget(){return a.target}});return br(v1,b),()=>{let z=a,{target:T}=z,I=Do(z,["target"]);return _r({props:I,slot:{},attrs:d,slots:g,name:"PortalGroup"})}}}),b1=Symbol("StackContext");var a_=(a=>(a[a.Add=0]="Add",a[a.Remove=1]="Remove",a))(a_||{});function PA(){return ir(b1,()=>{})}function kA({type:a,element:d,onUpdate:g}){let b=PA();function T(...I){g==null||g(...I),b(...I)}tn(()=>{T(0,a,d),uo(()=>{T(1,a,d)})}),br(b1,T)}let w1=Symbol("DescriptionContext");function DA(){let a=ir(w1,null);if(a===null)throw new Error("Missing parent");return a}function T1({slot:a=$t({}),name:d="Description",props:g={}}={}){let b=$t([]);function T(I){return b.value.push(I),()=>{let z=b.value.indexOf(I);z!==-1&&b.value.splice(z,1)}}return br(w1,{register:T,slot:a,name:d,props:g}),Dt(()=>b.value.length>0?b.value.join(" "):void 0)}let LA=hr({name:"Description",props:{as:{type:[Object,String],default:"p"}},setup(a,{attrs:d,slots:g}){let b=DA(),T=`headlessui-description-${Tn()}`;return tn(()=>uo(b.register(T))),()=>{let{name:I="Description",slot:z=$t({}),props:o={}}=b,k=a,j=xn(ui({},Object.entries(o).reduce((F,[B,$])=>Object.assign(F,{[B]:hi($)}),{})),{id:T});return _r({props:ui(ui({},k),j),slot:z.value,attrs:d,slots:g,name:I})}}});var RA=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(RA||{});let l_=Symbol("DialogContext");function Ah(a){let d=ir(l_,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,Ah),g}return d}let cp="DC8F892D-2EBD-447C-A4C8-A03058436FF4",iM=hr({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:cp},initialFocus:{type:Object,default:null}},emits:{close:a=>!0},setup(a,{emit:d,attrs:g,slots:b,expose:T}){var I;let z=$t(0),o=Sh(),k=Dt(()=>a.open===cp&&o!==null?Bn(o.value,{[Fn.Open]:!0,[Fn.Closed]:!1}):a.open),j=$t(new Set),F=$t(null),B=Dt(()=>el(F));if(T({el:F,$el:F}),!(a.open!==cp||o!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof k.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${k.value===cp?void 0:a.open}`);let $=Dt(()=>k.value?0:1),ne=Dt(()=>$.value===0),oe=Dt(()=>z.value>1),ve=ir(l_,null)!==null,Ie=Dt(()=>oe.value?"parent":"leaf"),Ge=SA(F,Dt(()=>ne.value?Bn(Ie.value,{parent:ah.RestoreFocus,leaf:ah.All&~ah.FocusLock}):ah.None),Dt(()=>({initialFocus:$t(a.initialFocus),containers:j})));IA(F,Dt(()=>oe.value?ne.value:!1)),kA({type:"Dialog",element:F,onUpdate:(We,xt,Et)=>{if(xt==="Dialog")return Bn(We,{[a_.Add](){j.value.add(Et),z.value+=1},[a_.Remove](){j.value.delete(Et),z.value-=1}})}});let qe=T1({name:"DialogDescription",slot:Dt(()=>({open:k.value}))}),st=`headlessui-dialog-${Tn()}`,ft=$t(null),He={titleId:ft,panelRef:$t(null),dialogState:$,setTitleId(We){ft.value!==We&&(ft.value=We)},close(){d("close",!1)}};br(l_,He),g1(()=>{var We,xt,Et;return[...Array.from((xt=(We=B.value)==null?void 0:We.querySelectorAll("body > *"))!=null?xt:[]).filter(gt=>!(!(gt instanceof HTMLElement)||gt.contains(Ge.value)||He.panelRef.value&&gt.contains(He.panelRef.value))),(Et=He.panelRef.value)!=null?Et:F.value]},(We,xt)=>{$.value===0&&(oe.value||(He.close(),Rn(()=>xt==null?void 0:xt.focus())))},_1.IgnoreScrollbars),o_((I=B.value)==null?void 0:I.defaultView,"keydown",We=>{We.key===or.Escape&&$.value===0&&(oe.value||(We.preventDefault(),We.stopPropagation(),He.close()))}),wn(We=>{var xt;if($.value!==0||ve)return;let Et=B.value;if(!Et)return;let gt=Et==null?void 0:Et.documentElement,Ft=(xt=Et.defaultView)!=null?xt:window,bt=gt.style.overflow,ei=gt.style.paddingRight,ri=Ft.innerWidth-gt.clientWidth;gt.style.overflow="hidden",gt.style.paddingRight=`${ri}px`,We(()=>{gt.style.overflow=bt,gt.style.paddingRight=ei})}),wn(We=>{if($.value!==0)return;let xt=$i(F);if(!xt)return;let Et=new IntersectionObserver(gt=>{for(let Ft of gt)Ft.boundingClientRect.x===0&&Ft.boundingClientRect.y===0&&Ft.boundingClientRect.width===0&&Ft.boundingClientRect.height===0&&He.close()});Et.observe(xt),We(()=>Et.disconnect())});function yt(We){We.stopPropagation()}return()=>{let We=xn(ui({},g),{ref:F,id:st,role:"dialog","aria-modal":$.value===0?!0:void 0,"aria-labelledby":ft.value,"aria-describedby":qe.value,onClick:yt}),bt=a,{open:xt,initialFocus:Et}=bt,gt=Do(bt,["open","initialFocus"]),Ft={open:$.value===0};return un(s_,{force:!0},()=>un(x1,()=>un(zA,{target:F.value},()=>un(s_,{force:!1},()=>_r({props:ui(ui({},gt),We),slot:Ft,attrs:g,slots:b,visible:$.value===0,features:ta.RenderStrategy|ta.Static,name:"Dialog"})))))}}});hr({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:d,slots:g}){let b=Ah("DialogOverlay"),T=`headlessui-dialog-overlay-${Tn()}`;function I(z){z.target===z.currentTarget&&(z.preventDefault(),z.stopPropagation(),b.close())}return()=>_r({props:xn(ui({},a),{id:T,"aria-hidden":!0,onClick:I}),slot:{open:b.dialogState.value===0},attrs:d,slots:g,name:"DialogOverlay"})}});hr({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(a,{attrs:d,slots:g,expose:b}){let T=Ah("DialogBackdrop"),I=`headlessui-dialog-backdrop-${Tn()}`,z=$t(null);return b({el:z,$el:z}),tn(()=>{if(T.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let o=a,k={id:I,ref:z,"aria-hidden":!0};return un(s_,{force:!0},()=>un(x1,()=>_r({props:ui(ui(ui({},d),o),k),slot:{open:T.dialogState.value===0},attrs:d,slots:g,name:"DialogBackdrop"})))}}});let rM=hr({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:d,slots:g}){let b=Ah("DialogPanel"),T=`headlessui-dialog-panel-${Tn()}`;return()=>{let I={id:T,ref:b.panelRef};return _r({props:ui(ui({},a),I),slot:{open:b.dialogState.value===0},attrs:d,slots:g,name:"DialogPanel"})}}}),nM=hr({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(a,{attrs:d,slots:g}){let b=Ah("DialogTitle"),T=`headlessui-dialog-title-${Tn()}`;return tn(()=>{b.setTitleId(T),uo(()=>b.setTitleId(null))}),()=>_r({props:xn(ui({},a),{id:T}),slot:{open:b.dialogState.value===0},attrs:d,slots:g,name:"DialogTitle"})}});var BA=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(BA||{});let E1=Symbol("DisclosureContext");function q_(a){let d=ir(E1,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,q_),g}return d}let S1=Symbol("DisclosurePanelContext");function OA(){return ir(S1,null)}let oM=hr({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(a,{slots:d,attrs:g}){let b=`headlessui-disclosure-button-${Tn()}`,T=`headlessui-disclosure-panel-${Tn()}`,I=$t(a.defaultOpen?0:1),z=$t(null),o=$t(null),k={buttonId:b,panelId:T,disclosureState:I,panel:z,button:o,toggleDisclosure(){I.value=Bn(I.value,{[0]:1,[1]:0})},closeDisclosure(){I.value!==1&&(I.value=1)},close(j){k.closeDisclosure();let F=(()=>j?j instanceof HTMLElement?j:j.value instanceof HTMLElement?$i(j):$i(k.button):$i(k.button))();F==null||F.focus()}};return br(E1,k),$_(Dt(()=>Bn(I.value,{[0]:Fn.Open,[1]:Fn.Closed}))),()=>{let $=a,{defaultOpen:j}=$,F=Do($,["defaultOpen"]),B={open:I.value===0,close:k.close};return _r({props:F,slot:B,slots:d,attrs:g,name:"Disclosure"})}}});hr({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(a,{attrs:d,slots:g,expose:b}){let T=q_("DisclosureButton"),I=OA(),z=I===null?!1:I===T.panelId,o=$t(null);b({el:o,$el:o}),z||wn(()=>{T.button.value=o.value});let k=G_(Dt(()=>({as:a.as,type:d.type})),o);function j(){var $;a.disabled||(z?(T.toggleDisclosure(),($=$i(T.button))==null||$.focus()):T.toggleDisclosure())}function F($){var ne;if(!a.disabled)if(z)switch($.key){case or.Space:case or.Enter:$.preventDefault(),$.stopPropagation(),T.toggleDisclosure(),(ne=$i(T.button))==null||ne.focus();break}else switch($.key){case or.Space:case or.Enter:$.preventDefault(),$.stopPropagation(),T.toggleDisclosure();break}}function B($){switch($.key){case or.Space:$.preventDefault();break}}return()=>{let $={open:T.disclosureState.value===0},ne=z?{ref:o,type:k.value,onClick:j,onKeydown:F}:{id:T.buttonId,ref:o,type:k.value,"aria-expanded":a.disabled?void 0:T.disclosureState.value===0,"aria-controls":$i(T.panel)?T.panelId:void 0,disabled:a.disabled?!0:void 0,onClick:j,onKeydown:F,onKeyup:B};return _r({props:ui(ui({},a),ne),slot:$,attrs:d,slots:g,name:"DisclosureButton"})}}});hr({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:d,slots:g,expose:b}){let T=q_("DisclosurePanel");b({el:T.panel,$el:T.panel}),br(S1,T.panelId);let I=Sh(),z=Dt(()=>I!==null?I.value===Fn.Open:T.disclosureState.value===0);return()=>{let o={open:T.disclosureState.value===0,close:T.close},k={id:T.panelId,ref:T.panel};return _r({props:ui(ui({},a),k),slot:o,attrs:d,slots:g,features:ta.RenderStrategy|ta.Static,visible:z.value,name:"DisclosurePanel"})}}});var FA=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(FA||{}),UA=(a=>(a[a.Pointer=0]="Pointer",a[a.Other=1]="Other",a))(UA||{});function jA(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let A1=Symbol("MenuContext");function jp(a){let d=ir(A1,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,jp),g}return d}let sM=hr({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:d,attrs:g}){let b=$t(1),T=$t(null),I=$t(null),z=$t([]),o=$t(""),k=$t(null),j=$t(1);function F($=ne=>ne){let ne=k.value!==null?z.value[k.value]:null,oe=m1($(z.value.slice()),Ie=>$i(Ie.dataRef.domRef)),ve=ne?oe.indexOf(ne):null;return ve===-1&&(ve=null),{items:oe,activeItemIndex:ve}}let B={menuState:b,buttonRef:T,itemsRef:I,items:z,searchQuery:o,activeItemIndex:k,activationTrigger:j,closeMenu:()=>{b.value=1,k.value=null},openMenu:()=>b.value=0,goToItem($,ne,oe){let ve=F(),Ie=fA($===Ln.Specific?{focus:Ln.Specific,id:ne}:{focus:$},{resolveItems:()=>ve.items,resolveActiveIndex:()=>ve.activeItemIndex,resolveId:Ge=>Ge.id,resolveDisabled:Ge=>Ge.dataRef.disabled});o.value="",k.value=Ie,j.value=oe!=null?oe:1,z.value=ve.items},search($){let ne=o.value!==""?0:1;o.value+=$.toLowerCase();let oe=(k.value!==null?z.value.slice(k.value+ne).concat(z.value.slice(0,k.value+ne)):z.value).find(Ie=>Ie.dataRef.textValue.startsWith(o.value)&&!Ie.dataRef.disabled),ve=oe?z.value.indexOf(oe):-1;ve===-1||ve===k.value||(k.value=ve,j.value=1)},clearSearch(){o.value=""},registerItem($,ne){let oe=F(ve=>[...ve,{id:$,dataRef:ne}]);z.value=oe.items,k.value=oe.activeItemIndex,j.value=1},unregisterItem($){let ne=F(oe=>{let ve=oe.findIndex(Ie=>Ie.id===$);return ve!==-1&&oe.splice(ve,1),oe});z.value=ne.items,k.value=ne.activeItemIndex,j.value=1}};return g1([T,I],($,ne)=>{var oe;b.value===0&&(B.closeMenu(),xA(ne,f1.Loose)||($.preventDefault(),(oe=$i(T))==null||oe.focus()))}),br(A1,B),$_(Dt(()=>Bn(b.value,{[0]:Fn.Open,[1]:Fn.Closed}))),()=>{let $={open:b.value===0};return _r({props:a,slot:$,slots:d,attrs:g,name:"Menu"})}}}),aM=hr({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"}},setup(a,{attrs:d,slots:g,expose:b}){let T=jp("MenuButton"),I=`headlessui-menu-button-${Tn()}`;b({el:T.buttonRef,$el:T.buttonRef});function z(F){switch(F.key){case or.Space:case or.Enter:case or.ArrowDown:F.preventDefault(),F.stopPropagation(),T.openMenu(),Rn(()=>{var B;(B=$i(T.itemsRef))==null||B.focus({preventScroll:!0}),T.goToItem(Ln.First)});break;case or.ArrowUp:F.preventDefault(),F.stopPropagation(),T.openMenu(),Rn(()=>{var B;(B=$i(T.itemsRef))==null||B.focus({preventScroll:!0}),T.goToItem(Ln.Last)});break}}function o(F){switch(F.key){case or.Space:F.preventDefault();break}}function k(F){a.disabled||(T.menuState.value===0?(T.closeMenu(),Rn(()=>{var B;return(B=$i(T.buttonRef))==null?void 0:B.focus({preventScroll:!0})})):(F.preventDefault(),F.stopPropagation(),T.openMenu(),jA(()=>{var B;return(B=$i(T.itemsRef))==null?void 0:B.focus({preventScroll:!0})})))}let j=G_(Dt(()=>({as:a.as,type:d.type})),T.buttonRef);return()=>{var F;let B={open:T.menuState.value===0},$={ref:T.buttonRef,id:I,type:j.value,"aria-haspopup":!0,"aria-controls":(F=$i(T.itemsRef))==null?void 0:F.id,"aria-expanded":a.disabled?void 0:T.menuState.value===0,onKeydown:z,onKeyup:o,onClick:k};return _r({props:ui(ui({},a),$),slot:B,attrs:d,slots:g,name:"MenuButton"})}}}),lM=hr({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:d,slots:g,expose:b}){let T=jp("MenuItems"),I=`headlessui-menu-items-${Tn()}`,z=$t(null);b({el:T.itemsRef,$el:T.itemsRef}),_A({container:Dt(()=>$i(T.itemsRef)),enabled:Dt(()=>T.menuState.value===0),accept(B){return B.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:B.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(B){B.setAttribute("role","none")}});function o(B){var $;switch(z.value&&clearTimeout(z.value),B.key){case or.Space:if(T.searchQuery.value!=="")return B.preventDefault(),B.stopPropagation(),T.search(B.key);case or.Enter:if(B.preventDefault(),B.stopPropagation(),T.activeItemIndex.value!==null){let ne=T.items.value[T.activeItemIndex.value];($=$i(ne.dataRef.domRef))==null||$.click()}T.closeMenu(),Rn(()=>{var ne;return(ne=$i(T.buttonRef))==null?void 0:ne.focus({preventScroll:!0})});break;case or.ArrowDown:return B.preventDefault(),B.stopPropagation(),T.goToItem(Ln.Next);case or.ArrowUp:return B.preventDefault(),B.stopPropagation(),T.goToItem(Ln.Previous);case or.Home:case or.PageUp:return B.preventDefault(),B.stopPropagation(),T.goToItem(Ln.First);case or.End:case or.PageDown:return B.preventDefault(),B.stopPropagation(),T.goToItem(Ln.Last);case or.Escape:B.preventDefault(),B.stopPropagation(),T.closeMenu(),Rn(()=>{var ne;return(ne=$i(T.buttonRef))==null?void 0:ne.focus({preventScroll:!0})});break;case or.Tab:B.preventDefault(),B.stopPropagation();break;default:B.key.length===1&&(T.search(B.key),z.value=setTimeout(()=>T.clearSearch(),350));break}}function k(B){switch(B.key){case or.Space:B.preventDefault();break}}let j=Sh(),F=Dt(()=>j!==null?j.value===Fn.Open:T.menuState.value===0);return()=>{var B,$;let ne={open:T.menuState.value===0},oe={"aria-activedescendant":T.activeItemIndex.value===null||(B=T.items.value[T.activeItemIndex.value])==null?void 0:B.id,"aria-labelledby":($=$i(T.buttonRef))==null?void 0:$.id,id:I,onKeydown:o,onKeyup:k,role:"menu",tabIndex:0,ref:T.itemsRef};return _r({props:ui(ui({},a),oe),slot:ne,attrs:d,slots:g,features:ta.RenderStrategy|ta.Static,visible:F.value,name:"MenuItems"})}}}),cM=hr({name:"MenuItem",props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1}},setup(a,{slots:d,attrs:g,expose:b}){let T=jp("MenuItem"),I=`headlessui-menu-item-${Tn()}`,z=$t(null);b({el:z,$el:z});let o=Dt(()=>T.activeItemIndex.value!==null?T.items.value[T.activeItemIndex.value].id===I:!1),k=Dt(()=>({disabled:a.disabled,textValue:"",domRef:z}));tn(()=>{var ne,oe;let ve=(oe=(ne=$i(z))==null?void 0:ne.textContent)==null?void 0:oe.toLowerCase().trim();ve!==void 0&&(k.value.textValue=ve)}),tn(()=>T.registerItem(I,k)),uo(()=>T.unregisterItem(I)),wn(()=>{T.menuState.value===0&&(!o.value||T.activationTrigger.value!==0&&Rn(()=>{var ne,oe;return(oe=(ne=$i(z))==null?void 0:ne.scrollIntoView)==null?void 0:oe.call(ne,{block:"nearest"})}))});function j(ne){if(a.disabled)return ne.preventDefault();T.closeMenu(),Rn(()=>{var oe;return(oe=$i(T.buttonRef))==null?void 0:oe.focus({preventScroll:!0})})}function F(){if(a.disabled)return T.goToItem(Ln.Nothing);T.goToItem(Ln.Specific,I)}function B(){a.disabled||o.value||T.goToItem(Ln.Specific,I,0)}function $(){a.disabled||!o.value||T.goToItem(Ln.Nothing)}return()=>{let{disabled:ne}=a,oe={active:o.value,disabled:ne};return _r({props:xn(ui({},a),{id:I,ref:z,role:"menuitem",tabIndex:ne===!0?void 0:-1,"aria-disabled":ne===!0?!0:void 0,onClick:j,onFocus:F,onPointermove:B,onMousemove:B,onPointerleave:$,onMouseleave:$}),slot:oe,attrs:g,slots:d,name:"MenuItem"})}}}),I1=Symbol("LabelContext");function C1(){let a=ir(I1,null);if(a===null){let d=new Error("You used a <Label /> component, but it is not inside a parent.");throw Error.captureStackTrace&&Error.captureStackTrace(d,C1),d}return a}function NA({slot:a={},name:d="Label",props:g={}}={}){let b=$t([]);function T(I){return b.value.push(I),()=>{let z=b.value.indexOf(I);z!==-1&&b.value.splice(z,1)}}return br(I1,{register:T,slot:a,name:d,props:g}),Dt(()=>b.value.length>0?b.value.join(" "):void 0)}let VA=hr({name:"Label",props:{as:{type:[Object,String],default:"label"},passive:{type:[Boolean],default:!1}},setup(a,{slots:d,attrs:g}){let b=C1(),T=`headlessui-label-${Tn()}`;return tn(()=>uo(b.register(T))),()=>{let{name:I="Label",slot:z={},props:o={}}=b,$=a,{passive:k}=$,j=Do($,["passive"]),F=xn(ui({},Object.entries(o).reduce((ne,[oe,ve])=>Object.assign(ne,{[oe]:hi(ve)}),{})),{id:T}),B=ui(ui({},j),F);return k&&delete B.onClick,_r({props:B,slot:z,attrs:g,slots:d,name:I})}}}),M1=Symbol("GroupContext"),uM=hr({name:"SwitchGroup",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:d,attrs:g}){let b=$t(null),T=NA({name:"SwitchLabel",props:{onClick(){!b.value||(b.value.click(),b.value.focus({preventScroll:!0}))}}}),I=T1({name:"SwitchDescription"});return br(M1,{switchRef:b,labelledby:T,describedby:I}),()=>_r({props:a,slot:{},slots:d,attrs:g,name:"SwitchGroup"})}}),hM=hr({name:"Switch",emits:{"update:modelValue":a=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:!1},name:{type:String,optional:!0},value:{type:String,optional:!0}},inheritAttrs:!1,setup(a,{emit:d,attrs:g,slots:b,expose:T}){let I=ir(M1,null),z=`headlessui-switch-${Tn()}`;function o(){d("update:modelValue",!a.modelValue)}let k=$t(null),j=I===null?k:I.switchRef,F=G_(Dt(()=>({as:a.as,type:g.type})),j);T({el:j,$el:j});function B(oe){oe.preventDefault(),o()}function $(oe){oe.key===or.Space?(oe.preventDefault(),o()):oe.key===or.Enter&&EA(oe.currentTarget)}function ne(oe){oe.preventDefault()}return()=>{let ft=a,{name:oe,value:ve,modelValue:Ie}=ft,Ge=Do(ft,["name","value","modelValue"]),qe={checked:Ie},st={id:z,ref:j,role:"switch",type:F.value,tabIndex:0,"aria-checked":Ie,"aria-labelledby":I==null?void 0:I.labelledby.value,"aria-describedby":I==null?void 0:I.describedby.value,onClick:B,onKeyup:$,onKeypress:ne};return un(ao,[oe!=null&&Ie!=null?un(TA,cA({as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:Ie,name:oe,value:ve})):null,_r({props:ui(ui(ui({},g),Ge),st),slot:qe,attrs:g,slots:b,name:"Switch"})])}}}),dM=VA,pM=LA;function $A(a){let d={called:!1};return(...g)=>{if(!d.called)return d.called=!0,a(...g)}}function z1(){let a=[],d=[],g={enqueue(b){d.push(b)},requestAnimationFrame(...b){let T=requestAnimationFrame(...b);g.add(()=>cancelAnimationFrame(T))},nextFrame(...b){g.requestAnimationFrame(()=>{g.requestAnimationFrame(...b)})},setTimeout(...b){let T=setTimeout(...b);g.add(()=>clearTimeout(T))},add(b){a.push(b)},dispose(){for(let b of a.splice(0))b()},async workQueue(){for(let b of d.splice(0))await b()}};return g}function Mm(a,...d){a&&d.length>0&&a.classList.add(...d)}function up(a,...d){a&&d.length>0&&a.classList.remove(...d)}var c_=(a=>(a.Finished="finished",a.Cancelled="cancelled",a))(c_||{});function GA(a,d){let g=z1();if(!a)return g.dispose;let{transitionDuration:b,transitionDelay:T}=getComputedStyle(a),[I,z]=[b,T].map(o=>{let[k=0]=o.split(",").filter(Boolean).map(j=>j.includes("ms")?parseFloat(j):parseFloat(j)*1e3).sort((j,F)=>F-j);return k});return I!==0?g.setTimeout(()=>d("finished"),I+z):d("finished"),g.add(()=>d("cancelled")),g.dispose}function kv(a,d,g,b,T,I){let z=z1(),o=I!==void 0?$A(I):()=>{};return up(a,...T),Mm(a,...d,...g),z.nextFrame(()=>{up(a,...g),Mm(a,...b),z.add(GA(a,k=>(up(a,...b,...d),Mm(a,...T),o(k))))}),z.add(()=>up(a,...d,...g,...b,...T)),z.add(()=>o("cancelled")),z.dispose}function Xa(a=""){return a.split(" ").filter(d=>d.trim().length>1)}let Z_=Symbol("TransitionContext");var qA=(a=>(a.Visible="visible",a.Hidden="hidden",a))(qA||{});function ZA(){return ir(Z_,null)!==null}function WA(){let a=ir(Z_,null);if(a===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return a}function XA(){let a=ir(W_,null);if(a===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return a}let W_=Symbol("NestingContext");function Np(a){return"children"in a?Np(a.children):a.value.filter(({state:d})=>d==="visible").length>0}function P1(a){let d=$t([]),g=$t(!1);tn(()=>g.value=!0),uo(()=>g.value=!1);function b(I,z=Xs.Hidden){let o=d.value.findIndex(({id:k})=>k===I);o!==-1&&(Bn(z,{[Xs.Unmount](){d.value.splice(o,1)},[Xs.Hidden](){d.value[o].state="hidden"}}),!Np(d)&&g.value&&(a==null||a()))}function T(I){let z=d.value.find(({id:o})=>o===I);return z?z.state!=="visible"&&(z.state="visible"):d.value.push({id:I,state:"visible"}),()=>b(I,Xs.Unmount)}return{children:d,register:T,unregister:b}}let k1=ta.RenderStrategy,HA=hr({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(a,{emit:d,attrs:g,slots:b,expose:T}){if(!ZA()&&mA())return()=>un(YA,xn(ui({},a),{onBeforeEnter:()=>d("beforeEnter"),onAfterEnter:()=>d("afterEnter"),onBeforeLeave:()=>d("beforeLeave"),onAfterLeave:()=>d("afterLeave")}),b);let I=$t(null),z=$t("visible"),o=Dt(()=>a.unmount?Xs.Unmount:Xs.Hidden);T({el:I,$el:I});let{show:k,appear:j}=WA(),{register:F,unregister:B}=XA(),$={value:!0},ne=Tn(),oe={value:!1},ve=P1(()=>{oe.value||(z.value="hidden",B(ne),d("afterLeave"))});tn(()=>{let xt=F(ne);uo(xt)}),wn(()=>{if(o.value===Xs.Hidden&&!!ne){if(k&&z.value!=="visible"){z.value="visible";return}Bn(z.value,{hidden:()=>B(ne),visible:()=>F(ne)})}});let Ie=Xa(a.enter),Ge=Xa(a.enterFrom),qe=Xa(a.enterTo),st=Xa(a.entered),ft=Xa(a.leave),He=Xa(a.leaveFrom),yt=Xa(a.leaveTo);tn(()=>{wn(()=>{if(z.value==="visible"){let xt=$i(I);if(xt instanceof Comment&&xt.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function We(xt){let Et=$.value&&!j.value,gt=$i(I);!gt||!(gt instanceof HTMLElement)||Et||(oe.value=!0,k.value&&d("beforeEnter"),k.value||d("beforeLeave"),xt(k.value?kv(gt,Ie,Ge,qe,st,Ft=>{oe.value=!1,Ft===c_.Finished&&d("afterEnter")}):kv(gt,ft,He,yt,st,Ft=>{oe.value=!1,Ft===c_.Finished&&(Np(ve)||(z.value="hidden",B(ne),d("afterLeave")))})))}return tn(()=>{bn([k,j],(xt,Et,gt)=>{We(gt),$.value=!1},{immediate:!0})}),br(W_,ve),$_(Dt(()=>Bn(z.value,{visible:Fn.Open,hidden:Fn.Closed}))),()=>{let Lt=a,{appear:xt,show:Et,enter:gt,enterFrom:Ft,enterTo:bt,entered:ei,leave:ri,leaveFrom:Er,leaveTo:vi}=Lt,fi=Do(Lt,["appear","show","enter","enterFrom","enterTo","entered","leave","leaveFrom","leaveTo"]);return _r({props:xn(ui({},fi),{ref:I}),slot:{},slots:b,attrs:g,features:k1,visible:z.value==="visible",name:"TransitionChild"})}}}),KA=HA,YA=hr({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(a,{emit:d,attrs:g,slots:b}){let T=Sh(),I=Dt(()=>a.show===null&&T!==null?Bn(T.value,{[Fn.Open]:!0,[Fn.Closed]:!1}):a.show);wn(()=>{if(![!0,!1].includes(I.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let z=$t(I.value?"visible":"hidden"),o=P1(()=>{z.value="hidden"}),k={value:!0},j={show:I,appear:Dt(()=>a.appear||!k.value)};return tn(()=>{wn(()=>{k.value=!1,I.value?z.value="visible":Np(o)||(z.value="hidden")})}),br(W_,o),br(Z_,j),()=>{let F=d1(a,["show","appear","unmount"]),B={unmount:a.unmount};return _r({props:xn(ui({},B),{as:"template"}),slot:{},slots:xn(ui({},b),{default:()=>[un(KA,ui(ui(ui({onBeforeEnter:()=>d("beforeEnter"),onAfterEnter:()=>d("afterEnter"),onBeforeLeave:()=>d("beforeLeave"),onAfterLeave:()=>d("afterLeave")},g),B),F),b.default)]}),attrs:{},features:k1,visible:z.value==="visible",name:"Transition"})}}});function fM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z"})])}function mM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])}function _M(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function gM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})])}function yM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function xM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])}function vM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})])}function bM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})])}function wM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})])}function TM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])}function EM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})])}function SM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"})])}function AM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}function IM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function CM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function MM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ki("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])}try{self["workbox:window:6.5.2"]&&_()}catch{}function Dv(a,d){return new Promise(function(g){var b=new MessageChannel;b.port1.onmessage=function(T){g(T.data)},a.postMessage(d,[b.port2])})}function JA(a,d){for(var g=0;g<d.length;g++){var b=d[g];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(a,b.key,b)}}function Lv(a,d){(d==null||d>a.length)&&(d=a.length);for(var g=0,b=new Array(d);g<d;g++)b[g]=a[g];return b}function QA(a,d){var g;if(typeof Symbol=="undefined"||a[Symbol.iterator]==null){if(Array.isArray(a)||(g=function(T,I){if(T){if(typeof T=="string")return Lv(T,I);var z=Object.prototype.toString.call(T).slice(8,-1);return z==="Object"&&T.constructor&&(z=T.constructor.name),z==="Map"||z==="Set"?Array.from(T):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?Lv(T,I):void 0}}(a))||d&&a&&typeof a.length=="number"){g&&(a=g);var b=0;return function(){return b>=a.length?{done:!0}:{done:!1,value:a[b++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(g=a[Symbol.iterator]()).next.bind(g)}try{self["workbox:core:6.5.2"]&&_()}catch{}var zm=function(){var a=this;this.promise=new Promise(function(d,g){a.resolve=d,a.reject=g})};function Pm(a,d){var g=location.href;return new URL(a,g).href===new URL(d,g).href}var rh=function(a,d){this.type=a,Object.assign(this,d)};function hp(a,d,g){return g?d?d(a):a:(a&&a.then||(a=Promise.resolve(a)),d?a.then(d):a)}function eI(){}var tI={type:"SKIP_WAITING"};function Rv(a,d){if(!d)return a&&a.then?a.then(eI):Promise.resolve()}var zM=function(a){var d,g;function b(o,k){var j,F;return k===void 0&&(k={}),(j=a.call(this)||this).nn={},j.tn=0,j.rn=new zm,j.en=new zm,j.on=new zm,j.un=0,j.an=new Set,j.cn=function(){var B=j.fn,$=B.installing;j.tn>0||!Pm($.scriptURL,j.sn.toString())||performance.now()>j.un+6e4?(j.vn=$,B.removeEventListener("updatefound",j.cn)):(j.hn=$,j.an.add($),j.rn.resolve($)),++j.tn,$.addEventListener("statechange",j.ln)},j.ln=function(B){var $=j.fn,ne=B.target,oe=ne.state,ve=ne===j.vn,Ie={sw:ne,isExternal:ve,originalEvent:B};!ve&&j.mn&&(Ie.isUpdate=!0),j.dispatchEvent(new rh(oe,Ie)),oe==="installed"?j.wn=self.setTimeout(function(){oe==="installed"&&$.waiting===ne&&j.dispatchEvent(new rh("waiting",Ie))},200):oe==="activating"&&(clearTimeout(j.wn),ve||j.en.resolve(ne))},j.dn=function(B){var $=j.hn,ne=$!==navigator.serviceWorker.controller;j.dispatchEvent(new rh("controlling",{isExternal:ne,originalEvent:B,sw:$,isUpdate:j.mn})),ne||j.on.resolve($)},j.gn=(F=function(B){var $=B.data,ne=B.ports,oe=B.source;return hp(j.getSW(),function(){j.an.has(oe)&&j.dispatchEvent(new rh("message",{data:$,originalEvent:B,ports:ne,sw:oe}))})},function(){for(var B=[],$=0;$<arguments.length;$++)B[$]=arguments[$];try{return Promise.resolve(F.apply(this,B))}catch(ne){return Promise.reject(ne)}}),j.sn=o,j.nn=k,navigator.serviceWorker.addEventListener("message",j.gn),j}g=a,(d=b).prototype=Object.create(g.prototype),d.prototype.constructor=d,d.__proto__=g;var T,I,z=b.prototype;return z.register=function(o){var k=(o===void 0?{}:o).immediate,j=k!==void 0&&k;try{var F=this;return function(B,$){var ne=B();return ne&&ne.then?ne.then($):$(ne)}(function(){if(!j&&document.readyState!=="complete")return Rv(new Promise(function(B){return window.addEventListener("load",B)}))},function(){return F.mn=Boolean(navigator.serviceWorker.controller),F.yn=F.pn(),hp(F.bn(),function(B){F.fn=B,F.yn&&(F.hn=F.yn,F.en.resolve(F.yn),F.on.resolve(F.yn),F.yn.addEventListener("statechange",F.ln,{once:!0}));var $=F.fn.waiting;return $&&Pm($.scriptURL,F.sn.toString())&&(F.hn=$,Promise.resolve().then(function(){F.dispatchEvent(new rh("waiting",{sw:$,wasWaitingBeforeRegister:!0}))}).then(function(){})),F.hn&&(F.rn.resolve(F.hn),F.an.add(F.hn)),F.fn.addEventListener("updatefound",F.cn),navigator.serviceWorker.addEventListener("controllerchange",F.dn),F.fn})})}catch(B){return Promise.reject(B)}},z.update=function(){try{return this.fn?Rv(this.fn.update()):void 0}catch(o){return Promise.reject(o)}},z.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},z.messageSW=function(o){try{return hp(this.getSW(),function(k){return Dv(k,o)})}catch(k){return Promise.reject(k)}},z.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&Dv(this.fn.waiting,tI)},z.pn=function(){var o=navigator.serviceWorker.controller;return o&&Pm(o.scriptURL,this.sn.toString())?o:void 0},z.bn=function(){try{var o=this;return function(k,j){try{var F=k()}catch(B){return j(B)}return F&&F.then?F.then(void 0,j):F}(function(){return hp(navigator.serviceWorker.register(o.sn,o.nn),function(k){return o.un=performance.now(),k})},function(k){throw k})}catch(k){return Promise.reject(k)}},T=b,(I=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&JA(T.prototype,I),b}(function(){function a(){this.Pn=new Map}var d=a.prototype;return d.addEventListener=function(g,b){this.Sn(g).add(b)},d.removeEventListener=function(g,b){this.Sn(g).delete(b)},d.dispatchEvent=function(g){g.target=this;for(var b,T=QA(this.Sn(g.type));!(b=T()).done;)(0,b.value)(g)},d.Sn=function(g){return this.Pn.has(g)||this.Pn.set(g,new Set),this.Pn.get(g)},a}()),iI=!1;/*!
  * pinia v2.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let D1;const Vp=a=>D1=a,L1=Symbol();function u_(a){return a&&typeof a=="object"&&Object.prototype.toString.call(a)==="[object Object]"&&typeof a.toJSON!="function"}var fh;(function(a){a.direct="direct",a.patchObject="patch object",a.patchFunction="patch function"})(fh||(fh={}));function PM(){const a=i0(!0),d=a.run(()=>$t({}));let g=[],b=[];const T=gc({install(I){Vp(T),T._a=I,I.provide(L1,T),I.config.globalProperties.$pinia=T,b.forEach(z=>g.push(z)),b=[]},use(I){return!this._a&&!iI?b.push(I):g.push(I),this},_p:g,_a:null,_e:a,_s:new Map,state:d});return T}const R1=()=>{};function Bv(a,d,g,b=R1){a.push(d);const T=()=>{const I=a.indexOf(d);I>-1&&(a.splice(I,1),b())};return!g&&Eh()&&uo(T),T}function sc(a,...d){a.slice().forEach(g=>{g(...d)})}function h_(a,d){for(const g in d){if(!d.hasOwnProperty(g))continue;const b=d[g],T=a[g];u_(T)&&u_(b)&&a.hasOwnProperty(g)&&!ar(b)&&!as(b)?a[g]=h_(T,b):a[g]=b}return a}const rI=Symbol();function nI(a){return!u_(a)||!a.hasOwnProperty(rI)}const{assign:os}=Object;function oI(a){return!!(ar(a)&&a.effect)}function sI(a,d,g,b){const{state:T,actions:I,getters:z}=d,o=g.state.value[a];let k;function j(){o||(g.state.value[a]=T?T():{});const F=xT(g.state.value[a]);return os(F,I,Object.keys(z||{}).reduce((B,$)=>(B[$]=gc(Dt(()=>{Vp(g);const ne=g._s.get(a);return z[$].call(ne,ne)})),B),{}))}return k=B1(a,j,d,g),k.$reset=function(){const B=T?T():{};this.$patch($=>{os($,B)})},k}function B1(a,d,g={},b,T){let I;const z=g.state,o=os({actions:{}},g),k={deep:!0};let j,F,B=gc([]),$=gc([]),ne;const oe=b.state.value[a];!z&&!oe&&(b.state.value[a]={}),$t({});function ve(yt){let We;j=F=!1,typeof yt=="function"?(yt(b.state.value[a]),We={type:fh.patchFunction,storeId:a,events:ne}):(h_(b.state.value[a],yt),We={type:fh.patchObject,payload:yt,storeId:a,events:ne}),Rn().then(()=>{j=!0}),F=!0,sc(B,We,b.state.value[a])}const Ie=R1;function Ge(){I.stop(),B=[],$=[],b._s.delete(a)}function qe(yt,We){return function(){Vp(b);const xt=Array.from(arguments),Et=[],gt=[];function Ft(ri){Et.push(ri)}function bt(ri){gt.push(ri)}sc($,{args:xt,name:yt,store:ft,after:Ft,onError:bt});let ei;try{ei=We.apply(this&&this.$id===a?this:ft,xt)}catch(ri){throw sc(gt,ri),ri}return ei instanceof Promise?ei.then(ri=>(sc(Et,ri),ri)).catch(ri=>(sc(gt,ri),Promise.reject(ri))):(sc(Et,ei),ei)}}const st={_p:b,$id:a,$onAction:Bv.bind(null,$),$patch:ve,$reset:Ie,$subscribe(yt,We={}){const xt=Bv(B,yt,We.detached,()=>Et()),Et=I.run(()=>bn(()=>b.state.value[a],gt=>{(We.flush==="sync"?F:j)&&yt({storeId:a,type:fh.direct,events:ne},gt)},os({},k,We)));return xt},$dispose:Ge},ft=Fo(os({},st));b._s.set(a,ft);const He=b._e.run(()=>(I=i0(),I.run(()=>d())));for(const yt in He){const We=He[yt];if(ar(We)&&!oI(We)||as(We))z||(oe&&nI(We)&&(ar(We)?We.value=oe[yt]:h_(We,oe[yt])),b.state.value[a][yt]=We);else if(typeof We=="function"){const xt=qe(yt,We);He[yt]=xt,o.actions[yt]=We}}return os(ft,He),os(Oi(ft),He),Object.defineProperty(ft,"$state",{get:()=>b.state.value[a],set:yt=>{ve(We=>{os(We,yt)})}}),b._p.forEach(yt=>{os(ft,I.run(()=>yt({store:ft,app:b._a,pinia:b,options:o})))}),oe&&z&&g.hydrate&&g.hydrate(ft.$state,oe),j=!0,F=!0,ft}function kM(a,d,g){let b,T;const I=typeof d=="function";typeof a=="string"?(b=a,T=I?g:d):(T=a,b=a.id);function z(o,k){const j=Eh();return o=o||j&&ir(L1),o&&Vp(o),o=D1,o._s.has(b)||(I?B1(b,d,T,o):sI(b,T,o)),o._s.get(b)}return z.$id=b,z}var aI=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},O1={exports:{}};(function(a,d){(function(g,b){a.exports=b()})(aI,function(){var g,b,T;function I(o,k){if(!g)g=k;else if(!b)b=k;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+b+")(sharedChunk); self.onerror = null;",F={};g(F),T=k(F),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}I(["exports"],function(o){var k=typeof self!="undefined"?self:{},j=F;function F(i,e,t,n){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=t,this.p2y=n}F.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},F.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},F.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},F.prototype.solveCurveX=function(i,e){var t,n,l,u,p;for(e===void 0&&(e=1e-6),l=i,p=0;p<8;p++){if(u=this.sampleCurveX(l)-i,Math.abs(u)<e)return l;var f=this.sampleCurveDerivativeX(l);if(Math.abs(f)<1e-6)break;l-=u/f}if((l=i)<(t=0))return t;if(l>(n=1))return n;for(;t<n;){if(u=this.sampleCurveX(l),Math.abs(u-i)<e)return l;i>u?t=l:n=l,l=.5*(n-t)+t}return l},F.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var B=$;function $(i,e){this.x=i,this.y=e}$.prototype={clone:function(){return new $(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),n=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=n,this},_rotateAround:function(i,e){var t=Math.cos(i),n=Math.sin(i),l=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-n*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},$.convert=function(i){return i instanceof $?i:Array.isArray(i)?new $(i[0],i[1]):i};const ne=Math.PI/180,oe=180/Math.PI;function ve(i){return i*ne}function Ie(i){return i*oe}const Ge=[[0,0],[1,0],[1,1],[0,1]];function qe(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function st(i,e,t,n){const l=new j(i,e,t,n);return function(u){return l.solve(u)}}const ft=st(.25,.1,.25,1);function He(i,e,t){return Math.min(t,Math.max(e,i))}function yt(i,e,t){return(t=He((t-i)/(e-i),0,1))*t*(3-2*t)}function We(i,e,t){const n=t-e,l=((i-e)%n+n)%n+e;return l===e?t:l}function xt(i,e,t){if(!i.length)return t(null,[]);let n=i.length;const l=new Array(i.length);let u=null;i.forEach((p,f)=>{e(p,(x,v)=>{x&&(u=x),l[f]=v,--n==0&&t(u,l)})})}function Et(i){const e=[];for(const t in i)e.push(i[t]);return e}function gt(i,...e){for(const t of e)for(const n in t)i[n]=t[n];return i}let Ft=1;function bt(){return Ft++}function ei(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function ri(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Er(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function vi(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function fi(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Lt(i,e,t){const n={};for(const l in i)n[l]=e.call(t||this,i[l],l,i);return n}function Gi(i,e,t){const n={};for(const l in i)e.call(t||this,i[l],l,i)&&(n[l]=i[l]);return n}function lr(i){return Array.isArray(i)?i.map(lr):typeof i=="object"&&i?Lt(i,lr):i}const Nr={};function bi(i){Nr[i]||(typeof console!="undefined"&&console.warn(i),Nr[i]=!0)}function Fi(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function rn(i){let e=0;for(let t,n,l=0,u=i.length,p=u-1;l<u;p=l++)t=i[l],n=i[p],e+=(n.x-t.x)*(t.y+n.y);return e}function $e(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function St(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,l,u)=>{const p=l||u;return e[n]=!p||p.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let ut=null;function Pt(i){if(ut==null){const e=i.navigator?i.navigator.userAgent:null;ut=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ut}function Ei(i){try{const e=k[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function yi(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const ni=k.performance;function Zt(i){const e=i?i.url.toString():void 0;return ni.getEntriesByName(e)}var ce="2.10.0";let _e,Pe,Ke,Xe;const rt={now:()=>Ke!==void 0?Ke:k.performance.now(),setNow(i){Ke=i},restoreNow(){Ke=void 0},frame(i){const e=k.requestAnimationFrame(i);return{cancel:()=>k.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:n}=i;Xe||(Xe=k.document.createElement("canvas"));const l=Xe.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(t>Xe.width||n>Xe.height)&&(Xe.width=t,Xe.height=n),l.clearRect(-e,-e,t+2*e,n+2*e),l.drawImage(i,0,0,t,n),l.getImageData(-e,-e,t+2*e,n+2*e)},resolveURL:i=>(_e||(_e=k.document.createElement("a")),_e.href=i,_e.href),get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(Pe==null&&(Pe=k.matchMedia("(prefers-reduced-motion: reduce)")),Pe.matches)}};let vt;const Ue={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(vt==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{vt={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{vt=i}}return vt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},lt={supported:!1,testSupport:function(i){!At&&zt&&(Bt?Gt(i):tt=i)}};let tt,zt,At=!1,Bt=!1;function Gt(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,zt),i.isContextLost())return;lt.supported=!0}catch{}i.deleteTexture(e),At=!0}k.document&&(zt=k.document.createElement("img"),zt.onload=function(){tt&&Gt(tt),tt=null,Bt=!0},zt.onerror=function(){At=!0,tt=null},zt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const li="01",di="NO_ACCESS_TOKEN";function pi(i){return i.indexOf("mapbox:")===0}function Si(i){return Ue.API_URL_REGEX.test(i)}const Pr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fr(i){const e=i.match(Pr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function hn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Un(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ho{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Un(Ue.ACCESS_TOKEN);let n="";return n=t&&t.u?k.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):Ue.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=Ei("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const l=k.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));const u=k.localStorage.getItem(n);u&&(this.anonId=u)}catch{bi("Unable to read from LocalStorage")}}saveEventData(){const e=Ei("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{k.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{bi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,l){if(!Ue.EVENTS_URL)return;const u=fr(Ue.EVENTS_URL);u.params.push(`access_token=${l||Ue.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:li,userId:this.anonId},f=t?gt(p,t):p,x={url:hn(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=je(x,v=>{this.pendingRequest=null,n(v),this.saveEventData(),this.processRequests(l)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const gr=new class extends ho{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Ue.EVENTS_URL&&Ue.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>pi(t)||Si(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Un(Ue.ACCESS_TOKEN),t=e?e.u:Ue.ACCESS_TOKEN;let n=t!==this.eventData.tokenU;Er(this.anonId)||(this.anonId=ei(),n=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(l),f=(l-this.eventData.lastSuccess)/864e5;n=n||f>=1||f<-1||u.getDate()!==p.getDate()}else n=!0;n?this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=t)},i):this.processRequests()}},kr=gr.postTurnstileEvent.bind(gr),po=new class extends ho{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,n){this.skuToken=e,this.errorCb=n,Ue.EVENTS_URL&&(t||Ue.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(di)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Er(this.anonId)||(this.anonId=ei()),this.postEvent(t,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},il=po.postMapLoadEvent.bind(po),rl=new class extends ho{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,n){if(!Ue.API_URL||!Ue.SESSION_PATH)return;const l=fr(Ue.API_URL+Ue.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${n||Ue.ACCESS_TOKEN||""}`);const u={url:hn(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ht(u,p=>{this.pendingRequest=null,t(p),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,t,n){this.skuToken=e,this.errorCb=n,Ue.SESSION_PATH&&Ue.API_URL&&(t||Ue.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(di)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},Sc=rl.getSessionAPI.bind(rl),fo=new Set;let Hn,us=500,nl=50,Xr={};function ra(i){const e=N(i);let t,n;e&&e.forEach(u=>{const p=u.split("=");p[0]==="language"?t=p[1]:p[0]==="worldview"&&(n=p[1])});let l="mapbox-tiles";return t&&(l+=`-${t}`),n&&(l+=`-${n}`),l}function ee(){try{return k.caches}catch{}}function O(i){const e=ee();e&&!Xr[i]&&(Xr[i]=e.open(i))}function N(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function J(i){const e=i.indexOf("?");if(e<0)return i;const t=N(i).filter(n=>{const l=n.split("=");return l[0]==="language"||l[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let re=1/0;const ge={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ge);class Te extends Error{constructor(e,t,n){t===401&&Si(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const be=$e()?()=>self.worker&&self.worker.referrer:()=>(k.location.protocol==="blob:"?k.parent:k).location.href,ye=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(be())&&!/^\w+:/.test(t))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(n,l){const u=new k.AbortController,p=new k.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:be(),signal:u.signal});let f=!1,x=!1;const v=(S=p.url).indexOf("sku=")>0&&Si(S);var S;n.type==="json"&&p.headers.set("Accept","application/json");const C=(L,R,V)=>{if(x)return;if(L&&L.message!=="SecurityError"&&bi(L),R&&V)return M(R);const q=Date.now();k.fetch(p).then(Q=>{if(Q.ok){const le=v?Q.clone():null;return M(Q,le,q)}return l(new Te(Q.statusText,Q.status,n.url))}).catch(Q=>{Q.code!==20&&l(new Error(Q.message))})},M=(L,R,V)=>{(n.type==="arrayBuffer"?L.arrayBuffer():n.type==="json"?L.json():L.text()).then(q=>{x||(R&&V&&function(Q,le,ie){const se=ra(Q.url);if(O(se),!Xr[se])return;const me={status:le.status,statusText:le.statusText,headers:new k.Headers};le.headers.forEach((Ae,De)=>me.headers.set(De,Ae));const ue=St(le.headers.get("Cache-Control")||"");if(ue["no-store"])return;ue["max-age"]&&me.headers.set("Expires",new Date(ie+1e3*ue["max-age"]).toUTCString());const Ce=me.headers.get("Expires");Ce&&(new Date(Ce).getTime()-ie<42e4||function(Ae,De){if(Hn===void 0)try{new Response(new ReadableStream),Hn=!0}catch{Hn=!1}Hn?De(Ae.body):Ae.blob().then(De)}(le,Ae=>{const De=new k.Response(Ae,me);O(se),Xr[se]&&Xr[se].then(et=>et.put(J(Q.url),De)).catch(et=>bi(et.message))}))}(p,R,V),f=!0,l(null,q,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(q=>{x||l(new Error(q.message))})};return v?function(L,R){const V=ra(L.url);if(O(V),!Xr[V])return R(null);const q=J(L.url);Xr[V].then(Q=>{Q.match(q).then(le=>{const ie=function(se){if(!se)return!1;const me=new Date(se.headers.get("Expires")||0),ue=St(se.headers.get("Cache-Control")||"");return me>Date.now()&&!ue["no-cache"]}(le);Q.delete(q),ie&&Q.put(q,le.clone()),R(null,le,ie)}).catch(R)}).catch(R)}(p,C):C(null,null),{cancel:()=>{x=!0,f||u.abort()}}}(i,e);if($e()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(n,l){const u=new k.XMLHttpRequest;u.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in n.headers)u.setRequestHeader(p,n.headers[p]);return n.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=n.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(n.type==="json")try{p=JSON.parse(u.response)}catch(f){return l(f)}l(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Te(u.statusText,u.status,n.url))},u.send(n.body),{cancel:()=>u.abort()}}(i,e)},Ee=function(i,e){return ye(gt(i,{type:"arrayBuffer"}),e)},je=function(i,e){return ye(gt(i,{method:"POST"}),e)},ht=function(i,e){return ye(gt(i,{method:"GET"}),e)};function Ze(i){const e=k.document.createElement("a");return e.href=i,e.protocol===k.document.location.protocol&&e.host===k.document.location.host}const Rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ot,It;Ot=[],It=0;const Ut=function(i,e){if(lt.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),It>=Ue.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ot.push(u),u}It++;let t=!1;const n=()=>{if(!t)for(t=!0,It--;Ot.length&&It<Ue.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Ot.shift(),{requestParameters:p,callback:f,cancelled:x}=u;x||(u.cancel=Ut(p,f).cancel)}},l=Ee(i,(u,p,f,x)=>{n(),u?e(u):p&&(k.createImageBitmap?function(v,S){const C=new k.Blob([new Uint8Array(v)],{type:"image/png"});k.createImageBitmap(C).then(M=>{S(null,M)}).catch(M=>{S(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,S)=>e(v,S,f,x)):function(v,S){const C=new k.Image,M=k.URL;C.onload=()=>{S(null,C),M.revokeObjectURL(C.src),C.onload=null,k.requestAnimationFrame(()=>{C.src=Rt})},C.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new k.Blob([new Uint8Array(v)],{type:"image/png"});C.src=v.byteLength?M.createObjectURL(L):Rt}(p,(v,S)=>e(v,S,f,x)))});return{cancel:()=>{l.cancel(),n()}}};function Jt(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function Ii(i,e,t){if(t&&t[i]){const n=t[i].indexOf(e);n!==-1&&t[i].splice(n,1)}}class Di{constructor(e,t={}){gt(this,t),this.type=e}}class Ci extends Di{constructor(e,t={}){super("error",gt({error:e},t))}}class kt{on(e,t){return this._listeners=this._listeners||{},Jt(e,t,this._listeners),this}off(e,t){return Ii(e,t,this._listeners),Ii(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(e,t,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,t){typeof e=="string"&&(e=new Di(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const l=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const f of l)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const f of u)Ii(n,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(gt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Ci&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function nn(i,...e){for(const t of e)for(const n in t)i[n]=t[n];return i}function rr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function mo(i){if(Array.isArray(i))return i.map(mo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=mo(i[t]);return e}return rr(i)}class ol extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Sn=ol;class sl{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,l]of t)this.bindings[n]=l}concat(e){return new sl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Wp=sl;const hs={kind:"null"},dt={kind:"number"},ti={kind:"string"},ii={kind:"boolean"},An={kind:"color"},In={kind:"object"},Xt={kind:"value"},na={kind:"collator"},oa={kind:"formatted"},sa={kind:"resolvedImage"};function on(i,e){return{kind:"array",itemType:i,N:e}}function Yi(i){if(i.kind==="array"){const e=Yi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ch=[hs,dt,ti,ii,An,oa,In,on(Xt),sa];function ds(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ds(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of Ch)if(!ds(t,e))return null}}return`Expected ${Yi(i)} but found ${Yi(e)} instead.`}function al(i,e){return e.some(t=>t.kind===i.kind)}function _o(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Ac(i){var e={exports:{}};return i(e,e.exports),e.exports}var go=Ac(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function l(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function u(f){return(x=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:x>1?1:x;var x}function p(f,x,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?f+(x-f)*v*6:2*v<1?x:3*v<2?f+(x-f)*(2/3-v)*6:f}try{e.parseCSSColor=function(f){var x,v=f.replace(/ /g,"").toLowerCase();if(v in t)return t[v].slice();if(v[0]==="#")return v.length===4?(x=parseInt(v.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:v.length===7&&(x=parseInt(v.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var S=v.indexOf("("),C=v.indexOf(")");if(S!==-1&&C+1===v.length){var M=v.substr(0,S),L=v.substr(S+1,C-(S+1)).split(","),R=1;switch(M){case"rgba":if(L.length!==4)return null;R=u(L.pop());case"rgb":return L.length!==3?null:[l(L[0]),l(L[1]),l(L[2]),R];case"hsla":if(L.length!==4)return null;R=u(L.pop());case"hsl":if(L.length!==3)return null;var V=(parseFloat(L[0])%360+360)%360/360,q=u(L[1]),Q=u(L[2]),le=Q<=.5?Q*(q+1):Q+q-Q*q,ie=2*Q-le;return[n(255*p(ie,le,V+1/3)),n(255*p(ie,le,V)),n(255*p(ie,le,V-1/3)),R];default:return null}}return null}}catch{}});class Vr{constructor(e,t,n,l=1){this.r=e,this.g=t,this.b=n,this.a=l}static parse(e){if(!e)return;if(e instanceof Vr)return e;if(typeof e!="string")return;const t=go.parseCSSColor(e);return t?new Vr(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${l})`}toArray(){const{r:e,g:t,b:n,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*t/l,255*n/l,l]}toArray01(){const{r:e,g:t,b:n,a:l}=this;return l===0?[0,0,0,0]:[e/l,t/l,n/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:l}=this;return[e,t,n,l]}}Vr.black=new Vr(0,0,0,1),Vr.white=new Vr(1,1,1,1),Vr.transparent=new Vr(0,0,0,0),Vr.red=new Vr(1,0,0,1),Vr.blue=new Vr(0,0,1,1);var Mi=Vr;class Ic{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(e,t,n,l,u){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=l,this.textColor=u}}class Hr{constructor(e){this.sections=e}static fromString(e){return new Hr([new aa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Hr?e:Hr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class Kr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Kr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Cc(i,e,t,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,t,n]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Mi||i instanceof Ic||i instanceof Hr||i instanceof Kr)return!0;if(Array.isArray(i)){for(const e of i)if(!yo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!yo(i[e]))return!1;return!0}return!1}function cr(i){if(i===null)return hs;if(typeof i=="string")return ti;if(typeof i=="boolean")return ii;if(typeof i=="number")return dt;if(i instanceof Mi)return An;if(i instanceof Ic)return na;if(i instanceof Hr)return oa;if(i instanceof Kr)return sa;if(Array.isArray(i)){const e=i.length;let t;for(const n of i){const l=cr(n);if(t){if(t===l)continue;t=Xt;break}t=l}return on(t||Xt,e)}return In}function la(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Mi||i instanceof Hr||i instanceof Kr?i.toString():JSON.stringify(i)}class Mc{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!yo(e[1]))return t.error("invalid value");const n=e[1];let l=cr(n);const u=t.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Mc(l,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mi?["rgba"].concat(this.value.toArray()):this.value instanceof Hr?this.value.serialize():this.value}}var ca=Mc,xr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const ua={string:ti,number:dt,boolean:ii,object:In};class zc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,l=1;const u=e[0];if(u==="array"){let f,x;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in ua)||v==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);f=ua[v],l++}else f=Xt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}n=on(f,x)}else n=ua[u];const p=[];for(;l<e.length;l++){const f=t.parse(e[l],l,Xt);if(!f)return null;p.push(f)}return new zc(n,p)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!ds(this.type,cr(n)))return n;if(t===this.args.length-1)throw new xr(`Expected value to be of type ${Yi(this.type)}, but found ${Yi(cr(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){t.push(n.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(n=>n.serialize()))}}var dn=zc;class ha{constructor(e){this.type=oa,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const l=[];let u=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let x=null;if(f["font-scale"]&&(x=t.parse(f["font-scale"],1,dt),!x))return null;let v=null;if(f["text-font"]&&(v=t.parse(f["text-font"],1,on(ti)),!v))return null;let S=null;if(f["text-color"]&&(S=t.parse(f["text-color"],1,An),!S))return null;const C=l[l.length-1];C.scale=x,C.font=v,C.textColor=S}else{const x=t.parse(e[p],1,Xt);if(!x)return null;const v=x.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new ha(l)}evaluate(e){return new Hr(this.sections.map(t=>{const n=t.content.evaluate(e);return cr(n)===sa?new aa("",n,null,null,null):new aa(la(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class ll{constructor(e){this.type=sa,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,ti);return n?new ll(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Kr.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Xp={"to-boolean":ii,"to-color":An,"to-number":dt,"to-string":ti};class Pc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const l=Xp[n],u=[];for(let p=1;p<e.length;p++){const f=t.parse(e[p],p,Xt);if(!f)return null;u.push(f)}return new Pc(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,n;for(const l of this.args){if(t=l.evaluate(e),n=null,t instanceof Mi)return t;if(typeof t=="string"){const u=e.parseColor(t);if(u)return u}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Cc(t[0],t[1],t[2],t[3]),!n))return new Mi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new xr(n||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const l=Number(t);if(!isNaN(l))return l}throw new xr(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?Hr.fromString(la(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Kr.fromString(la(this.args[0].evaluate(e))):la(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ha([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ll(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var ps=Pc;const Hp=["Unknown","Point","LineString","Polygon"];var Mh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(n*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Mi.parse(i)),e}};class jo{constructor(e,t,n,l){this.name=e,this.type=t,this._evaluate=n,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],l=jo.definitions[n];if(!l)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let x=null;for(const[v,S]of f){x=new Vo(t.registry,t.path,null,t.scope);const C=[];let M=!1;for(let L=1;L<e.length;L++){const R=e[L],V=Array.isArray(v)?v[L-1]:v.type,q=x.parse(R,1+C.length,V);if(!q){M=!0;break}C.push(q)}if(!M)if(Array.isArray(v)&&v.length!==C.length)x.error(`Expected ${v.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const R=Array.isArray(v)?v[L]:v.type,V=C[L];x.concat(L+1).checkSubtype(R,V.type)}if(x.errors.length===0)return new jo(n,u,S,C)}}if(f.length===1)t.errors.push(...x.errors);else{const v=(f.length?f:p).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Yi).join(", ")})`:`(${Yi(M.type)}...)`;var M}).join(" | "),S=[];for(let C=1;C<e.length;C++){const M=t.parse(e[C],1+S.length);if(!M)return null;S.push(Yi(M.type))}t.error(`Expected arguments of type ${v}, but found (${S.join(", ")}) instead.`)}return null}static register(e,t){jo.definitions=t;for(const n in t)e[n]=jo}}var Cn=jo;class cl{constructor(e,t,n){this.type=na,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const l=t.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,ii);if(!l)return null;const u=t.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,ii);if(!u)return null;let p=null;return n.locale&&(p=t.parse(n.locale,1,ti),!p)?null:new cl(l,u,p)}evaluate(e){return new Ic(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const xo=8192;function kc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ul(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Kp(i,e){const t=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(t*l*xo),Math.round(n*l*xo)]}function Yp(i,e,t){const n=i[0]-e[0],l=i[1]-e[1],u=i[0]-t[0],p=i[1]-t[1];return n*p-u*l==0&&n*u<=0&&l*p<=0}function hl(i,e){let t=!1;for(let p=0,f=e.length;p<f;p++){const x=e[p];for(let v=0,S=x.length;v<S-1;v++){if(Yp(i,x[v],x[v+1]))return!1;(l=x[v])[1]>(n=i)[1]!=(u=x[v+1])[1]>n[1]&&n[0]<(u[0]-l[0])*(n[1]-l[1])/(u[1]-l[1])+l[0]&&(t=!t)}}var n,l,u;return t}function dl(i,e){for(let t=0;t<e.length;t++)if(hl(i,e[t]))return!0;return!1}function zh(i,e,t,n){const l=n[0]-t[0],u=n[1]-t[1],p=(i[0]-t[0])*u-l*(i[1]-t[1]),f=(e[0]-t[0])*u-l*(e[1]-t[1]);return p>0&&f<0||p<0&&f>0}function Jp(i,e,t){for(const v of t)for(let S=0;S<v.length-1;++S)if((f=[(p=v[S+1])[0]-(u=v[S])[0],p[1]-u[1]])[0]*(x=[(l=e)[0]-(n=i)[0],l[1]-n[1]])[1]-f[1]*x[0]!=0&&zh(n,l,u,p)&&zh(u,p,n,l))return!0;var n,l,u,p,f,x;return!1}function Ph(i,e){for(let t=0;t<i.length;++t)if(!hl(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(Jp(i[t],i[t+1],e))return!1;return!0}function Qp(i,e){for(let t=0;t<e.length;t++)if(Ph(i,e[t]))return!0;return!1}function pn(i,e,t){const n=[];for(let l=0;l<i.length;l++){const u=[];for(let p=0;p<i[l].length;p++){const f=Kp(i[l][p],t);kc(e,f),u.push(f)}n.push(u)}return n}function Dc(i,e,t){const n=[];for(let l=0;l<i.length;l++){const u=pn(i[l],e,t);n.push(u)}return n}function Lc(i,e,t,n){if(i[0]<t[0]||i[0]>t[2]){const l=.5*n;let u=i[0]-t[0]>l?-n:t[0]-i[0]>l?n:0;u===0&&(u=i[0]-t[2]>l?-n:t[2]-i[0]>l?n:0),i[0]+=u}kc(e,i)}function Rc(i,e,t,n){const l=Math.pow(2,n.z)*xo,u=[n.x*xo,n.y*xo],p=[];if(!i)return p;for(const f of i)for(const x of f){const v=[x.x+u[0],x.y+u[1]];Lc(v,e,t,l),p.push(v)}return p}function Bc(i,e,t,n){const l=Math.pow(2,n.z)*xo,u=[n.x*xo,n.y*xo],p=[];if(!i)return p;for(const x of i){const v=[];for(const S of x){const C=[S.x+u[0],S.y+u[1]];kc(e,C),v.push(C)}p.push(v)}if(e[2]-e[0]<=l/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const x of p)for(const v of x)Lc(v,e,t,l)}var f;return p}class fs{constructor(e,t){this.type=ii,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(yo(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let l=0;l<n.features.length;++l){const u=n.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new fs(n,n.features[l].geometry)}else if(n.type==="Feature"){const l=n.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new fs(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new fs(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=t.canonicalID();if(!p)return!1;if(n.type==="Polygon"){const f=pn(n.coordinates,u,p),x=Rc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!hl(v,f))return!1}if(n.type==="MultiPolygon"){const f=Dc(n.coordinates,u,p),x=Rc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!dl(v,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=t.canonicalID();if(!p)return!1;if(n.type==="Polygon"){const f=pn(n.coordinates,u,p),x=Bc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!Ph(v,f))return!1}if(n.type==="MultiPolygon"){const f=Dc(n.coordinates,u,p),x=Bc(t.geometry(),l,u,p);if(!ul(l,u))return!1;for(const v of x)if(!Qp(v,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var pl=fs;function No(i){if(i instanceof Cn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof pl)return!1;let e=!0;return i.eachChild(t=>{e&&!No(t)&&(e=!1)}),e}function vo(i){if(i instanceof Cn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!vo(t)&&(e=!1)}),e}function da(i,e){if(i instanceof Cn&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(n=>{t&&!da(n,e)&&(t=!1)}),t}class fl{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new fl(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ml=fl;class _l{constructor(e,t=[],n,l=new Wp,u=[]){this.registry=e,this.path=t,this.key=t.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=u,this.expectedType=n}parse(e,t,n,l,u={}){return t?this.concat(t,n,l)._parse(e,u):this._parse(e,u)}_parse(e,t){function n(l,u,p){return p==="assert"?new dn(u,[l]):p==="coerce"?new ps(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,x=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||x.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(f,x))return null}else p=n(p,f,t.typeAnnotation||"coerce");else p=n(p,f,t.typeAnnotation||"assert")}if(!(p instanceof ca)&&p.type.kind!=="resolvedImage"&&xi(p)){const f=new Mh;try{p=new ca(p.type,p.evaluate(f))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const l=typeof e=="number"?this.path.concat(e):this.path,u=n?this.scope.concat(n):this.scope;return new _l(this.registry,l,t||null,u,this.errors)}error(e,...t){const n=`${this.key}${t.map(l=>`[${l}]`).join("")}`;this.errors.push(new Sn(n,e))}checkSubtype(e,t){const n=ds(e,t);return n&&this.error(n),n}}var Vo=_l;function xi(i){if(i instanceof ml)return xi(i.boundExpression);if(i instanceof Cn&&i.name==="error"||i instanceof cl||i instanceof pl)return!1;const e=i instanceof ps||i instanceof dn;let t=!0;return i.eachChild(n=>{t=e?t&&xi(n):t&&n instanceof ca}),!!t&&No(i)&&da(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function gl(i,e){const t=i.length-1;let n,l,u=0,p=t,f=0;for(;u<=p;)if(f=Math.floor((u+p)/2),n=i[f],l=i[f+1],n<=e){if(f===t||e<l)return f;u=f+1}else{if(!(n>e))throw new xr("Input is not a number.");p=f-1}return 0}class Oc{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[l,u]of n)this.labels.push(l),this.outputs.push(u)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,dt);if(!n)return null;const l=[];let u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],x=e[p+1],v=p,S=p+1;if(typeof f!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=f)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const C=t.parse(x,S,u);if(!C)return null;u=u||C.type,l.push([f,C])}return new Oc(u,n,l)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return n[0].evaluate(e);const u=t.length;return l>=t[u-1]?n[u-1].evaluate(e):n[gl(t,l)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Fc=Oc;function mi(i,e,t){return i*(1-t)+e*t}function ms(i,e,t){return i.map((n,l)=>mi(n,e[l],t))}var pa=Object.freeze({__proto__:null,number:mi,color:function(i,e,t){return new Mi(mi(i.r,e.r,t),mi(i.g,e.g,t),mi(i.b,e.b,t),mi(i.a,e.a,t))},array:ms});const Uc=.95047,jc=1.08883,Nc=4/29,bo=6/29,fa=3*bo*bo,ef=Math.PI/180,Vc=180/Math.PI;function yl(i){return i>.008856451679035631?Math.pow(i,1/3):i/fa+Nc}function $c(i){return i>bo?i*i*i:fa*(i-Nc)}function Gc(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function xl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function kh(i){const e=xl(i.r),t=xl(i.g),n=xl(i.b),l=yl((.4124564*e+.3575761*t+.1804375*n)/Uc),u=yl((.2126729*e+.7151522*t+.072175*n)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-yl((.0193339*e+.119192*t+.9503041*n)/jc)),alpha:i.a}}function qc(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*$c(e),t=Uc*$c(t),n=jc*$c(n),new Mi(Gc(3.2404542*t-1.5371385*e-.4985314*n),Gc(-.969266*t+1.8760108*e+.041556*n),Gc(.0556434*t-.2040259*e+1.0572252*n),i.alpha)}function Dh(i,e,t){const n=e-i;return i+t*(n>180||n<-180?n-360*Math.round(n/360):n)}const ma={forward:kh,reverse:qc,interpolate:function(i,e,t){return{l:mi(i.l,e.l,t),a:mi(i.a,e.a,t),b:mi(i.b,e.b,t),alpha:mi(i.alpha,e.alpha,t)}}},_s={forward:function(i){const{l:e,a:t,b:n}=kh(i),l=Math.atan2(n,t)*Vc;return{h:l<0?l+360:l,c:Math.sqrt(t*t+n*n),l:e,alpha:i.a}},reverse:function(i){const e=i.h*ef,t=i.c;return qc({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:Dh(i.h,e.h,t),c:mi(i.c,e.c,t),l:mi(i.l,e.l,t),alpha:mi(i.alpha,e.alpha,t)}}};var Lh=Object.freeze({__proto__:null,lab:ma,hcl:_s});class _a{constructor(e,t,n,l,u){this.type=e,this.operator=t,this.interpolation=n,this.input=l,this.labels=[],this.outputs=[];for(const[p,f]of u)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,t,n,l){let u=0;if(e.name==="exponential")u=vl(t,e.base,n,l);else if(e.name==="linear")u=vl(t,1,n,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new j(p[0],p[1],p[2],p[3]).solve(vl(t,1,n,l))}return u}static parse(e,t){let[n,l,u,...p]=e;if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some(S=>typeof S!="number"||S<0||S>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(u=t.parse(u,2,dt),!u)return null;const f=[];let x=null;n==="interpolate-hcl"||n==="interpolate-lab"?x=An:t.expectedType&&t.expectedType.kind!=="value"&&(x=t.expectedType);for(let v=0;v<p.length;v+=2){const S=p[v],C=p[v+1],M=v+3,L=v+4;if(typeof S!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=S)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const R=t.parse(C,L,x);if(!R)return null;x=x||R.type,f.push([S,R])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new _a(x,n,l,u,f):t.error(`Type ${Yi(x)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return n[0].evaluate(e);const u=t.length;if(l>=t[u-1])return n[u-1].evaluate(e);const p=gl(t,l),f=_a.interpolationFactor(this.interpolation,l,t[p],t[p+1]),x=n[p].evaluate(e),v=n[p+1].evaluate(e);return this.operator==="interpolate"?pa[this.type.kind.toLowerCase()](x,v,f):this.operator==="interpolate-hcl"?_s.reverse(_s.interpolate(_s.forward(x),_s.forward(v),f)):ma.reverse(ma.interpolate(ma.forward(x),ma.forward(v),f))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function vl(i,e,t,n){const l=n-t,u=i-t;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var jn=_a;class Zc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const l=t.expectedType;l&&l.kind!=="value"&&(n=l);const u=[];for(const f of e.slice(1)){const x=t.parse(f,1+u.length,n,void 0,{typeAnnotation:"omit"});if(!x)return null;n=n||x.type,u.push(x)}const p=l&&u.some(f=>ds(l,f.type));return new Zc(p?Xt:n,u)}evaluate(e){let t,n=null,l=0;for(const u of this.args){if(l++,n=u.evaluate(e),n&&n instanceof Kr&&!n.available&&(t||(t=n),n=null,l===this.args.length))return t;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Rh=Zc;class Wc{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return t.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return t.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=t.parse(e[u+1],u+1);if(!f)return null;n.push([p,f])}const l=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return l?new Wc(n,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var Bh=Wc;class Xc{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,dt),l=t.parse(e[2],2,on(t.expectedType||Xt));return n&&l?new Xc(l.type.itemType,n,l):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new xr(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new xr(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new xr(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Oh=Xc;class Hc{constructor(e,t){this.type=ii,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Xt),l=t.parse(e[2],2,Xt);return n&&l?al(n.type,[ii,ti,dt,hs,Xt])?new Hc(n,l):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!_o(t,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(cr(t))} instead.`);if(!_o(n,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Yi(cr(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var tf=Hc;class bl{constructor(e,t,n){this.type=dt,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Xt),l=t.parse(e[2],2,Xt);if(!n||!l)return null;if(!al(n.type,[ii,ti,dt,hs,Xt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(n.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,dt);return u?new bl(n,l,u):null}return new bl(n,l)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!_o(t,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Yi(cr(t))} instead.`);if(!_o(n,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Yi(cr(n))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return n.indexOf(t,l)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var rf=bl;class wl{constructor(e,t,n,l,u,p){this.inputType=e,this.type=t,this.input=n,this.cases=l,this.outputs=u,this.otherwise=p}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);const u={},p=[];for(let v=2;v<e.length-1;v+=2){let S=e[v];const C=e[v+1];Array.isArray(S)||(S=[S]);const M=t.concat(v);if(S.length===0)return M.error("Expected at least one branch label.");for(const R of S){if(typeof R!="number"&&typeof R!="string")return M.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return M.error("Numeric branch labels must be integer values.");if(n){if(M.checkSubtype(n,cr(R)))return null}else n=cr(R);if(u[String(R)]!==void 0)return M.error("Branch labels must be unique.");u[String(R)]=p.length}const L=t.parse(C,v,l);if(!L)return null;l=l||L.type,p.push(L)}const f=t.parse(e[1],1,Xt);if(!f)return null;const x=t.parse(e[e.length-1],e.length-1,l);return x?f.type.kind!=="value"&&t.concat(1).checkSubtype(n,f.type)?null:new wl(n,l,f,u,p,x):null}evaluate(e){const t=this.input.evaluate(e);return(cr(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],l={};for(const p of t){const f=l[this.cases[p]];f===void 0?(l[this.cases[p]]=n.length,n.push([this.cases[p],[p]])):n[f][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,f]of n)e.push(f.length===1?u(f[0]):f.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Fh=wl;class Tl{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const f=t.parse(e[p],p,ii);if(!f)return null;const x=t.parse(e[p+1],p+1,n);if(!x)return null;l.push([f,x]),n=n||x.type}const u=t.parse(e[e.length-1],e.length-1,n);return u?new Tl(n,l,u):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var nf=Tl;class El{constructor(e,t,n,l){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=l}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Xt),l=t.parse(e[2],2,dt);if(!n||!l)return null;if(!al(n.type,[on(Xt),ti,Xt]))return t.error(`Expected first argument to be of type array or string, but found ${Yi(n.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,dt);return u?new El(n.type,n,l,u):null}return new El(n.type,n,l)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!_o(t,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${Yi(cr(t))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return t.slice(n,l)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Uh=El;function Kc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Yc(i,e,t,n){return n.compare(e,t)===0}function gs(i,e,t){const n=i!=="=="&&i!=="!=";return class F1{constructor(u,p,f){this.type=ii,this.lhs=u,this.rhs=p,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const f=u[0];let x=p.parse(u[1],1,Xt);if(!x)return null;if(!Kc(f,x.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${Yi(x.type)}'.`);let v=p.parse(u[2],2,Xt);if(!v)return null;if(!Kc(f,v.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${Yi(v.type)}'.`);if(x.type.kind!==v.type.kind&&x.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${Yi(x.type)}' and '${Yi(v.type)}'.`);n&&(x.type.kind==="value"&&v.type.kind!=="value"?x=new dn(v.type,[x]):x.type.kind!=="value"&&v.type.kind==="value"&&(v=new dn(x.type,[v])));let S=null;if(u.length===4){if(x.type.kind!=="string"&&v.type.kind!=="string"&&x.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(S=p.parse(u[3],3,na),!S)return null}return new F1(x,v,S)}evaluate(u){const p=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(n&&this.hasUntypedArgument){const x=cr(p),v=cr(f);if(x.kind!==v.kind||x.kind!=="string"&&x.kind!=="number")throw new xr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${v.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const x=cr(p),v=cr(f);if(x.kind!=="string"||v.kind!=="string")return e(u,p,f)}return this.collator?t(u,p,f,this.collator.evaluate(u)):e(u,p,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const of=gs("==",function(i,e,t){return e===t},Yc),sf=gs("!=",function(i,e,t){return e!==t},function(i,e,t,n){return!Yc(0,e,t,n)}),af=gs("<",function(i,e,t){return e<t},function(i,e,t,n){return n.compare(e,t)<0}),Sl=gs(">",function(i,e,t){return e>t},function(i,e,t,n){return n.compare(e,t)>0}),jh=gs("<=",function(i,e,t){return e<=t},function(i,e,t,n){return n.compare(e,t)<=0}),Nh=gs(">=",function(i,e,t){return e>=t},function(i,e,t,n){return n.compare(e,t)>=0});class Jc{constructor(e,t,n,l,u,p){this.type=ti,this.number=e,this.locale=t,this.currency=n,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,dt);if(!n)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=t.parse(l.locale,1,ti),!u))return null;let p=null;if(l.currency&&(p=t.parse(l.currency,1,ti),!p))return null;let f=null;if(l.unit&&(f=t.parse(l.unit,1,ti),!f))return null;let x=null;if(l["min-fraction-digits"]&&(x=t.parse(l["min-fraction-digits"],1,dt),!x))return null;let v=null;return l["max-fraction-digits"]&&(v=t.parse(l["max-fraction-digits"],1,dt),!v)?null:new Jc(n,u,p,f,x,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Qc{constructor(e){this.type=dt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Yi(n.type)} instead.`):new Qc(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new xr(`Expected value to be of type string or array, but found ${Yi(cr(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Vh={"==":of,"!=":sf,">":Sl,"<":af,">=":Nh,"<=":jh,array:dn,at:Oh,boolean:dn,case:nf,coalesce:Rh,collator:cl,format:ha,image:ll,in:tf,"index-of":rf,interpolate:jn,"interpolate-hcl":jn,"interpolate-lab":jn,length:Qc,let:Bh,literal:ca,match:Fh,number:dn,"number-format":Jc,object:dn,slice:Uh,step:Fc,string:dn,"to-boolean":ps,"to-color":ps,"to-number":ps,"to-string":ps,var:ml,within:pl};function eu(i,[e,t,n,l]){e=e.evaluate(i),t=t.evaluate(i),n=n.evaluate(i);const u=l?l.evaluate(i):1,p=Cc(e,t,n,u);if(p)throw new xr(p);return new Mi(e/255*u,t/255*u,n/255*u,u)}function tu(i,e){return i in e}function Al(i,e){const t=e[i];return t===void 0?null:t}function Kn(i){return{type:i}}Cn.register(Vh,{error:[{kind:"error"},[ti],(i,[e])=>{throw new xr(e.evaluate(i))}],typeof:[ti,[Xt],(i,[e])=>Yi(cr(e.evaluate(i)))],"to-rgba":[on(dt,4),[An],(i,[e])=>e.evaluate(i).toArray()],rgb:[An,[dt,dt,dt],eu],rgba:[An,[dt,dt,dt,dt],eu],has:{type:ii,overloads:[[[ti],(i,[e])=>tu(e.evaluate(i),i.properties())],[[ti,In],(i,[e,t])=>tu(e.evaluate(i),t.evaluate(i))]]},get:{type:Xt,overloads:[[[ti],(i,[e])=>Al(e.evaluate(i),i.properties())],[[ti,In],(i,[e,t])=>Al(e.evaluate(i),t.evaluate(i))]]},"feature-state":[Xt,[ti],(i,[e])=>Al(e.evaluate(i),i.featureState||{})],properties:[In,[],i=>i.properties()],"geometry-type":[ti,[],i=>i.geometryType()],id:[Xt,[],i=>i.id()],zoom:[dt,[],i=>i.globals.zoom],pitch:[dt,[],i=>i.globals.pitch||0],"distance-from-center":[dt,[],i=>i.distanceFromCenter()],"heatmap-density":[dt,[],i=>i.globals.heatmapDensity||0],"line-progress":[dt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[dt,[],i=>i.globals.skyRadialProgress||0],accumulated:[Xt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[dt,Kn(dt),(i,e)=>{let t=0;for(const n of e)t+=n.evaluate(i);return t}],"*":[dt,Kn(dt),(i,e)=>{let t=1;for(const n of e)t*=n.evaluate(i);return t}],"-":{type:dt,overloads:[[[dt,dt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[dt],(i,[e])=>-e.evaluate(i)]]},"/":[dt,[dt,dt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[dt,[dt,dt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[dt,[dt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[dt,[dt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[dt,[dt],(i,[e])=>Math.log(e.evaluate(i))],log2:[dt,[dt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[dt,[dt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[dt,[dt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[dt,[dt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[dt,[dt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[dt,[dt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[dt,[dt],(i,[e])=>Math.atan(e.evaluate(i))],min:[dt,Kn(dt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[dt,Kn(dt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[dt,[dt],(i,[e])=>Math.abs(e.evaluate(i))],round:[dt,[dt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[dt,[dt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[dt,[dt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ii,[ti,Xt],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[ii,[Xt],(i,[e])=>i.id()===e.value],"filter-type-==":[ii,[ti],(i,[e])=>i.geometryType()===e.value],"filter-<":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n<l}],"filter-id-<":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n>l}],"filter-id->":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n<=l}],"filter-id-<=":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[ii,[ti,Xt],(i,[e,t])=>{const n=i.properties()[e.value],l=t.value;return typeof n==typeof l&&n>=l}],"filter-id->=":[ii,[Xt],(i,[e])=>{const t=i.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[ii,[Xt],(i,[e])=>e.value in i.properties()],"filter-has-id":[ii,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ii,[on(ti)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ii,[on(Xt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ii,[ti,on(Xt)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ii,[ti,on(Xt)],(i,[e,t])=>function(n,l,u,p){for(;u<=p;){const f=u+p>>1;if(l[f]===n)return!0;l[f]>n?p=f-1:u=f+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[Kn(ii),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[Kn(ii),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[ii,[ii],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ii,[ti],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[ti,[ti],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ti,[ti],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ti,Kn(Xt),(i,e)=>e.map(t=>la(t.evaluate(i))).join("")],"resolved-locale":[ti,[na],(i,[e])=>e.evaluate(i).resolvedLocale()]});var ga=Vh;function $h(i){return{result:"success",value:i}}function ys(i){return{result:"error",value:i}}function xs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Gh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function iu(i){return!!i.expression&&i.expression.interpolated}function wi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ya(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function qh(i){return i}function xa(i,e){const t=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),u=i.type||(iu(e)?"exponential":"interval");if(t&&((i=nn({},i)).stops&&(i.stops=i.stops.map(v=>[v[0],Mi.parse(v[1])])),i.default=Mi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Lh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,f,x;if(u==="exponential")p=ru;else if(u==="interval")p=wo;else if(u==="categorical"){p=lf,f=Object.create(null);for(const v of i.stops)f[v[0]]=v[1];x=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=vs}if(n){const v={},S=[];for(let L=0;L<i.stops.length;L++){const R=i.stops[L],V=R[0].zoom;v[V]===void 0&&(v[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},S.push(V)),v[V].stops.push([R[0].value,R[1]])}const C=[];for(const L of S)C.push([v[L].zoom,xa(v[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:jn.interpolationFactor.bind(void 0,M),zoomStops:C.map(L=>L[0]),evaluate:({zoom:L},R)=>ru({stops:C,base:i.base},e,L).evaluate(L,R)}}if(l){const v=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:jn.interpolationFactor.bind(void 0,v),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>p(i,e,S,f,x)}}return{kind:"source",evaluate(v,S){const C=S&&S.properties?S.properties[i.property]:void 0;return C===void 0?va(i.default,e.default):p(i,e,C,f,x)}}}function va(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function lf(i,e,t,n,l){return va(typeof t===l?n[t]:void 0,i.default,e.default)}function wo(i,e,t){if(wi(t)!=="number")return va(i.default,e.default);const n=i.stops.length;if(n===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[n-1][0])return i.stops[n-1][1];const l=gl(i.stops.map(u=>u[0]),t);return i.stops[l][1]}function ru(i,e,t){const n=i.base!==void 0?i.base:1;if(wi(t)!=="number")return va(i.default,e.default);const l=i.stops.length;if(l===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[l-1][0])return i.stops[l-1][1];const u=gl(i.stops.map(S=>S[0]),t),p=function(S,C,M,L){const R=L-M,V=S-M;return R===0?0:C===1?V/R:(Math.pow(C,V)-1)/(Math.pow(C,R)-1)}(t,n,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],x=i.stops[u+1][1];let v=pa[e.type]||qh;if(i.colorSpace&&i.colorSpace!=="rgb"){const S=Lh[i.colorSpace];v=(C,M)=>S.reverse(S.interpolate(S.forward(C),S.forward(M),p))}return typeof f.evaluate=="function"?{evaluate(...S){const C=f.evaluate.apply(void 0,S),M=x.evaluate.apply(void 0,S);if(C!==void 0&&M!==void 0)return v(C,M,p)}}:v(f,x,p)}function vs(i,e,t){return e.type==="color"?t=Mi.parse(t):e.type==="formatted"?t=Hr.fromString(t.toString()):e.type==="resolvedImage"?t=Kr.fromString(t.toString()):wi(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),va(t,i.default,e.default)}class nu{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Mh,this._defaultValue=t?function(n){return n.type==="color"&&(ya(n.default)||Array.isArray(n.default))?new Mi(0,0,0,0):n.type==="color"?Mi.parse(n.default)||null:n.default===void 0?null:n.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,l,u,p,f,x){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,l,u,p,f,x){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=x||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console!="undefined"&&console.warn(v.message)),this._defaultValue}}}function Il(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ga}function bs(i,e){const t=new Vo(ga,[],e?function(l){const u={color:An,string:ti,number:dt,enum:ti,boolean:ii,formatted:oa,resolvedImage:sa};return l.type==="array"?on(u[l.value]||Xt,l.length):u[l.type]}(e):void 0),n=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?$h(new nu(n,e)):ys(t.errors)}class ou{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!vo(t.expression)}evaluateWithoutErrorHandling(e,t,n,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,l,u,p)}evaluate(e,t,n,l,u,p){return this._styleExpression.evaluate(e,t,n,l,u,p)}}class ba{constructor(e,t,n,l){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!vo(t.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,t,n,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,l,u,p)}evaluate(e,t,n,l,u,p){return this._styleExpression.evaluate(e,t,n,l,u,p)}interpolationFactor(e,t,n){return this.interpolationType?jn.interpolationFactor(this.interpolationType,e,t,n):0}}function su(i,e){if((i=bs(i,e)).result==="error")return i;const t=i.value.expression,n=No(t);if(!n&&!xs(e))return ys([new Sn("","data expressions not supported")]);const l=da(t,["zoom","pitch","distance-from-center"]);if(!l&&!Gh(e))return ys([new Sn("","zoom expressions not supported")]);const u=Ts(t);return u||l?u instanceof Sn?ys([u]):u instanceof jn&&!iu(e)?ys([new Sn("",'"interpolate" expressions cannot be used with this property')]):$h(u?new ba(n?"camera":"composite",i.value,u.labels,u instanceof jn?u.interpolation:void 0):new ou(n?"constant":"source",i.value)):ys([new Sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ws{constructor(e,t){this._parameters=e,this._specification=t,nn(this,xa(this._parameters,this._specification))}static deserialize(e){return new ws(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ts(i){let e=null;if(i instanceof Bh)e=Ts(i.result);else if(i instanceof Rh){for(const t of i.args)if(e=Ts(t),e)break}else(i instanceof Fc||i instanceof jn)&&i.input instanceof Cn&&i.input.name==="zoom"&&(e=i);return e instanceof Sn||i.eachChild(t=>{const n=Ts(t);n instanceof Sn?e=n:!e&&n?e=new Sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Sn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class pt{constructor(e,t,n,l){this.message=(e?`${e}: `:"")+n,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)}}function sn(i){const e=i.key,t=i.value,n=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,p=i.styleSpec;let f=[];const x=wi(t);if(x!=="object")return[new pt(e,t,`object expected, ${x} found`)];for(const v in t){const S=v.split(".")[0],C=n[S]||n["*"];let M;l[S]?M=l[S]:n[S]?M=Sr:l["*"]?M=l["*"]:n["*"]&&(M=Sr),M?f=f.concat(M({key:(e&&`${e}.`)+v,value:t[v],valueSpec:C,style:u,styleSpec:p,object:t,objectKey:v},t)):f.push(new pt(e,t[v],`unknown property "${v}"`))}for(const v in n)l[v]||n[v].required&&n[v].default===void 0&&t[v]===void 0&&f.push(new pt(e,t,`missing required property "${v}"`));return f}function au(i){const e=i.value,t=i.valueSpec,n=i.style,l=i.styleSpec,u=i.key,p=i.arrayElementValidator||Sr;if(wi(e)!=="array")return[new pt(u,e,`array expected, ${wi(e)} found`)];if(t.length&&e.length!==t.length)return[new pt(u,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new pt(u,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let f={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};l.$version<7&&(f.function=t.function),wi(t.value)==="object"&&(f=t.value);let x=[];for(let v=0;v<e.length;v++)x=x.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:f,style:n,styleSpec:l,key:`${u}[${v}]`}));return x}function lu(i){const e=i.key,t=i.value,n=i.valueSpec;let l=wi(t);if(l==="number"&&t!=t&&(l="NaN"),l!=="number")return[new pt(e,t,`number expected, ${l} found`)];if("minimum"in n){let u=n.minimum;if(wi(n.minimum)==="array"&&(u=n.minimum[i.arrayIndex]),t<u)return[new pt(e,t,`${t} is less than the minimum value ${u}`)]}if("maximum"in n){let u=n.maximum;if(wi(n.maximum)==="array"&&(u=n.maximum[i.arrayIndex]),t>u)return[new pt(e,t,`${t} is greater than the maximum value ${u}`)]}return[]}function wa(i){const e=i.valueSpec,t=rr(i.value.type);let n,l,u,p={};const f=t!=="categorical"&&i.value.property===void 0,x=!f,v=wi(i.value.stops)==="array"&&wi(i.value.stops[0])==="array"&&wi(i.value.stops[0][0])==="object",S=sn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(L){if(t==="identity")return[new pt(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const V=L.value;return R=R.concat(au({key:L.key,value:V,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:C})),wi(V)==="array"&&V.length===0&&R.push(new pt(L.key,V,"array must have at least one stop")),R},default:function(L){return Sr({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return t==="identity"&&f&&S.push(new pt(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||S.push(new pt(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!iu(i.valueSpec)&&S.push(new pt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!xs(i.valueSpec)?S.push(new pt(i.key,i.value,"property functions not supported")):f&&!Gh(i.valueSpec)&&S.push(new pt(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!v||i.value.property!==void 0||S.push(new pt(i.key,i.value,'"property" property is required')),S;function C(L){let R=[];const V=L.value,q=L.key;if(wi(V)!=="array")return[new pt(q,V,`array expected, ${wi(V)} found`)];if(V.length!==2)return[new pt(q,V,`array length 2 expected, length ${V.length} found`)];if(v){if(wi(V[0])!=="object")return[new pt(q,V,`object expected, ${wi(V[0])} found`)];if(V[0].zoom===void 0)return[new pt(q,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new pt(q,V,"object stop key must have value")];const Q=rr(V[0].zoom);if(typeof Q!="number")return[new pt(q,V[0].zoom,"stop zoom values must be numbers")];if(u&&u>Q)return[new pt(q,V[0].zoom,"stop zoom values must appear in ascending order")];Q!==u&&(u=Q,l=void 0,p={}),R=R.concat(sn({key:`${q}[0]`,value:V[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:lu,value:M}}))}else R=R.concat(M({key:`${q}[0]`,value:V[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},V));return Il(mo(V[1]))?R.concat([new pt(`${q}[1]`,V[1],"expressions are not allowed in function stops.")]):R.concat(Sr({key:`${q}[1]`,value:V[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function M(L,R){const V=wi(L.value),q=rr(L.value),Q=L.value!==null?L.value:R;if(n){if(V!==n)return[new pt(L.key,Q,`${V} stop domain type must match previous stop domain type ${n}`)]}else n=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new pt(L.key,Q,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&t!=="categorical"){let le=`number expected, ${V} found`;return xs(e)&&t===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(L.key,Q,le)]}return t!=="categorical"||V!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?t!=="categorical"&&V==="number"&&typeof q=="number"&&typeof l=="number"&&l!==void 0&&q<l?[new pt(L.key,Q,"stop domain values must appear in ascending order")]:(l=q,t==="categorical"&&q in p?[new pt(L.key,Q,"stop domain values must be unique")]:(p[q]=!0,[])):[new pt(L.key,Q,`integer expected, found ${String(q)}`)]}}function Mn(i){const e=(i.expressionContext==="property"?su:bs)(mo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new pt(`${i.key}${n.key}`,i.value,n.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new pt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!vo(t))return[new pt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return cu(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!da(t,["zoom","feature-state"]))return[new pt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!No(t))return[new pt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cu(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)t.delete(l);if(t.size===0)return[];const n=[];return i instanceof Cn&&t.has(i.name)?[new pt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{n.push(...cu(l,e))}),n)}function Ta(i){const e=i.key,t=i.value,n=i.valueSpec,l=[];return Array.isArray(n.values)?n.values.indexOf(rr(t))===-1&&l.push(new pt(e,t,`expected one of [${n.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(n.values).indexOf(rr(t))===-1&&l.push(new pt(e,t,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(t)} found`)),l}function Ea(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ea(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Sa(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ea(i)||(i=Cl(i));const t=i;let n=!0;try{n=function(v){if(!Yn(v))return v;let S=mo(v);return uu(S),S=Zh(S),S}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const l=ke[`filter_${e}`],u=bs(n,l);let p=null;if(u.result==="error")throw new Error(u.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,S,C)=>u.value.evaluate(v,S,{},C);let f=null,x=null;if(n!==t){const v=bs(t,l);if(v.result==="error")throw new Error(v.value.map(S=>`${S.key}: ${S.message}`).join(", "));f=(S,C,M,L,R)=>v.value.evaluate(S,C,{},M,void 0,void 0,L,R),x=!No(v.value.expression)}return p=p,{filter:p,dynamicFilter:f||void 0,needGeometry:Wh(n),needFeature:!!x}}function Zh(i){if(!Array.isArray(i))return i;const e=function(t){if(cf.has(t[0])){for(let n=1;n<t.length;n++)if(Yn(t[n]))return!0}return t}(i);return e===!0?e:e.map(t=>Zh(t))}function uu(i){let e=!1;const t=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||Yn(i[n]),t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||Yn(i[1]);for(let n=2;n<i.length-1;n+=2)t.push(i[n+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||Yn(i[1]);for(let n=1;n<i.length-1;n+=2)t.push(i[n+1])}e&&(i.length=0,i.push("any",...t));for(let n=1;n<i.length;n++)uu(i[n])}function Yn(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(Yn(i[t]))return!0;return!1}const cf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uf(i,e){return i<e?-1:i>e?1:0}function Wh(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Wh(i[e]))return!0;return!1}function Cl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?hu(i[1],i[2],"=="):e==="!="?Dr(hu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?hu(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(Cl))):e==="all"?["all"].concat(i.slice(1).map(Cl)):e==="none"?["all"].concat(i.slice(1).map(Cl).map(Dr)):e==="in"?Aa(i[1],i.slice(2)):e==="!in"?Dr(Aa(i[1],i.slice(2))):e==="has"?Ia(i[1]):e==="!has"?Dr(Ia(i[1])):e!=="within"||i;var t}function hu(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function Aa(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(uf)]]:["filter-in-small",i,["literal",e]]}}function Ia(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Dr(i){return["!",i]}function Es(i){return Ea(mo(i.value))?Mn(nn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Xh(i)}function Xh(i){const e=i.value,t=i.key;if(wi(e)!=="array")return[new pt(t,e,`array expected, ${wi(e)} found`)];const n=i.styleSpec;let l,u=[];if(e.length<1)return[new pt(t,e,"filter array must have at least 1 element")];switch(u=u.concat(Ta({key:`${t}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),rr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&rr(e[1])==="$type"&&u.push(new pt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new pt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=wi(e[1]),l!=="string"&&u.push(new pt(`${t}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=wi(e[p]),rr(e[1])==="$type"?u=u.concat(Ta({key:`${t}[${p}]`,value:e[p],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new pt(`${t}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(Xh({key:`${t}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=wi(e[1]),e.length!==2?u.push(new pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new pt(`${t}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=wi(e[1]),e.length!==2?u.push(new pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new pt(`${t}[1]`,e[1],`object expected, ${l} found`))}return u}function Hh(i,e){const t=i.key,n=i.style,l=i.styleSpec,u=i.value,p=i.objectKey,f=l[`${e}_${i.layerType}`];if(!f)return[];const x=p.match(/^(.*)-transition$/);if(e==="paint"&&x&&f[x[1]]&&f[x[1]].transition)return Sr({key:t,value:u,valueSpec:l.transition,style:n,styleSpec:l});const v=i.valueSpec||f[p];if(!v)return[new pt(t,u,`unknown property "${p}"`)];let S;if(wi(u)==="string"&&xs(v)&&!v.tokens&&(S=/^{([^}]+)}$/.exec(u)))return[new pt(t,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const C=[];return i.layerType==="symbol"&&(p==="text-field"&&n&&!n.glyphs&&C.push(new pt(t,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&ya(mo(u))&&rr(u.type)==="identity"&&C.push(new pt(t,u,'"text-font" does not support identity functions'))),C.concat(Sr({key:i.key,value:u,valueSpec:v,style:n,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function Kh(i){return Hh(i,"paint")}function Yh(i){return Hh(i,"layout")}function Ml(i){let e=[];const t=i.value,n=i.key,l=i.style,u=i.styleSpec;t.type||t.ref||e.push(new pt(n,t,'either "type" or "ref" is required'));let p=rr(t.type);const f=rr(t.ref);if(t.id){const x=rr(t.id);for(let v=0;v<i.arrayIndex;v++){const S=l.layers[v];rr(S.id)===x&&e.push(new pt(n,t.id,`duplicate layer id "${t.id}", previously used at line ${S.id.__line__}`))}}if("ref"in t){let x;["type","source","source-layer","filter","layout"].forEach(v=>{v in t&&e.push(new pt(n,t[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{rr(v.id)===f&&(x=v)}),x?x.ref?e.push(new pt(n,t.ref,"ref cannot reference another ref layer")):p=rr(x.type):typeof f=="string"&&e.push(new pt(n,t.ref,`ref layer "${f}" not found`))}else if(p!=="background"&&p!=="sky")if(t.source){const x=l.sources&&l.sources[t.source],v=x&&rr(x.type);x?v==="vector"&&p==="raster"?e.push(new pt(n,t.source,`layer "${t.id}" requires a raster source`)):v==="raster"&&p!=="raster"?e.push(new pt(n,t.source,`layer "${t.id}" requires a vector source`)):v!=="vector"||t["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new pt(n,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||v==="geojson"&&x.lineMetrics||e.push(new pt(n,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new pt(n,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new pt(n,t.source,`source "${t.source}" not found`))}else e.push(new pt(n,t,'missing required property "source"'));return e=e.concat(sn({key:n,value:t,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Sr({key:`${n}.type`,value:t.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:x=>Es(nn({layerType:p},x)),layout:x=>sn({layer:t,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":v=>Yh(nn({layerType:p},v))}}),paint:x=>sn({layer:t,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":v=>Kh(nn({layerType:p},v))}})}})),e}function Ss(i){const e=i.value,t=i.key,n=wi(e);return n!=="string"?[new pt(t,e,`string expected, ${n} found`)]:[]}const zl={promoteId:function({key:i,value:e}){if(wi(e)==="string")return Ss({key:i,value:e});{const t=[];for(const n in e)t.push(...Ss({key:`${i}.${n}`,value:e[n]}));return t}}};function Jh(i){const e=i.value,t=i.key,n=i.styleSpec,l=i.style;if(!e.type)return[new pt(t,e,'"type" is required')];const u=rr(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=sn({key:t,value:e,valueSpec:n[`source_${u.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:zl}),p;case"geojson":if(p=sn({key:t,value:e,valueSpec:n.source_geojson,style:l,styleSpec:n,objectElementValidators:zl}),e.cluster)for(const f in e.clusterProperties){const[x,v]=e.clusterProperties[f],S=typeof x=="string"?[x,["accumulated"],["get",f]]:x;p.push(...Mn({key:`${t}.${f}.map`,value:v,expressionContext:"cluster-map"})),p.push(...Mn({key:`${t}.${f}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return p;case"video":return sn({key:t,value:e,valueSpec:n.source_video,style:l,styleSpec:n});case"image":return sn({key:t,value:e,valueSpec:n.source_image,style:l,styleSpec:n});case"canvas":return[new pt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ta({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:n})}}function Qh(i){const e=i.value,t=i.styleSpec,n=t.light,l=i.style;let u=[];const p=wi(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new pt("light",e,`object expected, ${p} found`)]),u;for(const f in e){const x=f.match(/^(.*)-transition$/);u=u.concat(x&&n[x[1]]&&n[x[1]].transition?Sr({key:f,value:e[f],valueSpec:t.transition,style:l,styleSpec:t}):n[f]?Sr({key:f,value:e[f],valueSpec:n[f],style:l,styleSpec:t}):[new pt(f,e[f],`unknown property "${f}"`)])}return u}function Pl(i){const e=i.value,t=i.key,n=i.style,l=i.styleSpec,u=l.terrain;let p=[];const f=wi(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new pt("terrain",e,`object expected, ${f} found`)]),p;for(const x in e){const v=x.match(/^(.*)-transition$/);p=p.concat(v&&u[v[1]]&&u[v[1]].transition?Sr({key:x,value:e[x],valueSpec:l.transition,style:n,styleSpec:l}):u[x]?Sr({key:x,value:e[x],valueSpec:u[x],style:n,styleSpec:l}):[new pt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=n.sources&&n.sources[e.source],v=x&&rr(x.type);x?v!=="raster-dem"&&p.push(new pt(t,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):p.push(new pt(t,e.source,`source "${e.source}" not found`))}else p.push(new pt(t,e,'terrain is missing required property "source"'));return p}function ed(i){const e=i.value,t=i.style,n=i.styleSpec,l=n.fog;let u=[];const p=wi(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new pt("fog",e,`object expected, ${p} found`)]),u;for(const f in e){const x=f.match(/^(.*)-transition$/);u=u.concat(x&&l[x[1]]&&l[x[1]].transition?Sr({key:f,value:e[f],valueSpec:n.transition,style:t,styleSpec:n}):l[f]?Sr({key:f,value:e[f],valueSpec:l[f],style:t,styleSpec:n}):[new pt(f,e[f],`unknown property "${f}"`)])}return u}const du={"*":()=>[],array:au,boolean:function(i){const e=i.value,t=i.key,n=wi(e);return n!=="boolean"?[new pt(t,e,`boolean expected, ${n} found`)]:[]},number:lu,color:function(i){const e=i.key,t=i.value,n=wi(t);return n!=="string"?[new pt(e,t,`color expected, ${n} found`)]:go.parseCSSColor(t)===null?[new pt(e,t,`color expected, "${t}" found`)]:[]},enum:Ta,filter:Es,function:wa,layer:Ml,object:sn,source:Jh,light:Qh,terrain:Pl,fog:ed,string:Ss,formatted:function(i){return Ss(i).length===0?[]:Mn(i)},resolvedImage:function(i){return Ss(i).length===0?[]:Mn(i)},projection:function(i){const e=i.value,t=i.styleSpec,n=t.projection,l=i.style;let u=[];const p=wi(e);if(p==="object")for(const f in e)u=u.concat(Sr({key:f,value:e[f],valueSpec:n[f],style:l,styleSpec:t}));else p!=="string"&&(u=u.concat([new pt("projection",e,`object or string expected, ${p} found`)]));return u}};function Sr(i){const e=i.value,t=i.valueSpec,n=i.styleSpec;return t.expression&&ya(rr(e))?wa(i):t.expression&&Il(mo(e))?Mn(i):t.type&&du[t.type]?du[t.type](i):sn(nn({},i,{valueSpec:t.type?n[t.type]:t}))}function hf(i){const e=i.value,t=i.key,n=Ss(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new pt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new pt(t,e,'"glyphs" url must include a "{range}" token'))),n}function kl(i,e=ke){return Jn(Sr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:hf,"*":()=>[]}}))}const Dl=i=>Jn(Kh(i)),td=i=>Jn(Yh(i));function Jn(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function pu(i,e){let t=!1;if(e&&e.length)for(const n of e)i.fire(new Ci(new Error(n.message))),t=!0;return t}var As=fn;function fn(i,e,t){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(t=l[2]);for(var u=0;u<this.d*this.d;u++){var p=l[3+u],f=l[3+u+1];n.push(p===f?null:l.subarray(p,f))}var x=l[3+n.length+1];this.keys=l.subarray(l[3+n.length],x),this.bboxes=l.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var v=0;v<this.d*this.d;v++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var S=t/e*i;this.min=-S,this.max=i+S}fn.prototype.insert=function(i,e,t,n,l){this._forEachCell(e,t,n,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(l)},fn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fn.prototype._insertCell=function(i,e,t,n,l,u){this.cells[l].push(u)},fn.prototype.query=function(i,e,t,n,l){var u=this.min,p=this.max;if(i<=u&&e<=u&&p<=t&&p<=n&&!l)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(i,e,t,n,this._queryCell,f,{},l),f},fn.prototype._queryCell=function(i,e,t,n,l,u,p,f){var x=this.cells[l];if(x!==null)for(var v=this.keys,S=this.bboxes,C=0;C<x.length;C++){var M=x[C];if(p[M]===void 0){var L=4*M;(f?f(S[L+0],S[L+1],S[L+2],S[L+3]):i<=S[L+2]&&e<=S[L+3]&&t>=S[L+0]&&n>=S[L+1])?(p[M]=!0,u.push(v[M])):p[M]=!1}}},fn.prototype._forEachCell=function(i,e,t,n,l,u,p,f){for(var x=this._convertToCellCoord(i),v=this._convertToCellCoord(e),S=this._convertToCellCoord(t),C=this._convertToCellCoord(n),M=x;M<=S;M++)for(var L=v;L<=C;L++){var R=this.d*L+M;if((!f||f(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&l.call(this,i,e,t,n,R,u,p,f))return}},fn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},fn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},fn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,n=0;n<this.cells.length;n++)t+=this.cells[n].length;var l=new Int32Array(e+t+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,p=0;p<i.length;p++){var f=i[p];l[3+p]=u,l.set(f,u),u+=f.length}return l[3+i.length]=u,l.set(this.keys,u),l[3+i.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const Ll={};function _t(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Ll[e]={klass:i,omit:t.omit||[]}}_t(Object,"Object"),As.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},As.deserialize=function(i){return new As(i.buffer)},Object.defineProperty(As,"name",{value:"Grid"}),_t(As,"Grid"),_t(Mi,"Color"),_t(Error,"Error"),_t(Te,"AJAXError"),_t(Kr,"ResolvedImage"),_t(ws,"StylePropertyFunction"),_t(nu,"StyleExpression",{omit:["_evaluator"]}),_t(ba,"ZoomDependentExpression"),_t(ou,"ZoomConstantExpression"),_t(Cn,"CompoundExpression",{omit:["_evaluate"]});for(const i in ga)Ll[ga[i]._classRegistryKey]||_t(ga[i],`Expression${i}`);function id(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function rd(i){return k.ImageBitmap&&i instanceof k.ImageBitmap}function Is(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(id(i)||rd(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof k.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const n of i)t.push(Is(n,e));return t}if(typeof i=="object"){const t=i.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const l=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const u in i)i.hasOwnProperty(u)&&(Ll[n].omit.indexOf(u)>=0||(l[u]=Is(i[u],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(l.$name=n),l}throw new Error("can't serialize object of type "+typeof i)}function Ca(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||id(i)||rd(i)||ArrayBuffer.isView(i)||i instanceof k.ImageData)return i;if(Array.isArray(i))return i.map(Ca);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=Ll[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const n=Object.create(t.prototype);for(const l of Object.keys(i))l!=="$name"&&(n[l]=Ca(i[l]));return n}throw new Error("can't deserialize object of type "+typeof i)}class nd{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const od=i=>i>=1536&&i<=1791,sd=i=>i>=1872&&i<=1919,ad=i=>i>=2208&&i<=2303,ld=i=>i>=11904&&i<=12031,cd=i=>i>=12032&&i<=12255,Ma=i=>i>=12272&&i<=12287,Rl=i=>i>=12288&&i<=12351,fu=i=>i>=12352&&i<=12447,$o=i=>i>=12448&&i<=12543,ud=i=>i>=12544&&i<=12591,mu=i=>i>=12704&&i<=12735,hd=i=>i>=12736&&i<=12783,_u=i=>i>=12784&&i<=12799,gu=i=>i>=12800&&i<=13055,yu=i=>i>=13056&&i<=13311,xu=i=>i>=13312&&i<=19903,za=i=>i>=19968&&i<=40959,Bl=i=>i>=40960&&i<=42127,dd=i=>i>=42128&&i<=42191,pd=i=>i>=44032&&i<=55215,fd=i=>i>=63744&&i<=64255,Pa=i=>i>=64336&&i<=65023,md=i=>i>=65040&&i<=65055,vu=i=>i>=65072&&i<=65103,_d=i=>i>=65104&&i<=65135,bu=i=>i>=65136&&i<=65279,wu=i=>i>=65280&&i<=65519;function Ol(i){for(const e of i)if(Fl(e.charCodeAt(0)))return!0;return!1}function df(i){for(const e of i)if(!pf(e.charCodeAt(0)))return!1;return!0}function pf(i){return!(od(i)||sd(i)||ad(i)||Pa(i)||bu(i))}function Fl(i){return!(i!==746&&i!==747&&(i<4352||!(mu(i)||ud(i)||vu(i)&&!(i>=65097&&i<=65103)||fd(i)||yu(i)||ld(i)||hd(i)||!(!Rl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||xu(i)||za(i)||gu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||pd(i)||fu(i)||Ma(i)||(e=>e>=12688&&e<=12703)(i)||cd(i)||_u(i)||$o(i)&&i!==12540||!(!wu(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!_d(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||md(i)||(e=>e>=19904&&e<=19967)(i)||Bl(i)||dd(i))))}function ka(i){return!(Fl(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Rl(e)||$o(e)||(t=>t>=57344&&t<=63743)(e)||vu(e)||_d(e)||wu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function c(i){return i>=1424&&i<=2303||Pa(i)||bu(i)}function r(i,e){return!(!e&&c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function s(i){for(const e of i)if(c(e.charCodeAt(0)))return!0;return!1}const h="deferred",m="loading",y="loaded";let w=null,E="unavailable",A=null;const P=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(E="error"),w&&w(i)};function D(){U.fire(new Di("pluginStateChange",{pluginStatus:E,pluginURL:A}))}const U=new kt,G=function(){return E},K=function(){if(E!==h||!A)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");E=m,D(),A&&Ee({url:A},i=>{i?P(i):(E=y,D())})},W={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>E===y||W.applyArabicShaping!=null,isLoading:()=>E===m,setState(i){E=i.pluginStatus,A=i.pluginURL},isParsed:()=>W.applyArabicShaping!=null&&W.processBidirectionalText!=null&&W.processStyledBidirectionalText!=null,getPluginURL:()=>A};class X{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new nd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,n){for(const l of t)if(!r(l.charCodeAt(0),n))return!1;return!0}(e,W.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class H{constructor(e,t){this.property=e,this.value=t,this.expression=function(n,l){if(ya(n))return new ws(n,l);if(Il(n)){const u=su(n,l);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=n;return typeof n=="string"&&l.type==="color"&&(u=Mi.parse(n)),{kind:"constant",evaluate:()=>u}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Z{constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,t){return new Y(this.property,this.value,t,gt({},e.transition,this.transition),e.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return lr(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Z(this._values[e].property)),this._values[e].value=new H(this._values[e].property,t===null?void 0:lr(t))}getTransition(e){return lr(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Z(this._values[e].property)),this._values[e].transition=lr(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n);const l=this.getTransition(t);l!==void 0&&(e[`${t}-transition`]=l)}return e}transitioned(e,t){const n=new fe(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].transitioned(e,t._values[l]);return n}untransitioned(){const e=new fe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Y{constructor(e,t,n,l,u){const p=l.delay||0,f=l.duration||0;u=u||0,this.property=e,this.value=t,this.begin=u+p,this.end=this.begin+f,e.specification.transition&&(l.delay||l.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const l=e.now||0,u=this.value.possiblyEvaluate(e,t,n),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(e,t,n);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,t,n),u,qe(f))}}return u}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const l=new pe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,n);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return lr(this._values[e].value)}setValue(e,t){this._values[e]=new H(this._values[e].property,t===null?void 0:lr(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const l=new pe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,n);return l}}class ae{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,n,l){return this.property.evaluate(this.value,this.parameters,e,t,n,l)}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class he{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const l=pa[this.specification.type];return l?l(e,t,n):e}}class xe{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,l){return new ae(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},n,l)}:e.expression,t)}interpolate(e,t,n){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ae(this,{kind:"constant",value:void 0},e.parameters);const l=pa[this.specification.type];return l?new ae(this,{kind:"constant",value:l(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,l,u,p){return e.kind==="constant"?e.value:e.evaluate(t,n,l,u,p)}}class Se extends xe{possiblyEvaluate(e,t,n,l){if(e.value===void 0)return new ae(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},n,l),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(p,p,p,t);return new ae(this,{kind:"constant",value:f},t)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new ae(this,{kind:"constant",value:u},t)}return new ae(this,e.expression,t)}evaluate(e,t,n,l,u,p){if(e.kind==="source"){const f=e.evaluate(t,n,l,u,p);return this._calculate(f,f,f,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,l),e.evaluate({zoom:Math.floor(t.zoom)},n,l),e.evaluate({zoom:Math.floor(t.zoom)+1},n,l),t):e.value}_calculate(e,t,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t,other:n}:{from:n,to:t,other:e}}interpolate(e){return e}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},n,l);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new X(Math.floor(t.zoom-1),t)),e.expression.evaluate(new X(Math.floor(t.zoom),t)),e.expression.evaluate(new X(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class we{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,l){return!!e.expression.evaluate(t,null,{},n,l)}interpolate(){return!1}}class Le{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new X(0,{});for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new H(l,void 0),p=this.defaultTransitionablePropertyValues[n]=new Z(l);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate(t)}}}function Fe(i,e){return 256*(i=He(Math.floor(i),0,255))+He(Math.floor(e),0,255)}_t(xe,"DataDrivenProperty"),_t(he,"DataConstantProperty"),_t(Se,"CrossFadedDataDrivenProperty"),_t(Ye,"CrossFadedProperty"),_t(we,"ColorRampProperty");const it={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ze{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Oe(i,e=1){let t=0,n=0;return{members:i.map(l=>{const u=it[l.type].BYTES_PER_ELEMENT,p=t=at(t,Math.max(e,u)),f=l.components||1;return n=Math.max(n,u),t+=u*f,{name:l.name,type:l.type,components:f,offset:p}}),size:at(t,Math.max(n,e)),alignment:e}}function at(i,e){return Math.ceil(i/e)*e}class ot extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const l=2*e;return this.int16[l+0]=t,this.int16[l+1]=n,e}}ot.prototype.bytesPerElement=4,_t(ot,"StructArrayLayout2i4");class wt extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n)}emplace(e,t,n,l){const u=3*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=l,e}}wt.prototype.bytesPerElement=6,_t(wt,"StructArrayLayout3i6");class Mt extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=4*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=l,this.int16[p+3]=u,e}}Mt.prototype.bytesPerElement=8,_t(Mt,"StructArrayLayout4i8");class Nt extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,n,l,u,p,f)}emplace(e,t,n,l,u,p,f,x){const v=6*e,S=12*e,C=3*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.uint8[S+4]=l,this.uint8[S+5]=u,this.uint8[S+6]=p,this.uint8[S+7]=f,this.float32[C+2]=x,e}}Nt.prototype.bytesPerElement=12,_t(Nt,"StructArrayLayout2i4ub1f12");class oi extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=4*e;return this.float32[p+0]=t,this.float32[p+1]=n,this.float32[p+2]=l,this.float32[p+3]=u,e}}oi.prototype.bytesPerElement=16,_t(oi,"StructArrayLayout4f16");class Tt extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,S){const C=this.length;return this.resize(C+1),this.emplace(C,e,t,n,l,u,p,f,x,v,S)}emplace(e,t,n,l,u,p,f,x,v,S,C){const M=10*e;return this.uint16[M+0]=t,this.uint16[M+1]=n,this.uint16[M+2]=l,this.uint16[M+3]=u,this.uint16[M+4]=p,this.uint16[M+5]=f,this.uint16[M+6]=x,this.uint16[M+7]=v,this.uint16[M+8]=S,this.uint16[M+9]=C,e}}Tt.prototype.bytesPerElement=20,_t(Tt,"StructArrayLayout10ui20");class qt extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,n,l,u,p,f,x)}emplace(e,t,n,l,u,p,f,x,v){const S=8*e;return this.uint16[S+0]=t,this.uint16[S+1]=n,this.uint16[S+2]=l,this.uint16[S+3]=u,this.uint16[S+4]=p,this.uint16[S+5]=f,this.uint16[S+6]=x,this.uint16[S+7]=v,e}}qt.prototype.bytesPerElement=16,_t(qt,"StructArrayLayout8ui16");class _i extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,l,u,p)}emplace(e,t,n,l,u,p,f){const x=6*e;return this.int16[x+0]=t,this.int16[x+1]=n,this.int16[x+2]=l,this.int16[x+3]=u,this.int16[x+4]=p,this.int16[x+5]=f,e}}_i.prototype.bytesPerElement=12,_t(_i,"StructArrayLayout6i12");class qi extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,S,C,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,n,l,u,p,f,x,v,S,C,M)}emplace(e,t,n,l,u,p,f,x,v,S,C,M,L){const R=12*e;return this.int16[R+0]=t,this.int16[R+1]=n,this.int16[R+2]=l,this.int16[R+3]=u,this.uint16[R+4]=p,this.uint16[R+5]=f,this.uint16[R+6]=x,this.uint16[R+7]=v,this.int16[R+8]=S,this.int16[R+9]=C,this.int16[R+10]=M,this.int16[R+11]=L,e}}qi.prototype.bytesPerElement=24,_t(qi,"StructArrayLayout4i4ui4i24");class nr extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,l,u,p)}emplace(e,t,n,l,u,p,f){const x=10*e,v=5*e;return this.int16[x+0]=t,this.int16[x+1]=n,this.int16[x+2]=l,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=f,e}}nr.prototype.bytesPerElement=20,_t(nr,"StructArrayLayout3i3f20");class zi extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}zi.prototype.bytesPerElement=4,_t(zi,"StructArrayLayout1ul4");class Ar extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,S,C,M,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,t,n,l,u,p,f,x,v,S,C,M,L)}emplace(e,t,n,l,u,p,f,x,v,S,C,M,L,R){const V=20*e,q=10*e;return this.int16[V+0]=t,this.int16[V+1]=n,this.int16[V+2]=l,this.int16[V+3]=u,this.int16[V+4]=p,this.float32[q+3]=f,this.float32[q+4]=x,this.float32[q+5]=v,this.float32[q+6]=S,this.int16[V+14]=C,this.uint32[q+8]=M,this.uint16[V+18]=L,this.uint16[V+19]=R,e}}Ar.prototype.bytesPerElement=40,_t(Ar,"StructArrayLayout5i4f1i1ul2ui40");class zn extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,n,l,u,p,f)}emplace(e,t,n,l,u,p,f,x){const v=8*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.int16[v+2]=l,this.int16[v+4]=u,this.int16[v+5]=p,this.int16[v+6]=f,this.int16[v+7]=x,e}}zn.prototype.bytesPerElement=16,_t(zn,"StructArrayLayout3i2i2i16");class Qn extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,l,u)}emplace(e,t,n,l,u,p){const f=4*e,x=8*e;return this.float32[f+0]=t,this.float32[f+1]=n,this.float32[f+2]=l,this.int16[x+6]=u,this.int16[x+7]=p,e}}Qn.prototype.bytesPerElement=16,_t(Qn,"StructArrayLayout2f1f2i16");class Zi extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=12*e,f=3*e;return this.uint8[p+0]=t,this.uint8[p+1]=n,this.float32[f+1]=l,this.float32[f+2]=u,e}}Zi.prototype.bytesPerElement=12,_t(Zi,"StructArrayLayout2ub2f12");class Xi extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n)}emplace(e,t,n,l){const u=3*e;return this.float32[u+0]=t,this.float32[u+1]=n,this.float32[u+2]=l,e}}Xi.prototype.bytesPerElement=12,_t(Xi,"StructArrayLayout3f12");class Qt extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n)}emplace(e,t,n,l){const u=3*e;return this.uint16[u+0]=t,this.uint16[u+1]=n,this.uint16[u+2]=l,e}}Qt.prototype.bytesPerElement=6,_t(Qt,"StructArrayLayout3ui6");class dr extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q,Q,le,ie,se,me){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q,Q,le,ie,se,me)}emplace(e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q,Q,le,ie,se,me,ue){const Ce=30*e,Ae=15*e,De=60*e;return this.int16[Ce+0]=t,this.int16[Ce+1]=n,this.int16[Ce+2]=l,this.float32[Ae+2]=u,this.float32[Ae+3]=p,this.uint16[Ce+8]=f,this.uint16[Ce+9]=x,this.uint32[Ae+5]=v,this.uint32[Ae+6]=S,this.uint32[Ae+7]=C,this.uint16[Ce+16]=M,this.uint16[Ce+17]=L,this.uint16[Ce+18]=R,this.float32[Ae+10]=V,this.float32[Ae+11]=q,this.uint8[De+48]=Q,this.uint8[De+49]=le,this.uint8[De+50]=ie,this.uint32[Ae+13]=se,this.int16[Ce+28]=me,this.uint8[De+58]=ue,e}}dr.prototype.bytesPerElement=60,_t(dr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Lr extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q,Q,le,ie,se,me,ue,Ce,Ae,De,et,Me,Re,Ne,Be){const Je=this.length;return this.resize(Je+1),this.emplace(Je,e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q,Q,le,ie,se,me,ue,Ce,Ae,De,et,Me,Re,Ne,Be)}emplace(e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q,Q,le,ie,se,me,ue,Ce,Ae,De,et,Me,Re,Ne,Be,Je){const Ve=38*e,ct=19*e;return this.int16[Ve+0]=t,this.int16[Ve+1]=n,this.int16[Ve+2]=l,this.float32[ct+2]=u,this.float32[ct+3]=p,this.int16[Ve+8]=f,this.int16[Ve+9]=x,this.int16[Ve+10]=v,this.int16[Ve+11]=S,this.int16[Ve+12]=C,this.int16[Ve+13]=M,this.uint16[Ve+14]=L,this.uint16[Ve+15]=R,this.uint16[Ve+16]=V,this.uint16[Ve+17]=q,this.uint16[Ve+18]=Q,this.uint16[Ve+19]=le,this.uint16[Ve+20]=ie,this.uint16[Ve+21]=se,this.uint16[Ve+22]=me,this.uint16[Ve+23]=ue,this.uint16[Ve+24]=Ce,this.uint16[Ve+25]=Ae,this.uint16[Ve+26]=De,this.uint16[Ve+27]=et,this.uint16[Ve+28]=Me,this.uint32[ct+15]=Re,this.float32[ct+16]=Ne,this.float32[ct+17]=Be,this.float32[ct+18]=Je,e}}Lr.prototype.bytesPerElement=76,_t(Lr,"StructArrayLayout3i2f6i15ui1ul3f76");class Ui extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Ui.prototype.bytesPerElement=4,_t(Ui,"StructArrayLayout1f4");class Rr extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,l,u)}emplace(e,t,n,l,u,p){const f=5*e;return this.float32[f+0]=t,this.float32[f+1]=n,this.float32[f+2]=l,this.float32[f+3]=u,this.float32[f+4]=p,e}}Rr.prototype.bytesPerElement=20,_t(Rr,"StructArrayLayout5f20");class Go extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,l)}emplace(e,t,n,l,u){const p=6*e;return this.uint32[3*e+0]=t,this.uint16[p+2]=n,this.uint16[p+3]=l,this.uint16[p+4]=u,e}}Go.prototype.bytesPerElement=12,_t(Go,"StructArrayLayout1ul3ui12");class $r extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const l=2*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,e}}$r.prototype.bytesPerElement=4,_t($r,"StructArrayLayout2ui4");class qo extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}qo.prototype.bytesPerElement=2,_t(qo,"StructArrayLayout1ui2");class Zo extends Qe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const l=2*e;return this.float32[l+0]=t,this.float32[l+1]=n,e}}Zo.prototype.bytesPerElement=8,_t(Zo,"StructArrayLayout2f8");class Wo extends ze{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Wo.prototype.size=12;class Gr extends _i{get(e){return new Wo(this,e)}}_t(Gr,"FillExtrusionExtArray");class Xo extends ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xo.prototype.size=40;class To extends Ar{get(e){return new Xo(this,e)}}_t(To,"CollisionBoxArray");class Da extends ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Da.prototype.size=60;class tg extends dr{get(e){return new Da(this,e)}}_t(tg,"PlacedSymbolArray");class ig extends ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ig.prototype.size=76;class rg extends Lr{get(e){return new ig(this,e)}}_t(rg,"SymbolInstanceArray");class ng extends Ui{getoffsetX(e){return this.float32[1*e+0]}}_t(ng,"GlyphOffsetArray");class og extends wt{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}_t(og,"SymbolLineVertexArray");class sg extends ze{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sg.prototype.size=12;class ag extends Go{get(e){return new sg(this,e)}}_t(ag,"FeatureIndexArray");class lg extends ze{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}lg.prototype.size=4;class cg extends $r{get(e){return new lg(this,e)}}_t(cg,"FillExtrusionCentroidArray");class ug extends ze{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ug.prototype.size=12;class hg extends _i{get(e){return new ug(this,e)}}_t(hg,"CircleGlobeExtArray");const rb=Oe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),nb=Oe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var dg=Ac(function(i){i.exports=function(e,t){var n,l,u,p,f,x,v,S;for(l=e.length-(n=3&e.length),u=t,f=3432918353,x=461845907,S=0;S<l;)v=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,u=27492+(65535&(p=5*(65535&(u=(u^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*x+(((v>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,n){case 3:v^=(255&e.charCodeAt(S+2))<<16;case 2:v^=(255&e.charCodeAt(S+1))<<8;case 1:u^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(S)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*x+(((v>>>16)*x&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),ob=Ac(function(i){i.exports=function(e,t){for(var n,l=e.length,u=t^l,p=0;l>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),Tu=dg,sb=ob;Tu.murmur3=dg,Tu.murmur2=sb;class gd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,l){this.ids.push(pg(e)),this.positions.push(t,n,l)}getPositions(e){const t=pg(e);let n=0,l=this.ids.length-1;for(;n<l;){const p=n+l>>1;this.ids[p]>=t?l=p:n=p+1}const u=[];for(;this.ids[n]===t;)u.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return u}static serialize(e,t){const n=new Float64Array(e.ids),l=new Uint32Array(e.positions);return ff(n,l,0,n.length-1),t&&t.push(n.buffer,l.buffer),{ids:n,positions:l}}static deserialize(e){const t=new gd;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function pg(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Tu(String(i))}function ff(i,e,t,n){for(;t<n;){const l=i[t+n>>1];let u=t-1,p=n+1;for(;;){do u++;while(i[u]<l);do p--;while(i[p]>l);if(u>=p)break;yd(i,u,p),yd(e,3*u,3*p),yd(e,3*u+1,3*p+1),yd(e,3*u+2,3*p+2)}p-t<n-p?(ff(i,e,t,p),t=p+1):(ff(i,e,p+1,n),n=p)}}function yd(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}_t(gd,"FeaturePositionMap");class Ho{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class xd extends Ho{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class fg extends Ho{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class mg extends Ho{constructor(e){super(e),this.current=Mi.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const ab=new Float32Array(16),lb=new Float32Array(9),cb=new Float32Array(4);function mf(i){return[Fe(255*i.r,255*i.g),Fe(255*i.b,255*i.a)]}class Eu{constructor(e,t,n){this.value=e,this.uniformNames=t.map(l=>`u_${l}`),this.type=n}setUniform(e,t,n,l,u){t.set(e,u,l.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new mg(e):new xd(e)}}class Ul{constructor(e,t){this.uniformNames=t.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,n,l,u){const p=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(e,u,p)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new fg(e):new xd(e)}}class Ko{constructor(e,t,n,l){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(u=>({name:`a_${u}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,t,n,l,u,p){const f=this.paintVertexArray.length,x=this.expression.evaluate(new X(0),t,{},u,l,p);this.paintVertexArray.resize(e),this._setPaintValue(f,e,x)}updatePaintArray(e,t,n,l,u){const p=this.expression.evaluate({zoom:0},n,l,void 0,u);this._setPaintValue(e,t,p)}_setPaintValue(e,t,n){if(this.type==="color"){const l=mf(n);for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eo{constructor(e,t,n,l,u,p){this.expression=e,this.uniformNames=t.map(f=>`u_${f}_t`),this.type=n,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,t,n,l,u,p){const f=this.expression.evaluate(new X(this.zoom),t,{},u,l,p),x=this.expression.evaluate(new X(this.zoom+1),t,{},u,l,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,f,x)}updatePaintArray(e,t,n,l,u){const p=this.expression.evaluate({zoom:this.zoom},n,l,void 0,u),f=this.expression.evaluate({zoom:this.zoom+1},n,l,void 0,u);this._setPaintValue(e,t,p,f)}_setPaintValue(e,t,n,l){if(this.type==="color"){const u=mf(n),p=mf(l);for(let f=e;f<t;f++)this.paintVertexArray.emplace(f,u[0],u[1],p[0],p[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,n,l);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,l,u){const p=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=He(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);t.set(e,u,f)}getBinding(e,t){return new xd(e)}}class Cs{constructor(e,t,n,l,u,p,f){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=u,this.layerId=f,this.paintVertexAttributes=(n==="array"?nb:rb).members;for(let x=0;x<t.length;++x);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,t,n){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,l,u,p){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(e,t,n,l){if(!l||!n)return;const{min:u,mid:p,max:f}=n,x=l[u],v=l[p],S=l[f];if(x&&v&&S)for(let C=e;C<t;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,v,x),this._setPaintValue(this.zoomOutPaintVertexArray,C,v,S)}_setPaintValue(e,t,n,l){e.emplace(t,n.tl[0],n.tl[1],n.br[0],n.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],n.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ms{constructor(e,t,n=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!n(u))continue;const p=e.paint.get(u);if(!(p instanceof ae&&xs(p.property.specification)))continue;const f=hb(u,e.type),x=p.value,v=p.property.specification.type,S=p.property.useIntegerZoom,C=p.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven",L=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||L)if(x.kind==="source"||L||M){const R=_g(u,v,"source");this.binders[u]=M?new Cs(x,f,v,S,t,R,e.id):new Ko(x,f,v,R),l.push(`/a_${u}`)}else{const R=_g(u,v,"composite");this.binders[u]=new eo(x,f,v,S,t,R),l.push(`/z_${u}`)}else this.binders[u]=M?new Ul(x.value,f):new Eu(x.value,f,v),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ko||t instanceof eo?t.maxValue:0}populatePaintArrays(e,t,n,l,u,p){for(const f in this.binders){const x=this.binders[f];(x instanceof Ko||x instanceof eo||x instanceof Cs)&&x.populatePaintArray(e,t,n,l,u,p)}}setConstantPatternPositions(e,t){for(const n in this.binders){const l=this.binders[n];l instanceof Ul&&l.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,l,u,p){let f=!1;for(const x in e){const v=t.getPositions(x);for(const S of v){const C=n.feature(S.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof Ko||L instanceof eo||L instanceof Cs)&&L.expression.isStateDependent===!0){const R=l.paint.get(M);L.expression=R.value,L.updatePaintArray(S.start,S.end,C,e[x],u,p),f=!0}}}}return f}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Eu||n instanceof Ul)&&e.push(...n.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Ko||n instanceof eo||n instanceof Cs)for(let l=0;l<n.paintVertexAttributes.length;l++)e.push(n.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Eu||n instanceof Ul||n instanceof eo)for(const l of n.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Eu||l instanceof Ul||l instanceof eo)for(const u of l.uniformNames)t.push({name:u,property:n,binding:l.getBinding(e,u)})}return t}setUniforms(e,t,n,l,u){for(const{name:p,property:f,binding:x}of n)this.binders[f].setUniform(e,x,u,l.get(f),p)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof Cs){const l=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(n instanceof Ko||n instanceof eo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Ko||n instanceof eo||n instanceof Cs)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ko||t instanceof eo||t instanceof Cs)&&t.destroy()}}}class La{constructor(e,t,n=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ms(l,t,n);this.needsUpload=!1,this._featureMap=new gd,this._bufferOffset=0}populatePaintArrays(e,t,n,l,u,p,f){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,l,u,p,f);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,l,u){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,t,p,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ub={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function hb(i,e){return ub[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const db={"line-pattern":{source:Tt,composite:Tt},"fill-pattern":{source:Tt,composite:Tt},"fill-extrusion-pattern":{source:Tt,composite:Tt},"line-dasharray":{source:qt,composite:qt}},pb={color:{source:Zo,composite:oi},number:{source:Ui,composite:Zo}};function _g(i,e,t){const n=db[i];return n&&n[t]||pb[e][t]}_t(Eu,"ConstantBinder"),_t(Ul,"CrossFadedConstantBinder"),_t(Ko,"SourceExpressionBinder"),_t(Cs,"CrossFadedCompositeBinder"),_t(eo,"CompositeExpressionBinder"),_t(Ms,"ProgramConfiguration",{omit:["_buffers"]}),_t(La,"ProgramConfigurationSet");const vd="-transition";class to extends kt{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new de(t.layout)),t.paint)){this._transitionablePaint=new te(t.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pe(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){t!=null&&this._validate(td,`layers.${this.id}.layout.${e}`,e,t,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return fi(e,vd)?this._transitionablePaint.getTransition(e.slice(0,-vd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(t!=null&&this._validate(Dl,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(fi(e,vd))return this._transitionablePaint.setTransition(e.slice(0,-vd.length),t||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,f,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Gi(e,(t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length))}_validate(e,t,n,l,u={}){return(!u||u.validate!==!1)&&pu(this,e.call(kl,{key:t,layerType:this.type,objectKey:n,value:l,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ae&&xs(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const fb=Oe([{name:"a_pos",components:2,type:"Int16"}],4),mb=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mr{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,l){let u=this.segments[this.segments.length-1];return e>mr.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>mr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,l){return new mr([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:l,vaos:{},sortKey:0}])}}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t(mr,"SegmentVector");var jt=8192;class zs{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ai?new Ai(e.lng,e.lat):Ai.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ai?new Ai(e.lng,e.lat):Ai.convert(e),this}extend(e){const t=this._sw,n=this._ne;let l,u;if(e instanceof Ai)l=e,u=e;else{if(!(e instanceof zs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(zs.convert(e)):this.extend(Ai.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return t||n?(t.lng=Math.min(l.lng,t.lng),t.lat=Math.min(l.lat,t.lat),n.lng=Math.max(u.lng,n.lng),n.lat=Math.max(u.lat,n.lat)):(this._sw=new Ai(l.lng,l.lat),this._ne=new Ai(u.lng,u.lat)),this}getCenter(){return new Ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ai(this.getWest(),this.getNorth())}getSouthEast(){return new Ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Ai.convert(e);let l=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&l}static convert(e){return!e||e instanceof zs?e:new zs(e)}}const _f=63710088e-1;class Ai{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ai(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,l=e.lat*t,u=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return _f*Math.acos(Math.min(u,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new zs(new Ai(this.lng-n,this.lat-t),new Ai(this.lng+n,this.lat+t))}static convert(e){if(e instanceof Ai)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ai(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ai(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gg=2*Math.PI*_f;function gf(i){return gg*Math.cos(i*Math.PI/180)}function Eo(i){return(180+i)/360}function Yo(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Nn(i,e){return i/gf(e)}function Vn(i){return 360*i-180}function Br(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function yg(i,e){return i*gf(Br(e))}const So=85.051129;function xg(i){return 1/Math.cos(i*Math.PI/180)}class jl{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Ai.convert(e);return new jl(Eo(n.lng),Yo(n.lat),Nn(t,n.lat))}toLngLat(){return new Ai(Vn(this.x),Br(this.y))}toAltitude(){return yg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gg*xg(Br(this.y))}}function yf(i,e,t,n,l,u,p,f,x){const v=(e+n)/2,S=(t+l)/2,C=new B(v,S);f(C),function(M,L,R,V,q,Q){const le=R-q,ie=V-Q;return Math.abs((V-L)*le-(R-M)*ie)/Math.hypot(le,ie)}(C.x,C.y,u.x,u.y,p.x,p.y)>=x?(yf(i,e,t,v,S,u,C,f,x),yf(i,v,S,n,l,C,p,f,x)):i.push(p)}function vg(i,e,t){let n=i[0],l=n.x,u=n.y;e(n);const p=[n];for(let f=1;f<i.length;f++){const x=i[f],{x:v,y:S}=x;e(x),yf(p,l,u,v,S,n,x,e,t),l=v,u=S,n=x}return p}function xf(i,e,t,n,l){if(l(e,t)){const u=e.add(t).mult(.5);n(u),xf(i,e,u,n,l),xf(i,u,t,n,l)}else i.push(t)}function _b(i,e,t){let n=i[0];e(n);const l=[n];for(let u=1;u<i.length;u++){const p=i[u];e(p),xf(l,n,p,e,t),n=p}return l}const vf=Math.pow(2,14)-1,bg=-vf-1;function gb(i,e){const t=Math.round(i.x*e),n=Math.round(i.y*e);return i.x=He(t,bg,vf),i.y=He(n,bg,vf),(t<i.x||t>i.x+1||n<i.y||n>i.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Jo(i,e,t){const n=i.loadGeometry(),l=i.extent,u=jt/l;if(e&&t&&t.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:f,x,y:v,projection:S}=t,C=M=>{const L=Vn((e.x+M.x/l)/p),R=Br((e.y+M.y/l)/p),V=S.project(L,R);M.x=(V.x*f-x)*l,M.y=(V.y*f-v)*l};for(let M=0;M<n.length;M++)if(i.type!==1)n[M]=vg(n[M],C,1);else{const L=[];for(const R of n[M])R.x<0||R.x>=l||R.y<0||R.y>=l||(C(R),L.push(R));n[M]=L}}for(const p of n)for(const f of p)gb(f,u);return n}function Ra(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Jo(i):[]}}function bd(i,e,t,n,l){i.emplaceBack(2*e+(n+1)/2,2*t+(l+1)/2)}function wd(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class bf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ot,this.indexArray=new Qt,this.segments=new mr,this.programConfigurations=new La(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,l){const u=this.layers[0],p=[];let f=null;u.type==="circle"&&(f=u.layout.get("circle-sort-key"));for(const{feature:v,id:S,index:C,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,R=Ra(v,L);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),R,n))continue;const V=f?f.evaluate(R,{},n):void 0,q={id:S,properties:v.properties,type:v.type,sourceLayerIndex:M,index:C,geometry:L?R.geometry:Jo(v,n,l),patterns:{},sortKey:V};p.push(q)}f&&p.sort((v,S)=>v.sortKey-S.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new hg,x=l.projection);for(const v of p){const{geometry:S,index:C,sourceLayerIndex:M}=v,L=e[C].feature;this.addFeature(v,S,C,t.availableImages,n,x),t.featureIndex.insert(L,S,C,M,this.index)}}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,l,u,p){for(const f of t)for(const x of f){const v=x.x,S=x.y;if(v<0||v>=jt||S<0||S>=jt)continue;if(p){const L=p.projectTilePoint(v,S,u),R=p.upVector(u,v,S),V=this.globeExtVertexArray;wd(V,L,R),wd(V,L,R),wd(V,L,R),wd(V,L,R)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=C.vertexLength;bd(this.layoutVertexArray,v,S,-1,-1),bd(this.layoutVertexArray,v,S,1,-1),bd(this.layoutVertexArray,v,S,1,1),bd(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},l,u)}}function wg(i,e){for(let t=0;t<i.length;t++)if(Ba(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Ba(i,e[t]))return!0;return!!wf(i,e)}function yb(i,e,t){return!!Ba(i,e)||!!Tf(e,i,t)}function Tg(i,e){if(i.length===1)return Sg(e,i[0]);for(let t=0;t<e.length;t++){const n=e[t];for(let l=0;l<n.length;l++)if(Ba(i,n[l]))return!0}for(let t=0;t<i.length;t++)if(Sg(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(wf(i,e[t]))return!0;return!1}function xb(i,e,t){if(i.length>1){if(wf(i,e))return!0;for(let n=0;n<e.length;n++)if(Tf(e[n],i,t))return!0}for(let n=0;n<i.length;n++)if(Tf(i[n],e,t))return!0;return!1}function wf(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const n=i[t],l=i[t+1];for(let u=0;u<e.length-1;u++)if(vb(n,l,e[u],e[u+1]))return!0}return!1}function vb(i,e,t,n){return Fi(i,t,n)!==Fi(e,t,n)&&Fi(i,e,t)!==Fi(i,e,n)}function Tf(i,e,t){const n=t*t;if(e.length===1)return i.distSqr(e[0])<n;for(let l=1;l<e.length;l++)if(Eg(i,e[l-1],e[l])<n)return!0;return!1}function Eg(i,e,t){const n=e.distSqr(t);if(n===0)return i.distSqr(e);const l=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/n;return i.distSqr(l<0?e:l>1?t:t.sub(e)._mult(l)._add(e))}function Sg(i,e){let t,n,l,u=!1;for(let p=0;p<i.length;p++){t=i[p];for(let f=0,x=t.length-1;f<t.length;x=f++)n=t[f],l=t[x],n.y>e.y!=l.y>e.y&&e.x<(l.x-n.x)*(e.y-n.y)/(l.y-n.y)+n.x&&(u=!u)}return u}function Ba(i,e){let t=!1;for(let n=0,l=i.length-1;n<i.length;l=n++){const u=i[n],p=i[l];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(t=!t)}return t}function Ag(i,e,t,n,l){for(const p of i)if(e<=p.x&&t<=p.y&&n>=p.x&&l>=p.y)return!0;const u=[new B(e,t),new B(e,l),new B(n,l),new B(n,t)];if(i.length>2){for(const p of u)if(Ba(i,p))return!0}for(let p=0;p<i.length-1;p++)if(bb(i[p],i[p+1],u))return!0;return!1}function bb(i,e,t){const n=t[0],l=t[2];if(i.x<n.x&&e.x<n.x||i.x>l.x&&e.x>l.x||i.y<n.y&&e.y<n.y||i.y>l.y&&e.y>l.y)return!1;const u=Fi(i,e,t[0]);return u!==Fi(i,e,t[1])||u!==Fi(i,e,t[2])||u!==Fi(i,e,t[3])}function Nl(i,e,t){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:t.programConfigurations.get(e.id).getMaxValue(i)}function Td(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ig(i,e,t,n,l){if(!e[0]&&!e[1])return i;const u=B.convert(e)._mult(l);t==="viewport"&&u._rotate(-n);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(u));return p}function Cg(i,e,t,n){const l=B.convert(i)._mult(n);return e==="viewport"&&l._rotate(-t),l}_t(bf,"CircleBucket",{omit:["layers"]});const wb=new Le({"circle-sort-key":new xe(ke.layout_circle["circle-sort-key"])});var Tb={paint:new Le({"circle-radius":new xe(ke.paint_circle["circle-radius"]),"circle-color":new xe(ke.paint_circle["circle-color"]),"circle-blur":new xe(ke.paint_circle["circle-blur"]),"circle-opacity":new xe(ke.paint_circle["circle-opacity"]),"circle-translate":new he(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new he(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xe(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xe(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xe(ke.paint_circle["circle-stroke-opacity"])}),layout:wb},Ed=1e-6,mn=typeof Float32Array!="undefined"?Float32Array:Array;function Mg(){var i=new mn(9);return mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ao(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ef(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=e[4],f=e[5],x=e[6],v=e[7],S=e[8],C=e[9],M=e[10],L=e[11],R=e[12],V=e[13],q=e[14],Q=e[15],le=t*f-n*p,ie=t*x-l*p,se=t*v-u*p,me=n*x-l*f,ue=n*v-u*f,Ce=l*v-u*x,Ae=S*V-C*R,De=S*q-M*R,et=S*Q-L*R,Me=C*q-M*V,Re=C*Q-L*V,Ne=M*Q-L*q,Be=le*Ne-ie*Re+se*Me+me*et-ue*De+Ce*Ae;return Be?(i[0]=(f*Ne-x*Re+v*Me)*(Be=1/Be),i[1]=(l*Re-n*Ne-u*Me)*Be,i[2]=(V*Ce-q*ue+Q*me)*Be,i[3]=(M*ue-C*Ce-L*me)*Be,i[4]=(x*et-p*Ne-v*De)*Be,i[5]=(t*Ne-l*et+u*De)*Be,i[6]=(q*se-R*Ce-Q*ie)*Be,i[7]=(S*Ce-M*se+L*ie)*Be,i[8]=(p*Re-f*et+v*Ae)*Be,i[9]=(n*et-t*Re-u*Ae)*Be,i[10]=(R*ue-V*se+Q*le)*Be,i[11]=(C*se-S*ue-L*le)*Be,i[12]=(f*De-p*Me-x*Ae)*Be,i[13]=(t*Me-n*De+l*Ae)*Be,i[14]=(V*ie-R*me-q*le)*Be,i[15]=(S*me-C*ie+M*le)*Be,i):null}function Vl(i,e,t){var n=e[0],l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],S=e[7],C=e[8],M=e[9],L=e[10],R=e[11],V=e[12],q=e[13],Q=e[14],le=e[15],ie=t[0],se=t[1],me=t[2],ue=t[3];return i[0]=ie*n+se*f+me*C+ue*V,i[1]=ie*l+se*x+me*M+ue*q,i[2]=ie*u+se*v+me*L+ue*Q,i[3]=ie*p+se*S+me*R+ue*le,i[4]=(ie=t[4])*n+(se=t[5])*f+(me=t[6])*C+(ue=t[7])*V,i[5]=ie*l+se*x+me*M+ue*q,i[6]=ie*u+se*v+me*L+ue*Q,i[7]=ie*p+se*S+me*R+ue*le,i[8]=(ie=t[8])*n+(se=t[9])*f+(me=t[10])*C+(ue=t[11])*V,i[9]=ie*l+se*x+me*M+ue*q,i[10]=ie*u+se*v+me*L+ue*Q,i[11]=ie*p+se*S+me*R+ue*le,i[12]=(ie=t[12])*n+(se=t[13])*f+(me=t[14])*C+(ue=t[15])*V,i[13]=ie*l+se*x+me*M+ue*q,i[14]=ie*u+se*v+me*L+ue*Q,i[15]=ie*p+se*S+me*R+ue*le,i}function Su(i,e,t){var n,l,u,p,f,x,v,S,C,M,L,R,V=t[0],q=t[1],Q=t[2];return e===i?(i[12]=e[0]*V+e[4]*q+e[8]*Q+e[12],i[13]=e[1]*V+e[5]*q+e[9]*Q+e[13],i[14]=e[2]*V+e[6]*q+e[10]*Q+e[14],i[15]=e[3]*V+e[7]*q+e[11]*Q+e[15]):(l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],S=e[7],C=e[8],M=e[9],L=e[10],R=e[11],i[0]=n=e[0],i[1]=l,i[2]=u,i[3]=p,i[4]=f,i[5]=x,i[6]=v,i[7]=S,i[8]=C,i[9]=M,i[10]=L,i[11]=R,i[12]=n*V+f*q+C*Q+e[12],i[13]=l*V+x*q+M*Q+e[13],i[14]=u*V+v*q+L*Q+e[14],i[15]=p*V+S*q+R*Q+e[15]),i}function Oa(i,e,t){var n=t[0],l=t[1],u=t[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Sf(i,e,t){var n=Math.sin(t),l=Math.cos(t),u=e[4],p=e[5],f=e[6],x=e[7],v=e[8],S=e[9],C=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+v*n,i[5]=p*l+S*n,i[6]=f*l+C*n,i[7]=x*l+M*n,i[8]=v*l-u*n,i[9]=S*l-p*n,i[10]=C*l-f*n,i[11]=M*l-x*n,i}function Sd(i,e,t){var n=Math.sin(t),l=Math.cos(t),u=e[0],p=e[1],f=e[2],x=e[3],v=e[8],S=e[9],C=e[10],M=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l-v*n,i[1]=p*l-S*n,i[2]=f*l-C*n,i[3]=x*l-M*n,i[8]=u*n+v*l,i[9]=p*n+S*l,i[10]=f*n+C*l,i[11]=x*n+M*l,i}function zg(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Pg(i,e,t){var n,l,u,p=t[0],f=t[1],x=t[2],v=Math.hypot(p,f,x);return v<Ed?null:(p*=v=1/v,f*=v,x*=v,n=Math.sin(e),l=Math.cos(e),i[0]=p*p*(u=1-l)+l,i[1]=f*p*u+x*n,i[2]=x*p*u-f*n,i[3]=0,i[4]=p*f*u-x*n,i[5]=f*f*u+l,i[6]=x*f*u+p*n,i[7]=0,i[8]=p*x*u+f*n,i[9]=f*x*u-p*n,i[10]=x*x*u+l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Eb=Vl;function Af(){var i=new mn(3);return mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function kg(i){var e=new mn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Au(i){return Math.hypot(i[0],i[1],i[2])}function $l(i,e,t){var n=new mn(3);return n[0]=i,n[1]=e,n[2]=t,n}function Ps(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function If(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function Dg(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function Cf(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function Mf(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function io(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function Ad(i,e,t,n){return i[0]=e[0]+t[0]*n,i[1]=e[1]+t[1]*n,i[2]=e[2]+t[2]*n,i}function Yr(i,e){var t=e[0],n=e[1],l=e[2],u=t*t+n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function $n(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function zf(i,e,t){var n=e[0],l=e[1],u=e[2],p=t[0],f=t[1],x=t[2];return i[0]=l*x-u*f,i[1]=u*p-n*x,i[2]=n*f-l*p,i}function yr(i,e,t){var n=e[0],l=e[1],u=e[2],p=t[3]*n+t[7]*l+t[11]*u+t[15];return i[0]=(t[0]*n+t[4]*l+t[8]*u+t[12])/(p=p||1),i[1]=(t[1]*n+t[5]*l+t[9]*u+t[13])/p,i[2]=(t[2]*n+t[6]*l+t[10]*u+t[14])/p,i}function Lg(i,e,t){var n=t[0],l=t[1],u=t[2],p=e[0],f=e[1],x=e[2],v=l*x-u*f,S=u*p-n*x,C=n*f-l*p,M=l*C-u*S,L=u*v-n*C,R=n*S-l*v,V=2*t[3];return S*=V,C*=V,L*=2,R*=2,i[0]=p+(v*=V)+(M*=2),i[1]=f+S+L,i[2]=x+C+R,i}var Iu,ro=If,Sb=Dg,Ab=Au;function Rg(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Fa(i,e,t){var n=e[0],l=e[1],u=e[2],p=e[3];return i[0]=t[0]*n+t[4]*l+t[8]*u+t[12]*p,i[1]=t[1]*n+t[5]*l+t[9]*u+t[13]*p,i[2]=t[2]*n+t[6]*l+t[10]*u+t[14]*p,i[3]=t[3]*n+t[7]*l+t[11]*u+t[15]*p,i}function Bg(){var i=new mn(4);return mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Og(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Fg(i,e,t){t*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(t),x=Math.cos(t);return i[0]=n*x+p*f,i[1]=l*x+u*f,i[2]=u*x-l*f,i[3]=p*x-n*f,i}function Ug(i,e,t){t*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(t),x=Math.cos(t);return i[0]=n*x-u*f,i[1]=l*x+p*f,i[2]=u*x+n*f,i[3]=p*x-l*f,i}Af(),Iu=new mn(4),mn!=Float32Array&&(Iu[0]=0,Iu[1]=0,Iu[2]=0,Iu[3]=0),Af(),$l(1,0,0),$l(0,1,0),Bg(),Bg(),Mg();class Pf{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const l=$n(t,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/l;return n[0]=this.pos[0]+this.dir[0]*u,n[1]=this.pos[1]+this.dir[1]*u,n[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,t,n){if(function(L,R){var V=L[0],q=L[1],Q=L[2],le=R[0],ie=R[1],se=R[2];return Math.abs(V-le)<=Ed*Math.max(1,Math.abs(V),Math.abs(le))&&Math.abs(q-ie)<=Ed*Math.max(1,Math.abs(q),Math.abs(ie))&&Math.abs(Q-se)<=Ed*Math.max(1,Math.abs(Q),Math.abs(se))}(this.pos,e)||t===0)return n[0]=n[1]=n[2]=0,!1;const[l,u,p]=this.dir,f=this.pos[0]-e[0],x=this.pos[1]-e[1],v=this.pos[2]-e[2],S=l*l+u*u+p*p,C=2*(f*l+x*u+v*p),M=C*C-4*S*(f*f+x*x+v*v-t*t);if(M<0){const L=Math.max(-C/2,0),R=f+l*L,V=x+u*L,q=v+p*L,Q=Math.hypot(R,V,q);return n[0]=R*t/Q,n[1]=V*t/Q,n[2]=q*t/Q,!1}{const L=(-C-Math.sqrt(M))/(2*S);if(L<0){const R=Math.hypot(f,x,v);return n[0]=f*t/R,n[1]=x*t/R,n[2]=v*t/R,!1}return n[0]=f+l*L,n[1]=x+u*L,n[2]=v+p*L,!0}}}class kf{constructor(e,t,n,l,u){this.TL=e,this.TR=t,this.BR=n,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,t,n){const l=[-1,1,1],u=[1,1,1],p=[1,-1,1],f=[-1,-1,1],x=yr(l,l,e),v=yr(u,u,e),S=yr(p,p,e),C=yr(f,f,e);return new kf(x,v,S,C,t/n)}}class Df{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,n,l){const u=Math.pow(2,n),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const v=Fa([],x,e),S=1/v[3]/t*u;return function(C,M,L){return C[0]=M[0]*L[0],C[1]=M[1]*L[1],C[2]=M[2]*L[2],C[3]=M[3]*L[3],C}(v,v,[S,S,l?1/v[3]:S,S])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const v=Yr([],zf([],ro([],p[x[0]],p[x[1]]),ro([],p[x[2]],p[x[1]]))),S=-$n(v,p[x[1]]);return v.concat(S)});return new Df(p,f)}}class an{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],n=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const l of e)t[0]=Math.min(t[0],l[0]),t[1]=Math.min(t[1],l[1]),t[2]=Math.min(t[2],l[2]),n[0]=Math.max(n[0],l[0]),n[1]=Math.max(n[1],l[1]),n[2]=Math.max(n[2],l[2]);return new an(t,n)}constructor(e,t){this.min=e,this.max=t,this.center=io([],Ps([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=kg(this.min),l=kg(this.max);for(let u=0;u<t.length;u++)n[u]=t[u]?this.min[u]:this.center[u],l[u]=t[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new an(n,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let n=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let p=0;for(let f=0;f<t.length;f++)p+=$n(u,t[f])+u[3]>=0;if(p===0)return 0;p!==t.length&&(n=!1)}if(n)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let f=0;f<e.points.length;f++){const x=e.points[f][l]-this.min[l];u=Math.min(u,x),p=Math.max(p,x)}if(p<0||u>this.max[l]-this.min[l])return 0}return 1}}function jg(i,e,t,n,l,u,p,f,x){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(x*=i.pixelToTileUnitsFactor);const v=i.tileID.canonical,S=t.projection.upVectorScale(v,t.center.lat,t.worldSize).metersToTile;for(const C of e)for(const M of C){const L=M.add(f),R=l&&t.elevation?t.elevation.exaggeration()*l.getElevationAt(L.x,L.y,!0):0,V=t.projection.projectTilePoint(L.x,L.y,v);if(R>0){const ie=t.projection.upVector(v,L.x,L.y);V.x+=ie[0]*S*R,V.y+=ie[1]*S*R,V.z+=ie[2]*S*R}const q=u?L:Ib(V.x,V.y,V.z,n),Q=u?i.tilespaceRays.map(ie=>Mb(ie,R)):i.queryGeometry.screenGeometry,le=Fa([],[V.x,V.y,V.z,1],n);if(!p&&u?x*=le[3]/t.cameraToCenterDistance:p&&!u&&(x*=t.cameraToCenterDistance/le[3]),u){const ie=Br((M.y/jt+v.y)/(1<<v.z));x/=t.projection.pixelsPerMeter(ie,1)/Nn(1,ie)}if(yb(Q,q,x))return!0}return!1}function Ib(i,e,t,n){const l=Fa([],[i,e,t,1],n);return new B(l[0]/l[3],l[1]/l[3])}const Ng=$l(0,0,0),Cb=$l(0,0,1);function Mb(i,e){const t=Af();return Ng[2]=e,i.intersectsPlane(Ng,Cb,t),new B(t[0],t[1])}class Vg extends bf{}function $g(i,{width:e,height:t},n,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*t*n)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*t*n);return i.width=e,i.height=t,i.data=l,i}function Gg(i,e,t){const{width:n,height:l}=e;n===i.width&&l===i.height||(Lf(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,l)},t),i.width=n,i.height=l,i.data=e.data)}function Lf(i,e,t,n,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||t.x>i.width-l.width||t.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||n.x>e.width-l.width||n.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;for(let x=0;x<l.height;x++){const v=((t.y+x)*i.width+t.x)*u,S=((n.y+x)*e.width+n.x)*u;for(let C=0;C<l.width*u;C++)f[S+C]=p[v+C]}return e}_t(Vg,"HeatmapBucket",{omit:["layers"]});class Qo{constructor(e,t){$g(this,e,1,t)}resize(e){Gg(this,new Qo(e),1)}clone(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,l,u){Lf(e,t,n,l,u,1)}}class _n{constructor(e,t){$g(this,e,4,t)}resize(e){Gg(this,new _n(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _n({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,l,u){Lf(e,t,n,l,u,4)}}_t(Qo,"AlphaImage"),_t(_n,"RGBAImage");var zb={paint:new Le({"heatmap-radius":new xe(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xe(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new we(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(ke.paint_heatmap["heatmap-opacity"])})};function Rf(i){const e={},t=i.resolution||256,n=i.clips?i.clips.length:1,l=i.image||new _n({width:t,height:n}),u=(p,f,x)=>{e[i.evaluationKey]=x;const v=i.expression.evaluate(e);l.data[p+f+0]=Math.floor(255*v.r/v.a),l.data[p+f+1]=Math.floor(255*v.g/v.a),l.data[p+f+2]=Math.floor(255*v.b/v.a),l.data[p+f+3]=Math.floor(255*v.a)};if(i.clips)for(let p=0,f=0;p<n;++p,f+=4*t)for(let x=0,v=0;x<t;x++,v+=4){const S=x/(t-1),{start:C,end:M}=i.clips[p];u(f,v,C*(1-S)+M*S)}else for(let p=0,f=0;p<t;p++,f+=4)u(0,f,p/(t-1));return l}var Pb={paint:new Le({"hillshade-illumination-direction":new he(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(ke.paint_hillshade["hillshade-accent-color"])})};const kb=Oe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Db}=kb;var Id=Cd,Lb=Cd;function Cd(i,e,t){t=t||2;var n,l,u,p,f,x,v,S=e&&e.length,C=S?e[0]*t:i.length,M=qg(i,0,C,t,!0),L=[];if(!M||M.next===M.prev)return L;if(S&&(M=function(V,q,Q,le){var ie,se,me,ue=[];for(ie=0,se=q.length;ie<se;ie++)(me=qg(V,q[ie]*le,ie<se-1?q[ie+1]*le:V.length,le,!1))===me.next&&(me.steiner=!0),ue.push(Vb(me));for(ue.sort(Ub),ie=0;ie<ue.length;ie++)Q=jb(ue[ie],Q);return Q}(i,e,M,t)),i.length>80*t){n=u=i[0],l=p=i[1];for(var R=t;R<C;R+=t)(f=i[R])<n&&(n=f),(x=i[R+1])<l&&(l=x),f>u&&(u=f),x>p&&(p=x);v=(v=Math.max(u-n,p-l))!==0?32767/v:0}return Cu(M,L,t,n,l,v,0),L}function qg(i,e,t,n,l){var u,p;if(l===Ff(i,e,t,n)>0)for(u=e;u<t;u+=n)p=Xg(u,i[u],i[u+1],p);else for(u=t-n;u>=e;u-=n)p=Xg(u,i[u],i[u+1],p);return p&&Md(p,p.next)&&(zu(p),p=p.next),p}function Ua(i,e){if(!i)return i;e||(e=i);var t,n=i;do if(t=!1,n.steiner||!Md(n,n.next)&&pr(n.prev,n,n.next)!==0)n=n.next;else{if(zu(n),(n=e=n.prev)===n.next)break;t=!0}while(t||n!==e);return e}function Cu(i,e,t,n,l,u,p){if(i){!p&&u&&function(S,C,M,L){var R=S;do R.z===0&&(R.z=Bf(R.x,R.y,C,M,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==S);R.prevZ.nextZ=null,R.prevZ=null,function(V){var q,Q,le,ie,se,me,ue,Ce,Ae=1;do{for(Q=V,V=null,se=null,me=0;Q;){for(me++,le=Q,ue=0,q=0;q<Ae&&(ue++,le=le.nextZ);q++);for(Ce=Ae;ue>0||Ce>0&&le;)ue!==0&&(Ce===0||!le||Q.z<=le.z)?(ie=Q,Q=Q.nextZ,ue--):(ie=le,le=le.nextZ,Ce--),se?se.nextZ=ie:V=ie,ie.prevZ=se,se=ie;Q=le}se.nextZ=null,Ae*=2}while(me>1)}(R)}(i,n,l,u);for(var f,x,v=i;i.prev!==i.next;)if(f=i.prev,x=i.next,u?Bb(i,n,l,u):Rb(i))e.push(f.i/t|0),e.push(i.i/t|0),e.push(x.i/t|0),zu(i),i=x.next,v=x.next;else if((i=x)===v){p?p===1?Cu(i=Ob(Ua(i),e,t),e,t,n,l,u,2):p===2&&Fb(i,e,t,n,l,u):Cu(Ua(i),e,t,n,l,u,1);break}}}function Rb(i){var e=i.prev,t=i,n=i.next;if(pr(e,t,n)>=0)return!1;for(var l=e.x,u=t.x,p=n.x,f=e.y,x=t.y,v=n.y,S=l<u?l<p?l:p:u<p?u:p,C=f<x?f<v?f:v:x<v?x:v,M=l>u?l>p?l:p:u>p?u:p,L=f>x?f>v?f:v:x>v?x:v,R=n.next;R!==e;){if(R.x>=S&&R.x<=M&&R.y>=C&&R.y<=L&&Gl(l,f,u,x,p,v,R.x,R.y)&&pr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Bb(i,e,t,n){var l=i.prev,u=i,p=i.next;if(pr(l,u,p)>=0)return!1;for(var f=l.x,x=u.x,v=p.x,S=l.y,C=u.y,M=p.y,L=f<x?f<v?f:v:x<v?x:v,R=S<C?S<M?S:M:C<M?C:M,V=f>x?f>v?f:v:x>v?x:v,q=S>C?S>M?S:M:C>M?C:M,Q=Bf(L,R,e,t,n),le=Bf(V,q,e,t,n),ie=i.prevZ,se=i.nextZ;ie&&ie.z>=Q&&se&&se.z<=le;){if(ie.x>=L&&ie.x<=V&&ie.y>=R&&ie.y<=q&&ie!==l&&ie!==p&&Gl(f,S,x,C,v,M,ie.x,ie.y)&&pr(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,se.x>=L&&se.x<=V&&se.y>=R&&se.y<=q&&se!==l&&se!==p&&Gl(f,S,x,C,v,M,se.x,se.y)&&pr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ie&&ie.z>=Q;){if(ie.x>=L&&ie.x<=V&&ie.y>=R&&ie.y<=q&&ie!==l&&ie!==p&&Gl(f,S,x,C,v,M,ie.x,ie.y)&&pr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;se&&se.z<=le;){if(se.x>=L&&se.x<=V&&se.y>=R&&se.y<=q&&se!==l&&se!==p&&Gl(f,S,x,C,v,M,se.x,se.y)&&pr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Ob(i,e,t){var n=i;do{var l=n.prev,u=n.next.next;!Md(l,u)&&Zg(l,n,n.next,u)&&Mu(l,u)&&Mu(u,l)&&(e.push(l.i/t|0),e.push(n.i/t|0),e.push(u.i/t|0),zu(n),zu(n.next),n=i=u),n=n.next}while(n!==i);return Ua(n)}function Fb(i,e,t,n,l,u){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&$b(p,f)){var x=Wg(p,f);return p=Ua(p,p.next),x=Ua(x,x.next),Cu(p,e,t,n,l,u,0),void Cu(x,e,t,n,l,u,0)}f=f.next}p=p.next}while(p!==i)}function Ub(i,e){return i.x-e.x}function jb(i,e){var t=function(l,u){var p,f=u,x=l.x,v=l.y,S=-1/0;do{if(v<=f.y&&v>=f.next.y&&f.next.y!==f.y){var C=f.x+(v-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(C<=x&&C>S&&(S=C,p=f.x<f.next.x?f:f.next,C===x))return p}f=f.next}while(f!==u);if(!p)return null;var M,L=p,R=p.x,V=p.y,q=1/0;f=p;do x>=f.x&&f.x>=R&&x!==f.x&&Gl(v<V?x:S,v,R,V,v<V?S:x,v,f.x,f.y)&&(M=Math.abs(v-f.y)/(x-f.x),Mu(f,l)&&(M<q||M===q&&(f.x>p.x||f.x===p.x&&Nb(p,f)))&&(p=f,q=M)),f=f.next;while(f!==L);return p}(i,e);if(!t)return e;var n=Wg(t,i);return Ua(n,n.next),Ua(t,t.next)}function Nb(i,e){return pr(i.prev,i,e.prev)<0&&pr(e.next,i,i.next)<0}function Bf(i,e,t,n,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Vb(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Gl(i,e,t,n,l,u,p,f){return(l-p)*(e-f)>=(i-p)*(u-f)&&(i-p)*(n-f)>=(t-p)*(e-f)&&(t-p)*(u-f)>=(l-p)*(n-f)}function $b(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,n){var l=t;do{if(l.i!==t.i&&l.next.i!==t.i&&l.i!==n.i&&l.next.i!==n.i&&Zg(l,l.next,t,n))return!0;l=l.next}while(l!==t);return!1}(i,e)&&(Mu(i,e)&&Mu(e,i)&&function(t,n){var l=t,u=!1,p=(t.x+n.x)/2,f=(t.y+n.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&p<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==t);return u}(i,e)&&(pr(i.prev,i,e.prev)||pr(i,e.prev,e))||Md(i,e)&&pr(i.prev,i,i.next)>0&&pr(e.prev,e,e.next)>0)}function pr(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Md(i,e){return i.x===e.x&&i.y===e.y}function Zg(i,e,t,n){var l=Pd(pr(i,e,t)),u=Pd(pr(i,e,n)),p=Pd(pr(t,n,i)),f=Pd(pr(t,n,e));return l!==u&&p!==f||!(l!==0||!zd(i,t,e))||!(u!==0||!zd(i,n,e))||!(p!==0||!zd(t,i,n))||!(f!==0||!zd(t,e,n))}function zd(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function Pd(i){return i>0?1:i<0?-1:0}function Mu(i,e){return pr(i.prev,i,i.next)<0?pr(i,e,i.next)>=0&&pr(i,i.prev,e)>=0:pr(i,e,i.prev)<0||pr(i,i.next,e)<0}function Wg(i,e){var t=new Of(i.i,i.x,i.y),n=new Of(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=l,l.prev=t,n.next=t,t.prev=n,u.next=n,n.prev=u,n}function Xg(i,e,t,n){var l=new Of(i,e,t);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function zu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Of(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ff(i,e,t,n){for(var l=0,u=e,p=t-n;u<t;u+=n)l+=(i[p]-i[u])*(i[u+1]+i[p+1]),p=u;return l}function Gb(i,e,t,n,l){Hg(i,e,t||0,n||i.length-1,l||qb)}function Hg(i,e,t,n,l){for(;n>t;){if(n-t>600){var u=n-t+1,p=e-t+1,f=Math.log(u),x=.5*Math.exp(2*f/3),v=.5*Math.sqrt(f*x*(u-x)/u)*(p-u/2<0?-1:1);Hg(i,e,Math.max(t,Math.floor(e-p*x/u+v)),Math.min(n,Math.floor(e+(u-p)*x/u+v)),l)}var S=i[e],C=t,M=n;for(Pu(i,t,e),l(i[n],S)>0&&Pu(i,t,n);C<M;){for(Pu(i,C,M),C++,M--;l(i[C],S)<0;)C++;for(;l(i[M],S)>0;)M--}l(i[t],S)===0?Pu(i,t,M):Pu(i,++M,n),M<=e&&(t=M+1),e<=M&&(n=M-1)}}function Pu(i,e,t){var n=i[e];i[e]=i[t],i[t]=n}function qb(i,e){return i<e?-1:i>e?1:0}function Uf(i,e){const t=i.length;if(t<=1)return[i];const n=[];let l,u;for(let p=0;p<t;p++){const f=rn(i[p]);f!==0&&(i[p].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(l&&n.push(l),l=[i[p]]):l.push(i[p]))}if(l&&n.push(l),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(Gb(n[p],e,1,n[p].length-1,Zb),n[p]=n[p].slice(0,e));return n}function Zb(i,e){return e.area-i.area}function jf(i,e,t){const n=t.patternDependencies;let l=!1;for(const u of e){const p=u.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const f=p.constantOr(null);f&&(l=!0,n[f.to]=!0,n[f.from]=!0)}return l}function Nf(i,e,t,n,l){const u=l.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let x=f.evaluate({zoom:n-1},t,{},l.availableImages),v=f.evaluate({zoom:n},t,{},l.availableImages),S=f.evaluate({zoom:n+1},t,{},l.availableImages);x=x&&x.name?x.name:x,v=v&&v.name?v.name:v,S=S&&S.name?S.name:S,u[x]=!0,u[v]=!0,u[S]=!0,t.patterns[p.id]={min:x,mid:v,max:S}}}return t}Cd.deviation=function(i,e,t,n){var l=e&&e.length,u=Math.abs(Ff(i,0,l?e[0]*t:i.length,t));if(l)for(var p=0,f=e.length;p<f;p++)u-=Math.abs(Ff(i,e[p]*t,p<f-1?e[p+1]*t:i.length,t));var x=0;for(p=0;p<n.length;p+=3){var v=n[p]*t,S=n[p+1]*t,C=n[p+2]*t;x+=Math.abs((i[v]-i[C])*(i[S+1]-i[v+1])-(i[v]-i[S])*(i[C+1]-i[v+1]))}return u===0&&x===0?0:Math.abs((x-u)/u)},Cd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var p=0;p<e;p++)t.vertices.push(i[l][u][p]);l>0&&t.holes.push(n+=i[l-1].length)}return t},Id.default=Lb;class kd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ot,this.indexArray=new Qt,this.indexArray2=new $r,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new mr,this.segments2=new mr,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,n,l){this.hasPattern=jf("fill",this.layers,t);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:f,id:x,index:v,sourceLayerIndex:S}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Ra(f,C);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),M,n))continue;const L=u?u.evaluate(M,{},n,t.availableImages):void 0,R={id:x,properties:f.properties,type:f.type,sourceLayerIndex:S,index:v,geometry:C?M.geometry:Jo(f,n,l),patterns:{},sortKey:L};p.push(R)}u&&p.sort((f,x)=>f.sortKey-x.sortKey);for(const f of p){const{geometry:x,index:v,sourceLayerIndex:S}=f;if(this.hasPattern){const C=Nf("fill",this.layers,f,this.zoom,t);this.patternFeatures.push(C)}else this.addFeature(f,x,v,n,{},t.availableImages);t.featureIndex.insert(e[v].feature,x,v,S,this.index)}}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}addFeatures(e,t,n,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,t,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Db),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,l,u,p=[]){for(const f of Uf(t,500)){let x=0;for(const R of f)x+=R.length;const v=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),S=v.vertexLength,C=[],M=[];for(const R of f){if(R.length===0)continue;R!==f[0]&&M.push(C.length/2);const V=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),q=V.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(q+R.length-1,q),C.push(R[0].x),C.push(R[0].y);for(let Q=1;Q<R.length;Q++)this.layoutVertexArray.emplaceBack(R[Q].x,R[Q].y),this.indexArray2.emplaceBack(q+Q-1,q+Q),C.push(R[Q].x),C.push(R[Q].y);V.vertexLength+=R.length,V.primitiveLength+=R.length}const L=Id(C,M);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(S+L[R],S+L[R+1],S+L[R+2]);v.vertexLength+=x,v.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}}_t(kd,"FillBucket",{omit:["layers","patternFeatures"]});const Wb=new Le({"fill-sort-key":new xe(ke.layout_fill["fill-sort-key"])});var Xb={paint:new Le({"fill-antialias":new he(ke.paint_fill["fill-antialias"]),"fill-opacity":new xe(ke.paint_fill["fill-opacity"]),"fill-color":new xe(ke.paint_fill["fill-color"]),"fill-outline-color":new xe(ke.paint_fill["fill-outline-color"]),"fill-translate":new he(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new he(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Se(ke.paint_fill["fill-pattern"])}),layout:Wb};const Hb=Oe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Kb=Oe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Yb=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Jb}=Hb;var Kg=ql;function ql(i,e,t,n,l){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=l,i.readFields(Qb,this,e)}function Qb(i,e,t){i==1?e.id=t.readVarint():i==2?function(n,l){for(var u=n.readVarint()+n.pos;n.pos<u;){var p=l._keys[n.readVarint()],f=l._values[n.readVarint()];l.properties[p]=f}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function ew(i){for(var e,t,n=0,l=0,u=i.length,p=u-1;l<u;p=l++)n+=((t=i[p]).x-(e=i[l]).x)*(e.y+t.y);return n}ql.types=["Unknown","Point","LineString","Polygon"],ql.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,n=1,l=0,u=0,p=0,f=[];i.pos<t;){if(l<=0){var x=i.readVarint();n=7&x,l=x>>3}if(l--,n===1||n===2)u+=i.readSVarint(),p+=i.readSVarint(),n===1&&(e&&f.push(e),e=[]),e.push(new B(u,p));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&f.push(e),f},ql.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,n=0,l=0,u=0,p=1/0,f=-1/0,x=1/0,v=-1/0;i.pos<e;){if(n<=0){var S=i.readVarint();t=7&S,n=S>>3}if(n--,t===1||t===2)(l+=i.readSVarint())<p&&(p=l),l>f&&(f=l),(u+=i.readSVarint())<x&&(x=u),u>v&&(v=u);else if(t!==7)throw new Error("unknown command "+t)}return[p,x,f,v]},ql.prototype.toGeoJSON=function(i,e,t){var n,l,u=this.extent*Math.pow(2,t),p=this.extent*i,f=this.extent*e,x=this.loadGeometry(),v=ql.types[this.type];function S(L){for(var R=0;R<L.length;R++){var V=L[R];L[R]=[360*(V.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+f)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(n=0;n<x.length;n++)C[n]=x[n][0];S(x=C);break;case 2:for(n=0;n<x.length;n++)S(x[n]);break;case 3:for(x=function(L){var R=L.length;if(R<=1)return[L];for(var V,q,Q=[],le=0;le<R;le++){var ie=ew(L[le]);ie!==0&&(q===void 0&&(q=ie<0),q===ie<0?(V&&Q.push(V),V=[L[le]]):V.push(L[le]))}return V&&Q.push(V),Q}(x),n=0;n<x.length;n++)for(l=0;l<x[n].length;l++)S(x[n][l])}x.length===1?x=x[0]:v="Multi"+v;var M={type:"Feature",geometry:{type:v,coordinates:x},properties:this.properties};return"id"in this&&(M.id=this.id),M};var Yg=Jg;function Jg(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(tw,this,e),this.length=this._features.length}function tw(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(n){for(var l=null,u=n.readVarint()+n.pos;n.pos<u;){var p=n.readVarint()>>3;l=p===1?n.readString():p===2?n.readFloat():p===3?n.readDouble():p===4?n.readVarint64():p===5?n.readVarint():p===6?n.readSVarint():p===7?n.readBoolean():null}return l}(t))}function iw(i,e,t){if(i===3){var n=new Yg(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}Jg.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Kg(this._pbf,e,this.extent,this._keys,this._values)};var ja={VectorTile:function(i,e){this.layers=i.readFields(iw,{},e)},VectorTileFeature:Kg,VectorTileLayer:Yg};function Dd(i,e,t,n){const l=[],u=n===0?(p,f,x,v,S,C)=>{p.push(new B(C,x+(C-f)/(v-f)*(S-x)))}:(p,f,x,v,S,C)=>{p.push(new B(f+(C-x)/(S-x)*(v-f),C))};for(const p of i){const f=[];for(const x of p){if(x.length<=2)continue;const v=[];for(let M=0;M<x.length-1;M++){const L=x[M].x,R=x[M].y,V=x[M+1].x,q=x[M+1].y,Q=n===0?L:R,le=n===0?V:q;Q<e?le>e&&u(v,L,R,V,q,e):Q>t?le<t&&u(v,L,R,V,q,t):v.push(x[M]),le<e&&Q>=e&&u(v,L,R,V,q,e),le>t&&Q<=t&&u(v,L,R,V,q,t)}let S=x[x.length-1];const C=n===0?S.x:S.y;C>=e&&C<=t&&v.push(S),v.length&&(S=v[v.length-1],v[0].x===S.x&&v[0].y===S.y||v.push(v[0]),f.push(v))}f.length&&l.push(f)}return l}const rw=ja.VectorTileFeature.types,nw=Math.pow(2,13);function ku(i,e,t,n,l,u,p,f){i.emplaceBack((e<<1)+p,(t<<1)+u,(Math.floor(n*nw)<<1)+l,Math.round(f))}function Du(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Qg{constructor(){this.acc=new B(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new B(e.x,e.y),this.max=new B(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,l=this.max;e.x<n.x?n.x=e.x:e.x>l.x&&(l.x=e.x),e.y<n.y?n.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===jt)&&e.x===t.x)!=((e.y===0||e.y===jt)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,mi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>jt!=e.x>jt&&this.addBorderIntersection(1,mi(t.y,e.y,(jt-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,mi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>jt!=e.y>jt&&this.addBorderIntersection(3,mi(t.x,e.x,(jt-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((t,n)=>t+n.edges,0);return e!==0?this.acc.div(e)._round():new B(0,0)}span(){return new B(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Lu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Mt,this.centroidVertexArray=new cg,this.indexArray=new Qt,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,n,l){this.features=[],this.hasPattern=jf("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const p=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*p/(p*p+1)/jt/(1<<u.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:p,index:f,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,S=Ra(u,v);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),S,n))continue;const C={id:p,sourceLayerIndex:x,index:f,geometry:v?S.geometry:Jo(u,n,l),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(Nf("fill-extrusion",this.layers,C,this.zoom,t)):this.addFeature(C,C.geometry,f,n,{},t.availableImages,l),t.featureIndex.insert(u,C.geometry,f,x,this.index,M)}this.sortBorders()}addFeatures(e,t,n,l,u){for(const p of this.features){const{geometry:f}=p;this.addFeature(p,f,p.index,t,n,l,u)}this.sortBorders()}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Yb.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Kb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,l,u,p,f){const x=[new B(0,0),new B(jt,jt)],v=f.projection,S=v.name==="globe",C=this.enableTerrain&&!S?new Qg:null,M=rw[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Gr);const L=Uf(t,500);for(let Q=L.length-1;Q>=0;Q--){const le=L[Q];(le.length===0||(R=le[0]).every(ie=>ie.x<=0)||R.every(ie=>ie.x>=jt)||R.every(ie=>ie.y<=0)||R.every(ie=>ie.y>=jt))&&L.splice(Q,1)}var R;let V;if(S)V=sy(L,x,l);else{V=[];for(const Q of L)V.push({polygon:Q,bounds:x})}const q=M?this.edgeRadius:0;for(const{polygon:Q,bounds:le}of V){let ie=0,se=0;for(const ue of Q)M&&!ue[0].equals(ue[ue.length-1])&&ue.push(ue[0]),se+=M?ue.length-1:ue.length;const me=this.segments.prepareSegment((M?5:4)*se,this.layoutVertexArray,this.indexArray);if(M){const ue=[],Ce=[];ie=me.vertexLength;for(const De of Q){let et,Me;De.length&&De!==Q[0]&&Ce.push(ue.length/2),et=De[1].sub(De[0])._perp()._unit();for(let Re=1;Re<De.length;Re++){const Ne=De[Re],Be=De[Re===De.length-1?1:Re+1];let{x:Je,y:Ve}=Ne;if(q){Me=Be.sub(Ne)._perp()._unit();const ct=et.add(Me)._unit(),Wt=q*Math.min(4,1/(et.x*ct.x+et.y*ct.y));Je+=Wt*ct.x,Ve+=Wt*ct.y,et=Me}ku(this.layoutVertexArray,Je,Ve,0,0,1,1,0),me.vertexLength++,ue.push(Ne.x,Ne.y),S&&Du(this.layoutVertexExtArray,v.projectTilePoint(Je,Ve,l),v.upVector(l,Je,Ve))}}const Ae=Id(ue,Ce);for(let De=0;De<Ae.length;De+=3)this.indexArray.emplaceBack(ie+Ae[De],ie+Ae[De+2],ie+Ae[De+1]),me.primitiveLength++}for(const ue of Q){C&&ue.length&&C.startRing(ue[0]);let Ce,Ae,De,et=ue.length>4&&ry(ue[ue.length-2],ue[0],ue[1]),Me=q?ow(ue[ue.length-2],ue[0],ue[1],q):0;Ae=ue[1].sub(ue[0])._perp()._unit();for(let Re=1,Ne=0;Re<ue.length;Re++){let Be=ue[Re-1],Je=ue[Re];const Ve=ue[Re===ue.length-1?1:Re+1];if(C&&M&&C.currentPolyCount.top++,iy(Je,Be,le)){q&&(Ae=Ve.sub(Je)._perp()._unit());continue}C&&C.append(Je,Be);const ct=Je.sub(Be)._perp(),Wt=ct.x/(Math.abs(ct.x)+Math.abs(ct.y)),Ht=ct.y>0?1:0,Ct=Be.dist(Je);if(Ne+Ct>32768&&(Ne=0),q){De=Ve.sub(Je)._perp()._unit();let mt=ty(Be,Je,Ve,ey(Ae,De),q);isNaN(mt)&&(mt=0);const Ni=Je.sub(Be)._unit();Be=Be.add(Ni.mult(Me))._round(),Je=Je.add(Ni.mult(-mt))._round(),Me=mt,Ae=De}const nt=me.vertexLength,si=ue.length>4&&ry(Be,Je,Ve);let Vt=ny(Ne,et,!0);if(ku(this.layoutVertexArray,Be.x,Be.y,Wt,Ht,0,0,Vt),ku(this.layoutVertexArray,Be.x,Be.y,Wt,Ht,0,1,Vt),Ne+=Ct,Vt=ny(Ne,si,!1),et=si,ku(this.layoutVertexArray,Je.x,Je.y,Wt,Ht,0,0,Vt),ku(this.layoutVertexArray,Je.x,Je.y,Wt,Ht,0,1,Vt),me.vertexLength+=4,this.indexArray.emplaceBack(nt+0,nt+1,nt+2),this.indexArray.emplaceBack(nt+1,nt+3,nt+2),me.primitiveLength+=2,q){const mt=ie+(Re===1?ue.length-2:Re-2),Ni=Re===1?ie:mt+1;if(this.indexArray.emplaceBack(nt+1,mt,nt+3),this.indexArray.emplaceBack(mt,Ni,nt+3),me.primitiveLength+=2,Ce===void 0&&(Ce=nt),!iy(Ve,ue[Re],le)){const Li=Re===ue.length-1?Ce:me.vertexLength;this.indexArray.emplaceBack(nt+2,nt+3,Li),this.indexArray.emplaceBack(nt+3,Li+1,Li),this.indexArray.emplaceBack(nt+3,Ni,Li+1),me.primitiveLength+=3}}if(S){const mt=this.layoutVertexExtArray,Ni=v.projectTilePoint(Be.x,Be.y,l),Li=v.projectTilePoint(Je.x,Je.y,l),Hi=v.upVector(l,Be.x,Be.y),Kt=v.upVector(l,Je.x,Je.y);Du(mt,Ni,Hi),Du(mt,Ni,Hi),Du(mt,Li,Kt),Du(mt,Li,Kt)}}M&&(ie+=ue.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const Q=C.borders,le=this.featuresOnBorder.push(C)-1;for(let ie=0;ie<4;ie++)Q[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(le)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,t,n=!0){let l,u;if(e)if(e.y!==0){const f=t.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(f.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(f.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+n;let p=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const f of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*f.edges+f.top);for(let x=0;x<f.top;x++)this.centroidVertexArray.emplace(p++,l,u);for(let x=0;x<2*f.edges;x++)this.centroidVertexArray.emplace(p++,0,u),this.centroidVertexArray.emplace(p++,l,u)}}}function ey(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function ow(i,e,t,n){const l=e.sub(i)._perp()._unit(),u=t.sub(e)._perp()._unit();return ty(i,e,t,ey(l,u),n)}function ty(i,e,t,n,l){const u=Math.sqrt(1-n*n);return Math.min(i.dist(e)/3,e.dist(t)/3,l*u/n)}function iy(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function ry(i,e,t){if(i.x<0||i.x>=jt||e.x<0||e.x>=jt||t.x<0||t.x>=jt)return!1;const n=t.sub(e),l=n.perp(),u=i.sub(e);return(n.x*u.x+n.y*u.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function ny(i,e,t){const n=e?2|i:-3&i;return t?1|n:-2&n}function oy(){const i=Math.PI/32,e=Math.tan(i),t=_f;return t*Math.sqrt(1+2*e*e)-t}function sy(i,e,t){const n=1<<t.z,l=Vn(t.x/n),u=Vn((t.x+1)/n),p=Br(t.y/n),f=Br((t.y+1)/n);return function(x,v,S,C,M=0,L){const R=[];if(!x.length||!S||!C)return R;const V=(ue,Ce)=>{for(const Ae of ue)R.push({polygon:Ae,bounds:Ce})},q=Math.ceil(Math.log2(S)),Q=Math.ceil(Math.log2(C)),le=q-Q,ie=[];for(let ue=0;ue<Math.abs(le);ue++)ie.push(le>0?0:1);for(let ue=0;ue<Math.min(q,Q);ue++)ie.push(0),ie.push(1);let se=x;if(se=Dd(se,v[0].y-M,v[1].y+M,1),se=Dd(se,v[0].x-M,v[1].x+M,0),!se.length)return R;const me=[];for(ie.length?me.push({polygons:se,bounds:v,depth:0}):V(se,v);me.length;){const ue=me.pop(),Ce=ue.depth,Ae=ie[Ce],De=ue.bounds[0],et=ue.bounds[1],Me=Ae===0?De.x:De.y,Re=Ae===0?et.x:et.y,Ne=L?L(Ae,Me,Re):.5*(Me+Re),Be=Dd(ue.polygons,Me-M,Ne+M,Ae),Je=Dd(ue.polygons,Ne-M,Re+M,Ae);if(Be.length){const Ve=[De,new B(Ae===0?Ne:et.x,Ae===1?Ne:et.y)];ie.length>Ce+1?me.push({polygons:Be,bounds:Ve,depth:Ce+1}):V(Be,Ve)}if(Je.length){const Ve=[new B(Ae===0?Ne:De.x,Ae===1?Ne:De.y),et];ie.length>Ce+1?me.push({polygons:Je,bounds:Ve,depth:Ce+1}):V(Je,Ve)}}return R}(i,e,Math.ceil((u-l)/11.25),Math.ceil((p-f)/11.25),1,(x,v,S)=>{if(x===0)return .5*(v+S);{const C=Br((t.y+v/jt)/n);return(Yo(.5*(Br((t.y+S/jt)/n)+C))*n-t.y)*jt}})}_t(Lu,"FillExtrusionBucket",{omit:["layers","features"]}),_t(Qg,"PartMetadata");const sw=new Le({"fill-extrusion-edge-radius":new he(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var aw={paint:new Le({"fill-extrusion-opacity":new he(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xe(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Se(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xe(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xe(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:sw};function ay(i,e,t){var n=2*Math.PI*6378137/256/Math.pow(2,t);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Ld{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Ru(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=function(u,p,f){var x=ay(256*u,256*(p=Math.pow(2,f)-p-1),f),v=ay(256*(u+1),256*(p+1),f);return x[0]+","+x[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),l=function(u,p,f){let x,v="";for(let S=u;S>0;S--)x=1<<S-1,v+=(p&x?1:0)+(f&x?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ly{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Ru(e,t.z,t.z,t.x,t.y)}}class Jr{constructor(e,t,n,l,u){this.overscaledZ=e,this.wrap=t,this.canonical=new Ld(n,+l,+u),this.key=t===0&&e===n?this.canonical.key:Ru(t,e,n,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Jr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jr(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Ru(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Ru(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Jr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,l=2*this.canonical.y;return[new Jr(t,this.wrap,t,n,l),new Jr(t,this.wrap,t,n+1,l),new Jr(t,this.wrap,t,n,l+1),new Jr(t,this.wrap,t,n+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ly(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ru(i,e,t,n,l){const u=1<<Math.min(t,22);let p=u*(l%u)+n%u;return i&&t<22&&(p+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*p+t)+(e-t)}function Bu(i,e){return i.x*e.x+i.y*e.y}function cy(i,e){if(i.length===1){let t=0;const n=e[t++];let l;for(;!l||n.equals(l);)if(l=e[t++],!l)return 1/0;for(;t<e.length;t++){const u=e[t],p=i[0],f=l.sub(n),x=u.sub(n),v=p.sub(n),S=Bu(f,f),C=Bu(f,x),M=Bu(x,x),L=Bu(v,f),R=Bu(v,x),V=S*M-C*C,q=(M*L-C*R)/V,Q=(S*R-C*L)/V,le=n.z*(1-q-Q)+l.z*q+u.z*Q;if(isFinite(le))return le}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function Rd(i){const e=new B(i[0],i[1]);return e.z=i[2],e}function uy(i,e,t,n,l,u,p,f){const x=p*l.getElevationAt(i,e,!0,!0),v=u[0]!==0,S=v?u[1]===0?p*(u[0]/7-450):p*function(C,M,L){const R=Math.floor(M[0]/8),V=Math.floor(M[1]/8),q=10*(M[0]-8*R),Q=10*(M[1]-8*V),le=C.getElevationAt(R,V,!0,!0),ie=C.getMeterToDEM(L),se=Math.floor(.5*(q*ie-1)),me=Math.floor(.5*(Q*ie-1)),ue=C.tileCoordToPixel(R,V),Ce=2*se+1,Ae=2*me+1,De=function(Je,Ve,ct,Wt,Ht){return[Je.getElevationAtPixel(Ve,ct,!0),Je.getElevationAtPixel(Ve+Ht,ct,!0),Je.getElevationAtPixel(Ve,ct+Ht,!0),Je.getElevationAtPixel(Ve+Wt,ct+Ht,!0)]}(C,ue.x-se,ue.y-me,Ce,Ae),et=Math.abs(De[0]-De[1]),Me=Math.abs(De[2]-De[3]),Re=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),Ne=Math.min(.25,.5*ie*(et+Me)/Ce),Be=Math.min(.25,.5*ie*Re/Ae);return le+Math.max(Ne*q,Be*Q)}(l,u,f):x;return{base:x+(t===0)?-1:t,top:v?Math.max(S+n,x+t+2):x+n}}_t(Ld,"CanonicalTileID"),_t(Jr,"OverscaledTileID",{omit:["projMatrix"]});const lw=Oe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:cw}=lw,uw=Oe([{name:"a_packed",components:4,type:"Float32"}]),{members:hw}=uw,dw=ja.VectorTileFeature.types,pw=Math.cos(Math.PI/180*37.5);class Bd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Nt,this.layoutVertexArray2=new oi,this.indexArray=new Qt,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new mr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,l){this.hasPattern=jf("line",this.layers,t);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:S,id:C,index:M,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,V=Ra(S,R);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),V,n))continue;const q=u?u.evaluate(V,{},n):void 0,Q={id:C,properties:S.properties,type:S.type,sourceLayerIndex:L,index:M,geometry:R?V.geometry:Jo(S,n,l),patterns:{},sortKey:q};p.push(Q)}u&&p.sort((S,C)=>S.sortKey-C.sortKey);const{lineAtlas:f,featureIndex:x}=t,v=this.addConstantDashes(f);for(const S of p){const{geometry:C,index:M,sourceLayerIndex:L}=S;if(v&&this.addFeatureDashes(S,f),this.hasPattern){const R=Nf("line",this.layers,S,this.zoom,t);this.patternFeatures.push(R)}else this.addFeature(S,C,M,n,f.positions,t.availableImages);x.insert(e[M].feature,C,M,L,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const l=n.paint.get("line-dasharray").value,u=n.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")t=!0;else{const p=u.value,f=l.value;if(!f)continue;e.addDash(f.from,p),e.addDash(f.to,p),f.other&&e.addDash(f.other,p)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let f,x,v,S,C,M;if(u.kind==="constant"){const q=u.value;if(!q)continue;f=q.other||q.to,x=q.to,v=q.from}else f=u.evaluate({zoom:n-1},e),x=u.evaluate({zoom:n},e),v=u.evaluate({zoom:n+1},e);p.kind==="constant"?S=C=M=p.value:(S=p.evaluate({zoom:n-1},e),C=p.evaluate({zoom:n},e),M=p.evaluate({zoom:n+1},e)),t.addDash(f,S),t.addDash(x,C),t.addDash(v,M);const L=t.getKey(f,S),R=t.getKey(x,C),V=t.getKey(v,M);e.patterns[l.id]={min:L,mid:R,max:V}}}update(e,t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,l)}addFeatures(e,t,n,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,t,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,hw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,l,u,p){const f=this.layers[0].layout,x=f.get("line-join").evaluate(e,{}),v=f.get("line-cap").evaluate(e,{}),S=f.get("line-miter-limit"),C=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of t)this.addLine(M,e,x,v,S,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}addLine(e,t,n,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=dw[t.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let v=0;for(;v<x-1&&e[v].equals(e[v+1]);)v++;if(x<(f?3:2))return;n==="bevel"&&(u=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,L,R,V,q;this.e1=this.e2=-1,f&&(M=e[x-2],q=e[v].sub(M)._unit()._perp());for(let Q=v;Q<x;Q++){if(R=Q===x-1?f?e[v+1]:void 0:e[Q+1],R&&e[Q].equals(R))continue;q&&(V=q),M&&(L=M),M=e[Q],q=R?R.sub(M)._unit()._perp():V,V=V||q;let le=V.add(q);le.x===0&&le.y===0||le._unit();const ie=V.x*q.x+V.y*q.y,se=le.x*q.x+le.y*q.y,me=se!==0?1/se:1/0,ue=2*Math.sqrt(2-2*se),Ce=se<pw&&L&&R,Ae=V.x*q.y-V.y*q.x>0;if(Ce&&Q>v){const Me=M.dist(L);if(Me>2*S){const Re=M.sub(M.sub(L)._mult(S/Me)._round());this.updateDistance(L,Re),this.addCurrentVertex(Re,V,0,0,C),L=Re}}const De=L&&R;let et=De?n:f?"butt":l;if(De&&et==="round"&&(me<p?et="miter":me<=2&&(et="fakeround")),et==="miter"&&me>u&&(et="bevel"),et==="bevel"&&(me>2&&(et="flipbevel"),me<u&&(et="miter")),L&&this.updateDistance(L,M),et==="miter")le._mult(me),this.addCurrentVertex(M,le,0,0,C);else if(et==="flipbevel"){if(me>100)le=q.mult(-1);else{const Me=me*V.add(q).mag()/V.sub(q).mag();le._perp()._mult(Me*(Ae?-1:1))}this.addCurrentVertex(M,le,0,0,C),this.addCurrentVertex(M,le.mult(-1),0,0,C)}else if(et==="bevel"||et==="fakeround"){const Me=-Math.sqrt(me*me-1),Re=Ae?Me:0,Ne=Ae?0:Me;if(L&&this.addCurrentVertex(M,V,Re,Ne,C),et==="fakeround"){const Be=Math.round(180*ue/Math.PI/20);for(let Je=1;Je<Be;Je++){let Ve=Je/Be;if(Ve!==.5){const Wt=Ve-.5;Ve+=Ve*Wt*(Ve-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Wt*Wt+(.848013+ie*(.215638*ie-1.06021)))}const ct=q.sub(V)._mult(Ve)._add(V)._unit()._mult(Ae?-1:1);this.addHalfVertex(M,ct.x,ct.y,!1,Ae,0,C)}}R&&this.addCurrentVertex(M,q,-Re,-Ne,C)}else if(et==="butt")this.addCurrentVertex(M,le,0,0,C);else if(et==="square"){const Me=L?1:-1;L||this.addCurrentVertex(M,le,Me,Me,C),this.addCurrentVertex(M,le,0,0,C),L&&this.addCurrentVertex(M,le,Me,Me,C)}else et==="round"&&(L&&(this.addCurrentVertex(M,V,0,0,C),this.addCurrentVertex(M,V,1,1,C,!0)),R&&(this.addCurrentVertex(M,q,-1,-1,C,!0),this.addCurrentVertex(M,q,0,0,C)));if(Ce&&Q<x-1){const Me=M.dist(R);if(Me>2*S){const Re=M.add(R.sub(M)._mult(S/Me)._round());this.updateDistance(M,Re),this.addCurrentVertex(Re,q,0,0,C),M=Re}}}}addCurrentVertex(e,t,n,l,u,p=!1){const f=t.y*l-t.x,x=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,p,!1,n,u),this.addHalfVertex(e,f,x,p,!0,-l,u)}addHalfVertex({x:e,y:t},n,l,u,p,f,x){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(t<<1)+(p?1:0),Math.round(63*n)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),x.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}_t(Bd,"LineBucket",{omit:["layers","patternFeatures"]});const fw=new Le({"line-cap":new xe(ke.layout_line["line-cap"]),"line-join":new xe(ke.layout_line["line-join"]),"line-miter-limit":new he(ke.layout_line["line-miter-limit"]),"line-round-limit":new he(ke.layout_line["line-round-limit"]),"line-sort-key":new xe(ke.layout_line["line-sort-key"])});var hy={paint:new Le({"line-opacity":new xe(ke.paint_line["line-opacity"]),"line-color":new xe(ke.paint_line["line-color"]),"line-translate":new he(ke.paint_line["line-translate"]),"line-translate-anchor":new he(ke.paint_line["line-translate-anchor"]),"line-width":new xe(ke.paint_line["line-width"]),"line-gap-width":new xe(ke.paint_line["line-gap-width"]),"line-offset":new xe(ke.paint_line["line-offset"]),"line-blur":new xe(ke.paint_line["line-blur"]),"line-dasharray":new Se(ke.paint_line["line-dasharray"]),"line-pattern":new Se(ke.paint_line["line-pattern"]),"line-gradient":new we(ke.paint_line["line-gradient"]),"line-trim-offset":new he(ke.paint_line["line-trim-offset"])}),layout:fw};const dy=new class extends xe{possiblyEvaluate(i,e){return e=new X(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,n){return e=gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,n)}}(hy.paint.properties["line-width"].specification);function py(i,e){return e>0?e+2*i:i}dy.useIntegerZoom=!0;const mw=Oe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_w=Oe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gw=Oe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Oe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yw=Oe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),xw=Oe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fy=Oe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vw=Oe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oe([{name:"triangle",components:3,type:"Uint16"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oe([{type:"Float32",name:"offsetX"}]),Oe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Or=24;const Io=128;function Vf(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new X(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:l}=t;let u=0;for(;u<n.length&&n[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<n.length&&n[p]<i+1;)p++;p=Math.min(n.length-1,p);const f=n[u],x=n[p];return t.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:x,minSize:t.evaluate(new X(f)),maxSize:t.evaluate(new X(x)),interpolationType:l}}}function Od(i,{uSize:e,uSizeT:t},{lowerSize:n,upperSize:l}){return i.kind==="source"?n/Io:i.kind==="composite"?mi(n/Io,l/Io,t):e}function Zl(i,e){let t=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:p}=i,f=l?He(jn.interpolationFactor(l,e,u,p),0,1):0;i.kind==="camera"?n=mi(i.minSize,i.maxSize,f):t=f}return{uSizeT:t,uSize:n}}var bw=Object.freeze({__proto__:null,getSizeData:Vf,evaluateSizeForFeature:Od,evaluateSizeForZoom:Zl,SIZE_PACK_FACTOR:Io});function ww(i,e,t){return i.sections.forEach(n=>{n.text=function(l,u,p){const f=u.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),W.applyArabicShaping&&(l=W.applyArabicShaping(l)),l}(n.text,e,t)}),i}const Ou={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Tw(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Ew(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var my=function(i,e,t,n,l){var u,p,f=8*l-n-1,x=(1<<f)-1,v=x>>1,S=-7,C=t?l-1:0,M=t?-1:1,L=i[e+C];for(C+=M,u=L&(1<<-S)-1,L>>=-S,S+=f;S>0;u=256*u+i[e+C],C+=M,S-=8);for(p=u&(1<<-S)-1,u>>=-S,S+=n;S>0;p=256*p+i[e+C],C+=M,S-=8);if(u===0)u=1-v;else{if(u===x)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,n),u-=v}return(L?-1:1)*p*Math.pow(2,u-n)},_y=function(i,e,t,n,l,u){var p,f,x,v=8*u-l-1,S=(1<<v)-1,C=S>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=n?0:u-1,R=n?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=S):(p=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-p))<1&&(p--,x*=2),(e+=p+C>=1?M/x:M*Math.pow(2,1-C))*x>=2&&(p++,x/=2),p+C>=S?(f=0,p=S):p+C>=1?(f=(e*x-1)*Math.pow(2,l),p+=C):(f=e*Math.pow(2,C-1)*Math.pow(2,l),p=0));l>=8;i[t+L]=255&f,L+=R,f/=256,l-=8);for(p=p<<l|f,v+=l;v>0;i[t+L]=255&p,L+=R,p/=256,v-=8);i[t+L-R]|=128*V},Fu=ji;function ji(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ji.Varint=0,ji.Fixed64=1,ji.Bytes=2,ji.Fixed32=5;var $f=4294967296,gy=1/$f,yy=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function es(i){return i.type===ji.Bytes?i.readVarint()+i.pos:i.pos+1}function Wl(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function xy(i,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(n);for(var l=t.pos-1;l>=i;l--)t.buf[l+n]=t.buf[l]}function Sw(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function Aw(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function Iw(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function Cw(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function Mw(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function zw(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function Pw(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function kw(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function Dw(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Fd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Xl(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function vy(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Lw(i,e,t){e.glyphs=[],i===1&&t.readMessage(Rw,e)}function Rw(i,e,t){if(i===3){const{id:n,bitmap:l,width:u,height:p,left:f,top:x,advance:v}=t.readMessage(Bw,{});e.glyphs.push({id:n,bitmap:new Qo({width:u+6,height:p+6},l),metrics:{width:u,height:p,left:f,top:x,advance:v}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function Bw(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function Gf(i){let e=0,t=0;for(const p of i)e+=p.w*p.h,t=Math.max(t,p.w);i.sort((p,f)=>f.h-p.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let l=0,u=0;for(const p of i)for(let f=n.length-1;f>=0;f--){const x=n[f];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===x.w&&p.h===x.h){const v=n.pop();f<n.length&&(n[f]=v)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(n.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}ji.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),l=n>>3,u=this.pos;this.type=7&n,i(l,e,this),this.pos===u&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Fd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=vy(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Fd(this.buf,this.pos)+Fd(this.buf,this.pos+4)*$f;return this.pos+=8,i},readSFixed64:function(){var i=Fd(this.buf,this.pos)+vy(this.buf,this.pos+4)*$f;return this.pos+=8,i},readFloat:function(){var i=my(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=my(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,n=this.buf;return e=127&(t=n[this.pos++]),t<128?e:(e|=(127&(t=n[this.pos++]))<<7,t<128?e:(e|=(127&(t=n[this.pos++]))<<14,t<128?e:(e|=(127&(t=n[this.pos++]))<<21,t<128?e:function(l,u,p){var f,x,v=p.buf;if(f=(112&(x=v[p.pos++]))>>4,x<128||(f|=(127&(x=v[p.pos++]))<<3,x<128)||(f|=(127&(x=v[p.pos++]))<<10,x<128)||(f|=(127&(x=v[p.pos++]))<<17,x<128)||(f|=(127&(x=v[p.pos++]))<<24,x<128)||(f|=(1&(x=v[p.pos++]))<<31,x<128))return Wl(l,f,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&yy?function(t,n,l){return yy.decode(t.subarray(n,l))}(this.buf,e,i):function(t,n,l){for(var u="",p=n;p<l;){var f,x,v,S=t[p],C=null,M=S>239?4:S>223?3:S>191?2:1;if(p+M>l)break;M===1?S<128&&(C=S):M===2?(192&(f=t[p+1]))==128&&(C=(31&S)<<6|63&f)<=127&&(C=null):M===3?(x=t[p+2],(192&(f=t[p+1]))==128&&(192&x)==128&&((C=(15&S)<<12|(63&f)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(x=t[p+2],v=t[p+3],(192&(f=t[p+1]))==128&&(192&x)==128&&(192&v)==128&&((C=(15&S)<<18|(63&f)<<12|(63&x)<<6|63&v)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),p+=M}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==ji.Bytes)return i.push(this.readVarint(e));var t=es(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==ji.Bytes)return i.push(this.readSVarint());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ji.Bytes)return i.push(this.readBoolean());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ji.Bytes)return i.push(this.readFloat());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ji.Bytes)return i.push(this.readDouble());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ji.Bytes)return i.push(this.readFixed32());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ji.Bytes)return i.push(this.readSFixed32());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ji.Bytes)return i.push(this.readFixed64());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ji.Bytes)return i.push(this.readSFixed64());var e=es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===ji.Varint)for(;this.buf[this.pos++]>127;);else if(e===ji.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ji.Fixed32)this.pos+=4;else{if(e!==ji.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Xl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Xl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Xl(this.buf,-1&i,this.pos),Xl(this.buf,Math.floor(i*gy),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Xl(this.buf,-1&i,this.pos),Xl(this.buf,Math.floor(i*gy),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var n,l;if(e>=0?(n=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(u,p,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)}(n,0,t),function(u,p){var f=(7&u)<<4;p.buf[p.pos++]|=f|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,l,u){for(var p,f,x=0;x<l.length;x++){if((p=l.charCodeAt(x))>55295&&p<57344){if(!f){p>56319||x+1===l.length?(n[u++]=239,n[u++]=191,n[u++]=189):f=p;continue}if(p<56320){n[u++]=239,n[u++]=191,n[u++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(n[u++]=239,n[u++]=191,n[u++]=189,f=null);p<128?n[u++]=p:(p<2048?n[u++]=p>>6|192:(p<65536?n[u++]=p>>12|224:(n[u++]=p>>18|240,n[u++]=p>>12&63|128),n[u++]=p>>6&63|128),n[u++]=63&p|128)}return u}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&xy(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),_y(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),_y(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var n=this.pos-t;n>=128&&xy(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,t){this.writeTag(i,ji.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Sw,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Aw,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Mw,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Iw,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Cw,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,zw,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Pw,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,kw,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Dw,e)},writeBytesField:function(i,e){this.writeTag(i,ji.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,ji.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,ji.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,ji.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,ji.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,ji.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,ji.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,ji.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,ji.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,ji.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class qf{constructor(e,{pixelRatio:t,version:n,stretchX:l,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=l,this.stretchY=u,this.content=p,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class by{constructor(e,t){const n={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,n,u),this.addImages(t,l,u);const{w:p,h:f}=Gf(u),x=new _n({width:p||1,height:f||1});for(const v in e){const S=e[v],C=n[v].paddedRect;_n.copy(S.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},S.data)}for(const v in t){const S=t[v],C=l[v].paddedRect,M=C.x+1,L=C.y+1,R=S.data.width,V=S.data.height;_n.copy(S.data,x,{x:0,y:0},{x:M,y:L},S.data),_n.copy(S.data,x,{x:0,y:V-1},{x:M,y:L-1},{width:R,height:1}),_n.copy(S.data,x,{x:0,y:0},{x:M,y:L+V},{width:R,height:1}),_n.copy(S.data,x,{x:R-1,y:0},{x:M-1,y:L},{width:1,height:V}),_n.copy(S.data,x,{x:0,y:0},{x:M+R,y:L},{width:1,height:V})}this.image=x,this.iconPositions=n,this.patternPositions=l}addImages(e,t,n){for(const l in e){const u=e[l],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};n.push(p),t[l]=new qf(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;const[l,u]=e.tl;n.update(t.data,void 0,{x:l,y:u})}}_t(qf,"ImagePosition"),_t(by,"ImageAtlas");const Pn={horizontal:1,vertical:2,horizontalOnly:3};class Uu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Uu;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Uu;return t.imageName=e,t}}class Hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Hl;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?n.addImageSection(u):n.addTextSection(u,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,n){let l="";for(let u=0;u<t.length;u++){const p=t.charCodeAt(u+1)||null,f=t.charCodeAt(u-1)||null;l+=!n&&(p&&ka(p)&&!Ou[t[u+1]]||f&&ka(f)&&!Ou[t[u-1]])||!Ou[t[u]]?t[u]:Ou[t[u]]}return l}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Ud[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Ud[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Hl;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Uu.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void bi("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Uu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zf(i,e,t,n,l,u,p,f,x,v,S,C,M,L,R,V){const q=Hl.fromFeature(i,l);let Q;C===Pn.vertical&&q.verticalizePunctuation(M);const{processBidirectionalText:le,processStyledBidirectionalText:ie}=W;if(le&&q.sections.length===1){Q=[];const ue=le(q.toString(),Wf(q,v,u,e,n,L,R));for(const Ce of ue){const Ae=new Hl;Ae.text=Ce,Ae.sections=q.sections;for(let De=0;De<Ce.length;De++)Ae.sectionIndex.push(0);Q.push(Ae)}}else if(ie){Q=[];const ue=ie(q.text,q.sectionIndex,Wf(q,v,u,e,n,L,R));for(const Ce of ue){const Ae=new Hl;Ae.text=Ce[0],Ae.sectionIndex=Ce[1],Ae.sections=q.sections,Q.push(Ae)}}else Q=function(ue,Ce){const Ae=[],De=ue.text;let et=0;for(const Me of Ce)Ae.push(ue.substring(et,Me)),et=Me;return et<De.length&&Ae.push(ue.substring(et,De.length)),Ae}(q,Wf(q,v,u,e,n,L,R));const se=[],me={positionedLines:se,text:q.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,Ce,Ae,De,et,Me,Re,Ne,Be,Je,Ve,ct){let Wt=0,Ht=0,Ct=0;const nt=Ne==="right"?1:Ne==="left"?0:.5;let si=!1;for(const Kt of et){const gi=Kt.getSections();for(const Vi of gi){if(Vi.imageName)continue;const Ri=Ce[Vi.fontStack];if(Ri&&(si=Ri.ascender!==void 0&&Ri.descender!==void 0,!si))break}if(!si)break}let Vt=0;for(const Kt of et){Kt.trim();const gi=Kt.getMaxScale(),Vi=(gi-1)*Or,Ri={positionedGlyphs:[],lineOffset:0};ue.positionedLines[Vt]=Ri;const Pi=Ri.positionedGlyphs;let Wi=0;if(!Kt.length()){Ht+=Me,++Vt;continue}let Ji=0,Ir=0;for(let ci=0;ci<Kt.length();ci++){const sr=Kt.getSection(ci),qr=Kt.getSectionIndex(ci),Ti=Kt.getCharCode(ci);let Qi=sr.scale,Qr=null,Ki=null,ur=null,Cr=Or,vr=0;const Fr=!(Be===Pn.horizontal||!Ve&&!Fl(Ti)||Ve&&(Ud[Ti]||(mt=Ti,od(mt)||sd(mt)||ad(mt)||Pa(mt)||bu(mt))));if(sr.imageName){const en=De[sr.imageName];if(!en)continue;ur=sr.imageName,ue.iconsInText=ue.iconsInText||!0,Ki=en.paddedRect;const Mr=en.displaySize;Qi=Qi*Or/ct,Qr={width:Mr[0],height:Mr[1],left:1,top:-3,advance:Fr?Mr[1]:Mr[0],localGlyph:!1},vr=si?-Qr.height*Qi:gi*Or-17-Mr[1]*Qi,Cr=Qr.advance;const rs=(Fr?Mr[0]:Mr[1])*Qi-Or*gi;rs>0&&rs>Wi&&(Wi=rs)}else{const en=Ae[sr.fontStack];if(!en)continue;en[Ti]&&(Ki=en[Ti]);const Mr=Ce[sr.fontStack];if(!Mr)continue;const rs=Mr.glyphs[Ti];if(!rs)continue;if(Qr=rs.metrics,Cr=Ti!==8203?Or:0,si){const ic=Mr.ascender!==void 0?Math.abs(Mr.ascender):0,Yu=Mr.descender!==void 0?Math.abs(Mr.descender):0,Ju=(ic+Yu)*Qi;Ji<Ju&&(Ji=Ju,Ir=(ic-Yu)/2*Qi),vr=-ic*Qi}else vr=(gi-Qi)*Or-17}Fr?(ue.verticalizable=!0,Pi.push({glyph:Ti,imageName:ur,x:Wt,y:Ht+vr,vertical:Fr,scale:Qi,localGlyph:Qr.localGlyph,fontStack:sr.fontStack,sectionIndex:qr,metrics:Qr,rect:Ki}),Wt+=Cr*Qi+Je):(Pi.push({glyph:Ti,imageName:ur,x:Wt,y:Ht+vr,vertical:Fr,scale:Qi,localGlyph:Qr.localGlyph,fontStack:sr.fontStack,sectionIndex:qr,metrics:Qr,rect:Ki}),Wt+=Qr.advance*Qi+Je)}Pi.length!==0&&(Ct=Math.max(Wt-Je,Ct),si?Ay(Pi,nt,Wi,Ir,Me*gi/2):Ay(Pi,nt,Wi,0,Me/2)),Wt=0;const ln=Me*gi+Wi;Ri.lineOffset=Math.max(Wi,Vi),Ht+=ln,++Vt}var mt;const Ni=Ht,{horizontalAlign:Li,verticalAlign:Hi}=Xf(Re);(function(Kt,gi,Vi,Ri,Pi,Wi){const Ji=(gi-Vi)*Pi,Ir=-Wi*Ri;for(const ln of Kt)for(const ci of ln.positionedGlyphs)ci.x+=Ji,ci.y+=Ir})(ue.positionedLines,nt,Li,Hi,Ct,Ni),ue.top+=-Hi*Ni,ue.bottom=ue.top+Ni,ue.left+=-Li*Ct,ue.right=ue.left+Ct,ue.hasBaseline=si}(me,e,t,n,Q,p,f,x,C,v,M,V),!function(ue){for(const Ce of ue)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(se)&&me}const Ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ow={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wy(i,e,t,n,l,u){if(e.imageName){const p=n[e.imageName];return p?p.displaySize[0]*e.scale*Or/u+l:0}{const p=t[e.fontStack],f=p&&p.glyphs[i];return f?f.metrics.advance*e.scale+l:0}}function Ty(i,e,t,n){const l=Math.pow(i-e,2);return n?i<e?l/2:2*l:l+Math.abs(t)*t}function Fw(i,e,t){let n=0;return i===10&&(n-=1e4),t&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Ey(i,e,t,n,l,u){let p=null,f=Ty(e,t,l,u);for(const x of n){const v=Ty(e-x.x,t,l,u)+x.badness;v<=f&&(p=x,f=v)}return{index:i,x:e,priorBreak:p,badness:f}}function Sy(i){return i?Sy(i.priorBreak).concat(i.index):[]}function Wf(i,e,t,n,l,u,p){if(u!=="point")return[];if(!i)return[];const f=[],x=function(M,L,R,V,q,Q){let le=0;for(let ie=0;ie<M.length();ie++){const se=M.getSection(ie);le+=wy(M.getCharCode(ie),se,V,q,L,Q)}return le/Math.max(1,Math.ceil(le/R))}(i,e,t,n,l,p),v=i.text.indexOf("\u200B")>=0;let S=0;for(let M=0;M<i.length();M++){const L=i.getSection(M),R=i.getCharCode(M);if(Ud[R]||(S+=wy(R,L,n,l,e,p)),M<i.length()-1){const V=!((C=R)<11904||!(mu(C)||ud(C)||vu(C)||fd(C)||yu(C)||ld(C)||hd(C)||Rl(C)||xu(C)||za(C)||gu(C)||wu(C)||fu(C)||Ma(C)||cd(C)||_u(C)||$o(C)||md(C)||dd(C)||Bl(C)));(Ow[R]||V||L.imageName)&&f.push(Ey(M+1,S,x,f,Fw(R,i.getCharCode(M+1),V&&v),!1))}}var C;return Sy(Ey(i.length(),S,x,f,0,!0))}function Xf(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function Ay(i,e,t,n,l){if(!(e||t||n||l))return;const u=i.length-1,p=i[u],f=(p.x+p.metrics.advance*p.scale)*e;for(let x=0;x<=u;x++)i[x].x-=f,i[x].y+=t+n+l}function Uw(i,e,t){const{horizontalAlign:n,verticalAlign:l}=Xf(t),u=e[0]-i.displaySize[0]*n,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function Iy(i,e,t,n,l,u){const p=i.image;let f;if(p.content){const q=p.content,Q=p.pixelRatio||1;f=[q[0]/Q,q[1]/Q,p.displaySize[0]-q[2]/Q,p.displaySize[1]-q[3]/Q]}const x=e.left*u,v=e.right*u;let S,C,M,L;t==="width"||t==="both"?(L=l[0]+x-n[3],C=l[0]+v+n[1]):(L=l[0]+(x+v-p.displaySize[0])/2,C=L+p.displaySize[0]);const R=e.top*u,V=e.bottom*u;return t==="height"||t==="both"?(S=l[1]+R-n[0],M=l[1]+V+n[2]):(S=l[1]+(R+V-p.displaySize[1])/2,M=S+p.displaySize[1]),{image:p,top:S,right:C,bottom:M,left:L,collisionPadding:f}}class ts extends B{constructor(e,t,n,l,u){super(e,t),this.angle=l,this.z=n,u!==void 0&&(this.segment=u)}clone(){return new ts(this.x,this.y,this.z,this.angle,this.segment)}}function Cy(i,e,t,n,l){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,f=0;for(;f>-t/2;){if(p--,p<0)return!1;f-=i[p].dist(u),u=i[p]}f+=i[p].dist(i[p+1]),p++;const x=[];let v=0;for(;f<t/2;){const S=i[p],C=i[p+1];if(!C)return!1;let M=i[p-1].angleTo(S)-S.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:f,angleDelta:M}),v+=M;f-x[0].distance>n;)v-=x.shift().angleDelta;if(v>l)return!1;p++,f+=S.dist(C)}return!0}function My(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function zy(i,e,t){return i?.6*e*t:0}function Py(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function jw(i,e,t,n,l,u){const p=zy(t,l,u),f=Py(t,n)*u;let x=0;const v=My(i)/2;for(let S=0;S<i.length-1;S++){const C=i[S],M=i[S+1],L=C.dist(M);if(x+L>v){const R=(v-x)/L,V=mi(C.x,M.x,R),q=mi(C.y,M.y,R),Q=new ts(V,q,0,M.angleTo(C),S);return!p||Cy(i,Q,f,p,e)?Q:void 0}x+=L}}function Nw(i,e,t,n,l,u,p,f,x){const v=zy(n,u,p),S=Py(n,l),C=S*p,M=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return e-C<e/4&&(e=C+e/4),ky(i,M?e/2*f%e:(S/2+2*u)*p*f%e,e,v,t,C,M,!1,x)}function ky(i,e,t,n,l,u,p,f,x){const v=u/2,S=My(i);let C=0,M=e-t,L=[];for(let R=0;R<i.length-1;R++){const V=i[R],q=i[R+1],Q=V.dist(q),le=q.angleTo(V);for(;M+t<C+Q;){M+=t;const ie=(M-C)/Q,se=mi(V.x,q.x,ie),me=mi(V.y,q.y,ie);if(se>=0&&se<x&&me>=0&&me<x&&M-v>=0&&M+v<=S){const ue=new ts(se,me,0,le,R);ue._round(),n&&!Cy(i,ue,u,n,l)||L.push(ue)}}C+=Q}return f||L.length||p||(L=ky(i,C/2,t,n,l,u,p,!0,x)),L}function Dy(i,e,t,n,l){const u=[];for(let p=0;p<i.length;p++){const f=i[p];let x;for(let v=0;v<f.length-1;v++){let S=f[v],C=f[v+1];S.x<e&&C.x<e||(S.x<e?S=new B(e,S.y+(e-S.x)/(C.x-S.x)*(C.y-S.y))._round():C.x<e&&(C=new B(e,S.y+(e-S.x)/(C.x-S.x)*(C.y-S.y))._round()),S.y<t&&C.y<t||(S.y<t?S=new B(S.x+(t-S.y)/(C.y-S.y)*(C.x-S.x),t)._round():C.y<t&&(C=new B(S.x+(t-S.y)/(C.y-S.y)*(C.x-S.x),t)._round()),S.x>=n&&C.x>=n||(S.x>=n?S=new B(n,S.y+(n-S.x)/(C.x-S.x)*(C.y-S.y))._round():C.x>=n&&(C=new B(n,S.y+(n-S.x)/(C.x-S.x)*(C.y-S.y))._round()),S.y>=l&&C.y>=l||(S.y>=l?S=new B(S.x+(l-S.y)/(C.y-S.y)*(C.x-S.x),l)._round():C.y>=l&&(C=new B(S.x+(l-S.y)/(C.y-S.y)*(C.x-S.x),l)._round()),x&&S.equals(x[x.length-1])||(x=[S],u.push(x)),x.push(C)))))}}return u}_t(ts,"Anchor");const ju=1e20;function Ly(i,e,t,n,l,u,p,f,x){for(let v=e;v<e+n;v++)Ry(i,t*u+v,u,l,p,f,x);for(let v=t;v<t+l;v++)Ry(i,v*u+e,1,n,p,f,x)}function Ry(i,e,t,n,l,u,p){u[0]=0,p[0]=-ju,p[1]=ju,l[0]=i[e];for(let f=1,x=0,v=0;f<n;f++){l[f]=i[e+f*t];const S=f*f;do{const C=u[x];v=(l[f]-l[C]+S-C*C)/(f-C)/2}while(v<=p[x]&&--x>-1);x++,u[x]=f,p[x]=v,p[x+1]=ju}for(let f=0,x=0;f<n;f++){for(;p[x+1]<f;)x++;const v=u[x],S=f-v;i[e+f*t]=l[v]+S*S}}const Hf={none:0,ideographs:1,all:2};class Kl{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[];for(const l in e)for(const u of e[l])n.push({stack:l,id:u});xt(n,({stack:l,id:u},p)=>{let f=this.entries[l];f||(f=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=f.glyphs[u];if(x!==void 0)return void p(null,{stack:l,id:u,glyph:x});if(x=this._tinySDF(f,l,u),x)return f.glyphs[u]=x,void p(null,{stack:l,id:u,glyph:x});const v=Math.floor(u/256);if(256*v>65535)return void p(new Error("glyphs > 65535 not supported"));if(f.ranges[v])return void p(null,{stack:l,id:u,glyph:x});let S=f.requests[v];S||(S=f.requests[v]=[],Kl.loadGlyphRange(l,v,this.url,this.requestManager,(C,M)=>{if(M){f.ascender=M.ascender,f.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(f.glyphs[+L]=M.glyphs[+L]);f.ranges[v]=!0}for(const L of S)L(C,M);delete f.requests[v]})),S.push((C,M)=>{C?p(C):M&&p(null,{stack:l,id:u,glyph:M.glyphs[u]||null})})},(l,u)=>{if(l)t(l);else if(u){const p={};for(const{stack:f,id:x,glyph:v}of u)p[f]===void 0&&(p[f]={}),p[f].glyphs===void 0&&(p[f].glyphs={}),p[f].glyphs[x]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},p[f].ascender=this.entries[f].ascender,p[f].descender=this.entries[f].descender;t(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Hf.none&&(this.localGlyphMode===Hf.all?!!this.localFontFamily:!!this.localFontFamily&&(za(e)||pd(e)||fu(e)||$o(e)||Rl(e)))}_tinySDF(e,t,n){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(n))return;let u=e.tinySDF;if(!u){let V="400";/bold/i.test(t)?V="900":/medium/i.test(t)?V="500":/light/i.test(t)&&(V="200"),u=e.tinySDF=new Kl.TinySDF({fontFamily:l,fontWeight:V,fontSize:48,buffer:6,radius:16}),u.fontWeight=V}if(this.localGlyphs[u.fontWeight][n])return this.localGlyphs[u.fontWeight][n];const p=String.fromCharCode(n),{data:f,width:x,height:v,glyphWidth:S,glyphHeight:C,glyphLeft:M,glyphTop:L,glyphAdvance:R}=u.draw(p);return this.localGlyphs[u.fontWeight][n]={id:n,bitmap:new Qo({width:x,height:v},f),metrics:{width:S/2,height:C/2,left:M/2,top:L/2-27,advance:R/2,localGlyph:!0}}}}function By(i,e,t,n){const l=[],u=i.image,p=u.pixelRatio,f=u.paddedRect.w-2,x=u.paddedRect.h-2,v=i.right-i.left,S=i.bottom-i.top,C=u.stretchX||[[0,f]],M=u.stretchY||[[0,x]],L=(Me,Re)=>Me+Re[1]-Re[0],R=C.reduce(L,0),V=M.reduce(L,0),q=f-R,Q=x-V;let le=0,ie=R,se=0,me=V,ue=0,Ce=q,Ae=0,De=Q;if(u.content&&n){const Me=u.content;le=jd(C,0,Me[0]),se=jd(M,0,Me[1]),ie=jd(C,Me[0],Me[2]),me=jd(M,Me[1],Me[3]),ue=Me[0]-le,Ae=Me[1]-se,Ce=Me[2]-Me[0]-ie,De=Me[3]-Me[1]-me}const et=(Me,Re,Ne,Be)=>{const Je=Nd(Me.stretch-le,ie,v,i.left),Ve=Vd(Me.fixed-ue,Ce,Me.stretch,R),ct=Nd(Re.stretch-se,me,S,i.top),Wt=Vd(Re.fixed-Ae,De,Re.stretch,V),Ht=Nd(Ne.stretch-le,ie,v,i.left),Ct=Vd(Ne.fixed-ue,Ce,Ne.stretch,R),nt=Nd(Be.stretch-se,me,S,i.top),si=Vd(Be.fixed-Ae,De,Be.stretch,V),Vt=new B(Je,ct),mt=new B(Ht,ct),Ni=new B(Ht,nt),Li=new B(Je,nt),Hi=new B(Ve/p,Wt/p),Kt=new B(Ct/p,si/p),gi=e*Math.PI/180;if(gi){const Pi=Math.sin(gi),Wi=Math.cos(gi),Ji=[Wi,-Pi,Pi,Wi];Vt._matMult(Ji),mt._matMult(Ji),Li._matMult(Ji),Ni._matMult(Ji)}const Vi=Me.stretch+Me.fixed,Ri=Re.stretch+Re.fixed;return{tl:Vt,tr:mt,bl:Li,br:Ni,tex:{x:u.paddedRect.x+1+Vi,y:u.paddedRect.y+1+Ri,w:Ne.stretch+Ne.fixed-Vi,h:Be.stretch+Be.fixed-Ri},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:Kt,minFontScaleX:Ce/p/v,minFontScaleY:De/p/S,isSDF:t}};if(n&&(u.stretchX||u.stretchY)){const Me=Oy(C,q,R),Re=Oy(M,Q,V);for(let Ne=0;Ne<Me.length-1;Ne++){const Be=Me[Ne],Je=Me[Ne+1];for(let Ve=0;Ve<Re.length-1;Ve++)l.push(et(Be,Re[Ve],Je,Re[Ve+1]))}}else l.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:x+1}));return l}function jd(i,e,t){let n=0;for(const l of i)n+=Math.max(e,Math.min(t,l[1]))-Math.max(e,Math.min(t,l[0]));return n}function Oy(i,e,t){const n=[{fixed:-1,stretch:0}];for(const[l,u]of i){const p=n[n.length-1];n.push({fixed:l-p.stretch,stretch:p.stretch}),n.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return n.push({fixed:e+1,stretch:t}),n}function Nd(i,e,t,n){return i/e*t+n}function Vd(i,e,t,n){return i-e*t/n}function Vw(i,e,t,n){const l=e+i.positionedLines[n].lineOffset;return n===0?t+l/2:t+(l+(e+i.positionedLines[n-1].lineOffset))/2}Kl.loadGlyphRange=function(i,e,t,n,l){const u=256*e,p=u+255,f=n.transformRequest(n.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${u}-${p}`),ge.Glyphs);Ee(f,(x,v)=>{if(x)l(x);else if(v){const S={},C=function(M){return new Fu(M).readFields(Lw,{})}(v);for(const M of C.glyphs)S[M.id]=M;l(null,{glyphs:S,ascender:C.ascender,descender:C.descender})}})},Kl.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:n=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=t;const f=this.size=i+4*e,x=this._createCanvas(f),v=this.ctx=x.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${u} ${i}px ${l}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:n,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(i),p=Math.ceil(t),f=Math.min(this.size-this.buffer,Math.ceil(u-l)),x=Math.min(this.size-this.buffer,p+Math.ceil(n)),v=f+2*this.buffer,S=x+2*this.buffer,C=Math.max(v*S,0),M=new Uint8ClampedArray(C),L={data:M,width:v,height:S,glyphWidth:f,glyphHeight:x,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(f===0||x===0)return L;const{ctx:R,buffer:V,gridInner:q,gridOuter:Q}=this;R.clearRect(V,V,f,x),R.fillText(i,V,V+p);const le=R.getImageData(V,V,f,x);Q.fill(ju,0,C),q.fill(0,0,C);for(let ie=0;ie<x;ie++)for(let se=0;se<f;se++){const me=le.data[4*(ie*f+se)+3]/255;if(me===0)continue;const ue=(ie+V)*v+se+V;if(me===1)Q[ue]=0,q[ue]=ju;else{const Ce=.5-me;Q[ue]=Ce>0?Ce*Ce:0,q[ue]=Ce<0?Ce*Ce:0}}Ly(Q,0,0,v,S,v,this.f,this.v,this.z),Ly(q,V,V,f,x,v,this.f,this.v,this.z);for(let ie=0;ie<C;ie++){const se=Math.sqrt(Q[ie])-Math.sqrt(q[ie]);M[ie]=Math.round(255-255*(se/this.radius+this.cutoff))}return L}};class $w{constructor(e=[],t=Gw){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,l=t[e];for(;e>0;){const u=e-1>>1,p=t[u];if(n(l,p)>=0)break;t[e]=p,e=u}t[e]=l}_down(e){const{data:t,compare:n}=this,l=this.length>>1,u=t[e];for(;e<l;){let p=1+(e<<1),f=t[p];const x=p+1;if(x<this.length&&n(t[x],f)<0&&(p=x,f=t[x]),n(f,u)>=0)break;t[e]=f,e=p}t[e]=u}}function Gw(i,e){return i<e?-1:i>e?1:0}function qw(i,e=1,t=!1){let n=1/0,l=1/0,u=-1/0,p=-1/0;const f=i[0];for(let L=0;L<f.length;L++){const R=f[L];(!L||R.x<n)&&(n=R.x),(!L||R.y<l)&&(l=R.y),(!L||R.x>u)&&(u=R.x),(!L||R.y>p)&&(p=R.y)}const x=Math.min(u-n,p-l);let v=x/2;const S=new $w([],Zw);if(x===0)return new B(n,l);for(let L=n;L<u;L+=x)for(let R=l;R<p;R+=x)S.push(new Yl(L+v,R+v,v,i));let C=function(L){let R=0,V=0,q=0;const Q=L[0];for(let le=0,ie=Q.length,se=ie-1;le<ie;se=le++){const me=Q[le],ue=Q[se],Ce=me.x*ue.y-ue.x*me.y;V+=(me.x+ue.x)*Ce,q+=(me.y+ue.y)*Ce,R+=3*Ce}return new Yl(V/R,q/R,0,L)}(i),M=S.length;for(;S.length;){const L=S.pop();(L.d>C.d||!C.d)&&(C=L,t&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-C.d<=e||(v=L.h/2,S.push(new Yl(L.p.x-v,L.p.y-v,v,i)),S.push(new Yl(L.p.x+v,L.p.y-v,v,i)),S.push(new Yl(L.p.x-v,L.p.y+v,v,i)),S.push(new Yl(L.p.x+v,L.p.y+v,v,i)),M+=4)}return t&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function Zw(i,e){return e.max-i.max}function Yl(i,e,t,n){this.p=new B(i,e),this.h=t,this.d=function(l,u){let p=!1,f=1/0;for(let x=0;x<u.length;x++){const v=u[x];for(let S=0,C=v.length,M=C-1;S<C;M=S++){const L=v[S],R=v[M];L.y>l.y!=R.y>l.y&&l.x<(R.x-L.x)*(l.y-L.y)/(R.y-L.y)+L.x&&(p=!p),f=Math.min(f,Eg(l,L,R))}}return(p?1:-1)*Math.sqrt(f)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Kf=Number.POSITIVE_INFINITY,Ww=Math.sqrt(2);function Fy(i,e){return e[1]!==Kf?function(t,n,l){let u=0,p=0;switch(n=Math.abs(n),l=Math.abs(l),t){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(t){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}return[u,p]}(i,e[0],e[1]):function(t,n){let l=0,u=0;n<0&&(n=0);const p=n/Ww;switch(t){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-n;break;case"top":u=n-7}switch(t){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=n;break;case"right":l=-n}return[l,u]}(i,e[0])}function Xw(i,e,t,n,l,u,p,f,x,v){i.createArrays(),i.tilePixelRatio=jt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,C=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:q}=i.textSizeData;M.compositeTextSizes=[C["text-size"].possiblyEvaluate(new X(V),f),C["text-size"].possiblyEvaluate(new X(q),f)]}if(i.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:q}=i.iconSizeData;M.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new X(V),f),C["icon-size"].possiblyEvaluate(new X(q),f)]}M.layoutTextSize=C["text-size"].possiblyEvaluate(new X(x+1),f),M.layoutIconSize=C["icon-size"].possiblyEvaluate(new X(x+1),f),M.textMaxSize=C["text-size"].possiblyEvaluate(new X(18),f);const L=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",R=S.get("text-size");for(const V of i.features){const q=S.get("text-font").evaluate(V,{},f).join(","),Q=R.evaluate(V,{},f),le=M.layoutTextSize.evaluate(V,{},f),ie=(M.layoutIconSize.evaluate(V,{},f),{horizontal:{},vertical:void 0}),se=V.text;let me,ue=[0,0];if(se){const De=se.toString(),et=S.get("text-letter-spacing").evaluate(V,{},f)*Or,Me=S.get("text-line-height").evaluate(V,{},f)*Or,Re=df(De)?et:0,Ne=S.get("text-anchor").evaluate(V,{},f),Be=S.get("text-variable-anchor");if(!Be){const Ct=S.get("text-radial-offset").evaluate(V,{},f);ue=Ct?Fy(Ne,[Ct*Or,Kf]):S.get("text-offset").evaluate(V,{},f).map(nt=>nt*Or)}let Je=L?"center":S.get("text-justify").evaluate(V,{},f);const Ve=S.get("symbol-placement"),ct=Ve==="point",Wt=Ve==="point"?S.get("text-max-width").evaluate(V,{},f)*Or:0,Ht=Ct=>{i.allowVerticalPlacement&&Ol(De)&&(ie.vertical=Zf(se,e,t,l,q,Wt,Me,Ne,Ct,Re,ue,Pn.vertical,!0,Ve,le,Q))};if(!L&&Be){const Ct=Je==="auto"?Be.map(si=>Yf(si)):[Je];let nt=!1;for(let si=0;si<Ct.length;si++){const Vt=Ct[si];if(!ie.horizontal[Vt])if(nt)ie.horizontal[Vt]=ie.horizontal[0];else{const mt=Zf(se,e,t,l,q,Wt,Me,"center",Vt,Re,ue,Pn.horizontal,!1,Ve,le,Q);mt&&(ie.horizontal[Vt]=mt,nt=mt.positionedLines.length===1)}}Ht("left")}else{if(Je==="auto"&&(Je=Yf(Ne)),ct||S.get("text-writing-mode").indexOf("horizontal")>=0||!Ol(De)){const Ct=Zf(se,e,t,l,q,Wt,Me,Ne,Je,Re,ue,Pn.horizontal,!1,Ve,le,Q);Ct&&(ie.horizontal[Je]=Ct)}Ht(Ve==="point"?"left":Je)}}let Ce=!1;if(V.icon&&V.icon.name){const De=n[V.icon.name];De&&(me=Uw(l[V.icon.name],S.get("icon-offset").evaluate(V,{},f),S.get("icon-anchor").evaluate(V,{},f)),Ce=De.sdf,i.sdfIcons===void 0?i.sdfIcons=De.sdf:i.sdfIcons!==De.sdf&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ae=jy(ie.horizontal)||ie.vertical;i.iconsInText||(i.iconsInText=!!Ae&&Ae.iconsInText),(Ae||me)&&Hw(i,V,ie,me,n,M,le,0,ue,Ce,p,f,v)}u&&i.generateCollisionDebugBuffers(x,i.collisionBoxArray)}function Yf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hw(i,e,t,n,l,u,p,f,x,v,S,C,M){let L=u.textMaxSize.evaluate(e,{},C);L===void 0&&(L=p);const R=i.layers[0].layout,V=R.get("icon-offset").evaluate(e,{},C),q=jy(t.horizontal)||t.vertical,Q=M.name==="globe",le=p/24,ie=i.tilePixelRatio*L/24,se=(Re=i.overscaling,i.zoom>18&&Re>2&&(Re>>=1),Math.max(jt/(512*Re),1)*R.get("symbol-spacing")),me=R.get("text-padding")*i.tilePixelRatio,ue=R.get("icon-padding")*i.tilePixelRatio,Ce=ve(R.get("text-max-angle")),Ae=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",De=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",et=R.get("symbol-placement"),Me=se/2;var Re;const Ne=R.get("icon-text-fit");let Be;n&&Ne!=="none"&&(i.allowVerticalPlacement&&t.vertical&&(Be=Iy(n,t.vertical,Ne,R.get("icon-text-fit-padding"),V,le)),q&&(n=Iy(n,q,Ne,R.get("icon-text-fit-padding"),V,le)));const Je=(Ve,ct,Wt)=>{if(ct.x<0||ct.x>=jt||ct.y<0||ct.y>=jt)return;let Ht=null;if(Q){const{x:Ct,y:nt,z:si}=M.projectTilePoint(ct.x,ct.y,Wt);Ht={anchor:new ts(Ct,nt,si,0,void 0),up:M.upVector(Wt,ct.x,ct.y)}}(function(Ct,nt,si,Vt,mt,Ni,Li,Hi,Kt,gi,Vi,Ri,Pi,Wi,Ji,Ir,ln,ci,sr,qr,Ti,Qi,Qr,Ki,ur){const Cr=Ct.addToLineVertexArray(nt,Vt);let vr,Fr,en,Mr,rs,ic,Yu,Ju=0,Tx=0,Ex=0,Sx=0,fm=-1,mm=-1;const ko={};let Ax=Tu("");const $a=si?si.anchor:nt;let _m=0,gm=0;if(Kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[_m,gm]=Kt.layout.get("text-offset").evaluate(Ti,{},ur).map(gn=>gn*Or):(_m=Kt.layout.get("text-radial-offset").evaluate(Ti,{},ur)*Or,gm=Kf),Ct.allowVerticalPlacement&&mt.vertical){const gn=mt.vertical;if(Ji)ic=Jf(gn),Hi&&(Yu=Jf(Hi));else{const yn=Kt.layout.get("text-rotate").evaluate(Ti,{},ur)+90;en=$d(gi,$a,nt,Vi,Ri,Pi,gn,Wi,yn,Ir),Hi&&(Mr=$d(gi,$a,nt,Vi,Ri,Pi,Hi,ci,yn))}}if(Ni){const gn=Kt.layout.get("icon-rotate").evaluate(Ti,{},ur),yn=Kt.layout.get("icon-text-fit")!=="none",Qu=By(Ni,gn,Qr,yn),xm=Hi?By(Hi,gn,Qr,yn):void 0;Fr=$d(gi,$a,nt,Vi,Ri,Pi,Ni,ci,gn),Ju=4*Qu.length;const Ix=Ct.iconSizeData;let Ga=null;Ix.kind==="source"?(Ga=[Io*Kt.layout.get("icon-size").evaluate(Ti,{},ur)],Ga[0]>ks&&bi(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ix.kind==="composite"&&(Ga=[Io*Qi.compositeIconSizes[0].evaluate(Ti,{},ur),Io*Qi.compositeIconSizes[1].evaluate(Ti,{},ur)],(Ga[0]>ks||Ga[1]>ks)&&bi(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,Qu,Ga,qr,sr,Ti,!1,si,nt,Cr.lineStartIndex,Cr.lineLength,-1,Ki,ur),fm=Ct.icon.placedSymbolArray.length-1,xm&&(Tx=4*xm.length,Ct.addSymbols(Ct.icon,xm,Ga,qr,sr,Ti,Pn.vertical,si,nt,Cr.lineStartIndex,Cr.lineLength,-1,Ki,ur),mm=Ct.icon.placedSymbolArray.length-1)}for(const gn in mt.horizontal){const yn=mt.horizontal[gn];vr||(Ax=Tu(yn.text),Ji?rs=Jf(yn):vr=$d(gi,$a,nt,Vi,Ri,Pi,yn,Wi,Kt.layout.get("text-rotate").evaluate(Ti,{},ur),Ir));const Qu=yn.positionedLines.length===1;if(Ex+=Uy(Ct,si,nt,yn,Li,Kt,Ji,Ti,Ir,Cr,mt.vertical?Pn.horizontal:Pn.horizontalOnly,Qu?Object.keys(mt.horizontal):[gn],ko,fm,Qi,Ki,ur),Qu)break}mt.vertical&&(Sx+=Uy(Ct,si,nt,mt.vertical,Li,Kt,Ji,Ti,Ir,Cr,Pn.vertical,["vertical"],ko,mm,Qi,Ki,ur));let Fs=-1;const ym=(gn,yn)=>gn?Math.max(gn,yn):yn;Fs=ym(rs,Fs),Fs=ym(ic,Fs),Fs=ym(Yu,Fs);const I2=Fs>-1?1:0;Ct.glyphOffsetArray.length>=Ls.MAX_GLYPHS&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ti.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,Ti.sortKey),Ct.symbolInstances.emplaceBack($a.x,$a.y,$a.z,nt.x,nt.y,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical>=0?ko.vertical:-1,fm,mm,Ax,vr!==void 0?vr:Ct.collisionBoxArray.length,vr!==void 0?vr+1:Ct.collisionBoxArray.length,en!==void 0?en:Ct.collisionBoxArray.length,en!==void 0?en+1:Ct.collisionBoxArray.length,Fr!==void 0?Fr:Ct.collisionBoxArray.length,Fr!==void 0?Fr+1:Ct.collisionBoxArray.length,Mr||Ct.collisionBoxArray.length,Mr?Mr+1:Ct.collisionBoxArray.length,Vi,Ex,Sx,Ju,Tx,I2,0,_m,gm,Fs)})(i,ct,Ht,Ve,t,n,l,Be,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,me,Ae,x,0,ue,De,V,e,u,v,S,C)};if(et==="line")for(const Ve of Dy(e.geometry,0,0,jt,jt)){const ct=Nw(Ve,se,Ce,t.vertical||q,n,24,ie,i.overscaling,jt);for(const Wt of ct){const Ht=q;Ht&&Kw(i,Ht.text,Me,Wt)||Je(Ve,Wt,C)}}else if(et==="line-center"){for(const Ve of e.geometry)if(Ve.length>1){const ct=jw(Ve,Ce,t.vertical||q,n,24,ie);ct&&Je(Ve,ct,C)}}else if(e.type==="Polygon")for(const Ve of Uf(e.geometry,0)){const ct=qw(Ve,16);Je(Ve[0],new ts(ct.x,ct.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Ve of e.geometry)Je(Ve,new ts(Ve[0].x,Ve[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Ve of e.geometry)for(const ct of Ve)Je([ct],new ts(ct.x,ct.y,0,0,void 0),C)}const ks=32640;function Uy(i,e,t,n,l,u,p,f,x,v,S,C,M,L,R,V,q){const Q=function(se,me,ue,Ce,Ae,De,et,Me){const Re=[];if(me.positionedLines.length===0)return Re;const Ne=Ce.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Be=function(Ht){const Ct=Ht[0],nt=Ht[1],si=Ct*nt;return si>0?[Ct,-nt]:si<0?[-Ct,nt]:Ct===0?[nt,Ct]:[nt,-Ct]}(ue);let Je=Math.abs(me.top-me.bottom);for(const Ht of me.positionedLines)Je-=Ht.lineOffset;const Ve=me.positionedLines.length,ct=Je/Ve;let Wt=me.top-ue[1];for(let Ht=0;Ht<Ve;++Ht){const Ct=me.positionedLines[Ht];Wt=Vw(me,ct,Wt,Ht);for(const nt of Ct.positionedGlyphs){if(!nt.rect)continue;const si=nt.rect||{};let Vt=4,mt=!0,Ni=1,Li=0;if(nt.imageName){const Ki=et[nt.imageName];if(!Ki)continue;if(Ki.sdf){bi("SDF images are not supported in formatted text and will be ignored.");continue}mt=!1,Ni=Ki.pixelRatio,Vt=1/Ni}const Hi=(Ae||Me)&&nt.vertical,Kt=nt.metrics.advance*nt.scale/2,gi=nt.metrics,Vi=nt.rect;if(Vi===null)continue;Me&&me.verticalizable&&(Li=nt.imageName?Kt-nt.metrics.width*nt.scale/2:0);const Ri=Ae?[nt.x+Kt,nt.y]:[0,0];let Pi=[0,0],Wi=[0,0],Ji=!1;Ae||(Hi?(Wi=[nt.x+Kt+Be[0],nt.y+Be[1]-Li],Ji=!0):Pi=[nt.x+Kt+ue[0],nt.y+ue[1]-Li]);const Ir=Vi.w*nt.scale/(Ni*(nt.localGlyph?2:1)),ln=Vi.h*nt.scale/(Ni*(nt.localGlyph?2:1));let ci,sr,qr,Ti;if(Hi){const Ki=nt.y-Wt,ur=new B(-Kt,Kt-Ki),Cr=-Math.PI/2,vr=new B(...Wi);ci=new B(-Kt+Pi[0],Pi[1]),ci._rotateAround(Cr,ur)._add(vr),ci.x+=-Ki+Kt,ci.y-=(gi.left-Vt)*nt.scale;const Fr=nt.imageName?gi.advance*nt.scale:Or*nt.scale,en=String.fromCharCode(nt.glyph);Tw(en)?ci.x+=(1-Vt)*nt.scale:Ew(en)?ci.x+=Fr-gi.height*nt.scale+(-Vt-1)*nt.scale:ci.x+=nt.imageName||gi.width+2*Vt===Vi.w&&gi.height+2*Vt===Vi.h?(Fr-ln)/2:(Fr-(gi.height+2*Vt)*nt.scale)/2,sr=new B(ci.x,ci.y-Ir),qr=new B(ci.x+ln,ci.y),Ti=new B(ci.x+ln,ci.y-Ir)}else{const Ki=(gi.left-Vt)*nt.scale-Kt+Pi[0],ur=(-gi.top-Vt)*nt.scale+Pi[1],Cr=Ki+Ir,vr=ur+ln;ci=new B(Ki,ur),sr=new B(Cr,ur),qr=new B(Ki,vr),Ti=new B(Cr,vr)}if(Ne){let Ki;Ki=Ae?new B(0,0):Ji?new B(Be[0],Be[1]):new B(ue[0],ue[1]),ci._rotateAround(Ne,Ki),sr._rotateAround(Ne,Ki),qr._rotateAround(Ne,Ki),Ti._rotateAround(Ne,Ki)}const Qi=new B(0,0),Qr=new B(0,0);Re.push({tl:ci,tr:sr,bl:qr,br:Ti,tex:si,writingMode:me.writingMode,glyphOffset:Ri,sectionIndex:nt.sectionIndex,isSDF:mt,pixelOffsetTL:Qi,pixelOffsetBR:Qr,minFontScaleX:0,minFontScaleY:0})}}return Re}(0,n,x,u,p,f,l,i.allowVerticalPlacement),le=i.textSizeData;let ie=null;le.kind==="source"?(ie=[Io*u.layout.get("text-size").evaluate(f,{},q)],ie[0]>ks&&bi(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(ie=[Io*R.compositeTextSizes[0].evaluate(f,{},q),Io*R.compositeTextSizes[1].evaluate(f,{},q)],(ie[0]>ks||ie[1]>ks)&&bi(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Q,ie,x,p,f,S,e,t,v.lineStartIndex,v.lineLength,L,V,q);for(const se of C)M[se]=i.text.placedSymbolArray.length-1;return 4*Q.length}function jy(i){for(const e in i)return i[e];return null}function $d(i,e,t,n,l,u,p,f,x,v){let S=p.top,C=p.bottom,M=p.left,L=p.right;const R=p.collisionPadding;if(R&&(M-=R[0],S-=R[1],L+=R[2],C+=R[3]),x){const V=new B(M,S),q=new B(L,S),Q=new B(M,C),le=new B(L,C),ie=ve(x);let se=new B(0,0);v&&(se=new B(v[0],v[1])),V._rotateAround(ie,se),q._rotateAround(ie,se),Q._rotateAround(ie,se),le._rotateAround(ie,se),M=Math.min(V.x,q.x,Q.x,le.x),L=Math.max(V.x,q.x,Q.x,le.x),S=Math.min(V.y,q.y,Q.y,le.y),C=Math.max(V.y,q.y,Q.y,le.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,M,S,L,C,f,n,l,u),i.length-1}function Jf(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function Kw(i,e,t,n){const l=i.compareText;if(e in l){const u=l[e];for(let p=u.length-1;p>=0;p--)if(n.dist(u[p])<t)return!0}else l[e]=[];return l[e].push(n),!1}const Yw=Oe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ny}=Yw,Vy=Oe([{name:"a_pos_3",components:3,type:"Int16"}]);var Nu=Oe([{name:"a_pos",type:"Int16",components:2}]);const is=jt/Math.PI/2,Qf=2*Nn(1,0)*is*Math.PI,Jl=[64,32,16],no=-is,oo=is,Jw=[new an([no,no,no],[oo,oo,oo]),new an([no,no,no],[0,0,oo]),new an([0,no,no],[oo,0,oo]),new an([no,0,no],[0,oo,oo]),new an([0,0,no],[oo,oo,oo])];function $y(i,e,t,n=!0){const l=io([],i._camera.position,i.worldSize),u=[e,t,1,1];Fa(u,u,i.pixelMatrixInverse),Rg(u,u,1/u[3]);const p=Yr([],ro([],u,l)),f=i.globeMatrix,x=[f[12],f[13],f[14]],v=ro([],x,l),S=Au(v),C=Yr([],v),M=i.worldSize/(2*Math.PI),L=$n(C,p),R=Math.asin(M/S);if(R<Math.acos(L)){if(!n)return null;const et=[],Me=[];io(et,p,S/L),Yr(Me,ro(Me,et,v)),Yr(p,Ps(p,v,io(p,Me,Math.tan(R)*S)))}const V=[];new Pf(l,p).closestPointOnSphere(x,M,V);const q=Yr([],yi(f,0)),Q=Yr([],yi(f,1)),le=Yr([],yi(f,2)),ie=$n(q,V),se=$n(Q,V),me=$n(le,V),ue=Ie(Math.asin(-se/M));let Ce=Ie(Math.atan2(ie,me));Ce=i.center.lng+function(et,Me){const Re=(Me-et+180)%360-180;return Re<-180?Re+360:Re}(i.center.lng,Ce);const Ae=Eo(Ce),De=He(Yo(ue),0,1);return new jl(Ae,De)}class Qw{constructor(e,t,n){this.a=ro([],e,n),this.b=ro([],t,n),this.center=n;const l=Yr([],this.a),u=Yr([],this.b);this.angle=Math.acos($n(l,u))}}function em(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(n,l,u,p){const f=Math.sin(u);return n*(Math.sin((1-p)*u)/f)+l*(Math.sin(p*u)/f)}(i.a[e],i.b[e],i.angle,He(t,0,1))+i.center[e]}function Co(i){if(i.z<=1)return Jw[i.z+2*i.y+i.x];const e=tm(Gd(i));return an.fromPoints(e)}function Gy(i,e){const t=Gu(e.zoom);if(t===0)return Co(i);const n=Gd(i),l=tm(n),u=Eo(n.getWest())*e.worldSize,p=Eo(n.getEast())*e.worldSize,f=Yo(n.getNorth())*e.worldSize,x=Yo(n.getSouth())*e.worldSize,v=[u,f,0],S=[p,f,0],C=[u,x,0],M=[p,x,0],L=Ef([],e.globeMatrix);return yr(v,v,L),yr(S,S,L),yr(C,C,L),yr(M,M,L),l[0]=ms(l[0],C,t),l[1]=ms(l[1],M,t),l[2]=ms(l[2],S,t),l[3]=ms(l[3],v,t),an.fromPoints(l)}function qy(i,e,t,n,l){for(const u of t)yr(u,u,n),io(u,u,l),Cf(i,i,u),Mf(e,e,u)}function e2(i,e,t){const n=e/i.worldSize,l=Number.MAX_VALUE,u=[-l,-l,-l],p=[l,l,l],f=i.globeMatrix;if(t.z<=1)return qy(p,u,Co(t).getCorners(),f,n),new an(p,u);const x=Gd(t),v=tm(x);if(qy(p,u,v,f,n),x.contains(i.center)){u[2]=0;const Ce=i.point,Ae=[Ce.x*n,Ce.y*n,0];return Cf(p,p,Ae),Mf(u,u,Ae),new an(p,u)}const S=[f[12]*n,f[13]*n,f[14]*n],C=x.getCenter(),M=He(i.center.lat,-85.051129,So),L=He(C.lat,-85.051129,So),R=Eo(i.center.lng),V=Yo(M);let q=R-Eo(C.lng);const Q=V-Yo(L);q>.5?q-=1:q<-.5&&(q+=1);let le=0;Math.abs(q)>Math.abs(Q)?le=q>=0?1:3:(le=Q>=0?0:2,Ad(S,S,[f[4]*n,f[5]*n,f[6]*n],-Math.sin(ve(Q>=0?x.getSouth():x.getNorth()))*is));const ie=v[le],se=v[(le+1)%4],me=new Qw(ie,se,S),ue=[em(me,0)||ie[0],em(me,1)||ie[1],em(me,2)||ie[2]];return p[2]=Math.min(ie[2],se[2]),Cf(p,p,ue),Mf(u,u,ue),new an(p,u)}function Gd({x:i,y:e,z:t}){const n=1/(1<<t),l=new Ai(Vn(i*n),Br((e+1)*n)),u=new Ai(Vn((i+1)*n),Br(e*n));return new zs(l,u)}function tm(i){const e=ve(i.getNorth()),t=ve(i.getSouth()),n=Math.cos(e),l=Math.cos(t),u=Math.sin(e),p=Math.sin(t),f=i.getWest(),x=i.getEast();return[Ql(l,p,f),Ql(l,p,x),Ql(n,u,x),Ql(n,u,f)]}function Ql(i,e,t,n=is){return t=ve(t),[i*Math.sin(t)*n,-e*n,i*Math.cos(t)*n]}function qd(i,e,t){return Ql(Math.cos(ve(i)),Math.sin(ve(i)),e,t)}function Vu(i,e,t,n){const l=1<<t.z,u=(i/jt+t.x)/l;return qd(Br((e/jt+t.y)/l),Vn(u),n)}function Zd({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const Zy=new Float64Array(16);function $u(i){const e=Zd(i),t=zg(Zy,[e,e,e]);return Su(t,t,((n=[])[0]=-(l=i.min)[0],n[1]=-l[1],n[2]=-l[2],n));var n,l}function im(i){const e=(n=i.min,(t=Zy)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t);var t,n;const l=1/Zd(i);return Oa(e,e,[l,l,l])}function Wy(i,e,t,n,l){const u=function(x){const v=jt/(2*Math.PI);return x/(2*Math.PI)/v}(t),p=[i,e,-t/(2*Math.PI)],f=Ao(new Float64Array(16));return Su(f,f,p),Oa(f,f,[u,u,u]),Sf(f,f,ve(-l)),Sd(f,f,ve(-n)),f}function Gu(i){return yt(5,6,i)}function Xy(i,e){const t=qd(e.lat,e.lng);return u=(n=If([],function(L){const R=qd(L._center.lat,L._center.lng);let V=zf([],$l(0,1,0),R);const q=Pg([],-L.angle,R);V=yr(V,V,q),Pg(q,-L._pitch,V);const Q=Yr([],R);return io(Q,Q,L.cameraToCenterDistance/L.pixelsPerMeter*Qf),yr(Q,Q,q),Ps([],R,Q)}(i),t))[0],p=n[1],f=n[2],x=(l=t)[0],v=l[1],S=l[2],M=(C=Math.sqrt(u*u+p*p+f*f)*Math.sqrt(x*x+v*v+S*S))&&$n(n,l)/C,Math.acos(Math.min(Math.max(M,-1),1));var n,l,u,p,f,x,v,S,C,M}const Hy=ve(85),t2=Math.cos(Hy),i2=Math.sin(Hy);function Ky(i,e){const t=i.fovAboveCenter,n=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,l=(i._camera.position[2]*i.worldSize-n)/Math.cos(i._pitch),u=Math.sin(t)*l/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),p=Math.sin(i._pitch)*u+l;return Math.min(1.01*p,l*(1/i._horizonShift))}function Na(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),n=i.x*t,l=(i.x+1)*t,u=i.y*t,p=(i.y+1)*t,f=Vn(n),x=Vn(l),v=Br(u),S=Br(p),C=e.project(f,v),M=e.project(x,v),L=e.project(x,S),R=e.project(f,S);let V=Math.min(C.x,M.x,L.x,R.x),q=Math.min(C.y,M.y,L.y,R.y),Q=Math.max(C.x,M.x,L.x,R.x),le=Math.max(C.y,M.y,L.y,R.y);const ie=t/16;function se(ue,Ce,Ae,De,et,Me){const Re=(Ae+et)/2,Ne=(De+Me)/2,Be=e.project(Vn(Re),Br(Ne)),Je=Math.max(0,V-Be.x,q-Be.y,Be.x-Q,Be.y-le);V=Math.min(V,Be.x),Q=Math.max(Q,Be.x),q=Math.min(q,Be.y),le=Math.max(le,Be.y),Je>ie&&(se(ue,Be,Ae,De,Re,Ne),se(Be,Ce,Re,Ne,et,Me))}se(C,M,n,u,l,u),se(M,L,l,u,l,p),se(L,R,l,p,n,p),se(R,C,n,p,n,u),V-=ie,q-=ie,Q+=ie,le+=ie;const me=1/Math.max(Q-V,le-q);return{scale:me,x:V*me,y:q*me,x2:Q*me,y2:le*me,projection:e}}const r2=Ao(new Float32Array(16));class Ds{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Ai(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n=!0){return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return Nn(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return Ky(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,l){const u=e.horizonLineFromTop(!1),p=new B(t,Math.max(u,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}pointCoordinate3D(e,t,n){const l=new B(t,n);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return r2}createTileMatrix(e,t,n){let l,u,p;const f=n.canonical,x=Ao(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=Na(f,this);l=1,u=v.x+n.wrap*v.scale,p=v.y,Oa(x,x,[l/v.scale,l/v.scale,e.pixelsPerMeter/t])}else l=t/e.zoomScale(f.z),u=(f.x+Math.pow(2,f.z)*n.wrap)*l,p=f.y*l;return Su(x,x,[u,p,0]),Oa(x,x,[l/jt,l/jt,1]),x}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class n2 extends Ds{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(ve(t));this.n=(l+Math.sin(ve(n)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n,c:l,r0:u}=this,p=ve(e-this.center[0]),f=ve(t),x=Math.sqrt(l-2*n*Math.sin(f))/n;return{x:x*Math.sin(p*n),y:x*Math.cos(p*n)-u,z:0}}unproject(e,t){const{n,c:l,r0:u}=this,p=u+t;let f=Math.atan2(e,Math.abs(p))*Math.sign(p);p*n<0&&(f-=Math.PI*Math.sign(e)*Math.sign(p));const x=ve(this.center[0])*n;f=We(f,-Math.PI-x,Math.PI-x);const v=Ie(f/n)+this.center[0],S=Math.asin(He((l-(e*e+p*p)*n*n)/(2*n),-1,1)),C=He(Ie(S),-85.051129,So);return new Ai(v,C)}}const qu=1.340264,Zu=-.081106,Wu=893e-6,Xu=.003796,Wd=Math.sqrt(3)/2;class o2 extends Ds{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Wd*Math.sin(t)),l=n*n,u=l*l*l;return{x:.5*(e*Math.cos(n)/(Wd*(qu+3*Zu*l+u*(7*Wu+9*Xu*l)))/Math.PI+.5),y:1-.5*(n*(qu+Zu*l+u*(Wu+Xu*l))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,l=n*n,u=l*l*l;for(let S,C,M,L=0;L<12&&(C=n*(qu+Zu*l+u*(Wu+Xu*l))-t,M=qu+3*Zu*l+u*(7*Wu+9*Xu*l),S=C/M,n=He(n-S,-Math.PI/3,Math.PI/3),l=n*n,u=l*l*l,!(Math.abs(S)<1e-12));++L);const p=Wd*e*(qu+3*Zu*l+u*(7*Wu+9*Xu*l))/Math.cos(n),f=Math.asin(Math.sin(n)/Wd),x=He(180*p/Math.PI,-180,180),v=He(180*f/Math.PI,-85.051129,So);return new Ai(x,v)}}class s2 extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),l=He(360*(.5-t),-85.051129,So);return new Ai(n,l)}}const ec=Math.PI/2;function Xd(i){return Math.tan((ec+i)/2)}class a2 extends Ds{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30],l=ve(t),u=ve(n),p=Math.cos(l);this.n=l===u?Math.sin(l):Math.log(p/Math.cos(u))/Math.log(Xd(u)/Xd(l)),this.f=p*Math.pow(Xd(l),this.n)/this.n}project(e,t){t=ve(t),e=ve(e-this.center[0]);const n=1e-6,{n:l,f:u}=this;u>0?t<-ec+n&&(t=-ec+n):t>ec-n&&(t=ec-n);const p=u/Math.pow(Xd(t),l),f=p*Math.sin(l*e),x=u-p*Math.cos(l*e);return{x:.5*(f/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n,f:l}=this,u=l-t,p=Math.sign(u),f=Math.sign(n)*Math.sqrt(e*e+u*u);let x=Math.atan2(e,Math.abs(u))*p;u*n<0&&(x-=Math.PI*Math.sign(e)*p);const v=He(Ie(x/n)+this.center[0],-180,180),S=He(Ie(2*Math.atan(Math.pow(l/f,1/n))-ec),-85.051129,So);return new Ai(v,S)}}class Yy extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Eo(e),y:Yo(t),z:0}}unproject(e,t){const n=Vn(e),l=Br(t);return new Ai(n,l)}}const Jy=ve(So);class l2 extends Ds{project(e,t){const n=(t=ve(t))*t,l=n*n;return{x:.5*((e=ve(e))*(.8707-.131979*n+l*(l*(.003971*n-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+l*(.028874*n-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,l=25,u=0,p=n*n;do{p=n*n;const v=p*p;u=(n*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-t)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),n=He(n-u,-Jy,Jy)}while(Math.abs(u)>1e-6&&--l>0);p=n*n;const f=He(Ie(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=Ie(n);return new Ai(f,x)}}const Qy=ve(So);class c2 extends Ds{project(e,t){t=ve(t),e=ve(e);const n=Math.cos(t),l=2/Math.PI,u=Math.acos(n*Math.cos(e/2)),p=Math.sin(u)/u,f=.5*(e*l+2*n*Math.sin(e/2)/p)||0,x=.5*(t+Math.sin(t)/p)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,l=t=(2*(1-t)-1)*Math.PI,u=25;const p=1e-6;let f=0,x=0;do{const v=Math.cos(l),S=Math.sin(l),C=2*S*v,M=S*S,L=v*v,R=Math.cos(n/2),V=Math.sin(n/2),q=2*R*V,Q=V*V,le=1-L*R*R,ie=le?1/le:0,se=le?Math.acos(v*R)*Math.sqrt(1/le):0,me=.5*(2*se*v*V+2*n/Math.PI)-e,ue=.5*(se*S+l)-t,Ce=.5*ie*(L*Q+se*v*R*M)+1/Math.PI,Ae=ie*(q*C/4-se*S*V),De=.125*ie*(C*V-se*S*L*q),et=.5*ie*(M*R+se*Q*v)+.5,Me=Ae*De-et*Ce;f=(ue*Ae-me*et)/Me,x=(me*De-ue*Ce)/Me,n=He(n-f,-Math.PI,Math.PI),l=He(l-x,-Qy,Qy)}while((Math.abs(f)>p||Math.abs(x)>p)&&--u>0);return new Ai(Ie(n),Ie(l))}}class ex extends Ds{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:l}=this;return{x:ve(e)*l*n+.5,y:-Math.sin(ve(t))/l*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:l}=this,u=-(t-.5)/n,p=He(Ie((e-.5)/n)/l,-180,180),f=Math.asin(He(u*l,-1,1)),x=He(Ie(f),-85.051129,So);return new Ai(p,x)}}class u2 extends Yy{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,n){const l=Vu(e,t,n);return yr(l,l,$u(Co(n))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,t){const n=qd(t.lat,t.lng),l=Yr([],n),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Ad(n,n,l,Nn(1,0)*jt*u);const p=Ao(new Float64Array(16));return Vl(p,e.pixelMatrix,e.globeMatrix),yr(n,n,p),new B(n[0],n[1])}pixelsPerMeter(e,t){return Nn(1,0)*t}pixelSpaceConversion(e,t,n){const l=mi(Nn(1,45)*t,Nn(1,e)*t,n);return this.pixelsPerMeter(e,t)/l}createTileMatrix(e,t,n){const l=im(Co(n.canonical));return Vl(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,t){const{center:n}=e,l=$u(Co(t));return Sd(l,l,ve(n.lng)),Sf(l,l,ve(n.lat)),Oa(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,t,n,l){return $y(e,t,n,!0)||new jl(0,0)}pointCoordinate3D(e,t,n){const l=this.pointCoordinate(e,t,n,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,t){return!$y(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(l,u){const p=l.cameraToCenterDistance,f=l._centerAltitude*u,x=l._camera,v=l._camera.forward(),S=Ps([],io([],v,-p),[0,0,f]),C=l.worldSize/(2*Math.PI),M=[0,0,-C],L=l.width/l.height,R=Math.tan(l.fovAboveCenter),V=io([],x.up(),R),q=io([],x.right(),R*L),Q=Yr([],Ps([],Ps([],v,V),q)),le=[];let ie;if(new Pf(S,Q).closestPointOnSphere(M,C,le)){const se=Ps([],le,M),me=ro([],se,S);ie=Math.cos(l.fovAboveCenter)*Au(me)}else{const se=ro([],S,M),me=ro([],M,S);Yr(me,me);const ue=Au(se)-C;ie=Math.sqrt(ue*(ue+2*C));const Ce=Math.acos(ie/(C+ue))-Math.acos($n(v,me));ie*=Math.cos(Ce)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Gu(e.zoom);if(n>0){const l=Ky(e,Nn(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return mi(t,l+u*(1-Math.cos(p)),Math.pow(n,10))}return t}upVector(e,t,n){return Vu(t,n,e,1)}upVectorScale(e){return{metersToTile:Qf*Zd(Co(e))}}}function tx(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Yy(i);case"equirectangular":return new s2(i);case"naturalEarth":return new l2(i);case"equalEarth":return new o2(i);case"winkelTripel":return new c2(i);case"albers":return t?new ex(i):new n2(i);case"lambertConformalConic":return t?new ex(i):new a2(i);case"globe":return new u2(i)}throw new Error(`Invalid projection name: ${i.name}`)}const h2=ja.VectorTileFeature.types,d2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hd(i,e,t,n,l,u,p,f,x,v,S,C,M){const L=f?Math.min(ks,Math.round(f[0])):0,R=f?Math.min(ks,Math.round(f[1])):0;i.emplaceBack(e,t,Math.round(32*n),Math.round(32*l),u,p,(L<<1)+(x?1:0),R,16*v,16*S,256*C,256*M)}function Kd(i,e,t,n,l,u,p){i.emplaceBack(e,t,n,l,u,p)}function Yd(i,e,t,n,l){i.emplaceBack(e,t,n,l),i.emplaceBack(e,t,n,l),i.emplaceBack(e,t,n,l),i.emplaceBack(e,t,n,l)}function p2(i){for(const e of i.sections)if(s(e.text))return!0;return!1}class rm{constructor(e){this.layoutVertexArray=new qi,this.indexArray=new Qt,this.programConfigurations=e,this.segments=new mr,this.dynamicLayoutVertexArray=new oi,this.opacityVertexArray=new zi,this.placedSymbolArray=new tg,this.globeExtVertexArray=new nr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,n,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,gw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,d2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_w.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}_t(rm,"SymbolBuffers");class nm{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new mr,this.collisionVertexArray=new Zi,this.collisionVertexArrayExt=new Xi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,yw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,xw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_t(nm,"CollisionBuffers");class Ls{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ao([]),this.placementViewportMatrix=Ao([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vf(this.zoom,t["text-size"]),this.iconSizeData=Vf(this.zoom,t["icon-size"]);const n=this.layers[0].layout,l=n.get("symbol-sort-key"),u=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(p=>Pn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new rm(new La(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new rm(new La(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ng,this.lineVertexArray=new og,this.symbolInstances=new rg}calculateGlyphDependencies(e,t,n,l,u){for(let p=0;p<e.length;p++)if(t[e.charCodeAt(p)]=!0,l&&u){const f=Ou[e.charAt(p)];f&&(t[f.charCodeAt(0)]=!0)}}populate(e,t,n,l){const u=this.layers[0],p=u.layout,f=this.projection.name==="globe",x=p.get("text-font"),v=p.get("text-field"),S=p.get("icon-image"),C=(v.value.kind!=="constant"||v.value.value instanceof Hr&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),M=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!C&&!M)return;const R=t.iconDependencies,V=t.glyphDependencies,q=t.availableImages,Q=new X(this.zoom);for(const{feature:le,id:ie,index:se,sourceLayerIndex:me}of e){const ue=u._featureFilter.needGeometry,Ce=Ra(le,ue);if(!u._featureFilter.filter(Q,Ce,n))continue;if(ue||(Ce.geometry=Jo(le,n,l)),f&&le.type!==1&&n.z<=5){const Me=Ce.geometry,Re=.98078528056;for(let Ne=0;Ne<Me.length;Ne++)Me[Ne]=_b(Me[Ne],Be=>Be,(Be,Je)=>$n(Vu(Be.x,Be.y,n,1),Vu(Je.x,Je.y,n,1))<Re)}let Ae,De;if(C){const Me=u.getValueAndResolveTokens("text-field",Ce,n,q),Re=Hr.factory(Me);p2(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||G()==="unavailable"||this.hasRTLText&&W.isParsed())&&(Ae=ww(Re,u,Ce))}if(M){const Me=u.getValueAndResolveTokens("icon-image",Ce,n,q);De=Me instanceof Kr?Me:Kr.fromString(Me)}if(!Ae&&!De)continue;const et=this.sortFeaturesByKey?L.evaluate(Ce,{},n):void 0;if(this.features.push({id:ie,text:Ae,icon:De,index:se,sourceLayerIndex:me,geometry:Ce.geometry,properties:le.properties,type:h2[le.type],sortKey:et}),De&&(R[De.name]=!0),Ae){const Me=x.evaluate(Ce,{},n).join(","),Re=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pn.vertical)>=0;for(const Ne of Ae.sections)if(Ne.image)R[Ne.image.name]=!0;else{const Be=Ol(Ae.toString()),Je=Ne.fontStack||Me,Ve=V[Je]=V[Je]||{};this.calculateGlyphDependencies(Ne.text,Ve,Re,this.allowVerticalPlacement,Be)}}}p.get("symbol-placement")==="line"&&(this.features=function(le){const ie={},se={},me=[];let ue=0;function Ce(Me){me.push(le[Me]),ue++}function Ae(Me,Re,Ne){const Be=se[Me];return delete se[Me],se[Re]=Be,me[Be].geometry[0].pop(),me[Be].geometry[0]=me[Be].geometry[0].concat(Ne[0]),Be}function De(Me,Re,Ne){const Be=ie[Re];return delete ie[Re],ie[Me]=Be,me[Be].geometry[0].shift(),me[Be].geometry[0]=Ne[0].concat(me[Be].geometry[0]),Be}function et(Me,Re,Ne){const Be=Ne?Re[0][Re[0].length-1]:Re[0][0];return`${Me}:${Be.x}:${Be.y}`}for(let Me=0;Me<le.length;Me++){const Re=le[Me],Ne=Re.geometry,Be=Re.text?Re.text.toString():null;if(!Be){Ce(Me);continue}const Je=et(Be,Ne),Ve=et(Be,Ne,!0);if(Je in se&&Ve in ie&&se[Je]!==ie[Ve]){const ct=De(Je,Ve,Ne),Wt=Ae(Je,Ve,me[ct].geometry);delete ie[Je],delete se[Ve],se[et(Be,me[Wt].geometry,!0)]=Wt,me[ct].geometry=null}else Je in se?Ae(Je,Ve,Ne):Ve in ie?De(Je,Ve,Ne):(Ce(Me),ie[Je]=ue-1,se[Ve]=ue-1)}return me.filter(Me=>Me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,ie)=>le.sortKey-ie.sortKey)}update(e,t,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n,l),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let u=e.dist(t[l+1]),p=e.dist(t[l]);const f={};for(let x=l+1;x<t.length;x++)f[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:u},x<t.length-1&&(u+=t[x+1].dist(t[x]));for(let x=l||0;x>=0;x--)f[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=t[x-1].dist(t[x]));for(let x=0;x<t.length;x++){const v=f[x];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,l,u,p,f,x,v,S,C,M,L,R){const V=e.indexArray,q=e.layoutVertexArray,Q=e.globeExtVertexArray,le=e.segments.prepareSegment(4*t.length,q,V,this.canOverlap?p.sortKey:void 0),ie=this.glyphOffsetArray.length,se=le.vertexLength,me=this.allowVerticalPlacement&&f===Pn.vertical?Math.PI/2:0,ue=p.text&&p.text.sections;for(let Ae=0;Ae<t.length;Ae++){const{tl:De,tr:et,bl:Me,br:Re,tex:Ne,pixelOffsetTL:Be,pixelOffsetBR:Je,minFontScaleX:Ve,minFontScaleY:ct,glyphOffset:Wt,isSDF:Ht,sectionIndex:Ct}=t[Ae],nt=le.vertexLength,si=Wt[1];if(Hd(q,v.x,v.y,De.x,si+De.y,Ne.x,Ne.y,n,Ht,Be.x,Be.y,Ve,ct),Hd(q,v.x,v.y,et.x,si+et.y,Ne.x+Ne.w,Ne.y,n,Ht,Je.x,Be.y,Ve,ct),Hd(q,v.x,v.y,Me.x,si+Me.y,Ne.x,Ne.y+Ne.h,n,Ht,Be.x,Je.y,Ve,ct),Hd(q,v.x,v.y,Re.x,si+Re.y,Ne.x+Ne.w,Ne.y+Ne.h,n,Ht,Je.x,Je.y,Ve,ct),x){const Vt=x.anchor,mt=x.up;Kd(Q,Vt.x,Vt.y,Vt.z,mt[0],mt[1],mt[2]),Kd(Q,Vt.x,Vt.y,Vt.z,mt[0],mt[1],mt[2]),Kd(Q,Vt.x,Vt.y,Vt.z,mt[0],mt[1],mt[2]),Kd(Q,Vt.x,Vt.y,Vt.z,mt[0],mt[1],mt[2]),Yd(e.dynamicLayoutVertexArray,Vt.x,Vt.y,Vt.z,me)}else Yd(e.dynamicLayoutVertexArray,v.x,v.y,v.z,me);V.emplaceBack(nt,nt+1,nt+2),V.emplaceBack(nt+1,nt+2,nt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wt[0]),Ae!==t.length-1&&Ct===t[Ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,p,p.index,{},L,R,ue&&ue[Ct])}const Ce=x?x.anchor:v;e.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,v.x,v.y,ie,this.glyphOffsetArray.length-ie,se,S,C,v.segment,n?n[0]:0,n?n[1]:0,l[0],l[1],f,0,!1,0,M,0)}_commitLayoutVertex(e,t,n,l,u,p,f){e.emplaceBack(t,n,l,u,p,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,t,n,l,u,p,f){const x=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),v=x.vertexLength,S=f.tileAnchorX,C=f.tileAnchorY;for(let L=0;L<4;L++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,S,C,new B(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,S,C,new B(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,S,C,new B(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,S,C,new B(e.x1,e.y2)),x.vertexLength+=4;const M=n.indexArray;M.emplaceBack(v,v+1),M.emplaceBack(v+1,v+2),M.emplaceBack(v+2,v+3),M.emplaceBack(v+3,v),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),v=this.getSymbolInstanceTextSize(e,p,t,f);this._addCollisionDebugVertices(x,v,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,t,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),v=this.getSymbolInstanceIconSize(e,t,f);this._addCollisionDebugVertices(x,v,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nm(zn,fy.members,$r),this.iconCollisionBox=new nm(zn,fy.members,$r);const n=Zl(this.iconSizeData,e),l=Zl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,t,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,t,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,t,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,t,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,t,n,l){const u=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:l),p=Od(this.textSizeData,e,u)/Or;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,t,n){const l=this.icon.placedSymbolArray.get(n),u=Od(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),v=this.getSymbolInstanceTextSize(e,p,t,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,x.padding)}}_updateIconDebugCollisionBoxes(e,t,n,l,u){for(let p=l;p<u;p++){const f=n.get(p),x=this.getSymbolInstanceIconSize(e,t,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,f.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Zl(this.iconSizeData,e),l=Zl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,t,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,t,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(n,e,t,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,t,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,l,u,p,f,x,v){const S={};for(let C=t;C<n;C++){const M=e.get(C);S.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},S.textFeatureIndex=M.featureIndex;break}for(let C=l;C<u;C++){const M=e.get(C);S.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},S.verticalTextFeatureIndex=M.featureIndex;break}for(let C=p;C<f;C++){const M=e.get(C);S.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},S.iconFeatureIndex=M.featureIndex;break}for(let C=x;C<v;C++){const M=e.get(C);S.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},S.verticalIconFeatureIndex=M.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),l=n.vertexStartIndex+4*n.numGlyphs;for(let u=n.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),l=[],u=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const x=this.symbolInstances.get(f);l.push(0|Math.round(t*x.tileAnchorX+n*x.tileAnchorY)),u.push(x.featureIndex)}return p.sort((f,x)=>l[f]-l[x]||u[x]-u[f]),p}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const n=this.symbolInstances.get(t);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((l,u,p)=>{l>=0&&p.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}_t(Ls,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ls.MAX_GLYPHS=65535,Ls.addDynamicAttributes=Yd;const f2=new Le({"symbol-placement":new he(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new he(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xe(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new he(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new xe(ke.layout_symbol["icon-size"]),"icon-text-fit":new he(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new he(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new xe(ke.layout_symbol["icon-image"]),"icon-rotate":new xe(ke.layout_symbol["icon-rotate"]),"icon-padding":new he(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new he(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new xe(ke.layout_symbol["icon-offset"]),"icon-anchor":new xe(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(ke.layout_symbol["text-rotation-alignment"]),"text-field":new xe(ke.layout_symbol["text-field"]),"text-font":new xe(ke.layout_symbol["text-font"]),"text-size":new xe(ke.layout_symbol["text-size"]),"text-max-width":new xe(ke.layout_symbol["text-max-width"]),"text-line-height":new xe(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new xe(ke.layout_symbol["text-letter-spacing"]),"text-justify":new xe(ke.layout_symbol["text-justify"]),"text-radial-offset":new xe(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new xe(ke.layout_symbol["text-anchor"]),"text-max-angle":new he(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new he(ke.layout_symbol["text-writing-mode"]),"text-rotate":new xe(ke.layout_symbol["text-rotate"]),"text-padding":new he(ke.layout_symbol["text-padding"]),"text-keep-upright":new he(ke.layout_symbol["text-keep-upright"]),"text-transform":new xe(ke.layout_symbol["text-transform"]),"text-offset":new xe(ke.layout_symbol["text-offset"]),"text-allow-overlap":new he(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(ke.layout_symbol["text-ignore-placement"]),"text-optional":new he(ke.layout_symbol["text-optional"])});var om={paint:new Le({"icon-opacity":new xe(ke.paint_symbol["icon-opacity"]),"icon-color":new xe(ke.paint_symbol["icon-color"]),"icon-halo-color":new xe(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new xe(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xe(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new he(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new xe(ke.paint_symbol["text-opacity"]),"text-color":new xe(ke.paint_symbol["text-color"],{runtimeType:An,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new xe(ke.paint_symbol["text-halo-color"]),"text-halo-width":new xe(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new xe(ke.paint_symbol["text-halo-blur"]),"text-translate":new he(ke.paint_symbol["text-translate"]),"text-translate-anchor":new he(ke.paint_symbol["text-translate-anchor"])}),layout:f2};class ix{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:hs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t(ix,"FormatSectionOverride",{omit:["defaultValue"]});class Jd extends to{constructor(e){super(e,om)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const l=[];for(const u of n)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,l){const u=this.layout.get(e).evaluate(t,{},n,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Il(p.value)||!u?u:function(f,x){return x.replace(/{([^{}]+)}/g,(v,S)=>S in f?String(f[S]):"")}(t.properties,u)}createBucket(e){return new Ls(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of om.paint.overridableProperties){if(!Jd.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new ix(t),l=new nu(n,t.property.specification);let u=null;u=t.value.kind==="constant"||t.value.kind==="source"?new ou("source",l):new ba("composite",l,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new ae(t.property,u,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&Jd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),l=om.paint.properties[t];let u=!1;const p=f=>{for(const x of f)if(l.overrides&&l.overrides.hasOverride(x))return void(u=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Hr)p(n.value.value.sections);else if(n.value.kind==="source"){const f=v=>{u||(v instanceof ca&&cr(v.value)===oa?p(v.value.sections):v instanceof ha?p(v.sections):v.eachChild(f))},x=n.value;x._styleExpression&&f(x._styleExpression.expression)}return u}getProgramConfiguration(e){return new Ms(this,e)}}var m2={paint:new Le({"background-color":new he(ke.paint_background["background-color"]),"background-pattern":new Ye(ke.paint_background["background-pattern"]),"background-opacity":new he(ke.paint_background["background-opacity"])})},_2={paint:new Le({"raster-opacity":new he(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new he(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new he(ke.paint_raster["raster-saturation"]),"raster-contrast":new he(ke.paint_raster["raster-contrast"]),"raster-resampling":new he(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new he(ke.paint_raster["raster-fade-duration"])})};class g2 extends to{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var y2={paint:new Le({"sky-type":new he(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new we(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(ke.paint_sky["sky-opacity"])})};function sm(i,e,t){const n=[0,0,1],l=Og([]);return Ug(l,l,t?-ve(i)+Math.PI:ve(i)),Fg(l,l,-ve(e)),Lg(n,n,l),Yr(n,n)}const x2={circle:class extends to{constructor(i){super(i,Tb)}createBucket(i){return new bf(i)}queryRadius(i){const e=i;return Nl("circle-radius",this,e)+Nl("circle-stroke-width",this,e)+Td(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,n,l,u,p,f){const x=Cg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return jg(i,n,u,p,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,v)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Ms(this,i)}},heatmap:class extends to{createBucket(i){return new Vg(i)}constructor(i){super(i,zb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Nl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,n,l,u,p,f){const x=this.paint.get("heatmap-radius").evaluate(e,t);return jg(i,n,u,p,f,!0,!0,new B(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Ms(this,i)}},hillshade:class extends to{constructor(i){super(i,Pb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends to{constructor(i){super(i,Xb)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new Ms(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new kd(i)}queryRadius(){return Td(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,n,l,u){return!i.queryGeometry.isAboveHorizon&&Tg(Ig(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends to{constructor(i){super(i,aw)}createBucket(i){return new Lu(i)}queryRadius(){return Td(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Ms(this,i)}queryIntersectsFeature(i,e,t,n,l,u,p,f,x){const v=Cg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,t),C=this.paint.get("fill-extrusion-base").evaluate(e,t),M=[0,0],L=f&&u.elevation,R=u.elevation?u.elevation.exaggeration():1,V=i.tile.getBucket(this);if(L&&V instanceof Lu){const le=V.centroidVertexArray,ie=x+1;if(ie<le.length){const se=le.get(ie);M[0]=se.a_centroid_pos0,M[1]=se.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;u.projection.name==="globe"&&(n=sy([n],[new B(0,0),new B(jt,jt)],i.tileID.canonical).map(le=>le.polygon).flat());const q=function(le,ie,se,me,ue,Ce,Ae,De,et,Me,Re){return le.projection.name==="globe"?function(Ne,Be,Je,Ve,ct,Wt,Ht,Ct,nt,si,Vt){const mt=[],Ni=[],Li=Ne.projection.upVectorScale(Vt,Ne.center.lat,Ne.worldSize).metersToTile,Hi=[0,0,0,1],Kt=[0,0,0,1],gi=(Ri,Pi,Wi,Ji)=>{Ri[0]=Pi,Ri[1]=Wi,Ri[2]=Ji,Ri[3]=1},Vi=oy();Je>0&&(Je+=Vi),Ve+=Vi;for(const Ri of Be){const Pi=[],Wi=[];for(const Ji of Ri){const Ir=Ji.x+ct.x,ln=Ji.y+ct.y,ci=Ne.projection.projectTilePoint(Ir,ln,Vt),sr=Ne.projection.upVector(Vt,Ji.x,Ji.y);let qr=Je,Ti=Ve;if(Ht){const Qi=uy(Ir,ln,Je,Ve,Ht,Ct,nt,si);qr+=Qi.base,Ti+=Qi.top}Je!==0?gi(Hi,ci.x+sr[0]*Li*qr,ci.y+sr[1]*Li*qr,ci.z+sr[2]*Li*qr):gi(Hi,ci.x,ci.y,ci.z),gi(Kt,ci.x+sr[0]*Li*Ti,ci.y+sr[1]*Li*Ti,ci.z+sr[2]*Li*Ti),yr(Hi,Hi,Wt),yr(Kt,Kt,Wt),Pi.push(Rd(Hi)),Wi.push(Rd(Kt))}mt.push(Pi),Ni.push(Wi)}return[mt,Ni]}(le,ie,se,me,ue,Ce,Ae,De,et,Me,Re):Ae?function(Ne,Be,Je,Ve,ct,Wt,Ht,Ct,nt){const si=[],Vt=[],mt=[0,0,0,1];for(const Ni of Ne){const Li=[],Hi=[];for(const Kt of Ni){const gi=Kt.x+Ve.x,Vi=Kt.y+Ve.y,Ri=uy(gi,Vi,Be,Je,Wt,Ht,Ct,nt);mt[0]=gi,mt[1]=Vi,mt[2]=Ri.base,mt[3]=1,Fa(mt,mt,ct),mt[3]=Math.max(mt[3],1e-5);const Pi=Rd([mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]]);mt[0]=gi,mt[1]=Vi,mt[2]=Ri.top,mt[3]=1,Fa(mt,mt,ct),mt[3]=Math.max(mt[3],1e-5);const Wi=Rd([mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]]);Li.push(Pi),Hi.push(Wi)}si.push(Li),Vt.push(Hi)}return[si,Vt]}(ie,se,me,ue,Ce,Ae,De,et,Me):function(Ne,Be,Je,Ve,ct){const Wt=[],Ht=[],Ct=ct[8]*Be,nt=ct[9]*Be,si=ct[10]*Be,Vt=ct[11]*Be,mt=ct[8]*Je,Ni=ct[9]*Je,Li=ct[10]*Je,Hi=ct[11]*Je;for(const Kt of Ne){const gi=[],Vi=[];for(const Ri of Kt){const Pi=Ri.x+Ve.x,Wi=Ri.y+Ve.y,Ji=ct[0]*Pi+ct[4]*Wi+ct[12],Ir=ct[1]*Pi+ct[5]*Wi+ct[13],ln=ct[2]*Pi+ct[6]*Wi+ct[14],ci=ct[3]*Pi+ct[7]*Wi+ct[15],sr=Ji+Ct,qr=Ir+nt,Ti=ln+si,Qi=Math.max(ci+Vt,1e-5),Qr=Ji+mt,Ki=Ir+Ni,ur=ln+Li,Cr=Math.max(ci+Hi,1e-5),vr=new B(sr/Qi,qr/Qi);vr.z=Ti/Qi,gi.push(vr);const Fr=new B(Qr/Cr,Ki/Cr);Fr.z=ur/Cr,Vi.push(Fr)}Wt.push(gi),Ht.push(Vi)}return[Wt,Ht]}(ie,se,me,ue,Ce)}(u,n,C,S,v,p,L?f:null,M,R,u.center.lat,i.tileID.canonical),Q=i.queryGeometry;return function(le,ie,se){let me=1/0;Tg(se,ie)&&(me=cy(se,ie[0]));for(let ue=0;ue<ie.length;ue++){const Ce=ie[ue],Ae=le[ue];for(let De=0;De<Ce.length-1;De++){const et=Ce[De],Me=[et,Ce[De+1],Ae[De+1],Ae[De],et];wg(se,Me)&&(me=Math.min(me,cy(se,Me)))}}return me!==1/0&&me}(q[0],q[1],Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends to{constructor(i){super(i,hy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Fc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=dy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Bd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Ms(this,i)}queryRadius(i){const e=i,t=py(Nl("line-width",this,e),Nl("line-gap-width",this,e)),n=Nl("line-offset",this,e);return t/2+Math.abs(n)+Td(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,n,l,u){if(i.queryGeometry.isAboveHorizon)return!1;const p=Ig(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),f=i.pixelToTileUnitsFactor/2*py(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),x=this.paint.get("line-offset").evaluate(e,t);return x&&(n=function(v,S){const C=[],M=new B(0,0);for(let L=0;L<v.length;L++){const R=v[L],V=[];for(let q=0;q<R.length;q++){const Q=R[q-1],le=R[q],ie=R[q+1],se=q===0?M:le.sub(Q)._unit()._perp(),me=q===R.length-1?M:ie.sub(le)._unit()._perp(),ue=se._add(me)._unit();ue._mult(1/(ue.x*me.x+ue.y*me.y)),V.push(ue._mult(S)._add(le))}C.push(V)}return C}(n,x*i.pixelToTileUnitsFactor)),function(v,S,C){for(let M=0;M<S.length;M++){const L=S[M];if(v.length>=3){for(let R=0;R<L.length;R++)if(Ba(v,L[R]))return!0}if(xb(v,L,C))return!0}return!1}(p,n,f)}isTileClipped(){return!0}},symbol:Jd,background:class extends to{constructor(i){super(i,m2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends to{constructor(i){super(i,_2)}getProgramIds(){return["raster"]}},sky:class extends to{constructor(i){super(i,y2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),l=!n,u=i.style.light,p=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?sm(p.azimuthal,90-p.polar,e):sm(n[0],90-n[1],e)}const t=this.paint.get("sky-gradient-center");return sm(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class Hu{constructor(e,t,n,l){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,l)}update(e,t,n){const{width:l,height:u}=e,{context:p}=this,{gl:f}=p,{HTMLImageElement:x,HTMLCanvasElement:v,HTMLVideoElement:S,ImageData:C,ImageBitmap:M}=k;if(f.bindTexture(f.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!t||t.premultiply!==!1)),n||this.size&&this.size[0]===l&&this.size[1]===u){const{x:L,y:R}=n||{x:0,y:0};e instanceof x||e instanceof v||e instanceof S||e instanceof C||M&&e instanceof M?f.texSubImage2D(f.TEXTURE_2D,0,L,R,f.RGBA,f.UNSIGNED_BYTE,e):f.texSubImage2D(f.TEXTURE_2D,0,L,R,l,u,f.RGBA,f.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof x||e instanceof v||e instanceof S||e instanceof C||M&&e instanceof M?f.texImage2D(f.TEXTURE_2D,0,this.format,this.format,f.UNSIGNED_BYTE,e):f.texImage2D(f.TEXTURE_2D,0,this.format,l,u,0,this.format,f.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class am{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Qo({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=ri(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const l=[];let u=e.length%2==1?-e[e.length-1]*n:0,p=e[0]*n,f=!0;l.push({left:u,right:p,isDash:f,zeroLength:e[0]===0});let x=e[0];for(let v=1;v<e.length;v++){f=!f;const S=e[v];u=x*n,x+=S,p=x*n,l.push({left:u,right:p,isDash:f,zeroLength:S===0})}return l}addRoundDash(e,t,n){const l=t/2;for(let u=-n;u<=n;u++){const p=this.width*(this.nextRow+n+u);let f=0,x=e[f];for(let v=0;v<this.width;v++){v/x.right>1&&(x=e[++f]);const S=Math.abs(v-x.left),C=Math.abs(v-x.right),M=Math.min(S,C);let L;const R=u/n*(l+1);if(x.isDash){const V=l-Math.abs(R);L=Math.sqrt(M*M+V*V)}else L=l-Math.sqrt(M*M+R*R);this.image.data[p+v]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,t){for(let x=e.length-1;x>=0;--x){const v=e[x],S=e[x+1];v.zeroLength?e.splice(x,1):S&&S.isDash===v.isDash&&(S.left=v.left,e.splice(x,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let p=0,f=e[p];for(let x=0;x<this.width;x++){x/f.right>1&&(f=e[++p]);const v=Math.abs(x-f.left),S=Math.abs(x-f.right),C=Math.min(v,S);this.image.data[u+x]=Math.max(0,Math.min(255,(f.isDash?C:-C)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const l=t==="round",u=l?7:0,p=2*u+1;if(this.nextRow+p>this.height)return bi("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let S=0;S<e.length;S++)e[S]<0&&(bi("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),f+=e[S];if(f!==0){const S=this.width/f,C=this.getDashRanges(e,this.width,S);l?this.addRoundDash(C,S,u):this.addRegularDash(C,t==="square"?.5*S:0)}const x=this.nextRow+u;this.nextRow+=p;const v={tl:[x,u],br:[f,0]};return this.positions[n]=v,v}}_t(am,"LineAtlas");class v2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class b2{constructor(){this.tasks={},this.taskQueue=[],vi(["process"],this),this.invoker=new v2(this.process),this.nextId=0}add(e,t){const n=this.nextId++,l=function({type:u,isSymbolTile:p,zoom:f}){return f=f||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-f:u==="maybePrepare"&&p?400-f:500:200-f:100-f}(t);if(l===0){$e();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:l,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){$e();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<t&&(t=u.priority,e=l)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class rx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const w2=["tile","layer","source","sourceLayer","state"];class nx{constructor(e,t,n,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of w2)this[t]!==void 0&&(e[t]=this[t]);return e}}const Gn=32,Mo=33,Rs=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,n=0,l=0,u=0,p=0,f=0;for(1&e?l=u=p=Gn:t=n=f=Gn;(e>>=1)>1;){const v=t+l>>1,S=n+u>>1;1&e?(l=t,u=n,t=p,n=f):(t=l,n=u,l=p,u=f),p=v,f=S}const x=4*i;Rs[x+0]=t,Rs[x+1]=n,Rs[x+2]=l,Rs[x+3]=u}const zo=new Uint16Array(2178),Bs=new Uint8Array(1089),Qd=new Uint16Array(1089);function ox(i){return i===0?-.03125:i===32?.03125:0}var sx=Oe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ax={type:2,extent:jt,loadGeometry:()=>[[new B(0,0),new B(8193,0),new B(8193,8193),new B(0,8193),new B(0,0)]]};class lm{constructor(e,t,n,l,u){this.tileID=e,this.uid=bt(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<rt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Na(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const p={};if(!u)return p;for(const f of l){const x=f.layerIds.map(v=>u.getLayer(v)).filter(Boolean);if(x.length!==0){f.layers=x,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>x.filter(S=>S.id===v)[0]));for(const v of x)p[v.id]=f}}return p}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Ls){if(this.hasSymbolBuckets=!0,!n)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Ls&&u.hasRTLText){this.hasRTLText=!0,W.isLoading()||W.isLoaded()||G()!=="deferred"||K();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new To}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const l=this.buckets[n];l.uploadPending()&&l.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hu(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hu(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hu(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,l,u,p,f,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:f,transform:p,params:u,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const l=n.loadVTLayers(),u=t?t.sourceLayer:"",p=l._geojsonTileLayer||l[u];if(!p)return;const f=Sa(t&&t.filter),{z:x,x:v,y:S}=this.tileID.canonical,C={z:x,x:v,y:S};for(let M=0;M<p.length;M++){const L=p.feature(M);if(f.needGeometry){const q=Ra(L,!0);if(!f.filter(new X(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!f.filter(new X(this.tileID.overscaledZ),L))continue;const R=n.getId(L,u),V=new nx(L,x,v,S,R);V.tile=C,e.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const n=St(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let l=!1;if(this.expirationTime>n)l=!1;else if(t)if(this.expirationTime<t)l=!0;else{const u=this.expirationTime-t;u?this.expirationTime=n+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const n=this.latestFeatureIndex.loadVTLayers(),l=t.style.listImages();for(const u in this.buckets){if(!t.style.hasLayer(u))continue;const p=this.buckets[u],f=p.layers[0].sourceLayer||"_geojsonTileLayer",x=n[f],v=e[f];if(!x||!v||Object.keys(v).length===0)continue;if(p.update(v,x,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof Bd||p instanceof kd){const C=t.style._getSourceCache(p.layers[0].source);t._terrain&&t._terrain.enabled&&C&&p.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(C.id,this.tileID)}const S=t&&t.style&&t.style.getLayer(u);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<rt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=rt.now()+e}setTexture(e,t){const n=t.context,l=n.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Hu(n,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,t){const n={};for(const l of t)n[l]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const l=this.dependencies[n];if(l){for(const u of t)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const n=Jo(ax,this.tileID.canonical,this.tileTransform)[0],l=new ot,u=new qo;for(let p=0;p<n.length;p++){const{x:f,y:x}=n[p];l.emplaceBack(f,x),u.emplaceBack(p)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,Nu.members),this._tileDebugSegments=mr.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const n=Jo(ax,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const p=function(f,x){const v=Na(f,x),S=Math.pow(2,f.z);for(let q=0;q<Mo;q++)for(let Q=0;Q<Mo;Q++){const le=Vn((f.x+(Q+ox(Q))/Gn)/S),ie=Br((f.y+(q+ox(q))/Gn)/S),se=x.project(le,ie),me=q*Mo+Q;zo[2*me+0]=Math.round((se.x*v.scale-v.x)*jt),zo[2*me+1]=Math.round((se.y*v.scale-v.y)*jt)}Bs.fill(0),Qd.fill(0);for(let q=2045;q>=0;q--){const Q=4*q,le=Rs[Q+0],ie=Rs[Q+1],se=Rs[Q+2],me=Rs[Q+3],ue=le+se>>1,Ce=ie+me>>1,Ae=ue+Ce-ie,De=Ce+le-ue,et=ie*Mo+le,Me=me*Mo+se,Re=Ce*Mo+ue,Ne=Math.hypot((zo[2*et+0]+zo[2*Me+0])/2-zo[2*Re+0],(zo[2*et+1]+zo[2*Me+1])/2-zo[2*Re+1])>=16;if(Bs[Re]=Bs[Re]||(Ne?1:0),q<1022){const Be=(ie+De>>1)*Mo+(le+Ae>>1),Je=(me+De>>1)*Mo+(se+Ae>>1);Bs[Re]=Bs[Re]||Bs[Be]||Bs[Je]}}const C=new Mt,M=new Qt;let L=0;function R(q,Q){const le=Q*Mo+q;return Qd[le]===0&&(C.emplaceBack(zo[2*le+0],zo[2*le+1],q*jt/Gn,Q*jt/Gn),Qd[le]=++L),Qd[le]-1}function V(q,Q,le,ie,se,me){const ue=q+le>>1,Ce=Q+ie>>1;if(Math.abs(q-se)+Math.abs(Q-me)>1&&Bs[Ce*Mo+ue])V(se,me,q,Q,ue,Ce),V(le,ie,se,me,ue,Ce);else{const Ae=R(q,Q),De=R(le,ie),et=R(se,me);M.emplaceBack(Ae,De,et)}}return V(0,0,Gn,Gn,Gn,0),V(Gn,Gn,0,0,0,Gn),{vertices:C,indices:M}}(this.tileID.canonical,t);l=p.vertices,u=p.indices}else{l=new Mt,u=new Qt;for(const{x:f,y:x}of n)l.emplaceBack(f,x,0,0);const p=Id(l.int16,void 0,4);for(let f=0;f<p.length;f+=3)u.emplaceBack(p[f],p[f+1],p[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,sx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=mr.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||n.name!=="globe"||t.freezeTileCoverage)return;const l=this.tileID.canonical,u=$u(Gy(l,t)),p=Gu(t.zoom);let f;p>0&&(f=Ef(new Float64Array(16),t.globeMatrix));const x=(l.x+.5)/(1<<l.z)-Eo(t.center.lng);let v=0;x>.5?v=-1:x<-.5&&(v=1),this._makeGlobeTileDebugBorderBuffer(e,l,t,u,f,p,v),this._makeGlobeTileDebugTextBuffer(e,l,t,u,f,p,v)}_globePoint(e,t,n,l,u,p,f,x){let v=Vu(e,t,n);if(p){const S=1<<n.z,C=[((e/jt+n.x)/S+x)*l,(t/jt+n.y)/S*l,0];yr(C,C,p),v=ms(v,C,f)}return yr(v,v,u)}_makeGlobeTileDebugBorderBuffer(e,t,n,l,u,p,f){const x=new ot,v=new qo,S=new wt,C=(L,R,V,q,Q)=>{const le=(V-L)/(Q-1),ie=(q-R)/(Q-1),se=x.length;for(let me=0;me<Q;me++){const ue=L+me*le,Ce=R+me*ie;x.emplaceBack(ue,Ce);const Ae=this._globePoint(ue,Ce,t,n.worldSize,l,u,p,f);S.emplaceBack(Ae[0],Ae[1],Ae[2]),v.emplaceBack(se+me)}},M=jt;C(0,0,M,0,16),C(M,0,M,M,16),C(M,M,0,M,16),C(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(x,Nu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,Vy.members),this._tileDebugSegments=mr.simpleSegment(0,0,x.length,v.length)}_makeGlobeTileDebugTextBuffer(e,t,n,l,u,p,f){const x=new ot,v=new Qt,S=new wt,C=25;v.reserve(32),x.reserve(C),S.reserve(C);const M=(L,R)=>C*L+R;for(let L=0;L<C;L++){const R=2048*L;for(let V=0;V<C;V++){const q=2048*V;x.emplaceBack(q,R);const Q=this._globePoint(q,R,t,n.worldSize,l,u,p,f);S.emplaceBack(Q[0],Q[1],Q[2])}}for(let L=0;L<4;L++)for(let R=0;R<4;R++){const V=M(L,R),q=M(L,R+1),Q=M(L+1,R),le=M(L+1,R+1);v.emplaceBack(V,q,Q),v.emplaceBack(Q,q,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(v),this._tileDebugTextBuffer=e.createVertexBuffer(x,Nu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,Vy.members),this._tileDebugTextSegments=mr.simpleSegment(0,0,C,32)}}class T2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},gt(this.stateChanges[e][l],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])n[u]||(this.deletedStates[e][l][u]=null)}else for(const u in n)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,t,n){if(this.deletedStates[e]===null)return;const l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(n in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][n]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),l=gt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][t];if(u===null)return{};for(const p in u)delete l[p]}return l}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),gt(this.state[l][p],this.stateChanges[l][p]),u[p]=this.state[l][p];n[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const p in this.state[l])u[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else for(const f of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][f];u[p]=this.state[l][p]}n[l]=n[l]||{},gt(n[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const l in e)e[l].setFeatureState(n,t)}}class lx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function cx(i,e,t,n){let l=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(n[p])<1e-15){if(t[p]<i[p]||t[p]>e[p])return null}else{const f=1/n[p];let x=(i[p]-t[p])*f,v=(e[p]-t[p])*f;if(x>v){const S=x;x=v,v=S}if(x>l&&(l=x),v<u&&(u=v),l>u)return null}return l}function ux(i,e,t,n,l,u,p,f,x,v,S){const C=n-i,M=l-e,L=u-t,R=p-i,V=f-e,q=x-t,Q=S[1]*q-S[2]*V,le=S[2]*R-S[0]*q,ie=S[0]*V-S[1]*R,se=C*Q+M*le+L*ie;if(Math.abs(se)<1e-15)return null;const me=1/se,ue=v[0]-i,Ce=v[1]-e,Ae=v[2]-t,De=(ue*Q+Ce*le+Ae*ie)*me;if(De<0||De>1)return null;const et=Ce*L-Ae*M,Me=Ae*C-ue*L,Re=ue*M-Ce*C,Ne=(S[0]*et+S[1]*Me+S[2]*Re)*me;return Ne<0||De+Ne>1?null:(R*et+V*Me+q*Re)*me}function hx(i,e,t){return(i-e)/(t-e)}function dx(i,e,t,n,l,u,p,f,x){const v=1<<t,S=u-n,C=p-l,M=(i+1)/v*S+n,L=(e+0)/v*C+l,R=(e+1)/v*C+l;f[0]=(i+0)/v*S+n,f[1]=L,x[0]=M,x[1]=R}class px{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(u){const p=Math.ceil(Math.log2(u.dim/8)),f=[];let x=Math.ceil(Math.pow(2,p));const v=1/x,S=(L,R,V,q,Q)=>{const le=q?1:0,ie=(L+1)*V-le,se=R*V,me=(R+1)*V-le;Q[0]=L*V,Q[1]=se,Q[2]=ie,Q[3]=me};let C=new lx(x);const M=[];for(let L=0;L<x*x;L++){S(L%x,Math.floor(L/x),v,!1,M);const R=Os(M[0],M[1],u),V=Os(M[2],M[1],u),q=Os(M[2],M[3],u),Q=Os(M[0],M[3],u);C.minimums.push(Math.min(R,V,q,Q)),C.maximums.push(Math.max(R,V,q,Q)),C.leaves.push(1)}for(f.push(C),x/=2;x>=1;x/=2){const L=f[f.length-1];C=new lx(x);for(let R=0;R<x*x;R++){S(R%x,Math.floor(R/x),2,!0,M);const V=L.getElevation(M[0],M[1]),q=L.getElevation(M[2],M[1]),Q=L.getElevation(M[2],M[3]),le=L.getElevation(M[0],M[3]),ie=L.isLeaf(M[0],M[1]),se=L.isLeaf(M[2],M[1]),me=L.isLeaf(M[2],M[3]),ue=L.isLeaf(M[0],M[3]),Ce=Math.min(V.min,q.min,Q.min,le.min),Ae=Math.max(V.max,q.max,Q.max,le.max),De=ie&&se&&me&&ue;C.maximums.push(Ae),C.minimums.push(Ce),C.leaves.push(Ae-Ce<=5&&De?1:0)}f.push(C)}return f}(this.dem),n=t.length-1,l=t[n];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,l,u,p,f=1){return cx([e,t,-100],[n,l,this.maximums[0]*f],u,p)}raycast(e,t,n,l,u,p,f=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,t,n,l,u,p,f);if(x==null)return null;const v=[],S=[],C=[],M=[],L=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:R,t:V,nodex:q,nodey:Q,depth:le}=L.pop();if(this.leaves[R]){dx(q,Q,le,e,t,n,l,C,M);const se=1<<le,me=(q+0)/se,ue=(q+1)/se,Ce=(Q+0)/se,Ae=(Q+1)/se,De=Os(me,Ce,this.dem)*f,et=Os(ue,Ce,this.dem)*f,Me=Os(ue,Ae,this.dem)*f,Re=Os(me,Ae,this.dem)*f,Ne=ux(C[0],C[1],De,M[0],C[1],et,M[0],M[1],Me,u,p),Be=ux(M[0],M[1],Me,C[0],M[1],Re,C[0],C[1],De,u,p),Je=Math.min(Ne!==null?Ne:Number.MAX_VALUE,Be!==null?Be:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const Ve=Ad([],u,p,V);if(fx(De,et,Re,Me,hx(Ve[0],C[0],M[0]),hx(Ve[1],C[1],M[1]))>=Ve[2])return V}continue}let ie=0;for(let se=0;se<this._siblingOffset.length;se++){dx((q<<1)+this._siblingOffset[se][0],(Q<<1)+this._siblingOffset[se][1],le+1,e,t,n,l,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[R]+se]*f;const me=cx(C,M,u,p);if(me!=null){const ue=me;v[se]=ue;let Ce=!1;for(let Ae=0;Ae<ie&&!Ce;Ae++)ue>=v[S[Ae]]&&(S.splice(Ae,0,se),Ce=!0);Ce||(S[ie]=se),ie++}}for(let se=0;se<ie;se++){const me=S[se];L.push({idx:this.childOffsets[R]+me,t:v[me],nodex:(q<<1)+this._siblingOffset[me][0],nodey:(Q<<1)+this._siblingOffset[me][1],depth:le+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,l,u){if(e[l].isLeaf(t,n)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=l-1,f=e[p];let x=0,v=0;for(let S=0;S<this._siblingOffset.length;S++){const C=2*t+this._siblingOffset[S][0],M=2*n+this._siblingOffset[S][1],L=f.getElevation(C,M),R=f.isLeaf(C,M),V=this._addNode(L.min,L.max,R);R&&(x|=1<<S),v||(v=V)}for(let S=0;S<this._siblingOffset.length;S++)x&1<<S||this._construct(e,2*t+this._siblingOffset[S][0],2*n+this._siblingOffset[S][1],p,v+S)}}function fx(i,e,t,n,l,u){return mi(mi(i,t,u),mi(e,n,u),l)}function Os(i,e,t){const n=t.dim,l=He(i*n-.5,0,n-1),u=He(e*n-.5,0,n-1),p=Math.floor(l),f=Math.floor(u),x=Math.min(p+1,n-1),v=Math.min(f+1,n-1);return fx(t.get(p,f),t.get(x,f),t.get(p,v),t.get(x,v),l-p,u-f)}const mx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ep{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,l=!1,u=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return bi(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const p=this.dim=t.height-2,f=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=l,!l){for(let x=0;x<p;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(p,x)]=f[this._idx(p-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,p)]=f[this._idx(x,p-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(p,-1)]=f[this._idx(p-1,0)],f[this._idx(-1,p)]=f[this._idx(0,p-1)],f[this._idx(p,p)]=f[this._idx(p-1,p-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new px(this)}get(e,t,n=!1){n&&(e=He(e,-1,this.dim),t=He(t,-1,this.dim));const l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return mx[e]}get unpackVector(){return mx[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,n){return(256*e*256+256*t+n)/10-1e4}_unpackTerrarium(e,t,n){return 256*e+t+n/256-32768}static pack(e,t){const n=[0,0,0,0],l=ep.getUnpackVector(t);let u=Math.floor((e+l[3])/l[2]);return n[2]=u%256,u=Math.floor(u/256),n[1]=u%256,u=Math.floor(u/256),n[0]=u,n}getPixels(){return new _n({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=t*this.dim,u=t*this.dim+this.dim,p=n*this.dim,f=n*this.dim+this.dim;switch(t){case-1:l=u-1;break;case 1:u=l+1}switch(n){case-1:p=f-1;break;case 1:f=p+1}const x=-t*this.dim,v=-n*this.dim;for(let S=p;S<f;S++)for(let C=l;C<u;C++){const M=4*this._idx(C,S),L=4*this._idx(C+x,S+v);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}_t(ep,"DEMData"),_t(px,"DemMinMaxQuadTree",{omit:["dem"]});class E2{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:t,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},n)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,l=t===void 0?0:this.data[n].indexOf(t),u=this.data[n][l];return this.data[n].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const n in this.data)for(const l of this.data[n])e(l.value)||t.push(l);for(const n of t)this.remove(n.value.tileID,n)}}class tc{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}tc.ReadOnly=!1,tc.ReadWrite=!0,tc.disabled=new tc(519,tc.ReadOnly,[0,1]);const cm=7680;class um{constructor(e,t,n,l,u,p){this.test=e,this.ref=t,this.mask=n,this.fail=l,this.depthFail=u,this.pass=p}}um.disabled=new um({func:519,mask:0},0,0,cm,cm,cm);class Po{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}Po.Replace=[1,0],Po.disabled=new Po(Po.Replace,Mi.transparent,[!1,!1,!1,!1]),Po.unblended=new Po(Po.Replace,Mi.transparent,[!0,!0,!0,!0]),Po.alphaBlended=new Po([1,771],Mi.transparent,[!0,!0,!0,!0]);const hm=1029,dm=2305;class so{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}so.disabled=new so(!1,hm,dm),so.backCCW=new so(!0,hm,dm),so.backCW=new so(!0,hm,2304),so.frontCW=new so(!0,1028,2304),so.frontCCW=new so(!0,1028,dm);class Va extends kt{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new E2(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new T2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const n=this._tiles[t];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(e),n.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Et(this._tiles).map(e=>e.tileID).sort(_x).map(e=>e.key)}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort((n,l)=>{const u=n.tileID,p=l.tileID,f=new B(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),x=new B(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-p.overscaledZ||x.y-f.y||x.x-f.x}).map(n=>n.tileID.key):t.map(n=>n.tileID).sort(_x).map(n=>n.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Ci(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=rt.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Di("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let l=0;l<t.length;l++){const u=t[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const p=this.getTileByID(u);n(e,p),n(p,e)}}function n(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=u.tileID.canonical.x-l.tileID.canonical.x;const f=u.tileID.canonical.y-l.tileID.canonical.y,x=Math.pow(2,l.tileID.canonical.z),v=u.tileID.key;p===0&&f===0||Math.abs(f)>1||(Math.abs(p)>1&&(Math.abs(p+x)===1?p+=x:Math.abs(p-x)===1&&(p-=x)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,p,f),l.neighboringTiles&&l.neighboringTiles[v]&&(l.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,l){for(const u in this._tiles){let p=this._tiles[u];if(l[u]||!p.hasData()||p.tileID.overscaledZ<=t||p.tileID.overscaledZ>n)continue;let f=p.tileID;for(;p&&p.tileID.overscaledZ>t+1;){const v=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[v.key],p&&p.hasData()&&(f=v)}let x=f;for(;x.overscaledZ>t;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){l[f.key]=f;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const l=e.scaledTo(n),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,l=Math.ceil(e.height/t)+1,u=Math.floor(n*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(f)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const n={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+t),n[u.tileID.key]=u}this._tiles=n;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let l;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Jr(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[];const u=this._updateRetainedTiles(l);if(gx(this._source.type)&&l.length!==0){const f={},x={},v=Object.keys(u);for(const C of v){const M=u[C],L=this._tiles[C];if(!L||L.fadeEndTime&&L.fadeEndTime<=rt.now())continue;const R=this.findLoadedParent(M,Math.max(M.overscaledZ-Va.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),f[R.tileID.key]=R.tileID),x[C]=M}const S=l[l.length-1].overscaledZ;for(const C in this._tiles){const M=this._tiles[C];if(u[C]||!M.hasData())continue;let L=M.tileID;for(;L.overscaledZ>S;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&x[L.key]){u[C]=M.tileID;break}}}for(const C in f)u[C]||(this._coveredTiles[C]=!0,u[C]=f[C])}for(const f in u)this._tiles[f].clearFadeHold();const p=function(f,x){const v=[];for(const S in f)S in x||v.push(S);return v}(this._tiles,u);for(const f of p){const x=this._tiles[f];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const n={},l=e.reduce((v,S)=>Math.min(v,S.overscaledZ),1/0),u=e[0].overscaledZ,p=Math.max(u-Va.maxOverzooming,this._source.minzoom),f=Math.max(u+Va.maxUnderzooming,this._source.minzoom),x={};for(const v of e){const S=this._addTile(v);t[v.key]=v,S.hasData()||l<this._source.maxzoom&&(x[v.key]=v)}this._retainLoadedChildren(x,l,f,t);for(const v of e){let S=this._tiles[v.key];if(S.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const M=v.children(this._source.maxzoom)[0],L=this.getTile(M);if(L&&L.hasData()){t[M.key]=M;continue}}else{const M=v.children(this._source.maxzoom);if(t[M[0].key]&&t[M[1].key]&&t[M[2].key]&&t[M[3].key])continue}let C=S.wasRequested();for(let M=v.overscaledZ-1;M>=p;--M){const L=v.scaledTo(M);if(n[L.key]||(n[L.key]=!0,S=this.getTile(L),!S&&C&&(S=this._addTile(L)),S&&(t[L.key]=L,C=S.wasRequested(),S.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){n=this._loadedParentTiles[l.key];break}t.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(n=this._getLoadedTile(u),n)break;l=u}for(const u of t)this._loadedParentTiles[u]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const l=this.map?this.map.painter:null;t=new lm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new Di("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const l=[],u=this.transform;if(!u)return l;const p=u.projection.name==="globe",f=Eo(u.center.lng);for(const x in this._tiles){const v=this._tiles[x];if(n&&v.clearQueryDebugViz(),v.holdingForFade())continue;let S;if(p){const C=v.tileID.canonical;if(C.z===0){const M=[Math.abs(He(f,...Ku(C,-1))-f),Math.abs(He(f,...Ku(C,1))-f)];S=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(He(f,...Ku(C,-1))-f),Math.abs(He(f,...Ku(C,0))-f),Math.abs(He(f,...Ku(C,1))-f)];S=[M.indexOf(Math.min(...M))-1]}}else S=[0];for(const C of S){const M=e.containsTile(v,u,t,C);M&&l.push(M)}}return l}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of t)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(gx(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=rt.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const l=this._tiles[e];l&&l.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(e,t){const n=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,p=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const f of l){const x=f.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of x)n.set(v.key,v);this.usedForTerrain&&f.updateElevation(!1)}xt(Array.from(n.values()),(f,x)=>{const v=new lm(f,this._source.tileSize*f.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,S=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),x(S,v)})},t)}}function _x(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function gx(i){return i==="raster"||i==="image"||i==="video"}function Ku(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}Va.maxOverzooming=10,Va.maxUnderzooming=3;class tp{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const l=n||e.findDEMTileFor(t);if(!l||!l.dem)return;const u=l.dem,p=l.tileID,f=1<<t.canonical.z-p.canonical.z;return new tp(l,l.tileSize/jt/f,[(t.canonical.x/f-p.canonical.x)*u.dim,(t.canonical.y/f-p.canonical.y)*u.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(n);return new B(l,u)}getElevationAt(e,t,n,l){const u=e*this._scale+this._offset[0],p=t*this._scale+this._offset[1],f=Math.floor(u),x=Math.floor(p),v=this._dem;return l=!!l,n?mi(mi(v.get(f,x,l),v.get(f,x+1,l),p-x),mi(v.get(f+1,x,l),v.get(f+1,x+1,l),p-x),u-f):v.get(f,x,l)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Nn(1,e)*this._dem.stride}}class yx{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new As(jt,16,0),this.featureIndexArray=new ag,this.promoteId=t}insert(e,t,n,l,u,p=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,l,u,p);const x=this.grid;for(let v=0;v<t.length;v++){const S=t[v],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<S.length;M++){const L=S[M];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}C[0]<jt&&C[1]<jt&&C[2]>=0&&C[3]>=0&&x.insert(f,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ja.VectorTile(new Fu(this.rawTileData)).layers,this.sourceLayerCoder=new rx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,l){this.loadVTLayers();const u=e.params||{},p=Sa(u.filter),f=e.tileResult,x=e.transform,v=f.bufferedTilespaceBounds,S=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(R,V,q,Q)=>Ag(f.bufferedTilespaceGeometry,R,V,q,Q));S.sort(S2);let C=null;x.elevation&&S.length>0&&(C=tp.create(x.elevation,this.tileID));const M={};let L;for(let R=0;R<S.length;R++){const V=S[R];if(V===L)continue;L=V;const q=this.featureIndexArray.get(V);let Q=null;this.loadMatchingFeature(M,q,p,u.layers,u.availableImages,t,n,l,(le,ie,se,me=0)=>(Q||(Q=Jo(le,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(f,le,se,Q,this.z,e.transform,e.pixelPosMatrix,C,me)))}return M}loadMatchingFeature(e,t,n,l,u,p,f,x,v){const{featureIndex:S,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:L}=t,R=this.bucketLayerIDs[C];if(l&&!function(le,ie){for(let se=0;se<le.length;se++)if(ie.indexOf(le[se])>=0)return!0;return!1}(l,R))return;const V=this.sourceLayerCoder.decode(M),q=this.vtLayers[V].feature(S);if(n.needGeometry){const le=Ra(q,!0);if(!n.filter(new X(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!n.filter(new X(this.tileID.overscaledZ),q))return;const Q=this.getId(q,V);for(let le=0;le<R.length;le++){const ie=R[le];if(l&&l.indexOf(ie)<0)continue;const se=p[ie];if(!se)continue;let me={};Q!==void 0&&x&&(me=x.getState(se.sourceLayer||"_geojsonTileLayer",Q));const ue=gt({},f[ie]);ue.paint=xx(ue.paint,se.paint,q,me,u),ue.layout=xx(ue.layout,se.layout,q,me,u);const Ce=!v||v(q,se,me,L);if(!Ce)continue;const Ae=new nx(q,this.z,this.x,this.y,Q);Ae.layer=ue;let De=e[ie];De===void 0&&(De=e[ie]=[]),De.push({featureIndex:S,feature:Ae,intersectionZ:Ce})}}lookupSymbolFeatures(e,t,n,l,u,p,f,x){const v={};this.loadVTLayers();const S=Sa(u);for(const C of e)this.loadMatchingFeature(v,{bucketIndex:n,sourceLayerIndex:l,featureIndex:C,layoutVertexArrayOffset:0},S,p,f,x,t);return v}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(n),u=this.vtFeatures[l];if(u[t])return u[t];const p=this.vtLayers[l].feature(t);return u[t]=p,p}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof n=="boolean"&&(n=Number(n))),n}}function xx(i,e,t,n,l){return Lt(i,(u,p)=>{const f=e instanceof pe?e.get(p):null;return f&&f.evaluate?f.evaluate(t,n,l):f})}function S2(i,e){return e-i}_t(yx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class vx{constructor(e){const t={},n=[];for(const f in e){const x=e[f],v=t[f]={};for(const S in x.glyphs){const C=x.glyphs[+S];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const M=C.metrics.localGlyph?2:1,L={x:0,y:0,w:C.bitmap.width+2*M,h:C.bitmap.height+2*M};n.push(L),v[S]=L}}const{w:l,h:u}=Gf(n),p=new Qo({width:l||1,height:u||1});for(const f in e){const x=e[f];for(const v in x.glyphs){const S=x.glyphs[+v];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const C=t[f][v],M=S.metrics.localGlyph?2:1;Qo.copy(S.bitmap,p,{x:0,y:0},{x:C.x+M,y:C.y+M},S.bitmap)}}this.image=p,this.positions=t}}_t(vx,"GlyphAtlas");class A2{constructor(e){this.tileID=new Jr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Na(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,n,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new To;const p=new rx(Object.keys(e.layers).sort()),f=new yx(this.tileID,this.promoteId);f.bucketLayerIDs=[];const x={},v=new am(256,256),S={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:n},C=t.familiesBySource[this.source];for(const me in C){const ue=e.layers[me];if(!ue)continue;let Ce=!1,Ae=!1;for(const Me of C[me])Me[0].type==="symbol"?Ce=!0:Ae=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!Ae)continue;ue.version===1&&bi(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const De=p.encode(me),et=[];for(let Me=0;Me<ue.length;Me++){const Re=ue.feature(Me),Ne=f.getId(Re,me);et.push({feature:Re,id:Ne,index:Me,sourceLayerIndex:De})}for(const Me of C[me]){const Re=Me[0];this.isSymbolTile!==void 0&&Re.type==="symbol"!==this.isSymbolTile||Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||Re.visibility!=="none"&&(pm(Me,this.zoom,n),(x[Re.id]=Re.createBucket({index:f.bucketLayerIDs.length,layers:Me,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:De,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(et,S,this.tileID.canonical,this.tileTransform),f.bucketLayerIDs.push(Me.map(Ne=>Ne.id)))}}let M,L,R,V;v.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=Lt(S.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(Q).length?l.send("getGlyphs",{uid:this.uid,stacks:Q},(me,ue)=>{M||(M=me,L=ue,se.call(this))},void 0,!1,q):L={};const le=Object.keys(S.iconDependencies);le.length?l.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(me,ue)=>{M||(M=me,R=ue,se.call(this))},void 0,!1,q):R={};const ie=Object.keys(S.patternDependencies);function se(){if(M)return u(M);if(L&&R&&V){const me=new vx(L),ue=new by(R,V);for(const Ce in x){const Ae=x[Ce];Ae instanceof Ls?(pm(Ae.layers,this.zoom,n),Xw(Ae,L,me.positions,R,ue.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):Ae.hasPattern&&(Ae instanceof Bd||Ae instanceof kd||Ae instanceof Lu)&&(pm(Ae.layers,this.zoom,n),Ae.addFeatures(S,this.tileID.canonical,ue.patternPositions,n,this.tileTransform))}this.status="done",u(null,{buckets:Et(x).filter(Ce=>!Ce.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:v,imageAtlas:ue,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?R:null,glyphPositions:this.returnDependencies?me.positions:null})}}ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(me,ue)=>{M||(M=me,V=ue,se.call(this))},void 0,!1,q):V={},se.call(this)}}function pm(i,e,t){const n=new X(e);for(const l of i)l.recalculate(n,t)}class bx{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[p,f]=u.result;return this.scheduler?this.scheduler.add(()=>{l(p,f)},t):l(p,f),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n((p,f)=>{u.result=[p,f];for(const x of u.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,f)},t):x(p,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function wx(i,e,t){const n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const u=Ee(i.request,(p,f,x,v)=>{p?l(p):f&&l(null,{vectorTile:t?void 0:new ja.VectorTile(new Fu(f)),rawData:f,cacheControl:x,expires:v})});return()=>{u.cancel(),l()}},e)}o.ARRAY_TYPE=mn,o.AUTH_ERR_MSG=di,o.Aabb=an,o.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},vi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$e()?i:k,this.scheduler=new b2}send(i,e,t,n,l=!1,u){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=u,this.callbacks[p]=t);const f=Pt(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!t,targetMapId:n,mustQueue:l,sourceMapId:this.mapId,data:Is(e,f)},f),{cancel:()=>{t&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[t];delete this.cancelCallbacks[t],n&&n.cancel()}else if(e.mustQueue||$e()){const n=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),n&&n.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(Ca(e.error)):t(null,Ca(e.data)))}else{const t=Pt(this.globalScope)?void 0:[],n=e.hasCallback?(u,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?Is(u):null,data:Is(p,t)},t)}:u=>{},l=Ca(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,n);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Ld,o.Color=Mi,o.ColorMode=Po,o.CullFaceMode=so,o.DEMData=ep,o.DataConstantProperty=he,o.DedupedRequest=bx,o.DepthMode=tc,o.EXTENT=jt,o.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,n=1<<t,l=Math.floor(i.x),u=Math.floor((i.x-l)*n),p=Math.floor(i.y*n),f=this.findDEMTileFor(new Jr(t,l,t,u,p));return!(!f||!f.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const n=this._source();if(!n||i.y<0||i.y>1)return e;const l=n.getSource().maxzoom,u=1<<l,p=Math.floor(i.x),f=i.x-p,x=new Jr(l,p,l,Math.floor(f*u),Math.floor(i.y*u)),v=this.findDEMTileFor(x);if(!v||!v.dem)return e;const S=v.dem,C=1<<v.tileID.canonical.z,M=(f*C-v.tileID.canonical.x)*S.dim,L=(i.y*C-v.tileID.canonical.y)*S.dim,R=Math.floor(M),V=Math.floor(L);return(t?this.exaggeration():1)*mi(mi(S.get(R,V),S.get(R,V+1),L-V),mi(S.get(R+1,V),S.get(R+1,V+1),L-V),M-R)}getAtTileOffset(i,e,t){const n=1<<i.canonical.z;return this.getAtPointOrZero(new jl(i.wrap+(i.canonical.x+e/jt)/n,(i.canonical.y+t/jt)/n))}getAtTileOffsetFunc(i,e,t,n){return l=>{const u=this.getAtTileOffset(i,l.x,l.y),p=n.upVector(i.canonical,l.x,l.y);return io(p,p,u*n.upVectorScale(i.canonical,e,t).metersToTile),p}}getForTilePoints(i,e,t,n){const l=tp.create(this,i,n);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,n=e.tileID,l=1<<i.canonical.z-n.canonical.z;let u=i.canonical.x/l-n.canonical.x,p=i.canonical.y/l-n.canonical.y,f=0;for(let x=0;x<i.canonical.z-n.canonical.z&&!t.leaves[f];x++){u*=2,p*=2;const v=2*Math.floor(p)+Math.floor(u);f=t.childOffsets[f]+v,u%=1,p%=1}return{min:this.exaggeration()*t.minimums[f],max:this.exaggeration()*t.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Ci,o.EvaluationParameters=X,o.Event=Di,o.Evented=kt,o.FillExtrusionBucket=Lu,o.Frustum=Df,o.FrustumCorners=kf,o.GLOBE_METERS_TO_ECEF=Qf,o.GLOBE_RADIUS=is,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new ot,t=new Qt,n=65;for(let l=0;l<n;l++)for(let u=0;u<n;u++)e.emplaceBack(u,l);this._gridSegments=[];for(let l=0,u=0;l<Jl.length;l++){const p=Jl[l];for(let x=0;x<p;x++)for(let v=0;v<64;v++){const S=x*n+v;t.emplaceBack(S+1,S,S+n),t.emplaceBack(S+n,S+n+1,S+1)}const f=64*p*2;this._gridSegments.push(mr.simpleSegment(0,u,(p+1)*n,f)),u+=f}this._gridBuffer=i.createVertexBuffer(e,Nu.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new Qt;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new Rr,n=new Rr;this._poleSegments=[];for(let l=0,u=0;l<5;l++){const p=360/(1<<l);t.emplaceBack(0,-is,0,.5,0),n.emplaceBack(0,-is,0,.5,1);for(let f=0;f<=64;f++){const x=f/64,v=mi(0,p,x),[S,C,M]=Ql(t2,i2,v,is);t.emplaceBack(S,C,M,x,0),n.emplaceBack(S,C,M,x,1)}this._poleSegments.push(mr.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,Ny,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(n,Ny,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new $r,n=64,l=n+1;this._wireframeSegments=[];for(let u=0,p=0;u<Jl.length;u++){const f=Jl[u];for(let v=0;v<f;v++)for(let S=0;S<n;S++){const C=v*l+S;t.emplaceBack(C,C+1),t.emplaceBack(C,C+l),t.emplaceBack(C,C+l+1)}const x=f*n*3;this._wireframeSegments.push(mr.simpleSegment(0,p,(f+1)*l,x)),p+=x}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=Kl,o.ImagePosition=qf,o.LineAtlas=am,o.LngLat=Ai,o.LngLatBounds=zs,o.LocalGlyphMode=Hf,o.MAX_MERCATOR_LATITUDE=So,o.MercatorCoordinate=jl,o.ONE_EM=Or,o.OverscaledTileID=Jr,o.Properties=Le,o.RGBAImage=_n,o.Ray=Pf,o.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",li,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!pi(i))return i;const t=fr(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!pi(i))return i;const t=fr(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,n){if(!pi(i))return i;const l=fr(i);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),t&&l.params.push(`language=${t}`),n&&l.params.push(`worldview=${n}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,n){const l=fr(i);return pi(i)?(l.path=`/styles/v1${l.path}/sprite${e}${t}`,this._makeAPIURL(l,this._customAccessToken||n)):(l.path+=`${e}${t}`,hn(l))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!pi(i))return i;const n=fr(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&n.authority!=="raster"&&t===512?"@2x":""}${lt.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Ue.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Ue.TILE_URL_VERSION}${n.path}`);const l=this._customAccessToken||function(u){for(const p of u){const f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(n.params)||Ue.ACCESS_TOKEN;return Ue.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,l)}canonicalizeTileURL(i,e){const t=fr(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let n="mapbox://";t.path.match(/^\/raster\/v1\//)?n+=`raster/${t.path.replace(`/${Ue.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${t.path.replace(`/${Ue.TILE_URL_VERSION}/`,"")}`;let l=t.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(n+=`?${l.join("&")}`),n}canonicalizeTileset(i,e){const t=!!e&&pi(e),n=[];for(const l of i.tiles||[])Si(l)?n.push(this.canonicalizeTileURL(l,t)):n.push(l);return n}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=fr(Ue.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!Ue.REQUIRE_ACCESS_TOKEN)return hn(i);if(e=e||Ue.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),hn(i)}},o.ResourceType=ge,o.SegmentVector=mr,o.SourceCache=Va,o.StencilMode=um,o.StructArrayLayout1ui2=qo,o.StructArrayLayout2f1f2i16=Qn,o.StructArrayLayout2i4=ot,o.StructArrayLayout2ui4=$r,o.StructArrayLayout3f12=Xi,o.StructArrayLayout3ui6=Qt,o.StructArrayLayout4i8=Mt,o.StructArrayLayout5f20=Rr,o.Texture=Hu,o.Tile=lm,o.Transitionable=te,o.Uniform1f=xd,o.Uniform1i=class extends Ho{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends Ho{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},o.Uniform3f=class extends Ho{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},o.Uniform4f=fg,o.UniformColor=mg,o.UniformMatrix2f=class extends Ho{constructor(i){super(i),this.current=cb}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let n=0;n<4;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},o.UniformMatrix3f=class extends Ho{constructor(i){super(i),this.current=lb}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let n=0;n<9;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},o.UniformMatrix4f=class extends Ho{constructor(i){super(i),this.current=ab}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let n=1;n<16;n++)if(t[n]!==this.current[n]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},o.UnwrappedTileID=ly,o.ValidationError=pt,o.VectorTileWorkerSource=class extends kt{constructor(i,e,t,n,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=l||wx,this.loading={},this.loaded={},this.deduped=new bx(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,n=i&&i.request,l=n&&n.collectResourceTiming,u=this.loading[t]=new A2(i);u.abort=this.loadVectorData(i,(p,f)=>{const x=!this.loading[t];if(delete this.loading[t],x||p||!f)return u.status="done",x||(this.loaded[t]=u),e(p);const v=f.rawData,S={};f.expires&&(S.expires=f.expires),f.cacheControl&&(S.cacheControl=f.cacheControl),u.vectorTile=f.vectorTile||new ja.VectorTile(new Fu(v));const C=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,L)=>{if(M||!L)return e(M);const R={};if(l){const V=Zt(n);V.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(V)))}e(null,gt({rawTileData:v.slice(0)},L,S,R))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[t]=u})}reloadTile(i,e){const t=this.loaded,n=i.uid,l=this;if(t&&t[n]){const u=t[n];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=Na(i.tileID.canonical,i.projection);const p=(f,x)=>{const v=u.reloadCallback;v&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,v)),e(f,x)};u.status==="parsing"?u.reloadCallback=p:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const t=i.uid,n=this.loading[t];n&&(n.abort&&n.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,n=i.uid;t&&t[n]&&delete t[n],e()}},o.WritingMode=Pn,o.ZoomHistory=nd,o.add=Ps,o.addDynamicAttributes=Yd,o.adjoint=function(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=e[4],f=e[5],x=e[6],v=e[7],S=e[8];return i[0]=p*S-f*v,i[1]=l*v-n*S,i[2]=n*f-l*p,i[3]=f*x-u*S,i[4]=t*S-l*x,i[5]=l*u-t*f,i[6]=u*v-p*x,i[7]=n*x-t*v,i[8]=t*p-n*u,i},o.asyncAll=xt,o.bezier=st,o.bindAll=vi,o.boundsAttributes=sx,o.bufferConvexPolygon=function(i,e){const t=[];for(let n=0;n<i.length;n++){const l=We(n-1,-1,i.length-1),u=We(n+1,-1,i.length-1),p=i[n],f=i[u],x=i[l].sub(p).unit(),v=f.sub(p).unit(),S=v.angleWithSep(x.x,x.y),C=x.add(v).unit().mult(-1*e/Math.sin(S/2));t.push(p.add(C))}return t},o.cacheEntryPossiblyAdded=function(i){re++,re>nl&&(i.getActor().send("enforceCacheSizeLimit",us),re=0)},o.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:n}=i.point,l=Wy(t,n,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Vl(l,l,im(Co(e)))},o.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:n,lat:l}=i._center;return Wy(e,t,i.worldSize,n,l)},o.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/Nn(1,i.center.lat),n=Ao(new Float64Array(16));return Su(n,n,[i.point.x,i.point.y,0]),Oa(n,n,[t,t,e]),Float32Array.from(n)},o.circumferenceAtLatitude=gf,o.clamp=He,o.clearTileCache=function(i){const e=ee(),t=[];for(const n in Xr)e&&t.push(e.delete(n)),delete Xr[n];i&&Promise.all(t).catch(i).then(()=>i())},o.clipLine=Dy,o.clone=function(i){var e=new mn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=lr,o.collisionCircleLayout=vw,o.config=Ue,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new mn(16);return mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=Mg,o.createExpression=bs,o.createLayout=Oe,o.createStyleLayer=function(i){return i.type==="custom"?new g2(i):new x2[i.type](i)},o.cross=zf,o.degToRad=ve,o.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},o.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},o.dot=$n,o.ease=ft,o.easeCubicInOut=qe,o.emitValidationErrors=pu,o.endsWith=fi,o.enforceCacheSizeLimit=function(i){for(const e in Xr)O(e),Xr[e].then(t=>{t.keys().then(n=>{for(let l=0;l<n.length-i;l++)t.delete(n[l])})})},o.evaluateSizeForFeature=Od,o.evaluateSizeForZoom=Zl,o.evaluateVariableOffset=Fy,o.evented=U,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=rt,o.exported$1=lt,o.extend=gt,o.extend$1=nn,o.fillExtrusionHeightLift=oy,o.filterObject=Gi,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=t+t,f=n+n,x=l+l,v=t*p,S=n*p,C=n*f,M=l*p,L=l*f,R=l*x,V=u*p,q=u*f,Q=u*x;return i[0]=1-C-R,i[1]=S+Q,i[2]=M-q,i[3]=0,i[4]=S-Q,i[5]=1-v-R,i[6]=L+V,i[7]=0,i[8]=M+q,i[9]=L-V,i[10]=1-v-C,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var t=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=t,i[2]=0,i[3]=-t,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=zg,o.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ge[e]},o.getAABBPointSquareDist=function(i,e,t){let n=0;for(let l=0;l<2;++l){const u=t?t[l]:0;i[l]>u&&(n+=(i[l]-u)*(i[l]-u)),e[l]<u&&(n+=(u-e[l])*(u-e[l]))}return n},o.getAnchorAlignment=Xf,o.getAnchorJustification=Yf,o.getBounds=function(i){let e=1/0,t=1/0,n=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),t=Math.min(t,u.y),n=Math.max(n,u.x),l=Math.max(l,u.y);return{min:new B(e,t),max:new B(n,l)}},o.getColumn=yi,o.getGridMatrix=function(i,e,t){const n=e.getNorth(),l=e.getSouth(),u=e.getWest(),p=.015625;return[0,(e.getEast()-u)*p,1<<i.z,(l-n)/Jl[t],0,i.y,n,u,p]},o.getImage=Ut,o.getJSON=function(i,e){return ye(gt(i,{type:"json"}),e)},o.getLatitudinalLod=function(i){const e=80.051129;i=He(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(ve(i))),3);return Math.round(t*(Jl.length-1))},o.getMapSessionAPI=Sc,o.getPerformanceMeasurement=Zt,o.getProjection=tx,o.getRTLTextPluginStatus=G,o.getReferrer=be,o.getTilePoint=function(i,{x:e,y:t},n=0){return new B(((e-n)*i.scale-i.x)*jt,(t*i.scale-i.y)*jt)},o.getTileVec3=function(i,e,t=0){return $l(((e.x-t)*i.scale-i.x)*jt,(e.y*i.scale-i.y)*jt,yg(e.z,e.y))},o.getVideo=function(i,e){const t=k.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let n=0;n<i.length;n++){const l=k.document.createElement("source");Ze(i[n])||(t.crossOrigin="Anonymous"),l.src=i[n],t.appendChild(l)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=Ao(new Float64Array(16));return Vl(t,i.pixelMatrix,i.globeMatrix),yr(e,e,t),new B(e[0],e[1])},o.globeDenormalizeECEF=im,o.globeECEFOrigin=function(i,e){const t=[0,0,0];return yr(t,t,$u(Co(e.canonical))),yr(t,t,i),t},o.globeNormalizeECEF=$u,o.globePixelsToTileUnits=function(i,e){return jt/(512*Math.pow(2,i))*Zd(Co(e))},o.globePoleMatrixForTile=function(i,e,t){const n=Ao(new Float64Array(16)),l=(e/(1<<i)-.5)*Math.PI*2;return Sd(n,t.globeMatrix,l),Float32Array.from(n)},o.globeTileBounds=Co,o.globeTiltAtLngLat=Xy,o.globeToMercatorTransition=Gu,o.globeUseCustomAntiAliasing=function(i,e,t){const n=Gu(t.zoom),l=i.style.map._antialias,u=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return n===0&&!l&&!p&&u},o.identity=Ao,o.identity$1=Og,o.invert=Ef,o.isFullscreen=function(){return!!k.document.fullscreenElement||!!k.document.webkitFullscreenElement},o.isLngLatBehindGlobe=function(i,e){return Xy(i,e)>Math.PI/2*1.01},o.isMapAuthenticated=function(i){return fo.has(i)},o.isMapboxURL=pi,o.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!Pt(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Br,o.len=Ab,o.length=Au,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=wx,o.makeRequest=ye,o.mapValue=function(i,e,t,n,l){return He((i-e)/(t-e)*(l-n)+n,n,l)},o.mercatorScale=xg,o.mercatorXfromLng=Eo,o.mercatorYfromLat=Yo,o.mercatorZfromAltitude=Nn,o.mul=Eb,o.mul$1=Sb,o.multiply=Vl,o.multiply$1=function(i,e,t){var n=e[0],l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],S=e[7],C=e[8],M=t[0],L=t[1],R=t[2],V=t[3],q=t[4],Q=t[5],le=t[6],ie=t[7],se=t[8];return i[0]=M*n+L*p+R*v,i[1]=M*l+L*f+R*S,i[2]=M*u+L*x+R*C,i[3]=V*n+q*p+Q*v,i[4]=V*l+q*f+Q*S,i[5]=V*u+q*x+Q*C,i[6]=le*n+ie*p+se*v,i[7]=le*l+ie*f+se*S,i[8]=le*u+ie*x+se*C,i},o.multiply$2=Dg,o.nextPowerOfTwo=ri,o.normalize=Yr,o.normalize$1=function(i,e){var t=e[0],n=e[1],l=e[2],u=e[3],p=t*t+n*n+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=t*p,i[1]=n*p,i[2]=l*p,i[3]=u*p,i},o.number=mi,o.ortho=function(i,e,t,n,l,u,p){var f=1/(e-t),x=1/(n-l),v=1/(u-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+t)*f,i[13]=(l+n)*x,i[14]=(p+u)*v,i[15]=1,i},o.pbf=Fu,o.perspective=function(i,e,t,n,l){var u,p=1/Math.tan(e/2);return i[0]=p/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+n)*(u=1/(n-l)),i[14]=2*l*n*u):(i[10]=-1,i[14]=-2*n),i},o.pick=function(i,e){const t={};for(let n=0;n<e.length;n++){const l=e[n];l in i&&(t[l]=i[l])}return t},o.plugin=W,o.pointGeometry=B,o.polygonContainsPoint=Ba,o.polygonIntersectsBox=Ag,o.polygonIntersectsPolygon=wg,o.polygonizeBounds=function(i,e,t=0,n=!0){const l=new B(t,t),u=i.sub(l),p=e.add(l),f=[u,new B(p.x,u.y),p,new B(u.x,p.y)];return n&&f.push(u.clone()),f},o.posAttributes=Nu,o.postMapLoadEvent=il,o.postTurnstileEvent=kr,o.potpack=Gf,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=Ie,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:E,pluginURL:A}),U.on("pluginStateChange",i),i},o.removeAuthState=function(i){fo.delete(i)},o.renderColorRamp=Rf,o.resample=vg,o.rotateX=Sf,o.rotateX$1=Fg,o.rotateY=Sd,o.rotateY$1=Ug,o.rotateZ=function(i,e,t){var n=Math.sin(t),l=Math.cos(t),u=e[0],p=e[1],f=e[2],x=e[3],v=e[4],S=e[5],C=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+v*n,i[1]=p*l+S*n,i[2]=f*l+C*n,i[3]=x*l+M*n,i[4]=v*l-u*n,i[5]=S*l-p*n,i[6]=C*l-f*n,i[7]=M*l-x*n,i},o.rotateZ$1=function(i,e,t){t*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(t),x=Math.cos(t);return i[0]=n*x+l*f,i[1]=l*x-n*f,i[2]=u*x+p*f,i[3]=p*x-u*f,i},o.scale=Oa,o.scale$1=Rg,o.scale$2=io,o.scaleAndAdd=Ad,o.setCacheLimits=function(i,e){us=i,nl=e},o.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},o.setRTLTextPlugin=function(i,e,t=!1){if(E===h||E===m||E===y)throw new Error("setRTLTextPlugin cannot be called multiple times.");A=rt.resolveURL(i),E=h,w=e,D(),t||K()},o.smoothstep=yt,o.spec=ke,o.storeAuthState=function(i,e){e?fo.add(i):fo.delete(i)},o.sub=ro,o.subtract=If,o.symbolSize=bw,o.tileAABB=function(i,e,t,n,l,u,p,f,x){if(x.name==="globe")return e2(i,e,new Ld(t,n,l));const v=Na({z:t,x:n,y:l},x);return new an([(u+v.x/v.scale)*e,e*(v.y/v.scale),p],[(u+v.x2/v.scale)*e,e*(v.y2/v.scale),f])},o.tileCornersToBounds=Gd,o.tileTransform=Na,o.transformMat3=function(i,e,t){var n=e[0],l=e[1],u=e[2];return i[0]=n*t[0]+l*t[3]+u*t[6],i[1]=n*t[1]+l*t[4]+u*t[7],i[2]=n*t[2]+l*t[5]+u*t[8],i},o.transformMat4=yr,o.transformMat4$1=Fa,o.transformQuat=Lg,o.transitionTileAABBinECEF=Gy,o.translate=Su,o.transpose=function(i,e){if(i===e){var t=e[1],n=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=n,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=P,o.uniqueId=bt,o.updateGlobeVertexNormal=function(i,e,t,n,l){const u=5*e+2;i.float32[u+0]=t,i.float32[u+1]=n,i.float32[u+2]=l},o.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=i=>Jn(Es(i)),o.validateFog=i=>Jn(ed(i)),o.validateLayer=i=>Jn(Ml(i)),o.validateLight=i=>Jn(Qh(i)),o.validateSource=i=>Jn(Jh(i)),o.validateStyle=kl,o.validateTerrain=i=>Jn(Pl(i)),o.values=Et,o.vectorTile=ja,o.version=ce,o.warnOnce=bi,o.window=k,o.wrap=We}),I(["./shared"],function(o){function k(ee){if(typeof ee=="number"||typeof ee=="boolean"||typeof ee=="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let N="[";for(const J of ee)N+=`${k(J)},`;return`${N}]`}let O="{";for(const N of Object.keys(ee).sort())O+=`${N}:${k(ee[N])},`;return`${O}}`}function j(ee){let O="";for(const N of o.refProperties)O+=`/${k(ee[N])}`;return O}class F{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,N){for(const re of O)this._layerConfigs[re.id]=re,(this._layers[re.id]=o.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of N)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const J=function(re,ge){const Te={};for(let ye=0;ye<re.length;ye++){const Ee=ge&&ge[re[ye].id]||j(re[ye]);ge&&(ge[re[ye].id]=Ee);let je=Te[Ee];je||(je=Te[Ee]=[]),je.push(re[ye])}const be=[];for(const ye in Te)be.push(Te[ye]);return be}(o.values(this._layerConfigs),this.keyCache);for(const re of J){const ge=re.map(ht=>this._layers[ht.id]),Te=ge[0];if(Te.visibility==="none")continue;const be=Te.source||"";let ye=this.familiesBySource[be];ye||(ye=this.familiesBySource[be]={});const Ee=Te.sourceLayer||"_geojsonTileLayer";let je=ye[Ee];je||(je=ye[Ee]=[]),je.push(ge)}}}class B{loadTile(O,N){const{uid:J,encoding:re,rawImageData:ge,padding:Te,buildQuadTree:be}=O,ye=o.window.ImageBitmap&&ge instanceof o.window.ImageBitmap?this.getImageData(ge,Te):ge;N(null,new o.DEMData(J,ye,re,Te<1,be))}getImageData(O,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const J=this.offscreenCanvasContext.getImageData(-N,-N,O.width+2*N,O.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var $=function ee(O,N){var J,re=O&&O.type;if(re==="FeatureCollection")for(J=0;J<O.features.length;J++)ee(O.features[J],N);else if(re==="GeometryCollection")for(J=0;J<O.geometries.length;J++)ee(O.geometries[J],N);else if(re==="Feature")ee(O.geometry,N);else if(re==="Polygon")ne(O.coordinates,N);else if(re==="MultiPolygon")for(J=0;J<O.coordinates.length;J++)ne(O.coordinates[J],N);return O};function ne(ee,O){if(ee.length!==0){oe(ee[0],O);for(var N=1;N<ee.length;N++)oe(ee[N],!O)}}function oe(ee,O){for(var N=0,J=0,re=0,ge=ee.length,Te=ge-1;re<ge;Te=re++){var be=(ee[re][0]-ee[Te][0])*(ee[Te][1]+ee[re][1]),ye=N+be;J+=Math.abs(N)>=Math.abs(be)?N-ye+be:be-ye+N,N=ye}N+J>=0!=!!O&&ee.reverse()}const ve=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ie{constructor(O){this._feature=O,this.extent=o.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(this._feature.type===1){const O=[];for(const N of this._feature.geometry)O.push([new o.pointGeometry(N[0],N[1])]);return O}{const O=[];for(const N of this._feature.geometry){const J=[];for(const re of N)J.push(new o.pointGeometry(re[0],re[1]));O.push(J)}return O}}toGeoJSON(O,N,J){return ve.call(this,O,N,J)}}class Ge{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=O.length,this._features=O}feature(O){return new Ie(this._features[O])}}var qe=o.vectorTile.VectorTileFeature,st=ft;function ft(ee,O){this.options=O||{},this.features=ee,this.length=ee.length}function He(ee,O){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=O||4096}ft.prototype.feature=function(ee){return new He(this.features[ee],this.options.extent)},He.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var O=0;O<ee.length;O++){for(var N=ee[O],J=[],re=0;re<N.length;re++)J.push(new o.pointGeometry(N[re][0],N[re][1]));this.geometry.push(J)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,O=1/0,N=-1/0,J=1/0,re=-1/0,ge=0;ge<ee.length;ge++)for(var Te=ee[ge],be=0;be<Te.length;be++){var ye=Te[be];O=Math.min(O,ye.x),N=Math.max(N,ye.x),J=Math.min(J,ye.y),re=Math.max(re,ye.y)}return[O,J,N,re]},He.prototype.toGeoJSON=qe.prototype.toGeoJSON;var yt=xt,We=st;function xt(ee){var O=new o.pbf;return function(N,J){for(var re in N.layers)J.writeMessage(3,Et,N.layers[re])}(ee,O),O.finish()}function Et(ee,O){var N;O.writeVarintField(15,ee.version||1),O.writeStringField(1,ee.name||""),O.writeVarintField(5,ee.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ee.length;N++)J.feature=ee.feature(N),O.writeMessage(2,gt,J);var re=J.keys;for(N=0;N<re.length;N++)O.writeStringField(3,re[N]);var ge=J.values;for(N=0;N<ge.length;N++)O.writeMessage(4,Er,ge[N])}function gt(ee,O){var N=ee.feature;N.id!==void 0&&O.writeVarintField(1,N.id),O.writeMessage(2,Ft,ee),O.writeVarintField(3,N.type),O.writeMessage(4,ri,N)}function Ft(ee,O){var N=ee.feature,J=ee.keys,re=ee.values,ge=ee.keycache,Te=ee.valuecache;for(var be in N.properties){var ye=N.properties[be],Ee=ge[be];if(ye!==null){Ee===void 0&&(J.push(be),ge[be]=Ee=J.length-1),O.writeVarint(Ee);var je=typeof ye;je!=="string"&&je!=="boolean"&&je!=="number"&&(ye=JSON.stringify(ye));var ht=je+":"+ye,Ze=Te[ht];Ze===void 0&&(re.push(ye),Te[ht]=Ze=re.length-1),O.writeVarint(Ze)}}}function bt(ee,O){return(O<<3)+(7&ee)}function ei(ee){return ee<<1^ee>>31}function ri(ee,O){for(var N=ee.loadGeometry(),J=ee.type,re=0,ge=0,Te=N.length,be=0;be<Te;be++){var ye=N[be],Ee=1;J===1&&(Ee=ye.length),O.writeVarint(bt(1,Ee));for(var je=J===3?ye.length-1:ye.length,ht=0;ht<je;ht++){ht===1&&J!==1&&O.writeVarint(bt(2,je-1));var Ze=ye[ht].x-re,Rt=ye[ht].y-ge;O.writeVarint(ei(Ze)),O.writeVarint(ei(Rt)),re+=Ze,ge+=Rt}J===3&&O.writeVarint(bt(7,1))}}function Er(ee,O){var N=typeof ee;N==="string"?O.writeStringField(1,ee):N==="boolean"?O.writeBooleanField(7,ee):N==="number"&&(ee%1!=0?O.writeDoubleField(3,ee):ee<0?O.writeSVarintField(6,ee):O.writeVarintField(5,ee))}function vi(ee,O,N,J,re,ge){if(re-J<=N)return;const Te=J+re>>1;fi(ee,O,Te,J,re,ge%2),vi(ee,O,N,J,Te-1,ge+1),vi(ee,O,N,Te+1,re,ge+1)}function fi(ee,O,N,J,re,ge){for(;re>J;){if(re-J>600){const Ee=re-J+1,je=N-J+1,ht=Math.log(Ee),Ze=.5*Math.exp(2*ht/3),Rt=.5*Math.sqrt(ht*Ze*(Ee-Ze)/Ee)*(je-Ee/2<0?-1:1);fi(ee,O,N,Math.max(J,Math.floor(N-je*Ze/Ee+Rt)),Math.min(re,Math.floor(N+(Ee-je)*Ze/Ee+Rt)),ge)}const Te=O[2*N+ge];let be=J,ye=re;for(Lt(ee,O,J,N),O[2*re+ge]>Te&&Lt(ee,O,J,re);be<ye;){for(Lt(ee,O,be,ye),be++,ye--;O[2*be+ge]<Te;)be++;for(;O[2*ye+ge]>Te;)ye--}O[2*J+ge]===Te?Lt(ee,O,J,ye):(ye++,Lt(ee,O,ye,re)),ye<=N&&(J=ye+1),N<=ye&&(re=ye-1)}}function Lt(ee,O,N,J){Gi(ee,N,J),Gi(O,2*N,2*J),Gi(O,2*N+1,2*J+1)}function Gi(ee,O,N){const J=ee[O];ee[O]=ee[N],ee[N]=J}function lr(ee,O,N,J){const re=ee-N,ge=O-J;return re*re+ge*ge}yt.fromVectorTileJs=xt,yt.fromGeojsonVt=function(ee,O){O=O||{};var N={};for(var J in ee)N[J]=new st(ee[J].features,O),N[J].name=J,N[J].version=O.version,N[J].extent=O.extent;return xt({layers:N})},yt.GeoJSONWrapper=We;const Nr=ee=>ee[0],bi=ee=>ee[1];class Fi{constructor(O,N=Nr,J=bi,re=64,ge=Float64Array){this.nodeSize=re,this.points=O;const Te=O.length<65536?Uint16Array:Uint32Array,be=this.ids=new Te(O.length),ye=this.coords=new ge(2*O.length);for(let Ee=0;Ee<O.length;Ee++)be[Ee]=Ee,ye[2*Ee]=N(O[Ee]),ye[2*Ee+1]=J(O[Ee]);vi(be,ye,re,0,be.length-1,0)}range(O,N,J,re){return function(ge,Te,be,ye,Ee,je,ht){const Ze=[0,ge.length-1,0],Rt=[];let Ot,It;for(;Ze.length;){const Ut=Ze.pop(),Jt=Ze.pop(),Ii=Ze.pop();if(Jt-Ii<=ht){for(let kt=Ii;kt<=Jt;kt++)Ot=Te[2*kt],It=Te[2*kt+1],Ot>=be&&Ot<=Ee&&It>=ye&&It<=je&&Rt.push(ge[kt]);continue}const Di=Math.floor((Ii+Jt)/2);Ot=Te[2*Di],It=Te[2*Di+1],Ot>=be&&Ot<=Ee&&It>=ye&&It<=je&&Rt.push(ge[Di]);const Ci=(Ut+1)%2;(Ut===0?be<=Ot:ye<=It)&&(Ze.push(Ii),Ze.push(Di-1),Ze.push(Ci)),(Ut===0?Ee>=Ot:je>=It)&&(Ze.push(Di+1),Ze.push(Jt),Ze.push(Ci))}return Rt}(this.ids,this.coords,O,N,J,re,this.nodeSize)}within(O,N,J){return function(re,ge,Te,be,ye,Ee){const je=[0,re.length-1,0],ht=[],Ze=ye*ye;for(;je.length;){const Rt=je.pop(),Ot=je.pop(),It=je.pop();if(Ot-It<=Ee){for(let Ci=It;Ci<=Ot;Ci++)lr(ge[2*Ci],ge[2*Ci+1],Te,be)<=Ze&&ht.push(re[Ci]);continue}const Ut=Math.floor((It+Ot)/2),Jt=ge[2*Ut],Ii=ge[2*Ut+1];lr(Jt,Ii,Te,be)<=Ze&&ht.push(re[Ut]);const Di=(Rt+1)%2;(Rt===0?Te-ye<=Jt:be-ye<=Ii)&&(je.push(It),je.push(Ut-1),je.push(Di)),(Rt===0?Te+ye>=Jt:be+ye>=Ii)&&(je.push(Ut+1),je.push(Ot),je.push(Di))}return ht}(this.ids,this.coords,O,N,J,this.nodeSize)}}const rn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},$e=Math.fround||(St=new Float32Array(1),ee=>(St[0]=+ee,St[0]));var St;class ut{constructor(O){this.options=Pe(Object.create(rn),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:N,minZoom:J,maxZoom:re,nodeSize:ge}=this.options;N&&console.time("total time");const Te=`prepare ${O.length} points`;N&&console.time(Te),this.points=O;let be=[];for(let ye=0;ye<O.length;ye++)O[ye].geometry&&be.push(Ei(O[ye],ye));this.trees[re+1]=new Fi(be,Ke,Xe,ge,Float32Array),N&&console.timeEnd(Te);for(let ye=re;ye>=J;ye--){const Ee=+Date.now();be=this._cluster(be,ye),this.trees[ye]=new Fi(be,Ke,Xe,ge,Float32Array),N&&console.log("z%d: %d clusters in %dms",ye,be.length,+Date.now()-Ee)}return N&&console.timeEnd("total time"),this}getClusters(O,N){let J=((O[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,O[1]));let ge=O[2]===180?180:((O[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)J=-180,ge=180;else if(J>ge){const je=this.getClusters([J,re,180,Te],N),ht=this.getClusters([-180,re,ge,Te],N);return je.concat(ht)}const be=this.trees[this._limitZoom(N)],ye=be.range(Zt(J),ce(Te),Zt(ge),ce(re)),Ee=[];for(const je of ye){const ht=be.points[je];Ee.push(ht.numPoints?yi(ht):this.points[ht.index])}return Ee}getChildren(O){const N=this._getOriginId(O),J=this._getOriginZoom(O),re="No cluster with the specified id.",ge=this.trees[J];if(!ge)throw new Error(re);const Te=ge.points[N];if(!Te)throw new Error(re);const be=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ye=ge.within(Te.x,Te.y,be),Ee=[];for(const je of ye){const ht=ge.points[je];ht.parentId===O&&Ee.push(ht.numPoints?yi(ht):this.points[ht.index])}if(Ee.length===0)throw new Error(re);return Ee}getLeaves(O,N,J){const re=[];return this._appendLeaves(re,O,N=N||10,J=J||0,0),re}getTile(O,N,J){const re=this.trees[this._limitZoom(O)],ge=Math.pow(2,O),{extent:Te,radius:be}=this.options,ye=be/Te,Ee=(J-ye)/ge,je=(J+1+ye)/ge,ht={features:[]};return this._addTileFeatures(re.range((N-ye)/ge,Ee,(N+1+ye)/ge,je),re.points,N,J,ge,ht),N===0&&this._addTileFeatures(re.range(1-ye/ge,Ee,1,je),re.points,ge,J,ge,ht),N===ge-1&&this._addTileFeatures(re.range(0,Ee,ye/ge,je),re.points,-1,J,ge,ht),ht.features.length?ht:null}getClusterExpansionZoom(O){let N=this._getOriginZoom(O)-1;for(;N<=this.options.maxZoom;){const J=this.getChildren(O);if(N++,J.length!==1)break;O=J[0].properties.cluster_id}return N}_appendLeaves(O,N,J,re,ge){const Te=this.getChildren(N);for(const be of Te){const ye=be.properties;if(ye&&ye.cluster?ge+ye.point_count<=re?ge+=ye.point_count:ge=this._appendLeaves(O,ye.cluster_id,J,re,ge):ge<re?ge++:O.push(be),O.length===J)break}return ge}_addTileFeatures(O,N,J,re,ge,Te){for(const be of O){const ye=N[be],Ee=ye.numPoints;let je,ht,Ze;if(Ee)je=ni(ye),ht=ye.x,Ze=ye.y;else{const It=this.points[ye.index];je=It.properties,ht=Zt(It.geometry.coordinates[0]),Ze=ce(It.geometry.coordinates[1])}const Rt={type:1,geometry:[[Math.round(this.options.extent*(ht*ge-J)),Math.round(this.options.extent*(Ze*ge-re))]],tags:je};let Ot;Ee?Ot=ye.id:this.options.generateId?Ot=ye.index:this.points[ye.index].id&&(Ot=this.points[ye.index].id),Ot!==void 0&&(Rt.id=Ot),Te.features.push(Rt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,N){const J=[],{radius:re,extent:ge,reduce:Te,minPoints:be}=this.options,ye=re/(ge*Math.pow(2,N));for(let Ee=0;Ee<O.length;Ee++){const je=O[Ee];if(je.zoom<=N)continue;je.zoom=N;const ht=this.trees[N+1],Ze=ht.within(je.x,je.y,ye),Rt=je.numPoints||1;let Ot=Rt;for(const It of Ze){const Ut=ht.points[It];Ut.zoom>N&&(Ot+=Ut.numPoints||1)}if(Ot>Rt&&Ot>=be){let It=je.x*Rt,Ut=je.y*Rt,Jt=Te&&Rt>1?this._map(je,!0):null;const Ii=(Ee<<5)+(N+1)+this.points.length;for(const Di of Ze){const Ci=ht.points[Di];if(Ci.zoom<=N)continue;Ci.zoom=N;const kt=Ci.numPoints||1;It+=Ci.x*kt,Ut+=Ci.y*kt,Ci.parentId=Ii,Te&&(Jt||(Jt=this._map(je,!0)),Te(Jt,this._map(Ci)))}je.parentId=Ii,J.push(Pt(It/Ot,Ut/Ot,Ii,Ot,Jt))}else if(J.push(je),Ot>1)for(const It of Ze){const Ut=ht.points[It];Ut.zoom<=N||(Ut.zoom=N,J.push(Ut))}}return J}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,N){if(O.numPoints)return N?Pe({},O.properties):O.properties;const J=this.points[O.index].properties,re=this.options.map(J);return N&&re===J?Pe({},re):re}}function Pt(ee,O,N,J,re){return{x:$e(ee),y:$e(O),zoom:1/0,id:N,parentId:-1,numPoints:J,properties:re}}function Ei(ee,O){const[N,J]=ee.geometry.coordinates;return{x:$e(Zt(N)),y:$e(ce(J)),zoom:1/0,index:O,parentId:-1}}function yi(ee){return{type:"Feature",id:ee.id,properties:ni(ee),geometry:{type:"Point",coordinates:[(O=ee.x,360*(O-.5)),_e(ee.y)]}};var O}function ni(ee){const O=ee.numPoints,N=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return Pe(Pe({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:O,point_count_abbreviated:N})}function Zt(ee){return ee/360+.5}function ce(ee){const O=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return N<0?0:N>1?1:N}function _e(ee){const O=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Pe(ee,O){for(const N in O)ee[N]=O[N];return ee}function Ke(ee){return ee.x}function Xe(ee){return ee.y}function rt(ee,O,N,J){for(var re,ge=J,Te=N-O>>1,be=N-O,ye=ee[O],Ee=ee[O+1],je=ee[N],ht=ee[N+1],Ze=O+3;Ze<N;Ze+=3){var Rt=vt(ee[Ze],ee[Ze+1],ye,Ee,je,ht);if(Rt>ge)re=Ze,ge=Rt;else if(Rt===ge){var Ot=Math.abs(Ze-Te);Ot<be&&(re=Ze,be=Ot)}}ge>J&&(re-O>3&&rt(ee,O,re,J),ee[re+2]=ge,N-re>3&&rt(ee,re,N,J))}function vt(ee,O,N,J,re,ge){var Te=re-N,be=ge-J;if(Te!==0||be!==0){var ye=((ee-N)*Te+(O-J)*be)/(Te*Te+be*be);ye>1?(N=re,J=ge):ye>0&&(N+=Te*ye,J+=be*ye)}return(Te=ee-N)*Te+(be=O-J)*be}function Ue(ee,O,N,J){var re={id:ee===void 0?null:ee,type:O,geometry:N,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var Te=ge.geometry,be=ge.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")lt(ge,Te);else if(be==="Polygon"||be==="MultiLineString")for(var ye=0;ye<Te.length;ye++)lt(ge,Te[ye]);else if(be==="MultiPolygon")for(ye=0;ye<Te.length;ye++)for(var Ee=0;Ee<Te[ye].length;Ee++)lt(ge,Te[ye][Ee])}(re),re}function lt(ee,O){for(var N=0;N<O.length;N+=3)ee.minX=Math.min(ee.minX,O[N]),ee.minY=Math.min(ee.minY,O[N+1]),ee.maxX=Math.max(ee.maxX,O[N]),ee.maxY=Math.max(ee.maxY,O[N+1])}function tt(ee,O,N,J){if(O.geometry){var re=O.geometry.coordinates,ge=O.geometry.type,Te=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),be=[],ye=O.id;if(N.promoteId?ye=O.properties[N.promoteId]:N.generateId&&(ye=J||0),ge==="Point")zt(re,be);else if(ge==="MultiPoint")for(var Ee=0;Ee<re.length;Ee++)zt(re[Ee],be);else if(ge==="LineString")At(re,be,Te,!1);else if(ge==="MultiLineString"){if(N.lineMetrics){for(Ee=0;Ee<re.length;Ee++)At(re[Ee],be=[],Te,!1),ee.push(Ue(ye,"LineString",be,O.properties));return}Bt(re,be,Te,!1)}else if(ge==="Polygon")Bt(re,be,Te,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Ee=0;Ee<O.geometry.geometries.length;Ee++)tt(ee,{id:ye,geometry:O.geometry.geometries[Ee],properties:O.properties},N,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ee=0;Ee<re.length;Ee++){var je=[];Bt(re[Ee],je,Te,!0),be.push(je)}}ee.push(Ue(ye,ge,be,O.properties))}}function zt(ee,O){O.push(Gt(ee[0])),O.push(li(ee[1])),O.push(0)}function At(ee,O,N,J){for(var re,ge,Te=0,be=0;be<ee.length;be++){var ye=Gt(ee[be][0]),Ee=li(ee[be][1]);O.push(ye),O.push(Ee),O.push(0),be>0&&(Te+=J?(re*Ee-ye*ge)/2:Math.sqrt(Math.pow(ye-re,2)+Math.pow(Ee-ge,2))),re=ye,ge=Ee}var je=O.length-3;O[2]=1,rt(O,0,je,N),O[je+2]=1,O.size=Math.abs(Te),O.start=0,O.end=O.size}function Bt(ee,O,N,J){for(var re=0;re<ee.length;re++){var ge=[];At(ee[re],ge,N,J),O.push(ge)}}function Gt(ee){return ee/360+.5}function li(ee){var O=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return N<0?0:N>1?1:N}function di(ee,O,N,J,re,ge,Te,be){if(J/=O,ge>=(N/=O)&&Te<J)return ee;if(Te<N||ge>=J)return null;for(var ye=[],Ee=0;Ee<ee.length;Ee++){var je=ee[Ee],ht=je.geometry,Ze=je.type,Rt=re===0?je.minX:je.minY,Ot=re===0?je.maxX:je.maxY;if(Rt>=N&&Ot<J)ye.push(je);else if(!(Ot<N||Rt>=J)){var It=[];if(Ze==="Point"||Ze==="MultiPoint")pi(ht,It,N,J,re);else if(Ze==="LineString")Si(ht,It,N,J,re,!1,be.lineMetrics);else if(Ze==="MultiLineString")fr(ht,It,N,J,re,!1);else if(Ze==="Polygon")fr(ht,It,N,J,re,!0);else if(Ze==="MultiPolygon")for(var Ut=0;Ut<ht.length;Ut++){var Jt=[];fr(ht[Ut],Jt,N,J,re,!0),Jt.length&&It.push(Jt)}if(It.length){if(be.lineMetrics&&Ze==="LineString"){for(Ut=0;Ut<It.length;Ut++)ye.push(Ue(je.id,Ze,It[Ut],je.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(It.length===1?(Ze="LineString",It=It[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=It.length===3?"Point":"MultiPoint"),ye.push(Ue(je.id,Ze,It,je.tags))}}}return ye.length?ye:null}function pi(ee,O,N,J,re){for(var ge=0;ge<ee.length;ge+=3){var Te=ee[ge+re];Te>=N&&Te<=J&&(O.push(ee[ge]),O.push(ee[ge+1]),O.push(ee[ge+2]))}}function Si(ee,O,N,J,re,ge,Te){for(var be,ye,Ee=Pr(ee),je=re===0?Un:ho,ht=ee.start,Ze=0;Ze<ee.length-3;Ze+=3){var Rt=ee[Ze],Ot=ee[Ze+1],It=ee[Ze+2],Ut=ee[Ze+3],Jt=ee[Ze+4],Ii=re===0?Rt:Ot,Di=re===0?Ut:Jt,Ci=!1;Te&&(be=Math.sqrt(Math.pow(Rt-Ut,2)+Math.pow(Ot-Jt,2))),Ii<N?Di>N&&(ye=je(Ee,Rt,Ot,Ut,Jt,N),Te&&(Ee.start=ht+be*ye)):Ii>J?Di<J&&(ye=je(Ee,Rt,Ot,Ut,Jt,J),Te&&(Ee.start=ht+be*ye)):hn(Ee,Rt,Ot,It),Di<N&&Ii>=N&&(ye=je(Ee,Rt,Ot,Ut,Jt,N),Ci=!0),Di>J&&Ii<=J&&(ye=je(Ee,Rt,Ot,Ut,Jt,J),Ci=!0),!ge&&Ci&&(Te&&(Ee.end=ht+be*ye),O.push(Ee),Ee=Pr(ee)),Te&&(ht+=be)}var kt=ee.length-3;Rt=ee[kt],Ot=ee[kt+1],It=ee[kt+2],(Ii=re===0?Rt:Ot)>=N&&Ii<=J&&hn(Ee,Rt,Ot,It),kt=Ee.length-3,ge&&kt>=3&&(Ee[kt]!==Ee[0]||Ee[kt+1]!==Ee[1])&&hn(Ee,Ee[0],Ee[1],Ee[2]),Ee.length&&O.push(Ee)}function Pr(ee){var O=[];return O.size=ee.size,O.start=ee.start,O.end=ee.end,O}function fr(ee,O,N,J,re,ge){for(var Te=0;Te<ee.length;Te++)Si(ee[Te],O,N,J,re,ge,!1)}function hn(ee,O,N,J){ee.push(O),ee.push(N),ee.push(J)}function Un(ee,O,N,J,re,ge){var Te=(ge-O)/(J-O);return ee.push(ge),ee.push(N+(re-N)*Te),ee.push(1),Te}function ho(ee,O,N,J,re,ge){var Te=(ge-N)/(re-N);return ee.push(O+(J-O)*Te),ee.push(ge),ee.push(1),Te}function gr(ee,O){for(var N=[],J=0;J<ee.length;J++){var re,ge=ee[J],Te=ge.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")re=kr(ge.geometry,O);else if(Te==="MultiLineString"||Te==="Polygon"){re=[];for(var be=0;be<ge.geometry.length;be++)re.push(kr(ge.geometry[be],O))}else if(Te==="MultiPolygon")for(re=[],be=0;be<ge.geometry.length;be++){for(var ye=[],Ee=0;Ee<ge.geometry[be].length;Ee++)ye.push(kr(ge.geometry[be][Ee],O));re.push(ye)}N.push(Ue(ge.id,Te,re,ge.tags))}return N}function kr(ee,O){var N=[];N.size=ee.size,ee.start!==void 0&&(N.start=ee.start,N.end=ee.end);for(var J=0;J<ee.length;J+=3)N.push(ee[J]+O,ee[J+1],ee[J+2]);return N}function po(ee,O){if(ee.transformed)return ee;var N,J,re,ge=1<<ee.z,Te=ee.x,be=ee.y;for(N=0;N<ee.features.length;N++){var ye=ee.features[N],Ee=ye.geometry,je=ye.type;if(ye.geometry=[],je===1)for(J=0;J<Ee.length;J+=2)ye.geometry.push(il(Ee[J],Ee[J+1],O,ge,Te,be));else for(J=0;J<Ee.length;J++){var ht=[];for(re=0;re<Ee[J].length;re+=2)ht.push(il(Ee[J][re],Ee[J][re+1],O,ge,Te,be));ye.geometry.push(ht)}}return ee.transformed=!0,ee}function il(ee,O,N,J,re,ge){return[Math.round(N*(ee*J-re)),Math.round(N*(O*J-ge))]}function rl(ee,O,N,J,re){for(var ge=O===re.maxZoom?0:re.tolerance/((1<<O)*re.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:J,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<ee.length;be++){Te.numFeatures++,Sc(Te,ee[be],ge,re);var ye=ee[be].minX,Ee=ee[be].minY,je=ee[be].maxX,ht=ee[be].maxY;ye<Te.minX&&(Te.minX=ye),Ee<Te.minY&&(Te.minY=Ee),je>Te.maxX&&(Te.maxX=je),ht>Te.maxY&&(Te.maxY=ht)}return Te}function Sc(ee,O,N,J){var re=O.geometry,ge=O.type,Te=[];if(ge==="Point"||ge==="MultiPoint")for(var be=0;be<re.length;be+=3)Te.push(re[be]),Te.push(re[be+1]),ee.numPoints++,ee.numSimplified++;else if(ge==="LineString")fo(Te,re,ee,N,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(be=0;be<re.length;be++)fo(Te,re[be],ee,N,ge==="Polygon",be===0);else if(ge==="MultiPolygon")for(var ye=0;ye<re.length;ye++){var Ee=re[ye];for(be=0;be<Ee.length;be++)fo(Te,Ee[be],ee,N,!0,be===0)}if(Te.length){var je=O.tags||null;if(ge==="LineString"&&J.lineMetrics){for(var ht in je={},O.tags)je[ht]=O.tags[ht];je.mapbox_clip_start=re.start/re.size,je.mapbox_clip_end=re.end/re.size}var Ze={geometry:Te,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:je};O.id!==null&&(Ze.id=O.id),ee.features.push(Ze)}}function fo(ee,O,N,J,re,ge){var Te=J*J;if(J>0&&O.size<(re?Te:J))N.numPoints+=O.length/3;else{for(var be=[],ye=0;ye<O.length;ye+=3)(J===0||O[ye+2]>Te)&&(N.numSimplified++,be.push(O[ye]),be.push(O[ye+1])),N.numPoints++;re&&function(Ee,je){for(var ht=0,Ze=0,Rt=Ee.length,Ot=Rt-2;Ze<Rt;Ot=Ze,Ze+=2)ht+=(Ee[Ze]-Ee[Ot])*(Ee[Ze+1]+Ee[Ot+1]);if(ht>0===je)for(Ze=0,Rt=Ee.length;Ze<Rt/2;Ze+=2){var It=Ee[Ze],Ut=Ee[Ze+1];Ee[Ze]=Ee[Rt-2-Ze],Ee[Ze+1]=Ee[Rt-1-Ze],Ee[Rt-2-Ze]=It,Ee[Rt-1-Ze]=Ut}}(be,ge),ee.push(be)}}function Hn(ee,O){var N=(O=this.options=function(re,ge){for(var Te in ge)re[Te]=ge[Te];return re}(Object.create(this.options),O)).debug;if(N&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(re,ge){var Te=[];if(re.type==="FeatureCollection")for(var be=0;be<re.features.length;be++)tt(Te,re.features[be],ge,be);else tt(Te,re.type==="Feature"?re:{geometry:re},ge);return Te}(ee,O);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=function(re,ge){var Te=ge.buffer/ge.extent,be=re,ye=di(re,1,-1-Te,Te,0,-1,2,ge),Ee=di(re,1,1-Te,2+Te,0,-1,2,ge);return(ye||Ee)&&(be=di(re,1,-Te,1+Te,0,-1,2,ge)||[],ye&&(be=gr(ye,1).concat(be)),Ee&&(be=be.concat(gr(Ee,-1)))),be}(J,O)).length&&this.splitTile(J,0,0,0),N&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function us(ee,O,N){return 32*((1<<ee)*N+O)+ee}function nl(ee,O){const N=ee.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const J=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!J)return O(null,null);const re=new Ge(J.features);let ge=yt(re);ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),O(null,{vectorTile:re,rawData:ge.buffer})}Hn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hn.prototype.splitTile=function(ee,O,N,J,re,ge,Te){for(var be=[ee,O,N,J],ye=this.options,Ee=ye.debug;be.length;){J=be.pop(),N=be.pop(),O=be.pop(),ee=be.pop();var je=1<<O,ht=us(O,N,J),Ze=this.tiles[ht];if(!Ze&&(Ee>1&&console.time("creation"),Ze=this.tiles[ht]=rl(ee,O,N,J,ye),this.tileCoords.push({z:O,x:N,y:J}),Ee)){Ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,N,J,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var Rt="z"+O;this.stats[Rt]=(this.stats[Rt]||0)+1,this.total++}if(Ze.source=ee,re){if(O===ye.maxZoom||O===re)continue;var Ot=1<<re-O;if(N!==Math.floor(ge/Ot)||J!==Math.floor(Te/Ot))continue}else if(O===ye.indexMaxZoom||Ze.numPoints<=ye.indexMaxPoints)continue;if(Ze.source=null,ee.length!==0){Ee>1&&console.time("clipping");var It,Ut,Jt,Ii,Di,Ci,kt=.5*ye.buffer/ye.extent,ke=.5-kt,nn=.5+kt,rr=1+kt;It=Ut=Jt=Ii=null,Di=di(ee,je,N-kt,N+nn,0,Ze.minX,Ze.maxX,ye),Ci=di(ee,je,N+ke,N+rr,0,Ze.minX,Ze.maxX,ye),ee=null,Di&&(It=di(Di,je,J-kt,J+nn,1,Ze.minY,Ze.maxY,ye),Ut=di(Di,je,J+ke,J+rr,1,Ze.minY,Ze.maxY,ye),Di=null),Ci&&(Jt=di(Ci,je,J-kt,J+nn,1,Ze.minY,Ze.maxY,ye),Ii=di(Ci,je,J+ke,J+rr,1,Ze.minY,Ze.maxY,ye),Ci=null),Ee>1&&console.timeEnd("clipping"),be.push(It||[],O+1,2*N,2*J),be.push(Ut||[],O+1,2*N,2*J+1),be.push(Jt||[],O+1,2*N+1,2*J),be.push(Ii||[],O+1,2*N+1,2*J+1)}}},Hn.prototype.getTile=function(ee,O,N){var J=this.options,re=J.extent,ge=J.debug;if(ee<0||ee>24)return null;var Te=1<<ee,be=us(ee,O=(O%Te+Te)%Te,N);if(this.tiles[be])return po(this.tiles[be],re);ge>1&&console.log("drilling down to z%d-%d-%d",ee,O,N);for(var ye,Ee=ee,je=O,ht=N;!ye&&Ee>0;)Ee--,je=Math.floor(je/2),ht=Math.floor(ht/2),ye=this.tiles[us(Ee,je,ht)];return ye&&ye.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Ee,je,ht),ge>1&&console.time("drilling down"),this.splitTile(ye.source,Ee,je,ht,ee,O,N),ge>1&&console.timeEnd("drilling down"),this.tiles[be]?po(this.tiles[be],re):null):null};class Xr extends o.VectorTileWorkerSource{constructor(O,N,J,re,ge){super(O,N,J,re,nl),ge&&(this.loadGeoJSON=ge)}loadData(O,N){const J=O&&O.request,re=J&&J.collectResourceTiming;this.loadGeoJSON(O,(ge,Te)=>{if(ge||!Te)return N(ge);if(typeof Te!="object")return N(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{$(Te,!0);try{if(O.filter){const ye=o.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(je=>`${je.key}: ${je.message}`).join(", "));const Ee=Te.features.filter(je=>ye.value.evaluate({zoom:0},je));Te={type:"FeatureCollection",features:Ee}}this._geoJSONIndex=O.cluster?new ut(function({superclusterOptions:ye,clusterProperties:Ee}){if(!Ee||!ye)return ye;const je={},ht={},Ze={accumulated:null,zoom:0},Rt={properties:null},Ot=Object.keys(Ee);for(const It of Ot){const[Ut,Jt]=Ee[It],Ii=o.createExpression(Jt),Di=o.createExpression(typeof Ut=="string"?[Ut,["accumulated"],["get",It]]:Ut);je[It]=Ii.value,ht[It]=Di.value}return ye.map=It=>{Rt.properties=It;const Ut={};for(const Jt of Ot)Ut[Jt]=je[Jt].evaluate(Ze,Rt);return Ut},ye.reduce=(It,Ut)=>{Rt.properties=Ut;for(const Jt of Ot)Ze.accumulated=It[Jt],It[Jt]=ht[Jt].evaluate(Ze,Rt)},ye}(O)).load(Te.features):function(ye,Ee){return new Hn(ye,Ee)}(Te,O.geojsonVtOptions)}catch(ye){return N(ye)}this.loaded={};const be={};if(re){const ye=o.getPerformanceMeasurement(J);ye&&(be.resourceTiming={},be.resourceTiming[O.source]=JSON.parse(JSON.stringify(ye)))}N(null,be)}})}reloadTile(O,N){const J=this.loaded;return J&&J[O.uid]?super.reloadTile(O,N):this.loadTile(O,N)}loadGeoJSON(O,N){if(O.request)o.getJSON(O.request,N);else{if(typeof O.data!="string")return N(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(O.data))}catch{return N(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(J){N(J)}}getClusterChildren(O,N){try{N(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(J){N(J)}}getClusterLeaves(O,N){try{N(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(J){N(J)}}}class ra{constructor(O){this.self=O,this.actor=new o.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Xr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,J)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=J},this.self.registerRTLTextPlugin=N=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=N.applyArabicShaping,o.plugin.processBidirectionalText=N.processBidirectionalText,o.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}clearCaches(O,N,J){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],J()}checkIfReady(O,N,J){J()}setReferrer(O,N){this.referrer=N}spriteLoaded(O,N){this.isSpriteLoaded[O]=N;for(const J in this.workerSources[O]){const re=this.workerSources[O][J];for(const ge in re)re[ge]instanceof o.VectorTileWorkerSource&&(re[ge].isSpriteLoaded=N,re[ge].fire(new o.Event("isSpriteLoaded")))}}setImages(O,N,J){this.availableImages[O]=N;for(const re in this.workerSources[O]){const ge=this.workerSources[O][re];for(const Te in ge)ge[Te].availableImages=N}J()}enableTerrain(O,N,J){this.terrain=N,J()}setProjection(O,N){this.projections[O]=o.getProjection(N)}setLayers(O,N,J){this.getLayerIndex(O).replace(N),J()}updateLayers(O,N,J){this.getLayerIndex(O).update(N.layers,N.removedIds),J()}loadTile(O,N,J){const re=this.enableTerrain?o.extend({enableTerrain:this.terrain},N):N;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,N.type,N.source).loadTile(re,J)}loadDEMTile(O,N,J){const re=this.enableTerrain?o.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(O,N.source).loadTile(re,J)}reloadTile(O,N,J){const re=this.enableTerrain?o.extend({enableTerrain:this.terrain},N):N;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,N.type,N.source).reloadTile(re,J)}abortTile(O,N,J){this.getWorkerSource(O,N.type,N.source).abortTile(N,J)}removeTile(O,N,J){this.getWorkerSource(O,N.type,N.source).removeTile(N,J)}removeSource(O,N,J){if(!this.workerSources[O]||!this.workerSources[O][N.type]||!this.workerSources[O][N.type][N.source])return;const re=this.workerSources[O][N.type][N.source];delete this.workerSources[O][N.type][N.source],re.removeSource!==void 0?re.removeSource(N,J):J()}loadWorkerSource(O,N,J){try{this.self.importScripts(N.url),J()}catch(re){J(re.toString())}}syncRTLPluginState(O,N,J){try{o.plugin.setState(N);const re=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&re!=null){this.self.importScripts(re);const ge=o.plugin.isParsed();J(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),ge)}}catch(re){J(re.toString())}}getAvailableImages(O){let N=this.availableImages[O];return N||(N=[]),N}getLayerIndex(O){let N=this.layerIndexes[O];return N||(N=this.layerIndexes[O]=new F),N}getWorkerSource(O,N,J){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][N]||(this.workerSources[O][N]={}),this.workerSources[O][N][J]||(this.workerSources[O][N][J]=new this.workerSourceTypes[N]({send:(re,ge,Te,be,ye,Ee)=>{this.actor.send(re,ge,Te,O,ye,Ee)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][N][J]}getDEMWorkerSource(O,N){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][N]||(this.demWorkerSources[O][N]=new B),this.demWorkerSources[O][N]}enforceCacheSizeLimit(O,N){o.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(O,N,J){J(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ra(self)),ra}),I(["./shared"],function(o){function k(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(!k(c[s],r[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const s in c)if(!k(c[s],r[s]))return!1;return!0}return c===r}var j=F;function F(c){return!function(r){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,y=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(y);try{m=new Worker(w),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(w),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===h.width}()?(B[s=r&&r.failIfMajorPerformanceCaveat]===void 0&&(B[s]=function(h){var m,y=function(w){var E=document.createElement("canvas"),A=Object.create(F.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=w,E.getContext("webgl",A)||E.getContext("experimental-webgl",A)}(h);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(s)),B[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(c)}var B={};function $(c,r,s){const h=o.window.document.createElement(c);return r!==void 0&&(h.className=r),s&&s.appendChild(h),h}function ne(c,r,s){const h=o.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const m of Object.keys(r))h.setAttributeNS(null,m,r[m]);return s&&s.appendChild(h),h}F.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const oe=o.window.document&&o.window.document.documentElement.style,ve=oe&&oe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ie;function Ge(){oe&&ve&&(Ie=oe[ve],oe[ve]="none")}function qe(){oe&&ve&&(oe[ve]=Ie)}function st(c){c.preventDefault(),c.stopPropagation(),o.window.removeEventListener("click",st,!0)}function ft(){o.window.addEventListener("click",st,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",st,!0)},0)}function He(c,r){const s=c.getBoundingClientRect();return xt(c,s,r)}function yt(c,r){const s=c.getBoundingClientRect(),h=[];for(let m=0;m<r.length;m++)h.push(xt(c,s,r[m]));return h}function We(c){return o.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function xt(c,r,s){const h=c.offsetWidth===r.width?1:c.offsetWidth/r.width;return new o.pointGeometry((s.clientX-r.left)*h,(s.clientY-r.top)*h)}function Et(c,r){var s=r[0],h=r[1],m=r[2],y=r[3],w=s*y-m*h;return w?(c[0]=y*(w=1/w),c[1]=-h*w,c[2]=-m*w,c[3]=s*w,c):null}function gt(c){const{userImage:r}=c;return!!(r&&r.render&&r.render())&&(c.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ft extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,s){this._validate(r,s)&&(this.images[r]=s)}_validate(r,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),h=!1),h}_validateStretch(r,s){if(!r)return!0;let h=0;for(const m of r){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(r,s){return!(r&&(r.length!==4||r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,s){s.version=this.images[r].version+1,this.images[r]=s,this.updatedImages[r]=!0}removeImage(r){const s=this.images[r];delete this.images[r],delete this.patterns[r],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,s){let h=!0;if(!this.isLoaded())for(const m of r)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(r,s):this.requestors.push({ids:r,callback:s})}_notify(r,s){const h={};for(const m of r){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const y=this.images[m];y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:r,height:s}=this.atlasImage;return{width:r,height:s}}getPattern(r){const s=this.patterns[r],h=this.getImage(r);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new o.ImagePosition(m,h);this.patterns[r]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const s=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:s,h}=o.potpack(r),m=this.atlasImage;m.resize({width:s||1,height:h||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],E=w.x+1,A=w.y+1,P=this.images[y].data,D=P.width,U=P.height;o.RGBAImage.copy(P,m,{x:0,y:0},{x:E,y:A},{width:D,height:U}),o.RGBAImage.copy(P,m,{x:0,y:U-1},{x:E,y:A-1},{width:D,height:1}),o.RGBAImage.copy(P,m,{x:0,y:0},{x:E,y:A+U},{width:D,height:1}),o.RGBAImage.copy(P,m,{x:D-1,y:0},{x:E-1,y:A},{width:1,height:U}),o.RGBAImage.copy(P,m,{x:0,y:0},{x:E+D,y:A},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const s of r){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];gt(h)&&this.updateImage(s,h)}}}const bt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(c,r){return function([s,h,m]){const y=o.degToRad(h+90),w=o.degToRad(m);return{x:s*Math.cos(y)*Math.sin(w),y:s*Math.sin(y)*Math.sin(w),z:s*Math.cos(w),azimuthal:h,polar:m}}(c.expression.evaluate(r))}interpolate(c,r,s){return{x:o.number(c.x,r.x,s),y:o.number(c.y,r.y,s),z:o.number(c.z,r.z,s),azimuthal:o.number(c.azimuthal,r.azimuthal,s),polar:o.number(c.polar,r.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ei="-transition";class ri extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(bt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s={}){if(!this._validate(o.validateLight,r,s))for(const h in r){const m=r[h];o.endsWith(h,ei)?this._transitionable.setTransition(h.slice(0,-ei.length),m):this._transitionable.setValue(h,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Er=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),vi="-transition";class fi extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(Er),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(r){for(const s in r){const h=r[s];o.endsWith(s,vi)?this._transitionable.setTransition(s.slice(0,-vi.length),h):this._transitionable.setValue(s,h)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Lt(c,r,s,h){const m=o.smoothstep(45,65,s),[y,w]=Gi(c,h),E=o.length(r);let A=1-Math.min(1,Math.exp((E-y)/(w-y)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*m*c.alpha}function Gi(c,r){const s=.5/Math.tan(.5*r);return[c.range[0]+s,c.range[1]+s]}const lr=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),Nr="-transition";class bi extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(lr),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const r=this._transform,s=r.projection.name==="globe",h=o.globeToMercatorTransition(r.zoom),m=this.properties.get("range"),y=[.5,3];return{range:s?[o.number(y[0],m[0],h),o.number(y[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s={}){if(!this._validate(o.validateFog,r,s)){for(const h of Object.keys(o.spec.fog))r&&r[h]===void 0&&(r[h]=o.spec.fog[h].default);for(const h in r){const m=r[h];o.endsWith(h,Nr)?this._transitionable.setTransition(h.slice(0,-Nr.length),m):this._transitionable.setValue(h,m)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(h,m,y){const w=o.MercatorCoordinate.fromLngLat(m),E=y.elevation?y.elevation.getAtPointOrZero(w):0,A=[w.x,w.y,E];return o.transformMat4(A,A,y.mercatorFogMatrix),Lt(h,A,y.pitch,y._fov)}(this.state,r,s):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Gi(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Fi{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const y=new Fi.Actor(h[m],s,this.id);y.name=`Worker ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,h){o.asyncAll(this.actors,(m,y)=>{m.send(r,s,y)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function rn(c,r,s){return r*(o.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}Fi.Actor=o.Actor;class $e{constructor(r,s,h,m){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(r,s){let h,m;if(r instanceof o.pointGeometry||typeof r[0]=="number"){const y=o.pointGeometry.convert(r);h=[o.pointGeometry.convert(r)],m=s.isPointAboveHorizon(y)}else{const y=o.pointGeometry.convert(r[0]),w=o.pointGeometry.convert(r[1]);h=[y,w],m=o.polygonizeBounds(y,w).every(E=>s.isPointAboveHorizon(E))}return new $e(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,r),y=this.cameraPoint.clone();switch(3*((y.y>s.y)+(y.y>h.y))+((y.x>s.x)+(y.x>h.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(r,s,h,m=0){const y=r.queryPadding/s._pixelsPerMercatorPixel+1,w=h?this._bufferedCameraMercator(y,s):this._bufferedScreenMercator(y,s);let E=r.tileID.wrap+(w.unwrapped?m:0);const A=w.polygon.map(H=>o.getTilePoint(r.tileTransform,H,E));if(!o.polygonIntersectsBox(A,0,0,o.EXTENT,o.EXTENT))return;E=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const P=this.screenGeometryMercator.polygon.map(H=>o.getTileVec3(r.tileTransform,H,E)),D=P.map(H=>new o.pointGeometry(H[0],H[1])),U=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),G=o.getTileVec3(r.tileTransform,U,E),K=P.map(H=>{const Z=o.sub(H,H,G);return o.normalize(Z,Z),new o.Ray(G,Z)}),W=rn(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:K,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(X=o.getBounds(A),X.min.x=o.clamp(X.min.x,0,o.EXTENT),X.min.y=o.clamp(X.min.y,0,o.EXTENT),X.max.x=o.clamp(X.max.x,0,o.EXTENT),X.max.y=o.clamp(X.max.y,0,o.EXTENT),X),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:W};var X}_bufferedScreenMercator(r,s){const h=Pt(r);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(r,s){const h=Pt(r);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(r,s){const h=function(y,w){const E=o.multiply([],w.pixelMatrix,w.globeMatrix),A=[0,-o.GLOBE_RADIUS,0,1],P=[0,o.GLOBE_RADIUS,0,1],D=[0,0,0,1];o.transformMat4$1(A,A,E),o.transformMat4$1(P,P,E),o.transformMat4$1(D,D,E);const U=new o.pointGeometry(A[0]/A[3],A[1]/A[3]),G=new o.pointGeometry(P[0]/P[3],P[1]/P[3]),K=o.polygonContainsPoint(y,U)&&A[3]<D[3],W=o.polygonContainsPoint(y,G)&&P[3]<D[3];if(!K&&!W)return null;const X=function(pe,he,xe){for(let Se=1;Se<pe.length;Se++){const Ye=ut(he.pointCoordinate3D(pe[Se-1]).x),we=ut(he.pointCoordinate3D(pe[Se]).x);if(xe<0){if(Ye<we)return{idx:Se,t:-Ye/(we-1-Ye)}}else if(we<Ye)return{idx:Se,t:(1-Ye)/(we+1-Ye)}}return null}(y,w,K?-1:1);if(!X)return null;const{idx:H,t:Z}=X;let te=H>1?St(y.slice(0,H),w):[],Y=H<y.length?St(y.slice(H),w):[];te=te.map(pe=>new o.pointGeometry(ut(pe.x),pe.y)),Y=Y.map(pe=>new o.pointGeometry(ut(pe.x),pe.y));const fe=[...te];fe.length===0&&fe.push(Y[Y.length-1]);const de=o.number(fe[fe.length-1].y,(Y.length===0?te[0]:Y[0]).y,Z);let ae;return ae=K?[new o.pointGeometry(0,de),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,de)]:[new o.pointGeometry(1,de),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,de)],fe.push(...ae),Y.length===0?fe.push(te[0]):fe.push(...Y),{polygon:fe.map(pe=>new o.MercatorCoordinate(pe.x,pe.y)),unwrapped:!1}}(r,s);if(h)return h;const m=function(y,w){let E=!1,A=-1/0,P=0;for(let U=0;U<y.length-1;U++)y[U].x>A&&(A=y[U].x,P=U);for(let U=0;U<y.length-1;U++){const G=(P+U)%(y.length-1),K=y[G],W=y[G+1];Math.abs(K.x-W.x)>.5&&(K.x<W.x?(K.x+=1,G===0&&(y[y.length-1].x+=1)):(W.x+=1,G+1===y.length-1&&(y[0].x+=1)),E=!0)}const D=o.mercatorXfromLng(w.center.lng);return E&&D<Math.abs(D-1)&&y.forEach(U=>{U.x-=1}),{polygon:y,unwrapped:E}}(St(r,s).map(y=>new o.pointGeometry(ut(y.x),y.y)),s);return{polygon:m.polygon.map(y=>new o.MercatorCoordinate(y.x,y.y)),unwrapped:m.unwrapped}}}function St(c,r){return o.resample(c,s=>{const h=r.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function ut(c){return c<0?1+c%1:c%1}function Pt(c){return 100*c|0}function Ei(c,r,s,h,m){const y=function(w,E){if(w)return m(w);if(E){const A=o.pick(o.extend(E,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(A.vectorLayers=E.vector_layers,A.vectorLayerIds=A.vectorLayers.map(P=>P.id)),E.language_options&&(A.languageOptions=E.language_options),E.language&&E.language[E.id]&&(A.language=E.language[E.id]),E.worldview_options&&(A.worldviewOptions=E.worldview_options),E.worldview?A.worldview=E.worldview[E.id]:E.worldview_default&&(A.worldview=E.worldview_default),A.tiles=r.canonicalizeTileset(A,c.url),m(null,A)}};return c.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(c.url,null,s,h),o.ResourceType.Source),y):o.exported.frame(()=>y(null,c))}class yi{constructor(r,s,h){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const s=Math.pow(2,r.z),h=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),w=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return r.x>=h&&r.x<y&&r.y>=m&&r.y<w}}class ni{constructor(r,s,h){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ce{constructor(r,s,h,m){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,s,h){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],w=s.attributes[y.name];w!==void 0&&r.vertexAttribPointer(w,y.components,r[Zt[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _e{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pe extends _e{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ke extends _e{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Xe extends _e{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class rt extends _e{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class vt extends _e{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ue extends _e{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class lt extends _e{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class tt extends _e{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class zt extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class At extends _e{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Bt extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class Gt extends _e{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class li extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class di extends _e{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class pi extends _e{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Si extends _e{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Pr extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class fr extends _e{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class hn extends _e{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Un extends _e{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class ho extends _e{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class gr extends _e{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kr extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class po extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class il extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class rl extends _e{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Sc extends _e{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class fo extends _e{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Hn extends _e{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class us extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class nl extends _e{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Xr extends _e{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class ra extends Xr{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ee extends Xr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class O extends ee{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class N{constructor(r,s,h,m){this.context=r,this.width=s,this.height=h;const y=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new ra(r,y),m&&(this.depthAttachment=new ee(r,y))}destroy(){const r=this.context.gl,s=this.colorAttachment.get();if(s&&r.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}r.deleteFramebuffer(this.framebuffer)}}class J{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Pe(this),this.clearDepth=new Ke(this),this.clearStencil=new Xe(this),this.colorMask=new rt(this),this.depthMask=new vt(this),this.stencilMask=new Ue(this),this.stencilFunc=new lt(this),this.stencilOp=new tt(this),this.stencilTest=new zt(this),this.depthRange=new At(this),this.depthTest=new Bt(this),this.depthFunc=new Gt(this),this.blend=new li(this),this.blendFunc=new di(this),this.blendColor=new pi(this),this.blendEquation=new Si(this),this.cullFace=new Pr(this),this.cullFaceSide=new fr(this),this.frontFace=new hn(this),this.program=new Un(this),this.activeTexture=new ho(this),this.viewport=new gr(this),this.bindFramebuffer=new kr(this),this.bindRenderbuffer=new po(this),this.bindTexture=new il(this),this.bindVertexBuffer=new rl(this),this.bindElementBuffer=new Sc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new fo(this),this.pixelStoreUnpack=new Hn(this),this.pixelStoreUnpackPremultiplyAlpha=new us(this),this.pixelStoreUnpackFlipY=new nl(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s){return new ni(this,r,s)}createVertexBuffer(r,s,h){return new ce(this,r,s,h)}createRenderbuffer(r,s,h){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,r,s,h),this.bindRenderbuffer.set(null),y}createFramebuffer(r,s,h){return new N(this,r,s,h)}clear({color:r,depth:s,stencil:h}){const m=this.gl;let y=0;r&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){k(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class re extends o.Evented{constructor(r,s,h,m){super(),this.id=r,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ei(this._options,this.map._requestManager,null,null,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new yi(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const h=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(y,w,E,A)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):y?(r.state="errored",s(y)):w?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:A}),r.setTexture(w,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(r,s,h){r.setTexture(s,h)}static unloadTileData(r,s){r.texture&&s.saveTileTexture(r.texture)}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s()}unloadTile(r,s){r.texture&&this.map.painter.saveTileTexture(r.texture),s()}hasTransition(){return!1}}let ge;function Te(c,r,s,h,m,y,w,E){const A=[c,s,m,r,h,y,1,1,1],P=[w,E,1],D=o.adjoint([],A),[U,G,K]=o.transformMat3(P,P,o.transpose(D,D));return o.multiply$1(A,[U,0,0,0,G,0,0,0,K],A)}class be extends o.Evented{constructor(r,s,h,m){super(),this.id=r,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(r,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(h,m)=>{if(this._loaded=!0,h)this.fire(new o.ErrorEvent(h));else if(m){const{HTMLImageElement:y}=o.window;this.image=m instanceof y?o.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const s=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let m=1/0,y=1/0,w=-1/0,E=-1/0;for(const U of h)m=Math.min(m,U.x),y=Math.min(y,U.y),w=Math.max(w,U.x),E=Math.max(E,U.y);const A=Math.max(w-m,E-y),P=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),D=Math.pow(2,P);return new o.CanonicalTileID(P,Math.floor((m+w)/2*D),Math.floor((y+E)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[h,m,y,w]=this.coordinates.map(A=>{const P=s.projection.project(A[0],A[1]);return o.getTilePoint(s,P)._round()});this.perspectiveTransform=function(A,P,D,U,G,K,W,X,H,Z){const te=Te(0,0,A,0,0,P,A,P),Y=Te(D,U,G,K,W,X,H,Z);return o.multiply$1(Y,o.adjoint(te,te),Y),[Y[6]/Y[8]*A/o.EXTENT,Y[7]/Y[8]*P/o.EXTENT]}(this.width,this.height,h.x,h.y,m.x,m.y,w.x,w.y,y.x,y.y);const E=this._boundsArray=new o.StructArrayLayout4i8;E.emplaceBack(h.x,h.y,0,0),E.emplaceBack(m.x,m.y,o.EXTENT,0),E.emplaceBack(w.x,w.y,0,o.EXTENT),E.emplaceBack(y.x,y.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(E,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,s=r.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ye={vector:class extends o.Evented{constructor(c,r,s,h){if(super(),this.id=c,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,s=this.worldview||this.map._worldview;this._tileJSONRequest=Ei(this._options,this.map._requestManager,r,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.ErrorEvent(h))):m&&(o.extend(this,m),m.bounds&&(this.tileBounds=new yi(m.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const s of r)s.clearTiles()})}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}_setLanguage(c){return c===this.language||this.setSourceProperty(()=>{this.language=c}),this}_setWorldview(c){return c===this.worldview?this:this.worldviewOptions&&c&&!this.worldviewOptions[c]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${c}".`),this):(this.setSourceProperty(()=>{this.worldview=c}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(c,r){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=r:c.request=c.actor.send("reloadTile",h,m.bind(this));else if(c.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const y=o.loadVectorTile.call({deduped:this._deduped},h,(w,E)=>{w||!E?m.call(this,w):(h.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},c.actor&&c.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);c.request={cancel:y}}function m(y,w){return delete c.request,c.aborted?r(null):y&&y.status!==404?r(y):(w&&w.resourceTiming&&(c.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&c.setExpiryData(w),c.loadVectorData(w,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:re,"raster-dem":class extends re{constructor(c,r,s,h){super(c,r,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(c,r){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,y){m&&(c.state="errored",r(m)),y&&(c.dem=y,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",r(null))}c.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(m,y,w,E){if(delete c.request,c.aborted)c.state="unloaded",r(null);else if(m)c.state="errored",r(m);else if(y){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:w,expires:E});const A=o.window.ImageBitmap&&y instanceof o.window.ImageBitmap&&(ge==null&&(ge=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),ge),P=1-(y.width-o.prevPowerOfTwo(y.width))/2;P<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const D=A?y:o.exported.getImageData(y,P),U={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:P};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",U,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const r=c.canonical,s=Math.pow(2,r.z),h=(r.x-1+s)%s,m=r.x===0?c.wrap-1:c.wrap,y=(r.x+1+s)%s,w=r.x+1===s?c.wrap+1:c.wrap,E={};return E[new o.OverscaledTileID(c.overscaledZ,m,r.z,h,r.y).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(E[new o.OverscaledTileID(c.overscaledZ,m,r.z,h,r.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<s&&(E[new o.OverscaledTileID(c.overscaledZ,m,r.z,h,r.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),E}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends o.Evented{constructor(c,r,s,h){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*m,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*m,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},r),this}getClusterChildren(c,r){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},r),this}getClusterLeaves(c,r,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:r,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(c.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,r){const s=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(s,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete c.request,c.unloadVectorData(),c.aborted?r(null):h?r(h):(c.loadVectorData(m,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends be{constructor(c,r,s,h){super(c,r,s,h),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const r of c.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const r=this.video.seekable;c<r.start(0)||c>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,r=c.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(c,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:be,canvas:class extends be{constructor(c,r,s,h){super(c,r,s,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.Evented{constructor(c,r,s,h){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new yi(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:r,y:s,z:h}=c.canonical;return this._implementation.hasTile({x:r,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,r){const{x:s,y:h,z:m}=c.tileID.canonical,y=new o.window.AbortController,w=this._implementation.loadTile({x:s,y:h,z:m},{signal:y.signal});if(!w)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",r(null);w.cancel=()=>y.abort(),c.request=w.then(function(E){return delete c.request,c.aborted?(c.state="unloaded",r(null)):E?function(A){return A instanceof o.window.ImageData||A instanceof o.window.ImageBitmap||A instanceof o.window.HTMLCanvasElement}(E)?(this.loadTileData(c,E),c.state="loaded",void r(null)):(c.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",r(null))}.bind(this)).catch(E=>{E.code!==20&&(c.state="errored",r(E))})}loadTileData(c,r){re.loadTileData(c,r,this._map.painter)}unloadTileData(c){re.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:r,y:s,z:h}=c.tileID.canonical,m=this._implementation.prepareTile({x:r,y:s,z:h});return m?(this.loadTileData(c,m),c.state="loaded",m):null}unloadTile(c,r){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:s,y:h,z:m}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}r()}abortTile(c,r){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ee=function(c,r,s,h){const m=new ye[r.type](c,r,s,h);if(m.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function je(c,r){const s=o.identity([]);return o.scale(s,s,[.5*c.width,.5*-c.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,c.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(s)}function ht(c,r,s,h,m,y,w,E=!1){const A=c.tilesIn(h,w,E);A.sort(Rt);const P=[];for(const U of A)P.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,s,c._state,U,m,y,je(c.transform,U.tile.tileID),E)});const D=function(U){const G={},K={};for(const W of U){const X=W.queryResults,H=W.wrappedTileID,Z=K[H]=K[H]||{};for(const te in X){const Y=X[te],fe=Z[te]=Z[te]||{},de=G[te]=G[te]||[];for(const ae of Y)fe[ae.featureIndex]||(fe[ae.featureIndex]=!0,de.push(ae))}}return G}(P);for(const U in D)D[U].forEach(G=>{const K=G.feature,W=K.layer;W&&W.type!=="background"&&W.type!=="sky"&&(K.source=W.source,W["source-layer"]&&(K.sourceLayer=W["source-layer"]),K.state=K.id!==void 0?c.getFeatureState(W["source-layer"],K.id):{})});return D}function Ze(c,r){const s=c.getRenderableIds().map(y=>c.getTileByID(y)),h=[],m={};for(let y=0;y<s.length;y++){const w=s[y],E=w.tileID.canonical.key;m[E]||(m[E]=!0,w.querySourceFeatures(h,r))}return h}function Rt(c,r){const s=c.tileID,h=r.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Ot(){return ka.workerClass!=null?new ka.workerClass:new o.window.Worker(ka.workerUrl)}const It="mapboxgl_preloaded_worker_pool";class Ut{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Ut.workerCount;)this.workers.push(new Ot);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}let Jt;function Ii(){return Jt||(Jt=new Ut),Jt}function Di(c,r){const s={};for(const h in c)h!=="ref"&&(s[h]=c[h]);return o.refProperties.forEach(h=>{h in r&&(s[h]=r[h])}),s}function Ci(c){c=c.slice();const r=Object.create(null);for(let s=0;s<c.length;s++)r[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=Di(c[s],r[c[s].ref]));return c}Ut.workerCount=2;const kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ke(c,r,s){s.push({command:kt.addSource,args:[c,r[c]]})}function nn(c,r,s){r.push({command:kt.removeSource,args:[c]}),s[c]=!0}function rr(c,r,s,h){nn(c,s,h),ke(c,r,s)}function mo(c,r,s){let h;for(h in c[s])if(c[s].hasOwnProperty(h)&&h!=="data"&&!k(c[s][h],r[s][h]))return!1;for(h in r[s])if(r[s].hasOwnProperty(h)&&h!=="data"&&!k(c[s][h],r[s][h]))return!1;return!0}function ol(c,r,s,h,m,y){let w;for(w in r=r||{},c=c||{})c.hasOwnProperty(w)&&(k(c[w],r[w])||s.push({command:y,args:[h,w,r[w],m]}));for(w in r)r.hasOwnProperty(w)&&!c.hasOwnProperty(w)&&(k(c[w],r[w])||s.push({command:y,args:[h,w,r[w],m]}))}function Sn(c){return c.id}function sl(c,r){return c[r.id]=r,c}class Wp{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let s=1,h=this._distances[s];const m=r*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const y=s-1,w=this._distances[y],E=h-w,A=E>0?(m-w)/E:0;return this.points[y].mult(1-A).add(this.points[s].mult(A))}}class hs{constructor(r,s,h){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/h),this.yCellCount=Math.ceil(s/h);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,h,m,y){this._forEachCell(s,h,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(r,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(r,s,h,m,y,w){this.boxCells[y].push(w)}_insertCircleCell(r,s,h,m,y,w){this.circleCells[y].push(w)}_query(r,s,h,m,y,w){if(h<0||r>this.width||m<0||s>this.height)return!y&&[];const E=[];if(r<=0&&s<=0&&this.width<=h&&this.height<=m){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],D=this.circles[3*A+1],U=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:P-U,y1:D-U,x2:P+U,y2:D+U})}return w?E.filter(w):E}return this._forEachCell(r,s,h,m,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?E.length>0:E}_queryCircle(r,s,h,m,y){const w=r-h,E=r+h,A=s-h,P=s+h;if(E<0||w>this.width||P<0||A>this.height)return!m&&[];const D=[];return this._forEachCell(w,A,E,P,this._queryCellCircle,D,{hitTest:m,circle:{x:r,y:s,radius:h},seenUids:{box:{},circle:{}}},y),m?D.length>0:D}query(r,s,h,m,y){return this._query(r,s,h,m,!1,y)}hitTest(r,s,h,m,y){return this._query(r,s,h,m,!0,y)}hitTestCircle(r,s,h,m){return this._queryCircle(r,s,h,!0,m)}_queryCell(r,s,h,m,y,w,E,A){const P=E.seenUids,D=this.boxCells[y];if(D!==null){const G=this.bboxes;for(const K of D)if(!P.box[K]){P.box[K]=!0;const W=4*K;if(r<=G[W+2]&&s<=G[W+3]&&h>=G[W+0]&&m>=G[W+1]&&(!A||A(this.boxKeys[K]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[K],x1:G[W],y1:G[W+1],x2:G[W+2],y2:G[W+3]})}}}const U=this.circleCells[y];if(U!==null){const G=this.circles;for(const K of U)if(!P.circle[K]){P.circle[K]=!0;const W=3*K;if(this._circleAndRectCollide(G[W],G[W+1],G[W+2],r,s,h,m)&&(!A||A(this.circleKeys[K]))){if(E.hitTest)return w.push(!0),!0;{const X=G[W],H=G[W+1],Z=G[W+2];w.push({key:this.circleKeys[K],x1:X-Z,y1:H-Z,x2:X+Z,y2:H+Z})}}}}}_queryCellCircle(r,s,h,m,y,w,E,A){const P=E.circle,D=E.seenUids,U=this.boxCells[y];if(U!==null){const K=this.bboxes;for(const W of U)if(!D.box[W]){D.box[W]=!0;const X=4*W;if(this._circleAndRectCollide(P.x,P.y,P.radius,K[X+0],K[X+1],K[X+2],K[X+3])&&(!A||A(this.boxKeys[W])))return w.push(!0),!0}}const G=this.circleCells[y];if(G!==null){const K=this.circles;for(const W of G)if(!D.circle[W]){D.circle[W]=!0;const X=3*W;if(this._circlesCollide(K[X],K[X+1],K[X+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[W])))return w.push(!0),!0}}}_forEachCell(r,s,h,m,y,w,E,A){const P=this._convertToXCellCoord(r),D=this._convertToYCellCoord(s),U=this._convertToXCellCoord(h),G=this._convertToYCellCoord(m);for(let K=P;K<=U;K++)for(let W=D;W<=G;W++)if(y.call(this,r,s,h,m,this.xCellCount*W+K,w,E,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,h,m,y,w){const E=m-r,A=y-s,P=h+w;return P*P>E*E+A*A}_circleAndRectCollide(r,s,h,m,y,w,E){const A=(w-m)/2,P=Math.abs(r-(m+A));if(P>A+h)return!1;const D=(E-y)/2,U=Math.abs(s-(y+D));if(U>D+h)return!1;if(P<=A||U<=D)return!0;const G=P-A,K=U-D;return G*G+K*K<=h*h}}const dt=Math.tan(85*Math.PI/180);function ti(c,r,s,h,m,y,w){const E=o.create();if(s)if(y.name==="globe"){const A=o.calculateGlobeLabelMatrix(m,r);o.multiply(E,E,A)}else{const A=Et([],w);E[0]=A[0],E[1]=A[1],E[4]=A[2],E[5]=A[3],h||o.rotateZ(E,E,m.angle)}else o.multiply(E,m.labelPlaneMatrix,c);return E}function ii(c,r,s,h,m,y,w){const E=ti(c,r,s,h,m,y,w);return y.name==="globe"&&s||(E[2]=E[6]=E[10]=E[14]=0),E}function An(c,r,s,h,m,y,w){if(s){if(y.name==="globe"){const E=ti(c,r,s,h,m,y,w);return o.invert(E,E),o.multiply(E,c,E),E}{const E=o.clone(c),A=o.identity([]);return A[0]=w[0],A[1]=w[1],A[4]=w[2],A[5]=w[3],o.multiply(E,E,A),h||o.rotateZ(E,E,-m.angle),E}}return m.glCoordMatrix}function In(c,r,s=0){const h=[c.x,c.y,s,1];s?o.transformMat4$1(h,h,r):Vr(h,h,r);const m=h[3];return{point:[h[0]/m,h[1]/m,h[2]/m],signedDistanceFromCamera:m}}function Xt(c,r){const s=[c[0],c[1],c[2],1];o.transformMat4$1(s,s,r);const h=s[3];return{point:[s[0]/h,s[1]/h,s[2]/h],signedDistanceFromCamera:h}}function na(c,r){return Math.min(.5+c/r*.5,1.5)}function oa(c,r){const s=c[0]/c[3],h=c[1]/c[3];return s>=-r[0]&&s<=r[0]&&h>=-r[1]&&h<=r[1]}function sa(c,r,s,h,m,y,w,E,A,P){const D=s.transform,U=h?c.textSizeData:c.iconSizeData,G=o.evaluateSizeForZoom(U,s.transform.zoom),K=D.projection.name==="globe",W=[256/s.width*2+1,256/s.height*2+1],X=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;X.clear();let H=null;K&&(H=h?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const Z=c.lineVertexArray,te=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,Y=s.transform.width/s.transform.height;let fe=!1;for(let de=0;de<te.length;de++){const ae=te.get(de);if(ae.writingMode!==o.WritingMode.vertical||fe||de!==0&&te.get(de-1).writingMode===o.WritingMode.horizontal||(fe=!0),(ae.hidden||ae.writingMode===o.WritingMode.vertical)&&!fe){go(ae.numGlyphs,X);continue}fe=!1;const pe=new o.pointGeometry(ae.tileAnchorX,ae.tileAnchorY),he=A?A(pe):[0,0,0],xe=D.projection.projectTilePoint(pe.x,pe.y,P.canonical),Se=[xe.x+he[0],xe.y+he[1],xe.z+he[2]],Ye=[...Se,1];if(o.transformMat4$1(Ye,Ye,r),!oa(Ye,W)){go(ae.numGlyphs,X);continue}const we=na(s.transform.cameraToCenterDistance,Ye[3]),Le=o.evaluateSizeForFeature(U,G,ae),Fe=w?Le/we:Le*we,it=In(new o.pointGeometry(Se[0],Se[1]),m,Se[2]);if(it.signedDistanceFromCamera<=0){go(ae.numGlyphs,X);continue}let ze={};const Qe=w?null:A,Oe=Ch(ae,Fe,!1,E,r,m,y,c.glyphOffsetArray,Z,X,H,it.point,pe,ze,Y,Qe,D.projection,P,w);fe=Oe.useVertical,Qe&&Oe.needsFlipping&&(ze={}),(Oe.notEnoughRoom||fe||Oe.needsFlipping&&Ch(ae,Fe,!0,E,r,m,y,c.glyphOffsetArray,Z,X,H,it.point,pe,ze,Y,Qe,D.projection,P,w).notEnoughRoom)&&go(ae.numGlyphs,X)}h?(c.text.dynamicLayoutVertexBuffer.updateData(X),H&&c.text.globeExtVertexBuffer.updateData(H)):(c.icon.dynamicLayoutVertexBuffer.updateData(X),H&&c.icon.globeExtVertexBuffer.updateData(H))}function on(c,r,s,h,m,y,w,E,A,P,D,U,G,K,W,X){const H=E.glyphStartIndex+E.numGlyphs,Z=E.lineStartIndex,te=E.lineStartIndex+E.lineLength,Y=r.getoffsetX(E.glyphStartIndex),fe=r.getoffsetX(H-1),de=_o(c*Y,s,h,m,y,w,E.segment,Z,te,A,P,D,U,G,!0,K,W,X);if(!de)return null;const ae=_o(c*fe,s,h,m,y,w,E.segment,Z,te,A,P,D,U,G,!0,K,W,X);return ae?{first:de,last:ae}:null}function Yi(c,r,s,h){return c.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-r.y)>Math.abs(s.x-r.x)*h?{useVertical:!0}:c.writingMode===o.WritingMode.vertical?r.y<s.y?{needsFlipping:!0}:null:c.flipState!==0&&function(m,y,w){const E=(y.x-m.x)*w;return E===0||Math.abs((y.y-m.y)/E)>dt}(r,s,h)?c.flipState===1?{needsFlipping:!0}:null:r.x>s.x?{needsFlipping:!0}:null}function Ch(c,r,s,h,m,y,w,E,A,P,D,U,G,K,W,X,H,Z,te){const Y=r/24,fe=c.lineOffsetX*Y,de=c.lineOffsetY*Y;let ae;if(c.numGlyphs>1){const pe=c.glyphStartIndex+c.numGlyphs,he=c.lineStartIndex,xe=c.lineStartIndex+c.lineLength,Se=on(Y,E,fe,de,s,U,G,c,A,y,K,X,!1,H,Z,te);if(!Se)return{notEnoughRoom:!0};const Ye=Xt(Se.first.point,w).point,we=Xt(Se.last.point,w).point,Le=new o.pointGeometry(Ye[0],Ye[1]),Fe=new o.pointGeometry(we[0],we[1]);if(h&&!s){const it=Yi(c,Le,Fe,W);if(c.flipState=it&&it.needsFlipping?1:2,it)return it}ae=[Se.first];for(let it=c.glyphStartIndex+1;it<pe-1;it++)ae.push(_o(Y*E.getoffsetX(it),fe,de,s,U,G,c.segment,he,xe,A,y,K,X,!1,!1,H,Z,te));ae.push(Se.last)}else{if(h&&!s){const he=In(G,m).point,xe=c.lineStartIndex+c.segment+1,Se=new o.pointGeometry(A.getx(xe),A.gety(xe)),Ye=In(Se,m),we=Ye.signedDistanceFromCamera>0?Ye.point:al(G,Se,he,1,m,void 0,H,Z.canonical),Le=Yi(c,new o.pointGeometry(he[0],he[1]),new o.pointGeometry(we[0],we[1]),W);if(c.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}const pe=_o(Y*E.getoffsetX(c.glyphStartIndex),fe,de,s,U,G,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,A,y,K,X,!1,!1,H,Z,te);if(!pe)return{notEnoughRoom:!0};ae=[pe]}if(D)for(const pe of ae)o.updateGlobeVertexNormal(D,P.length+0,pe.up[0],pe.up[1],pe.up[2]),o.updateGlobeVertexNormal(D,P.length+1,pe.up[0],pe.up[1],pe.up[2]),o.updateGlobeVertexNormal(D,P.length+2,pe.up[0],pe.up[1],pe.up[2]),o.updateGlobeVertexNormal(D,P.length+3,pe.up[0],pe.up[1],pe.up[2]),o.addDynamicAttributes(P,pe.point[0],pe.point[1],pe.point[2],pe.angle);else for(const pe of ae)o.addDynamicAttributes(P,pe.point[0],pe.point[1],pe.point[2],pe.angle);return{}}function ds(c,r,s,h,m){const y=h.projectTilePoint(c.x,c.y,r);if(!m)return In(y,s,y.z);const w=m(c);return In(new o.pointGeometry(y.x+w[0],y.y+w[1]),s,y.z+w[2])}function al(c,r,s,h,m,y,w,E){const A=ds(c.add(c.sub(r)._unit()),E,m,w,y).point,P=o.sub([],s,A);return o.scaleAndAdd([],s,P,h/o.length(P))}function _o(c,r,s,h,m,y,w,E,A,P,D,U,G,K,W,X,H,Z){const te=h?c-r:c+r;let Y=te>0?1:-1,fe=0;h&&(Y*=-1,fe=Math.PI),Y<0&&(fe+=Math.PI);let de=Y>0?E+w:E+w+1,ae=m,pe=m,he=0,xe=0;const Se=Math.abs(te),Ye=[],we=[];let Le=y;const Fe=()=>{const Tt=de-Y;return he===0?y:new o.pointGeometry(P.getx(Tt),P.gety(Tt))},it=()=>al(Fe(),Le,pe,Se-he+1,D,G,X,H.canonical);for(;he+xe<=Se;){if(de+=Y,de<E||de>=A)return null;if(pe=ae,Ye.push(ae),K&&we.push(Le||Fe()),ae=U[de],ae===void 0){Le=new o.pointGeometry(P.getx(de),P.gety(de));const Tt=ds(Le,H.canonical,D,X,G);ae=Tt.signedDistanceFromCamera>0?U[de]=Tt.point:it()}else Le=null;he+=xe,xe=o.distance(pe,ae)}Le=Le||new o.pointGeometry(P.getx(de),P.gety(de));const ze=Fe();W&&G&&(U[de]=ae=U[de]===void 0?ae:it(),xe=o.distance(pe,ae));const Qe=(Se-he)/xe,Oe=Le.sub(ze).mult(Qe)._add(ze),at=o.sub([],ae,pe),ot=o.scaleAndAdd([],pe,at,Qe);let wt=[0,0,1],Mt=at[0],Nt=at[1];if(Z&&(wt=X.upVector(H.canonical,Oe.x,Oe.y),wt[0]!==0||wt[1]!==0||wt[2]!==1)){const Tt=[1,0,0],qt=[0,1,0];Tt[0]=wt[2],Tt[1]=0,Tt[2]=-wt[0],o.cross(qt,wt,Tt),o.normalize(Tt,Tt),o.normalize(qt,qt),Mt=o.dot(at,Tt),Nt=o.dot(at,qt)}if(s){const Tt=o.cross([],wt,at);o.normalize(Tt,Tt),o.scaleAndAdd(ot,ot,Tt,s*Y)}const oi=fe+Math.atan2(Nt,Mt);return Ye.push(ot),K&&we.push(Oe),{point:ot,angle:oi,path:Ye,tilePath:we,up:wt}}const Ac=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function go(c,r){for(let s=0;s<c;s++){const h=r.length;r.resize(h+4),r.float32.set(Ac,4*h)}}function Vr(c,r,s){const h=r[0],m=r[1];return c[0]=s[0]*h+s[4]*m+s[12],c[1]=s[1]*h+s[5]*m+s[13],c[3]=s[3]*h+s[7]*m+s[15],c}const Mi=100;class Ic{constructor(r,s,h=new hs(r.width+200,r.height+200,25),m=new hs(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Mi,this.screenBottomBoundary=r.height+Mi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,h,m,y,w,E,A){let P=h.projectedAnchorX,D=h.projectedAnchorY,U=h.projectedAnchorZ;const G=h.elevation,K=h.tileID;if(G&&K){const de=r.getProjection().upVector(K.canonical,h.tileAnchorX,h.tileAnchorY),ae=r.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=de[0]*G*ae,D+=de[1]*G*ae,U+=de[2]*G*ae}const W=this.projectAndGetPerspectiveRatio(E,[P,D,U],h.tileID,r.projection.name==="globe"||!!G||this.transform.pitch>0,r.getProjection()),X=w*W.perspectiveRatio,H=(h.x1*s+m.x-h.padding)*X+W.point.x,Z=(h.y1*s+m.y-h.padding)*X+W.point.y,te=(h.x2*s+m.x+h.padding)*X+W.point.x,Y=(h.y2*s+m.y+h.padding)*X+W.point.y,fe=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(H,Z,te,Y)||!y&&this.grid.hitTest(H,Z,te,Y,A)||fe?{box:[],offscreen:!1,occluded:W.occluded}:{box:[H,Z,te,Y],offscreen:this.isOffscreen(H,Z,te,Y),occluded:!1}}placeCollisionCircles(r,s,h,m,y,w,E,A,P,D,U,G,K,W,X){const H=[],Z=this.transform.elevation,te=Z?Z.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,r.getProjection()):ze=>[0,0,0],Y=new o.pointGeometry(h.tileAnchorX,h.tileAnchorY),fe=r.getProjection().projectTilePoint(h.tileAnchorX,h.tileAnchorY,X.canonical),de=te(Y),ae=[fe.x+de[0],fe.y+de[1],fe.z+de[2]],pe=r.projection.name==="globe",he=this.projectAndGetPerspectiveRatio(E,[ae[0],ae[1],ae[2]],X,pe||!!Z||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:xe}=he,Se=(U?w/xe:w*xe)/o.ONE_EM,Ye=In(new o.pointGeometry(ae[0],ae[1]),A,ae[2]).point,we=he.signedDistanceFromCamera>0?on(Se,y,h.lineOffsetX*Se,h.lineOffsetY*Se,!1,Ye,Y,h,m,A,{},Z&&!U?te:null,U&&!!Z,r.getProjection(),X,U):null;let Le=!1,Fe=!1,it=!0;if(we&&!he.occluded){const ze=.5*K*xe+W,Qe=new o.pointGeometry(-100,-100),Oe=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),at=new Wp,ot=we.first,wt=we.last;let Mt=[];for(let Tt=ot.path.length-1;Tt>=1;Tt--)Mt.push(ot.path[Tt]);for(let Tt=1;Tt<wt.path.length;Tt++)Mt.push(wt.path[Tt]);const Nt=2.5*ze;if(P){const Tt=Mt.map(Z&&!pe?(qt,_i)=>{const qi=te(_i<ot.path.length-1?ot.tilePath[ot.path.length-1-_i]:wt.tilePath[_i-ot.path.length+2]);return qt[2]=qi[2],Xt(qt,P)}:qt=>Xt(qt,P));Mt=Tt.some(qt=>qt.signedDistanceFromCamera<=0)?[]:Tt.map(qt=>qt.point)}let oi=[];if(Mt.length>0){const Tt=Mt.map(zi=>new o.pointGeometry(zi[0],zi[1]));let qt=1/0,_i=-1/0,qi=1/0,nr=-1/0;for(let zi=0;zi<Tt.length;zi++)qt=Math.min(qt,Tt[zi].x),qi=Math.min(qi,Tt[zi].y),_i=Math.max(_i,Tt[zi].x),nr=Math.max(nr,Tt[zi].y);oi=qt>=Qe.x&&_i<=Oe.x&&qi>=Qe.y&&nr<=Oe.y?[Tt]:_i<Qe.x||qt>Oe.x||nr<Qe.y||qi>Oe.y?[]:o.clipLine([Tt],Qe.x,Qe.y,Oe.x,Oe.y)}for(const Tt of oi){at.reset(Tt,.25*ze);let qt=0;qt=at.length<=.5*ze?1:Math.ceil(at.paddedLength/Nt)+1;for(let _i=0;_i<qt;_i++){const qi=_i/Math.max(qt-1,1),nr=at.lerp(qi),zi=nr.x+Mi,Ar=nr.y+Mi;H.push(zi,Ar,ze,0);const zn=zi-ze,Qn=Ar-ze,Zi=zi+ze,Xi=Ar+ze;if(it=it&&this.isOffscreen(zn,Qn,Zi,Xi),Fe=Fe||this.isInsideGrid(zn,Qn,Zi,Xi),!s&&this.grid.hitTestCircle(zi,Ar,ze,G)&&(Le=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!D&&Le||!Fe?[]:H,offscreen:it,collisionDetected:Le,occluded:he.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,y=-1/0,w=-1/0;for(const D of r){const U=new o.pointGeometry(D.x+Mi,D.y+Mi);h=Math.min(h,U.x),m=Math.min(m,U.y),y=Math.max(y,U.x),w=Math.max(w,U.y),s.push(U)}const E=this.grid.query(h,m,y,w).concat(this.ignoredGrid.query(h,m,y,w)),A={},P={};for(const D of E){const U=D.key;if(A[U.bucketInstanceId]===void 0&&(A[U.bucketInstanceId]={}),A[U.bucketInstanceId][U.featureIndex])continue;const G=[new o.pointGeometry(D.x1,D.y1),new o.pointGeometry(D.x2,D.y1),new o.pointGeometry(D.x2,D.y2),new o.pointGeometry(D.x1,D.y2)];o.polygonIntersectsPolygon(s,G)&&(A[U.bucketInstanceId][U.featureIndex]=!0,P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]=[]),P[U.bucketInstanceId].push(U.featureIndex))}return P}insertCollisionBox(r,s,h,m,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,h,m,y){const w=s?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:m,collisionGroupID:y};for(let A=0;A<r.length;A+=4)w.insertCircle(E,r[A],r[A+1],r[A+2])}projectAndGetPerspectiveRatio(r,s,h,m,y){const w=[s[0],s[1],s[2],1];let E=!1;if(s[2]||this.transform.pitch>0){o.transformMat4$1(w,w,r);const A=y.name==="globe";this.fogState&&h&&!A&&(E=function(P,D,U,G,K,W){const X=W.calculateFogTileMatrix(K),H=[D,U,G];return o.transformMat4(H,H,X),Lt(P,H,W.pitch,W._fov)}(this.fogState,s[0],s[1],s[2],h.toUnwrapped(),this.transform)>.9)}else Vr(w,w,r);return{point:new o.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+Mi,(-w[1]/w[3]+1)/2*this.transform.height+Mi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:m&&w[2]>w[3]||E}}isOffscreen(r,s,h,m){return h<Mi||r>=this.screenRightBoundary||m<Mi||s>this.screenBottomBoundary}isInsideGrid(r,s,h,m){return h>=0&&r<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function aa(c,r,s){const h=r.createTileMatrix(c,c.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),c.projMatrix,h)}function Hr(c,r,s){if(r.projection.name===s.projection.name)return c.projMatrix;const h=s.clone();return h.setProjection(r.projection),aa(h,r.getProjection(),c)}function Kr(c,r,s){return r.name===s.projection.name?c.projMatrix:aa(s,r,c)}class Cc{constructor(r,s,h,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class yo{constructor(r,s,h,m,y,w=!1){this.text=new Cc(r?r.text:null,s,h,y),this.icon=new Cc(r?r.icon:null,s,m,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cr{constructor(r,s,h,m=!1){this.text=r,this.icon=s,this.skipFade=h,this.clipped=m}}class la{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Mc{constructor(r,s,h,m,y){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=y}}class ca{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[r]}}function xr(c,r,s,h,m){const{horizontalAlign:y,verticalAlign:w}=o.getAnchorAlignment(c),E=-(y-.5)*r,A=-(w-.5)*s,P=o.evaluateVariableOffset(c,h);return new o.pointGeometry(E+P[0]*m,A+P[1]*m)}function ua(c,r,s,h,m){const y=new o.pointGeometry(c,r);return s&&y._rotate(h?m:-m),y}class zc{constructor(r,s,h,m,y){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Ic(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new ca(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,h,m){const y=h.getBucket(s),w=h.latestFeatureIndex;if(!y||!w||s.id!==y.layerIds[0])return;const E=y.layers[0].layout,A=h.collisionBoxArray,P=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),D=h.tileSize/o.EXTENT,U=h.tileID.toUnwrapped();this.transform.setProjection(y.projection);const G=(K=h.tileID,W=y.getProjection(),X=this.transform,W.name===this.projection?X.calculateProjMatrix(K.toUnwrapped()):aa(X,W,K));var K,W,X;const H=E.get("text-pitch-alignment")==="map",Z=E.get("text-rotation-alignment")==="map";s.compileFilter();const te=s.dynamicFilter(),Y=s.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(h),de=ii(G,h.tileID.canonical,H,Z,this.transform,y.getProjection(),fe);let ae=null;if(H){const xe=An(G,h.tileID.canonical,H,Z,this.transform,y.getProjection(),fe);ae=o.multiply([],this.transform.labelPlaneMatrix,xe)}let pe=null;te&&h.latestFeatureIndex&&(pe={unwrappedTileID:U,dynamicFilter:te,dynamicFilterNeedsFeature:Y,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Mc(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,h.tileID);const he={bucket:y,layout:E,posMatrix:G,textLabelPlaneMatrix:de,labelToScreenMatrix:ae,clippingData:pe,scale:P,textPixelRatio:D,holdingForFade:h.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const xe of y.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:Ye,symbolInstanceEnd:we}=xe;r.push({sortKey:Se,symbolInstanceStart:Ye,symbolInstanceEnd:we,parameters:he})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:he})}attemptAnchorPlacement(r,s,h,m,y,w,E,A,P,D,U,G,K,W,X,H,Z,te){const Y=[G.textOffset0,G.textOffset1],fe=xr(r,h,m,Y,y),de=this.collisionIndex.placeCollisionBox(W,y,s,ua(fe.x,fe.y,w,E,this.transform.angle),U,A,P,D.predicate);if((!H||this.collisionIndex.placeCollisionBox(W,W.getSymbolInstanceIconSize(te,this.transform.zoom,K),H,ua(fe.x,fe.y,w,E,this.transform.angle),U,A,P,D.predicate).box.length!==0)&&de.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:Y,width:h,height:m,anchor:r,textScale:y,prevAnchor:ae},this.markUsedJustification(W,r,G,X),W.allowVerticalPlacement&&(this.markUsedOrientation(W,X,G),this.placedOrientations[G.crossTileID]=X),{shift:fe,placedGlyphBoxes:de}}}placeLayerBucketPart(r,s,h,m){const{bucket:y,layout:w,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:P,clippingData:D,textPixelRatio:U,holdingForFade:G,collisionBoxArray:K,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:X,collisionGroup:H}=r.parameters,Z=w.get("text-optional"),te=w.get("icon-optional"),Y=w.get("text-allow-overlap"),fe=w.get("icon-allow-overlap"),de=w.get("text-rotation-alignment")==="map",ae=w.get("text-pitch-alignment")==="map",pe=w.get("icon-text-fit")!=="none",he=w.get("symbol-z-order")==="viewport-y";this.transform.setProjection(y.projection);let xe=Y&&(fe||!y.hasIconData()||te),Se=fe&&(Y||!y.hasTextData()||Z);!y.collisionArrays&&K&&y.deserializeCollisionBoxes(K),h&&m&&y.updateCollisionDebugBuffers(this.transform.zoom,K);const Ye=(we,Le,Fe)=>{if(D){const Zi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Xi=null;if(D.dynamicFilterNeedsFeature){const Qt=this.retainedQueryData[y.bucketInstanceId];Xi=D.featureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:Qt.bucketIndex,sourceLayerIndex:Qt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(Zi,Xi,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.pointGeometry(we.tileAnchorX,we.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[we.crossTileID]=new cr(!1,!1,!1,!0),void(s[we.crossTileID]=!0)}if(s[we.crossTileID])return;if(G)return void(this.placements[we.crossTileID]=new cr(!1,!1,!1));let it=!1,ze=!1,Qe=!0,Oe=!1,at=!1,ot=null,wt={box:null,offscreen:null,occluded:null},Mt={box:null,offscreen:null,occluded:null},Nt=null,oi=null,Tt=null,qt=0,_i=0,qi=0;Fe.textFeatureIndex?qt=Fe.textFeatureIndex:we.useRuntimeCollisionCircles&&(qt=we.featureIndex),Fe.verticalTextFeatureIndex&&(_i=Fe.verticalTextFeatureIndex);const nr=Zi=>{Zi.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||Zi.elevation)&&(Zi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,Zi.tileAnchorX,Zi.tileAnchorY):0)},zi=Fe.textBox;if(zi){nr(zi);const Zi=Qt=>{let dr=o.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Qt&&this.prevPlacement){const Lr=this.prevPlacement.placedOrientations[we.crossTileID];Lr&&(this.placedOrientations[we.crossTileID]=Lr,dr=Lr,this.markUsedOrientation(y,dr,we))}return dr},Xi=(Qt,dr)=>{if(y.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const Lr of y.writingModes)if(Lr===o.WritingMode.vertical?(wt=dr(),Mt=wt):wt=Qt(),wt&&wt.box&&wt.box.length)break}else wt=Qt()};if(w.get("text-variable-anchor")){let Qt=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]){const Ui=this.prevPlacement.variableOffsets[we.crossTileID];Qt.indexOf(Ui.anchor)>0&&(Qt=Qt.filter(Rr=>Rr!==Ui.anchor),Qt.unshift(Ui.anchor))}const dr=(Ui,Rr,Go)=>{const $r=y.getSymbolInstanceTextSize(W,we,this.transform.zoom,Le),qo=(Ui.x2-Ui.x1)*$r+2*Ui.padding,Zo=(Ui.y2-Ui.y1)*$r+2*Ui.padding,Wo=pe&&!fe?Rr:null;Wo&&nr(Wo);let Gr={box:[],offscreen:!1,occluded:!1};const Xo=Y?2*Qt.length:Qt.length;for(let To=0;To<Xo;++To){const Da=this.attemptAnchorPlacement(Qt[To%Qt.length],Ui,qo,Zo,$r,de,ae,U,E,H,To>=Qt.length,we,Le,y,Go,Wo,W,X);if(Da&&(Gr=Da.placedGlyphBoxes,Gr&&Gr.box&&Gr.box.length)){it=!0,ot=Da.shift;break}}return Gr};Xi(()=>dr(zi,Fe.iconBox,o.WritingMode.horizontal),()=>{const Ui=Fe.verticalTextBox;return Ui&&nr(Ui),y.allowVerticalPlacement&&!(wt&&wt.box&&wt.box.length)&&we.numVerticalGlyphVertices>0&&Ui?dr(Ui,Fe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),wt&&(it=wt.box,Qe=wt.offscreen,Oe=wt.occluded);const Lr=Zi(wt&&wt.box);if(!it&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[we.crossTileID];Ui&&(this.variableOffsets[we.crossTileID]=Ui,this.markUsedJustification(y,Ui.anchor,we,Lr))}}else{const Qt=(dr,Lr)=>{const Ui=y.getSymbolInstanceTextSize(W,we,this.transform.zoom,Le),Rr=this.collisionIndex.placeCollisionBox(y,Ui,dr,new o.pointGeometry(0,0),Y,U,E,H.predicate);return Rr&&Rr.box&&Rr.box.length&&(this.markUsedOrientation(y,Lr,we),this.placedOrientations[we.crossTileID]=Lr),Rr};Xi(()=>Qt(zi,o.WritingMode.horizontal),()=>{const dr=Fe.verticalTextBox;return y.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&dr?(nr(dr),Qt(dr,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Zi(wt&&wt.box&&wt.box.length)}}if(Nt=wt,it=Nt&&Nt.box&&Nt.box.length>0,Qe=Nt&&Nt.offscreen,Oe=Nt&&Nt.occluded,we.useRuntimeCollisionCircles){const Zi=y.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),Xi=o.evaluateSizeForFeature(y.textSizeData,W,Zi),Qt=w.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(y,Y,Zi,y.lineVertexArray,y.glyphOffsetArray,Xi,E,A,P,h,ae,H.predicate,we.collisionCircleDiameter*Xi/o.ONE_EM,Qt,this.retainedQueryData[y.bucketInstanceId].tileID),it=Y||oi.circles.length>0&&!oi.collisionDetected,Qe=Qe&&oi.offscreen,Oe=oi.occluded}if(Fe.iconFeatureIndex&&(qi=Fe.iconFeatureIndex),Fe.iconBox){const Zi=Xi=>{nr(Xi);const Qt=pe&&ot?ua(ot.x,ot.y,de,ae,this.transform.angle):new o.pointGeometry(0,0),dr=y.getSymbolInstanceIconSize(X,this.transform.zoom,Le);return this.collisionIndex.placeCollisionBox(y,dr,Xi,Qt,fe,U,E,H.predicate)};Mt&&Mt.box&&Mt.box.length&&Fe.verticalIconBox?(Tt=Zi(Fe.verticalIconBox),ze=Tt.box.length>0):(Tt=Zi(Fe.iconBox),ze=Tt.box.length>0),Qe=Qe&&Tt.offscreen,at=Tt.occluded}const Ar=Z||we.numHorizontalGlyphVertices===0&&we.numVerticalGlyphVertices===0,zn=te||we.numIconVertices===0;if(Ar||zn?zn?Ar||(ze=ze&&it):it=ze&&it:ze=it=ze&&it,it&&Nt&&Nt.box&&this.collisionIndex.insertCollisionBox(Nt.box,w.get("text-ignore-placement"),y.bucketInstanceId,Mt&&Mt.box&&_i?_i:qt,H.ID),ze&&Tt&&this.collisionIndex.insertCollisionBox(Tt.box,w.get("icon-ignore-placement"),y.bucketInstanceId,qi,H.ID),oi&&(it&&this.collisionIndex.insertCollisionCircles(oi.circles,w.get("text-ignore-placement"),y.bucketInstanceId,qt,H.ID),h)){const Zi=y.bucketInstanceId;let Xi=this.collisionCircleArrays[Zi];Xi===void 0&&(Xi=this.collisionCircleArrays[Zi]=new la);for(let Qt=0;Qt<oi.circles.length;Qt+=4)Xi.circles.push(oi.circles[Qt+0]),Xi.circles.push(oi.circles[Qt+1]),Xi.circles.push(oi.circles[Qt+2]),Xi.circles.push(oi.collisionDetected?1:0)}const Qn=y.projection.name!=="globe";xe=xe&&(Qn||!Oe),Se=Se&&(Qn||!at),this.placements[we.crossTileID]=new cr(it||xe,ze||Se,Qe||y.justReloaded),s[we.crossTileID]=!0};if(he){const we=y.getSortedSymbolIndexes(this.transform.angle);for(let Le=we.length-1;Le>=0;--Le){const Fe=we[Le];Ye(y.symbolInstances.get(Fe),Fe,y.collisionArrays[Fe])}}else for(let we=r.symbolInstanceStart;we<r.symbolInstanceEnd;we++)Ye(y.symbolInstances.get(we),we,y.collisionArrays[we]);if(h&&y.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[y.bucketInstanceId];o.invert(we.invProjMatrix,E),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(r,s,h,m){let y;y=m===o.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const w=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:h.crossTileID)}markUsedOrientation(r,s,h){const m=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,y=s===o.WritingMode.vertical?s:0,w=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const E of w)r.text.placedSymbolArray.get(E).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(r):1,y=s?s.opacities:{},w=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const A in this.placements){const P=this.placements[A],D=y[A];D?(this.opacities[A]=new yo(D,m,P.text,P.icon,null,P.clipped),h=h||P.text!==D.text.placed||P.icon!==D.icon.placed):(this.opacities[A]=new yo(null,m,P.text,P.icon,P.skipFade,P.clipped),h=h||P.text||P.icon)}for(const A in y){const P=y[A];if(!this.opacities[A]){const D=new yo(P,m,!1,!1);D.isHidden()||(this.opacities[A]=D,h=h||P.text.placed||P.icon.placed)}}for(const A in w)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=w[A]);for(const A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);h?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s){const h={};for(const m of s){const y=m.getBucket(r);y&&m.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,h,m.collisionBoxArray)}}updateBucketOpacities(r,s,h){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0].layout,y=!!r.layers[0].dynamicFilter(),w=new yo(null,0,!1,!1,!0),E=m.get("text-allow-overlap"),A=m.get("icon-allow-overlap"),P=m.get("text-variable-anchor"),D=m.get("text-rotation-alignment")==="map",U=m.get("text-pitch-alignment")==="map",G=m.get("icon-text-fit")!=="none",K=new yo(null,0,E&&(A||!r.hasIconData()||m.get("icon-optional")),A&&(E||!r.hasTextData()||m.get("text-optional")),!0);!r.collisionArrays&&h&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(h);const W=(H,Z,te)=>{for(let Y=0;Y<Z/4;Y++)H.opacityVertexArray.emplaceBack(te)};let X=0;for(let H=0;H<r.symbolInstances.length;H++){const Z=r.symbolInstances.get(H),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:Y,crossTileID:fe}=Z;let de=this.opacities[fe];s[fe]?de=w:de||(de=K,this.opacities[fe]=de),s[fe]=!0;const ae=te>0||Y>0,pe=Z.numIconVertices>0,he=this.placedOrientations[Z.crossTileID],xe=he===o.WritingMode.vertical,Se=he===o.WritingMode.horizontal||he===o.WritingMode.horizontalOnly;if(!ae&&!pe||de.isHidden()||X++,ae){const Ye=jo(de.text);W(r.text,te,xe?Cn:Ye),W(r.text,Y,Se?Cn:Ye);const we=de.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(r.text.placedSymbolArray.get(it).hidden=we||xe?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=we||Se?1:0);const Le=this.variableOffsets[Z.crossTileID];Le&&this.markUsedJustification(r,Le.anchor,Z,he);const Fe=this.placedOrientations[Z.crossTileID];Fe&&(this.markUsedJustification(r,"left",Z,Fe),this.markUsedOrientation(r,Fe,Z))}if(pe){const Ye=jo(de.icon);Z.placedIconSymbolIndex>=0&&(W(r.icon,Z.numIconVertices,xe?Cn:Ye),r.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=de.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(W(r.icon,Z.numVerticalIconVertices,Se?Cn:Ye),r.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ye=r.collisionArrays[H];if(Ye){let we=new o.pointGeometry(0,0),Le=!0;if(Ye.textBox||Ye.verticalTextBox){if(P){const it=this.variableOffsets[fe];it?(we=xr(it.anchor,it.width,it.height,it.textOffset,it.textScale),D&&we._rotate(U?this.transform.angle:-this.transform.angle)):Le=!1}y&&(Le=!de.clipped),Ye.textBox&&dn(r.textCollisionBox.collisionVertexArray,de.text.placed,!Le||xe,we.x,we.y),Ye.verticalTextBox&&dn(r.textCollisionBox.collisionVertexArray,de.text.placed,!Le||Se,we.x,we.y)}const Fe=Le&&Boolean(!Se&&Ye.verticalIconBox);Ye.iconBox&&dn(r.iconCollisionBox.collisionVertexArray,de.icon.placed,Fe,G?we.x:0,G?we.y:0),Ye.verticalIconBox&&dn(r.iconCollisionBox.collisionVertexArray,de.icon.placed,!Fe,G?we.x:0,G?we.y:0)}}}if(r.fullyClipped=X===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=H.invProjMatrix,r.placementViewportMatrix=H.viewportMatrix,r.collisionCircleArray=H.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>r}setStale(){this.stale=!0}}function dn(c,r,s,h,m){c.emplaceBack(r?1:0,s?1:0,h||0,m||0),c.emplaceBack(r?1:0,s?1:0,h||0,m||0),c.emplaceBack(r?1:0,s?1:0,h||0,m||0),c.emplaceBack(r?1:0,s?1:0,h||0,m||0)}const ha=Math.pow(2,25),ll=Math.pow(2,24),Xp=Math.pow(2,17),Pc=Math.pow(2,16),ps=Math.pow(2,9),Hp=Math.pow(2,8),Mh=Math.pow(2,1);function jo(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const r=c.placed?1:0,s=Math.floor(127*c.opacity);return s*ha+r*ll+s*Xp+r*Pc+s*ps+r*Hp+s*Mh+r}const Cn=0;class cl{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,s,h,m,y){const w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(w,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<w.length;){const E=w[this._currentPartIndex];if(s.placeLayerBucketPart(E,this._seenCrossTileIDs,h,E.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class xo{constructor(r,s,h,m,y,w,E,A){this.placement=new zc(r,y,w,E,A),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(r,s,h){const m=o.exported.now(),y=()=>{const w=o.exported.now()-m;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=s[r[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new cl(w)),this._inProgressLayer.continuePlacement(h[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const kc=512/o.EXTENT/2;class ul{constructor(r,s,h){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<s.length;m++){const y=s.get(m),w=y.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,r)})}}getScaledCoordinates(r,s){const h=kc/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+r.tileAnchorX)*h),y:Math.floor((s.canonical.y*o.EXTENT+r.tileAnchorY)*h)}}findMatches(r,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<r.length;y++){const w=r.get(y);if(w.crossTileID)continue;const E=this.indexedSymbolInstances[w.key];if(!E)continue;const A=this.getScaledCoordinates(w,s);for(const P of E)if(Math.abs(P.coord.x-A.x)<=m&&Math.abs(P.coord.y-A.y)<=m&&!h[P.crossTileID]){h[P.crossTileID]=!0,w.crossTileID=P.crossTileID;break}}}}class Kp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],y={};for(const w in m){const E=m[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),y[E.tileID.key]=E}this.indexes[h]=y}this.lng=r}addBucket(r,s,h){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>r.overscaledZ)for(const E in w){const A=w[E];A.tileID.isChildOf(r)&&A.findMatches(s.symbolInstances,r,m)}else{const E=w[r.scaledTo(Number(y)).key];E&&E.findMatches(s.symbolInstances,r,m)}}for(let y=0;y<s.symbolInstances.length;y++){const w=s.symbolInstances.get(y);w.crossTileID||(w.crossTileID=h.generate(),m[w.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new ul(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const h in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[r][m.crossTileID]}removeStaleBuckets(r){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const y in m)r[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[y]),delete m[y],s=!0)}return s}}class hl{constructor(){this.layerIndexes={},this.crossTileIDs=new Kp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,h,m){let y=this.layerIndexes[r.id];y===void 0&&(y=this.layerIndexes[r.id]=new Yp);let w=!1;const E={};m.name!=="globe"&&y.handleWrapJump(h);for(const A of s){const P=A.getBucket(r);P&&r.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,P,this.crossTileIDs)&&(w=!0),E[P.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(r){const s={};r.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const dl=(c,r)=>o.emitValidationErrors(c,r&&r.filter(s=>s.identifier!=="source.canvas")),zh=o.pick(kt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Jp=o.pick(kt,["setCenter","setZoom","setBearing","setPitch"]),Ph={version:8,layers:[],sources:{}},Qp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class pn extends o.Evented{constructor(r,s={}){super(),this.map=r,this.dispatcher=new Fi(Ii(),this),this.imageManager=new Ft,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new hl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const h=this;this._rtlTextPluginCallback=pn.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,w)=>{if(o.triggerPluginCompletionEvent(y),w&&w.every(E=>E))for(const E in h._sourceCaches){const A=h._sourceCaches[E],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getSource(m.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===y.id&&this._validateLayer(E)}})}loadURL(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,s.accessToken);const m=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(m,(y,w)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):w&&this._load(w,h)})}loadJSON(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Ph,!1)}_updateLayerCount(r,s){const h=s?1:-1;r.is3D()&&(this._num3DLayers+=h),r.type==="circle"&&(this._numCircleLayers+=h),r.type==="symbol"&&(this._numSymbolLayers+=h)}_load(r,s){if(s&&dl(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const m in r.sources)this.addSource(m,r.sources[m],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const h=Ci(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ri(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(s,h,m){let y,w,E;const A=o.exported.devicePixelRatio>1?"@2x":"";let P=o.getJSON(h.transformRequest(h.normalizeSpriteURL(s,A,".json"),o.ResourceType.SpriteJSON),(G,K)=>{P=null,E||(E=G,y=K,U())}),D=o.getImage(h.transformRequest(h.normalizeSpriteURL(s,A,".png"),o.ResourceType.SpriteImage),(G,K)=>{D=null,E||(E=G,w=K,U())});function U(){if(E)m(E);else if(y&&w){const G=o.exported.getImageData(w),K={};for(const W in y){const{width:X,height:H,x:Z,y:te,sdf:Y,pixelRatio:fe,stretchX:de,stretchY:ae,content:pe}=y[W],he=new o.RGBAImage({width:X,height:H});o.RGBAImage.copy(G,he,{x:Z,y:te},{x:0,y:0},{width:X,height:H}),K[W]={data:he,pixelRatio:fe,sdf:Y,stretchX:de,stretchY:ae,content:pe}}m(null,K)}}return{cancel(){P&&(P.cancel(),P=null),D&&(D.cancel(),D=null)}}}(r,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const s=this.getSource(r.source);if(!s)return;const h=r.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const s=[];for(const h of r){const m=this._layers[h];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Qp[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const w in this._updatedSources){const E=this._updatedSources[w];E==="reload"?this._reloadSource(w):E==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const y=this._sourceCaches[m];h[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];if(y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)){const E=this._getLayerSourceCache(y);E&&(E.used=!0)}const w=this.map.painter;if(w){const E=y.getProgramIds();if(!E)continue;const A=y.getProgramConfiguration(r.zoom);for(const P of E)w.useProgram(P,A)}}for(const m in h){const y=this._sourceCaches[m];h[m]!==y.used&&y.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),dl(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Ci(r.layers);const s=function(m,y){if(!m)return[{command:kt.setStyle,args:[y]}];let w=[];try{if(!k(m.version,y.version))return[{command:kt.setStyle,args:[y]}];k(m.center,y.center)||w.push({command:kt.setCenter,args:[y.center]}),k(m.zoom,y.zoom)||w.push({command:kt.setZoom,args:[y.zoom]}),k(m.bearing,y.bearing)||w.push({command:kt.setBearing,args:[y.bearing]}),k(m.pitch,y.pitch)||w.push({command:kt.setPitch,args:[y.pitch]}),k(m.sprite,y.sprite)||w.push({command:kt.setSprite,args:[y.sprite]}),k(m.glyphs,y.glyphs)||w.push({command:kt.setGlyphs,args:[y.glyphs]}),k(m.transition,y.transition)||w.push({command:kt.setTransition,args:[y.transition]}),k(m.light,y.light)||w.push({command:kt.setLight,args:[y.light]}),k(m.fog,y.fog)||w.push({command:kt.setFog,args:[y.fog]}),k(m.projection,y.projection)||w.push({command:kt.setProjection,args:[y.projection]});const E={},A=[];(function(U,G,K,W){let X;for(X in G=G||{},U=U||{})U.hasOwnProperty(X)&&(G.hasOwnProperty(X)||nn(X,K,W));for(X in G)G.hasOwnProperty(X)&&(U.hasOwnProperty(X)?k(U[X],G[X])||(U[X].type==="geojson"&&G[X].type==="geojson"&&mo(U,G,X)?K.push({command:kt.setGeoJSONSourceData,args:[X,G[X].data]}):rr(X,G,K,W)):ke(X,G,K))})(m.sources,y.sources,A,E);const P=[];m.layers&&m.layers.forEach(U=>{U.source&&E[U.source]?w.push({command:kt.removeLayer,args:[U.id]}):P.push(U)});let D=m.terrain;D&&E[D.source]&&(w.push({command:kt.setTerrain,args:[void 0]}),D=void 0),w=w.concat(A),k(D,y.terrain)||w.push({command:kt.setTerrain,args:[y.terrain]}),function(U,G,K){G=G||[];const W=(U=U||[]).map(Sn),X=G.map(Sn),H=U.reduce(sl,{}),Z=G.reduce(sl,{}),te=W.slice(),Y=Object.create(null);let fe,de,ae,pe,he,xe,Se;for(fe=0,de=0;fe<W.length;fe++)ae=W[fe],Z.hasOwnProperty(ae)?de++:(K.push({command:kt.removeLayer,args:[ae]}),te.splice(te.indexOf(ae,de),1));for(fe=0,de=0;fe<X.length;fe++)ae=X[X.length-1-fe],te[te.length-1-fe]!==ae&&(H.hasOwnProperty(ae)?(K.push({command:kt.removeLayer,args:[ae]}),te.splice(te.lastIndexOf(ae,te.length-de),1)):de++,xe=te[te.length-fe],K.push({command:kt.addLayer,args:[Z[ae],xe]}),te.splice(te.length-fe,0,ae),Y[ae]=!0);for(fe=0;fe<X.length;fe++)if(ae=X[fe],pe=H[ae],he=Z[ae],!Y[ae]&&!k(pe,he))if(k(pe.source,he.source)&&k(pe["source-layer"],he["source-layer"])&&k(pe.type,he.type)){for(Se in ol(pe.layout,he.layout,K,ae,null,kt.setLayoutProperty),ol(pe.paint,he.paint,K,ae,null,kt.setPaintProperty),k(pe.filter,he.filter)||K.push({command:kt.setFilter,args:[ae,he.filter]}),k(pe.minzoom,he.minzoom)&&k(pe.maxzoom,he.maxzoom)||K.push({command:kt.setLayerZoomRange,args:[ae,he.minzoom,he.maxzoom]}),pe)pe.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?ol(pe[Se],he[Se],K,ae,Se.slice(6),kt.setPaintProperty):k(pe[Se],he[Se])||K.push({command:kt.setLayerProperty,args:[ae,Se,he[Se]]}));for(Se in he)he.hasOwnProperty(Se)&&!pe.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?ol(pe[Se],he[Se],K,ae,Se.slice(6),kt.setPaintProperty):k(pe[Se],he[Se])||K.push({command:kt.setLayerProperty,args:[ae,Se,he[Se]]}))}else K.push({command:kt.removeLayer,args:[ae]}),xe=te[te.lastIndexOf(ae)+1],K.push({command:kt.addLayer,args:[he,xe]})}(P,y.layers,w)}catch(E){console.warn("Unable to compute style diff:",E),w=[{command:kt.setStyle,args:[y]}]}return w}(this.serialize(),r).filter(m=>!(m.command in Jp));if(s.length===0)return!1;const h=s.filter(m=>!(m.command in zh));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&m.command!=="setProjection"&&this[m.command].apply(this,m.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,s){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,s),this._afterImageUpdated(r),this)}updateImage(r,s){this.imageManager.updateImage(r,s)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,s,h={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${r}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Ee(r,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:m.serialize(),sourceId:r}));const y=w=>{const E=(w?"symbol:":"other:")+r,A=this._sourceCaches[E]=new o.SourceCache(E,m,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[r]=A,A.style=this,A.onAdd(this.map)};y(!1),s.type!=="vector"&&s.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const s=this.getSource(r);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(r);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getSource(r).setData(s),this._changed=!0}getSource(r){const s=this._getSourceCache(r);return s&&s.getSource()}addLayer(r,s,h={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(r.type==="custom"){if(dl(this,o.validateCustomStyleLayer(r)))return;y=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(m,r.source),r=o.clone$1(r),r=o.extend(r,{source:m})),this._validate(o.validateLayer,`layers.${m}`,r,{arrayIndex:-1},h))return;y=o.createStyleLayer(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const w=s?this._order.indexOf(s):this._order.length;if(s&&w===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const E=this._getLayerSourceCache(y);if(this._removedLayers[m]&&y.source&&E&&y.type!=="custom"){const A=this._removedLayers[m];delete this._removedLayers[m],A.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,s){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===s)return;const h=this._order.indexOf(r);this._order.splice(h,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const s=this._layers[r];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(r);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=s,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,h){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,s,h={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!k(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateFilter,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=o.clone$1(s),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const s=this.getLayer(r);return s&&o.clone$1(s.filter)}setLayoutProperty(r,s,h,m={}){this._checkLoaded();const y=this.getLayer(r);y?k(y.getLayoutProperty(s),h)||(y.setLayoutProperty(s,h,m),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,s){const h=this.getLayer(r);if(h)return h.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,s,h,m={}){this._checkLoaded();const y=this.getLayer(r);y?k(y.getPaintProperty(s),h)||(y.setPaintProperty(s,h,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,s){const h=this.getLayer(r);return h&&h.getPaintProperty(s)}setFeatureState(r,s){this._checkLoaded();const h=r.source,m=r.sourceLayer,y=this.getSource(h);if(!y)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const w=y.type;if(w==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(h);for(const A of E)A.setFeatureState(m,r.id,s)}removeFeatureState(r,s){this._checkLoaded();const h=r.source,m=this.getSource(h);if(!m)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const y=m.type,w=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(h);for(const A of E)A.removeFeatureState(w,r.id,s)}getFeatureState(r){this._checkLoaded();const s=r.source,h=r.sourceLayer,m=this.getSource(s);if(m){if(m.type!=="vector"||h)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();r[h.id]||(r[h.id]=h.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const s=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",s.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=w=>this._layers[w].type==="fill-extrusion",h={},m=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(s(E)){h[E]=w;for(const A of r){const P=A[E];if(P)for(const D of P)m.push(D)}}}m.sort((w,E)=>E.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(s(E))for(let A=m.length-1;A>=0;A--){const P=m[A].feature;if(h[P.layer.id]<w)break;y.push(P),m.pop()}else for(const A of r){const P=A[E];if(P)for(const D of P)y.push(D.feature)}}return y}queryRenderedFeatures(r,s,h){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of s.layers){const P=this._layers[A];if(!P)return this.fire(new o.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];m[P.source]=!0}}const y=[];s.availableImages=this._availableImages;const w=s&&s.layers?s.layers.some(A=>{const P=this.getLayer(A);return P&&P.is3D()}):this.has3DLayers(),E=$e.createFromScreenPoints(r,h);for(const A in this._sourceCaches){const P=this._sourceCaches[A].getSource().id;s.layers&&!m[P]||y.push(ht(this._sourceCaches[A],this._layers,this._serializedLayers,E,s,h,w,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(A,P,D,U,G,K,W){const X={},H=K.queryRenderedSymbols(U),Z=[];for(const te of Object.keys(H).map(Number))Z.push(W[te]);Z.sort(Rt);for(const te of Z){const Y=te.featureIndex.lookupSymbolFeatures(H[te.bucketInstanceId],P,te.bucketIndex,te.sourceLayerIndex,G.filter,G.layers,G.availableImages,A);for(const fe in Y){const de=X[fe]=X[fe]||[],ae=Y[fe];ae.sort((pe,he)=>{const xe=te.featureSortOrder;if(xe){const Se=xe.indexOf(pe.featureIndex);return xe.indexOf(he.featureIndex)-Se}return he.featureIndex-pe.featureIndex});for(const pe of ae)de.push(pe)}}for(const te in X)X[te].forEach(Y=>{const fe=Y.feature,de=D(A[te]).getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=de});return X}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(r);let m=[];for(const y of h)m=m.concat(Ze(y,s));return m}addSourceType(r,s,h){return pn.getSourceType(r)?h(new Error(`A source type called "${r}" already exists.`)):(pn.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(r,s={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const w in r)if(!k(r[w],h[w])){m=!0;break}if(!m)return;const y=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,s),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,s=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof r.source=="object"){const h="terrain-dem-src";this.addSource(h,r.source),r=o.clone$1(r),r=o.extend(r,{source:h})}if(this._validate(o.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(r,s);else{const h=this.terrain,m=h.get();for(const y of Object.keys(o.spec.terrain))!r.hasOwnProperty(y)&&o.spec.terrain[y].default&&(r[y]=o.spec.terrain[y].default);for(const y in r)if(!k(r[y],m[y])){h.set(r),this.stylesheet.terrain=r;const w=this._setTransitionParameters({duration:0});h.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new bi(r,this.map.transform);this.stylesheet.fog=r;const h=this._setTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();Object.keys(r).length===0&&s.set(r);for(const m in r)if(!k(r[m],h[m])){s.set(r),this.stylesheet.fog=r;const y=this._setTransitionParameters({duration:0});s.updateTransitions(y);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const h=this.terrain=new fi(r,s);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m=this._setTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,h,m,y={}){return(!y||y.validate!==!1)&&dl(this,r.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:h,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const s=this._getSourceCaches(r);for(const h of s)h.clearTiles()}_reloadSource(r){const s=this._getSourceCaches(r);for(const h of s)h.resume(),h.reload()}_updateSources(r){for(const s in this._sourceCaches)this._sourceCaches[s].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,h,m,y=!1){let w=!1,E=!1;const A={};for(const P of this._order){const D=this._layers[P];if(D.type!=="symbol")continue;if(!A[D.source]){const G=this._getLayerSourceCache(D);if(!G)continue;A[D.source]=G.getRenderableIds(!0).map(K=>G.getTileByID(K)).sort((K,W)=>W.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(W.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(D,A[D.source],r.center.lng,r.projection);w=w||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new xo(r,this._order,y,s,h,m,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const P of this._order){const D=this._layers[P];D.type==="symbol"&&this.placement.updateLayerOpacities(D,A[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const m=y=>{y&&y.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(r,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(r,s,h){return o.makeRequest(s,h)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this._getSourceCaches(r);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}pn.getSourceType=function(c){return ye[c]},pn.setSourceType=function(c,r){ye[c]=r},pn.registerForPluginStateChange=o.registerForPluginStateChange;var Dc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Lc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Rc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Bc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let pl={},No={};const vo=[];Vo(Dc,vo),Vo(Rc,vo),Vo(Bc,vo),Vo(fs,vo),pl=xi("",Rc),No=xi(fs,Bc);const da=xi(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),fl=Dc,ml=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var _l={background:xi(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:xi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:xi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:xi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:xi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:xi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:xi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:xi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:xi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:xi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:xi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:xi(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:xi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:xi(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:xi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:xi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:xi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:xi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:xi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:xi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:xi(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:xi(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lc),skyboxGradient:xi(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lc),skyboxCapture:xi(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:xi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:xi(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Vo(c,r){const s=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const y of m)r.includes(y)||r.push(y)}}function xi(c,r){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),m={},y=[...vo];return Vo(c,y),Vo(r,y),{fragmentSource:c=c.replace(s,(w,E,A,P,D)=>(m[D]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${A} ${P} ${D};
#else
uniform ${A} ${P} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${A} ${P} ${D} = u_${D};
#endif
`)),vertexSource:r=r.replace(s,(w,E,A,P,D)=>{const U=P==="float"?"vec2":"vec4",G=D.match(/color/)?"color":U;return m[D]?E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${A} ${U} a_${D};
varying ${A} ${P} ${D};
#else
uniform ${A} ${P} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${A} ${P} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${A} ${P} ${D} = u_${D};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${A} ${U} a_${D};
#else
uniform ${A} ${P} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${P} ${D} = a_${D};
#else
    ${A} ${P} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${P} ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${A} ${P} ${D} = u_${D};
#endif
`}),staticAttributes:h,usedDefines:y}}class gl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,h,m,y,w,E){this.context=r;let A=this.boundPaintVertexBuffers.length!==m.length;for(let D=0;!A&&D<m.length;D++)this.boundPaintVertexBuffers[D]!==m[D]&&(A=!0);let P=this.boundDynamicVertexBuffers.length!==E.length;for(let D=0;!P&&D<E.length;D++)this.boundDynamicVertexBuffers[D]!==E[D]&&(P=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||A||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==w)this.freshBind(s,h,m,y,w,E);else{r.bindVertexArrayOES.set(this.vao);for(const D of E)D&&D.bind();y&&y.dynamicDraw&&y.bind()}}freshBind(r,s,h,m,y,w){let E;const A=r.numAttributes,P=this.context,D=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=w;else{E=P.currentNumAttributes||0;for(let U=A;U<E;U++)D.disableVertexAttribArray(U)}s.enableAttributes(D,r),s.bind(),s.setVertexAttribPointers(D,r,y);for(const U of h)U.enableAttributes(D,r),U.bind(),U.setVertexAttribPointers(D,r,y);for(const U of w)U&&(U.enableAttributes(D,r),U.bind(),U.setVertexAttribPointers(D,r,y));m&&m.bind(),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Oc(c,r){const s=Math.pow(2,r.canonical.z),h=r.canonical.y;return[new o.MercatorCoordinate(0,h/s).toLngLat().lat,new o.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function Fc(c,r,s,h,m,y,w){const E=c.context,A=E.gl,P=s.fbo;if(!P)return;c.prepareDrawTile();const D=c.useProgram("hillshade");E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());const U=((X,H,Z,te)=>{const Y=Z.paint.get("hillshade-shadow-color"),fe=Z.paint.get("hillshade-highlight-color"),de=Z.paint.get("hillshade-accent-color");let ae=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=X.transform.angle);const pe=!X.options.moving;return{u_matrix:te||X.transform.calculateProjMatrix(H.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Oc(0,H.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ae],u_shadow:Y,u_highlight:fe,u_accent:de}})(c,s,h,c.terrain?r.projMatrix:null);c.prepareDrawProgram(E,D,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:K,tileBoundsSegments:W}=c.getTileBoundsBuffers(s);D.draw(E,A.TRIANGLES,m,y,w,o.CullFaceMode.disabled,U,h.id,G,K,W)}function mi(c,r,s){if(!r.needsDEMTextureUpload)return;const h=c.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||c.getTileTexture(s.stride);const y=s.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new o.Texture(h,y,m.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function ms(c,r,s,h,m,y){const w=c.context,E=w.gl;if(!r.dem)return;const A=r.dem;if(w.activeTexture.set(E.TEXTURE1),mi(c,r,A),!r.demTexture)return;r.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const P=A.dim;w.activeTexture.set(E.TEXTURE0);let D=r.fbo;if(!D){const W=new o.Texture(w,{width:P,height:P,data:null},E.RGBA);W.bind(E.LINEAR,E.CLAMP_TO_EDGE),D=r.fbo=w.createFramebuffer(P,P,!0),D.colorAttachment.set(W.texture)}w.bindFramebuffer.set(D.framebuffer),w.viewport.set([0,0,P,P]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:G,tileBoundsSegments:K}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(w,E.TRIANGLES,h,m,y,o.CullFaceMode.disabled,((W,X)=>{const H=X.stride,Z=o.create();return o.ortho(Z,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Z,Z,[0,-o.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[H,H],u_zoom:W.overscaledZ,u_unpack:X.unpackVector}})(r.tileID,A),s.id,U,G,K),r.needsHillshadePrepare=!1}const pa=c=>({u_matrix:new o.UniformMatrix4f(c),u_image0:new o.Uniform1i(c),u_skirt_height:new o.Uniform1f(c)}),Uc=(c,r)=>({u_matrix:c,u_image0:0,u_skirt_height:r}),jc=(c,r,s,h,m,y,w,E,A,P,D,U,G,K)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:D,u_globe_radius:U,u_viewport:G,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function Nc(c,r){return c!=null&&r!=null&&!(!c.hasData()||!r.hasData())&&c.demTexture!=null&&r.demTexture!=null&&c.tileID.key!==r.tileID.key}const bo=new class{constructor(){this.operations={}}newMorphing(c,r,s,h,m){if(c in this.operations){const y=this.operations[c];y.to.tileID.key!==s.tileID.key&&(y.queued=s)}else this.operations[c]={startTime:h,phase:0,duration:m,from:r,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const r=this.operations[c];return{from:r.from,to:r.to,phase:r.phase}}update(c){for(const r in this.operations){const s=this.operations[r];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[r];break}}}_nextOp(c,r){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=r,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},fa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ef(c,r){const s=1<<c.z;return!r&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}const Vc=c=>({u_matrix:c});function yl(c,r,s,h,m){if(m>0){const y=o.exported.now(),w=(y-c.timeAdded)/m,E=r?(y-r.timeAdded)/m:-1,A=s.getSource(),P=h.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!r||Math.abs(r.tileID.overscaledZ-P)>Math.abs(c.tileID.overscaledZ-P),U=D&&c.refreshedUponExpiration?1:o.clamp(D?w:1-E,0,1);return c.refreshedUponExpiration&&w>=1&&(c.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class $c extends o.SourceCache{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},h=new Fi(Ii(),null),m=Ee("mock-dem",s,h,r.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class Gc extends o.SourceCache{constructor(r){const s=Ee("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Fi(Ii(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,h){if(r.freezeTileCoverage)return;this.transform=r;const m=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const E=new o.Tile(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom);E.state="loaded",this._tiles[w.key]=E}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xl extends o.OverscaledTileID{constructor(r,s,h){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class kh extends o.Elevation{constructor(r,s){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,y]=function(A){const P=new o.StructArrayLayout4i8,D=new o.StructArrayLayout3ui6,U=131;P.reserve(17161),D.reserve(33800);const G=o.EXTENT/128,K=o.EXTENT+G/2,W=K+G;for(let H=-G;H<W;H+=G)for(let Z=-G;Z<W;Z+=G){const te=Z<0||Z>K||H<0||H>K?24575:0,Y=o.clamp(Math.round(Z),0,o.EXTENT),fe=o.clamp(Math.round(H),0,o.EXTENT);P.emplaceBack(Y+te,fe,Y,fe)}const X=(H,Z)=>{const te=Z*U+H;D.emplaceBack(te+1,te,te+U),D.emplaceBack(te+U,te+U+1,te+1)};for(let H=1;H<129;H++)for(let Z=1;Z<129;Z++)X(Z,H);return[0,129].forEach(H=>{for(let Z=0;Z<130;Z++)X(Z,H),X(H,Z)}),[P,D,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(h,o.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gc(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const E=w.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $c(s.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,s,h){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const m=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const y=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(s,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),s.updateElevation(!h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(A=>{const P=s.getTileByID(A).tileID;return P.projMatrix=h.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){const D=P.transform.pointCoordinate(P.transform.getCameraPoint()),U=new o.pointGeometry(D.x,D.y);A.sort((G,K)=>{if(K.overscaledZ-G.overscaledZ)return K.overscaledZ-G.overscaledZ;const W=new o.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),X=new o.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),H=U.mult(1<<G.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(W)-H.distSqr(X)})})(m,this.painter),this._previousZoom=h.zoom;const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const A in w){const P=w[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,r[A],y),P.usedForTerrain))continue;const D=r[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[s.id]=m.map(A=>new xl(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const P=this.terrainTileForTile[A.key];if(!P)continue;const D=P.tileID.key;D in E||(this._visibleDemTiles.push(P),E[D]=D)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),mi(this.painter,m,y))}}_prepareDemTileUniforms(r,s,h,m){if(!s||s.demTexture==null)return!1;const y=r.tileID.canonical,w=Math.pow(2,s.tileID.canonical.z-y.z),E=m||"";return h[`u_dem_tl${E}`]=[y.x*w%1,y.y*w%1],h[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,s=r.gl;if(!this._emptyDepthBufferTexture){const h=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const y=m.dem.tree.minimums[0];return y>0&&r++,h+y},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new o.Texture(r,m,s.RGBA,{premultiply:!1}),y}setupElevationDraw(r,s,h){const m=this.painter.context,y=m.gl,w=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const A=this.painter.transform,P=A.projection,D=r.tileID.canonical;w.u_tile_tl_up=P.upVector(D,0,0),w.u_tile_tr_up=P.upVector(D,o.EXTENT,0),w.u_tile_br_up=P.upVector(D,o.EXTENT,o.EXTENT),w.u_tile_bl_up=P.upVector(D,0,o.EXTENT),w.u_tile_up_scale=h&&h.useDenormalizedUpVectorScale?o.GLOBE_METERS_TO_ECEF:P.upVectorScale(D,A.center.lat,A.worldSize).metersToTile;let U=null,G=null,K=1;if(h&&h.morphing&&this._useVertexMorphing){const W=h.morphing.srcDemTile,X=h.morphing.dstDemTile;K=h.morphing.phase,W&&X&&(this._prepareDemTileUniforms(r,W,w,"_prev")&&(G=W),this._prepareDemTileUniforms(r,X,w)&&(U=X))}if(G&&U?(m.activeTexture.set(y.TEXTURE2),U.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),m.activeTexture.set(y.TEXTURE4),G.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),w.u_dem_lerp=K):(U=this.terrainTileForTile[r.tileID.key],m.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(r,U,w)?U.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),m.activeTexture.set(y.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&U){const W=(1<<U.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=W}h&&h.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,w)}renderToBackBuffer(r){const s=this.painter,h=this.painter.context;r.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,w,E,A){if(m.transform.projection.name==="globe")(function(P,D,U,G,K){const W=P.context,X=W.gl;let H,Z;const te=P.options.showTerrainWireframe?2:0,Y=P.transform,fe=o.globeUseCustomAntiAliasing(P,W,Y),de=(it,ze)=>{if(Z===it)return;const Qe=[fa[it],"PROJECTION_GLOBE_VIEW"];fe&&Qe.push("CUSTOM_ANTIALIASING"),ze&&Qe.push(fa[te]),H=P.useProgram("globeRaster",null,Qe),Z=it},ae=P.colorModeForRenderPass(),pe=new o.DepthMode(X.LEQUAL,o.DepthMode.ReadWrite,P.depthRangeFor3D);bo.update(K);const he=o.calculateGlobeMercatorMatrix(Y),xe=[o.mercatorXfromLng(Y.center.lng),o.mercatorYfromLat(Y.center.lat)],Se=te?[!1,!0]:[!1],Ye=P.globeSharedBuffers,we=[Y.width*o.exported.devicePixelRatio,Y.height*o.exported.devicePixelRatio],Le=Float32Array.from(Y.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};if(Se.forEach(it=>{Z=-1;const ze=it?X.LINES:X.TRIANGLES;for(const Qe of G){const Oe=U.getTile(Qe),at=o.StencilMode.disabled,ot=D.prevTerrainTileForTile[Qe.key],wt=D.terrainTileForTile[Qe.key];Nc(ot,wt)&&bo.newMorphing(Qe.key,ot,wt,K,250),W.activeTexture.set(X.TEXTURE0),Oe.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Mt=bo.getMorphValuesForProxy(Qe.key),Nt=Mt?1:0;Mt&&o.extend$1(Fe,{morphing:{srcDemTile:Mt.from,dstDemTile:Mt.to,phase:o.easeCubicInOut(Mt.phase)}});const oi=o.tileCornersToBounds(Qe.canonical),Tt=o.getLatitudinalLod(oi.getCenter().lat),qt=o.getGridMatrix(Qe.canonical,oi,Tt),_i=o.globeNormalizeECEF(o.globeTileBounds(Qe.canonical)),qi=jc(Y.projMatrix,Le,he,_i,o.globeToMercatorTransition(Y.zoom),xe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,we,qt);if(de(Nt,it),D.setupElevationDraw(Oe,H,Fe),P.prepareDrawProgram(W,H,Qe.toUnwrapped()),Ye){const[nr,zi,Ar]=it?Ye.getWirefameBuffers(P.context,Tt):Ye.getGridBuffers(Tt);H.draw(W,ze,pe,at,ae,o.CullFaceMode.backCCW,qi,"globe_raster",nr,zi,Ar)}}}),Ye){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&it.push("CUSTOM_ANTIALIASING"),H=P.useProgram("globeRaster",null,it);for(const ze of G){const{x:Qe,y:Oe,z:at}=ze.canonical,ot=Oe===0,wt=Oe===(1<<at)-1,[Mt,Nt,oi,Tt]=Ye.getPoleBuffers(at);if(Tt&&(ot||wt)){const qt=U.getTile(ze);W.activeTexture.set(X.TEXTURE0),qt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let _i=o.globePoleMatrixForTile(at,Qe,Y);const qi=o.globeNormalizeECEF(o.globeTileBounds(ze.canonical)),nr=(zi,Ar)=>zi.draw(W,X.TRIANGLES,pe,o.StencilMode.disabled,ae,o.CullFaceMode.disabled,jc(Y.projMatrix,_i,_i,qi,0,xe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,we),"globe_pole_raster",Ar,oi,Tt);D.setupElevationDraw(qt,H,Fe),P.prepareDrawProgram(W,H,ze.toUnwrapped()),ot&&nr(H,Mt),wt&&(_i=o.scale(o.create(),_i,[1,-1,1]),nr(H,Nt))}}}})(m,y,w,E,A);else{const P=m.context,D=P.gl;let U,G;const K=m.options.showTerrainWireframe?2:0,W=(Y,fe)=>{if(G===Y)return;const de=[fa[Y]];fe&&de.push(fa[K]),U=m.useProgram("terrainRaster",null,de),G=Y},X=m.colorModeForRenderPass(),H=new o.DepthMode(D.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);bo.update(A);const Z=m.transform,te=6*Math.pow(1.5,22-Z.zoom)*y.exaggeration();(K?[!1,!0]:[!1]).forEach(Y=>{G=-1;const fe=Y?D.LINES:D.TRIANGLES,[de,ae]=Y?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const pe of E){const he=w.getTile(pe),xe=o.StencilMode.disabled,Se=y.prevTerrainTileForTile[pe.key],Ye=y.terrainTileForTile[pe.key];Nc(Se,Ye)&&bo.newMorphing(pe.key,Se,Ye,A,250),P.activeTexture.set(D.TEXTURE0),he.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const we=bo.getMorphValuesForProxy(pe.key),Le=we?1:0;let Fe;we&&(Fe={morphing:{srcDemTile:we.from,dstDemTile:we.to,phase:o.easeCubicInOut(we.phase)}});const it=Uc(pe.projMatrix,ef(pe.canonical,Z.renderWorldCopies)?te/10:te);W(Le,Y),y.setupElevationDraw(he,U,Fe),m.prepareDrawProgram(P,U,pe.toUnwrapped()),U.draw(P,fe,H,xe,X,o.CullFaceMode.backCCW,it,"terrain_raster",y.gridBuffer,de,ae)}})}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],w=this._drapedRenderBatches.shift(),E=[],A=s.style.order;let P=0;for(const D of y){const U=m.getTileByID(D.proxyTileKey),G=m.proxyCachedFBO[D.key]?m.proxyCachedFBO[D.key][r]:void 0,K=G!==void 0?m.renderCache[G]:this.pool[P++],W=G!==void 0;if(U.texture=K.tex,W&&!K.dirty){E.push(U.tileID);continue}let X;h.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(h.clear({color:o.Color.transparent,stencil:0}),K.dirty=!1);for(let H=w.start;H<=w.end;++H){const Z=s.style._layers[A[H]];if(Z.isHidden(s.transform.zoom))continue;const te=s.style._getLayerSourceCache(Z),Y=te?this.proxyToSource[D.key][te.id]:[D];if(!Y)continue;const fe=Y;h.viewport.set([0,0,K.fb.width,K.fb.height]),X!==(te?te.id:null)&&(this._setupStencil(K,Y,Z,te),X=te?te.id:null),s.renderLayer(s,te,Z,fe)}this.renderedToTile?(K.dirty=!0,E.push(U.tileID)):W||--P,P===5&&(P=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),w.end+1}postRender(){}renderCacheEfficiency(r){const s=r.order.length;if(s===0)return{efficiency:100};let h,m=0,y=0,w=!1;for(let E=0;E<s;++E){const A=r._layers[r.order[E]];this._style.isLayerDraped(A)?(w&&++m,++y):w||(w=!0,h=A.id)}return y===0?{efficiency:100}:{efficiency:100*(1-m/y),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,E=1<<w.overscaledZ,{x:A,y:P}=w.canonical,D=A/E,U=(A+1)/E,G=P/E,K=(P+1)/E;return{minx:D,miny:G,maxx:U,maxy:K,t:y.dem.tree.raycastRoot(D,G,U,K,r,s,h),tile:y}});m.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,s,h);if(w!=null)return w}return null}_createFBO(){const r=this.painter.context,s=r.gl,h=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const m=new o.Texture(r,{width:h[0],height:h[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const y=r.createFramebuffer(h[0],h[1],!1);return y.colorAttachment.set(m.texture),y.depthAttachment=new O(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._layers[r],h=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),y=!!m&&m.t!==1,w=s.hasTransition();return s.type!=="custom"&&!h&&(y||w)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof re){r=!0;break}if(r)for(let s=0;s<this._style.order.length;++s){const h=this._style._layers[this._style.order[s]],m=h.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!y)continue;const w=h.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const A=this.proxyToSource[E.key][y.id];if(A)for(const P of A){const D=yl(y.getTile(P),y.findLoadedParent(P,0),y,this.painter.transform,w);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(y.id,P)}}}}_setupDrapedRenderBatches(){const r=this._style.order,s=r.length;if(s===0)return;const h=[];let m,y=0,w=this._style._layers[r[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<s;)w=this._style._layers[r[y]];for(;y<s;++y){const E=this._style._layers[r[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?m===void 0&&(m=y):m!==void 0&&(h.push({start:m,end:y-1}),m=void 0))}m!==void 0&&h.push({start:m,end:y-1}),this._drapedRenderBatches=h}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const w=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let E=0;E<w.length;++E){const A=Object.values(w[E]);s.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let w=h.length-1;w>=0;w--){const E=h[w];if(s.getTileByID(E.key),s.proxyCachedFBO[E.key]!==void 0){const A=r[E.key],P=this.proxyToSource[E.key];let D=0;for(const U in P){const G=P[U],K=A[U];if(!K||K.length!==G.length||G.some((W,X)=>W!==K[X]||m[U]&&m[U].hasOwnProperty(W.key))){D=-1;break}++D}for(const U in s.proxyCachedFBO[E.key])s.renderCache[s.proxyCachedFBO[E.key][U]].dirty=D<0||D!==Object.values(A).length}}const y=[...this._drapedRenderBatches];y.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of y)for(const E of h){if(s.proxyCachedFBO[E.key])continue;let A=s.renderCachePool.pop();A===void 0&&s.renderCache.length<50&&(A=s.renderCache.length,s.renderCache.push(this._createFBO())),A!==void 0&&(s.proxyCachedFBO[E.key]={},s.proxyCachedFBO[E.key][w.start]=A,s.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let E;if(h.isTileClipped())E=s.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,s){const h=this.painter,m=this.painter.context,y=m.gl;h._tileClippingMaskIDs={},m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const w=h.useProgram("clippingMask");for(const E of r){const A=h._tileClippingMaskIDs[E.key]=--s;w.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Vc(E.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const h=[r.x,r.y,1,1];o.transformMat4$1(h,h,s.pixelMatrixInverse),o.scale$1(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,y=o.mercatorZfromAltitude(1,s.center.lat),w=[m[0],m[1],m[2]/y,0],E=o.subtract([],h.slice(0,3),w);o.normalize(E,E);const A=this.raycast(w,E,this._exaggeration);return A!==null&&A?(o.scaleAndAdd(w,w,E,A),w[3]=w[2],w[2]*=y,w):null}drawDepth(){const r=this.painter,s=r.context,h=this.proxySourceCache,m=Math.ceil(r.width),y=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=s.gl,E=s.createFramebuffer(m,y,!0);s.activeTexture.set(w.TEXTURE0);const A=new o.Texture(s,{width:m,height:y,data:null},w.RGBA);A.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.colorAttachment.set(A.texture);const P=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,y);E.depthAttachment.set(P),this._depthFBO=E,this._depthTexture=A}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,y]),function(w,E,A,P){if(w.transform.projection.name==="globe")return;const D=w.context,U=D.gl;D.clear({depth:1});const G=w.useProgram("terrainDepth"),K=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,w.depthRangeFor3D);for(const W of P){const X=A.getTile(W),H=Uc(W.projMatrix,0);E.setupElevationDraw(X,G),G.draw(D,U.TRIANGLES,K,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,H,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(r,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,s,h){if(r.getSource()instanceof be)return this._setupProxiedCoordsForImageSource(r,s,h);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const m=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const A=y[E],P=this._findTileCoveringTileID(A,r);if(P){const D=this._createProxiedId(A,P,h[A.key]&&h[A.key][r.id]);m.push(D),this.proxyToSource[A.key][r.id]=[D]}}let w=!1;for(let E=0;E<s.length;E++){const A=r.getTile(s[E]);if(!A||!A.hasData())continue;const P=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==A.tileID.canonical.z){const D=this.proxyToSource[P.tileID.key][r.id],U=this._createProxiedId(P.tileID,A,h[P.tileID.key]&&h[P.tileID.key][r.id]);D?D.splice(D.length-1,0,U):this.proxyToSource[P.tileID.key][r.id]=[U],m.push(U),w=!0}}this._sourceTilesOverlap[r.id]=w}_setupProxiedCoordsForImageSource(r,s,h){if(!r.getSource().loaded())return;const m=this.proxiedCoords[r.id]=[],y=this.proxyCoords,w=r.getSource(),E=new o.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),A=w.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((D,U)=>(D.min.x=Math.min(D.min.x,U.x-E.x),D.min.y=Math.min(D.min.y,U.y-E.y),D.max.x=Math.max(D.max.x,U.x-E.x),D.max.y=Math.max(D.max.y,U.y-E.y),D),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(D,U)=>{const G=D.wrap+D.canonical.x/(1<<D.canonical.z),K=D.canonical.y/(1<<D.canonical.z),W=o.EXTENT/(1<<D.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),H=U.canonical.y/(1<<U.canonical.z);return G+W<X+A.min.x||G>X+A.max.x||K+W<H+A.min.y||K>H+A.max.y};for(let D=0;D<y.length;D++){const U=y[D];for(let G=0;G<s.length;G++){const K=r.getTile(s[G]);if(!K||!K.hasData()||P(U,K.tileID))continue;const W=this._createProxiedId(U,K,h[U.key]&&h[U.key][r.id]),X=this.proxyToSource[U.key][r.id];X?X.push(W):this.proxyToSource[U.key][r.id]=[W],m.push(W)}}}_createProxiedId(r,s,h){let m=this.orthoMatrix;if(h){const y=h.find(w=>w.key===s.tileID.key);if(y)return y}if(s.tileID.key!==r.key){const y=r.canonical.z-s.tileID.canonical.z;let w,E,A;m=o.create();const P=s.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(w=o.EXTENT>>y,E=w*((s.tileID.canonical.x<<y)-r.canonical.x+P),A=w*((s.tileID.canonical.y<<y)-r.canonical.y)):(w=o.EXTENT<<-y,E=o.EXTENT*(s.tileID.canonical.x-(r.canonical.x+P<<-y)),A=o.EXTENT*(s.tileID.canonical.y-(r.canonical.y<<-y))),o.ortho(m,0,w,0,w,0,1),o.translate(m,m,[E,A,0])}return new xl(s.tileID,r.key,m)}_findTileCoveringTileID(r,s){let h=s.getTile(r);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],y=m[r.key];if(h=y?s.getTileByID(y):null,h&&h.hasData()||y===null)return h;let w=h?h.tileID:r,E=w.overscaledZ;const A=s.getSource().minzoom,P=[];if(!y){const U=s.getSource().maxzoom;if(r.canonical.z>=U){const G=r.canonical.z-U;s.getSource().reparseOverscaled?(E=Math.max(r.canonical.z+2,s.transform.tileZoom),w=new o.OverscaledTileID(E,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G)):G!==0&&(E=U,w=new o.OverscaledTileID(E,r.wrap,U,r.canonical.x>>G,r.canonical.y>>G))}w.key!==r.key&&(P.push(w.key),h=s.getTile(w))}const D=U=>{P.forEach(G=>{m[G]=U}),P.length=0};for(E-=1;E>=A&&(!h||!h.hasData());E--){h&&D(h.tileID.key);const U=w.calculateScaledKey(E);if(h=s.getTileByID(U),h&&h.hasData())break;const G=m[U];if(G===null)break;G===void 0?P.push(U):h=s.getTileByID(G)}return D(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let h=this._tilesDirty[r];h||(h=this._tilesDirty[r]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(s){let h=0;const m=new o.StructArrayLayout2ui4,y=131;for(let w=1;w<129;w++){for(let E=1;E<129;E++)h=w*y+E,m.emplaceBack(h,h+1),m.emplaceBack(h,h+y),m.emplaceBack(h+1,h+y),w===128&&m.emplaceBack(h+y,h+y+1);m.emplaceBack(h+1,h+1+y)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class qc{static cacheKey(r,s,h,m){let y=`${s}${m?m.cacheKey:""}`;for(const w of h)r.usedDefines.includes(w)&&(y+=`/${w}`);return y}constructor(r,s,h,m,y,w){const E=r.gl;this.program=E.createProgram();const A=function(H){const Z=[];for(let te=0;te<H.length;te++){if(H[te]===null)continue;const Y=H[te].split(" ");Z.push(Y.pop())}return Z}(h.staticAttributes),P=m?m.getBinderAttributes():[],D=A.concat(P);let U=m?m.defines():[];U=U.concat(w.map(H=>`#define ${H}`));const G=U.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(ml):ml,ml,fl,da.fragmentSource,No.fragmentSource,h.fragmentSource).join(`
`),K=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,fl,da.vertexSource,No.vertexSource,pl.vertexSource,h.vertexSource).join(`
`),W=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(W,G),E.compileShader(W),E.attachShader(this.program,W);const X=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(X,K),E.compileShader(X),E.attachShader(this.program,X),this.attributes={},this.numAttributes=D.length;for(let H=0;H<this.numAttributes;H++)D[H]&&(E.bindAttribLocation(this.program,H,D[H]),this.attributes[D[H]]=H);E.linkProgram(this.program),E.deleteShader(X),E.deleteShader(W),this.fixedUniforms=y(r),this.binderUniforms=m?m.getUniforms(r):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(H=>({u_dem:new o.Uniform1i(H),u_dem_prev:new o.Uniform1i(H),u_dem_unpack:new o.Uniform4f(H),u_dem_tl:new o.Uniform2f(H),u_dem_scale:new o.Uniform1f(H),u_dem_tl_prev:new o.Uniform2f(H),u_dem_scale_prev:new o.Uniform1f(H),u_dem_size:new o.Uniform1f(H),u_dem_lerp:new o.Uniform1f(H),u_exaggeration:new o.Uniform1f(H),u_depth:new o.Uniform1i(H),u_depth_size_inv:new o.Uniform2f(H),u_meter_to_dem:new o.Uniform1f(H),u_label_plane_matrix_inv:new o.UniformMatrix4f(H),u_tile_tl_up:new o.Uniform3f(H),u_tile_tr_up:new o.Uniform3f(H),u_tile_br_up:new o.Uniform3f(H),u_tile_bl_up:new o.Uniform3f(H),u_tile_up_scale:new o.Uniform1f(H)}))(r)),w.indexOf("FOG")!==-1&&(this.fogUniforms=(H=>({u_fog_matrix:new o.UniformMatrix4f(H),u_fog_range:new o.Uniform2f(H),u_fog_color:new o.Uniform4f(H),u_fog_horizon_blend:new o.Uniform1f(H),u_fog_temporal_offset:new o.Uniform1f(H),u_frustum_tl:new o.Uniform3f(H),u_frustum_tr:new o.Uniform3f(H),u_frustum_br:new o.Uniform3f(H),u_frustum_bl:new o.Uniform3f(H),u_globe_pos:new o.Uniform3f(H),u_globe_radius:new o.Uniform1f(H),u_globe_transition:new o.Uniform1f(H),u_is_globe:new o.Uniform1i(H),u_viewport:new o.Uniform2f(H)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}draw(r,s,h,m,y,w,E,A,P,D,U,G,K,W,X){const H=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(h),r.setStencilMode(m),r.setColorMode(y),r.setCullFace(w);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,E[te]);W&&W.setUniforms(this.program,r,this.binderUniforms,G,{zoom:K});const Z={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[s];for(const te of U.get()){const Y=te.vaos||(te.vaos={});(Y[A]||(Y[A]=new gl)).bind(r,this,P,W?W.getPaintVertexBuffers():[],D,te.vertexOffset,X||[]),H.drawElements(s,te.primitiveLength*Z,H.UNSIGNED_SHORT,te.primitiveOffset*Z*2)}}}function Dh(c,r,s){const h=1/rn(s,1,r.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,r.transform.tileZoom)/m,w=y*(s.tileID.canonical.x+s.tileID.wrap*m),E=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const ma=o.create(),_s=(c,r,s,h,m,y,w,E,A,P,D)=>{const U=r.style.light,G=U.properties.get("position"),K=[G.x,G.y,G.z],W=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(W,-r.transform.angle),o.transformMat3(K,K,W));const X=U.properties.get("color"),H=r.transform,Z={u_matrix:c,u_lightpos:K,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ma,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:y};return H.projection.name==="globe"&&(Z.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],Z.u_zoom_transition=A,Z.u_inv_rot_matrix=D,Z.u_merc_center=P,Z.u_up_dir=H.projection.upVector(new o.CanonicalTileID(0,0,0),P[0]*o.EXTENT,P[1]*o.EXTENT),Z.u_height_lift=E),Z},Lh=(c,r,s,h,m,y,w,E,A,P,D,U,G)=>{const K=_s(c,r,s,h,m,y,w,P,D,U,G),W={u_height_factor:-Math.pow(2,w.overscaledZ)/A.tileSize/8};return o.extend(K,Dh(E,r,A),W)},_a=c=>({u_matrix:c}),vl=(c,r,s,h)=>o.extend(_a(c),Dh(s,r,h)),jn=(c,r)=>({u_matrix:c,u_world:r}),Zc=(c,r,s,h,m)=>o.extend(vl(c,r,s,h),{u_world:m}),Rh=o.create(),Wc=(c,r,s,h,m,y)=>{const w=c.transform,E=w.projection.name==="globe";let A;if(y.paint.get("circle-pitch-alignment")==="map")if(E){const D=o.globePixelsToTileUnits(w.zoom,r.canonical)*w._pixelsPerMercatorPixel;A=Float32Array.from([D,0,0,D])}else A=w.calculatePixelsToTileUnitsMatrix(s);else A=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:c.translatePosMatrix(r.projMatrix,s,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Rh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){P.u_inv_rot_matrix=h,P.u_merc_center=m,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=o.globeToMercatorTransition(w.zoom);const D=m[0]*o.EXTENT,U=m[1]*o.EXTENT;P.u_up_dir=w.projection.upVector(new o.CanonicalTileID(0,0,0),D,U)}return P},Bh=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},Xc=(c,r,s,h)=>{const m=o.EXTENT/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:r.getCameraToCenterDistance(h),u_extrude_scale:[r.pixelsToGLUnits[0]/m,r.pixelsToGLUnits[1]/m]}},Oh=(c,r,s=1)=>({u_matrix:c,u_color:r,u_overlay:0,u_overlay_scale:s}),Hc=o.create(),tf=(c,r,s,h,m,y,w)=>{const E=c.transform,A=E.projection.name==="globe",P=A?o.globePixelsToTileUnits(E.zoom,r.canonical)*E._pixelsPerMercatorPixel:rn(s,1,y),D={u_matrix:r.projMatrix,u_extrude_scale:P,u_intensity:w,u_inv_rot_matrix:Hc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=h,D.u_merc_center=m,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=o.globeToMercatorTransition(E.zoom);const U=m[0]*o.EXTENT,G=m[1]*o.EXTENT;D.u_up_dir=E.projection.upVector(new o.CanonicalTileID(0,0,0),U,G)}return D},bl=(c,r,s,h,m,y,w,E)=>{const A=c.transform,P=A.calculatePixelsToTileUnitsMatrix(r),D={u_matrix:Fh(c,r,s,m),u_pixels_to_tile_units:P,u_device_pixel_ratio:w,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:E};if(Tl(s)){const U=wl(r,c.transform);D.u_texsize=r.lineAtlasTexture.size,D.u_scale=[U,h.fromScale,h.toScale],D.u_mix=h.t}return D},rf=(c,r,s,h,m,y)=>{const w=c.transform,E=wl(r,w);return{u_matrix:Fh(c,r,s,m),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:y,u_image:0,u_scale:[E,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function wl(c,r){return 1/rn(c,1,r.tileZoom)}function Fh(c,r,s,h){return c.translatePosMatrix(h||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function Tl(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const nf=(c,r,s,h,m,y)=>{return{u_matrix:c,u_tl_parent:r,u_scale_parent:s,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=m.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:El(m.paint.get("raster-hue-rotate")),u_perspective_transform:y};var w,E};function El(c){c*=Math.PI/180;const r=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const Uh=o.create(),Kc=(c,r,s,h,m,y,w,E,A,P,D,U,G,K,W,X)=>{const H=m.transform,Z={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+h,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Uh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Uh,u_up_vector:[0,-1,0]};return X.name==="globe"&&(Z.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],Z.u_zoom_transition=U,Z.u_inv_rot_matrix=K,Z.u_merc_center=G,Z.u_camera_forward=H._camera.forward(),Z.u_ecef_origin=o.globeECEFOrigin(H.globeMatrix,D.toUnwrapped()),Z.u_tile_matrix=Float32Array.from(H.globeMatrix),Z.u_up_vector=W),Z},Yc=(c,r,s,h,m,y,w,E,A,P,D,U,G,K,W,X,H)=>o.extend(Kc(c,r,s,h,m,y,w,E,A,P,U,G,K,W,X,H),{u_gamma_scale:h?m.transform.cameraToCenterDistance*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+D}),gs=(c,r,s,h,m,y,w,E,A,P,D,U,G,K,W,X)=>o.extend(Yc(c,r,s,h,m,y,w,E,!0,A,!0,D,U,G,K,W,X),{u_texsize_icon:P,u_texture_icon:1}),of=(c,r,s)=>({u_matrix:c,u_opacity:r,u_color:s}),sf=(c,r,s,h,m,y)=>o.extend(function(w,E,A,P){const D=A.imageManager.getPattern(w.from.toString()),U=A.imageManager.getPattern(w.to.toString()),{width:G,height:K}=A.imageManager.getPixelSize(),W=Math.pow(2,P.tileID.overscaledZ),X=P.tileSize*Math.pow(2,A.transform.tileZoom)/W,H=X*(P.tileID.canonical.x+P.tileID.wrap*W),Z=X*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[G,K],u_mix:E.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/rn(P,1,A.transform.tileZoom),u_pixel_coord_upper:[H>>16,Z>>16],u_pixel_coord_lower:[65535&H,65535&Z]}}(h,y,s,m),{u_matrix:c,u_opacity:r}),af={fillExtrusion:c=>({u_matrix:new o.UniformMatrix4f(c),u_lightpos:new o.Uniform3f(c),u_lightintensity:new o.Uniform1f(c),u_lightcolor:new o.Uniform3f(c),u_vertical_gradient:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_edge_radius:new o.Uniform1f(c),u_ao:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_up_dir:new o.Uniform3f(c),u_height_lift:new o.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_lightpos:new o.Uniform3f(c),u_lightintensity:new o.Uniform1f(c),u_lightcolor:new o.Uniform3f(c),u_vertical_gradient:new o.Uniform1f(c),u_height_factor:new o.Uniform1f(c),u_edge_radius:new o.Uniform1f(c),u_ao:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_up_dir:new o.Uniform3f(c),u_height_lift:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c)}),fill:c=>({u_matrix:new o.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c)}),fillOutline:c=>({u_matrix:new o.UniformMatrix4f(c),u_world:new o.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_world:new o.Uniform2f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new o.Uniform1f(c),u_extrude_scale:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_up_dir:new o.Uniform3f(c)}),collisionBox:c=>({u_matrix:new o.UniformMatrix4f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_extrude_scale:new o.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new o.UniformMatrix4f(c),u_inv_matrix:new o.UniformMatrix4f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_viewport_size:new o.Uniform2f(c)}),debug:c=>({u_color:new o.UniformColor(c),u_matrix:new o.UniformMatrix4f(c),u_overlay:new o.Uniform1i(c),u_overlay_scale:new o.Uniform1f(c)}),clippingMask:c=>({u_matrix:new o.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new o.Uniform1f(c),u_intensity:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_up_dir:new o.Uniform3f(c)}),heatmapTexture:c=>({u_image:new o.Uniform1i(c),u_color_ramp:new o.Uniform1i(c),u_opacity:new o.Uniform1f(c)}),hillshade:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_latrange:new o.Uniform2f(c),u_light:new o.Uniform2f(c),u_shadow:new o.UniformColor(c),u_highlight:new o.UniformColor(c),u_accent:new o.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_dimension:new o.Uniform2f(c),u_zoom:new o.Uniform1f(c),u_unpack:new o.Uniform4f(c)}),line:c=>({u_matrix:new o.UniformMatrix4f(c),u_pixels_to_tile_units:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_units_to_pixels:new o.Uniform2f(c),u_dash_image:new o.Uniform1i(c),u_gradient_image:new o.Uniform1i(c),u_image_height:new o.Uniform1f(c),u_texsize:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_mix:new o.Uniform1f(c),u_alpha_discard_threshold:new o.Uniform1f(c),u_trim_offset:new o.Uniform2f(c)}),linePattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_texsize:new o.Uniform2f(c),u_pixels_to_tile_units:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_units_to_pixels:new o.Uniform2f(c),u_scale:new o.Uniform3f(c),u_fade:new o.Uniform1f(c),u_alpha_discard_threshold:new o.Uniform1f(c)}),raster:c=>({u_matrix:new o.UniformMatrix4f(c),u_tl_parent:new o.Uniform2f(c),u_scale_parent:new o.Uniform1f(c),u_fade_t:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_image0:new o.Uniform1i(c),u_image1:new o.Uniform1i(c),u_brightness_low:new o.Uniform1f(c),u_brightness_high:new o.Uniform1f(c),u_saturation_factor:new o.Uniform1f(c),u_contrast_factor:new o.Uniform1f(c),u_spin_weights:new o.Uniform3f(c),u_perspective_transform:new o.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_camera_forward:new o.Uniform3f(c),u_tile_matrix:new o.UniformMatrix4f(c),u_up_vector:new o.Uniform3f(c),u_ecef_origin:new o.Uniform3f(c),u_texture:new o.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_texture:new o.Uniform1i(c),u_gamma_scale:new o.Uniform1f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_camera_forward:new o.Uniform3f(c),u_tile_matrix:new o.UniformMatrix4f(c),u_up_vector:new o.Uniform3f(c),u_ecef_origin:new o.Uniform3f(c),u_is_halo:new o.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_texsize_icon:new o.Uniform2f(c),u_texture:new o.Uniform1i(c),u_texture_icon:new o.Uniform1i(c),u_gamma_scale:new o.Uniform1f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_is_halo:new o.Uniform1i(c)}),background:c=>({u_matrix:new o.UniformMatrix4f(c),u_opacity:new o.Uniform1f(c),u_color:new o.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_opacity:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_pattern_tl_a:new o.Uniform2f(c),u_pattern_br_a:new o.Uniform2f(c),u_pattern_tl_b:new o.Uniform2f(c),u_pattern_br_b:new o.Uniform2f(c),u_texsize:new o.Uniform2f(c),u_mix:new o.Uniform1f(c),u_pattern_size_a:new o.Uniform2f(c),u_pattern_size_b:new o.Uniform2f(c),u_scale_a:new o.Uniform1f(c),u_scale_b:new o.Uniform1f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c)}),terrainRaster:pa,terrainDepth:pa,skybox:c=>({u_matrix:new o.UniformMatrix4f(c),u_sun_direction:new o.Uniform3f(c),u_cubemap:new o.Uniform1i(c),u_opacity:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new o.UniformMatrix4f(c),u_color_ramp:new o.Uniform1i(c),u_center_direction:new o.Uniform3f(c),u_radius:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new o.UniformMatrix3f(c),u_sun_direction:new o.Uniform3f(c),u_sun_intensity:new o.Uniform1f(c),u_color_tint_r:new o.Uniform4f(c),u_color_tint_m:new o.Uniform4f(c),u_luminance:new o.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new o.UniformMatrix4f(c),u_globe_matrix:new o.UniformMatrix4f(c),u_normalize_matrix:new o.UniformMatrix4f(c),u_merc_matrix:new o.UniformMatrix4f(c),u_zoom_transition:new o.Uniform1f(c),u_merc_center:new o.Uniform2f(c),u_image0:new o.Uniform1i(c),u_grid_matrix:new o.UniformMatrix3f(c),u_frustum_tl:new o.Uniform3f(c),u_frustum_tr:new o.Uniform3f(c),u_frustum_br:new o.Uniform3f(c),u_frustum_bl:new o.Uniform3f(c),u_globe_pos:new o.Uniform3f(c),u_globe_radius:new o.Uniform1f(c),u_viewport:new o.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new o.Uniform3f(c),u_frustum_tr:new o.Uniform3f(c),u_frustum_br:new o.Uniform3f(c),u_frustum_bl:new o.Uniform3f(c),u_horizon:new o.Uniform1f(c),u_transition:new o.Uniform1f(c),u_fadeout_range:new o.Uniform1f(c),u_color:new o.Uniform4f(c),u_high_color:new o.Uniform4f(c),u_space_color:new o.Uniform4f(c),u_star_intensity:new o.Uniform1f(c),u_star_density:new o.Uniform1f(c),u_star_size:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c),u_horizon_angle:new o.Uniform1f(c),u_rotation_matrix:new o.UniformMatrix4f(c)})};let Sl;function jh(c,r,s,h,m,y,w){const E=c.context,A=E.gl,P=c.transform,D=c.useProgram("collisionBox"),U=[];let G=0,K=0;for(let fe=0;fe<h.length;fe++){const de=h[fe],ae=r.getTile(de),pe=ae.getBucket(s);if(!pe)continue;const he=Hr(de,pe,P);let xe=he;m[0]===0&&m[1]===0||(xe=c.translatePosMatrix(he,ae,m,y));const Se=w?pe.textCollisionBox:pe.iconCollisionBox,Ye=pe.collisionCircleArray;if(Ye.length>0){const we=o.create(),Le=xe;o.mul(we,pe.placementInvProjMatrix,P.glCoordMatrix),o.mul(we,we,pe.placementViewportMatrix),U.push({circleArray:Ye,circleOffset:K,transform:Le,invTransform:we,projection:pe.getProjection()}),G+=Ye.length/4,K=G}Se&&(c.terrain&&c.terrain.setupElevationDraw(ae,D),D.draw(E,A.LINES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,Xc(xe,P,ae,pe.getProjection()),s.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,P.zoom,null,[Se.collisionVertexBuffer,Se.collisionVertexBufferExt]))}if(!w||!U.length)return;const W=c.useProgram("collisionCircle"),X=new o.StructArrayLayout2f1f2i16;X.resize(4*G),X._trim();let H=0;for(const fe of U)for(let de=0;de<fe.circleArray.length/4;de++){const ae=4*de,pe=fe.circleArray[ae+0],he=fe.circleArray[ae+1],xe=fe.circleArray[ae+2],Se=fe.circleArray[ae+3];X.emplace(H++,pe,he,xe,Se,0),X.emplace(H++,pe,he,xe,Se,1),X.emplace(H++,pe,he,xe,Se,2),X.emplace(H++,pe,he,xe,Se,3)}(!Sl||Sl.length<2*G)&&(Sl=function(fe){const de=2*fe,ae=new o.StructArrayLayout3ui6;ae.resize(de),ae._trim();for(let pe=0;pe<de;pe++){const he=6*pe;ae.uint16[he+0]=4*pe+0,ae.uint16[he+1]=4*pe+1,ae.uint16[he+2]=4*pe+2,ae.uint16[he+3]=4*pe+2,ae.uint16[he+4]=4*pe+3,ae.uint16[he+5]=4*pe+0}return ae}(G));const Z=E.createIndexBuffer(Sl,!0),te=E.createVertexBuffer(X,o.collisionCircleLayout.members,!0);for(const fe of U){const de={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(Y=P).getCameraToCenterDistance(fe.projection),u_viewport_size:[Y.width,Y.height]};W.draw(E,A.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,de,s.id,te,Z,o.SegmentVector.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,P.zoom)}var Y;te.destroy(),Z.destroy()}const Nh=o.create();function Jc(c,r,s,h,m,y){const{horizontalAlign:w,verticalAlign:E}=o.getAnchorAlignment(c),A=-(w-.5)*r,P=-(E-.5)*s,D=o.evaluateVariableOffset(c,h);return new o.pointGeometry((A/m+D[0])*y,(P/m+D[1])*y)}function Qc(c,r,s,h,m,y,w,E,A,P,D){const U=c.text.placedSymbolArray,G=c.text.dynamicLayoutVertexArray,K=c.icon.dynamicLayoutVertexArray,W={},X=Kr(E,c.getProjection(),y),H=y.elevation,Z=c.getProjection().upVectorScale(E.canonical,y.center.lat,y.worldSize);G.clear();for(let te=0;te<U.length;te++){const Y=U.get(te),fe=c.allowVerticalPlacement&&!Y.placedOrientation,de=Y.hidden||!Y.crossTileID||fe?null:h[Y.crossTileID];if(de){const ae=new o.pointGeometry(Y.tileAnchorX,Y.tileAnchorY),pe=c.getProjection().upVector(E.canonical,ae.x,ae.y),he=H?H.getAtTileOffset(E,ae.x,ae.y):0,xe=Xt([Y.projectedAnchorX+he*pe[0]*Z.metersToTile,Y.projectedAnchorY+he*pe[1]*Z.metersToTile,Y.projectedAnchorZ+he*pe[2]*Z.metersToTile],s?X:w),Se=na(y.getCameraToCenterDistance(c.getProjection()),xe.signedDistanceFromCamera);let Ye=m.evaluateSizeForFeature(c.textSizeData,P,Y)*Se/o.ONE_EM;s&&(Ye*=c.tilePixelRatio/A);const{width:we,height:Le,anchor:Fe,textOffset:it,textScale:ze}=de,Qe=Jc(Fe,we,Le,it,ze,Ye);let Oe;if(s){const ot=ae.add(Qe),{x:wt,y:Mt,z:Nt}=c.getProjection().projectTilePoint(ot.x,ot.y,E.canonical);Oe=Xt([wt+he*pe[0]*Z.metersToTile,Mt+he*pe[1]*Z.metersToTile,Nt+he*pe[2]*Z.metersToTile],w).point}else{const ot=r?Qe.rotate(-y.angle):Qe;Oe=[xe.point[0]+ot.x,xe.point[1]+ot.y,0]}const at=c.allowVerticalPlacement&&Y.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<Y.numGlyphs;ot++)o.addDynamicAttributes(G,Oe[0],Oe[1],Oe[2],at);D&&Y.associatedIconIndex>=0&&(W[Y.associatedIconIndex]={shiftedAnchor:Oe,angle:at})}else go(Y.numGlyphs,G)}if(D){K.clear();const te=c.icon.placedSymbolArray;for(let Y=0;Y<te.length;Y++){const fe=te.get(Y);if(fe.hidden)go(fe.numGlyphs,K);else{const de=W[Y];if(de)for(let ae=0;ae<fe.numGlyphs;ae++)o.addDynamicAttributes(K,de.shiftedAnchor[0],de.shiftedAnchor[1],de.shiftedAnchor[2],de.angle);else go(fe.numGlyphs,K)}}c.icon.dynamicLayoutVertexBuffer.updateData(K)}c.text.dynamicLayoutVertexBuffer.updateData(G)}function Vh(c,r,s){return s.iconsInText&&r?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function eu(c,r,s,h,m,y,w,E,A,P,D,U){const G=c.context,K=G.gl,W=c.transform,X=E==="map",H=A==="map",Z=X&&s.layout.get("symbol-placement")!=="point",te=X&&!H&&!Z,Y=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let fe=!1;const de=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),ae=[o.mercatorXfromLng(W.center.lng),o.mercatorYfromLat(W.center.lat)],pe=s.layout.get("text-variable-anchor"),he=W.projection.name==="globe",xe=[],Se=[0,-1,0];let Ye=Se;!he&&!W.mercatorFromTransition||X||(Ye=function(we){const Le=we._camera.getWorldToCamera(we.worldSize,1),Fe=o.multiply([],Le,we.globeMatrix);o.invert(Fe,Fe);const it=[0,0,0],ze=[0,1,0,0];return o.transformMat4$1(ze,ze,Fe),it[0]=ze[0],it[1]=ze[1],it[2]=ze[2],o.normalize(it,it),it}(W));for(const we of h){const Le=r.getTile(we),Fe=Le.getBucket(s);if(!Fe||Fe.projection.name==="mercator"&&he)continue;const it=m?Fe.text:Fe.icon;if(!it||Fe.fullyClipped||!it.segments.get().length)continue;const ze=it.programConfigurations.get(s.id),Qe=m||Fe.sdfIcons,Oe=m?Fe.textSizeData:Fe.iconSizeData,at=H||W.pitch!==0,ot=o.evaluateSizeForZoom(Oe,W.zoom);let wt,Mt,Nt,oi,Tt=[0,0],qt=null;if(m){if(Mt=Le.glyphAtlasTexture,Nt=K.LINEAR,wt=Le.glyphAtlasTexture.size,Fe.iconsInText){Tt=Le.imageAtlasTexture.size,qt=Le.imageAtlasTexture;const Gr=Oe.kind==="composite"||Oe.kind==="camera";oi=at||c.options.rotating||c.options.zooming||Gr?K.LINEAR:K.NEAREST}}else{const Gr=s.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;Mt=Le.imageAtlasTexture,Nt=Qe||c.options.rotating||c.options.zooming||Gr||at?K.LINEAR:K.NEAREST,wt=Le.imageAtlasTexture.size}const _i=Fe.projection.name==="globe",qi=_i?Ye:Se,nr=_i?o.globeToMercatorTransition(W.zoom):0,zi=Kr(we,Fe.getProjection(),W),Ar=W.calculatePixelsToTileUnitsMatrix(Le),zn=ti(zi,Le.tileID.canonical,H,X,W,Fe.getProjection(),Ar),Qn=c.terrain&&H&&Z?o.invert(o.create(),zn):Nh,Zi=An(zi,Le.tileID.canonical,H,X,W,Fe.getProjection(),Ar),Xi=pe&&Fe.hasTextData(),Qt=s.layout.get("icon-text-fit")!=="none"&&Xi&&Fe.hasIconData();if(Z){const Gr=W.elevation,Xo=Gr?Gr.getAtTileOffsetFunc(we,W.center.lat,W.worldSize,Fe.getProjection()):Da=>[0,0,0],To=ii(zi,Le.tileID.canonical,H,X,W,Fe.getProjection(),Ar);sa(Fe,zi,c,m,To,Zi,H,P,Xo,we)}const dr=Z||m&&pe||Qt,Lr=c.translatePosMatrix(zi,Le,y,w),Ui=dr?Nh:zn,Rr=c.translatePosMatrix(Zi,Le,y,w,!0),Go=Fe.getProjection().createInversionMatrix(W,we.canonical),$r=[];c.terrain&&H&&$r.push("PITCH_WITH_MAP_TERRAIN"),_i&&$r.push("PROJECTION_GLOBE_VIEW"),dr&&$r.push("PROJECTED_POS_ON_VIEWPORT");const qo=Qe&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Zo;Zo=Qe?Fe.iconsInText?gs(Oe.kind,ot,te,H,c,Lr,Ui,Rr,wt,Tt,we,nr,ae,Go,qi,Fe.getProjection()):Yc(Oe.kind,ot,te,H,c,Lr,Ui,Rr,m,wt,!0,we,nr,ae,Go,qi,Fe.getProjection()):Kc(Oe.kind,ot,te,H,c,Lr,Ui,Rr,m,wt,we,nr,ae,Go,qi,Fe.getProjection());const Wo={program:c.useProgram(Vh(Qe,m,Fe),ze,$r),buffers:it,uniformValues:Zo,atlasTexture:Mt,atlasTextureIcon:qt,atlasInterpolation:Nt,atlasInterpolationIcon:oi,isSDF:Qe,hasHalo:qo,tile:Le,labelPlaneMatrixInv:Qn};if(Y&&Fe.canOverlap){fe=!0;const Gr=it.segments.get();for(const Xo of Gr)xe.push({segments:new o.SegmentVector([Xo]),sortKey:Xo.sortKey,state:Wo})}else xe.push({segments:it.segments,sortKey:0,state:Wo})}fe&&xe.sort((we,Le)=>we.sortKey-Le.sortKey);for(const we of xe){const Le=we.state;if(c.terrain&&c.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:!he,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),G.activeTexture.set(K.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,K.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(G.activeTexture.set(K.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Le.isSDF){const Fe=Le.uniformValues;Le.hasHalo&&(Fe.u_is_halo=1,tu(Le.buffers,we.segments,s,c,Le.program,de,D,U,Fe)),Fe.u_is_halo=0}tu(Le.buffers,we.segments,s,c,Le.program,de,D,U,Le.uniformValues)}}function tu(c,r,s,h,m,y,w,E,A){const P=h.context,D=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];m.draw(P,P.gl.TRIANGLES,y,w,E,o.CullFaceMode.disabled,A,s.id,c.layoutVertexBuffer,c.indexBuffer,r,s.paint,h.transform.zoom,c.programConfigurations.get(s.id),D)}function Al(c,r,s,h,m,y,w){const E=c.context.gl,A=s.paint.get("fill-pattern"),P=A&&A.constantOr(1),D=s.getCrossfadeParameters();let U,G,K,W,X;w?(G=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=E.LINES):(G=P?"fillPattern":"fill",U=E.TRIANGLES);for(const H of h){const Z=r.getTile(H);if(P&&!Z.patternsLoaded())continue;const te=Z.getBucket(s);if(!te)continue;c.prepareDrawTile();const Y=te.programConfigurations.get(s.id),fe=c.useProgram(G,Y);P&&(c.context.activeTexture.set(E.TEXTURE0),Z.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers(D));const de=A.constantOr(null);if(de&&Z.imageAtlas){const pe=Z.imageAtlas,he=pe.patternPositions[de.to.toString()],xe=pe.patternPositions[de.from.toString()];he&&xe&&Y.setConstantPatternPositions(he,xe)}const ae=c.translatePosMatrix(H.projMatrix,Z,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(w){W=te.indexBuffer2,X=te.segments2;const pe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];K=G==="fillOutlinePattern"&&P?Zc(ae,c,D,Z,pe):jn(ae,pe)}else W=te.indexBuffer,X=te.segments,K=P?vl(ae,c,D,Z):_a(ae);c.prepareDrawProgram(c.context,fe,H.toUnwrapped()),fe.draw(c.context,U,m,c.stencilModeForClipping(H),y,o.CullFaceMode.disabled,K,s.id,te.layoutVertexBuffer,W,X,s.paint,c.transform.zoom,Y)}}function Kn(c,r,s,h,m,y,w){const E=c.context,A=E.gl,P=c.transform,D=s.paint.get("fill-extrusion-pattern"),U=D.constantOr(1),G=s.getCrossfadeParameters(),K=s.paint.get("fill-extrusion-opacity"),W=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],X=s.layout.get("fill-extrusion-edge-radius"),H=P.projection.name==="globe"?o.fillExtrusionHeightLift():0,Z=P.projection.name==="globe",te=Z?o.globeToMercatorTransition(P.zoom):0,Y=[o.mercatorXfromLng(P.center.lng),o.mercatorYfromLat(P.center.lat)],fe=[];Z&&(fe.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&fe.push("TERRAIN")),W[0]>0&&fe.push("FAUX_AO");for(const de of h){const ae=r.getTile(de),pe=ae.getBucket(s);if(!pe||pe.projection.name!==P.projection.name)continue;const he=pe.programConfigurations.get(s.id),xe=c.useProgram(U?"fillExtrusionPattern":"fillExtrusion",he,fe);if(c.terrain){const ze=c.terrain;if(c.style.terrainSetForDrapingOnly())ze.setupElevationDraw(ae,xe,{useMeterToDem:!0});else{if(!pe.enableTerrain)continue;if(ze.setupElevationDraw(ae,xe,{useMeterToDem:!0}),ga(E,r,de,pe,s,ze),!pe.centroidVertexBuffer){const Qe=xe.attributes.a_centroid_pos;Qe!==void 0&&A.vertexAttrib2f(Qe,0,0)}}}U&&(c.context.activeTexture.set(A.TEXTURE0),ae.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),he.updatePaintBuffers(G));const Se=D.constantOr(null);if(Se&&ae.imageAtlas){const ze=ae.imageAtlas,Qe=ze.patternPositions[Se.to.toString()],Oe=ze.patternPositions[Se.from.toString()];Qe&&Oe&&he.setConstantPatternPositions(Qe,Oe)}const Ye=c.translatePosMatrix(de.projMatrix,ae,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),we=P.projection.createInversionMatrix(P,de.canonical),Le=s.paint.get("fill-extrusion-vertical-gradient"),Fe=U?Lh(Ye,c,Le,K,W,X,de,G,ae,H,te,Y,we):_s(Ye,c,Le,K,W,X,de,H,te,Y,we);c.prepareDrawProgram(E,xe,de.toUnwrapped());const it=[];c.terrain&&it.push(pe.centroidVertexBuffer),Z&&it.push(pe.layoutVertexExtBuffer),xe.draw(E,E.gl.TRIANGLES,m,y,w,o.CullFaceMode.backCCW,Fe,s.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,s.paint,c.transform.zoom,he,it)}}function ga(c,r,s,h,m,y){const w=[Z=>{let te=Z.canonical.x-1,Y=Z.wrap;return te<0&&(te=(1<<Z.canonical.z)-1,Y--),new o.OverscaledTileID(Z.overscaledZ,Y,Z.canonical.z,te,Z.canonical.y)},Z=>{let te=Z.canonical.x+1,Y=Z.wrap;return te===1<<Z.canonical.z&&(te=0,Y++),new o.OverscaledTileID(Z.overscaledZ,Y,Z.canonical.z,te,Z.canonical.y)},Z=>new o.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(Z.canonical.y===0?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new o.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],E=Z=>{const te=r.getSource().minzoom,Y=de=>{const ae=r.getTileByID(de);if(ae&&ae.hasData())return ae.getBucket(m)},fe=[0,-1,1];for(const de of fe){if(Z.overscaledZ+de<te)continue;const ae=Y(Z.calculateScaledKey(Z.overscaledZ+de));if(ae)return ae}},A=[0,0,0],P=(Z,te)=>(A[0]=Math.min(Z.min.y,te.min.y),A[1]=Math.max(Z.max.y,te.max.y),A[2]=o.EXTENT-te.min.x>Z.max.x?te.min.x-o.EXTENT:Z.max.x,A),D=(Z,te)=>(A[0]=Math.min(Z.min.x,te.min.x),A[1]=Math.max(Z.max.x,te.max.x),A[2]=o.EXTENT-te.min.y>Z.max.y?te.min.y-o.EXTENT:Z.max.y,A),U=[(Z,te)=>P(Z,te),(Z,te)=>P(te,Z),(Z,te)=>D(Z,te),(Z,te)=>D(te,Z)],G=new o.pointGeometry(0,0);let K,W,X;const H=(Z,te,Y,fe,de)=>{const ae=[[fe?Y:Z,fe?Z:Y,0],[fe?Y:te,fe?te:Y,0]],pe=de<0?o.EXTENT+de:de,he=[fe?pe:(Z+te)/2,fe?(Z+te)/2:pe,0];return Y===0&&de<0||Y!==0&&de>0?y.getForTilePoints(X,[he],!0,W):ae.push(he),y.getForTilePoints(s,ae,!0,K),Math.max(ae[0][2],ae[1][2],he[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){const te=(Z<2?1:5)-Z,Y=h.borders[Z];if(Y.length===0)continue;const fe=X=w[Z](s),de=E(fe);if(!(de&&de instanceof o.FillExtrusionBucket&&de.enableTerrain)||h.borderDoneWithNeighborZ[Z]===de.canonical.z&&de.borderDoneWithNeighborZ[te]===h.canonical.z||(W=y.findDEMTileFor(fe),!W||!W.dem))continue;if(!K){const xe=y.findDEMTileFor(s);if(!xe||!xe.dem)return;K=xe}const ae=de.borders[te];let pe=0;const he=de.borderDoneWithNeighborZ[te]!==h.canonical.z;if(h.canonical.z===de.canonical.z){for(let xe=0;xe<Y.length;xe++){const Se=h.featuresOnBorder[Y[xe]],Ye=Se.borders[Z];let we;for(;pe<ae.length&&(we=de.featuresOnBorder[ae[pe]],!(we.borders[te][1]>Ye[0]+3));)he&&de.encodeCentroid(void 0,we,!1),pe++;if(we&&pe<ae.length){const Le=pe;let Fe=0;for(;!(we.borders[te][0]>Ye[1]-3)&&(Fe++,++pe!==ae.length);)we=de.featuresOnBorder[ae[pe]];if(we=de.featuresOnBorder[ae[Le]],Se.intersectsCount()>1||we.intersectsCount()>1||Fe!==1){Fe!==1&&(pe=Le),h.encodeCentroid(void 0,Se,!1),he&&de.encodeCentroid(void 0,we,!1);continue}const it=U[Z](Se,we),ze=Z%2?o.EXTENT-1:0;G.x=H(it[0],Math.min(o.EXTENT-1,it[1]),ze,Z<2,it[2]),G.y=0,h.encodeCentroid(G,Se,!1),he&&de.encodeCentroid(G,we,!1)}else h.encodeCentroid(void 0,Se,!1)}h.borderDoneWithNeighborZ[Z]=de.canonical.z,h.needsCentroidUpdate=!0,he&&(de.borderDoneWithNeighborZ[te]=h.canonical.z,de.needsCentroidUpdate=!0)}else{for(const xe of Y)h.encodeCentroid(void 0,h.featuresOnBorder[xe],!1);if(he){for(const xe of ae)de.encodeCentroid(void 0,de.featuresOnBorder[xe],!1);de.borderDoneWithNeighborZ[te]=h.canonical.z,de.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[Z]=de.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(c)}const $h=new o.Color(1,0,0,1),ys=new o.Color(0,1,0,1),xs=new o.Color(0,0,1,1),Gh=new o.Color(1,0,1,1),iu=new o.Color(0,1,1,1);function wi(c,r,s){const h=c.context,m=c.transform,y=h.gl,w=m.projection.name==="globe",E=w?["PROJECTION_GLOBE_VIEW"]:null;let A=s.projMatrix;if(w&&o.globeToMercatorTransition(m.zoom)>0){const Se=o.transitionTileAABBinECEF(s.canonical,m),Ye=o.globeDenormalizeECEF(Se);A=o.multiply(new Float32Array(16),m.globeMatrix,Ye),o.multiply(A,m.projMatrix,A)}const P=c.useProgram("debug",null,E),D=r.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(D,P);const U=o.DepthMode.disabled,G=o.StencilMode.disabled,K=c.colorModeForRenderPass(),W="$debug";h.activeTexture.set(y.TEXTURE0),c.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),w?D._makeGlobeTileDebugBuffers(c.context,m):D._makeDebugTileBoundsBuffers(c.context,m.projection);const X=D._tileDebugBuffer||c.debugBuffer,H=D._tileDebugIndexBuffer||c.debugIndexBuffer,Z=D._tileDebugSegments||c.debugSegments;P.draw(h,y.LINE_STRIP,U,G,K,o.CullFaceMode.disabled,Oh(A,o.Color.red),W,X,H,Z,null,null,null,[D._globeTileDebugBorderBuffer]);const te=D.latestRawTileData,Y=Math.floor((te&&te.byteLength||0)/1024),fe=r.getTile(s).tileSize,de=512/Math.min(fe,512)*(s.overscaledZ/m.zoom)*.5;let ae=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ae+=` => ${s.overscaledZ}`),ae+=` ${Y}kb`,function(Se,Ye){Se.initDebugOverlayCanvas();const we=Se.debugOverlayCanvas,Le=Se.context.gl,Fe=Se.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,we.width,we.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(Ye,5,5),Fe.strokeText(Ye,5,5),Se.debugOverlayTexture.update(we),Se.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(c,ae);const pe=D._tileDebugTextBuffer||c.debugBuffer,he=D._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,xe=D._tileDebugTextSegments||c.debugSegments;P.draw(h,y.TRIANGLES,U,G,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Oh(A,o.Color.transparent,de),W,pe,he,xe,null,null,null,[D._globeTileDebugTextBuffer])}function ya(c,r,s,h){xa(c,0,r+s/2,c.transform.width,s,h)}function qh(c,r,s,h){xa(c,r-s/2,0,s,c.transform.height,h)}function xa(c,r,s,h,m,y){const w=c.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,h*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),w.clear({color:y}),E.disable(E.SCISSOR_TEST)}const va=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:lf}=va;function wo(c,r,s,h){c.emplaceBack(r,s,h)}class ru{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,wo(this.vertexArray,-1,-1,1),wo(this.vertexArray,1,-1,1),wo(this.vertexArray,-1,1,1),wo(this.vertexArray,1,1,1),wo(this.vertexArray,-1,-1,-1),wo(this.vertexArray,1,-1,-1),wo(this.vertexArray,-1,1,-1),wo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,lf),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function vs(c,r,s,h,m,y){const w=c.gl,E=r.paint.get("sky-atmosphere-color"),A=r.paint.get("sky-atmosphere-halo-color"),P=r.paint.get("sky-atmosphere-sun-intensity"),D=((U,G,K,W,X)=>({u_matrix_3f:U,u_sun_direction:G,u_sun_intensity:K,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),h),m,P,E,A);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),s.draw(c,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,D,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const nu=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Il{constructor(r){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new o.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,nu.members),this.indexBuffer=r.createIndexBuffer(h),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const bs={symbol:function(c,r,s,h,m){if(c.renderPass!=="translucent")return;const y=o.StencilMode.disabled,w=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(E,A,P,D,U,G,K){const W=A.transform,X=U==="map",H=G==="map";for(const Z of E){const te=D.getTile(Z),Y=te.getBucket(P);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const fe=o.evaluateSizeForZoom(Y.textSizeData,W.zoom),de=Kr(Z,Y.getProjection(),W),ae=W.calculatePixelsToTileUnitsMatrix(te),pe=ti(de,te.tileID.canonical,H,X,W,Y.getProjection(),ae),he=P.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(fe){const xe=Math.pow(2,W.zoom-te.tileID.overscaledZ);Qc(Y,X,H,K,o.symbolSize,W,pe,Z,xe,fe,he)}}}(h,c,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&eu(c,r,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),y,w),s.paint.get("text-opacity").constantOr(1)!==0&&eu(c,r,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),y,w),r.map.showCollisionBoxes&&(jh(c,r,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),jh(c,r,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,r,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),w=s.paint.get("circle-stroke-opacity"),E=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const A=c.context,P=A.gl,D=c.transform,U=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),G=o.StencilMode.disabled,K=c.colorModeForRenderPass(),W=D.projection.name==="globe",X=[o.mercatorXfromLng(D.center.lng),o.mercatorYfromLat(D.center.lat)],H=[];for(let te=0;te<h.length;te++){const Y=h[te],fe=r.getTile(Y),de=fe.getBucket(s);if(!de||de.projection.name!==D.projection.name)continue;const ae=de.programConfigurations.get(s.id),pe=Bh(s);W&&pe.push("PROJECTION_GLOBE_VIEW");const he=c.useProgram("circle",ae,pe),xe=de.layoutVertexBuffer,Se=de.globeExtVertexBuffer,Ye=de.indexBuffer,we=D.projection.createInversionMatrix(D,Y.canonical),Le={programConfiguration:ae,program:he,layoutVertexBuffer:xe,globeExtVertexBuffer:Se,indexBuffer:Ye,uniformValues:Wc(c,Y,fe,we,X,s),tile:fe};if(E){const Fe=de.segments.get();for(const it of Fe)H.push({segments:new o.SegmentVector([it]),sortKey:it.sortKey,state:Le})}else H.push({segments:de.segments,sortKey:0,state:Le})}E&&H.sort((te,Y)=>te.sortKey-Y.sortKey);const Z={useDepthForOcclusion:!W};for(const te of H){const{programConfiguration:Y,program:fe,layoutVertexBuffer:de,globeExtVertexBuffer:ae,indexBuffer:pe,uniformValues:he,tile:xe}=te.state,Se=te.segments;c.terrain&&c.terrain.setupElevationDraw(xe,fe,Z),c.prepareDrawProgram(A,fe,xe.tileID.toUnwrapped()),fe.draw(A,P.TRIANGLES,U,G,K,o.CullFaceMode.disabled,he,s.id,de,pe,Se,s.paint,D.zoom,Y,[ae])}},heatmap:function(c,r,s,h){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const m=c.context,y=m.gl,w=o.StencilMode.disabled,E=new o.ColorMode([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(K,W,X,H){const Z=K.gl,te=W.width*H,Y=W.height*H;K.activeTexture.set(Z.TEXTURE1),K.viewport.set([0,0,te,Y]);let fe=X.heatmapFbo;if(!fe||fe&&(fe.width!==te||fe.height!==Y)){fe&&fe.destroy();const de=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,de),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),fe=X.heatmapFbo=K.createFramebuffer(te,Y,!1),function(ae,pe,he,xe,Se,Ye){const we=ae.gl;we.texImage2D(we.TEXTURE_2D,0,we.RGBA,Se,Ye,0,we.RGBA,ae.extRenderToTextureHalfFloat?ae.extTextureHalfFloat.HALF_FLOAT_OES:we.UNSIGNED_BYTE,null),xe.colorAttachment.set(he)}(K,0,de,fe,te,Y)}else Z.bindTexture(Z.TEXTURE_2D,fe.colorAttachment.get()),K.bindFramebuffer.set(fe.framebuffer)})(m,c,s,c.transform.projection.name==="globe"?.5:.25),m.clear({color:o.Color.transparent});const A=c.transform,P=A.projection.name==="globe",D=P?["PROJECTION_GLOBE_VIEW"]:null,U=P?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,G=[o.mercatorXfromLng(A.center.lng),o.mercatorYfromLat(A.center.lat)];for(let K=0;K<h.length;K++){const W=h[K];if(r.hasRenderableParent(W))continue;const X=r.getTile(W),H=X.getBucket(s);if(!H||H.projection.name!==A.projection.name)continue;const Z=H.programConfigurations.get(s.id),te=c.useProgram("heatmap",Z,D),{zoom:Y}=c.transform;c.terrain&&c.terrain.setupElevationDraw(X,te),c.prepareDrawProgram(m,te,W.toUnwrapped());const fe=A.projection.createInversionMatrix(A,W.canonical);te.draw(m,y.TRIANGLES,o.DepthMode.disabled,w,E,U,tf(c,W,X,fe,G,Y,s.paint.get("heatmap-intensity")),s.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,s.paint,c.transform.zoom,Z,P?[H.globeExtVertexBuffer]:null)}m.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(m,y){const w=m.context,E=w.gl,A=y.heatmapFbo;if(!A)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let P=y.colorRampTexture;P||(P=y.colorRampTexture=new o.Texture(w,y.colorRamp,E.RGBA)),P.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(w,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((D,U,G,K)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(c,s))},line:function(c,r,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const w=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=c.colorModeForRenderPass(),A=c.terrain&&c.terrain.renderingToTexture?1:o.exported.devicePixelRatio,P=s.paint.get("line-dasharray"),D=P.constantOr(1),U=s.layout.get("line-cap"),G=s.paint.get("line-pattern"),K=G.constantOr(1),W=s.paint.get("line-gradient"),X=s.getCrossfadeParameters(),H=K?"linePattern":"line",Z=c.context,te=Z.gl,Y=(de=>{const ae=[];Tl(de)&&ae.push("RENDER_LINE_DASH"),de.paint.get("line-gradient")&&ae.push("RENDER_LINE_GRADIENT");const pe=de.paint.get("line-trim-offset");pe[0]===0&&pe[1]===0||ae.push("RENDER_LINE_TRIM_OFFSET");const he=de.paint.get("line-pattern").constantOr(1),xe=de.paint.get("line-opacity").constantOr(1)!==1;return!he&&xe&&ae.push("RENDER_LINE_ALPHA_DISCARD"),ae})(s);let fe=Y.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const de of h){const ae=r.getTile(de);if(K&&!ae.patternsLoaded())continue;const pe=ae.getBucket(s);if(!pe)continue;c.prepareDrawTile();const he=pe.programConfigurations.get(s.id),xe=c.useProgram(H,he,Y),Se=G.constantOr(null);if(Se&&ae.imageAtlas){const Oe=ae.imageAtlas,at=Oe.patternPositions[Se.to.toString()],ot=Oe.patternPositions[Se.from.toString()];at&&ot&&he.setConstantPatternPositions(at,ot)}const Ye=P.constantOr(null),we=U.constantOr(null);if(!K&&Ye&&we&&ae.lineAtlas){const Oe=ae.lineAtlas,at=Oe.getDash(Ye.to,we),ot=Oe.getDash(Ye.from,we);at&&ot&&he.setConstantPatternPositions(at,ot)}let[Le,Fe]=s.paint.get("line-trim-offset");(we==="round"||we==="square")&&Le!==Fe&&(Le===0&&(Le-=1),Fe===1&&(Fe+=1));const it=c.terrain?de.projMatrix:null,ze=K?rf(c,ae,s,X,it,A):bl(c,ae,s,X,it,pe.lineClipsArray.length,A,[Le,Fe]);if(W){const Oe=pe.gradients[s.id];let at=Oe.texture;if(s.gradientVersion!==Oe.version){let ot=256;if(s.stepInterpolant){const wt=r.getSource().maxzoom,Mt=de.canonical.z===wt?Math.ceil(1<<c.transform.maxZoom-de.canonical.z):1;ot=o.clamp(o.nextPowerOfTwo(pe.maxLineLength/o.EXTENT*1024*Mt),256,Z.maxTextureSize)}Oe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ot,image:Oe.gradient||void 0,clips:pe.lineClipsArray}),Oe.texture?Oe.texture.update(Oe.gradient):Oe.texture=new o.Texture(Z,Oe.gradient,te.RGBA),Oe.version=s.gradientVersion,at=Oe.texture}Z.activeTexture.set(te.TEXTURE1),at.bind(s.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}D&&(Z.activeTexture.set(te.TEXTURE0),ae.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),he.updatePaintBuffers(X)),K&&(Z.activeTexture.set(te.TEXTURE0),ae.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),he.updatePaintBuffers(X)),c.prepareDrawProgram(Z,xe,de.toUnwrapped());const Qe=Oe=>{xe.draw(Z,te.TRIANGLES,w,Oe,E,o.CullFaceMode.disabled,ze,s.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,s.paint,c.transform.zoom,he,[pe.layoutVertexBuffer2])};if(fe){const Oe=c.stencilModeForClipping(de).ref;Oe===0&&c.terrain&&Z.clear({stencil:0});const at={func:te.EQUAL,mask:255};ze.u_alpha_discard_threshold=.8,Qe(new o.StencilMode(at,Oe,255,te.KEEP,te.KEEP,te.INVERT)),ze.u_alpha_discard_threshold=0,Qe(new o.StencilMode(at,Oe,255,te.KEEP,te.KEEP,te.KEEP))}else Qe(c.stencilModeForClipping(de))}fe&&(c.resetStencilClippingMasks(),c.terrain&&Z.clear({stencil:0}))},fill:function(c,r,s,h){const m=s.paint.get("fill-color"),y=s.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=c.colorModeForRenderPass(),E=s.paint.get("fill-pattern"),A=c.opaquePassEnabledForLayer()&&!E.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===A){const P=c.depthModeForSublayer(1,c.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Al(c,r,s,h,P,w,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const P=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Al(c,r,s,h,P,w,!0)}},"fill-extrusion":function(c,r,s,h){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&c.renderPass==="translucent"){const y=new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Kn(c,r,s,h,y,o.StencilMode.disabled,o.ColorMode.disabled),Kn(c,r,s,h,y,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const w=c.colorModeForRenderPass();Kn(c,r,s,h,y,o.StencilMode.disabled,w)}}},hillshade:function(c,r,s,h){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const m=c.context,y=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),w=c.colorModeForRenderPass(),E=c.terrain&&c.terrain.renderingToTexture,[A,P]=c.renderPass!=="translucent"||E?[{},h]:c.stencilConfigForOverlap(h);for(const D of P){const U=r.getTile(D);if(U.needsHillshadePrepare&&c.renderPass==="offscreen")ms(c,U,s,y,o.StencilMode.disabled,w);else if(c.renderPass==="translucent"){const G=E&&c.terrain?c.terrain.stencilModeForRTTOverlap(D):A[D.overscaledZ];Fc(c,D,U,s,y,G,w)}}m.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,r,s,h,m,y){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const w=c.context,E=w.gl,A=r.getSource(),P=c.useProgram("raster"),D=c.colorModeForRenderPass(),U=c.terrain&&c.terrain.renderingToTexture,[G,K]=A instanceof be||U?[{},h]:c.stencilConfigForOverlap(h),W=K[K.length-1].overscaledZ,X=!c.options.moving;for(const H of K){const Z=U?o.DepthMode.disabled:c.depthModeForSublayer(H.overscaledZ-W,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),te=H.toUnwrapped(),Y=r.getTile(H);if(U&&(!Y||!Y.hasData()))continue;const fe=U?H.projMatrix:c.transform.calculateProjMatrix(te,X),de=c.terrain&&U?c.terrain.stencilModeForRTTOverlap(H):G[H.overscaledZ],ae=y?0:s.paint.get("raster-fade-duration");Y.registerFadeDuration(ae);const pe=r.findLoadedParent(H,0),he=yl(Y,pe,r,c.transform,ae);let xe,Se;c.terrain&&c.terrain.prepareDrawTile();const Ye=s.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;w.activeTexture.set(E.TEXTURE0),Y.texture.bind(Ye,E.CLAMP_TO_EDGE),w.activeTexture.set(E.TEXTURE1),pe?(pe.texture.bind(Ye,E.CLAMP_TO_EDGE),xe=Math.pow(2,pe.tileID.overscaledZ-Y.tileID.overscaledZ),Se=[Y.tileID.canonical.x*xe%1,Y.tileID.canonical.y*xe%1]):Y.texture.bind(Ye,E.CLAMP_TO_EDGE);const we=nf(fe,Se||[0,0],xe||1,he,s,A instanceof be?A.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(w,P,te),A instanceof be)A.boundsBuffer&&A.boundsSegments&&P.draw(w,E.TRIANGLES,Z,o.StencilMode.disabled,D,o.CullFaceMode.disabled,we,s.id,A.boundsBuffer,c.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:Fe,tileBoundsSegments:it}=c.getTileBoundsBuffers(Y);P.draw(w,E.TRIANGLES,Z,de,D,o.CullFaceMode.disabled,we,s.id,Le,Fe,it)}}c.resetStencilClippingMasks()},background:function(c,r,s,h){const m=s.paint.get("background-color"),y=s.paint.get("background-opacity");if(y===0)return;const w=c.context,E=w.gl,A=c.transform,P=A.tileSize,D=s.paint.get("background-pattern");if(c.isPatternMissing(D))return;const U=!D&&m.a===1&&y===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==U)return;const G=o.StencilMode.disabled,K=c.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),W=c.colorModeForRenderPass(),X=c.useProgram(D?"backgroundPattern":"background");let H,Z=h;Z||(H=c.getBackgroundTiles(),Z=Object.values(H).map(Y=>Y.tileID)),D&&(w.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context));const te=s.getCrossfadeParameters();for(const Y of Z){const fe=Y.toUnwrapped(),de=h?Y.projMatrix:c.transform.calculateProjMatrix(fe);c.prepareDrawTile();const ae=r?r.getTile(Y):H?H[Y.key]:new o.Tile(Y,P,A.zoom,c),pe=D?sf(de,y,c,D,{tileID:Y,tileSize:P},te):of(de,y,m);c.prepareDrawProgram(w,X,fe);const{tileBoundsBuffer:he,tileBoundsIndexBuffer:xe,tileBoundsSegments:Se}=c.getTileBoundsBuffers(ae);X.draw(w,E.TRIANGLES,K,G,W,o.CullFaceMode.disabled,pe,s.id,he,xe,Se)}},sky:function(c,r,s){const h=c.transform,m=h.projection.name==="mercator"||h.projection.name==="globe"?1:o.smoothstep(7,8,h.zoom),y=s.paint.get("sky-opacity")*m;if(y===0)return;const w=c.context,E=s.paint.get("sky-type"),A=new o.DepthMode(w.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),P=c.frameCounter/1e3%1;E==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(D,U,G,K){const W=D.context,X=W.gl;let H=U.skyboxFbo;if(!H){H=U.skyboxFbo=W.createFramebuffer(32,32,!1),U.skyboxGeometry=new ru(W),U.skyboxTexture=W.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,U.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let fe=0;fe<6;++fe)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(H.framebuffer),W.viewport.set([0,0,32,32]);const Z=U.getCenter(D,!0),te=D.useProgram("skyboxCapture"),Y=new Float64Array(16);o.identity(Y),o.rotateY(Y,Y,.5*-Math.PI),vs(W,U,te,Y,Z,0),o.identity(Y),o.rotateY(Y,Y,.5*Math.PI),vs(W,U,te,Y,Z,1),o.identity(Y),o.rotateX(Y,Y,.5*-Math.PI),vs(W,U,te,Y,Z,2),o.identity(Y),o.rotateX(Y,Y,.5*Math.PI),vs(W,U,te,Y,Z,3),o.identity(Y),vs(W,U,te,Y,Z,4),o.identity(Y),o.rotateY(Y,Y,Math.PI),vs(W,U,te,Y,Z,5),W.viewport.set([0,0,D.width,D.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(D,U,G,K,W){const X=D.context,H=X.gl,Z=D.transform,te=D.useProgram("skybox");X.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,U.skyboxTexture);const Y=((fe,de,ae,pe,he)=>({u_matrix:fe,u_sun_direction:de,u_cubemap:0,u_opacity:pe,u_temporal_offset:he}))(Z.skyboxMatrix,U.getCenter(D,!1),0,K,W);D.prepareDrawProgram(X,te),te.draw(X,H.TRIANGLES,G,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,Y,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,s,A,y,P):E==="gradient"&&c.renderPass==="sky"&&function(D,U,G,K,W){const X=D.context,H=X.gl,Z=D.transform,te=D.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new ru(X)),X.activeTexture.set(H.TEXTURE0);let Y=U.colorRampTexture;Y||(Y=U.colorRampTexture=new o.Texture(X,U.colorRamp,H.RGBA)),Y.bind(H.LINEAR,H.CLAMP_TO_EDGE);const fe=((de,ae,pe,he,xe)=>({u_matrix:de,u_color_ramp:0,u_center_direction:ae,u_radius:o.degToRad(pe),u_opacity:he,u_temporal_offset:xe}))(Z.skyboxMatrix,U.getCenter(D,!1),U.paint.get("sky-gradient-radius"),K,W);D.prepareDrawProgram(X,te),te.draw(X,H.TRIANGLES,G,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,fe,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,s,A,y,P)},debug:function(c,r,s){for(let h=0;h<s.length;h++)wi(c,r,s[h])},custom:function(c,r,s){const h=c.context,m=s.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const y=m.prerender;y&&(c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),y.call(m,h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),h.setStencilMode(o.StencilMode.disabled);const y=m.renderingMode==="3d"?new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,o.DepthMode.ReadOnly);h.setDepthMode(y),m.render(h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState(),h.bindFramebuffer.set(null)}}};class ou{constructor(r,s){this.context=new J(r),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,s){const h=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kh(this,r));const m=this._terrain;this.transform.elevation=h?m:null,m.update(r,this.transform,s)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const y=h+.78*(m-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,s){if(this.width=r*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const r=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const h=new o.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(o.EXTENT,0),h.emplaceBack(0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(h,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(o.EXTENT,0,o.EXTENT,0),y.emplaceBack(0,o.EXTENT,0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(y,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);const E=new o.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])E.emplaceBack(P);this.debugIndexBuffer=r.createIndexBuffer(E),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const A=this.context.gl;this.stencilClearMode=new o.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Il(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,s=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Vc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,h){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const A of h)if(this._tileClippingMaskIDs[A.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=s.id;const m=this.context,y=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const A=s.getTile(E),P=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=this.getTileBoundsBuffers(A);w.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},P,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Vc(E.projMatrix),"$clipping",D,U,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,h=r.sort((w,E)=>E.overscaledZ-w.overscaledZ),m=h[h.length-1].overscaledZ,y=h[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let E=0;E<y;E++)w[E+m]=new o.StencilMode({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[w,h]}return[{[m]:o.StencilMode.disabled},h]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,s,h){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(h||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,s){this.style=r,this.options=s,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const A in m){const P=m[A];P.used&&P.prepare(this.context)}const y={},w={},E={};for(const A in m){const P=m[A];y[A]=P.getVisibleCoordinates(),w[A]=y[A].slice().reverse(),E[A]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<h.length;A++)if(this.style._layers[h[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const A of h){const P=this.style._layers[A],D=r._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const U=D?w[D.id]:void 0;(P.type==="custom"||P.isSky()||U&&U.length)&&this.renderLayer(this,D,P,U)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[h[this.currentLayer]],P=r._getLayerSourceCache(A);if(A.isSky())continue;const D=P?w[P.id]:void 0;this._renderTileClippingMasks(A,P,D),this.renderLayer(this,P,A,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,P){const D=A.context,U=D.gl,G=A.transform,K=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),W=A.useProgram("globeAtmosphere",null,G.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),X=o.globeToMercatorTransition(G.zoom),H=P.properties.get("color").toArray01(),Z=P.properties.get("high-color").toArray01(),te=P.properties.get("space-color").toArray01PremultipliedAlpha(),Y=o.identity$1([]);o.rotateY$1(Y,Y,-o.degToRad(G._center.lng)),o.rotateX$1(Y,Y,o.degToRad(G._center.lat)),o.rotateZ$1(Y,Y,G.angle),o.rotateX$1(Y,Y,-G._pitch);const fe=o.fromQuat(new Float32Array(16),Y),de=o.mapValue(P.properties.get("star-intensity"),0,1,0,.25),ae=5e-4,pe=o.mapValue(P.properties.get("horizon-blend"),0,1,ae,.25),he=o.globeUseCustomAntiAliasing(A,D,G)&&pe===ae?G.worldSize/(2*Math.PI*1.025)-1:G.globeRadius,xe=A.frameCounter/1e3%1,Se=o.length(G.globeCenterInViewSpace),Ye=Math.sqrt(Math.pow(Se,2)-Math.pow(he,2)),we=Math.acos(Ye/Se),Le=((it,ze,Qe,Oe,at,ot,wt,Mt,Nt,oi,Tt,qt,_i,qi)=>({u_frustum_tl:it,u_frustum_tr:ze,u_frustum_br:Qe,u_frustum_bl:Oe,u_horizon:at,u_transition:ot,u_fadeout_range:wt,u_color:Mt,u_high_color:Nt,u_space_color:oi,u_star_intensity:Tt,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:qt,u_horizon_angle:_i,u_rotation_matrix:qi}))(G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.frustumCorners.horizon,X,pe,H,Z,te,de,xe,we,fe);A.prepareDrawProgram(D,W);const Fe=A.atmosphereBuffer;Fe&&W.draw(D,U.TRIANGLES,K,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Le,"skybox",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const A=this.style._layers[h[this.currentLayer]],P=r._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,P,A,P?w[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const A=this.style._layers[h[this.currentLayer]],P=r._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=P?(A.type==="symbol"?E:w)[P.id]:void 0;this._renderTileClippingMasks(A,P,P?y[P.id]:void 0),this.renderLayer(this,P,A,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;o.values(this.style._layers).forEach(P=>{const D=r._getLayerSourceCache(P);D&&!P.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<D.getSource().maxzoom)&&(A=D)}),A&&this.options.showTileBoundaries&&bs.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const P=A.transform.padding;ya(A,A.transform.height-(P.top||0),3,$h),ya(A,P.bottom||0,3,ys),qh(A,P.left||0,3,xs),qh(A,A.transform.width-(P.right||0),3,Gh);const D=A.transform.centerPoint;(function(U,G,K,W){xa(U,G-1,K-10,2,20,W),xa(U,G-10,K-1,20,2,W)})(A,D.x,A.transform.height-D.y,iu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(h.type)||bs[h.type](r,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[r.id];h||(h=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),r.beginQueryEXT(r.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const h in r){const m=r[h],y=this.context.extTimerQuery,w=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),s[h]=w}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let h=0;for(const m of r)h+=s.getQueryObjectEXT(m,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(m);return h}translatePosMatrix(r,s,h,m,y){if(!h[0]&&!h[1])return r;const w=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const P=Math.sin(w),D=Math.cos(w);h=[h[0]*D-h[1]*P,h[0]*P+h[1]*D]}const E=[y?h[0]:rn(s,h[0],this.transform.zoom),y?h[1]:rn(s,h[1],this.transform.zoom),0],A=new Float32Array(16);return o.translate(A,r,E),A}saveTileTexture(r){const s=this._tileTextures[r.size[0]];s?s.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const s=this.imageManager.getPattern(r.from.toString()),h=this.imageManager.getPattern(r.to.toString());return!s||!h}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),s&&!r&&s.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),r&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(r,s,h){this.cache=this.cache||{};const m=h||[],y=this.currentGlobalDefines().concat(m),w=qc.cacheKey(_l[r],r,y,s);return this.cache[w]||(this.cache[w]=new qc(this.context,r,_l[r],s,af[r],y)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const y=m.getOpacity(this.transform.pitch),w=((E,A,P,D,U,G,K,W,X,H,Z)=>{const te=E.transform,Y=A.properties.get("color").toArray01();Y[3]=D;const fe=E.frameCounter/1e3%1;return{u_fog_matrix:P?te.calculateFogTileMatrix(P):E.identityMat,u_fog_range:A.getFovAdjustedRange(te._fov),u_fog_color:Y,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:fe,u_frustum_tl:U,u_frustum_tr:G,u_frustum_br:K,u_frustum_bl:W,u_globe_pos:X,u_globe_radius:H,u_viewport:Z,u_globe_transition:o.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,m,h,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(r,w)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=r[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class ba{constructor(r=0,s=0,h=0,m=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=h,this.right=m}interpolate(r,s,h){return s.top!=null&&r.top!=null&&(this.top=o.number(r.top,s.top,h)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,s.bottom,h)),s.left!=null&&r.left!=null&&(this.left=o.number(r.left,s.left,h)),s.right!=null&&r.right!=null&&(this.right=o.number(r.right,s.right,h)),this}getCenter(r,s){const h=o.clamp((this.left+r-this.right)/2,0,r),m=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(h,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ba(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function su(c,r){const s=o.getColumn(c,3);o.fromQuat(c,r),o.setColumn(c,3,s)}function ws(c,r){const s=o.identity$1([]);return o.rotateZ$1(s,s,-r),o.rotateX$1(s,s,-c),s}function Ts(c,r){const s=[c[0],c[1],0],h=[r[0],r[1],0];if(o.length(s)>=1e-15){const w=o.normalize([],s);o.scale$2(h,w,o.dot(h,w)),r[0]=h[0],r[1]=h[1]}const m=o.cross([],r,c);if(o.len(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return ws(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),y)}class pt{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,m=this.position,y=o.MercatorCoordinate.fromLngLat(r,h),w=[y.x-m.x,y.y-m.y,y.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Ts(w,s)}setPitchBearing(r,s){this.orientation=ws(o.degToRad(r),o.degToRad(-s))}}class sn{constructor(r,s){this._transform=o.identity([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.setColumn(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&su(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=ws(r,s),su(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const h=new Float64Array(16);return o.invert(h,this.getWorldToCamera(r,s)),h}getWorldToCameraPosition(r,s,h){const m=this.position;o.scale$2(m,m,-r);const y=new Float64Array(16);return o.fromScaling(y,[h,h,h]),o.translate(y,y,m),y[10]*=s,y}getWorldToCamera(r,s){const h=new Float64Array(16),m=new Float64Array(4),y=this.position;return o.conjugate(m,this._orientation),o.scale$2(y,y,-r),o.fromQuat(h,m),o.translate(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(r,s,h,m){const y=new Float64Array(16);return o.perspective(y,r,s,h,m),y}getDistanceToElevation(r){const s=r===0?0:o.mercatorZfromAltitude(r,this.position[1]),h=this.forward();return(s-this.position[2])/h[2]}clone(){return new sn([...this.position],[...this.orientation])}}function au(c,r){const s=wa(c.projection,c.zoom,c.width,c.height),h=function(y,w,E,A,P){const D=new o.LngLat(E.lng-180*Mn,E.lat),U=new o.LngLat(E.lng+180*Mn,E.lat),G=y.project(D.lng,D.lat),K=y.project(U.lng,U.lat),W=-Math.atan2(K.y-G.y,K.x-G.x),X=o.MercatorCoordinate.fromLngLat(E);X.y=o.clamp(X.y,-.999975,.999975);const H=X.toLngLat(),Z=y.project(H.lng,H.lat),te=o.MercatorCoordinate.fromLngLat(H);te.x+=Mn;const Y=te.toLngLat(),fe=y.project(Y.lng,Y.lat),de=Ta(fe.x-Z.x,fe.y-Z.y,W),ae=o.MercatorCoordinate.fromLngLat(H);ae.y+=Mn;const pe=ae.toLngLat(),he=y.project(pe.lng,pe.lat),xe=Ta(he.x-Z.x,he.y-Z.y,W),Se=Math.abs(de.x)/Math.abs(xe.y),Ye=o.identity([]);o.rotateZ(Ye,Ye,-W*(1-(P?0:A)));const we=o.identity([]);return o.scale(we,we,[1,1-(1-Se)*A,1]),we[4]=-xe.x/xe.y*A,o.rotateZ(we,we,W),o.multiply(we,Ye,we),we}(c.projection,0,c.center,s,r),m=lu(c);return o.scale(h,h,[m,m,1]),h}function lu(c){const r=c.projection,s=wa(c.projection,c.zoom,c.width,c.height),h=cu(r,c.center),m=cu(r,o.LngLat.convert(r.center));return Math.pow(2,h*s+(1-s)*m)}function wa(c,r,s,h,m=1/0){const y=c.range;if(!y)return 0;const w=Math.min(m,Math.max(s,h)),E=Math.log(w/1024)/Math.LN2;return o.smoothstep(y[0]+E,y[1]+E,r)}const Mn=1/4e4;function cu(c,r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=new o.LngLat(r.lng-180*Mn,s),m=new o.LngLat(r.lng+180*Mn,s),y=c.project(h.lng,s),w=c.project(m.lng,s),E=o.MercatorCoordinate.fromLngLat(h),A=o.MercatorCoordinate.fromLngLat(m),P=w.x-y.x,D=w.y-y.y,U=A.x-E.x,G=A.y-E.y,K=Math.sqrt((U*U+G*G)/(P*P+D*D));return Math.log(K)/Math.LN2}function Ta(c,r,s){const h=Math.cos(s),m=Math.sin(s);return{x:c*h-r*m,y:c*m+r*h}}class Ea{constructor(r,s,h,m,y,w,E){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=h==null?0:h,this._maxPitch=m==null?60:m,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ba,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new sn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Ea(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||s)&&this._updateCameraOnTerrain(),(r||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const h=!k(s,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,y,w){var E=y[0],A=y[1],P=y[2],D=y[3],U=Math.sin(w),G=Math.cos(w);m[0]=E*G+P*U,m[1]=A*G+D*U,m[2]=E*-U+P*G,m[3]=A*-U+D*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,y=0;for(let w=0;w<s.length;w++){const E=new o.pointGeometry(s[w][0]*this.width,h+s[w][1]*(this.height-h)),A=r.pointCoordinate(E);if(!A)continue;const P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*P,y+=P}return y===0?NaN:m/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(m-h,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let h;h=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const m=o.length(o.sub([],this._camera.position,h));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const h=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new pt;return s.position=new o.MercatorCoordinate(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const s=o.transformQuat([],[0,0,-1],r),h=o.transformQuat([],[0,-1,0],r);if(h[2]<0)return!1;const m=Ts(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;r[2]=o.clamp(r[2],m/h,m/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,h){this._unmodified=!1,this._edgeInsets.interpolate(r,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(h.x,m.x,y.x,w.x)),A=Math.floor(Math.max(h.x,m.x,y.x,w.x)),P=1;for(let D=E-P;D<=A+P;D++)D!==0&&s.push(new o.UnwrappedTileID(D,r))}return s}coveringTiles(r){let s=this.coveringZoomLevel(r);const h=s,m=this.elevation&&!r.isTerrainDEM,y=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const w=this.locationCoordinate(this.center),E=this.center.lat,A=1<<s,P=[A*w.x,A*w.y,0],D=this.projection.name==="globe",U=!D,G=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,U),K=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=A*o.mercatorZfromAltitude(1,this.center.lat),X=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),H=[A*K.x,A*K.y,X*(U?1:W)],Z=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,Y=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,fe=r.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?lu(this):1,ae=ze=>{const Oe=new o.MercatorCoordinate(ze.x+25e-6,ze.y,ze.z),at=new o.MercatorCoordinate(ze.x,ze.y+25e-6,ze.z),ot=ze.toLngLat(),wt=Oe.toLngLat(),Mt=at.toLngLat(),Nt=this.locationCoordinate(ot),oi=this.locationCoordinate(wt),Tt=this.locationCoordinate(Mt),qt=Math.hypot(oi.x-Nt.x,oi.y-Nt.y),_i=Math.hypot(Tt.x-Nt.x,Tt.y-Nt.y);return Math.sqrt(qt*_i)*de/25e-6},pe=ze=>{const Qe=Y,Oe=fe;return{aabb:o.tileAABB(this,A,0,0,0,ze,Oe,Qe,this.projection),zoom:0,x:0,y:0,minZ:Oe,maxZ:Qe,wrap:ze,fullyVisible:!1}},he=[];let xe=[];const Se=s,Ye=r.reparseOverscaled?h:s,we=ze=>ze*ze,Le=we((X-this._centerAltitude)*W),Fe=ze=>{if(!this._elevation||!ze.tileID||!y)return;const Qe=this._elevation.getMinMaxForTile(ze.tileID),Oe=ze.aabb;Qe?(Oe.min[2]=Qe.min,Oe.max[2]=Qe.max,Oe.center[2]=(Oe.min[2]+Oe.max[2])/2):(ze.shouldSplit=it(ze),ze.shouldSplit||(Oe.min[2]=Oe.max[2]=Oe.center[2]=this._centerAltitude))},it=ze=>{if(ze.zoom<te)return!0;if(ze.zoom===Se)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const Qe=ze.aabb.distanceX(H),Oe=ze.aabb.distanceY(H);let at=Le,ot=1;if(D){at=we(ze.aabb.distanceZ(H));const Mt=Math.pow(2,ze.zoom),Nt=o.latFromMercatorY((ze.y+1)/Mt),oi=o.latFromMercatorY(ze.y/Mt),Tt=Math.min(Math.max(E,Nt),oi),qt=o.circumferenceAtLatitude(Tt)/o.circumferenceAtLatitude(E);if(ot=Tt===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,qt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&ze.zoom===Se-1&&qt>=.9)return!0}else if(m&&(at=we(ze.aabb.distanceZ(H)*W)),this.projection.isReprojectedInTileSpace&&h<=5){const Mt=Math.pow(2,ze.zoom),Nt=ae(new o.MercatorCoordinate((ze.x+.5)/Mt,(ze.y+.5)/Mt));ot=Nt>.85?1:Nt}const wt=Qe*Qe+Oe*Oe+at;return wt<we((1<<Se-ze.zoom)*Z*ot*((Mt,Nt)=>{if(Nt*we(.707)<Mt)return 1;const oi=Math.sqrt(Nt/Mt);return oi/(1.4144271570014144+(Math.pow(1.1,oi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,Le),wt))};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)he.push(pe(-ze)),he.push(pe(ze));for(he.push(pe(0));he.length>0;){const ze=he.pop(),Qe=ze.x,Oe=ze.y;let at=ze.fullyVisible;if(!at){const ot=ze.aabb.intersects(G);if(ot===0)continue;at=ot===2}if(ze.zoom!==Se&&it(ze))for(let ot=0;ot<4;ot++){const wt=(Qe<<1)+ot%2,Mt=(Oe<<1)+(ot>>1),Nt={aabb:y?ze.aabb.quadrant(ot):o.tileAABB(this,A,ze.zoom+1,wt,Mt,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:wt,y:Mt,wrap:ze.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};m&&!D&&(Nt.tileID=new o.OverscaledTileID(ze.zoom+1===Se?Ye:ze.zoom+1,ze.wrap,ze.zoom+1,wt,Mt),Fe(Nt)),he.push(Nt)}else{const ot=ze.zoom===Se?Ye:ze.zoom;if(r.minzoom&&r.minzoom>ot)continue;const wt=P[0]-(.5+Qe+(ze.wrap<<ze.zoom))*(1<<s-ze.zoom),Mt=P[1]-.5-Oe,Nt=ze.tileID?ze.tileID:new o.OverscaledTileID(ot,ze.wrap,ze.zoom,Qe,Oe);xe.push({tileID:Nt,distanceSq:wt*wt+Mt*Mt})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,Qe=this.horizonLineFromTop();xe=xe.filter(Oe=>{const at=[0,0,0,1],ot=[o.EXTENT,o.EXTENT,0,1],wt=this.calculateFogTileMatrix(Oe.tileID.toUnwrapped());o.transformMat4$1(at,at,wt),o.transformMat4$1(ot,ot,wt);const Mt=o.getAABBPointSquareDist(at,ot);if(Mt===0)return!0;let Nt=!1;const oi=this._elevation;if(oi&&Mt>ze&&Qe!==0){const Tt=this.calculateProjMatrix(Oe.tileID.toUnwrapped());let qt;r.isTerrainDEM||(qt=oi.getMinMaxForTile(Oe.tileID)),qt||(qt={min:fe,max:Y});const _i=o.furthestTileCorner(this.rotation),qi=[_i[0]*o.EXTENT,_i[1]*o.EXTENT,qt.max];o.transformMat4(qi,qi,Tt),Nt=(1-qi[1])*this.height*.5<Qe}return Mt<ze||Nt})}return xe.sort((ze,Qe)=>ze.distanceSq-Qe.distanceSq).map(ze=>ze.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=this.projection.project(r.lng,s);return new o.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,s){let h,m;const y=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;h=(s.x-y.x)/E,m=(s.y-y.y)/E}else{const E=this.pointCoordinate(s),A=this.pointCoordinate(y);h=E.x-A.x,m=E.y-A.y}const w=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(w.x-h,w.y-m))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,s){const h=s?o.mercatorZfromAltitude(s,r.lat):void 0,m=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(m.x,m.y,h)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const h=s!=null?s:this._centerAltitude,m=[r.x,r.y,0,1],y=[r.x,r.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse);const w=y[3];o.scale$1(m,m,1/m[3]),o.scale$1(y,y,1/w);const E=m[2],A=y[2];return{p0:m,p1:y,t:E===A?0:(h-E)/(A-E)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],h=[r.x,r.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(h,h,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(h,h,1/h[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=o.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(h,h,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],h,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:h,t:m}=r,y=o.mercatorZfromAltitude(s[2],this._center.lat),w=o.mercatorZfromAltitude(h[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],h[0],m)/this.worldSize,o.number(s[1],h[1],m)/this.worldSize,o.number(y,w,m))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let s=this.projection.pointCoordinate3D(this,r.x,r.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let h=0,m=this.horizonLineFromTop();if(r.y>m)return this.pointCoordinate(r);const y=.02*m,w=r.clone();for(let E=0;E<10&&m-h>y;E++){w.y=o.number(h,m,.66);const A=this.projection.pointCoordinate3D(this,w.x,w.y);A?(m=w.y,s=A):h=w.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,m=[r.x*this.worldSize,r.y*this.worldSize,h+r.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,s){const h=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(h,r),A=this.pointCoordinate(m,r);const P=this.pointCoordinate(y,s),D=this.pointCoordinate(w,s),U=(G,K)=>(K.y-G.y)/(K.x-G.x);return E.y>1&&A.y>=0?E=new o.MercatorCoordinate((1-D.y)/U(D,E)+D.x,1):E.y<0&&A.y<=1&&(E=new o.MercatorCoordinate(-D.y/U(D,E)+D.x,0)),A.y>1&&E.y>=0?A=new o.MercatorCoordinate((1-P.y)/U(P,A)+P.x,1):A.y<0&&E.y<=1&&(A=new o.MercatorCoordinate(-P.y/U(P,A)+P.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(P))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const s=r.visibleDemTiles.reduce((h,m)=>{if(m.dem){const y=m.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=r.canonical,y=1/this.height,w=this.cameraWorldSize/this.zoomScale(m.z),E=(m.x+Math.pow(2,m.z)*r.wrap)*w,A=m.y*w,P=this.point,D=this.angle,U=Math.sin(-D),G=-Math.cos(-D);return h[s]={bearing:[U,G],center:[(P.x-E)*y,(P.y-A)*y],scale:w/o.EXTENT*y},h[s]}calculateFogTileMatrix(r){const s=r.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return o.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(r,s=!1){const h=r.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const y=this.calculatePosMatrix(r,this.worldSize);return o.multiply(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,y),m[h]=new Float32Array(y),m[h]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=function(y,w){const{scale:E}=y.tileTransform,A=E*o.EXTENT/(y.tileSize*Math.pow(2,w.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return P=new Float32Array(4),G=(D=w.inverseAdjustmentMatrix)[1],K=D[2],W=D[3],H=(U=[A,A])[1],P[0]=D[0]*(X=U[0]),P[1]=G*X,P[2]=K*H,P[3]=W*H,P;var P,D,U,G,K,W,X,H}(r,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),y=o.mercatorZfromAltitude(1,this._center.lat);h[2]/=y,m[2]/=y,o.normalize(m,m);const w=r.raycast(h,m,r.exaggeration());if(w){const E=o.scaleAndAdd([],h,m,w),A=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),P=(A.z+o.length([A.x-h[0],A.y-h[1],A.z-h[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=r.getAtPointOrZero(new o.MercatorCoordinate(...h)),y=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(w<y){const E=this.locationCoordinate(this._center,this._centerAltitude),A=[E.x-h[0],E.y-h[1],E.z-h[2]],P=o.length(A);A[2]-=(y-w)/this._pixelsPerMercatorPixel;const D=o.length(A);if(D===0)return;o.scale$2(A,A,P/D*this._pixelsPerMercatorPixel),this._camera.position=[E.x-A[0],E.y-A[1],E.z*this._pixelsPerMercatorPixel-A[2]],this._camera.orientation=Ts(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const G=this.center;return G.lat=o.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(G.lng=o.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let y=0,w=h,E=m;const A=this.width/2,P=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(m-P<D&&(E=D+P),m+P>U&&(E=U-P),U-D<this.height&&(y=Math.max(y,this.height/(U-D)),E=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,W=this.worldSize/2-(G+K)/2;w=(h+W+this.worldSize)%this.worldSize-W,w-A<G&&(w=G+A),w+A>K&&(w=K-A),K-G<this.width&&(y=Math.max(y,this.width/(K-G)),w=(K+G)/2)}w===h&&E===m||(this.center=this.unproject(new o.pointGeometry(w,E))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const h=wa(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?s:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-r.x/this.width,y[9]=2*r.y/this.height;let w=o.mul([],y,m);if(this.projection.isReprojectedInTileSpace){const de=this.locationCoordinate(this.center),ae=o.identity([]);o.translate(ae,ae,[de.x*this.worldSize,de.y*this.worldSize,0]),o.multiply(ae,ae,au(this)),o.translate(ae,ae,[-de.x*this.worldSize,-de.y*this.worldSize,0]),o.multiply(w,w,ae),this.inverseAdjustmentMatrix=function(pe){const he=au(pe,!0);return Et([],[he[0],he[1],he[4],he[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],w,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=w,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=o.invert([],y);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);o.identity(A),o.scale(A,A,[1,-1,1]),o.rotateX(A,A,this._pitch),o.rotateZ(A,A,this.angle);const P=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-r.x/this.width,P[9]=2*(r.y+D)/this.height,this.skyboxMatrix=o.multiply(A,P,A);const U=this.point,G=U.x,K=U.y,W=this.width%2/2,X=this.height%2/2,H=Math.cos(this.angle),Z=Math.sin(this.angle),te=G-Math.round(G)+H*W+Z*X,Y=K-Math.round(K)+H*X+Z*W,fe=new Float64Array(w);if(o.translate(fe,fe,[te>.5?te-1:te,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=fe,w=o.create(),o.scale(w,w,[this.width/2,-this.height/2,1]),o.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=o.create(),o.scale(w,w,[1,-1,1]),o.translate(w,w,[-1,-1,0]),o.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=o.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=w,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(de,de,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=w;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[r,r,s];o.scale$2(y,y,m),o.scale$2(h,h,-1),o.multiply$2(h,h,y);const w=o.create();o.translate(w,w,h),o.scale(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,m)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*y,m.y/this.worldSize-h[1]*y,r/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=r[2];let m=1;h>0&&(m=Math.min((s-this._camera.position[2])/h,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),y=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((r[2]-y)/Math.cos(h),w),A=this._zoomFromMercatorZ(E);o.scaleAndAdd(r,r,s,E),this._pitch=o.clamp(h,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const h=Math.min(r.x,s.x),m=Math.max(r.x,s.x),y=Math.min(r.y,s.y),w=Math.max(r.y,s.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(h,y),new o.pointGeometry(m,w),new o.pointGeometry(h,w),new o.pointGeometry(m,y)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const D of E){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const G=this.rayIntersectionCoordinate(U);if(G.x<A||G.y<0||G.x>P||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,s){const h=o.length(o.sub([],this._camera.position,r)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const r=function(s,h){const m=[s[0],s[1],s[2],1];o.transformMat4$1(m,m,h);const y=Math.max(m[3],1e-6);return[m[0]/y,m[1]/y,m[2]/y,y]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,r))}}getCameraToCenterDistance(r){const s=wa(r,this.zoom,this.width,this.height,1024),h=r.pixelSpaceConversion(this.center.lat,this.worldSize,s);return .5/Math.tan(.5*this._fov)*this.height*h}}function Sa(c,r){let s=!1,h=null;const m=()=>{h=null,s&&(c(),h=setTimeout(m,r),s=!1)};return()=>(s=!0,h||m(),h)}class Zh{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Sa(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=uu(r);if(this._hashName){const h=this._hashName;let m=!1;const y=o.window.location.hash.slice(1).split("&").map(w=>{const E=w.split("=")[0];return E===h?(m=!0,`${E}=${s}`):w}).filter(w=>w);return m||y.push(`${h}=${s}`),`#${y.join("&")}`}return`#${s}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function uu(c,r){const s=c.getCenter(),h=Math.round(100*c.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),w=Math.round(s.lng*y)/y,E=Math.round(s.lat*y)/y,A=c.getBearing(),P=c.getPitch();let D=r?`/${w}/${E}/${h}`:`${h}/${E}/${w}`;return(A||P)&&(D+="/"+Math.round(10*A)/10),P&&(D+=`/${Math.round(P)}`),D}const Yn={linearity:.3,easing:o.bezier(0,0,.3,1)},cf=o.extend({deceleration:2500,maxSpeed:1400},Yn),uf=o.extend({deceleration:20,maxSpeed:1400},Yn),Wh=o.extend({deceleration:1e3,maxSpeed:360},Yn),Cl=o.extend({deceleration:1e3,maxSpeed:90},Yn);class hu{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.exported.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const y=Ia(s.pan.mag(),h,o.extend({},cf,r||{}));m.offset=s.pan.mult(y.amount/s.pan.mag()),m.center=this._map.transform.center,Aa(m,y)}if(s.zoom){const y=Ia(s.zoom,h,uf);m.zoom=this._map.transform.zoom+y.amount,Aa(m,y)}if(s.bearing){const y=Ia(s.bearing,h,Wh);m.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),Aa(m,y)}if(s.pitch){const y=Ia(s.pitch,h,Cl);m.pitch=this._map.transform.pitch+y.amount,Aa(m,y)}if(m.zoom||m.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Aa(c,r){(!c.duration||c.duration<r.duration)&&(c.duration=r.duration,c.easing=r.easing)}function Ia(c,r,s){const{maxSpeed:h,linearity:m,deceleration:y}=s,w=o.clamp(c*m/(r/1e3),-h,h),E=Math.abs(w)/(y*m);return{easing:s.easing,duration:1e3*E,amount:w*(E/2)}}class Dr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h,m={}){const y=He(s.getCanvasContainer(),h),w=s.unproject(y);super(r,o.extend({point:y,lngLat:w,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class Es extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){const m=r==="touchend"?h.changedTouches:h.touches,y=yt(s.getCanvasContainer(),m),w=y.map(A=>s.unproject(A)),E=y.reduce((A,P,D,U)=>A.add(P.div(U.length)),new o.pointGeometry(0,0));super(r,{points:y,point:E,lngLats:w,lngLat:s.unproject(E),originalEvent:h}),this._defaultPrevented=!1}}class Xh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){super(r,{originalEvent:h}),this._defaultPrevented=!1}}class Hh{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Xh(r.type,this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new Dr(r.type,this._map,r))}mouseup(r){this._map.fire(new Dr(r.type,this._map,r))}preclick(r){const s=o.extend({},r);s.type="preclick",this._map.fire(new Dr(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Dr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Dr(r.type,this._map,r))}mouseover(r){this._map.fire(new Dr(r.type,this._map,r))}mouseout(r){this._map.fire(new Dr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Es(r.type,this._map,r))}touchmove(r){this._map.fire(new Es(r.type,this._map,r))}touchend(r){this._map.fire(new Es(r.type,this._map,r))}touchcancel(r){this._map.fire(new Es(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Dr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Dr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yh{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(Ge(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=$("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(m.x,h.x),w=Math.max(m.x,h.x),E=Math.min(m.y,h.y),A=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=w-y+"px",this._box.style.height=A-E+"px")})}mouseupWindow(r,s){if(!this._active||r.button!==0)return;const h=this._startPos,m=s;if(this.reset(),ft(),h.x!==m.x||h.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),qe(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.Event(r,{originalEvent:s}))}}function Ml(c,r){const s={};for(let h=0;h<c.length;h++)s[c[h].identifier]=r[h];return s}class Ss{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const y=new o.pointGeometry(0,0);for(const w of m)y._add(w);return y.div(m.length)}(s),this.touches=Ml(h,s)))}touchmove(r,s,h){if(this.aborted||!this.centroid)return;const m=Ml(h,s);for(const y in this.touches){const w=this.touches[y],E=m[y];(!E||E.dist(w)>30)&&(this.aborted=!0)}}touchend(r,s,h){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class zl{constructor(r){this.singleTap=new Ss(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,h){this.singleTap.touchstart(r,s,h)}touchmove(r,s,h){this.singleTap.touchmove(r,s,h)}touchend(r,s,h){const m=this.singleTap.touchend(r,s,h);if(m){const y=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(y&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Jh{constructor(){this._zoomIn=new zl({numTouches:1,numTaps:2}),this._zoomOut=new zl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,h){this._zoomIn.touchstart(r,s,h),this._zoomOut.touchstart(r,s,h)}touchmove(r,s,h){this._zoomIn.touchmove(r,s,h),this._zoomOut.touchmove(r,s,h)}touchend(r,s,h){const m=this._zoomIn.touchend(r,s,h),y=this._zoomOut.touchend(r,s,h);return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qh={0:1,2:2};class Pl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const h=We(r);this._correctButton(r,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(r,s){const h=this._lastPoint;if(h){if(r.preventDefault(),this._eventButton!=null&&function(m,y){const w=Qh[y];return m.buttons===void 0||(m.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(r){this._lastPoint&&We(r)===this._eventButton&&(this._moved&&ft(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ed extends Pl{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class du extends Pl{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=.8*(s.x-r.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(r){r.preventDefault()}}class Sr extends Pl{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=-.5*(s.y-r.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(r){r.preventDefault()}}class hf{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(r,s,h){return this._calculateTransform(r,s,h)}touchmove(r,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,h)}}touchend(r,s,h){this._calculateTransform(r,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,h){h.length>0&&(this._active=!0);const m=Ml(h,s),y=new o.pointGeometry(0,0),w=new o.pointGeometry(0,0);let E=0;for(const P in m){const D=m[P],U=this._touches[P];U&&(y._add(D),w._add(D.sub(U)),E++,m[P]=D)}if(this._touches=m,E<this._minTouches||!w.mag())return;const A=w.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class kl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,h){return{}}touchstart(r,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,h){const m=this._firstTwoTouches;if(!m)return;r.preventDefault();const[y,w]=m,E=Dl(h,s,y),A=Dl(h,s,w);if(!E||!A)return;const P=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],P,r)}touchend(r,s,h){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,w=Dl(h,s,m),E=Dl(h,s,y);w&&E||(this._active&&ft(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dl(c,r,s){for(let h=0;h<c.length;h++)if(c[h].identifier===s)return r[h]}function td(c,r){return Math.log(c/r)/Math.LN2}class Jn extends kl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const h=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(td(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:td(this._distance,h),pinchAround:s}}}function pu(c,r){return 180*c.angleWith(r)/Math.PI}class As extends kl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const h=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pu(this._vector,h),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,h=pu(r,this._startVector);return Math.abs(h)<s}}function fn(c){return Math.abs(c.y)>Math.abs(c.x)}class Ll extends kl{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,fn(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,h){const m=this._lastPoints;if(!m)return;const y=r[0].sub(m[0]),w=r[1].sub(m[1]);return this._map._cooperativeGestures&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,w,h.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5})}gestureBeginsVertically(r,s,h){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,y=s.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const w=r.y>0==s.y>0;return fn(r)&&fn(s)&&w}}const _t={panStep:100,bearingStep:15,pitchStep:10};class id{constructor(){const r=_t;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,h=0,m=0,y=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?h=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?h=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:E=>{const A=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:rd,zoom:s?Math.round(A)+s*(r.shiftKey?2:1):A,bearing:E.getBearing()+h*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rd(c){return c*(2-c)}const Is=4.000244140625;class Ca{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const h=o.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Is==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=He(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Is?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&P!==0&&(P=1/P);const D=s(),U=Math.pow(2,D),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*P))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,y=this._easing;let w,E=!1;if(this._type==="wheel"&&m&&y){const A=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),P=y(A);w=o.number(m,h,P),A<1?this._frameId||(this._frameId=!0):E=!0}else w=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:w-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.ease;if(this._prevEase){const h=this._prevEase,m=(o.exported.now()-h.start)/h.duration,y=h.easing(m+.01)-h.easing(m),w=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-w*w);s=o.bezier(w,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class nd{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(r.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sd{constructor(){this._tap=new zl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,h){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(r,s,h))}touchmove(r,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,s,h)}touchend(r,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(r,s,h)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(r,s,h){this._el=r,this._mousePan=s,this._touchPan=h}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ld{constructor(r,s,h){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cd{constructor(r,s,h,m){this._el=r,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ma=c=>c.zoom||c.drag||c.pitch||c.rotate;class Rl extends o.Event{}class fu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const h=o.sub([],s,r);this.radius=o.length(h[2]<0?o.div([],h,this.constants):[h[0],h[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const s=o.scale$2([],r,this.radius);if(s[2]>0){const h=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),m=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),y=o.add([],s,o.scale$2([],o.sub([],o.add([],m,h),s),2));s[0]=y[0],s[1]=y[1]}return s}}function $o(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class ud{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hu(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,y,w]of this._listeners)m.addEventListener(y,m===o.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[r,s,h]of this._listeners)r.removeEventListener(s,r===o.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(r){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Hh(s,r));const m=s.boxZoom=new Yh(s,r);this._add("boxZoom",m);const y=new Jh,w=new od;s.doubleClickZoom=new nd(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const E=new sd;this._add("tapDragZoom",E);const A=s.touchPitch=new Ll(s);this._add("touchPitch",A);const P=new du(r),D=new Sr(r);s.dragRotate=new ld(r,P,D),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new ed(r),G=new hf(s,r);s.dragPan=new ad(h,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]);const K=new As,W=new Jn;s.touchZoomRotate=new cd(h,W,K,E),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Kh(s));const X=s.scrollZoom=new Ca(s,this);this._add("scrollZoom",X,["mousePan"]);const H=s.keyboard=new id;this._add("keyboard",H);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Z]&&s[Z].enable(r[Z])}_add(r,s,h){this._handlers.push({handlerName:r,handler:s,allowed:h}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ma(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,s,h){for(const m in r)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const h of r)this._el.contains(h.target)&&s.push(h);return s}handleEvent(r,s){this._updatingCamera=!0;const h=r.type==="renderFrame",m=h?void 0:r,y={needsRenderFrame:!1},w={},E={},A=r.touches?this._getMapTouches(r.touches):void 0,P=A?yt(this._el,A):h?void 0:He(this._el,r);for(const{handlerName:G,handler:K,allowed:W}of this._handlers){if(!K.isEnabled())continue;let X;this._blockedByActive(E,W,G)?K.reset():K[s||r.type]&&(X=K[s||r.type](r,P,A),this.mergeHandlerResult(y,w,X,G,m),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||K.isActive())&&(E[G]=K)}const D={};for(const G in this._previousActiveHandlers)E[G]||(D[G]=m);this._previousActiveHandlers=E,(Object.keys(D).length||$o(y))&&(this._changes.push([y,w,D]),this._triggerRenderFrame()),(Object.keys(E).length||$o(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=y;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,s,h,m,y){if(!h)return;o.extend(r,h);const w={handlerName:m,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(s.zoom=w),h.panDelta!==void 0&&(s.drag=w),h.pitchDelta!==void 0&&(s.pitch=w),h.bearingDelta!==void 0&&(s.rotate=w)}_applyChanges(){const r={},s={},h={};for(const[m,y,w]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.aroundCoord!==void 0&&(r.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),o.extend(s,y),o.extend(h,w);this._updateMapTransform(r,s,h),this._changes=[]}_updateMapTransform(r,s,h){const m=this._map,y=m.transform,w=te=>[te.x,te.y,te.z];if((te=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!$o(r)){const te=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",te!==y.zoom&&this._map._update(!0)}if(!$o(r))return void this._fireEvents(s,h,!0);let{panDelta:E,zoomDelta:A,bearingDelta:P,pitchDelta:D,around:U,aroundCoord:G,pinchAround:K}=r;K!==void 0&&(U=K),(te=>s.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=w(y.pointCoordinate3D(U)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),U=U||m.transform.centerPoint,P&&(y.bearing+=P),D&&(y.pitch+=D),y._updateCameraState();const W=[0,0,0];if(E)if(y.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U).dir),Y=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U.sub(E)).dir);W[0]=Y[0]-te[0],W[1]=Y[1]-te[1]}else{const te=y.pointCoordinate(U);if(y.projection.name==="globe"){E=E.rotate(-y.angle);const Y=y._pixelsPerMercatorPixel/y.worldSize;W[0]=-E.x*o.mercatorScale(o.latFromMercatorY(te.y))*Y,W[1]=-E.y*o.mercatorScale(y.center.lat)*Y}else{const Y=y.pointCoordinate(U.sub(E));te&&Y&&(W[0]=Y.x-te.x,W[1]=Y.y-te.y)}}const X=y.zoom,H=[0,0,0];if(A){const te=w(G||y.pointCoordinate3D(U)),Y={dir:o.normalize([],o.sub([],te,y._camera.position))};if(Y.dir[2]<0){const fe=y.zoomDeltaToMovement(te,A);o.scale$2(H,Y.dir,fe)}}const Z=o.add(W,W,H);y._translateCameraConstrained(Z),A&&Math.abs(y.zoom-X)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,h,!0)}_fireEvents(r,s,h){const m=Ma(this._eventsInProgress),y=Ma(r),w={};for(const D in r){const{originalEvent:U}=r[D];this._eventsInProgress[D]||(w[`${D}start`]=U),this._eventsInProgress[D]=r[D]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in w)this._fireEvent(D,w[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in r){const{originalEvent:U}=r[D];this._fireEvent(D,U)}const E={};let A;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],A=s[U]||G,E[`${D}end`]=A)}for(const D in E)this._fireEvent(D,E[D]);const P=Ma(this._eventsInProgress);if(h&&(m||y)&&!P){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new o.Event("moveend",{originalEvent:A})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.Event(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Rl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const mu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hd extends o.Evented{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,h){return r=o.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},s),h)}panTo(r,s,h){return this.easeTo(o.extend({center:r},s),h)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,h){return this.easeTo(o.extend({zoom:r},s),h)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,h){return this.easeTo(o.extend({bearing:r},s),h)}resetNorth(r,s){return this.rotateTo(0,o.extend({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=o.LngLatBounds.convert(r);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),h,s)}_extendCameraOptions(r){const s={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const h=r.padding;r.padding={top:h,bottom:h,right:h,left:h}}return r.padding=o.extend(s,r.padding),r}_cameraForBoxAndBearing(r,s,h,m){const y=this._extendCameraOptions(m),w=this.transform,E=w.padding,A=w.project(o.LngLat.convert(r)),P=w.project(o.LngLat.convert(s)),D=new o.pointGeometry(A.x,P.y),U=new o.pointGeometry(P.x,A.y),G=-o.degToRad(h),K=A.rotate(G),W=P.rotate(G),X=D.rotate(G),H=U.rotate(G),Z=new o.pointGeometry(Math.max(K.x,W.x,X.x,H.x),Math.max(K.y,W.y,X.y,H.y)),te=new o.pointGeometry(Math.min(K.x,W.x,X.x,H.x),Math.min(K.y,W.y,X.y,H.y)),Y=Z.sub(te),fe=(w.width-((E.left||0)+(E.right||0)+y.padding.left+y.padding.right))/Y.x,de=(w.height-((E.top||0)+(E.bottom||0)+y.padding.top+y.padding.bottom))/Y.y;if(de<0||fe<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(w.scaleZoom(w.scale*Math.min(fe,de)),y.maxZoom),pe=typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new o.pointGeometry(y.offset.x,y.offset.y):o.pointGeometry.convert(y.offset),he=new o.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(h*Math.PI/180),xe=pe.add(he).mult(w.scale/w.zoomScale(ae));return{center:w.unproject(A.add(P).div(2).sub(xe)),zoom:ae,bearing:h}}_cameraForBox(r,s,h,m,y){const w=this._extendCameraOptions(y);h=h||0,m=m||0,r=o.LngLat.convert(r),s=o.LngLat.convert(s);const E=this.transform.clone();E.padding=w.padding;const A=this.getFreeCameraOptions(),P=new o.LngLat(.5*(r.lng+s.lng),.5*(r.lat+s.lat)),D=.5*(h+m);if(E._camera.position[2]<o.mercatorZfromAltitude(D,P.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(P),E.setFreeCameraOptions(A);const U=o.MercatorCoordinate.fromLngLat(r),G=o.MercatorCoordinate.fromLngLat(s),K=E.pointRayIntersection(E.centerPoint,D),W=[(X=E.rayIntersectionCoordinate(K)).x,X.y,X.z];var X;const H=E.screenPointToMercatorRay(E.centerPoint),Z=E.projection.name!=="globe";let te,Y=0;do{const fe=Math.floor(E.zoom),de=1<<fe,ae=Math.min(de*U.x,de*G.x),pe=Math.min(de*U.y,de*G.y),he=Math.max(de*U.x,de*G.x),xe=Math.max(de*U.y,de*G.y),Se=new o.Aabb([ae,pe,h],[he,xe,m]),Ye=o.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,fe,Z);if(Se.intersects(Ye)!==2){te&&(E._camera.position=o.scaleAndAdd([],E._camera.position,H.dir,-te),E._updateStateFromCamera());break}const we=o.sub([],E._camera.position,W);te=.5*o.length(we),E._camera.position=o.scaleAndAdd([],E._camera.position,H.dir,te);try{E._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Y<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(r,s,h){return this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,s),s,h)}_raycastElevationBox(r,s){const h=this.transform.elevation;if(!h)return;const m=new o.pointGeometry(r.x,s.y),y=new o.pointGeometry(s.x,r.y),w=h.pointCoordinate(r);if(!w)return;const E=h.pointCoordinate(s);if(!E)return;const A=h.pointCoordinate(m);if(!A)return;const P=h.pointCoordinate(y);if(!P)return;const D=new o.MercatorCoordinate(w[0],w[1]).toLngLat(),U=new o.MercatorCoordinate(E[0],E[1]).toLngLat(),G=new o.MercatorCoordinate(A[0],A[1]).toLngLat(),K=new o.MercatorCoordinate(P[0],P[1]).toLngLat(),W=Math.min(D.lng,Math.min(U.lng,Math.min(G.lng,K.lng))),X=Math.min(D.lat,Math.min(U.lat,Math.min(G.lat,K.lat))),H=Math.max(D.lng,Math.max(U.lng,Math.max(G.lng,K.lng))),Z=Math.max(D.lat,Math.max(U.lat,Math.max(G.lat,K.lat))),te=Math.min(w[3],Math.min(E[3],Math.min(A[3],P[3]))),Y=Math.max(w[3],Math.max(E[3],Math.max(A[3],P[3])));return{minLngLat:new o.LngLat(W,X),maxLngLat:new o.LngLat(H,Z),minAltitude:te,maxAltitude:Y}}fitScreenCoordinates(r,s,h,m,y){let w,E,A,P;this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const D=o.pointGeometry.convert(r),U=o.pointGeometry.convert(s),G=this._raycastElevationBox(D,U);if(G)w=G.minLngLat,E=G.maxLngLat,A=G.minAltitude,P=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(D,U))return this;w=this.transform.pointLocation(D),E=this.transform.pointLocation(U)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(r)),this.transform.pointLocation(o.pointGeometry.convert(s)),h,m):this._cameraForBox(w,E,A,P,m),m,y)}_fitInternal(r,s,h){return r?(delete(s=o.extend(r,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(r,s){this.stop();const h=r.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,w=!1;return"zoom"in r&&h.zoom!==+r.zoom&&(m=!0,h.zoom=+r.zoom),r.center!==void 0&&(h.center=o.LngLat.convert(r.center)),"bearing"in r&&h.bearing!==+r.bearing&&(y=!0,h.bearing=+r.bearing),"pitch"in r&&h.pitch!==+r.pitch&&(w=!0,h.pitch=+r.pitch),r.padding==null||h.isPaddingEqual(r.padding)||(h.padding=r.padding),r.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),m&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),y&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),w&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(mu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.warnOnce(mu),this;this.stop();const m=h.zoom,y=h.pitch,w=h.bearing;h.setFreeCameraOptions(r);const E=m!==h.zoom,A=y!==h.pitch,P=w!==h.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),E&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),P&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),A&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||!r.essential&&o.exported.prefersReducedMotion)&&(r.duration=0);const h=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),E=this.getPadding(),A="zoom"in r?+r.zoom:m,P="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:w,U="padding"in r?r.padding:h.padding,G=o.pointGeometry.convert(r.offset);let K,W,X;if(h.projection.name==="globe"){const xe=o.MercatorCoordinate.fromLngLat(h.center),Se=G.rotate(-h.angle);xe.x+=Se.x/h.worldSize,xe.y+=Se.y/h.worldSize;const Ye=xe.toLngLat(),we=o.LngLat.convert(r.center||Ye);this._normalizeCenter(we),K=h.centerPoint.add(Se),W=new o.pointGeometry(xe.x,xe.y).mult(h.worldSize),X=new o.pointGeometry(o.mercatorXfromLng(we.lng),o.mercatorYfromLat(we.lat)).mult(h.worldSize).sub(W)}else{K=h.centerPoint.add(G);const xe=h.pointLocation(K),Se=o.LngLat.convert(r.center||xe);this._normalizeCenter(Se),W=h.project(xe),X=h.project(Se).sub(W)}const H=h.zoomScale(A-m);let Z,te;r.around&&(Z=o.LngLat.convert(r.around),te=h.locationPoint(Z));const Y=this._zooming||A!==m,fe=this._rotating||y!==P,de=this._pitching||D!==w,ae=!h.isPaddingEqual(U),pe=xe=>Se=>{if(Y&&(xe.zoom=o.number(m,A,Se)),fe&&(xe.bearing=o.number(y,P,Se)),de&&(xe.pitch=o.number(w,D,Se)),ae&&(xe.interpolatePadding(E,U,Se),K=xe.centerPoint.add(G)),Z)xe.setLocationAtPoint(Z,te);else{const Ye=xe.zoomScale(xe.zoom-m),we=A>m?Math.min(2,H):Math.max(.5,H),Le=Math.pow(we,1-Se),Fe=xe.unproject(W.add(X.mult(Se*Le)).mult(Ye));xe.setLocationAtPoint(xe.renderWorldCopies?Fe.wrap():Fe,K)}return r.preloadOnly||this._fireMoveEvents(s),xe};if(r.preloadOnly){const xe=this._emulate(pe,r.duration,h);return this._preloadTiles(xe),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=fe,this._pitching=de,this._padding=ae,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,he),this._ease(pe(h),xe=>{h.recenterOnTerrain(),this._afterEase(s,xe)},r),this}_prepareEase(r,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!h.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!h.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!h.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.Event("zoomend",r)),m&&this.fire(new o.Event("rotateend",r)),y&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,s){if(!r.essential&&o.exported.prefersReducedMotion){const at=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,s)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const h=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),E=this.getPadding(),A="zoom"in r?o.clamp(+r.zoom,h.minZoom,h.maxZoom):m,P="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:w,U="padding"in r?r.padding:h.padding,G=h.zoomScale(A-m),K=o.pointGeometry.convert(r.offset);let W=h.centerPoint.add(K);const X=h.pointLocation(W),H=o.LngLat.convert(r.center||X);this._normalizeCenter(H);const Z=h.project(X),te=h.project(H).sub(Z);let Y=r.curve;const fe=Math.max(h.width,h.height),de=fe/G,ae=te.mag();if("minZoom"in r){const at=o.clamp(Math.min(r.minZoom,m,A),h.minZoom,h.maxZoom),ot=fe/h.zoomScale(at-m);Y=Math.sqrt(ot/ae*2)}const pe=Y*Y;function he(at){const ot=(de*de-fe*fe+(at?-1:1)*pe*pe*ae*ae)/(2*(at?de:fe)*pe*ae);return Math.log(Math.sqrt(ot*ot+1)-ot)}function xe(at){return(Math.exp(at)-Math.exp(-at))/2}function Se(at){return(Math.exp(at)+Math.exp(-at))/2}const Ye=he(0);let we=function(at){return Se(Ye)/Se(Ye+Y*at)},Le=function(at){return fe*((Se(Ye)*(xe(ot=Ye+Y*at)/Se(ot))-xe(Ye))/pe)/ae;var ot},Fe=(he(1)-Ye)/Y;if(Math.abs(ae)<1e-6||!isFinite(Fe)){if(Math.abs(fe-de)<1e-6)return this.easeTo(r,s);const at=de<fe?-1:1;Fe=Math.abs(Math.log(de/fe))/Y,Le=function(){return 0},we=function(ot){return Math.exp(at*Y*ot)}}r.duration="duration"in r?+r.duration:1e3*Fe/("screenSpeed"in r?+r.screenSpeed/Y:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const it=y!==P,ze=D!==w,Qe=!h.isPaddingEqual(U),Oe=at=>ot=>{const wt=ot*Fe,Mt=1/we(wt);at.zoom=ot===1?A:m+at.scaleZoom(Mt),it&&(at.bearing=o.number(y,P,ot)),ze&&(at.pitch=o.number(w,D,ot)),Qe&&(at.interpolatePadding(E,U,ot),W=at.centerPoint.add(K));const Nt=ot===1?H:at.unproject(Z.add(te.mult(Le(wt))).mult(Mt));return at.setLocationAtPoint(at.renderWorldCopies?Nt.wrap():Nt,W),at._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),at};if(r.preloadOnly){const at=this._emulate(Oe,r.duration,h);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=it,this._pitching=ze,this._padding=Qe,this._prepareEase(s,!1),this._ease(Oe(h),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!r){const h=this.handlers;h&&h.stop(!1)}return this}_ease(r,s,h){h.animate===!1||h.duration===0?(r(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=h,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.wrap(r,-180,180);const h=Math.abs(r-s);return Math.abs(r-360-s)<h&&(r-=360),Math.abs(r+360-s)<h&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const h=r.lng-s.center.lng;r.lng+=h>180?-360:h<-180?360:0}_emulate(r,s,h){const m=Math.ceil(15*s/1e3),y=[],w=r(h.clone());for(let E=0;E<=m;E++){const A=w(E/m);y.push(A.clone())}return y}}class _u{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact;return this._map=r,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=$("button","mapboxgl-ctrl-attrib-button",this._container),$("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,s){const h=this._map._getUIString(`AttributionControl.${s}`);r.setAttribute("aria-label",h),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const h=s.reduce((m,y,w)=>(y.value&&(m+=`${y.key}=${y.value}${w<s.length-1?"&":""}`),m),"?");r.href=`${o.config.FEEDBACK_URL}/${h}#${uu(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const y=s[m];if(y.used){const w=y.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((m,y)=>m.length-y.length),r=r.filter((m,y)=>{for(let w=y+1;w<r.length;w++)if(r[w].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const h=r.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,r.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class gu{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=$("div","mapboxgl-ctrl");const s=$("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const h=r[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class yu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===r)return void(m.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function xu(c,r,s){if(c=new o.LngLat(c.lng,c.lat),r){const h=new o.LngLat(c.lng-360,c.lat),m=new o.LngLat(c.lng+360,c.lat),y=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),w=s.locationPoint(c).distSqr(r),E=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint(h).distSqr(r)<w&&(E||Math.abs(h.lng-s.center.lng)<y)?c=h:s.locationPoint(m).distSqr(r)<w&&(E||Math.abs(m.lng-s.center.lng)<y)&&(c=m)}for(;Math.abs(c.lng-s.center.lng)>180;){const h=s.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const za={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bl extends o.Evented{constructor(r,s){if(super(),(r instanceof o.window.HTMLElement||s)&&(r=o.extend({element:r},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=o.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=$("div");const m=41,y=27,w=ne("svg",{display:"block",height:m*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${m}`},this._element),E=ne("radialGradient",{id:"shadowGradient"},ne("defs",{},w));ne("stop",{offset:"10%","stop-opacity":.4},E),ne("stop",{offset:"100%","stop-opacity":.05},E),ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=o.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in za)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,h=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const s=r.unproject(this._pos),h=r.getFreeCameraOptions();if(!h.position)return!1;const m=h.position.toLngLat();return m.distanceTo(s)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const h=r.unproject(s);let m;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?m=0:(m=1-r._queryFogOpacity(h),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(m*=.2)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${za[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const r=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!r||h!=="map")return"";if(!s._showingGlobe()){const A=s.getPitch();return A?`rotateX(${A}deg)`:""}const m=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),y=r.sub(o.globeCenterToScreenPoint(s.transform)),w=Math.abs(y.x)+Math.abs(y.y);if(w===0)return"";const E=m/w;return`rotateX(${-y.y*E}deg) rotateY(${y.x*E}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const y=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),w=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);h=o.radToDeg(Math.atan2(w.y,w.x))-90}else h=-s.getBearing();else if(m==="horizon"){const y=o.smoothstep(4,6,s.getZoom()),w=o.globeCenterToScreenPoint(s.transform);w.y+=y*s.transform.height;const E=r.sub(w),A=o.radToDeg(Math.atan2(E.y,E.x));h=(A>90?A-270:A+90)*(1-y)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=xu(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.pointGeometry.convert(r),this._update(),this}_onMove(r){const s=this._map;if(s){if(!this._isDragging){const h=this._clickTolerance||s._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map;s&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class dd{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,h){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+h}}const pd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Pa(c){c.parentNode&&c.parentNode.removeChild(c)}const md={showCompass:!0,showZoom:!0,visualizePitch:!1};class vu{constructor(r,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new du({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,h&&(this.mousePitch=new Sr({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),Ge()}move(r,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(r,s),y=m&&m.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){const w=this.mousePitch.mousemoveWindow(r,s),E=w&&w.pitchDelta;E&&h.setPitch(h.getPitch()+E)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){qe(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),He(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,He(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=yt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=yt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _d={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},bu={maxWidth:100,unit:"metric"};function wu(c,r,s){const h=Ol(r),m=h/r,y={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=c*m+"px",this._container.innerHTML=`${h}&nbsp;${y}`})}function Ol(c){const r=Math.pow(10,`${Math.floor(c)}`.length-1);let s=c/r;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(h){const m=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*m)/m}(s),r*s}const df={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fl(c=new o.pointGeometry(0,0),r="bottom"){if(typeof c=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(r){case"top":return new o.pointGeometry(0,c);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-c);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(c,0);case"right":return new o.pointGeometry(-c,0)}return new o.pointGeometry(0,0)}return c instanceof o.pointGeometry||Array.isArray(c)?o.pointGeometry.convert(c):o.pointGeometry.convert(c[r]||[0,0])}const ka={version:o.version,supported:j,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends hd{constructor(c){if((c=o.extend({},fd,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(c.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ea(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=c.language==="auto"?o.window.navigator.language:c.language,this._worldview=c.worldview,this._renderTaskQueue=new yu,this._domRenderTaskQueue=new yu,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},pd,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dd(0),this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=o.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ud(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new Zh(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new _u({customAttribution:c.customAttribution})),this._logoControl=new gu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(c,r){if(r===void 0&&(r=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const h=this._controlPositions[r];return r.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(c);return r>-1&&this._controls.splice(r,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),this.fire(new o.Event("resize",c)),r&&this.fire(new o.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getLanguage(){return this._language}setLanguage(c){if(this._language=c==="auto"?o.window.navigator.language:c,this.style)for(const r in this.style._sourceCaches){const s=this.style._sourceCaches[r]._source;s._setLanguage&&s._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){if(this._worldview=c,this.style)for(const r in this.style._sourceCaches){const s=this.style._sourceCaches[r]._source;s._setWorldview&&s._setWorldview(c)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,r=c.projection.name;let s;r==="globe"&&c.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),s=!0):r==="mercator"&&c.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,r){return this._updateProjection(c||r||{name:"mercator"})}_updateProjection(c){let r;if(r=c.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0)}return this}project(c){return this.transform.locationPoint3D(o.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(o.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,r,s){if(c==="mouseenter"||c==="mouseover"){let h=!1;const m=w=>{const E=r.filter(P=>this.getLayer(P)),A=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];A.length?h||(h=!0,s.call(this,new Dr(c,this,w.originalEvent,{features:A}))):h=!1},y=()=>{h=!1};return{layers:new Set(r),listener:s,delegates:{mousemove:m,mouseout:y}}}if(c==="mouseleave"||c==="mouseout"){let h=!1;const m=w=>{const E=r.filter(A=>this.getLayer(A));(E.length?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?h=!0:h&&(h=!1,s.call(this,new Dr(c,this,w.originalEvent)))},y=w=>{h&&(h=!1,s.call(this,new Dr(c,this,w.originalEvent)))};return{layers:new Set(r),listener:s,delegates:{mousemove:m,mouseout:y}}}{const h=m=>{const y=r.filter(E=>this.getLayer(E)),w=y.length?this.queryRenderedFeatures(m.point,{layers:y}):[];w.length&&(m.features=w,s.call(this,m),delete m.features)};return{layers:new Set(r),listener:s,delegates:{[c]:h}}}}on(c,r,s){if(s===void 0)return super.on(c,r);Array.isArray(r)||(r=[r]);const h=this._createDelegatedListener(c,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(c,r,s){if(s===void 0)return super.once(c,r);Array.isArray(r)||(r=[r]);const h=this._createDelegatedListener(c,r,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(c,r,s){if(s===void 0)return super.off(c,r);r=new Set(Array.isArray(r)?r:[r]);const h=(y,w)=>{if(y.size!==w.size)return!1;for(const E of y)if(!w.has(E))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[c]:void 0;return m&&(y=>{for(let w=0;w<y.length;w++){const E=y[w];if(E.listener===s&&h(E.layers,r)){for(const A in E.delegates)this.off(A,E.delegates[A]);return y.splice(w,1),this}}})(m),this}queryRenderedFeatures(c,r){return this.style?(r!==void 0||c===void 0||c instanceof o.pointGeometry||Array.isArray(c)||(r=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(c,r){return this.style.querySourceFeatures(c,r)}queryTerrainElevation(c,r){const s=this.transform.elevation;return s?(r=o.extend({},{exaggerated:!0},r),s.getAtPoint(o.MercatorCoordinate.fromLngLat(c),null,r.exaggerated)):null}setStyle(c,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(c,r))}_getUIString(c){const r=this._locale[c];if(r==null)throw new Error(`Missing UI string '${c}'`);return r}_updateStyle(c,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new pn(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,r){if(typeof c=="string"){const s=this._requestManager.normalizeStyleURL(c),h=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(h,(m,y)=>{m?this.fire(new o.ErrorEvent(m)):y&&this._updateDiff(y,r)})}else typeof c=="object"&&this._updateDiff(c,r)}_updateDiff(c,r){try{this.style.setState(c)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(c,r){return this._lazyInitEmptyStyle(),this.style.addSource(c,r),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const r in c){const s=c[r]._tiles;for(const h in s){const m=s[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(c,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,r,s)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,r,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:E,height:A,data:P}=o.exported.getImageData(r);this.style.addImage(c,{data:new o.RGBAImage({width:E,height:A},P),pixelRatio:s,stretchX:m,stretchY:y,content:w,sdf:h,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:A}=r,P=r;this.style.addImage(c,{data:new o.RGBAImage({width:E,height:A},new Uint8Array(P.data)),pixelRatio:s,stretchX:m,stretchY:y,content:w,sdf:h,version:0,userImage:P}),P.onAdd&&P.onAdd(this,c)}}updateImage(c,r){const s=this.style.getImage(c);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:m,height:y}=h;m!==void 0&&y!==void 0?m===s.data.width&&y===s.data.height?(s.data.replace(h.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(c,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${m}, ${y})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,r){o.getImage(this._requestManager.transformRequest(c,o.ResourceType.Image),(s,h)=>{r(s,h instanceof o.window.HTMLImageElement?o.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(c,r){return this._lazyInitEmptyStyle(),this.style.addLayer(c,r),this._update(!0)}moveLayer(c,r){return this.style.moveLayer(c,r),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,r,s){return this.style.setLayerZoomRange(c,r,s),this._update(!0)}setFilter(c,r,s={}){return this.style.setFilter(c,r,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,r,s,h={}){return this.style.setPaintProperty(c,r,s,h),this._update(!0)}getPaintProperty(c,r){return this.style.getPaintProperty(c,r)}setLayoutProperty(c,r,s,h={}){return this.style.setLayoutProperty(c,r,s,h),this._update(!0)}getLayoutProperty(c,r){return this.style.getLayoutProperty(c,r)}setLight(c,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(c),this.transform):0}setFeatureState(c,r){return this.style.setFeatureState(c,r),this._update()}removeFeatureState(c,r){return this.style.removeFeatureState(c,r),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,h,m,y=this._container;for(;y&&(!h||!m);){const w=o.window.getComputedStyle(y).transform;w&&w!=="none"&&(s=w.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),y=y.parentElement}this._containerWidth=h?Math.abs(c/h):c,this._containerHeight=m?Math.abs(r/m):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=$("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=$("div","mapboxgl-canvas-container",c);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=$("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=$("div","mapboxgl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=$("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,r){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${r}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const r=this._markers.indexOf(c);r!==-1&&this._markers.splice(r,1)}_setupPainter(){const c=o.extend({},j.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);r?(o.storeAuthState(r,!0),this.painter=new ou(r,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(r)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let r;const s=this.painter.context.extTimerQuery,h=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let m=!1;const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,P=this.transform.pitch,D=o.exported.now();this.style.zoomHistory.update(A,D);const U=new o.EvaluationParameters(A,{now:D,fadeDuration:y,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=U.crossFadingFactor();G===1&&G===this._crossFadingFactor||(m=!0,this._crossFadingFactor=G),this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerUpdate()):w=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const A=o.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,r),setTimeout(()=>{const P=s.getQueryObjectEXT(r,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:A,gpuTime:P})),o.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(A);this.fire(new o.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(A);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(E||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(w=this._updateAverageElevation(h,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,r=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((r||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const w=Math.abs(h-m);if(w>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,c,300)}else if(w>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===o.AUTH_ERR_MSG||c.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof gu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(y){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,y,0);const w=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,w),w}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(c),r.canvasCopies.map(m),r.timeStamps)}_canvasPixelComparison(c,r,s){let h=s[1]-s[0];const m=c.length/4;for(let y=0;y<r.length;y++){const w=r[y];let E=0;for(let A=0;A<w.length;A+=4)w[A]===c[A]&&w[A+1]===c[A+1]&&w[A+2]===c[A+2]&&w[A+3]===c[A+3]&&(E+=1);h+=(s[y+2]-s[y+1])*(1-E/m)}return h}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),Pa(this._canvasContainer),Pa(this._controlContainer),Pa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(c){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(s,h)=>s._preloadTiles(c,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,r){o.setCacheLimits(c,r)}get version(){return o.version}},NavigationControl:class{constructor(c){this.options=o.extend({},md,c),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),$("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),$("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=$("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const r=c.getZoom(),s=r===c.getMaxZoom(),h=r===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vu(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,r){const s=$("button",c,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(c,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(c){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},_d,c),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Sa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){this._supportsGeolocation!==void 0?c(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation=r.state!=="denied",c(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,c(this._supportsGeolocation))}_isOutOfMapMaxBounds(c){const r=this._map.getMaxBounds(),s=c.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",c)),this._finish()}}_updateCamera(c){const r=new o.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,h=this._map.getBearing(),m=o.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),m,{geolocateSource:!0})}_updateMarker(c){if(c){const r=new o.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,r=o.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=$("button","mapboxgl-ctrl-geolocate",this._container),$("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$("div","mapboxgl-user-location"),this._dotElement.appendChild($("div","mapboxgl-user-location-dot")),this._dotElement.appendChild($("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=$("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_u,ScaleControl:class{constructor(c){this.options=o.extend({},bu,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=wu.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,h=r._containerWidth/2-c/2,m=r.unproject([h,s]),y=r.unproject([h+c,s]),w=m.distanceTo(y);if(this.options.unit==="imperial"){const E=3.2808*w;E>5280?this._setScale(c,E/5280,"mile"):this._setScale(c,E,"foot")}else this.options.unit==="nautical"?this._setScale(c,w/1852,"nautical-mile"):w>=1e3?this._setScale(c,w/1e3,"kilometer"):this._setScale(c,w,"meter")}_setScale(c,r,s){const h=Ol(r),m=h/r;this._map._requestDomTask(()=>{this._container.style.width=c*m+"px",this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(h):`${h}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof o.window.HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=$("button","mapboxgl-ctrl-fullscreen",this._controlContainer);$("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(c){super(),this.options=o.extend(Object.create(df),c),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(o.window.document.createTextNode(c))}setHTML(c){const r=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let h;for(s.innerHTML=c;h=s.firstChild,h;)r.appendChild(h);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=$("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(c),this.options.closeButton){const s=this._closeButton=$("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let r;return this._classList.delete(c)?r=!1:(this._classList.add(c),r=!0),this._updateClassList(),r}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,h=this._pos;if(!r||!s||!h)return"bottom";const m=s.offsetWidth,y=s.offsetHeight,w=h.x<m/2,E=h.x>r.transform.width-m/2;if(h.y+c<y)return w?"top-left":E?"top-right":"top";if(h.y>r.transform.height-y){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),c.className=r.join(" ")}_update(c){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=$("div","mapboxgl-popup",r.getContainer()),this._tip=$("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xu(this._lngLat,this._pos,r.transform)),!this._trackPointer||c){const m=this._pos=this._trackPointer&&c?c:r.project(this._lngLat),y=Fl(this.options.offset),w=this._anchor=this._getAnchor(y.y),E=Fl(this.options.offset,w),A=m.add(E).round();r._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${za[w]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&r._showingGlobe()){const m=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(pf);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Bl,Style:pn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:pt,Evented:o.Evented,config:o.config,prewarm:function(){Ii().acquire(It)},clearPrewarmedResources:function(){const c=Jt;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(It),Jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(c){o.config.ACCESS_TOKEN=c},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(c){o.config.API_URL=c},get workerCount(){return Ut.workerCount},set workerCount(c){Ut.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return ka});var z=T;return z})})(O1);var DM=O1.exports;function LM(a,d){return zr(),jr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[ki("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])}var X_={exports:{}},U1=function(d,g){return function(){for(var T=new Array(arguments.length),I=0;I<T.length;I++)T[I]=arguments[I];return d.apply(g,T)}},lI=U1,ia=Object.prototype.toString;function H_(a){return Array.isArray(a)}function d_(a){return typeof a=="undefined"}function cI(a){return a!==null&&!d_(a)&&a.constructor!==null&&!d_(a.constructor)&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function j1(a){return ia.call(a)==="[object ArrayBuffer]"}function uI(a){return ia.call(a)==="[object FormData]"}function hI(a){var d;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?d=ArrayBuffer.isView(a):d=a&&a.buffer&&j1(a.buffer),d}function dI(a){return typeof a=="string"}function pI(a){return typeof a=="number"}function N1(a){return a!==null&&typeof a=="object"}function yp(a){if(ia.call(a)!=="[object Object]")return!1;var d=Object.getPrototypeOf(a);return d===null||d===Object.prototype}function fI(a){return ia.call(a)==="[object Date]"}function mI(a){return ia.call(a)==="[object File]"}function _I(a){return ia.call(a)==="[object Blob]"}function V1(a){return ia.call(a)==="[object Function]"}function gI(a){return N1(a)&&V1(a.pipe)}function yI(a){return ia.call(a)==="[object URLSearchParams]"}function xI(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function vI(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function K_(a,d){if(!(a===null||typeof a=="undefined"))if(typeof a!="object"&&(a=[a]),H_(a))for(var g=0,b=a.length;g<b;g++)d.call(null,a[g],g,a);else for(var T in a)Object.prototype.hasOwnProperty.call(a,T)&&d.call(null,a[T],T,a)}function p_(){var a={};function d(T,I){yp(a[I])&&yp(T)?a[I]=p_(a[I],T):yp(T)?a[I]=p_({},T):H_(T)?a[I]=T.slice():a[I]=T}for(var g=0,b=arguments.length;g<b;g++)K_(arguments[g],d);return a}function bI(a,d,g){return K_(d,function(T,I){g&&typeof T=="function"?a[I]=lI(T,g):a[I]=T}),a}function wI(a){return a.charCodeAt(0)===65279&&(a=a.slice(1)),a}var En={isArray:H_,isArrayBuffer:j1,isBuffer:cI,isFormData:uI,isArrayBufferView:hI,isString:dI,isNumber:pI,isObject:N1,isPlainObject:yp,isUndefined:d_,isDate:fI,isFile:mI,isBlob:_I,isFunction:V1,isStream:gI,isURLSearchParams:yI,isStandardBrowserEnv:vI,forEach:K_,merge:p_,extend:bI,trim:xI,stripBOM:wI},ac=En;function Ov(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var $1=function(d,g,b){if(!g)return d;var T;if(b)T=b(g);else if(ac.isURLSearchParams(g))T=g.toString();else{var I=[];ac.forEach(g,function(k,j){k===null||typeof k=="undefined"||(ac.isArray(k)?j=j+"[]":k=[k],ac.forEach(k,function(B){ac.isDate(B)?B=B.toISOString():ac.isObject(B)&&(B=JSON.stringify(B)),I.push(Ov(j)+"="+Ov(B))}))}),T=I.join("&")}if(T){var z=d.indexOf("#");z!==-1&&(d=d.slice(0,z)),d+=(d.indexOf("?")===-1?"?":"&")+T}return d},TI=En;function $p(){this.handlers=[]}$p.prototype.use=function(d,g,b){return this.handlers.push({fulfilled:d,rejected:g,synchronous:b?b.synchronous:!1,runWhen:b?b.runWhen:null}),this.handlers.length-1};$p.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)};$p.prototype.forEach=function(d){TI.forEach(this.handlers,function(b){b!==null&&d(b)})};var EI=$p,SI=En,AI=function(d,g){SI.forEach(d,function(T,I){I!==g&&I.toUpperCase()===g.toUpperCase()&&(d[g]=T,delete d[I])})},G1=function(d,g,b,T,I){return d.config=g,b&&(d.code=b),d.request=T,d.response=I,d.isAxiosError=!0,d.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},d},q1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},II=G1,Z1=function(d,g,b,T,I){var z=new Error(d);return II(z,g,b,T,I)},CI=Z1,MI=function(d,g,b){var T=b.config.validateStatus;!b.status||!T||T(b.status)?d(b):g(CI("Request failed with status code "+b.status,b.config,null,b.request,b))},dp=En,zI=dp.isStandardBrowserEnv()?function(){return{write:function(g,b,T,I,z,o){var k=[];k.push(g+"="+encodeURIComponent(b)),dp.isNumber(T)&&k.push("expires="+new Date(T).toGMTString()),dp.isString(I)&&k.push("path="+I),dp.isString(z)&&k.push("domain="+z),o===!0&&k.push("secure"),document.cookie=k.join("; ")},read:function(g){var b=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return b?decodeURIComponent(b[3]):null},remove:function(g){this.write(g,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),PI=function(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)},kI=function(d,g){return g?d.replace(/\/+$/,"")+"/"+g.replace(/^\/+/,""):d},DI=PI,LI=kI,RI=function(d,g){return d&&!DI(g)?LI(d,g):g},km=En,BI=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],OI=function(d){var g={},b,T,I;return d&&km.forEach(d.split(`
`),function(o){if(I=o.indexOf(":"),b=km.trim(o.substr(0,I)).toLowerCase(),T=km.trim(o.substr(I+1)),b){if(g[b]&&BI.indexOf(b)>=0)return;b==="set-cookie"?g[b]=(g[b]?g[b]:[]).concat([T]):g[b]=g[b]?g[b]+", "+T:T}}),g},Fv=En,FI=Fv.isStandardBrowserEnv()?function(){var d=/(msie|trident)/i.test(navigator.userAgent),g=document.createElement("a"),b;function T(I){var z=I;return d&&(g.setAttribute("href",z),z=g.href),g.setAttribute("href",z),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:g.pathname.charAt(0)==="/"?g.pathname:"/"+g.pathname}}return b=T(window.location.href),function(z){var o=Fv.isString(z)?T(z):z;return o.protocol===b.protocol&&o.host===b.host}}():function(){return function(){return!0}}();function Y_(a){this.message=a}Y_.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};Y_.prototype.__CANCEL__=!0;var Gp=Y_,pp=En,UI=MI,jI=zI,NI=$1,VI=RI,$I=OI,GI=FI,Dm=Z1,qI=q1,ZI=Gp,Uv=function(d){return new Promise(function(b,T){var I=d.data,z=d.headers,o=d.responseType,k;function j(){d.cancelToken&&d.cancelToken.unsubscribe(k),d.signal&&d.signal.removeEventListener("abort",k)}pp.isFormData(I)&&delete z["Content-Type"];var F=new XMLHttpRequest;if(d.auth){var B=d.auth.username||"",$=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";z.Authorization="Basic "+btoa(B+":"+$)}var ne=VI(d.baseURL,d.url);F.open(d.method.toUpperCase(),NI(ne,d.params,d.paramsSerializer),!0),F.timeout=d.timeout;function oe(){if(!!F){var Ie="getAllResponseHeaders"in F?$I(F.getAllResponseHeaders()):null,Ge=!o||o==="text"||o==="json"?F.responseText:F.response,qe={data:Ge,status:F.status,statusText:F.statusText,headers:Ie,config:d,request:F};UI(function(ft){b(ft),j()},function(ft){T(ft),j()},qe),F=null}}if("onloadend"in F?F.onloadend=oe:F.onreadystatechange=function(){!F||F.readyState!==4||F.status===0&&!(F.responseURL&&F.responseURL.indexOf("file:")===0)||setTimeout(oe)},F.onabort=function(){!F||(T(Dm("Request aborted",d,"ECONNABORTED",F)),F=null)},F.onerror=function(){T(Dm("Network Error",d,null,F)),F=null},F.ontimeout=function(){var Ge=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",qe=d.transitional||qI;d.timeoutErrorMessage&&(Ge=d.timeoutErrorMessage),T(Dm(Ge,d,qe.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",F)),F=null},pp.isStandardBrowserEnv()){var ve=(d.withCredentials||GI(ne))&&d.xsrfCookieName?jI.read(d.xsrfCookieName):void 0;ve&&(z[d.xsrfHeaderName]=ve)}"setRequestHeader"in F&&pp.forEach(z,function(Ge,qe){typeof I=="undefined"&&qe.toLowerCase()==="content-type"?delete z[qe]:F.setRequestHeader(qe,Ge)}),pp.isUndefined(d.withCredentials)||(F.withCredentials=!!d.withCredentials),o&&o!=="json"&&(F.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&F.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&F.upload&&F.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(k=function(Ie){!F||(T(!Ie||Ie&&Ie.type?new ZI("canceled"):Ie),F.abort(),F=null)},d.cancelToken&&d.cancelToken.subscribe(k),d.signal&&(d.signal.aborted?k():d.signal.addEventListener("abort",k))),I||(I=null),F.send(I)})},Zr=En,jv=AI,WI=G1,XI=q1,HI={"Content-Type":"application/x-www-form-urlencoded"};function Nv(a,d){!Zr.isUndefined(a)&&Zr.isUndefined(a["Content-Type"])&&(a["Content-Type"]=d)}function KI(){var a;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(a=Uv),a}function YI(a,d,g){if(Zr.isString(a))try{return(d||JSON.parse)(a),Zr.trim(a)}catch(b){if(b.name!=="SyntaxError")throw b}return(g||JSON.stringify)(a)}var qp={transitional:XI,adapter:KI(),transformRequest:[function(d,g){return jv(g,"Accept"),jv(g,"Content-Type"),Zr.isFormData(d)||Zr.isArrayBuffer(d)||Zr.isBuffer(d)||Zr.isStream(d)||Zr.isFile(d)||Zr.isBlob(d)?d:Zr.isArrayBufferView(d)?d.buffer:Zr.isURLSearchParams(d)?(Nv(g,"application/x-www-form-urlencoded;charset=utf-8"),d.toString()):Zr.isObject(d)||g&&g["Content-Type"]==="application/json"?(Nv(g,"application/json"),YI(d)):d}],transformResponse:[function(d){var g=this.transitional||qp.transitional,b=g&&g.silentJSONParsing,T=g&&g.forcedJSONParsing,I=!b&&this.responseType==="json";if(I||T&&Zr.isString(d)&&d.length)try{return JSON.parse(d)}catch(z){if(I)throw z.name==="SyntaxError"?WI(z,this,"E_JSON_PARSE"):z}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Zr.forEach(["delete","get","head"],function(d){qp.headers[d]={}});Zr.forEach(["post","put","patch"],function(d){qp.headers[d]=Zr.merge(HI)});var J_=qp,JI=En,QI=J_,eC=function(d,g,b){var T=this||QI;return JI.forEach(b,function(z){d=z.call(T,d,g)}),d},W1=function(d){return!!(d&&d.__CANCEL__)},Vv=En,Lm=eC,tC=W1,iC=J_,rC=Gp;function Rm(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new rC("canceled")}var nC=function(d){Rm(d),d.headers=d.headers||{},d.data=Lm.call(d,d.data,d.headers,d.transformRequest),d.headers=Vv.merge(d.headers.common||{},d.headers[d.method]||{},d.headers),Vv.forEach(["delete","get","head","post","put","patch","common"],function(T){delete d.headers[T]});var g=d.adapter||iC.adapter;return g(d).then(function(T){return Rm(d),T.data=Lm.call(d,T.data,T.headers,d.transformResponse),T},function(T){return tC(T)||(Rm(d),T&&T.response&&(T.response.data=Lm.call(d,T.response.data,T.response.headers,d.transformResponse))),Promise.reject(T)})},kn=En,X1=function(d,g){g=g||{};var b={};function T(F,B){return kn.isPlainObject(F)&&kn.isPlainObject(B)?kn.merge(F,B):kn.isPlainObject(B)?kn.merge({},B):kn.isArray(B)?B.slice():B}function I(F){if(kn.isUndefined(g[F])){if(!kn.isUndefined(d[F]))return T(void 0,d[F])}else return T(d[F],g[F])}function z(F){if(!kn.isUndefined(g[F]))return T(void 0,g[F])}function o(F){if(kn.isUndefined(g[F])){if(!kn.isUndefined(d[F]))return T(void 0,d[F])}else return T(void 0,g[F])}function k(F){if(F in g)return T(d[F],g[F]);if(F in d)return T(void 0,d[F])}var j={url:z,method:z,data:z,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:k};return kn.forEach(Object.keys(d).concat(Object.keys(g)),function(B){var $=j[B]||I,ne=$(B);kn.isUndefined(ne)&&$!==k||(b[B]=ne)}),b},H1={version:"0.26.1"},oC=H1.version,Q_={};["object","boolean","number","function","string","symbol"].forEach(function(a,d){Q_[a]=function(b){return typeof b===a||"a"+(d<1?"n ":" ")+a}});var $v={};Q_.transitional=function(d,g,b){function T(I,z){return"[Axios v"+oC+"] Transitional option '"+I+"'"+z+(b?". "+b:"")}return function(I,z,o){if(d===!1)throw new Error(T(z," has been removed"+(g?" in "+g:"")));return g&&!$v[z]&&($v[z]=!0,console.warn(T(z," has been deprecated since v"+g+" and will be removed in the near future"))),d?d(I,z,o):!0}};function sC(a,d,g){if(typeof a!="object")throw new TypeError("options must be an object");for(var b=Object.keys(a),T=b.length;T-- >0;){var I=b[T],z=d[I];if(z){var o=a[I],k=o===void 0||z(o,I,a);if(k!==!0)throw new TypeError("option "+I+" must be "+k);continue}if(g!==!0)throw Error("Unknown option "+I)}}var aC={assertOptions:sC,validators:Q_},K1=En,lC=$1,Gv=EI,qv=nC,Zp=X1,Y1=aC,lc=Y1.validators;function Ih(a){this.defaults=a,this.interceptors={request:new Gv,response:new Gv}}Ih.prototype.request=function(d,g){typeof d=="string"?(g=g||{},g.url=d):g=d||{},g=Zp(this.defaults,g),g.method?g.method=g.method.toLowerCase():this.defaults.method?g.method=this.defaults.method.toLowerCase():g.method="get";var b=g.transitional;b!==void 0&&Y1.assertOptions(b,{silentJSONParsing:lc.transitional(lc.boolean),forcedJSONParsing:lc.transitional(lc.boolean),clarifyTimeoutError:lc.transitional(lc.boolean)},!1);var T=[],I=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(g)===!1||(I=I&&ne.synchronous,T.unshift(ne.fulfilled,ne.rejected))});var z=[];this.interceptors.response.forEach(function(ne){z.push(ne.fulfilled,ne.rejected)});var o;if(!I){var k=[qv,void 0];for(Array.prototype.unshift.apply(k,T),k=k.concat(z),o=Promise.resolve(g);k.length;)o=o.then(k.shift(),k.shift());return o}for(var j=g;T.length;){var F=T.shift(),B=T.shift();try{j=F(j)}catch($){B($);break}}try{o=qv(j)}catch($){return Promise.reject($)}for(;z.length;)o=o.then(z.shift(),z.shift());return o};Ih.prototype.getUri=function(d){return d=Zp(this.defaults,d),lC(d.url,d.params,d.paramsSerializer).replace(/^\?/,"")};K1.forEach(["delete","get","head","options"],function(d){Ih.prototype[d]=function(g,b){return this.request(Zp(b||{},{method:d,url:g,data:(b||{}).data}))}});K1.forEach(["post","put","patch"],function(d){Ih.prototype[d]=function(g,b,T){return this.request(Zp(T||{},{method:d,url:g,data:b}))}});var cC=Ih,uC=Gp;function vc(a){if(typeof a!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise(function(T){d=T});var g=this;this.promise.then(function(b){if(!!g._listeners){var T,I=g._listeners.length;for(T=0;T<I;T++)g._listeners[T](b);g._listeners=null}}),this.promise.then=function(b){var T,I=new Promise(function(z){g.subscribe(z),T=z}).then(b);return I.cancel=function(){g.unsubscribe(T)},I},a(function(T){g.reason||(g.reason=new uC(T),d(g.reason))})}vc.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};vc.prototype.subscribe=function(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]};vc.prototype.unsubscribe=function(d){if(!!this._listeners){var g=this._listeners.indexOf(d);g!==-1&&this._listeners.splice(g,1)}};vc.source=function(){var d,g=new vc(function(T){d=T});return{token:g,cancel:d}};var hC=vc,dC=function(d){return function(b){return d.apply(null,b)}},pC=En,fC=function(d){return pC.isObject(d)&&d.isAxiosError===!0},Zv=En,mC=U1,xp=cC,_C=X1,gC=J_;function J1(a){var d=new xp(a),g=mC(xp.prototype.request,d);return Zv.extend(g,xp.prototype,d),Zv.extend(g,d),g.create=function(T){return J1(_C(a,T))},g}var Uo=J1(gC);Uo.Axios=xp;Uo.Cancel=Gp;Uo.CancelToken=hC;Uo.isCancel=W1;Uo.VERSION=H1.version;Uo.all=function(d){return Promise.all(d)};Uo.spread=dC;Uo.isAxiosError=fC;X_.exports=Uo;X_.exports.default=Uo;var RM=X_.exports;function Wv(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Object.keys(a).reduce((g,b)=>(d.includes(b)||(g[b]=hi(a[b])),g),{})}function Mp(a){return typeof a=="function"}function yC(a){return as(a)||_c(a)}function Q1(a,d,g,b){return a.call(b,hi(d),hi(g),b)}function eb(a){return a.$valid!==void 0?!a.$valid:!a}function xC(a,d,g,b,T,I,z){let{$lazy:o,$rewardEarly:k}=T,j=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[],F=arguments.length>8?arguments[8]:void 0,B=arguments.length>9?arguments[9]:void 0,$=arguments.length>10?arguments[10]:void 0;const ne=$t(!!b.value),oe=$t(0);g.value=!1;const ve=bn([d,b].concat(j,$),()=>{if(o&&!b.value||k&&!B.value&&!g.value)return;let Ie;try{Ie=Q1(a,d,F,z)}catch(Ge){Ie=Promise.reject(Ge)}oe.value++,g.value=!!oe.value,ne.value=!1,Promise.resolve(Ie).then(Ge=>{oe.value--,g.value=!!oe.value,I.value=Ge,ne.value=eb(Ge)}).catch(Ge=>{oe.value--,g.value=!!oe.value,I.value=Ge,ne.value=!0})},{immediate:!0,deep:typeof d=="object"});return{$invalid:ne,$unwatch:ve}}function vC(a,d,g,b,T,I,z,o){let{$lazy:k,$rewardEarly:j}=b;const F=()=>({}),B=Dt(()=>{if(k&&!g.value||j&&!o.value)return!1;let $=!0;try{const ne=Q1(a,d,z,I);T.value=ne,$=eb(ne)}catch(ne){T.value=ne}return $});return{$unwatch:F,$invalid:B}}function bC(a,d,g,b,T,I,z,o,k,j,F){const B=$t(!1),$=a.$params||{},ne=$t(null);let oe,ve;a.$async?{$invalid:oe,$unwatch:ve}=xC(a.$validator,d,B,g,b,ne,T,a.$watchTargets,k,j,F):{$invalid:oe,$unwatch:ve}=vC(a.$validator,d,g,b,ne,T,k,j);const Ie=a.$message;return{$message:Mp(Ie)?Dt(()=>Ie(Wv({$pending:B,$invalid:oe,$params:Wv($),$model:d,$response:ne,$validator:I,$propertyPath:o,$property:z}))):Ie||"",$params:$,$pending:B,$invalid:oe,$response:ne,$unwatch:ve}}function wC(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const d=hi(a),g=Object.keys(d),b={},T={},I={};return g.forEach(z=>{const o=d[z];switch(!0){case Mp(o.$validator):b[z]=o;break;case Mp(o):b[z]={$validator:o};break;case z.startsWith("$"):I[z]=o;break;default:T[z]=o}}),{rules:b,nestedValidators:T,config:I}}function TC(){}const EC="__root";function tb(a,d,g){if(g)return d?d(a()):a();try{var b=Promise.resolve(a());return d?b.then(d):b}catch(T){return Promise.reject(T)}}function SC(a,d){return tb(a,TC,d)}function AC(a,d){var g=a();return g&&g.then?g.then(d):d(g)}function IC(a){return function(){for(var d=[],g=0;g<arguments.length;g++)d[g]=arguments[g];try{return Promise.resolve(a.apply(this,d))}catch(b){return Promise.reject(b)}}}function CC(a,d,g,b,T,I,z,o,k){const j=Object.keys(a),F=b.get(T,a),B=$t(!1),$=$t(!1),ne=$t(0);if(F){if(!F.$partial)return F;F.$unwatch(),B.value=F.$dirty.value}const oe={$dirty:B,$path:T,$touch:()=>{B.value||(B.value=!0)},$reset:()=>{B.value&&(B.value=!1)},$commit:()=>{}};return j.length?(j.forEach(ve=>{oe[ve]=bC(a[ve],d,oe.$dirty,I,z,ve,g,T,k,$,ne)}),oe.$externalResults=Dt(()=>o.value?[].concat(o.value).map((ve,Ie)=>({$propertyPath:T,$property:g,$validator:"$externalResults",$uid:`${T}-externalResult-${Ie}`,$message:ve,$params:{},$response:null,$pending:!1})):[]),oe.$invalid=Dt(()=>{const ve=j.some(Ie=>hi(oe[Ie].$invalid));return $.value=ve,!!oe.$externalResults.value.length||ve}),oe.$pending=Dt(()=>j.some(ve=>hi(oe[ve].$pending))),oe.$error=Dt(()=>oe.$dirty.value?oe.$pending.value||oe.$invalid.value:!1),oe.$silentErrors=Dt(()=>j.filter(ve=>hi(oe[ve].$invalid)).map(ve=>{const Ie=oe[ve];return Fo({$propertyPath:T,$property:g,$validator:ve,$uid:`${T}-${ve}`,$message:Ie.$message,$params:Ie.$params,$response:Ie.$response,$pending:Ie.$pending})}).concat(oe.$externalResults.value)),oe.$errors=Dt(()=>oe.$dirty.value?oe.$silentErrors.value:[]),oe.$unwatch=()=>j.forEach(ve=>{oe[ve].$unwatch()}),oe.$commit=()=>{$.value=!0,ne.value=Date.now()},b.set(T,a,oe),oe):(F&&b.set(T,a,oe),oe)}function MC(a,d,g,b,T,I,z){const o=Object.keys(a);return o.length?o.reduce((k,j)=>(k[j]=f_({validations:a[j],state:d,key:j,parentKey:g,resultsCache:b,globalConfig:T,instance:I,externalResults:z}),k),{}):{}}function zC(a,d,g){const b=Dt(()=>[d,g].filter(oe=>oe).reduce((oe,ve)=>oe.concat(Object.values(hi(ve))),[])),T=Dt({get(){return a.$dirty.value||(b.value.length?b.value.every(oe=>oe.$dirty):!1)},set(oe){a.$dirty.value=oe}}),I=Dt(()=>{const oe=hi(a.$silentErrors)||[],ve=b.value.filter(Ie=>(hi(Ie).$silentErrors||[]).length).reduce((Ie,Ge)=>Ie.concat(...Ge.$silentErrors),[]);return oe.concat(ve)}),z=Dt(()=>{const oe=hi(a.$errors)||[],ve=b.value.filter(Ie=>(hi(Ie).$errors||[]).length).reduce((Ie,Ge)=>Ie.concat(...Ge.$errors),[]);return oe.concat(ve)}),o=Dt(()=>b.value.some(oe=>oe.$invalid)||hi(a.$invalid)||!1),k=Dt(()=>b.value.some(oe=>hi(oe.$pending))||hi(a.$pending)||!1),j=Dt(()=>b.value.some(oe=>oe.$dirty)||b.value.some(oe=>oe.$anyDirty)||T.value),F=Dt(()=>T.value?k.value||o.value:!1),B=()=>{a.$touch(),b.value.forEach(oe=>{oe.$touch()})},$=()=>{a.$commit(),b.value.forEach(oe=>{oe.$commit()})},ne=()=>{a.$reset(),b.value.forEach(oe=>{oe.$reset()})};return b.value.length&&b.value.every(oe=>oe.$dirty)&&B(),{$dirty:T,$errors:z,$invalid:o,$anyDirty:j,$error:F,$pending:k,$touch:B,$reset:ne,$silentErrors:I,$commit:$}}function f_(a){const d=IC(function(){return Ft(),AC(function(){if(ve.$rewardEarly)return ri(),SC(Rn)},function(){return tb(Rn,function(){return new Promise(Lt=>{if(!gt.value)return Lt(!We.value);const Gi=bn(gt,()=>{Lt(!We.value),Gi()})})})})});let{validations:g,state:b,key:T,parentKey:I,childResults:z,resultsCache:o,globalConfig:k={},instance:j,externalResults:F}=a;const B=I?`${I}.${T}`:T,{rules:$,nestedValidators:ne,config:oe}=wC(g),ve=Object.assign({},k,oe),Ie=T?Dt(()=>{const Lt=hi(b);return Lt?hi(Lt[T]):void 0}):b,Ge=Object.assign({},hi(F)||{}),qe=Dt(()=>{const Lt=hi(F);return T?Lt?hi(Lt[T]):void 0:Lt}),st=CC($,Ie,T,o,B,ve,j,qe,b),ft=MC(ne,Ie,B,o,ve,j,qe),{$dirty:He,$errors:yt,$invalid:We,$anyDirty:xt,$error:Et,$pending:gt,$touch:Ft,$reset:bt,$silentErrors:ei,$commit:ri}=zC(st,ft,z),Er=T?Dt({get:()=>hi(Ie),set:Lt=>{He.value=!0;const Gi=hi(b),lr=hi(F);lr&&(lr[T]=Ge[T]),ar(Gi[T])?Gi[T].value=Lt:Gi[T]=Lt}}):null;T&&ve.$autoDirty&&bn(Ie,()=>{He.value||Ft();const Lt=hi(F);Lt&&(Lt[T]=Ge[T])},{flush:"sync"});function vi(Lt){return(z.value||{})[Lt]}function fi(){ar(F)?F.value=Ge:Object.keys(Ge).length===0?Object.keys(F).forEach(Lt=>{delete F[Lt]}):Object.assign(F,Ge)}return Fo(Object.assign({},st,{$model:Er,$dirty:He,$error:Et,$errors:yt,$invalid:We,$anyDirty:xt,$pending:gt,$touch:Ft,$reset:bt,$path:B||EC,$silentErrors:ei,$validate:d,$commit:ri},z&&{$getResultsForChild:vi,$clearExternalResults:fi},ft))}class PC{constructor(){this.storage=new Map}set(d,g,b){this.storage.set(d,{rules:g,result:b})}checkRulesValidity(d,g,b){const T=Object.keys(b),I=Object.keys(g);return I.length!==T.length||!I.every(o=>T.includes(o))?!1:I.every(o=>g[o].$params?Object.keys(g[o].$params).every(k=>hi(b[o].$params[k])===hi(g[o].$params[k])):!0)}get(d,g){const b=this.storage.get(d);if(!b)return;const{rules:T,result:I}=b,z=this.checkRulesValidity(d,g,T),o=I.$unwatch?I.$unwatch:()=>({});return z?I:{$dirty:I.$dirty,$partial:!0,$unwatch:o}}}const vp={COLLECT_ALL:!0,COLLECT_NONE:!1},Xv=Symbol("vuelidate#injectChildResults"),Hv=Symbol("vuelidate#removeChildResults");function kC(a){let{$scope:d,instance:g}=a;const b={},T=$t([]),I=Dt(()=>T.value.reduce((F,B)=>(F[B]=hi(b[B]),F),{}));function z(F,B){let{$registerAs:$,$scope:ne,$stopPropagation:oe}=B;oe||d===vp.COLLECT_NONE||ne===vp.COLLECT_NONE||d!==vp.COLLECT_ALL&&d!==ne||(b[$]=F,T.value.push($))}g.__vuelidateInjectInstances=[].concat(g.__vuelidateInjectInstances||[],z);function o(F){T.value=T.value.filter(B=>B!==F),delete b[F]}g.__vuelidateRemoveInstances=[].concat(g.__vuelidateRemoveInstances||[],o);const k=ir(Xv,[]);br(Xv,g.__vuelidateInjectInstances);const j=ir(Hv,[]);return br(Hv,g.__vuelidateRemoveInstances),{childResults:I,sendValidationResultsToParent:k,removeValidationResultsFromParent:j}}function ib(a){return new Proxy(a,{get(d,g){return typeof d[g]=="object"?ib(d[g]):Dt(()=>d[g])}})}function BM(a,d){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};arguments.length===1&&(g=a,a=void 0,d=void 0);let{$registerAs:b,$scope:T=vp.COLLECT_ALL,$stopPropagation:I,$externalResults:z,currentVueInstance:o}=g;const k=o||Eh(),j=k?k.type:{};!b&&k&&(b=`_vuelidate_${k.uid||k._uid}`);const F=$t({}),B=new PC,{childResults:$,sendValidationResultsToParent:ne,removeValidationResultsFromParent:oe}=k?kC({$scope:T,instance:k}):{childResults:$t({})};if(!a&&j.validations){const ve=j.validations;d=$t({}),L0(()=>{d.value=k.proxy,bn(()=>Mp(ve)?ve.call(d.value,new ib(d.value)):ve,Ie=>{F.value=f_({validations:Ie,state:d,childResults:$,resultsCache:B,globalConfig:g,instance:k.proxy,externalResults:z||k.proxy.vuelidateExternalResults})},{immediate:!0})}),g=j.validationsConfig||g}else{const ve=ar(a)||yC(a)?a:Fo(a||{});bn(ve,Ie=>{F.value=f_({validations:Ie,state:d,childResults:$,resultsCache:B,globalConfig:g,instance:k?k.proxy:{},externalResults:z})},{immediate:!0})}return k&&(ne.forEach(ve=>ve(F,{$registerAs:b,$scope:T,$stopPropagation:I})),B_(()=>oe.forEach(ve=>ve(b)))),Dt(()=>Object.assign({},hi(F.value),$.value))}const eg=a=>{if(a=hi(a),Array.isArray(a))return!!a.length;if(a==null)return!1;if(a===!1)return!0;if(a instanceof Date)return!isNaN(a.getTime());if(typeof a=="object"){for(let d in a)return!0;return!1}return!!String(a).length},DC=a=>(a=hi(a),Array.isArray(a)?a.length:typeof a=="object"?Object.keys(a).length:String(a).length);function tl(){for(var a=arguments.length,d=new Array(a),g=0;g<a;g++)d[g]=arguments[g];return b=>(b=hi(b),!eg(b)||d.every(T=>T.test(b)))}tl(/^[a-zA-Z]*$/);tl(/^[a-zA-Z0-9]*$/);var LC=tl(/^\d*(\.\d+)?$/),OM={$validator:LC,$message:"Value must be numeric",$params:{type:"numeric"}};const RC=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;var BC=tl(RC),FM={$validator:BC,$message:"Value is not a valid email address",$params:{type:"email"}};function OC(a){return d=>!eg(d)||DC(d)>=hi(a)}function UM(a){return{$validator:OC(a),$message:d=>{let{$params:g}=d;return`This field should be at least ${g.min} long`},$params:{min:a,type:"minLength"}}}function FC(a){return typeof a=="string"&&(a=a.trim()),eg(a)}var jM={$validator:FC,$message:"Value is required",$params:{type:"required"}};function UC(a){return d=>hi(d)===hi(a)}function NM(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"other";return{$validator:UC(a),$message:g=>`The value must be equal to the ${d} value`,$params:{equalTo:a,otherName:d,type:"sameAs"}}}const jC=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i;tl(jC);tl(/(^[0-9]*$)|(^-[0-9]+$)/);tl(/^[-]?\d*(\.\d+)?$/);export{dM as $,nM as A,oM as B,DM as C,_M as D,VC as E,ao as F,MM as G,HC as H,GC as I,YC as J,qC as K,fM as L,iM as M,wM as N,vM as O,__ as P,xM as Q,aA as R,EM as S,J0 as T,mM as U,Fo as V,Dt as W,BM as X,TM as Y,CM as Z,LM as _,zr as a,hM as a0,uM as a1,jM as a2,FM as a3,RM as a4,Rn as a5,OM as a6,UM as a7,NM as a8,WC as a9,pM as aa,yM as ab,IM as ac,bM as ad,AM as ae,KC as af,$C as ag,eM as ah,QC as ai,JC as aj,PM as ak,ki as b,ZC as c,kM as d,hi as e,HA as f,X0 as g,gM as h,YA as i,rM as j,ar as k,SM as l,bE as m,Dv as n,tn as o,jr as p,aM as q,$t as r,XC as s,lM as t,tM as u,zM as v,MT as w,cM as x,g_ as y,sM as z};
